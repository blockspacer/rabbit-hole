/**
 * rabbit-hole v0.0.0 build Mon Oct 07 2019
 * https://github.com/vanruesc/rabbit-hole
 * Copyright 2019 Raoul van RÃ¼schen, Zlib
 */
function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}(function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):(e=e||self,t(e.RABBITHOLE={}))})(this,function(e){'use strict';var me=Math.pow,ve=Math.trunc,ge=Math.sign,xe=Math.PI,fe=Math.atan2,pe=Math.round,ke=Math.acos,ze=Math.sqrt,we=Math.cos,Se=Math.sin,Ie=Math.floor,be=Math.ceil,Te=Math.abs,Ce=Math.max,Ae=Math.min;function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0,a;n<t.length;n++)a=t[n],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function i(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function y(e,t){return y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},y(e,t)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function g(){return g=h()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var a=Function.bind.apply(e,i),r=new a;return n&&y(r,n.prototype),r},g.apply(null,arguments)}function x(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(e,t){return t&&("object"===_typeof(t)||"function"==typeof t)?t:x(e)}function z(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=u(e),null!==e););return e}function w(e,t,n){return w="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var a=z(e,t);if(a){var i=Object.getOwnPropertyDescriptor(a,t);return i.get?i.get.call(n):i.value}},w(e,t,n||e)}function S(e,t,n,a){return S="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,n,a){var i=z(e,t),r;if(i){if(r=Object.getOwnPropertyDescriptor(i,t),r.set)return r.set.call(a,n),!0;if(!r.writable)return!1}if(r=Object.getOwnPropertyDescriptor(a,t),r){if(!r.writable)return!1;r.value=n,Object.defineProperty(a,t,r)}else s(a,t,n);return!0},S(e,t,n,a)}function I(e,t,n,a,i){var r=S(e,t,n,a||e);if(!r&&i)throw new Error("failed to set property");return n}function T(e){return C(e)||A(e)||E()}function C(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function A(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function E(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function P(e,t,n){return Ce(Ae(e,n),t)}function D(e,t,n,a,i,r){var s=0;return e>t&&e>n?(i<e&&(s|=2),r<e&&(s|=1)):t>n?(a<t&&(s|=4),r<t&&(s|=1)):(a<n&&(s|=4),i<n&&(s|=2)),s}function F(e,t,n,a){var i=0,s;return t<n?(s=t,i=0):(s=n,i=1),a<s&&(i=2),r[e][i]}function O(e,t,n,a,i,r,s,l,o){var u=e.children,y,h,c,d;if(0<=i&&0<=r&&0<=s)if(null===u)o.push(e);else{h=.5*(t+i),c=.5*(n+r),d=.5*(a+s),y=D(t,n,a,h,c,d);do 0===y?(O(u[At],t,n,a,h,c,d,l,o),y=F(y,h,c,d)):1===y?(O(u[1^At],t,n,d,h,c,s,l,o),y=F(y,h,c,s)):2===y?(O(u[2^At],t,c,a,h,r,d,l,o),y=F(y,h,r,d)):3===y?(O(u[3^At],t,c,d,h,r,s,l,o),y=F(y,h,r,s)):4===y?(O(u[4^At],h,n,a,i,c,d,l,o),y=F(y,i,c,d)):5===y?(O(u[5^At],h,n,d,i,c,s,l,o),y=F(y,i,c,s)):6===y?(O(u[6^At],h,c,a,i,r,d,l,o),y=F(y,i,r,d)):7===y?(O(u[7^At],h,c,d,i,r,s,l,o),y=8):void 0;while(8>y)}}function M(e){var t=e.children,n=0,a,r,s;if(null!==t)for(a=0,r=t.length;a<r;++a)s=1+M(t[a]),s>n&&(n=s);return n}function B(e,t,n){var a=e.children,r,s;if(Pt.min=e.min,Pt.max=e.max,t.intersectsBox(Pt))if(null!==a)for(r=0,s=a.length;r<s;++r)B(a[r],t,n);else n.push(e)}function L(e,t,n,a){var r=e.children,s,o;if(n===t)a.push(e);else if(null!==r)for(++n,s=0,o=r.length;s<o;++s)L(r[s],t,n,a)}function R(e){var t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=t.getContext("2d");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height)}function V(e,t,n,a,r,s,l){var o,u,y,h,c,d;if(n.csg.add(t),0<l)for(--l,o=e.getGrid(l),u=e.getKeyDesign(),y=n.children,h=kn[l],a<<=1,r<<=1,s<<=1,d=0;8>d;++d)0!=(y&1<<d)&&(c=pt[d],vn.set(a+c[0],r+c[1],s+c[2]),h.containsPoint(vn)&&V(e,t,o.get(u.packKey(vn)),vn.x,vn.y,vn.z,l))}function N(e,t,n,a,i,r){var s=0;return e>t&&e>n?(i<e&&(s|=2),r<e&&(s|=1)):t>n?(a<t&&(s|=4),r<t&&(s|=1)):(a<n&&(s|=4),i<n&&(s|=2)),s}function U(e,t,n,a){var i=0,r;return t<n?(r=t,i=0):(r=n,i=1),a<r&&(i=2),bn[e][i]}function Y(e,t,n,a,r,s,l,o,u,y,h,c,d){var m,v,g,x,f,p,k,z,w,S,I;if(0<=y&&0<=h&&0<=c)if(m=e.getKeyDesign(),0===s||null!==t.isosurface)v=e.getCellSize(s),g=new hn(t),g.id.set(s,m.packKey(wn.set(n,a,r))),g.min.copy(wn).multiplyScalar(v).add(e.min),g.max.copy(g.min).addScalar(v),d.push(g);else if(0<t.children){x=e.getGrid(--s),f=t.children,n<<=1,a<<=1,r<<=1,z=.5*(l+y),w=.5*(o+h),S=.5*(u+c),k=N(l,o,u,z,w,S);do switch(I=Tn^k,k){case 0:{0!=(f&1<<I)&&(p=pt[I],wn.set(n+p[0],a+p[1],r+p[2]),Y(e,x.get(m.packKey(wn)),wn.x,wn.y,wn.z,s,l,o,u,z,w,S,d)),k=U(k,z,w,S);break}case 1:{0!=(f&1<<I)&&(p=pt[I],wn.set(n+p[0],a+p[1],r+p[2]),Y(e,x.get(m.packKey(wn)),wn.x,wn.y,wn.z,s,l,o,S,z,w,c,d)),k=U(k,z,w,c);break}case 2:{0!=(f&1<<I)&&(p=pt[I],wn.set(n+p[0],a+p[1],r+p[2]),Y(e,x.get(m.packKey(wn)),wn.x,wn.y,wn.z,s,l,w,u,z,h,S,d)),k=U(k,z,h,S);break}case 3:{0!=(f&1<<I)&&(p=pt[I],wn.set(n+p[0],a+p[1],r+p[2]),Y(e,x.get(m.packKey(wn)),wn.x,wn.y,wn.z,s,l,w,S,z,h,c,d)),k=U(k,z,h,c);break}case 4:{0!=(f&1<<I)&&(p=pt[I],wn.set(n+p[0],a+p[1],r+p[2]),Y(e,x.get(m.packKey(wn)),wn.x,wn.y,wn.z,s,z,o,u,y,w,S,d)),k=U(k,y,w,S);break}case 5:{0!=(f&1<<I)&&(p=pt[I],wn.set(n+p[0],a+p[1],r+p[2]),Y(e,x.get(m.packKey(wn)),wn.x,wn.y,wn.z,s,z,o,S,y,w,c,d)),k=U(k,y,w,c);break}case 6:{0!=(f&1<<I)&&(p=pt[I],wn.set(n+p[0],a+p[1],r+p[2]),Y(e,x.get(m.packKey(wn)),wn.x,wn.y,wn.z,s,z,w,u,y,h,S,d)),k=U(k,y,h,S);break}case 7:{0!=(f&1<<I)&&(p=pt[I],wn.set(n+p[0],a+p[1],r+p[2]),Y(e,x.get(m.packKey(wn)),wn.x,wn.y,wn.z,s,z,w,S,y,h,c,d)),k=8;break}}while(8>k)}}function X(e,t,n,a,i){var r=l.min.set(0,0,0),s=l.max.subVectors(t.max,t.min),o=t.getDimensions(In.min),u=In.max.copy(o).multiplyScalar(.5),y=d.origin.copy(a.origin),h=d.direction.copy(a.direction),c,m,v,g,x,f,p,k,z;y.sub(t.getCenter(wn)).add(u),Tn=0,0>h.x&&(y.x=o.x-y.x,h.x=-h.x,Tn|=4),0>h.y&&(y.y=o.y-y.y,h.y=-h.y,Tn|=2),0>h.z&&(y.z=o.z-y.z,h.z=-h.z,Tn|=1),c=1/h.x,m=1/h.y,v=1/h.z,g=(r.x-y.x)*c,x=(s.x-y.x)*c,f=(r.y-y.y)*m,p=(s.y-y.y)*m,k=(r.z-y.z)*v,z=(s.z-y.z)*v,Y(e,t.octant,n.x,n.y,n.z,e.getDepth(),g,f,k,x,p,z,i)}function Z(e,t,n,a,r,s){var l,o,u,y,h,c,d;if(0<s){for(--s,l=e.getGrid(s),o=e.getKeyDesign(),u=t.children,n<<=1,a<<=1,r<<=1,d=0;8>d;++d)0!=(u&1<<d)&&(h=pt[d],An.set(n+h[0],a+h[1],r+h[2]),c=o.packKey(An),y=l.get(c),l["delete"](c),Z(e,y,An.x,An.y,An.z,s));t.children=0}}function _(e,t,n,a,r){var s,l,o,u;++r<e.levels&&(s=e.getGrid(r),l=En.calculateOffsetIndex(t,n,a),An.set(t>>>1,n>>>1,a>>>1),o=e.getKeyDesign().packKey(An),u=s.get(o),u.children&=~(1<<l),0===u.children&&(s["delete"](o),_(e,An.x,An.y,An.z,r)))}function K(e,t,n){var a=[-1,-1,-1,-1],r=[!1,!1,!1,!1],s=1/0,l=0,o=!1,u,y,h,c,d,m,v;for(v=0;4>v;++v)d=e[v],m=ra[t][v],u=kt[m][0],y=kt[m][1],h=1&d.voxel.materials>>u,c=1&d.voxel.materials>>y,d.size<s&&(s=d.size,l=v,o=h!==yt.AIR),a[v]=d.voxel.index,r[v]=h!==c;r[l]&&(o?(n.push(a[0]),n.push(a[3]),n.push(a[1]),n.push(a[0]),n.push(a[2]),n.push(a[3])):(n.push(a[0]),n.push(a[1]),n.push(a[3]),n.push(a[0]),n.push(a[3]),n.push(a[2])))}function G(e,t,n){var a=[0,0,0,0],r,s,l,o;if(null!==e[0].voxel&&null!==e[1].voxel&&null!==e[2].voxel&&null!==e[3].voxel)K(e,t,n);else for(l=0;2>l;++l){for(a[0]=ia[t][l][0],a[1]=ia[t][l][1],a[2]=ia[t][l][2],a[3]=ia[t][l][3],r=[],o=0;4>o;++o)if(s=e[o],null!==s.voxel)r[o]=s;else if(null!==s.children)r[o]=s.children[a[o]];else break;4===o&&G(r,ia[t][l][4],n)}}function H(e,t,n){var a=[0,0,0,0],r=[[0,0,1,1],[0,1,0,1]],s,l,o,u,y,h;if(null!==e[0].children||null!==e[1].children){for(y=0;4>y;++y)a[0]=na[t][y][0],a[1]=na[t][y][1],s=[null===e[0].children?e[0]:e[0].children[a[0]],null===e[1].children?e[1]:e[1].children[a[1]]],H(s,na[t][y][2],n);for(y=0;4>y;++y){for(a[0]=aa[t][y][1],a[1]=aa[t][y][2],a[2]=aa[t][y][3],a[3]=aa[t][y][4],o=r[aa[t][y][0]],l=[],h=0;4>h;++h)if(u=e[o[h]],null!==u.voxel)l[h]=u;else if(null!==u.children)l[h]=u.children[a[h]];else break;4===h&&G(l,aa[t][y][5],n)}}}function W(e,t){var n=e.children,a=[0,0,0,0],r,s,l;if(null!==n){for(l=0;8>l;++l)W(n[l],t);for(l=0;12>l;++l)a[0]=ea[l][0],a[1]=ea[l][1],r=[n[a[0]],n[a[1]]],H(r,ea[l][2],t);for(l=0;6>l;++l)a[0]=ta[l][0],a[1]=ta[l][1],a[2]=ta[l][2],a[3]=ta[l][3],s=[n[a[0]],n[a[1]],n[a[2]],n[a[3]]],G(s,ta[l][4],t)}}function Q(e,t,n,a){var r,s;if(null!==e.children)for(r=0;8>r;++r)a=Q(e.children[r],t,n,a);else null!==e.voxel&&(s=e.voxel,s.index=a,t[3*a]=s.position.x,t[3*a+1]=s.position.y,t[3*a+2]=s.position.z,n[3*a]=s.normal.x,n[3*a+1]=s.normal.y,n[3*a+2]=s.normal.z,++a);return a}function J(e,t){var n=e.elements,a=t.elements,i;0!==n[1]&&(i=ua.calculateCoefficients(n[0],n[1],n[3]),ya.rotateQXY(ma.set(n[0],n[3]),n[1],i),n[0]=ma.x,n[3]=ma.y,ya.rotateXY(ma.set(n[2],n[4]),i),n[2]=ma.x,n[4]=ma.y,n[1]=0,ya.rotateXY(ma.set(a[0],a[3]),i),a[0]=ma.x,a[3]=ma.y,ya.rotateXY(ma.set(a[1],a[4]),i),a[1]=ma.x,a[4]=ma.y,ya.rotateXY(ma.set(a[2],a[5]),i),a[2]=ma.x,a[5]=ma.y)}function $(e,t){var n=e.elements,a=t.elements,i;0!==n[2]&&(i=ua.calculateCoefficients(n[0],n[2],n[5]),ya.rotateQXY(ma.set(n[0],n[5]),n[2],i),n[0]=ma.x,n[5]=ma.y,ya.rotateXY(ma.set(n[1],n[4]),i),n[1]=ma.x,n[4]=ma.y,n[2]=0,ya.rotateXY(ma.set(a[0],a[6]),i),a[0]=ma.x,a[6]=ma.y,ya.rotateXY(ma.set(a[1],a[7]),i),a[1]=ma.x,a[7]=ma.y,ya.rotateXY(ma.set(a[2],a[8]),i),a[2]=ma.x,a[8]=ma.y)}function ee(e,t){var n=e.elements,a=t.elements,i;0!==n[4]&&(i=ua.calculateCoefficients(n[3],n[4],n[5]),ya.rotateQXY(ma.set(n[3],n[5]),n[4],i),n[3]=ma.x,n[5]=ma.y,ya.rotateXY(ma.set(n[1],n[2]),i),n[1]=ma.x,n[2]=ma.y,n[4]=0,ya.rotateXY(ma.set(a[3],a[6]),i),a[3]=ma.x,a[6]=ma.y,ya.rotateXY(ma.set(a[4],a[7]),i),a[4]=ma.x,a[7]=ma.y,ya.rotateXY(ma.set(a[5],a[8]),i),a[5]=ma.x,a[8]=ma.y)}function te(t,n){var a=t.elements,e;for(e=0;e<5;++e)J(t,n),$(t,n),ee(t,n);return va.set(a[0],a[3],a[5])}function ne(e){var t=Te(e)<ha?0:1/e;return Te(t)<ha?0:t}function ae(e,t){var n=e.elements,a=n[0],i=n[3],r=n[6],s=n[1],l=n[4],o=n[7],u=n[2],y=n[5],h=n[8],c=ne(t.x),d=ne(t.y),m=ne(t.z);return e.set(a*c*a+i*d*i+r*m*r,a*c*s+i*d*l+r*m*o,a*c*u+i*d*y+r*m*h,s*c*a+l*d*i+o*m*r,s*c*s+l*d*l+o*m*o,s*c*u+l*d*y+o*m*h,u*c*a+y*d*i+h*m*r,u*c*s+y*d*l+h*m*o,u*c*u+y*d*y+h*m*h)}function ie(e,t,n){return e.applyToVector3(xa.copy(n)),xa.subVectors(t,xa),xa.dot(xa)}function re(e,t,a,r,s){var l=0;for(t>>=1;0<t;t>>=1,l=0)a>=t&&(l+=4,a-=t),r>=t&&(l+=2,r-=t),s>=t&&(l+=1,s-=t),null===e.children&&e.split(),e=e.children[l];return e}function se(e,t,n,a,r){var s=e+1,l=new ka,o,u,y,h,c,d,m,v,g,x;for(o=0,x=0;8>x;++x)h=pt[x],c=(a+h[2])*(s*s)+(n+h[1])*s+(t+h[0]),y=Ae(r[c],yt.SOLID),o|=y<<x;for(u=0,x=0;12>x;++x)d=kt[x][0],m=kt[x][1],v=1&o>>d,g=1&o>>m,v!==g&&++u;return l.materials=o,l.edgeCount=u,l.qefData=new pa,l}function le(e){var t=Ta,a=Xt.resolution,n=new Re(0,0,0),i=new Re(a,a,a),r=new j(Ca,Ca.clone().addScalar(Ta)),s=e.getBoundingBox();return e.type!==Le.INTERSECTION&&(s.intersectsBox(r)?(n.copy(s.min).max(r.min).sub(r.min),n.x=be(n.x*a/t),n.y=be(n.y*a/t),n.z=be(n.z*a/t),i.copy(s.max).min(r.max).sub(r.min),i.x=Ie(i.x*a/t),i.y=Ie(i.y*a/t),i.z=Ie(i.z*a/t)):(n.set(a,a,a),i.set(0,0,0))),new j(n,i)}function oe(e,t,a,i){var r=Xt.resolution,n=r+1,s=i.max.x,l=i.max.y,o=i.max.z,u,h,c;for(c=i.min.z;c<=o;++c)for(h=i.min.y;h<=l;++h)for(u=i.min.x;u<=s;++u)e.updateMaterialIndex(c*(n*n)+h*n+u,t,a)}function ue(e,t,a){var i=Ta,r=Xt.resolution,n=r+1,s=t.materialIndices,l=new Re,o=new Re,u=a.max.x,h=a.max.y,c=a.max.z,d=0,m,v,g,f;for(f=a.min.z;f<=c;++f)for(l.z=f*i/r,g=a.min.y;g<=h;++g)for(l.y=g*i/r,v=a.min.x;v<=u;++v)l.x=v*i/r,m=e.generateMaterialIndex(o.addVectors(Ca,l)),m!==yt.AIR&&(s[f*(n*n)+g*n+v]=m,++d);t.materials=d}function ye(e,t,a){var r=Xt.resolution,n=r+1,s=new Uint32Array([1,n,n*n]),l=t.materialIndices,o=new Mt,u=new Mt,y=a.edgeData,h=t.edgeData,m=new Uint32Array(3),v=Nt.calculate1DEdgeCount(r),g=new Nt(r,Ae(v,h.indices[0].length+y.indices[0].length),Ae(v,h.indices[1].length+y.indices[1].length),Ae(v,h.indices[2].length+y.indices[2].length)),x,f,p,k,z,w,S,I,b,T,C,A,E,P,D,F,O,M,B,L,R,V,N;for(M=0,B=0;3>B;M=0,++B){for(x=y.indices[B],k=h.indices[B],S=g.indices[B],f=y.zeroCrossings[B],z=h.zeroCrossings[B],I=g.zeroCrossings[B],p=y.normals[B],w=h.normals[B],b=g.normals[B],T=s[B],V=x.length,N=k.length,(L=0,R=0);L<V;++L)if(C=x[L],A=C+T,D=l[C],F=l[A],D!==F&&(D===yt.AIR||F===yt.AIR)){for(o.t=f[L],o.n.x=p[3*L],o.n.y=p[3*L+1],o.n.z=p[3*L+2],e.type===Le.DIFFERENCE&&o.n.negate(),O=o;R<N&&k[R]<=C;)E=k[R],P=E+T,u.t=z[R],u.n.x=w[3*R],u.n.y=w[3*R+1],u.n.z=w[3*R+2],D=l[E],E<C?(F=l[P],D!==F&&(D===yt.AIR||F===yt.AIR)&&(S[M]=E,I[M]=u.t,b[3*M]=u.n.x,b[3*M+1]=u.n.y,b[3*M+2]=u.n.z,++M)):O=e.selectEdge(u,o,D===yt.SOLID),++R;S[M]=C,I[M]=O.t,b[3*M]=O.n.x,b[3*M+1]=O.n.y,b[3*M+2]=O.n.z,++M}for(;R<N;)E=k[R],P=E+T,D=l[E],F=l[P],D!==F&&(D===yt.AIR||F===yt.AIR)&&(S[M]=E,I[M]=z[R],b[3*M]=w[3*R],b[3*M+1]=w[3*R+1],b[3*M+2]=w[3*R+2],++M),++R;m[B]=M}return{edgeData:g,lengths:m}}function he(e,t,i){var r=Ta,s=Xt.resolution,n=s+1,l=n*n,o=new Uint32Array([1,n,l]),u=t.materialIndices,h=Ca,m=new Re,v=new Re,g=new Mt,f=new Uint32Array(3),p=new Nt(s,Nt.calculate1DEdgeCount(s)),k,w,S,I,b,T,C,A,E,P,D,F,O,M,B,L,R,V,N;for(B=4,O=0,M=0;3>M;B>>=1,O=0,++M){L=pt[B],k=p.indices[M],w=p.zeroCrossings[M],S=p.normals[M],I=o[M],C=i.min.x,P=i.max.x,A=i.min.y,D=i.max.y,E=i.min.z,F=i.max.z;for(0===M?(C=Ce(C-1,0),P=Ae(P,s-1)):1===M?(A=Ce(A-1,0),D=Ae(D,s-1)):2===M?(E=Ce(E-1,0),F=Ae(F,s-1)):void 0,N=E;N<=F;++N)for(V=A;V<=D;++V)for(R=C;R<=P;++R)b=N*l+V*n+R,T=b+I,u[b]!==u[T]&&(m.set(R*r/s,V*r/s,N*r/s),v.set((R+L[0])*r/s,(V+L[1])*r/s,(N+L[2])*r/s),g.a.addVectors(h,m),g.b.addVectors(h,v),e.generateEdge(g),k[O]=b,w[O]=g.t,S[3*O]=g.n.x,S[3*O+1]=g.n.y,S[3*O+2]=g.n.z,++O);f[M]=O}return{edgeData:p,lengths:f}}function ce(e,t,n){var a=le(e),i=!1,r,s,l,o;if(e.type===Le.DENSITY_FUNCTION?ue(e,t,a):t.empty?e.type===Le.UNION&&(t.set(n),i=!0):!(t.full&&e.type===Le.UNION)&&oe(e,t,n,a),!i&&!t.empty&&!t.full){for(r=e.type===Le.DENSITY_FUNCTION?he(e,t,a):ye(e,t,n),s=r.edgeData,l=r.lengths,o=0;3>o;++o)s.indices[o]=s.indices[o].slice(0,l[o]),s.zeroCrossings[o]=s.zeroCrossings[o].slice(0,l[o]),s.normals[o]=s.normals[o].slice(0,3*l[o]);t.edgeData=s}}function de(e){var t=e.children,n,a,r,s;for(e.type===Le.DENSITY_FUNCTION&&(n=new Xt,ce(e,n)),r=0,s=t.length;r<s&&(a=de(t[r]),void 0===n?n=a:null===a?e.type===Le.INTERSECTION&&(n=null):null===n?e.type===Le.UNION&&(n=a):ce(e,n,a),null!==n||e.type===Le.UNION);++r);return null!==n&&n.empty?null:n}var Ee=function(){function e(){t(this,e)}return i(e,[{key:"serialize",value:function(){}}]),e}(),Pe=function(){function e(){t(this,e)}return i(e,[{key:"deserialize",value:function(){}}]),e}(),De=function(){function e(){t(this,e)}return i(e,[{key:"dispose",value:function(){}}]),e}(),Fe=function(){function e(){t(this,e)}return i(e,[{key:"createTransferList",value:function(){}}]),e}(),Oe=function(){function e(){t(this,e),this.elements=[],this.head=0}return i(e,[{key:"copy",value:function(e){return this.elements=Array.from(e.elements),this.head=e.head,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"add",value:function(e){this.elements.push(e)}},{key:"peek",value:function(){return 0<this.elements.length?this.elements[this.head]:void 0}},{key:"poll",value:function(){var e=this.elements,t=e.length,n;return 0<t&&(n=e[this.head++],2*this.head>=t&&(this.elements=e.slice(this.head),this.head=0)),n}},{key:"clear",value:function(){this.elements=[],this.head=0}},{key:"size",get:function(){return this.elements.length-this.head}},{key:"empty",get:function(){return 0===this.elements.length}}]),e}(),Me=function e(n){t(this,e),this.type=n,this.target=null},Be=function(){function e(){t(this,e),this.listenerFunctions=new Map,this.listenerObjects=new Map}return i(e,[{key:"addEventListener",value:function(e,t){var n="function"==typeof t?this.listenerFunctions:this.listenerObjects;n.has(e)?n.get(e).add(t):n.set(e,new Set([t]))}},{key:"removeEventListener",value:function(e,t){var n="function"==typeof t?this.listenerFunctions:this.listenerObjects;if(n.has(e)){var a=n.get(e);a["delete"](t),0===a.size&&n["delete"](e)}}},{key:"dispatchEvent",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this,n=t.listenerFunctions,a=t.listenerObjects,i,r;if(e.target=t,n.has(e.type)){i=n.get(e.type);var s=!0,l=!1,o=void 0;try{for(var u=i[Symbol.iterator](),y;!(s=(y=u.next()).done);s=!0)r=y.value,r.call(t,e)}catch(e){l=!0,o=e}finally{try{s||null==u["return"]||u["return"]()}finally{if(l)throw o}}}if(a.has(e.type)){i=a.get(e.type);var h=!0,c=!1,d=void 0;try{for(var m=i[Symbol.iterator](),v;!(h=(v=m.next()).done);h=!0)r=v.value,r.handleEvent(e)}catch(e){c=!0,d=e}finally{try{h||null==m["return"]||m["return"]()}finally{if(c)throw d}}}}}]),e}(),Le={UNION:"csg.union",DIFFERENCE:"csg.difference",INTERSECTION:"csg.intersection",DENSITY_FUNCTION:"csg.densityfunction"},Re=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.x=n,this.y=a,this.z=i}return i(e,[{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"setFromSpherical",value:function(e){this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var a=Se(t)*e;return this.x=a*Se(n),this.y=we(t)*e,this.z=a*we(n),this}},{key:"setFromCylindrical",value:function(e){this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this.x=e*Se(t),this.y=n,this.z=e*we(t),this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),a=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=a,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this}},{key:"crossVectors",value:function(e,t){var n=e.x,a=e.y,i=e.z,r=t.x,s=t.y,l=t.z;return this.x=a*l-i*s,this.y=i*r-n*l,this.z=n*s-a*r,this}},{key:"cross",value:function(e){return this.crossVectors(this,e)}},{key:"transformDirection",value:function(t){var n=this.x,a=this.y,i=this.z,r=t.elements;return this.x=r[0]*n+r[4]*a+r[8]*i,this.y=r[1]*n+r[5]*a+r[9]*i,this.z=r[2]*n+r[6]*a+r[10]*i,this.normalize()}},{key:"applyMatrix3",value:function(t){var n=this.x,a=this.y,i=this.z,r=t.elements;return this.x=r[0]*n+r[3]*a+r[6]*i,this.y=r[1]*n+r[4]*a+r[7]*i,this.z=r[2]*n+r[5]*a+r[8]*i,this}},{key:"applyMatrix4",value:function(t){var n=this.x,a=this.y,i=this.z,r=t.elements;return this.x=r[0]*n+r[4]*a+r[8]*i+r[12],this.y=r[1]*n+r[5]*a+r[9]*i+r[13],this.z=r[2]*n+r[6]*a+r[10]*i+r[14],this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,a=this.z,i=e.x,r=e.y,s=e.z,l=e.w,o=l*t+r*a-s*n,u=l*n+s*t-i*a,y=l*a+i*n-r*t,h=-i*t-r*n-s*a;return this.x=o*l+h*-i+u*-s-y*-r,this.y=u*l+h*-r+y*-i-o*-s,this.z=y*l+h*-s+o*-r-u*-i,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"reflect",value:function(e){var t=e.x,n=e.y,a=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(t,n,a),this}},{key:"angleTo",value:function(e){var t=this.dot(e)/ze(this.lengthSquared()*e.lengthSquared());return ke(Ae(Ce(t,-1),1))}},{key:"manhattanLength",value:function(){return Te(this.x)+Te(this.y)+Te(this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return ze(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanDistanceTo",value:function(e){return Te(this.x-e.x)+Te(this.y-e.y)+Te(this.z-e.z)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,a=this.z-e.z;return t*t+n*n+a*a}},{key:"distanceTo",value:function(e){return ze(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=Ae(this.x,e.x),this.y=Ae(this.y,e.y),this.z=Ae(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Ce(this.x,e.x),this.y=Ce(this.y,e.y),this.z=Ce(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Ce(e.x,Ae(t.x,this.x)),this.y=Ce(e.y,Ae(t.y,this.y)),this.z=Ce(e.z,Ae(t.z,this.z)),this}},{key:"floor",value:function(){return this.x=Ie(this.x),this.y=Ie(this.y),this.z=Ie(this.z),this}},{key:"ceil",value:function(){return this.x=be(this.x),this.y=be(this.y),this.z=be(this.z),this}},{key:"round",value:function(){return this.x=pe(this.x),this.y=pe(this.y),this.z=pe(this.z),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}]),e}(),Ve=new Re,v=[new Re,new Re,new Re,new Re,new Re,new Re,new Re,new Re],j=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re(1/0,1/0,1/0),a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Re(-Infinity,-Infinity,-Infinity);t(this,e),this.min=n,this.max=a}return i(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-Infinity,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"setFromSphere",value:function(e){return this.set(e.center,e.center),this.expandByScalar(e.radius),this}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"setFromPoints",value:function(e){var t,n;for(this.min.set(0,0,0),this.max.set(0,0,0),(t=0,n=e.length);t<n;++t)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=Ve.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Re;return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){var t=Ve.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:"applyMatrix4",value:function(e){var t=this.min,n=this.max;return this.isEmpty()||(v[0].set(t.x,t.y,t.z).applyMatrix4(e),v[1].set(t.x,t.y,n.z).applyMatrix4(e),v[2].set(t.x,n.y,t.z).applyMatrix4(e),v[3].set(t.x,n.y,n.z).applyMatrix4(e),v[4].set(n.x,t.y,t.z).applyMatrix4(e),v[5].set(n.x,t.y,n.z).applyMatrix4(e),v[6].set(n.x,n.y,t.z).applyMatrix4(e),v[7].set(n.x,n.y,n.z).applyMatrix4(e),this.setFromPoints(v)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"containsPoint",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=n.x&&e.y<=n.y&&e.z<=n.z}},{key:"containsBox",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return t.x<=a.x&&i.x<=n.x&&t.y<=a.y&&i.y<=n.y&&t.z<=a.z&&i.z<=n.z}},{key:"intersectsBox",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&i.z>=t.z&&a.x<=n.x&&a.y<=n.y&&a.z<=n.z}},{key:"intersectsSphere",value:function(e){var t=this.clampPoint(e.center,Ve);return t.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return 0<e.normal.x?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),Ne=new j,Ue=new Re,Ye=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.center=n,this.radius=a}return i(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"setFromPoints",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Ne.setFromPoints(e).getCenter(this.center),n=0,a,r;for(a=0,r=e.length;a<r;++a)n=Ce(n,t.distanceToSquared(e[a]));return this.radius=ze(n),this}},{key:"setFromBox",value:function(e){return e.getCenter(this.center),this.radius=.5*e.getSize(Ue).length(),this}},{key:"isEmpty",value:function(){return 0>=this.radius}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Re,n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Te(e.distanceToPoint(this.center))<=this.radius}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}]),e}(),qe=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.x=n,this.y=a}return i(e,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this}},{key:"applyMatrix3",value:function(t){var n=this.x,a=this.y,i=t.elements;return this.x=i[0]*n+i[3]*a+i[6],this.y=i[1]*n+i[4]*a+i[7],this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"manhattanLength",value:function(){return Te(this.x)+Te(this.y)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return ze(this.x*this.x+this.y*this.y)}},{key:"manhattanDistanceTo",value:function(e){return Te(this.x-e.x)+Te(this.y-e.y)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"distanceTo",value:function(e){return ze(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=Ae(this.x,e.x),this.y=Ae(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Ce(this.x,e.x),this.y=Ce(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Ce(e.x,Ae(t.x,this.x)),this.y=Ce(e.y,Ae(t.y,this.y)),this}},{key:"floor",value:function(){return this.x=Ie(this.x),this.y=Ie(this.y),this}},{key:"ceil",value:function(){return this.x=be(this.x),this.y=be(this.y),this}},{key:"round",value:function(){return this.x=pe(this.x),this.y=pe(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"angle",value:function e(){var e=fe(this.y,this.x);return 0>e&&(e+=2*xe),e}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:"rotateAround",value:function(e,t){var n=we(t),a=Se(t),i=this.x-e.x,r=this.y-e.y;return this.x=i*n-r*a+e.x,this.y=i*a+r*n+e.y,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"width",get:function(){return this.x},set:function(e){return this.x=e}},{key:"height",get:function(){return this.y},set:function(e){return this.y=e}}]),e}(),Xe=new qe,Ze=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new qe(1/0,1/0),a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new qe(-Infinity,-Infinity);t(this,e),this.min=n,this.max=a}return i(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-Infinity,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new qe;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new qe;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Ye;return this.getCenter(e.center),e.radius=.5*this.getSize(Xe).length(),e}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"setFromPoints",value:function(e){var t,n;for(this.min.set(0,0),this.max.set(0,0),(t=0,n=e.length);t<n;++t)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=Xe.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new qe;return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){var t=Xe.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"containsPoint",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.x<=n.x&&e.y<=n.y}},{key:"containsBox",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return t.x<=a.x&&i.x<=n.x&&t.y<=a.y&&i.y<=n.y}},{key:"intersectsBox",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&a.x<=n.x&&a.y<=n.y}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),_e=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.radius=n,this.theta=a,this.y=i}return i(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=ze(e*e+n*n),this.theta=fe(e,n),this.y=t,this}}]),e}(),je=function(){function e(){t(this,e),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return i(e,[{key:"set",value:function(e,t,n,a,i,r,s,l,o){var u=this.elements;return u[0]=e,u[3]=t,u[6]=n,u[1]=a,u[4]=i,u[7]=r,u[2]=s,u[5]=l,u[8]=o,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=e.elements,n=this.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],this}},{key:"clone",value:function(){return new this.constructor().fromArray(this.elements)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a;for(a=0;9>a;++a)n[a]=e[a+t];return this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a;for(a=0;9>a;++a)e[a+t]=n[a];return e}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,a=t.elements,i=this.elements,r=n[0],s=n[3],l=n[6],o=n[1],u=n[4],y=n[7],h=n[2],c=n[5],d=n[8],m=a[0],v=a[3],g=a[6],x=a[1],f=a[4],p=a[7],k=a[2],z=a[5],w=a[8];return i[0]=r*m+s*x+l*k,i[3]=r*v+s*f+l*z,i[6]=r*g+s*p+l*w,i[1]=o*m+u*x+y*k,i[4]=o*v+u*f+y*z,i[7]=o*g+u*p+y*w,i[2]=h*m+c*x+d*k,i[5]=h*v+c*f+d*z,i[8]=h*g+c*p+d*w,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var t=this.elements,n=t[0],a=t[1],r=t[2],s=t[3],l=t[4],e=t[5],o=t[6],u=t[7],y=t[8];return n*l*y-n*e*u-a*s*y+a*e*o+r*s*u-r*l*o}},{key:"getInverse",value:function(e){var t=e.elements,n=this.elements,a=t[0],i=t[1],r=t[2],s=t[3],l=t[4],o=t[5],u=t[6],y=t[7],h=t[8],c=h*l-o*y,d=o*u-h*s,m=y*s-l*u,v=a*c+i*d+r*m,g;return 0===v?(console.error("Can't invert matrix, determinant is zero",e),this.identity()):(g=1/v,n[0]=c*g,n[1]=(r*y-h*i)*g,n[2]=(o*i-r*l)*g,n[3]=d*g,n[4]=(h*a-r*u)*g,n[5]=(r*s-o*a)*g,n[6]=m*g,n[7]=(i*u-y*a)*g,n[8]=(l*a-i*s)*g),this}},{key:"transpose",value:function(){var e=this.elements,n;return n=e[1],e[1]=e[3],e[3]=n,n=e[2],e[2]=e[6],e[6]=n,n=e[5],e[5]=e[7],e[7]=n,this}},{key:"scale",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:"rotate",value:function(e){var t=we(e),n=Se(e),a=this.elements,i=a[0],r=a[3],s=a[6],l=a[1],o=a[4],u=a[7];return a[0]=t*i+n*l,a[3]=t*r+n*o,a[6]=t*s+n*u,a[1]=-n*i+t*l,a[4]=-n*r+t*o,a[7]=-n*s+t*u,this}},{key:"translate",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:"equals",value:function(e){var t=this.elements,n=e.elements,a=!0,r;for(r=0;a&&9>r;++r)t[r]!==n[r]&&(a=!1);return a}}]),e}(),Ke={XYZ:"XYZ",YZX:"YZX",ZXY:"ZXY",XZY:"XZY",YXZ:"YXZ",ZYX:"ZYX"},Ge=function(){var n=Number.EPSILON;function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;t(this,e),this.x=n,this.y=a,this.z=i,this.w=r}return i(e,[{key:"set",value:function(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.w=a,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"setFromEuler",value:function(e){var t=e.x,n=e.y,a=e.z,i=we,r=Se,s=i(t/2),l=i(n/2),o=i(a/2),u=r(t/2),y=r(n/2),h=r(a/2);switch(e.order){case Ke.XYZ:this.x=u*l*o+s*y*h,this.y=s*y*o-u*l*h,this.z=s*l*h+u*y*o,this.w=s*l*o-u*y*h;break;case Ke.YXZ:this.x=u*l*o+s*y*h,this.y=s*y*o-u*l*h,this.z=s*l*h-u*y*o,this.w=s*l*o+u*y*h;break;case Ke.ZXY:this.x=u*l*o-s*y*h,this.y=s*y*o+u*l*h,this.z=s*l*h+u*y*o,this.w=s*l*o-u*y*h;break;case Ke.ZYX:this.x=u*l*o-s*y*h,this.y=s*y*o+u*l*h,this.z=s*l*h-u*y*o,this.w=s*l*o+u*y*h;break;case Ke.YZX:this.x=u*l*o+s*y*h,this.y=s*y*o+u*l*h,this.z=s*l*h-u*y*o,this.w=s*l*o-u*y*h;break;case Ke.XZY:this.x=u*l*o-s*y*h,this.y=s*y*o-u*l*h,this.z=s*l*h+u*y*o,this.w=s*l*o+u*y*h;}return this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,a=Se(n);return this.x=e.x*a,this.y=e.y*a,this.z=e.z*a,this.w=we(n),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],a=t[4],i=t[8],r=t[1],l=t[5],o=t[9],u=t[2],y=t[6],h=t[10],c=n+l+h,d;return 0<c?(d=.5/ze(c+1),this.w=.25/d,this.x=(y-o)*d,this.y=(i-u)*d,this.z=(r-a)*d):n>l&&n>h?(d=2*ze(1+n-l-h),this.w=(y-o)/d,this.x=.25*d,this.y=(a+r)/d,this.z=(i+u)/d):l>h?(d=2*ze(1+l-n-h),this.w=(i-u)/d,this.x=(a+r)/d,this.y=.25*d,this.z=(o+y)/d):(d=2*ze(1+h-n-l),this.w=(r-a)/d,this.x=(i+u)/d,this.y=(o+y)/d,this.z=.25*d),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return 1e-6>n?(n=0,Te(e.x)>Te(e.z)?(this.x=-e.y,this.y=e.x,this.z=0,this.w=n):(this.x=0,this.y=-e.z,this.z=e.y,this.w=n)):(this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this.w=n),this.normalize()}},{key:"angleTo",value:function(e){return 2*ke(Te(Ae(Ce(this.dot(e),-1),1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);return 0!==n&&this.slerp(e,Ae(1,t/n)),this}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return ze(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"normalize",value:function(){var e=this.length(),t;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/e,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"multiplyQuaternions",value:function(e,t){var n=e.x,a=e.y,i=e.z,r=e.w,s=t.x,l=t.y,o=t.z,u=t.w;return this.x=n*u+r*s+a*o-i*l,this.y=a*u+r*l+i*s-n*o,this.z=i*u+r*o+n*l-a*s,this.w=r*u-n*s-a*l-i*o,this}},{key:"multiply",value:function(e){return this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"slerp",value:function(e,a){var t=this.x,i=this.y,r=this.z,l=this.w,o,u,y,h,c,d,m;return 1===a?this.copy(e):0<a&&(o=l*e.w+t*e.x+i*e.y+r*e.z,0>o?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,o=-o):this.copy(e),1<=o?(this.w=l,this.x=t,this.y=i,this.z=r):(u=1-o*o,c=1-a,u<=n?(this.w=c*l+a*this.w,this.x=c*t+a*this.x,this.y=c*i+a*this.y,this.z=c*r+a*this.z,this.normalize()):(y=ze(u),h=fe(y,o),d=Se(c*h)/y,m=Se(a*h)/y,this.w=l*d+this.w*m,this.x=t*d+this.x*m,this.y=i*d+this.y*m,this.z=r*d+this.z*m))),this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}],[{key:"slerp",value:function(e,n,a,i){return a.copy(e).slerp(n,i)}},{key:"slerpFlat",value:function(e,a,i,r,l,o,u){var y=l[o],h=l[o+1],c=l[o+2],d=l[o+3],m=i[r],v=i[r+1],g=i[r+2],x=i[r+3],p,k,z,w,S,I,b,T;(x!==d||m!==y||v!==h||g!==c)&&(p=1-u,w=m*y+v*h+g*c+x*d,I=0<=w?1:-1,S=1-w*w,S>n&&(z=ze(S),b=fe(z,w*I),p=Se(p*b)/z,u=Se(u*b)/z),T=u*I,m=m*p+y*T,v=v*p+h*T,g=g*p+c*T,x=x*p+d*T,p===1-u&&(k=1/ze(m*m+v*v+g*g+x*x),m*=k,v*=k,g*=k,x*=k)),e[a]=m,e[a+1]=v,e[a+2]=g,e[a+3]=x}}]),e}(),He=new je,m=new Ge,q=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.x=n,this.y=a,this.z=i,this.order=e.defaultOrder}return i(e,[{key:"set",value:function(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.order=a,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.order=e[t+3],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.order,e}},{key:"toVector3",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re;return e.set(this.x,this.y,this.z)}},{key:"setFromRotationMatrix",value:function(e){var t=Math.asin,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order,a=e.elements,i=a[0],r=a[4],s=a[8],l=a[1],o=a[5],u=a[9],y=a[2],h=a[6],c=a[10],d=1-1e-5;switch(n){case Ke.XYZ:{this.y=t(P(s,-1,1)),Te(s)<d?(this.x=fe(-u,c),this.z=fe(-r,i)):(this.x=fe(h,o),this.z=0);break}case Ke.YXZ:{this.x=t(-P(u,-1,1)),Te(u)<d?(this.y=fe(s,c),this.z=fe(l,o)):(this.y=fe(-y,i),this.z=0);break}case Ke.ZXY:{this.x=t(P(h,-1,1)),Te(h)<d?(this.y=fe(-y,c),this.z=fe(-r,o)):(this.y=0,this.z=fe(l,i));break}case Ke.ZYX:{this.y=t(-P(y,-1,1)),Te(y)<d?(this.x=fe(h,c),this.z=fe(l,i)):(this.x=0,this.z=fe(-r,o));break}case Ke.YZX:{this.z=t(P(l,-1,1)),Te(l)<d?(this.x=fe(-u,o),this.y=fe(-y,i)):(this.x=0,this.y=fe(s,c));break}case Ke.XZY:{this.z=t(-P(r,-1,1)),Te(r)<d?(this.x=fe(h,o),this.y=fe(s,i)):(this.x=fe(-u,c),this.y=0);break}}return this.order=n,this}},{key:"setFromQuaternion",value:function(e,t){return He.makeRotationFromQuaternion(e),this.setFromRotationMatrix(He,t)}},{key:"setFromVector3",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return m.setFromEuler(this),this.setFromQuaternion(m,e)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order}}],[{key:"defaultOrder",get:function(){return Ke.XYZ}}]),e}(),We=new Re,a=new Re,b=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re(1,0,0),a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.normal=n,this.constant=a}return i(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,a){return this.normal.set(e,t,n),this.constant=a,this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var i=We.subVectors(n,t).cross(a.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,We),this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"intersectLine",value:function(e,n){var a=e.delta(We),i=this.normal.dot(a);if(0===i)0===this.distanceToPoint(e.start)&&n.copy(e.start);else{var r=-(e.start.dot(this.normal)+this.constant)/i;0<=r&&1>=r&&n.copy(a).multiplyScalar(r).add(e.start)}return n}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return 0>t&&0<n||0>n&&0<t}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}]),e}(),Qe=new Re,Je=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new b,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new b,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new b,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new b,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new b,l=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new b;t(this,e),this.planes=[n,a,i,r,s,l]}return i(e,[{key:"set",value:function(e,t,n,a,i,r){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(a),s[4].copy(i),s[5].copy(r),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"copy",value:function(e){var t=this.planes,n;for(n=0;6>n;++n)t[n].copy(e.planes[n]);return this}},{key:"setFromMatrix",value:function(e){var t=this.planes,n=e.elements,a=n[0],i=n[1],r=n[2],s=n[3],l=n[4],o=n[5],u=n[6],y=n[7],h=n[8],c=n[9],d=n[10],m=n[11],v=n[12],g=n[13],x=n[14],f=n[15];return t[0].setComponents(s-a,y-l,m-h,f-v).normalize(),t[1].setComponents(s+a,y+l,m+h,f+v).normalize(),t[2].setComponents(s+i,y+o,m+c,f+g).normalize(),t[3].setComponents(s-i,y-o,m-c,f-g).normalize(),t[4].setComponents(s-r,y-u,m-d,f-x).normalize(),t[5].setComponents(s+r,y+u,m+d,f+x).normalize(),this}},{key:"intersectsSphere",value:function(e){var t=this.planes,n=e.center,a=-e.radius,r=!0,s,l;for(s=0;6>s;++s)if(l=t[s].distanceToPoint(n),l<a){r=!1;break}return r}},{key:"intersectsBox",value:function(e){var t=this.planes,n=e.min,a=e.max,r,s;for(r=0;6>r;++r)if(s=t[r],Qe.x=0<s.normal.x?a.x:n.x,Qe.y=0<s.normal.y?a.y:n.y,Qe.z=0<s.normal.z?a.z:n.z,0>s.distanceToPoint(Qe))return!1;return!0}},{key:"containsPoint",value:function(e){var t=this.planes,n=!0,a;for(a=0;6>a;++a)if(0>t[a].distanceToPoint(e)){n=!1;break}return n}}]),e}(),$e=new Re,et=new Re,tt=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Re;t(this,e),this.start=n,this.end=a}return i(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re;return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re;return e.subVectors(this.end,this.start)}},{key:"lengthSquared",value:function(){return this.start.distanceToSquared(this.end)}},{key:"length",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,n){$e.subVectors(e,this.start),et.subVectors(this.end,this.start);var a=et.dot(et),i=et.dot($e),r=n?Ae(Ce(i/a,0),1):i/a;return r}},{key:"closestPointToPoint",value:function(e){var n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Re,i=this.closestPointToPointParameter(e,n);return this.delta(a).multiplyScalar(i).add(this.start)}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}]),e}(),nt=new Re,at=new Re,it=new Re,c=function(){function e(){t(this,e),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return i(e,[{key:"set",value:function(e,t,n,a,i,r,s,l,o,u,y,h,c,d,m,v){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=a,g[1]=i,g[5]=r,g[9]=s,g[13]=l,g[2]=o,g[6]=u,g[10]=y,g[14]=h,g[3]=c,g[7]=d,g[11]=m,g[15]=v,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"copy",value:function(e){var t=e.elements,n=this.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],this}},{key:"clone",value:function(){return new this.constructor().fromArray(this.elements)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a;for(a=0;16>a;++a)n[a]=e[a+t];return this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a;for(a=0;16>a;++a)e[a+t]=n[a];return e}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],a=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return ze(Ce(t,n,a))}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setPosition",value:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,a=1/nt.setFromMatrixColumn(e,0).length(),i=1/nt.setFromMatrixColumn(e,1).length(),r=1/nt.setFromMatrixColumn(e,2).length();return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*r,t[9]=n[9]*r,t[10]=n[10]*r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(t){var n=this.elements,i=t.x,r=t.y,s=t.z,l=we(i),a=Se(i),o=we(r),u=Se(r),y=we(s),e=Se(s),h,c,d,m,v,g,x,f,p,k,z,w;switch(t.order){case Ke.XYZ:{h=l*y,c=l*e,d=a*y,m=a*e,n[0]=o*y,n[4]=-o*e,n[8]=u,n[1]=c+d*u,n[5]=h-m*u,n[9]=-a*o,n[2]=m-h*u,n[6]=d+c*u,n[10]=l*o;break}case Ke.YXZ:{v=o*y,g=o*e,x=u*y,f=u*e,n[0]=v+f*a,n[4]=x*a-g,n[8]=l*u,n[1]=l*e,n[5]=l*y,n[9]=-a,n[2]=g*a-x,n[6]=f+v*a,n[10]=l*o;break}case Ke.ZXY:{v=o*y,g=o*e,x=u*y,f=u*e,n[0]=v-f*a,n[4]=-l*e,n[8]=x+g*a,n[1]=g+x*a,n[5]=l*y,n[9]=f-v*a,n[2]=-l*u,n[6]=a,n[10]=l*o;break}case Ke.ZYX:{h=l*y,c=l*e,d=a*y,m=a*e,n[0]=o*y,n[4]=d*u-c,n[8]=h*u+m,n[1]=o*e,n[5]=m*u+h,n[9]=c*u-d,n[2]=-u,n[6]=a*o,n[10]=l*o;break}case Ke.YZX:{p=l*o,k=l*u,z=a*o,w=a*u,n[0]=o*y,n[4]=w-p*e,n[8]=z*e+k,n[1]=e,n[5]=l*y,n[9]=-a*y,n[2]=-u*y,n[6]=k*e+z,n[10]=p-w*e;break}case Ke.XZY:{p=l*o,k=l*u,z=a*o,w=a*u,n[0]=o*y,n[4]=-e,n[8]=u*y,n[1]=p*e+w,n[5]=l*y,n[9]=k*e-z,n[2]=z*e-k,n[6]=a*y,n[10]=w*e+p;break}}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(nt.set(0,0,0),e,at.set(1,1,1))}},{key:"lookAt",value:function(e,t,n){var a=this.elements,i=nt,r=at,s=it;return s.subVectors(e,t),0===s.lengthSquared()&&(s.z=1),s.normalize(),i.crossVectors(n,s),0===i.lengthSquared()&&(1===Te(n.z)?s.x+=1e-4:s.z+=1e-4,s.normalize(),i.crossVectors(n,s)),i.normalize(),r.crossVectors(s,i),a[0]=i.x,a[4]=r.x,a[8]=s.x,a[1]=i.y,a[5]=r.y,a[9]=s.y,a[2]=i.z,a[6]=r.z,a[10]=s.z,this}},{key:"multiplyMatrices",value:function(e,t){var n=this.elements,a=e.elements,i=t.elements,r=a[0],s=a[4],l=a[8],o=a[12],u=a[1],y=a[5],h=a[9],c=a[13],d=a[2],m=a[6],v=a[10],g=a[14],x=a[3],f=a[7],p=a[11],k=a[15],z=i[0],w=i[4],S=i[8],I=i[12],b=i[1],T=i[5],C=i[9],A=i[13],E=i[2],P=i[6],D=i[10],F=i[14],O=i[3],M=i[7],B=i[11],L=i[15];return n[0]=r*z+s*b+l*E+o*O,n[4]=r*w+s*T+l*P+o*M,n[8]=r*S+s*C+l*D+o*B,n[12]=r*I+s*A+l*F+o*L,n[1]=u*z+y*b+h*E+c*O,n[5]=u*w+y*T+h*P+c*M,n[9]=u*S+y*C+h*D+c*B,n[13]=u*I+y*A+h*F+c*L,n[2]=d*z+m*b+v*E+g*O,n[6]=d*w+m*T+v*P+g*M,n[10]=d*S+m*C+v*D+g*B,n[14]=d*I+m*A+v*F+g*L,n[3]=x*z+f*b+p*E+k*O,n[7]=x*w+f*T+p*P+k*M,n[11]=x*S+f*C+p*D+k*B,n[15]=x*I+f*A+p*F+k*L,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],a=e[8],i=e[12],r=e[1],s=e[5],l=e[9],o=e[13],u=e[2],y=e[6],h=e[10],c=e[14],d=e[3],m=e[7],v=e[11],g=e[15],x=t*s,f=t*l,p=t*o,k=n*r,z=n*l,w=n*o,S=a*r,I=a*s,b=a*o,T=i*r,C=i*s,A=i*l;return d*(A*y-b*y-C*h+w*h+I*c-z*c)+m*(f*c-p*h+T*h-S*c+b*u-A*u)+v*(p*y-x*c-T*y+k*c+C*u-w*u)+g*(-I*u-f*y+x*h+S*y-k*h+z*u)}},{key:"getInverse",value:function(e){var t=this.elements,n=e.elements,a=n[0],i=n[1],r=n[2],s=n[3],l=n[4],o=n[5],u=n[6],y=n[7],h=n[8],c=n[9],d=n[10],m=n[11],v=n[12],g=n[13],x=n[14],f=n[15],p=c*x*y-g*d*y+g*u*m-o*x*m-c*u*f+o*d*f,k=v*d*y-h*x*y-v*u*m+l*x*m+h*u*f-l*d*f,z=h*g*y-v*c*y+v*o*m-l*g*m-h*o*f+l*c*f,w=v*c*u-h*g*u-v*o*d+l*g*d+h*o*x-l*c*x,S=a*p+i*k+r*z+s*w,I;return 0===S?(console.error("Can't invert matrix, determinant is zero",e),this.identity()):(I=1/S,t[0]=p*I,t[1]=(g*d*s-c*x*s-g*r*m+i*x*m+c*r*f-i*d*f)*I,t[2]=(o*x*s-g*u*s+g*r*y-i*x*y-o*r*f+i*u*f)*I,t[3]=(c*u*s-o*d*s-c*r*y+i*d*y+o*r*m-i*u*m)*I,t[4]=k*I,t[5]=(h*x*s-v*d*s+v*r*m-a*x*m-h*r*f+a*d*f)*I,t[6]=(v*u*s-l*x*s-v*r*y+a*x*y+l*r*f-a*u*f)*I,t[7]=(l*d*s-h*u*s+h*r*y-a*d*y-l*r*m+a*u*m)*I,t[8]=z*I,t[9]=(v*c*s-h*g*s-v*i*m+a*g*m+h*i*f-a*c*f)*I,t[10]=(l*g*s-v*o*s+v*i*y-a*g*y-l*i*f+a*o*f)*I,t[11]=(h*o*s-l*c*s-h*i*y+a*c*y+l*i*m-a*o*m)*I,t[12]=w*I,t[13]=(h*g*r-v*c*r+v*i*d-a*g*d-h*i*x+a*c*x)*I,t[14]=(v*o*r-l*g*r-v*i*u+a*g*u+l*i*x-a*o*x)*I,t[15]=(l*c*r-h*o*r+h*i*u-a*c*u-l*i*d+a*o*d)*I),this}},{key:"transpose",value:function(){var e=this.elements,n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}},{key:"scale",value:function(e,t,n){var a=this.elements;return a[0]*=e,a[4]*=t,a[8]*=n,a[1]*=e,a[5]*=t,a[9]*=n,a[2]*=e,a[6]*=t,a[10]*=n,a[3]*=e,a[7]*=t,a[11]*=n,this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=we(e),n=Se(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=we(e),n=Se(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=we(e),n=Se(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,n){var a=we(n),i=Se(n),r=1-a,t=e.x,s=e.y,l=e.z,o=r*t,u=r*s;return this.set(o*t+a,o*s-i*l,o*l+i*s,0,o*s+i*l,u*s+a,u*l-i*t,0,o*l-i*s,u*l+i*t,r*l*l+a,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var a=this.elements,i=t.x,r=t.y,s=t.z,l=t.w,o=i+i,u=r+r,y=s+s,h=i*o,c=i*u,d=i*y,m=r*u,v=r*y,g=s*y,x=l*o,f=l*u,p=l*y,k=n.x,z=n.y,w=n.z;return a[0]=(1-(m+g))*k,a[1]=(c+p)*k,a[2]=(d-f)*k,a[3]=0,a[4]=(c-p)*z,a[5]=(1-(h+g))*z,a[6]=(v+x)*z,a[7]=0,a[8]=(d+f)*w,a[9]=(v-x)*w,a[10]=(1-(h+m))*w,a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1,this}},{key:"decompose",value:function(e,t,n){var a=this.elements,i=a[0],r=a[1],s=a[2],l=a[4],o=a[5],u=a[6],y=a[8],h=a[9],c=a[10],d=this.determinant(),m=nt.set(i,r,s).length()*(0>d?-1:1),v=nt.set(l,o,u).length(),g=nt.set(y,h,c).length(),x=1/m,f=1/v,p=1/g;return e.x=a[12],e.y=a[13],e.z=a[14],a[0]*=x,a[1]*=x,a[2]*=x,a[4]*=f,a[5]*=f,a[6]*=f,a[8]*=p,a[9]*=p,a[10]*=p,t.setFromRotationMatrix(this),a[0]=i,a[1]=r,a[2]=s,a[4]=l,a[5]=o,a[6]=u,a[8]=y,a[9]=h,a[10]=c,n.x=m,n.y=v,n.z=g,this}},{key:"makePerspective",value:function(e,t,n,a,i,r){var s=this.elements;return s[0]=2*i/(t-e),s[4]=0,s[8]=(t+e)/(t-e),s[12]=0,s[1]=0,s[5]=2*i/(n-a),s[9]=(n+a)/(n-a),s[13]=0,s[2]=0,s[6]=0,s[10]=-(r+i)/(r-i),s[14]=-2*r*i/(r-i),s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,a,i,r){var s=this.elements,l=1/(t-e),o=1/(n-a),u=1/(r-i);return s[0]=2*l,s[4]=0,s[8]=0,s[12]=-((t+e)*l),s[1]=0,s[5]=2*o,s[9]=0,s[13]=-((n+a)*o),s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-((r+i)*u),s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}},{key:"equals",value:function(e){var t=this.elements,n=e.elements,a=!0,r;for(r=0;a&&16>r;++r)t[r]!==n[r]&&(a=!1);return a}}]),e}(),rt=[new Re,new Re,new Re,new Re],st=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Re;t(this,e),this.origin=n,this.direction=a}return i(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"at",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Re;return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,rt[0])),this}},{key:"closestPointToPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Re,n=t.subVectors(e,this.origin).dot(this.direction);return 0<=n?t.copy(this.direction).multiplyScalar(n).add(this.origin):t.copy(this.origin)}},{key:"distanceSquaredToPoint",value:function(e){var t=rt[0].subVectors(e,this.origin).dot(this.direction);return 0>t?this.origin.distanceToSquared(e):rt[0].copy(this.direction).multiplyScalar(t).add(this.origin).distanceToSquared(e)}},{key:"distanceToPoint",value:function(e){return ze(this.distanceSquaredToPoint(e))}},{key:"distanceToPlane",value:function(e){var n=e.normal.dot(this.direction),a=0===n?0===e.distanceToPoint(this.origin)?0:-1:-(this.origin.dot(e.normal)+e.constant)/n;return 0<=a?a:null}},{key:"distanceSquaredToSegment",value:function(e,t,n,a){var i=rt[0].copy(e).add(t).multiplyScalar(.5),r=rt[1].copy(t).sub(e).normalize(),s=rt[2].copy(this.origin).sub(i),l=.5*e.distanceTo(t),o=-this.direction.dot(r),u=s.dot(this.direction),y=-s.dot(r),h=s.lengthSq(),c=Te(1-o*o),d,m,v,g,x;return 0<c?(d=o*y-u,m=o*u-y,v=l*c,0<=d?m>=-v?m<=v?(g=1/c,d*=g,m*=g,x=d*(d+o*m+2*u)+m*(o*d+m+2*y)+h):(m=l,d=Ce(0,-(o*m+u)),x=-d*d+m*(m+2*y)+h):(m=-l,d=Ce(0,-(o*m+u)),x=-d*d+m*(m+2*y)+h):m<=-v?(d=Ce(0,-(-o*l+u)),m=0<d?-l:Ae(Ce(-l,-y),l),x=-d*d+m*(m+2*y)+h):m<=v?(d=0,m=Ae(Ce(-l,-y),l),x=m*(m+2*y)+h):(d=Ce(0,-(o*l+u)),m=0<d?l:Ae(Ce(-l,-y),l),x=-d*d+m*(m+2*y)+h)):(m=0<o?-l:l,d=Ce(0,-(o*m+u)),x=-d*d+m*(m+2*y)+h),void 0!==n&&n.copy(this.direction).multiplyScalar(d).add(this.origin),void 0!==a&&a.copy(r).multiplyScalar(m).add(i),x}},{key:"intersectSphere",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Re,n=rt[0].subVectors(e.center,this.origin),a=n.dot(this.direction),i=n.dot(n)-a*a,r=e.radius*e.radius,s=null,l,o,u;return i<=r&&(l=ze(r-i),o=a-l,u=a+l,(0<=o||0<=u)&&(s=0>o?this.at(u,t):this.at(o,t))),s}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"intersectPlane",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Re,a=this.distanceToPlane(e);return null===a?null:this.at(a,n)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t}},{key:"intersectBox",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Re,n=this.origin,a=this.direction,i=e.min,r=e.max,s=1/a.x,l=1/a.y,o=1/a.z,u=null,y,h,c,d,m,v;return 0<=s?(y=(i.x-n.x)*s,h=(r.x-n.x)*s):(y=(r.x-n.x)*s,h=(i.x-n.x)*s),0<=l?(c=(i.y-n.y)*l,d=(r.y-n.y)*l):(c=(r.y-n.y)*l,d=(i.y-n.y)*l),y<=d&&c<=h&&((c>y||y!==y)&&(y=c),(d<h||h!==h)&&(h=d),0<=o?(m=(i.z-n.z)*o,v=(r.z-n.z)*o):(m=(r.z-n.z)*o,v=(i.z-n.z)*o),y<=v&&m<=h&&((m>y||y!==y)&&(y=m),(v<h||h!==h)&&(h=v),0<=h&&(u=this.at(0<=y?y:h,t)))),u}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,rt[0])}},{key:"intersectTriangle",value:function(e,t,n,a,i){var r=this.direction,s=rt[0],l=rt[1],o=rt[2],u=rt[3],y=null,h,c,d,m,v;return l.subVectors(t,e),o.subVectors(n,e),u.crossVectors(l,o),h=r.dot(u),0===h||a&&0<h||(0<h?c=1:(c=-1,h=-h),s.subVectors(this.origin,e),d=c*r.dot(o.crossVectors(s,o)),0<=d&&(m=c*r.dot(l.cross(s)),0<=m&&d+m<=h&&(v=-c*s.dot(u),0<=v&&(y=this.at(v/h,i))))),y}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),e}(),lt=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.radius=n,this.phi=a,this.theta=i}return i(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"makeSafe",value:function(){return this.phi=Ce(1e-6,Ae(xe-1e-6,this.phi)),this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=ze(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=fe(e,n),this.phi=ke(Ae(Ce(t/this.radius,-1),1))),this}}]),e}(),ot=function(){function e(){t(this,e),this.elements=new Float32Array([1,0,0,1,0,1])}return i(e,[{key:"set",value:function(t,n,a,i,r,s){var l=this.elements;return l[0]=t,l[1]=n,l[3]=i,l[2]=a,l[4]=r,l[5]=s,this}},{key:"identity",value:function(){return this.set(1,0,0,1,0,1),this}},{key:"copy",value:function(e){var t=e.elements;return this.set(t[0],t[1],t[2],t[3],t[4],t[5]),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"toMatrix3",value:function(e){var t=e.elements;e.set(t[0],t[1],t[2],t[1],t[3],t[4],t[2],t[4],t[5])}},{key:"add",value:function(e){var t=this.elements,n=e.elements;return t[0]+=n[0],t[1]+=n[1],t[3]+=n[3],t[2]+=n[2],t[4]+=n[4],t[5]+=n[5],this}},{key:"norm",value:function(){var t=this.elements,e=t[1]*t[1],n=t[2]*t[2],a=t[4]*t[4];return ze(t[0]*t[0]+e+n+e+t[3]*t[3]+a+n+a+t[5]*t[5])}},{key:"off",value:function(){var t=this.elements;return ze(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:"applyToVector3",value:function(t){var n=t.x,a=t.y,i=t.z,r=this.elements;return t.x=r[0]*n+r[1]*a+r[2]*i,t.y=r[1]*n+r[3]*a+r[4]*i,t.z=r[2]*n+r[4]*a+r[5]*i,t}},{key:"equals",value:function(e){var t=this.elements,n=e.elements,a=!0,r;for(r=0;a&&6>r;++r)t[r]!==n[r]&&(a=!1);return a}}],[{key:"calculateIndex",value:function(e,t){return 3-(3-e)*(2-e)/2+t}}]),e}(),ut=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;t(this,e),this.x=n,this.y=a,this.z=i,this.w=r}return i(e,[{key:"set",value:function(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.w=a,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*ke(e.w);var t=ze(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t=.01,n=.1,a=e.elements,i=a[0],r=a[4],l=a[8],o=a[1],u=a[5],h=a[9],c=a[2],d=a[6],m=a[10],v,g,f,p,k,w,S,I,b,T,C;return Te(r-o)<t&&Te(l-c)<t&&Te(h-d)<t?Te(r+o)<n&&Te(l+c)<n&&Te(h+d)<n&&Te(i+u+m-3)<n?this.set(1,0,0,0):(v=xe,k=(i+1)/2,w=(u+1)/2,S=(m+1)/2,I=(r+o)/4,b=(l+c)/4,T=(h+d)/4,k>w&&k>S?k<t?(g=0,f=.707106781,p=.707106781):(g=ze(k),f=I/g,p=b/g):w>S?w<t?(g=.707106781,f=0,p=.707106781):(f=ze(w),g=I/f,p=T/f):S<t?(g=.707106781,f=.707106781,p=0):(p=ze(S),g=b/p,f=T/p),this.set(g,f,p,v)):(C=ze((d-h)*(d-h)+(l-c)*(l-c)+(o-r)*(o-r)),.001>Te(C)&&(C=1),this.x=(d-h)/C,this.y=(l-c)/C,this.z=(o-r)/C,this.w=ke((i+u+m-1)/2)),this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this.w=e.w*t.w,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this}},{key:"applyMatrix4",value:function(t){var n=this.x,a=this.y,i=this.z,r=this.w,s=t.elements;return this.x=s[0]*n+s[4]*a+s[8]*i+s[12]*r,this.y=s[1]*n+s[5]*a+s[9]*i+s[13]*r,this.z=s[2]*n+s[6]*a+s[10]*i+s[14]*r,this.w=s[3]*n+s[7]*a+s[11]*i+s[15]*r,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"manhattanLength",value:function(){return Te(this.x)+Te(this.y)+Te(this.z)+Te(this.w)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return ze(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanDistanceTo",value:function(e){return Te(this.x-e.x)+Te(this.y-e.y)+Te(this.z-e.z)+Te(this.w-e.w)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,a=this.z-e.z,i=this.w-e.w;return t*t+n*n+a*a+i*i}},{key:"distanceTo",value:function(e){return ze(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=Ae(this.x,e.x),this.y=Ae(this.y,e.y),this.z=Ae(this.z,e.z),this.w=Ae(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Ce(this.x,e.x),this.y=Ce(this.y,e.y),this.z=Ce(this.z,e.z),this.w=Ce(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=Ce(e.x,Ae(t.x,this.x)),this.y=Ce(e.y,Ae(t.y,this.y)),this.z=Ce(e.z,Ae(t.z,this.z)),this.w=Ce(e.w,Ae(t.w,this.w)),this}},{key:"floor",value:function(){return this.x=Ie(this.x),this.y=Ie(this.y),this.z=Ie(this.z),this.w=Ie(this.w),this}},{key:"ceil",value:function(){return this.x=be(this.x),this.y=be(this.y),this.z=be(this.z),this.w=be(this.w),this}},{key:"round",value:function(){return this.x=pe(this.x),this.y=pe(this.y),this.z=pe(this.z),this.w=pe(this.w),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}]),e}(),yt={AIR:0,SOLID:1},ht=function(){function e(n){t(this,e),this.type=n;for(var a=arguments.length,i=Array(1<a?a-1:0),r=1;r<a;r++)i[r-1]=arguments[r];this.children=i,this.boundingBox=null}return i(e,[{key:"getBoundingBox",value:function(){return null===this.boundingBox&&(this.boundingBox=this.computeBoundingBox()),this.boundingBox}},{key:"computeBoundingBox",value:function(){var e=this.children,t=new j,n,a;for(n=0,a=e.length;n<a;++n)t.union(e[n].getBoundingBox());return t}}]),e}(),ct=function(e){function n(){var e;t(this,n);for(var a=arguments.length,i=Array(a),r=0;r<a;r++)i[r]=arguments[r];return k(this,(e=u(n)).call.apply(e,[this,Le.UNION].concat(i)))}return o(n,e),i(n,[{key:"updateMaterialIndex",value:function(e,t,n){var a=n.materialIndices[e];a!==yt.AIR&&t.setMaterialIndex(e,a)}},{key:"selectEdge",value:function(e,t,n){return n?e.t>t.t?e:t:e.t<t.t?e:t}}]),n}(ht),dt=function(e){function n(){var e;t(this,n);for(var a=arguments.length,i=Array(a),r=0;r<a;r++)i[r]=arguments[r];return k(this,(e=u(n)).call.apply(e,[this,Le.DIFFERENCE].concat(i)))}return o(n,e),i(n,[{key:"updateMaterialIndex",value:function(e,t,n){n.materialIndices[e]!==yt.AIR&&t.setMaterialIndex(e,yt.AIR)}},{key:"selectEdge",value:function(e,t,n){return n?e.t<t.t?e:t:e.t>t.t?e:t}}]),n}(ht),mt=function(e){function n(){var e;t(this,n);for(var a=arguments.length,i=Array(a),r=0;r<a;r++)i[r]=arguments[r];return k(this,(e=u(n)).call.apply(e,[this,Le.INTERSECTION].concat(i)))}return o(n,e),i(n,[{key:"updateMaterialIndex",value:function(e,t,n){var a=n.materialIndices[e];t.setMaterialIndex(e,t.materialIndices[e]!==yt.AIR&&a!==yt.AIR?a:yt.AIR)}},{key:"selectEdge",value:function(e,t,n){return n?e.t<t.t?e:t:e.t>t.t?e:t}}]),n}(ht),vt=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;t(this,e),this.runLengths=n,this.data=a}return i(e,null,[{key:"encode",value:function(t){var n=[],a=[],r=t[0],s=1,o,u;for(o=1,u=t.length;o<u;++o)r===t[o]?++s:(n.push(s),a.push(r),r=t[o],s=1);return n.push(s),a.push(r),new e(n,a)}},{key:"decode",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],a=0,r,s,l,o,u;for(s=0,o=t.length;s<o;++s)for(r=t[s],l=0,u=e[s];l<u;++l)n[a++]=r;return n}}]),e}(),gt=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,a=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];t(this,e),this.value=n,this.done=a}return i(e,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),e}(),xt=new Re,ft=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Re;t(this,e),this.min=n,this.max=a,this.children=null}return i(e,[{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re;return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re;return e.subVectors(this.max,this.min)}},{key:"split",value:function(){var e=this.min,t=this.max,n=this.getCenter(xt),a=this.children=[null,null,null,null,null,null,null,null],r,s;for(r=0;8>r;++r)s=pt[r],a[r]=new this.constructor(new Re(0===s[0]?e.x:n.x,0===s[1]?e.y:n.y,0===s[2]?e.z:n.z),new Re(0===s[0]?n.x:t.x,0===s[1]?n.y:t.y,0===s[2]?n.z:t.z))}}]),e}(),pt=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],kt=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],zt=new Re,wt=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.min=n,this.size=a,this.children=null}return i(e,[{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re;return e.copy(this.min).addScalar(.5*this.size)}},{key:"getDimensions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re;return e.set(this.size,this.size,this.size)}},{key:"split",value:function(){var e=this.min,t=this.getCenter(zt),n=.5*this.size,a=this.children=[null,null,null,null,null,null,null,null],r,s;for(r=0;8>r;++r)s=pt[r],a[r]=new this.constructor(new Re(0===s[0]?e.x:t.x,0===s[1]?e.y:t.y,0===s[2]?e.z:t.z),n)}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}]),e}(),St=new j,It=function(){function e(n){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;t(this,e),this.octree=n,this.region=a,this.cull=null!==a,this.result=new gt,this.trace=null,this.indices=null,this.reset()}return i(e,[{key:"reset",value:function(){var e=this.octree.root;return this.trace=[],this.indices=[],null!==e&&(St.min=e.min,St.max=e.max,(!this.cull||this.region.intersectsBox(St))&&(this.trace.push(e),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var e=this.cull,t=this.region,n=this.indices,a=this.trace,i=null,r=a.length-1,s,l,o;null===i&&0<=r;)if(s=n[r]++,l=a[r].children,!(8>s))a.pop(),n.pop(),--r;else if(null!==l){if(o=l[s],e&&(St.min=o.min,St.max=o.max,!t.intersectsBox(St)))continue;a.push(o),n.push(0),++r}else i=a.pop(),n.pop();return this.result.value=i,this.result.done=null===i,this.result}},{key:"return",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),bt=[new Re,new Re,new Re],Tt=new j,Ct=new st,r=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],At=0,Et=function(){function e(){t(this,e)}return i(e,null,[{key:"intersectOctree",value:function(e,t,n){var a=Tt.min.set(0,0,0),i=Tt.max.subVectors(e.max,e.min),r=e.getDimensions(bt[0]),s=bt[1].copy(r).multiplyScalar(.5),l=Ct.origin.copy(t.ray.origin),o=Ct.direction.copy(t.ray.direction),u,y,h,c,d,m,v,g,x;l.sub(e.getCenter(bt[2])).add(s),At=0,0>o.x&&(l.x=r.x-l.x,o.x=-o.x,At|=4),0>o.y&&(l.y=r.y-l.y,o.y=-o.y,At|=2),0>o.z&&(l.z=r.z-l.z,o.z=-o.z,At|=1),u=1/o.x,y=1/o.y,h=1/o.z,c=(a.x-l.x)*u,d=(i.x-l.x)*u,m=(a.y-l.y)*y,v=(i.y-l.y)*y,g=(a.z-l.z)*h,x=(i.z-l.z)*h,Ce(Ce(c,m),g)<Ae(Ae(d,v),x)&&O(e.root,c,m,g,d,v,x,t,n)}}]),e}(),Pt=new j,Dt=function(){function e(n,a){t(this,e),this.root=void 0!==n&&void 0!==a?new ft(n,a):null}return i(e,[{key:"getCenter",value:function(e){return this.root.getCenter(e)}},{key:"getDimensions",value:function(e){return this.root.getDimensions(e)}},{key:"getDepth",value:function(){return M(this.root)}},{key:"cull",value:function(e){var t=[];return B(this.root,e,t),t}},{key:"findOctantsByLevel",value:function(e){var t=[];return L(this.root,e,0,t),t}},{key:"raycast",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return Et.intersectOctree(this,e,t),t}},{key:"leaves",value:function(e){return new It(this,e)}},{key:Symbol.iterator,value:function(){return new It(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),e}(),Ft=new Re,Ot=new Re,p=new Re,Mt=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Re;t(this,e),this.a=n,this.b=a,this.index=-1,this.coordinates=new Re,this.t=0,this.n=new Re}return i(e,[{key:"approximateZeroCrossing",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,n=Ce(1,t-1),r=0,s=1,l=0,o=0,u,y;for(Ft.subVectors(this.b,this.a);o<=n&&(l=(r+s)/2,Ot.addVectors(this.a,p.copy(Ft).multiplyScalar(l)),y=e.sample(Ot),!(Te(y)<=1e-4||(s-r)/2<=1e-6));)Ot.addVectors(this.a,p.copy(Ft).multiplyScalar(r)),u=e.sample(Ot),ge(y)===ge(u)?r=l:s=l,++o;this.t=l}},{key:"computeZeroCrossingPosition",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re;return e.subVectors(this.b,this.a).multiplyScalar(this.t).add(this.a)}},{key:"computeSurfaceNormal",value:function(e){var t=this.computeZeroCrossingPosition(Ft),n=1e-3,a=e.sample(Ot.addVectors(t,p.set(n,0,0)))-e.sample(Ot.subVectors(t,p.set(n,0,0))),i=e.sample(Ot.addVectors(t,p.set(0,n,0)))-e.sample(Ot.subVectors(t,p.set(0,n,0))),r=e.sample(Ot.addVectors(t,p.set(0,0,n)))-e.sample(Ot.subVectors(t,p.set(0,0,n)));this.n.set(a,i,r).normalize()}}]),e}(),Bt=new Mt,Lt=new Re,Rt=new Re,Vt=function(){function e(n,a,i){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:3;t(this,e),this.edgeData=n,this.cellPosition=a,this.cellSize=i,this.indices=null,this.zeroCrossings=null,this.normals=null,this.axes=null,this.lengths=null,this.result=new gt,this.initialC=r,this.c=r,this.initialD=s,this.d=s,this.i=0,this.l=0,this.reset()}return i(e,[{key:"reset",value:function(){var e=this.edgeData,t=[],n=[],i=[],r=[],s=[],o,u,y,h;for(this.i=0,this.c=0,this.d=0,(u=this.initialC,o=4>>u,y=this.initialD);u<y;++u,o>>=1)h=e.indices[u].length,0<h&&(t.push(e.indices[u]),n.push(e.zeroCrossings[u]),i.push(e.normals[u]),r.push(pt[o]),s.push(h),++this.d);return this.l=0<s.length?s[0]:0,this.indices=t,this.zeroCrossings=n,this.normals=i,this.axes=r,this.lengths=s,this.result.reset(),this}},{key:"next",value:function(){var e=this.cellSize,t=this.edgeData.resolution,n=t+1,a=n*n,r=this.result,s=this.cellPosition,l,o,u,h,d,m,v;return this.i===this.l&&(this.l=++this.c<this.d?this.lengths[this.c]:0,this.i=0),this.i<this.l?(m=this.c,v=this.i,l=this.axes[m],o=this.indices[m][v],Bt.index=o,u=o%n,h=ve(o%a/n),d=ve(o/a),Bt.coordinates.set(u,h,d),Lt.set(u*e/t,h*e/t,d*e/t),Rt.set((u+l[0])*e/t,(h+l[1])*e/t,(d+l[2])*e/t),Bt.a.addVectors(s,Lt),Bt.b.addVectors(s,Rt),Bt.t=this.zeroCrossings[m][v],Bt.n.fromArray(this.normals[m],3*v),r.value=Bt,++this.i):(r.value=null,r.done=!0),r}},{key:"return",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),Nt=function(){function e(a){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:n;t(this,e),this.resolution=a,this.indices=0>=n?null:[new Uint32Array(n),new Uint32Array(i),new Uint32Array(r)],this.zeroCrossings=0>=n?null:[new Float32Array(n),new Float32Array(i),new Float32Array(r)],this.normals=0>=n?null:[new Float32Array(3*n),new Float32Array(3*i),new Float32Array(3*r)]}return i(e,[{key:"serialize",value:function(){return{resolution:this.resolution,edges:this.edges,zeroCrossings:this.zeroCrossings,normals:this.normals}}},{key:"deserialize",value:function(e){var t=this;return null===e?t=null:(this.resolution=e.resolution,this.edges=e.edges,this.zeroCrossings=e.zeroCrossings,this.normals=e.normals),t}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=[this.edges[0],this.edges[1],this.edges[2],this.zeroCrossings[0],this.zeroCrossings[1],this.zeroCrossings[2],this.normals[0],this.normals[1],this.normals[2]],n,a,r;for(a=0,r=t.length;a<r;++a)n=t[a],null!==n&&e.push(n.buffer);return e}},{key:"edges",value:function(e,t){return new Vt(this,e,t)}},{key:"edgesX",value:function(e,t){return new Vt(this,e,t,0,1)}},{key:"edgesY",value:function(e,t){return new Vt(this,e,t,1,2)}},{key:"edgesZ",value:function(e,t){return new Vt(this,e,t,2,3)}}],[{key:"calculate1DEdgeCount",value:function(e){return me(e+1,2)*e}}]),e}(),Ut=0,Yt=0,qt=0,Xt=function(){function e(){var n=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];t(this,e),this.materials=0,this.materialIndices=n?new Uint8Array(qt):null,this.runLengths=null,this.edgeData=null}return i(e,[{key:"set",value:function(e){return this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,this.edgeData=e.edgeData,this}},{key:"clear",value:function(){return this.materials=0,this.materialIndices=null,this.runLengths=null,this.edgeData=null,this}},{key:"setMaterialIndex",value:function(e,t){this.materialIndices[e]===yt.AIR?t!==yt.AIR&&++this.materials:t===yt.AIR&&--this.materials,this.materialIndices[e]=t}},{key:"compress",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this,t;return this.compressed?(e.materialIndices=this.materialIndices,e.runLengths=this.runLengths):(t=this.full?new vt([this.materialIndices.length],[yt.SOLID]):vt.encode(this.materialIndices),e.materialIndices=new Uint8Array(t.data),e.runLengths=new Uint32Array(t.runLengths)),e.materials=this.materials,e}},{key:"decompress",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this;return e.materialIndices=this.compressed?vt.decode(this.runLengths,this.materialIndices,new Uint8Array(qt)):this.materialIndices,e.runLengths=null,e.materials=this.materials,e}},{key:"serialize",value:function(){return{materials:this.materials,materialIndices:this.materialIndices,runLengths:this.runLengths,edgeData:null===this.edgeData?null:this.edgeData.serialize()}}},{key:"deserialize",value:function(e){var t=this;return null===e?t=null:(this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,null===e.edgeData?this.edgeData=null:(null===this.edgeData&&(this.edgeData=new Nt(Yt)),this.edgeData.deserialize(e.edgeData))),t}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.edgeData&&this.edgeData.createTransferList(e),null!==this.materialIndices&&e.push(this.materialIndices.buffer),null!==this.runLengths&&e.push(this.runLengths.buffer),e}},{key:"empty",get:function(){return 0===this.materials}},{key:"full",get:function(){return this.materials===qt}},{key:"compressed",get:function(){return null!==this.runLengths}},{key:"neutered",get:function(){return!this.empty&&null===this.materialIndices}}],[{key:"isovalue",get:function(){return Ut},set:function(e){Ut=e}},{key:"resolution",get:function(){return Yt},set:function(e){var t=Math.log2;e=me(2,Ce(0,be(t(e)))),Yt=Ce(1,Ae(256,e)),qt=me(Yt+1,3)}}]),e}(),Zt=function(e){function n(e){var a;return t(this,n),a=k(this,u(n).call(this,Le.DENSITY_FUNCTION)),a.sdf=e,a}return o(n,e),i(n,[{key:"computeBoundingBox",value:function(){return this.sdf.getBoundingBox(!0)}},{key:"generateMaterialIndex",value:function(e){return this.sdf.sample(e)<=Xt.isovalue?this.sdf.material:yt.AIR}},{key:"generateEdge",value:function(e){e.approximateZeroCrossing(this.sdf),e.computeSurfaceNormal(this.sdf)}}]),n}(ht),_t=new c,jt=function(){function e(n){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:yt.SOLID;t(this,e),this.type=n,this.operation=null,this.material=Ae(255,Ce(yt.SOLID,ve(a))),this.boundingBox=null,this.position=new Re,this.quaternion=new Ge,this.scale=new Re(1,1,1),this.inverseTransformation=new c,this.updateInverseTransformation(),this.children=[]}return i(e,[{key:"getTransformation",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new c;return e.compose(this.position,this.quaternion,this.scale)}},{key:"getBoundingBox",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t=this.children,n=this.boundingBox,a,r;if(null===n&&(n=this.computeBoundingBox(),this.boundingBox=n),e)for(n=n.clone(),a=0,r=t.length;a<r;++a)n.union(t[a].getBoundingBox(e));return n}},{key:"setMaterial",value:function(e){return this.material=Ae(255,Ce(yt.SOLID,ve(e))),this}},{key:"setOperationType",value:function(e){return this.operation=e,this}},{key:"updateInverseTransformation",value:function(){return this.inverseTransformation.getInverse(this.getTransformation(_t)),this.boundingBox=null,this}},{key:"union",value:function(e){return this.children.push(e.setOperationType(Le.UNION)),this}},{key:"subtract",value:function(e){return this.children.push(e.setOperationType(Le.DIFFERENCE)),this}},{key:"intersect",value:function(e){return this.children.push(e.setOperationType(Le.INTERSECTION)),this}},{key:"toCSG",value:function(){var e=this.children,t=new Zt(this),n,a,r,s;for(r=0,s=e.length;r<s;++r)a=e[r],n!==a.operation&&(n=a.operation,n===Le.UNION?t=new ct(t):n===Le.DIFFERENCE?t=new dt(t):n===Le.INTERSECTION?t=new mt(t):void 0),t.children.push(a.toCSG());return t}},{key:"serialize",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t={type:this.type,operation:this.operation,material:this.material,position:this.position.toArray(),quaternion:this.quaternion.toArray(),scale:this.scale.toArray(),parameters:null,children:[]},n,a;for(n=0,a=this.children.length;n<a;++n)t.children.push(this.children[n].serialize(e));return t}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e}},{key:"toJSON",value:function(){return this.serialize(!0)}},{key:"computeBoundingBox",value:function(){throw new Error("SignedDistanceFunction#computeBoundingBox method not implemented!")}},{key:"sample",value:function(){throw new Error("SignedDistanceFunction#sample method not implemented!")}}]),e}(),Kt={HEIGHTFIELD:"sdf.heightfield",FRACTAL_NOISE:"sdf.fractalnoise",SUPER_PRIMITIVE:"sdf.superprimitive"},Gt=function(e){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=1<arguments.length?arguments[1]:void 0,i;return t(this,n),i=k(this,u(n).call(this,Kt.PERLIN_NOISE,a)),i.min=g(Re,T(e.min)),i.max=g(Re,T(e.max)),i}return o(n,e),i(n,[{key:"computeBoundingBox",value:function(){return this.bbox=new j(this.min,this.max),this.bbox}},{key:"sample",value:function(){}},{key:"serialize",value:function(){var e=w(u(n.prototype),"serialize",this).call(this);return e.parameters={min:this.min.toArray(),max:this.max.toArray()},e}}]),n}(jt),Ht=function(e){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=1<arguments.length?arguments[1]:void 0,i;return t(this,n),i=k(this,u(n).call(this,Kt.HEIGHTFIELD,a)),i.width=void 0===e.width?1:e.width,i.height=void 0===e.height?1:e.height,i.smooth=void 0===e.smooth||e.smooth,i.data=void 0===e.data?null:e.data,i.heightmap=null,void 0!==e.image&&i.fromImage(e.image),i}return o(n,e),i(n,[{key:"fromImage",value:function(e){var t="undefined"==typeof document?null:R(e),n=null,a,r,s,o;if(null!==t){for(a=t.data,n=new Uint8ClampedArray(a.length/4),(r=0,s=0,o=n.length);r<o;++r,s+=4)n[r]=a[s];this.heightmap=e,this.width=t.width,this.height=t.height,this.data=n}return this}},{key:"getHeight",value:function(e,t){var n=this.width,i=this.height,r=this.data,s;if(e=pe(e*n),t=pe(t*i),this.smooth){e=Ce(Ae(e,n-1),1),t=Ce(Ae(t,i-1),1);var l=e+1,o=e-1,u=t*n,a=u+n,y=u-n;s=(r[y+o]+r[y+e]+r[y+l]+r[u+o]+r[u+e]+r[u+l]+r[a+o]+r[a+e]+r[a+l])/9}else s=r[t*n+e];return s}},{key:"computeBoundingBox",value:function(){var e=new j,t=Ae(this.width/this.height,1),n=Ae(this.height/this.width,1);return e.min.set(0,0,0),e.max.set(t,1,n),e.applyMatrix4(this.getTransformation()),e}},{key:"sample",value:function(e){var t=this.boundingBox,n;return t.containsPoint(e)?(e.applyMatrix4(this.inverseTransformation),n=e.y-this.getHeight(e.x,e.z)/255):n=t.distanceToPoint(e),n}},{key:"serialize",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t=w(u(n.prototype),"serialize",this).call(this);return t.parameters={width:this.width,height:this.height,smooth:this.smooth,data:e?null:this.data,dataURL:e&&null!==this.heightmap?this.heightmap.toDataURL():null,image:null},t}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.data.buffer),e}}]),n}(jt),Wt=function(e){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=1<arguments.length?arguments[1]:void 0,i;return t(this,n),i=k(this,u(n).call(this,Kt.SUPER_PRIMITIVE,a)),i.s0=g(ut,T(e.s)),i.r0=g(Re,T(e.r)),i.s=new ut,i.r=new Re,i.ba=new qe,i.offset=0,i.precompute(),i}return o(n,e),i(n,[{key:"setSize",value:function(e,t,n,a){return this.s0.set(e,t,n,a),this.precompute()}},{key:"setRadii",value:function(e,t,n){return this.r0.set(e,t,n),this.precompute()}},{key:"precompute",value:function(){var e=this.s.copy(this.s0),t=this.r.copy(this.r0),n=this.ba;e.x-=t.x,e.y-=t.x,t.x-=e.w,e.w-=t.y,e.z-=t.y,this.offset=-2*e.z,n.set(t.z,this.offset);var a=n.dot(n);return 0===a?n.set(0,-1):n.divideScalar(a),this}},{key:"computeBoundingBox",value:function(){var e=this.s0,t=new j;return t.min.x=Ae(-e.x,-1),t.min.y=Ae(-e.y,-1),t.min.z=Ae(-e.z,-1),t.max.x=Ce(e.x,1),t.max.y=Ce(e.y,1),t.max.z=Ce(e.z,1),t.applyMatrix4(this.getTransformation()),t}},{key:"sample",value:function(e){e.applyMatrix4(this.inverseTransformation);var t=this.s,n=this.r,a=this.ba,i=Te(e.x)-t.x,r=Te(e.y)-t.y,s=Te(e.z)-t.z,l=Ce(i,0),o=Ce(r,0),u=ze(l*l+o*o),y=e.z-t.z,h=Te(u+Ae(0,Ce(i,r))-n.x)-t.w,d=Ae(Ce(h*a.x+y*a.y,0),1),c=h-n.z*d,m=y-this.offset*d,v=Ce(h-n.z,0),g=e.z+t.z,x=Ce(h,0),f=h*-a.y+y*a.x,p=ze(Ae(c*c+m*m,Ae(v*v+g*g,x*x+y*y)));return p*ge(Ce(f,s))-n.y}},{key:"serialize",value:function(){var e=w(u(n.prototype),"serialize",this).call(this);return e.parameters={s:this.s0.toArray(),r:this.r0.toArray()},e}}],[{key:"create",value:function(e){var t=Qt[e];return new n({s:t[0],r:t[1]})}}]),n}(jt),Qt=[[new Float32Array([1,1,1,1]),new Float32Array([0,0,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,0,0])],[new Float32Array([0,0,1,1]),new Float32Array([0,0,1])],[new Float32Array([1,1,2,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,.25,1]),new Float32Array([1,.25,0])],[new Float32Array([1,1,.25,.25]),new Float32Array([1,.25,0])],[new Float32Array([1,1,1,.25]),new Float32Array([1,.1,0])],[new Float32Array([1,1,1,.25]),new Float32Array([.1,.1,0])]],Jt=function(){function e(){t(this,e)}return i(e,[{key:"revive",value:function(e){var t,n,a;switch(e.type){case Kt.FRACTAL_NOISE:t=new Gt(e.parameters,e.material);break;case Kt.HEIGHTFIELD:t=new Ht(e.parameters,e.material);break;case Kt.SUPER_PRIMITIVE:t=new Wt(e.parameters,e.material);}for(t.operation=e.operation,t.position.fromArray(e.position),t.quaternion.fromArray(e.quaternion),t.scale.fromArray(e.scale),t.updateInverseTransformation(),(n=0,a=e.children.length);n<a;++n)t.children.push(this.revive(e.children[n]));return t}}]),e}(),$t=function(e){function n(e){var a;return t(this,n),a=k(this,u(n).call(this,e)),a.descriptions=null,a}return o(n,e),n}(Me),en=new $t("load"),tn=function(e){function n(){var e;return t(this,n),e=k(this,u(n).call(this)),e.items=0,e.descriptions=null,e.imageMap=new WeakMap,e}return o(n,e),i(n,[{key:"clear",value:function(){this.imageMap=new WeakMap}},{key:"handleEvent",value:function(e){switch(e.type){case"load":this.progress(e);}}},{key:"progress",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=null===e?null:e.target,n=this.imageMap,a;null!==t&&(n.has(t)&&(a=n.get(t),a.image=t),--this.items),0===this.items&&(this.clear(),en.descriptions=this.descriptions,this.dispatchEvent(en))}},{key:"loadImage",value:function(e){var t=new Image;this.imageMap.set(t,e),++this.items,t.addEventListener("load",this),t.src=e.dataURL}},{key:"inflate",value:function(e){var t;null!==e.dataURL&&this.loadImage(e);var n=!0,a=!1,i=void 0;try{for(var r=e.children[Symbol.iterator](),s;!(n=(s=r.next()).done);n=!0)t=s.value,this.inflate(t)}catch(e){a=!0,i=e}finally{try{n||null==r["return"]||r["return"]()}finally{if(a)throw i}}this.progress()}},{key:"load",value:function(e){var t;this.items=0,this.descriptions=e;var n=!0,a=!1,i=void 0;try{for(var r=e[Symbol.iterator](),s;!(n=(s=r.next()).done);n=!0)t=s.value,this.inflate(t)}catch(e){a=!0,i=e}finally{try{n||null==r["return"]||r["return"]()}finally{if(a)throw i}}}}]),n}(Be),nn=function(){function e(){t(this,e)}return i(e,null,[{key:"parseBin",value:function(e){return parseInt(e,2)}},{key:"createBinaryString",value:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:64,n=0>e?"-":"",a=Te(e).toString(2);a.length<t;)a="0"+a;return n+a}}]),e}(),an=function(){function e(n,a,i){t(this,e),this.keyDesign=n,this.min=a,this.max=i,this.keyBase=new Re,this.key=new Re,this.limit=new Re,this.result=new gt,this.reset()}return i(e,[{key:"reset",value:function(){var e=this.keyDesign,t=this.min,n=this.max;return t.x<=n.x&&t.y<=n.y&&t.z<=n.z?(this.keyBase.set(t.x,t.y*e.rangeX,t.z*e.rangeXY),this.limit.set(n.x,n.y*e.rangeX,n.z*e.rangeXY),this.key.copy(this.keyBase)):(this.keyBase.set(1,1,1),this.limit.set(0,0,0),this.key.copy(this.keyBase),console.error("Invalid key range",t,n)),this.result.reset(),this}},{key:"next",value:function(){var e=this.result,t=this.keyDesign,n=this.keyBase,a=this.limit,i=this.key;return i.z<=a.z?(e.value=i.z+i.y+i.x,++i.x,i.x>a.x&&(i.x=n.x,i.y+=t.rangeX,i.y>a.y&&(i.y=n.y,i.z+=t.rangeXY))):(e.value=null,e.done=!0),e}},{key:"return",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),rn=32,sn=me(2,rn),ln=53,on=32,un=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:pe(.4*ln),a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:pe(.2*ln),i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n;t(this,e),this.x=0,this.y=0,this.z=0,this.rangeX=0,this.rangeY=0,this.rangeZ=0,this.rangeXY=0,this.halfRange=null,this.maskX=[0,0],this.maskY=[0,0],this.maskZ=[0,0],this.set(n,a,i)}return i(e,[{key:"set",value:function(e,t,n){(e+t+n>ln||e>rn||t>rn||n>rn)&&(console.warn("Invalid bit allotment"),e=pe(.4*ln),t=pe(.2*ln),n=e),this.x=e,this.y=t,this.z=n,this.rangeX=me(2,e),this.rangeY=me(2,t),this.rangeZ=me(2,n),this.rangeXY=me(2,e+t),this.halfRange=new Re(this.rangeX/2,this.rangeY/2,this.rangeZ/2),this.updateBitMasks()}},{key:"updateBitMasks",value:function(){var e=this.x,t=this.y,n=this.z,a=this.maskX,i=this.maskY,r=this.maskZ,s=rn-Ce(0,e-on),l=rn-Ce(0,t+e-on),o=rn-Ce(0,n+t+e-on);a[1]=s<rn?-1>>>s:0,a[0]=-1>>>Ce(0,on-e),i[1]=((l<rn?-1>>>l:0)&~a[1])>>>0,i[0]=(-1>>>Ce(0,on-(e+t))&~a[0])>>>0,r[1]=((o<rn?-1>>>o:0)&~i[1]&~a[1])>>>0,r[0]=(-1>>>Ce(0,on-(e+t+n))&~i[0]&~a[0])>>>0}},{key:"unpackKey",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Re,n=this.maskX,a=this.maskY,i=this.maskZ,r=ve(e/sn),s=e%sn;return t.set((r&n[1])*sn+((s&n[0])>>>0),((r&a[1])*sn+((s&a[0])>>>0))/this.rangeX,((r&i[1])*sn+((s&i[0])>>>0))/this.rangeXY)}},{key:"packKey",value:function(e){return e.z*this.rangeXY+e.y*this.rangeX+e.x}},{key:"keyRange",value:function(e,t){return new an(this,e,t)}},{key:"toString",value:function(){var e=this.maskX,t=this.maskY,n=this.maskZ;return"Key Design\n\nX-Bits: "+this.x+"\nY-Bits: "+this.y+"\nZ-Bits: "+this.z+"\n\n"+nn.createBinaryString(e[1],rn)+" "+e[1]+" (HI-Mask X)\n"+nn.createBinaryString(e[0],rn)+" "+e[0]+" (LO-Mask X)\n\n"+nn.createBinaryString(t[1],rn)+" "+t[1]+" (HI-Mask Y)\n"+nn.createBinaryString(t[0],rn)+" "+t[0]+" (LO-Mask Y)\n\n"+nn.createBinaryString(n[1],rn)+" "+n[1]+" (HI-Mask Z)\n"+nn.createBinaryString(n[0],rn)+" "+n[0]+" (LO-Mask Z)\n"}}],[{key:"BITS",get:function(){return ln}},{key:"HI_BITS",get:function(){return 21}},{key:"LO_BITS",get:function(){return on}}]),e}(),yn=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.lod=n,this.key=a}return i(e,[{key:"set",value:function(e,t){this.lod=e,this.key=t}},{key:"copy",value:function(e){return this.lod=e.lod,this.key=e.key,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),hn=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new yn;t(this,e),this.octant=n,this.id=a,this.min=new Re,this.max=new Re}return i(e,[{key:"copy",value:function(e){return this.octant=e.octant,this.id.copy(e.id),this.min.copy(e.min),this.max.copy(e.max),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re;return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Re;return e.subVectors(this.max,this.min)}},{key:"containsPoint",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=n.x&&e.y<=n.y&&e.z<=n.z}}]),e}(),cn=function(){function e(n){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.world=n,this.cellSize=0,this.iterator=null,this.octantWrapper=new hn,this.octantWrapper.id.lod=a,this.result=new gt,this.reset()}return i(e,[{key:"reset",value:function(){var e=this.octantWrapper.id.lod,t=this.world,n=t.getGrid(e);return void 0===n?console.error("Invalid LOD",e):(this.cellSize=t.getCellSize(e),this.iterator=n.entries(),this.result.reset()),this}},{key:"next",value:function(){var e=this.result,t=this.octantWrapper,n=this.iterator.next(),a=n.value;return n.done?(e.value=null,e.done=!0):(this.keyDesign.unpackKey(a[0],t.min),t.min.multiplyScalar(this.cellSize).add(this.world.min),t.max.copy(t.min).addScalar(this.cellSize),t.id.key=a[0],t.octant=a[1],e.value=t),e}},{key:"return",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),dn=function e(){t(this,e),this.data=null,this.csg=new Oe,this.isosurface=null},mn=function(e){function n(){var e;return t(this,n),e=k(this,u(n).call(this)),e.children=0,e}return o(n,e),n}(dn),vn=new Re,gn=new Re,xn=new j,fn=new j,pn=new j,kn=[],zn=function(){function e(){t(this,e)}return i(e,null,[{key:"applyUnion",value:function(e,t,n){var r=e.getKeyDesign(),s=e.lodZero,l=fn.min,a=fn.max,o=pn.min,u=pn.max,y,h,c,d,m,v;for(m=e.getDepth();0<m;--m){c=e.getGrid(m),e.calculateKeyCoordinates(t.min,m,l),e.calculateKeyCoordinates(t.max,m,a),e.calculateKeyCoordinates(t.min,m-1,o),e.calculateKeyCoordinates(t.max,m-1,u);var g=!0,x=!1,f=void 0;try{for(var p=r.keyRange(l,a)[Symbol.iterator](),k;!(g=(k=p.next()).done);g=!0)if(y=k.value,!c.has(y))for(d=new mn,d.csg.add(n),c.set(y,d),r.unpackKey(y,gn),gn.x<<=1,gn.y<<=1,gn.z<<=1,v=0;8>v;++v)h=pt[v],vn.set(gn.x+h[0],gn.y+h[1],gn.z+h[2]),pn.containsPoint(vn)&&(d.children|=1<<v)}catch(e){x=!0,f=e}finally{try{g||null==p["return"]||p["return"]()}finally{if(x)throw f}}}e.calculateKeyCoordinates(t.min,0,l),e.calculateKeyCoordinates(t.max,0,a);var z=!0,w=!1,S=void 0;try{for(var I=r.keyRange(l,a)[Symbol.iterator](),b;!(z=(b=I.next()).done);z=!0)y=b.value,s.has(y)?d=s.get(y):(d=new dn,s.set(y,d)),d.csg.add(n)}catch(e){w=!0,S=e}finally{try{z||null==I["return"]||I["return"]()}finally{if(w)throw S}}}},{key:"applyDifference",value:function(e,t,n){var r=e.getDepth(),s=e.getKeyDesign(),o=e.getGrid(r),u=e.calculateKeyCoordinates(t.min,r,fn.min),a=e.calculateKeyCoordinates(t.max,r,fn.max),y,h,c,d;for(y=0,h=r-1;y<h;++y)y<kn.length?(c=kn[y],e.calculateKeyCoordinates(t.min,y,c.min),e.calculateKeyCoordinates(t.max,y,c.max)):kn.push(new j(e.calculateKeyCoordinates(t.min,y),e.calculateKeyCoordinates(t.max,y)));var m=!0,v=!1,g=void 0;try{for(var x=s.keyRange(u,a)[Symbol.iterator](),f;!(m=(f=x.next()).done);m=!0)d=f.value,o.has(d)&&(s.unpackKey(d,gn),V(e,n,o.get(d),gn.x,gn.y,gn.z,r))}catch(e){v=!0,g=e}finally{try{m||null==x["return"]||x["return"]()}finally{if(v)throw g}}}},{key:"applyIntersection",value:function(e,t){var n,a;for(n=e.getDepth();0<=n;--n){var i=!0,r=!1,s=void 0;try{for(var l=e.getGrid(n).values()[Symbol.iterator](),o;!(i=(o=l.next()).done);i=!0)a=o.value,a.csg.add(t)}catch(e){r=!0,s=e}finally{try{i||null==l["return"]||l["return"]()}finally{if(r)throw s}}}}},{key:"applyCSG",value:function(e,t){var n=xn.copy(t.getBoundingBox(!0));switch(n.min.max(e.min),n.max.min(e.max),t.operation){case Le.UNION:this.applyUnion(e,n,t);break;case Le.DIFFERENCE:this.applyDifference(e,n,t);break;case Le.INTERSECTION:this.applyIntersection(e,t);break;default:console.error("No CSG operation type specified",t);}}}]),e}(),wn=new Re,Sn=new tt,l=new j,In=new j,d=new st,bn=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],Tn=0,Cn=function(){function e(){t(this,e)}return i(e,null,[{key:"intersectWorldOctree",value:function(e,i){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],s=e.getDepth(),l=e.getGrid(s),o=e.getCellSize(s),u=e.getKeyDesign(),y=new hn,h=Sn.start,c=Sn.end,m=e.containsPoint(d.copy(i).origin)?d.origin:d.intersectBox(e,d.origin),a,v,g,x,f,p,k,z,w,S,I,T,C,A,E,P,D,F,O,M;if(y.id.lod=s,null!==m)for(g=o<<1,x=d.at(g,wn),e.calculateKeyCoordinates(m,s,h),e.calculateKeyCoordinates(x,s,c),p=c.x-h.x,k=c.y-h.y,z=c.z-h.z,E=ge(p),P=ge(k),D=ge(z),w=Te(p),S=Te(k),I=Te(z),T=2*w,C=2*S,A=2*I,F=S-w,O=I-w,M=S-I,f=w+S+I;0<f;--f)a=u.packKey(h),l.has(a)&&(v=l.get(a),y.id.key=a,y.octant=v,y.min.copy(h),y.min.multiplyScalar(o),y.min.add(e.min),y.max.copy(y.min).addScalar(o),null===v.isosurface?X(e,y,h,i,r):r.push(y.clone())),0>F?0>O?(h.x+=E,F+=C,O+=A):(h.z+=D,O-=T,M+=C):0>M?(h.z+=D,O-=T,M+=C):(h.y+=P,F-=T,M-=A);return r}}]),e}(),An=new Re,En=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:20,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new un;for(t(this,e),a=Ce(Ae(ve(a),32),1),this.cellSize=Ce(Ae(ve(n),me(2,33-a)-1),1),this.keyDesign=i,this.grids=[];this.grids.length<a;)this.grids.push(new Map);this.bounds=new hn,this.bounds.min.copy(this.keyDesign.halfRange).multiplyScalar(-this.cellSize),this.bounds.max.copy(this.keyDesign.halfRange).multiplyScalar(this.cellSize)}return i(e,[{key:"getKeyDesign",value:function(){return this.keyDesign}},{key:"getCellSize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return this.cellSize<<e>>>0}},{key:"getCenter",value:function(e){return this.bounds.getCenter(e)}},{key:"setCenter",value:function(e){this.min.copy(this.keyDesign.halfRange).multiplyScalar(-this.cellSize).add(e),this.max.copy(this.keyDesign.halfRange).multiplyScalar(this.cellSize).add(e)}},{key:"getDimensions",value:function(e){return this.bounds.getDimensions(e)}},{key:"getDepth",value:function(){return this.grids.length-1}},{key:"getGrid",value:function(e){return 0<=e&&e<this.grids.length?this.grids[e]:void 0}},{key:"clear",value:function(){var e,t;for(e=0,t=this.grids.length;e<t;++e)this.grids[e].clear()}},{key:"containsPoint",value:function(e){return this.bounds.containsPoint(e)}},{key:"findOctantsByLevel",value:function(e){return this.octants(e)}},{key:"calculateKeyCoordinates",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Re,a=this.cellSize<<t;return An.subVectors(e,this.min),n.set(ve(An.x/a),ve(An.y/a),ve(An.z/a)),n}},{key:"getOctantByPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.keyDesign,a=this.getGrid(t),i;return void 0===a?console.error("Invalid LOD",t):this.containsPoint(e)?(this.calculateKeyCoordinates(e,t,An),i=a.get(n.packKey(An))):console.error("Position out of range",e),i}},{key:"removeOctant",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.keyDesign,a=this.getGrid(t),i,r,s;void 0===a?console.error("Invalid LOD",t):a.has(e)?(n.unpackKey(e,An),i=An.x,r=An.y,s=An.z,Z(this,a.get(e),i,r,s,t),a["delete"](e),_(this,i,r,s,t)):console.error("No octant found",e)}},{key:"applyCSG",value:function(e){zn.applyCSG(this,e)}},{key:"raycast",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return Cn.intersectWorldOctree(this,e,t)}},{key:"octants",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return new cn(this,e)}},{key:"min",get:function(){return this.bounds.min}},{key:"max",get:function(){return this.bounds.max}},{key:"levels",get:function(){return this.grids.length}},{key:"lodZero",get:function(){return this.grids[0]}}],[{key:"calculateOffsetIndex",value:function(e,t,n){return((1&e)<<2)+((1&t)<<1)+(1&n)}}]),e}(),Pn=function(){function e(){t(this,e)}return i(e,[{key:"clone",value:function(){return new this.constructor(this.levels)}},{key:"levels",get:function(){return this.something.length}}]),e}(),Dn=new j,Fn=new Je,f=new c,On=function(e){function n(e){var a;return t(this,n),a=k(this,u(n).call(this)),a.world=e,a.position=new Re(1/0,1/0,1/0),a.currentScene=new Pn(a.world.levels),a.previousScene=a.currentScene.clone(),a.nextScene=a.currentScene.clone(),a}return o(n,e),i(n,[{key:"update",value:function(e){var t=this.position;t.copy(e.position),Fn.setFromMatrix(f.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse))}},{key:"process",value:function(){}},{key:"clear",value:function(){this.previousScene.clear(),this.currentScene.clear(),this.nextScene.clear()}}]),n}(Be),Mn={EXTRACT:"worker.extract",MODIFY:"worker.modify",CONFIGURE:"worker.config",CLOSE:"worker.close"},Bn=function e(){var n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null;t(this,e),this.action=n,this.error=null},Ln=function(e){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,a;return t(this,n),a=k(this,u(n).call(this,e)),a.data=null,a}return o(n,e),n}(Bn),Rn=function(e){function n(){return t(this,n),k(this,u(n).call(this,Mn.EXTRACT))}return o(n,e),n}(Ln),Vn=function(e){function n(){var e;return t(this,n),e=k(this,u(n).call(this,Mn.MODIFY)),e.sdf=null,e.cellSize=0,e.cellPosition=null,e}return o(n,e),n}(Ln),Nn=function(e){function n(){var e;return t(this,n),e=k(this,u(n).call(this,Mn.CONFIGURE)),e.resolution=Xt.resolution,e.errorThreshold=.01,e}return o(n,e),n}(Bn),Un=function(e){function n(){var e;return t(this,n),e=k(this,u(n).call(this,Mn.EXTRACT)),e.isosurface=null,e}return o(n,e),n}(Ln),Yn=function(e){function n(){var e;return t(this,n),e=k(this,u(n).call(this,Mn.MODIFY)),e.sdf=null,e}return o(n,e),n}(Ln),qn=function(e){function n(e){var a;return t(this,n),a=k(this,u(n).call(this,e)),a.worker=null,a.response=null,a}return o(n,e),n}(Me),Xn=new qn("message"),Zn=function(e){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:navigator.hardwareConcurrency,a;return t(this,n),a=k(this,u(n).call(this)),a.workerURL=URL.createObjectURL(new Blob(["function _typeof(e){return _typeof=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},_typeof(e)}(function(){'use strict';var ne=Math.pow,le=Math.trunc,ie=Math.sign,re=Math.PI,oe=Math.atan2,se=Math.round,ye=Math.acos,ue=Math.sqrt,me=Math.cos,xe=Math.sin,pe=Math.floor,ve=Math.ceil,ke=Math.abs,ge=Math.max,he=Math.min;function e(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function t(e,t){for(var a,n=0;n<t.length;n++)a=t[n],a.enumerable=a.enumerable||!1,a.configurable=!0,\"value\"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function n(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function y(e,t){return y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},y(e,t)}function u(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function d(){return d=u()?Reflect.construct:function(e,t,n){var l=[null];l.push.apply(l,t);var a=Function.bind.apply(e,l),i=new a;return n&&y(i,n.prototype),i},d.apply(null,arguments)}function x(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}function k(e,t){return t&&(\"object\"===_typeof(t)||\"function\"==typeof t)?t:x(e)}function g(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=s(e),null!==e););return e}function h(e,t,a){return h=\"undefined\"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var n=g(e,t);if(n){var l=Object.getOwnPropertyDescriptor(n,t);return l.get?l.get.call(a):l.value}},h(e,t,a||e)}function z(e,t,a,n){return z=\"undefined\"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,a,n){var i,r=g(e,t);if(r){if(i=Object.getOwnPropertyDescriptor(r,t),i.set)return i.set.call(n,a),!0;if(!i.writable)return!1}if(i=Object.getOwnPropertyDescriptor(n,t),i){if(!i.writable)return!1;i.value=a,Object.defineProperty(n,t,i)}else l(n,t,a);return!0},z(e,t,a,n)}function f(e,t,a,n,l){var i=z(e,t,a,n||e);if(!i&&l)throw new Error(\"failed to set property\");return a}function S(e){return w(e)||I(e)||T()}function w(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}}function I(e){if(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e))return Array.from(e)}function T(){throw new TypeError(\"Invalid attempt to spread non-iterable instance\")}function C(e,t,a){return ge(he(e,a),t)}function P(e,t,a,n,l,i){var r=0;return e>t&&e>a?(l<e&&(r|=2),i<e&&(r|=1)):t>a?(n<t&&(r|=4),i<t&&(r|=1)):(n<a&&(r|=4),l<a&&(r|=2)),r}function E(e,t,a,n){var l,i=0;return t<a?(l=t,i=0):(l=a,i=1),n<l&&(i=2),r[e][i]}function D(e,t,a,n,l,i,r,o,s){var y,u,d,c,m=e.children;if(0<=l&&0<=i&&0<=r)if(null===m)s.push(e);else{u=.5*(t+l),d=.5*(a+i),c=.5*(n+r),y=P(t,a,n,u,d,c);do 0===y?(D(m[lt],t,a,n,u,d,c,o,s),y=E(y,u,d,c)):1===y?(D(m[1^lt],t,a,c,u,d,r,o,s),y=E(y,u,d,r)):2===y?(D(m[2^lt],t,d,n,u,i,c,o,s),y=E(y,u,i,c)):3===y?(D(m[3^lt],t,d,c,u,i,r,o,s),y=E(y,u,i,r)):4===y?(D(m[4^lt],u,a,n,l,d,c,o,s),y=E(y,l,d,c)):5===y?(D(m[5^lt],u,a,c,l,d,r,o,s),y=E(y,l,d,r)):6===y?(D(m[6^lt],u,d,n,l,i,c,o,s),y=E(y,l,i,c)):7===y?(D(m[7^lt],u,d,c,l,i,r,o,s),y=8):void 0;while(8>y)}}function F(e){var t,a,n,r=e.children,o=0;if(null!==r)for(t=0,a=r.length;t<a;++t)n=1+F(r[t]),n>o&&(o=n);return o}function A(e,t,a){var n,r,o=e.children;if(rt.min=e.min,rt.max=e.max,t.intersectsBox(rt))if(null!==o)for(n=0,r=o.length;n<r;++n)A(o[n],t,a);else a.push(e)}function V(e,t,a,n){var r,o,s=e.children;if(a===t)n.push(e);else if(null!==s)for(++a,r=0,o=s.length;r<o;++r)V(s[r],t,a,n)}function B(e,t){var a,n=e.elements,l=t.elements;0!==n[1]&&(a=wt.calculateCoefficients(n[0],n[1],n[3]),It.rotateQXY(bt.set(n[0],n[3]),n[1],a),n[0]=bt.x,n[3]=bt.y,It.rotateXY(bt.set(n[2],n[4]),a),n[2]=bt.x,n[4]=bt.y,n[1]=0,It.rotateXY(bt.set(l[0],l[3]),a),l[0]=bt.x,l[3]=bt.y,It.rotateXY(bt.set(l[1],l[4]),a),l[1]=bt.x,l[4]=bt.y,It.rotateXY(bt.set(l[2],l[5]),a),l[2]=bt.x,l[5]=bt.y)}function N(e,t){var a,n=e.elements,l=t.elements;0!==n[2]&&(a=wt.calculateCoefficients(n[0],n[2],n[5]),It.rotateQXY(bt.set(n[0],n[5]),n[2],a),n[0]=bt.x,n[5]=bt.y,It.rotateXY(bt.set(n[1],n[4]),a),n[1]=bt.x,n[4]=bt.y,n[2]=0,It.rotateXY(bt.set(l[0],l[6]),a),l[0]=bt.x,l[6]=bt.y,It.rotateXY(bt.set(l[1],l[7]),a),l[1]=bt.x,l[7]=bt.y,It.rotateXY(bt.set(l[2],l[8]),a),l[2]=bt.x,l[8]=bt.y)}function O(e,t){var a,n=e.elements,l=t.elements;0!==n[4]&&(a=wt.calculateCoefficients(n[3],n[4],n[5]),It.rotateQXY(bt.set(n[3],n[5]),n[4],a),n[3]=bt.x,n[5]=bt.y,It.rotateXY(bt.set(n[1],n[2]),a),n[1]=bt.x,n[2]=bt.y,n[4]=0,It.rotateXY(bt.set(l[3],l[6]),a),l[3]=bt.x,l[6]=bt.y,It.rotateXY(bt.set(l[4],l[7]),a),l[4]=bt.x,l[7]=bt.y,It.rotateXY(bt.set(l[5],l[8]),a),l[5]=bt.x,l[8]=bt.y)}function L(t,a){var n,l=t.elements;for(n=0;n<5;++n)B(t,a),N(t,a),O(t,a);return Et.set(l[0],l[3],l[5])}function M(e){var t=ke(e)<Tt?0:1/e;return ke(t)<Tt?0:t}function R(e,t){var a=e.elements,n=a[0],l=a[3],i=a[6],r=a[1],o=a[4],s=a[7],y=a[2],u=a[5],d=a[8],c=M(t.x),m=M(t.y),x=M(t.z);return e.set(n*c*n+l*m*l+i*x*i,n*c*r+l*m*o+i*x*s,n*c*y+l*m*u+i*x*d,r*c*n+o*m*l+s*x*i,r*c*r+o*m*o+s*x*s,r*c*y+o*m*u+s*x*d,y*c*n+u*m*l+d*x*i,y*c*r+u*m*o+d*x*s,y*c*y+u*m*u+d*x*d)}function Y(e,t,a){return e.applyToVector3(Ft.copy(a)),Ft.subVectors(t,Ft),Ft.dot(Ft)}function X(e,t,a){var n,l,r,o,s,y,u,d=[-1,-1,-1,-1],c=[!1,!1,!1,!1],m=1/0,x=0,p=!1;for(u=0;4>u;++u)s=e[u],y=Ut[t][u],n=Je[y][0],l=Je[y][1],r=1&s.voxel.materials>>n,o=1&s.voxel.materials>>l,s.size<m&&(m=s.size,x=u,p=r!==vt.AIR),d[u]=s.voxel.index,c[u]=r!==o;c[x]&&(p?(a.push(d[0]),a.push(d[3]),a.push(d[1]),a.push(d[0]),a.push(d[2]),a.push(d[3])):(a.push(d[0]),a.push(d[1]),a.push(d[3]),a.push(d[0]),a.push(d[3]),a.push(d[2])))}function Z(e,t,a){var n,l,r,o,s=[0,0,0,0];if(null!==e[0].voxel&&null!==e[1].voxel&&null!==e[2].voxel&&null!==e[3].voxel)X(e,t,a);else for(r=0;2>r;++r){for(s[0]=_t[t][r][0],s[1]=_t[t][r][1],s[2]=_t[t][r][2],s[3]=_t[t][r][3],n=[],o=0;4>o;++o)if(l=e[o],null!==l.voxel)n[o]=l;else if(null!==l.children)n[o]=l.children[s[o]];else break;4===o&&Z(n,_t[t][r][4],a)}}function _(e,t,a){var n,l,r,o,s,y,u=[0,0,0,0],d=[[0,0,1,1],[0,1,0,1]];if(null!==e[0].children||null!==e[1].children){for(s=0;4>s;++s)u[0]=Xt[t][s][0],u[1]=Xt[t][s][1],n=[null===e[0].children?e[0]:e[0].children[u[0]],null===e[1].children?e[1]:e[1].children[u[1]]],_(n,Xt[t][s][2],a);for(s=0;4>s;++s){for(u[0]=Zt[t][s][1],u[1]=Zt[t][s][2],u[2]=Zt[t][s][3],u[3]=Zt[t][s][4],r=d[Zt[t][s][0]],l=[],y=0;4>y;++y)if(o=e[r[y]],null!==o.voxel)l[y]=o;else if(null!==o.children)l[y]=o.children[u[y]];else break;4===y&&Z(l,Zt[t][s][5],a)}}}function U(e,t){var a,n,l,r=e.children,o=[0,0,0,0];if(null!==r){for(l=0;8>l;++l)U(r[l],t);for(l=0;12>l;++l)o[0]=Rt[l][0],o[1]=Rt[l][1],a=[r[o[0]],r[o[1]]],_(a,Rt[l][2],t);for(l=0;6>l;++l)o[0]=Yt[l][0],o[1]=Yt[l][1],o[2]=Yt[l][2],o[3]=Yt[l][3],n=[r[o[0]],r[o[1]],r[o[2]],r[o[3]]],Z(n,Yt[l][4],t)}}function j(e,t,a,n){var l,r;if(null!==e.children)for(l=0;8>l;++l)n=j(e.children[l],t,a,n);else null!==e.voxel&&(r=e.voxel,r.index=n,t[3*n]=r.position.x,t[3*n+1]=r.position.y,t[3*n+2]=r.position.z,a[3*n]=r.normal.x,a[3*n+1]=r.normal.y,a[3*n+2]=r.normal.z,++n);return n}function Q(e,t,a,l,r){var o=0;for(t>>=1;0<t;t>>=1,o=0)a>=t&&(o+=4,a-=t),l>=t&&(o+=2,l-=t),r>=t&&(o+=1,r-=t),null===e.children&&e.split(),e=e.children[o];return e}function G(e,t,a,n,l){var r,o,s,y,u,d,c,x,p,v,k=e+1,m=new Vt;for(r=0,v=0;8>v;++v)y=He[v],u=(n+y[2])*(k*k)+(a+y[1])*k+(t+y[0]),s=he(l[u],vt.SOLID),r|=s<<v;for(o=0,v=0;12>v;++v)d=Je[v][0],c=Je[v][1],x=1&r>>d,p=1&r>>c,x!==p&&++o;return m.materials=r,m.edgeCount=o,m.qefData=new ft,m}function H(e){var t=ra,a=zt.resolution,n=new fe(0,0,0),l=new fe(a,a,a),i=new v(oa,oa.clone().addScalar(ra)),r=e.getBoundingBox();return e.type!==ta.INTERSECTION&&(r.intersectsBox(i)?(n.copy(r.min).max(i.min).sub(i.min),n.x=ve(n.x*a/t),n.y=ve(n.y*a/t),n.z=ve(n.z*a/t),l.copy(r.max).min(i.max).sub(i.min),l.x=pe(l.x*a/t),l.y=pe(l.y*a/t),l.z=pe(l.z*a/t)):(n.set(a,a,a),l.set(0,0,0))),new v(n,l)}function J(e,t,a,l){var i,r,o,s=zt.resolution,n=s+1,u=l.max.x,d=l.max.y,c=l.max.z;for(o=l.min.z;o<=c;++o)for(r=l.min.y;r<=d;++r)for(i=l.min.x;i<=u;++i)e.updateMaterialIndex(o*(n*n)+r*n+i,t,a)}function K(e,t,a){var l,i,r,o,u=ra,s=zt.resolution,n=s+1,d=t.materialIndices,c=new fe,m=new fe,p=a.max.x,v=a.max.y,k=a.max.z,g=0;for(o=a.min.z;o<=k;++o)for(c.z=o*u/s,r=a.min.y;r<=v;++r)for(c.y=r*u/s,i=a.min.x;i<=p;++i)c.x=i*u/s,l=e.generateMaterialIndex(m.addVectors(oa,c)),l!==vt.AIR&&(d[o*(n*n)+r*n+i]=l,++g);t.materials=g}function W(e,t,a){var l,r,o,s,y,u,x,p,v,k,g,h,z,f,S,w,I,T,C,P,b,E,D,F=zt.resolution,n=F+1,m=new Uint32Array([1,n,n*n]),A=t.materialIndices,V=new ut,B=new ut,N=a.edgeData,O=t.edgeData,q=new Uint32Array(3),L=pt.calculate1DEdgeCount(F),M=new pt(F,he(L,O.indices[0].length+N.indices[0].length),he(L,O.indices[1].length+N.indices[1].length),he(L,O.indices[2].length+N.indices[2].length));for(T=0,C=0;3>C;T=0,++C){for(l=N.indices[C],s=O.indices[C],x=M.indices[C],r=N.zeroCrossings[C],y=O.zeroCrossings[C],p=M.zeroCrossings[C],o=N.normals[C],u=O.normals[C],v=M.normals[C],k=m[C],E=l.length,D=s.length,(P=0,b=0);P<E;++P)if(g=l[P],h=g+k,S=A[g],w=A[h],S!==w&&(S===vt.AIR||w===vt.AIR)){for(V.t=r[P],V.n.x=o[3*P],V.n.y=o[3*P+1],V.n.z=o[3*P+2],e.type===ta.DIFFERENCE&&V.n.negate(),I=V;b<D&&s[b]<=g;)z=s[b],f=z+k,B.t=y[b],B.n.x=u[3*b],B.n.y=u[3*b+1],B.n.z=u[3*b+2],S=A[z],z<g?(w=A[f],S!==w&&(S===vt.AIR||w===vt.AIR)&&(x[T]=z,p[T]=B.t,v[3*T]=B.n.x,v[3*T+1]=B.n.y,v[3*T+2]=B.n.z,++T)):I=e.selectEdge(B,V,S===vt.SOLID),++b;x[T]=g,p[T]=I.t,v[3*T]=I.n.x,v[3*T+1]=I.n.y,v[3*T+2]=I.n.z,++T}for(;b<D;)z=s[b],f=z+k,S=A[z],w=A[f],S!==w&&(S===vt.AIR||w===vt.AIR)&&(x[T]=z,p[T]=y[b],v[3*T]=u[3*b],v[3*T+1]=u[3*b+1],v[3*T+2]=u[3*b+2],++T),++b;q[C]=T}return{edgeData:M,lengths:q}}function $(e,t,l){var i,r,o,u,p,v,k,g,h,f,S,w,I,T,C,P,b,E,D,F=ra,s=zt.resolution,n=s+1,m=n*n,A=new Uint32Array([1,n,m]),V=t.materialIndices,B=oa,N=new fe,O=new fe,q=new ut,L=new Uint32Array(3),M=new pt(s,pt.calculate1DEdgeCount(s));for(C=4,I=0,T=0;3>T;C>>=1,I=0,++T){P=He[C],i=M.indices[T],r=M.zeroCrossings[T],o=M.normals[T],u=A[T],k=l.min.x,f=l.max.x,g=l.min.y,S=l.max.y,h=l.min.z,w=l.max.z;for(0===T?(k=ge(k-1,0),f=he(f,s-1)):1===T?(g=ge(g-1,0),S=he(S,s-1)):2===T?(h=ge(h-1,0),w=he(w,s-1)):void 0,D=h;D<=w;++D)for(E=g;E<=S;++E)for(b=k;b<=f;++b)p=D*m+E*n+b,v=p+u,V[p]!==V[v]&&(N.set(b*F/s,E*F/s,D*F/s),O.set((b+P[0])*F/s,(E+P[1])*F/s,(D+P[2])*F/s),q.a.addVectors(B,N),q.b.addVectors(B,O),e.generateEdge(q),i[I]=p,r[I]=q.t,o[3*I]=q.n.x,o[3*I+1]=q.n.y,o[3*I+2]=q.n.z,++I);L[T]=I}return{edgeData:M,lengths:L}}function ee(e,t,a){var n,l,i,r,o=H(e),s=!1;if(e.type===ta.DENSITY_FUNCTION?K(e,t,o):t.empty?e.type===ta.UNION&&(t.set(a),s=!0):!(t.full&&e.type===ta.UNION)&&J(e,t,a,o),!s&&!t.empty&&!t.full){for(n=e.type===ta.DENSITY_FUNCTION?$(e,t,o):W(e,t,a),l=n.edgeData,i=n.lengths,r=0;3>r;++r)l.indices[r]=l.indices[r].slice(0,i[r]),l.zeroCrossings[r]=l.zeroCrossings[r].slice(0,i[r]),l.normals[r]=l.normals[r].slice(0,3*i[r]);t.edgeData=l}}function te(e){var t,a,n,r,o=e.children;for(e.type===ta.DENSITY_FUNCTION&&(t=new zt,ee(e,t)),n=0,r=o.length;n<r&&(a=te(o[n]),void 0===t?t=a:null===a?e.type===ta.INTERSECTION&&(t=null):null===t?e.type===ta.UNION&&(t=a):ee(e,t,a),null!==t||e.type===ta.UNION);++n);return null!==t&&t.empty?null:t}function ae(e){var t=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\"),a=t.getContext(\"2d\");return t.width=e.width,t.height=e.height,a.drawImage(e,0,0),a.getImageData(0,0,e.width,e.height)}var ze=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;e(this,t),this.runLengths=a,this.data=n}return n(t,null,[{key:\"encode\",value:function(e){var a,n,r=[],o=[],s=e[0],y=1;for(a=1,n=e.length;a<n;++a)s===e[a]?++y:(r.push(y),o.push(s),s=e[a],y=1);return r.push(y),o.push(s),new t(r,o)}},{key:\"decode\",value:function(e,t){var a,n,l,r,o,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],y=0;for(n=0,r=t.length;n<r;++n)for(a=t[n],l=0,o=e[n];l<o;++l)s[y++]=a;return s}}]),t}(),fe=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.x=a,this.y=n,this.z=l}return n(t,[{key:\"set\",value:function(e,t,a){return this.x=e,this.y=t,this.z=a,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:\"setFromSpherical\",value:function(e){this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:\"setFromSphericalCoords\",value:function(e,t,a){var n=xe(t)*e;return this.x=n*xe(a),this.y=me(t)*e,this.z=n*me(a),this}},{key:\"setFromCylindrical\",value:function(e){this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:\"setFromCylindricalCoords\",value:function(e,t,a){return this.x=e*xe(t),this.y=a,this.z=e*me(t),this}},{key:\"setFromMatrixColumn\",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:\"setFromMatrixPosition\",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:\"setFromMatrixScale\",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),a=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=a,this.z=n,this}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:\"addVectors\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:\"addScaledVector\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:\"subVectors\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:\"multiplyVectors\",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this}},{key:\"crossVectors\",value:function(e,t){var a=e.x,n=e.y,l=e.z,i=t.x,r=t.y,o=t.z;return this.x=n*o-l*r,this.y=l*i-a*o,this.z=a*r-n*i,this}},{key:\"cross\",value:function(e){return this.crossVectors(this,e)}},{key:\"transformDirection\",value:function(t){var a=this.x,n=this.y,l=this.z,i=t.elements;return this.x=i[0]*a+i[4]*n+i[8]*l,this.y=i[1]*a+i[5]*n+i[9]*l,this.z=i[2]*a+i[6]*n+i[10]*l,this.normalize()}},{key:\"applyMatrix3\",value:function(t){var a=this.x,n=this.y,l=this.z,i=t.elements;return this.x=i[0]*a+i[3]*n+i[6]*l,this.y=i[1]*a+i[4]*n+i[7]*l,this.z=i[2]*a+i[5]*n+i[8]*l,this}},{key:\"applyMatrix4\",value:function(t){var a=this.x,n=this.y,l=this.z,i=t.elements;return this.x=i[0]*a+i[4]*n+i[8]*l+i[12],this.y=i[1]*a+i[5]*n+i[9]*l+i[13],this.z=i[2]*a+i[6]*n+i[10]*l+i[14],this}},{key:\"applyQuaternion\",value:function(e){var t=this.x,a=this.y,n=this.z,l=e.x,i=e.y,r=e.z,o=e.w,s=o*t+i*n-r*a,y=o*a+r*t-l*n,u=o*n+l*a-i*t,d=-l*t-i*a-r*n;return this.x=s*o+d*-l+y*-r-u*-i,this.y=y*o+d*-i+u*-l-s*-r,this.z=u*o+d*-r+s*-i-y*-l,this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:\"reflect\",value:function(e){var t=e.x,a=e.y,n=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(t,a,n),this}},{key:\"angleTo\",value:function(e){var t=this.dot(e)/ue(this.lengthSquared()*e.lengthSquared());return ye(he(ge(t,-1),1))}},{key:\"manhattanLength\",value:function(){return ke(this.x)+ke(this.y)+ke(this.z)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:\"length\",value:function(){return ue(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:\"manhattanDistanceTo\",value:function(e){return ke(this.x-e.x)+ke(this.y-e.y)+ke(this.z-e.z)}},{key:\"distanceToSquared\",value:function(e){var t=this.x-e.x,a=this.y-e.y,n=this.z-e.z;return t*t+a*a+n*n}},{key:\"distanceTo\",value:function(e){return ue(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=he(this.x,e.x),this.y=he(this.y,e.y),this.z=he(this.z,e.z),this}},{key:\"max\",value:function(e){return this.x=ge(this.x,e.x),this.y=ge(this.y,e.y),this.z=ge(this.z,e.z),this}},{key:\"clamp\",value:function(e,t){return this.x=ge(e.x,he(t.x,this.x)),this.y=ge(e.y,he(t.y,this.y)),this.z=ge(e.z,he(t.z,this.z)),this}},{key:\"floor\",value:function(){return this.x=pe(this.x),this.y=pe(this.y),this.z=pe(this.z),this}},{key:\"ceil\",value:function(){return this.x=ve(this.x),this.y=ve(this.y),this.z=ve(this.z),this}},{key:\"round\",value:function(){return this.x=se(this.x),this.y=se(this.y),this.z=se(this.z),this}},{key:\"lerp\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:\"lerpVectors\",value:function(e,t,a){return this.subVectors(t,e).multiplyScalar(a).add(e)}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}]),t}(),Se=new fe,o=[new fe,new fe,new fe,new fe,new fe,new fe,new fe,new fe],v=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new fe(1/0,1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new fe(-Infinity,-Infinity,-Infinity);e(this,t),this.min=a,this.max=n}return n(t,[{key:\"set\",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:\"copy\",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"makeEmpty\",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-Infinity,this}},{key:\"isEmpty\",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new fe;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getSize\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new fe;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:\"setFromSphere\",value:function(e){return this.set(e.center,e.center),this.expandByScalar(e.radius),this}},{key:\"expandByPoint\",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:\"expandByVector\",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:\"expandByScalar\",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:\"setFromPoints\",value:function(e){var t,a;for(this.min.set(0,0,0),this.max.set(0,0,0),(t=0,a=e.length);t<a;++t)this.expandByPoint(e[t]);return this}},{key:\"setFromCenterAndSize\",value:function(e,t){var a=Se.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(a),this.max.copy(e).add(a),this}},{key:\"clampPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new fe;return t.copy(e).clamp(this.min,this.max)}},{key:\"distanceToPoint\",value:function(e){var t=Se.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:\"applyMatrix4\",value:function(e){var t=this.min,a=this.max;return this.isEmpty()||(o[0].set(t.x,t.y,t.z).applyMatrix4(e),o[1].set(t.x,t.y,a.z).applyMatrix4(e),o[2].set(t.x,a.y,t.z).applyMatrix4(e),o[3].set(t.x,a.y,a.z).applyMatrix4(e),o[4].set(a.x,t.y,t.z).applyMatrix4(e),o[5].set(a.x,t.y,a.z).applyMatrix4(e),o[6].set(a.x,a.y,t.z).applyMatrix4(e),o[7].set(a.x,a.y,a.z).applyMatrix4(e),this.setFromPoints(o)),this}},{key:\"translate\",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:\"intersect\",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:\"union\",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:\"containsPoint\",value:function(e){var t=this.min,a=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=a.x&&e.y<=a.y&&e.z<=a.z}},{key:\"containsBox\",value:function(e){var t=this.min,a=this.max,n=e.min,l=e.max;return t.x<=n.x&&l.x<=a.x&&t.y<=n.y&&l.y<=a.y&&t.z<=n.z&&l.z<=a.z}},{key:\"intersectsBox\",value:function(e){var t=this.min,a=this.max,n=e.min,l=e.max;return l.x>=t.x&&l.y>=t.y&&l.z>=t.z&&n.x<=a.x&&n.y<=a.y&&n.z<=a.z}},{key:\"intersectsSphere\",value:function(e){var t=this.clampPoint(e.center,Se);return t.distanceToSquared(e.center)<=e.radius*e.radius}},{key:\"intersectsPlane\",value:function(e){var t,a;return 0<e.normal.x?(t=e.normal.x*this.min.x,a=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,a=e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,a+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,a+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,a+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,a+=e.normal.z*this.min.z),t<=-e.constant&&a>=-e.constant}},{key:\"equals\",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),t}(),de=new v,ce=new fe,we=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new fe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.center=a,this.radius=n}return n(t,[{key:\"set\",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:\"copy\",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromPoints\",value:function(e){var t,a,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:de.setFromPoints(e).getCenter(this.center),r=0;for(t=0,a=e.length;t<a;++t)r=ge(r,n.distanceToSquared(e[t]));return this.radius=ue(r),this}},{key:\"setFromBox\",value:function(e){return e.getCenter(this.center),this.radius=.5*e.getSize(ce).length(),this}},{key:\"isEmpty\",value:function(){return 0>=this.radius}},{key:\"translate\",value:function(e){return this.center.add(e),this}},{key:\"clampPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new fe,a=this.center.distanceToSquared(e);return t.copy(e),a>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:\"distanceToPoint\",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:\"containsPoint\",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:\"intersectsSphere\",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:\"intersectsBox\",value:function(e){return e.intersectsSphere(this)}},{key:\"intersectsPlane\",value:function(e){return ke(e.distanceToPoint(this.center))<=this.radius}},{key:\"equals\",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}]),t}(),Ie=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.x=a,this.y=n}return n(t,[{key:\"set\",value:function(e,t){return this.x=e,this.y=t,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this}},{key:\"addVectors\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:\"addScaledVector\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this}},{key:\"subVectors\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this}},{key:\"applyMatrix3\",value:function(t){var a=this.x,n=this.y,l=t.elements;return this.x=l[0]*a+l[3]*n+l[6],this.y=l[1]*a+l[4]*n+l[7],this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y}},{key:\"cross\",value:function(e){return this.x*e.y-this.y*e.x}},{key:\"manhattanLength\",value:function(){return ke(this.x)+ke(this.y)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y}},{key:\"length\",value:function(){return ue(this.x*this.x+this.y*this.y)}},{key:\"manhattanDistanceTo\",value:function(e){return ke(this.x-e.x)+ke(this.y-e.y)}},{key:\"distanceToSquared\",value:function(e){var t=this.x-e.x,a=this.y-e.y;return t*t+a*a}},{key:\"distanceTo\",value:function(e){return ue(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=he(this.x,e.x),this.y=he(this.y,e.y),this}},{key:\"max\",value:function(e){return this.x=ge(this.x,e.x),this.y=ge(this.y,e.y),this}},{key:\"clamp\",value:function(e,t){return this.x=ge(e.x,he(t.x,this.x)),this.y=ge(e.y,he(t.y,this.y)),this}},{key:\"floor\",value:function(){return this.x=pe(this.x),this.y=pe(this.y),this}},{key:\"ceil\",value:function(){return this.x=ve(this.x),this.y=ve(this.y),this}},{key:\"round\",value:function(){return this.x=se(this.x),this.y=se(this.y),this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:\"angle\",value:function e(){var e=oe(this.y,this.x);return 0>e&&(e+=2*re),e}},{key:\"lerp\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:\"lerpVectors\",value:function(e,t,a){return this.subVectors(t,e).multiplyScalar(a).add(e)}},{key:\"rotateAround\",value:function(e,t){var a=me(t),n=xe(t),l=this.x-e.x,i=this.y-e.y;return this.x=l*a-i*n+e.x,this.y=l*n+i*a+e.y,this}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y}},{key:\"width\",get:function(){return this.x},set:function(e){return this.x=e}},{key:\"height\",get:function(){return this.y},set:function(e){return this.y=e}}]),t}(),Te=new Ie,Ce=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Ie(1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Ie(-Infinity,-Infinity);e(this,t),this.min=a,this.max=n}return n(t,[{key:\"set\",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:\"copy\",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"makeEmpty\",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-Infinity,this}},{key:\"isEmpty\",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Ie;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getSize\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Ie;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:\"getBoundingSphere\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new we;return this.getCenter(e.center),e.radius=.5*this.getSize(Te).length(),e}},{key:\"expandByPoint\",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:\"expandByVector\",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:\"expandByScalar\",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:\"setFromPoints\",value:function(e){var t,a;for(this.min.set(0,0),this.max.set(0,0),(t=0,a=e.length);t<a;++t)this.expandByPoint(e[t]);return this}},{key:\"setFromCenterAndSize\",value:function(e,t){var a=Te.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(a),this.max.copy(e).add(a),this}},{key:\"clampPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Ie;return t.copy(e).clamp(this.min,this.max)}},{key:\"distanceToPoint\",value:function(e){var t=Te.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:\"translate\",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:\"intersect\",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:\"union\",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:\"containsPoint\",value:function(e){var t=this.min,a=this.max;return e.x>=t.x&&e.y>=t.y&&e.x<=a.x&&e.y<=a.y}},{key:\"containsBox\",value:function(e){var t=this.min,a=this.max,n=e.min,l=e.max;return t.x<=n.x&&l.x<=a.x&&t.y<=n.y&&l.y<=a.y}},{key:\"intersectsBox\",value:function(e){var t=this.min,a=this.max,n=e.min,l=e.max;return l.x>=t.x&&l.y>=t.y&&n.x<=a.x&&n.y<=a.y}},{key:\"equals\",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),t}(),Pe=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.radius=a,this.theta=n,this.y=l}return n(t,[{key:\"set\",value:function(e,t,a){return this.radius=e,this.theta=t,this.y=a,this}},{key:\"copy\",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromVector3\",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:\"setFromCartesianCoords\",value:function(e,t,a){return this.radius=ue(e*e+a*a),this.theta=oe(e,a),this.y=t,this}}]),t}(),be=function(){function t(){e(this,t),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return n(t,[{key:\"set\",value:function(e,t,a,n,l,i,r,o,s){var y=this.elements;return y[0]=e,y[3]=t,y[6]=a,y[1]=n,y[4]=l,y[7]=i,y[2]=r,y[5]=o,y[8]=s,this}},{key:\"identity\",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:\"copy\",value:function(e){var t=e.elements,a=this.elements;return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],this}},{key:\"clone\",value:function(){return new this.constructor().fromArray(this.elements)}},{key:\"fromArray\",value:function(e){var t,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(t=0;9>t;++t)n[t]=e[t+a];return this}},{key:\"toArray\",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(e=0;9>e;++e)t[e+a]=n[e];return t}},{key:\"multiplyMatrices\",value:function(e,t){var a=e.elements,n=t.elements,l=this.elements,i=a[0],r=a[3],o=a[6],s=a[1],y=a[4],u=a[7],d=a[2],c=a[5],m=a[8],x=n[0],p=n[3],v=n[6],k=n[1],g=n[4],h=n[7],z=n[2],f=n[5],S=n[8];return l[0]=i*x+r*k+o*z,l[3]=i*p+r*g+o*f,l[6]=i*v+r*h+o*S,l[1]=s*x+y*k+u*z,l[4]=s*p+y*g+u*f,l[7]=s*v+y*h+u*S,l[2]=d*x+c*k+m*z,l[5]=d*p+c*g+m*f,l[8]=d*v+c*h+m*S,this}},{key:\"multiply\",value:function(e){return this.multiplyMatrices(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyMatrices(e,this)}},{key:\"multiplyScalar\",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:\"determinant\",value:function(){var t=this.elements,n=t[0],a=t[1],l=t[2],r=t[3],o=t[4],e=t[5],s=t[6],y=t[7],u=t[8];return n*o*u-n*e*y-a*r*u+a*e*s+l*r*y-l*o*s}},{key:\"getInverse\",value:function(e){var t,a=e.elements,n=this.elements,l=a[0],i=a[1],r=a[2],o=a[3],s=a[4],y=a[5],u=a[6],d=a[7],c=a[8],m=c*s-y*d,x=y*u-c*o,p=d*o-s*u,v=l*m+i*x+r*p;return 0===v?(console.error(\"Can't invert matrix, determinant is zero\",e),this.identity()):(t=1/v,n[0]=m*t,n[1]=(r*d-c*i)*t,n[2]=(y*i-r*s)*t,n[3]=x*t,n[4]=(c*l-r*u)*t,n[5]=(r*o-y*l)*t,n[6]=p*t,n[7]=(i*u-d*l)*t,n[8]=(s*l-i*o)*t),this}},{key:\"transpose\",value:function(){var e,a=this.elements;return e=a[1],a[1]=a[3],a[3]=e,e=a[2],a[2]=a[6],a[6]=e,e=a[5],a[5]=a[7],a[7]=e,this}},{key:\"scale\",value:function(e,t){var a=this.elements;return a[0]*=e,a[3]*=e,a[6]*=e,a[1]*=t,a[4]*=t,a[7]*=t,this}},{key:\"rotate\",value:function(e){var t=me(e),a=xe(e),n=this.elements,l=n[0],i=n[3],r=n[6],o=n[1],s=n[4],y=n[7];return n[0]=t*l+a*o,n[3]=t*i+a*s,n[6]=t*r+a*y,n[1]=-a*l+t*o,n[4]=-a*i+t*s,n[7]=-a*r+t*y,this}},{key:\"translate\",value:function(e,t){var a=this.elements;return a[0]+=e*a[2],a[3]+=e*a[5],a[6]+=e*a[8],a[1]+=t*a[2],a[4]+=t*a[5],a[7]+=t*a[8],this}},{key:\"equals\",value:function(e){var t,a=this.elements,n=e.elements,l=!0;for(t=0;l&&9>t;++t)a[t]!==n[t]&&(l=!1);return l}}]),t}(),Ee={XYZ:\"XYZ\",YZX:\"YZX\",ZXY:\"ZXY\",XZY:\"XZY\",YXZ:\"YXZ\",ZYX:\"ZYX\"},De=function(){var a=Number.EPSILON;function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;e(this,t),this.x=a,this.y=n,this.z=l,this.w=i}return n(t,[{key:\"set\",value:function(e,t,a,n){return this.x=e,this.y=t,this.z=a,this.w=n,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:\"setFromEuler\",value:function(e){var t=e.x,a=e.y,n=e.z,l=me,i=xe,r=l(t/2),o=l(a/2),s=l(n/2),y=i(t/2),u=i(a/2),d=i(n/2);switch(e.order){case Ee.XYZ:this.x=y*o*s+r*u*d,this.y=r*u*s-y*o*d,this.z=r*o*d+y*u*s,this.w=r*o*s-y*u*d;break;case Ee.YXZ:this.x=y*o*s+r*u*d,this.y=r*u*s-y*o*d,this.z=r*o*d-y*u*s,this.w=r*o*s+y*u*d;break;case Ee.ZXY:this.x=y*o*s-r*u*d,this.y=r*u*s+y*o*d,this.z=r*o*d+y*u*s,this.w=r*o*s-y*u*d;break;case Ee.ZYX:this.x=y*o*s-r*u*d,this.y=r*u*s+y*o*d,this.z=r*o*d-y*u*s,this.w=r*o*s+y*u*d;break;case Ee.YZX:this.x=y*o*s+r*u*d,this.y=r*u*s+y*o*d,this.z=r*o*d-y*u*s,this.w=r*o*s-y*u*d;break;case Ee.XZY:this.x=y*o*s-r*u*d,this.y=r*u*s-y*o*d,this.z=r*o*d+y*u*s,this.w=r*o*s+y*u*d;}return this}},{key:\"setFromAxisAngle\",value:function(e,t){var a=t/2,n=xe(a);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=me(a),this}},{key:\"setFromRotationMatrix\",value:function(e){var t,a=e.elements,n=a[0],l=a[4],i=a[8],r=a[1],o=a[5],y=a[9],u=a[2],d=a[6],c=a[10],m=n+o+c;return 0<m?(t=.5/ue(m+1),this.w=.25/t,this.x=(d-y)*t,this.y=(i-u)*t,this.z=(r-l)*t):n>o&&n>c?(t=2*ue(1+n-o-c),this.w=(d-y)/t,this.x=.25*t,this.y=(l+r)/t,this.z=(i+u)/t):o>c?(t=2*ue(1+o-n-c),this.w=(i-u)/t,this.x=(l+r)/t,this.y=.25*t,this.z=(y+d)/t):(t=2*ue(1+c-n-o),this.w=(r-l)/t,this.x=(i+u)/t,this.y=(y+d)/t,this.z=.25*t),this}},{key:\"setFromUnitVectors\",value:function(e,t){var a=e.dot(t)+1;return 1e-6>a?(a=0,ke(e.x)>ke(e.z)?(this.x=-e.y,this.y=e.x,this.z=0,this.w=a):(this.x=0,this.y=-e.z,this.z=e.y,this.w=a)):(this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this.w=a),this.normalize()}},{key:\"angleTo\",value:function(e){return 2*ye(ke(he(ge(this.dot(e),-1),1)))}},{key:\"rotateTowards\",value:function(e,t){var a=this.angleTo(e);return 0!==a&&this.slerp(e,he(1,t/a)),this}},{key:\"invert\",value:function(){return this.conjugate()}},{key:\"conjugate\",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:\"length\",value:function(){return ue(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:\"normalize\",value:function(){var e,t=this.length();return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/t,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:\"multiplyQuaternions\",value:function(e,t){var a=e.x,n=e.y,l=e.z,i=e.w,r=t.x,o=t.y,s=t.z,y=t.w;return this.x=a*y+i*r+n*s-l*o,this.y=n*y+i*o+l*r-a*s,this.z=l*y+i*s+a*o-n*r,this.w=i*y-a*r-n*o-l*s,this}},{key:\"multiply\",value:function(e){return this.multiplyQuaternions(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyQuaternions(e,this)}},{key:\"slerp\",value:function(e,n){var t,l,i,r,o,u,d,c=this.x,m=this.y,y=this.z,x=this.w;return 1===n?this.copy(e):0<n&&(t=x*e.w+c*e.x+m*e.y+y*e.z,0>t?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,t=-t):this.copy(e),1<=t?(this.w=x,this.x=c,this.y=m,this.z=y):(l=1-t*t,o=1-n,l<=a?(this.w=o*x+n*this.w,this.x=o*c+n*this.x,this.y=o*m+n*this.y,this.z=o*y+n*this.z,this.normalize()):(i=ue(l),r=oe(i,t),u=xe(o*r)/i,d=xe(n*r)/i,this.w=x*u+this.w*d,this.x=c*u+this.x*d,this.y=m*u+this.y*d,this.z=y*u+this.z*d))),this}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}],[{key:\"slerp\",value:function(e,a,n,l){return n.copy(e).slerp(a,l)}},{key:\"slerpFlat\",value:function(e,n,l,i,r,o,y){var u,d,c,m,x,p,v,k,g=r[o],h=r[o+1],z=r[o+2],S=r[o+3],w=l[i],I=l[i+1],T=l[i+2],C=l[i+3];(C!==S||w!==g||I!==h||T!==z)&&(u=1-y,m=w*g+I*h+T*z+C*S,p=0<=m?1:-1,x=1-m*m,x>a&&(c=ue(x),v=oe(c,m*p),u=xe(u*v)/c,y=xe(y*v)/c),k=y*p,w=w*u+g*k,I=I*u+h*k,T=T*u+z*k,C=C*u+S*k,u===1-y&&(d=1/ue(w*w+I*I+T*T+C*C),w*=d,I*=d,T*=d,C*=d)),e[n]=w,e[n+1]=I,e[n+2]=T,e[n+3]=C}}]),t}(),Fe=new be,m=new De,q=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.x=a,this.y=n,this.z=l,this.order=t.defaultOrder}return n(t,[{key:\"set\",value:function(e,t,a,n){return this.x=e,this.y=t,this.z=a,this.order=n,this}},{key:\"copy\",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.order=e[t+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.order,e}},{key:\"toVector3\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new fe;return e.set(this.x,this.y,this.z)}},{key:\"setFromRotationMatrix\",value:function(e){var t=Math.asin,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order,n=e.elements,l=n[0],i=n[4],r=n[8],o=n[1],s=n[5],y=n[9],u=n[2],d=n[6],c=n[10],m=1-1e-5;switch(a){case Ee.XYZ:{this.y=t(C(r,-1,1)),ke(r)<m?(this.x=oe(-y,c),this.z=oe(-i,l)):(this.x=oe(d,s),this.z=0);break}case Ee.YXZ:{this.x=t(-C(y,-1,1)),ke(y)<m?(this.y=oe(r,c),this.z=oe(o,s)):(this.y=oe(-u,l),this.z=0);break}case Ee.ZXY:{this.x=t(C(d,-1,1)),ke(d)<m?(this.y=oe(-u,c),this.z=oe(-i,s)):(this.y=0,this.z=oe(o,l));break}case Ee.ZYX:{this.y=t(-C(u,-1,1)),ke(u)<m?(this.x=oe(d,c),this.z=oe(o,l)):(this.x=0,this.z=oe(-i,s));break}case Ee.YZX:{this.z=t(C(o,-1,1)),ke(o)<m?(this.x=oe(-y,s),this.y=oe(-u,l)):(this.x=0,this.y=oe(r,c));break}case Ee.XZY:{this.z=t(-C(i,-1,1)),ke(i)<m?(this.x=oe(d,s),this.y=oe(r,l)):(this.x=oe(-y,c),this.y=0);break}}return this.order=a,this}},{key:\"setFromQuaternion\",value:function(e,t){return Fe.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Fe,t)}},{key:\"setFromVector3\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(e.x,e.y,e.z,t)}},{key:\"reorder\",value:function(e){return m.setFromEuler(this),this.setFromQuaternion(m,e)}},{key:\"equals\",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order}}],[{key:\"defaultOrder\",get:function(){return Ee.XYZ}}]),t}(),Ae=new fe,a=new fe,b=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new fe(1,0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.normal=a,this.constant=n}return n(t,[{key:\"set\",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:\"setComponents\",value:function(e,t,a,n){return this.normal.set(e,t,a),this.constant=n,this}},{key:\"copy\",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromNormalAndCoplanarPoint\",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:\"setFromCoplanarPoints\",value:function(e,t,n){var l=Ae.subVectors(n,t).cross(a.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(l,Ae),this}},{key:\"normalize\",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:\"negate\",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:\"distanceToPoint\",value:function(e){return this.normal.dot(e)+this.constant}},{key:\"distanceToSphere\",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:\"projectPoint\",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:\"coplanarPoint\",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:\"translate\",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:\"intersectLine\",value:function(e,a){var n=e.delta(Ae),l=this.normal.dot(n);if(0===l)0===this.distanceToPoint(e.start)&&a.copy(e.start);else{var i=-(e.start.dot(this.normal)+this.constant)/l;0<=i&&1>=i&&a.copy(n).multiplyScalar(i).add(e.start)}return a}},{key:\"intersectsLine\",value:function(e){var t=this.distanceToPoint(e.start),a=this.distanceToPoint(e.end);return 0>t&&0<a||0>a&&0<t}},{key:\"intersectsBox\",value:function(e){return e.intersectsPlane(this)}},{key:\"intersectsSphere\",value:function(e){return e.intersectsPlane(this)}},{key:\"equals\",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}]),t}(),Ve=new fe,Be=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new b,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new b,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new b,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new b,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new b,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new b;e(this,t),this.planes=[a,n,l,i,r,o]}return n(t,[{key:\"set\",value:function(e,t,a,n,l,i){var r=this.planes;return r[0].copy(e),r[1].copy(t),r[2].copy(a),r[3].copy(n),r[4].copy(l),r[5].copy(i),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"copy\",value:function(e){var t,a=this.planes;for(t=0;6>t;++t)a[t].copy(e.planes[t]);return this}},{key:\"setFromMatrix\",value:function(e){var t=this.planes,a=e.elements,n=a[0],l=a[1],i=a[2],r=a[3],o=a[4],s=a[5],y=a[6],u=a[7],d=a[8],c=a[9],m=a[10],x=a[11],p=a[12],v=a[13],k=a[14],g=a[15];return t[0].setComponents(r-n,u-o,x-d,g-p).normalize(),t[1].setComponents(r+n,u+o,x+d,g+p).normalize(),t[2].setComponents(r+l,u+s,x+c,g+v).normalize(),t[3].setComponents(r-l,u-s,x-c,g-v).normalize(),t[4].setComponents(r-i,u-y,x-m,g-k).normalize(),t[5].setComponents(r+i,u+y,x+m,g+k).normalize(),this}},{key:\"intersectsSphere\",value:function(e){var t,a,n=this.planes,l=e.center,r=-e.radius,o=!0;for(t=0;6>t;++t)if(a=n[t].distanceToPoint(l),a<r){o=!1;break}return o}},{key:\"intersectsBox\",value:function(e){var t,a,n=this.planes,l=e.min,r=e.max;for(t=0;6>t;++t)if(a=n[t],Ve.x=0<a.normal.x?r.x:l.x,Ve.y=0<a.normal.y?r.y:l.y,Ve.z=0<a.normal.z?r.z:l.z,0>a.distanceToPoint(Ve))return!1;return!0}},{key:\"containsPoint\",value:function(e){var t,a=this.planes,n=!0;for(t=0;6>t;++t)if(0>a[t].distanceToPoint(e)){n=!1;break}return n}}]),t}(),Ne=new fe,Oe=new fe,qe=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new fe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new fe;e(this,t),this.start=a,this.end=n}return n(t,[{key:\"set\",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:\"copy\",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new fe;return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:\"delta\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new fe;return e.subVectors(this.end,this.start)}},{key:\"lengthSquared\",value:function(){return this.start.distanceToSquared(this.end)}},{key:\"length\",value:function(){return this.start.distanceTo(this.end)}},{key:\"at\",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:\"closestPointToPointParameter\",value:function(e,a){Ne.subVectors(e,this.start),Oe.subVectors(this.end,this.start);var n=Oe.dot(Oe),l=Oe.dot(Ne),i=a?he(ge(l/n,0),1):l/n;return i}},{key:\"closestPointToPoint\",value:function(e){var a=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new fe,l=this.closestPointToPointParameter(e,a);return this.delta(n).multiplyScalar(l).add(this.start)}},{key:\"equals\",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}]),t}(),Le=new fe,Me=new fe,Re=new fe,c=function(){function t(){e(this,t),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return n(t,[{key:\"set\",value:function(e,t,a,n,l,i,r,o,s,y,u,d,c,m,x,p){var v=this.elements;return v[0]=e,v[4]=t,v[8]=a,v[12]=n,v[1]=l,v[5]=i,v[9]=r,v[13]=o,v[2]=s,v[6]=y,v[10]=u,v[14]=d,v[3]=c,v[7]=m,v[11]=x,v[15]=p,this}},{key:\"identity\",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:\"copy\",value:function(e){var t=e.elements,a=this.elements;return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],this}},{key:\"clone\",value:function(){return new this.constructor().fromArray(this.elements)}},{key:\"fromArray\",value:function(e){var t,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(t=0;16>t;++t)n[t]=e[t+a];return this}},{key:\"toArray\",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(e=0;16>e;++e)t[e+a]=n[e];return t}},{key:\"getMaxScaleOnAxis\",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],a=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return ue(ge(t,a,n))}},{key:\"copyPosition\",value:function(e){var t=this.elements,a=e.elements;return t[12]=a[12],t[13]=a[13],t[14]=a[14],this}},{key:\"setPosition\",value:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}},{key:\"extractBasis\",value:function(e,t,a){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),a.setFromMatrixColumn(this,2),this}},{key:\"makeBasis\",value:function(e,t,a){return this.set(e.x,t.x,a.x,0,e.y,t.y,a.y,0,e.z,t.z,a.z,0,0,0,0,1),this}},{key:\"extractRotation\",value:function(e){var t=this.elements,a=e.elements,n=1/Le.setFromMatrixColumn(e,0).length(),l=1/Le.setFromMatrixColumn(e,1).length(),i=1/Le.setFromMatrixColumn(e,2).length();return t[0]=a[0]*n,t[1]=a[1]*n,t[2]=a[2]*n,t[3]=0,t[4]=a[4]*l,t[5]=a[5]*l,t[6]=a[6]*l,t[7]=0,t[8]=a[8]*i,t[9]=a[9]*i,t[10]=a[10]*i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:\"makeRotationFromEuler\",value:function(t){var n,l,i,r,o,s,u,m,p,v,k,g,h=this.elements,S=t.x,x=t.y,y=t.z,z=me(S),a=xe(S),w=me(x),c=xe(x),d=me(y),e=xe(y);switch(t.order){case Ee.XYZ:{n=z*d,l=z*e,i=a*d,r=a*e,h[0]=w*d,h[4]=-w*e,h[8]=c,h[1]=l+i*c,h[5]=n-r*c,h[9]=-a*w,h[2]=r-n*c,h[6]=i+l*c,h[10]=z*w;break}case Ee.YXZ:{o=w*d,s=w*e,u=c*d,m=c*e,h[0]=o+m*a,h[4]=u*a-s,h[8]=z*c,h[1]=z*e,h[5]=z*d,h[9]=-a,h[2]=s*a-u,h[6]=m+o*a,h[10]=z*w;break}case Ee.ZXY:{o=w*d,s=w*e,u=c*d,m=c*e,h[0]=o-m*a,h[4]=-z*e,h[8]=u+s*a,h[1]=s+u*a,h[5]=z*d,h[9]=m-o*a,h[2]=-z*c,h[6]=a,h[10]=z*w;break}case Ee.ZYX:{n=z*d,l=z*e,i=a*d,r=a*e,h[0]=w*d,h[4]=i*c-l,h[8]=n*c+r,h[1]=w*e,h[5]=r*c+n,h[9]=l*c-i,h[2]=-c,h[6]=a*w,h[10]=z*w;break}case Ee.YZX:{p=z*w,v=z*c,k=a*w,g=a*c,h[0]=w*d,h[4]=g-p*e,h[8]=k*e+v,h[1]=e,h[5]=z*d,h[9]=-a*d,h[2]=-c*d,h[6]=v*e+k,h[10]=p-g*e;break}case Ee.XZY:{p=z*w,v=z*c,k=a*w,g=a*c,h[0]=w*d,h[4]=-e,h[8]=c*d,h[1]=p*e+g,h[5]=z*d,h[9]=v*e-k,h[2]=k*e-v,h[6]=a*d,h[10]=g*e+p;break}}return h[3]=0,h[7]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,this}},{key:\"makeRotationFromQuaternion\",value:function(e){return this.compose(Le.set(0,0,0),e,Me.set(1,1,1))}},{key:\"lookAt\",value:function(e,t,a){var n=this.elements,l=Le,i=Me,r=Re;return r.subVectors(e,t),0===r.lengthSquared()&&(r.z=1),r.normalize(),l.crossVectors(a,r),0===l.lengthSquared()&&(1===ke(a.z)?r.x+=1e-4:r.z+=1e-4,r.normalize(),l.crossVectors(a,r)),l.normalize(),i.crossVectors(r,l),n[0]=l.x,n[4]=i.x,n[8]=r.x,n[1]=l.y,n[5]=i.y,n[9]=r.y,n[2]=l.z,n[6]=i.z,n[10]=r.z,this}},{key:\"multiplyMatrices\",value:function(e,t){var a=this.elements,n=e.elements,l=t.elements,i=n[0],r=n[4],o=n[8],s=n[12],y=n[1],u=n[5],d=n[9],c=n[13],m=n[2],x=n[6],p=n[10],v=n[14],k=n[3],g=n[7],h=n[11],z=n[15],f=l[0],S=l[4],w=l[8],I=l[12],T=l[1],C=l[5],P=l[9],b=l[13],E=l[2],D=l[6],F=l[10],A=l[14],V=l[3],B=l[7],N=l[11],O=l[15];return a[0]=i*f+r*T+o*E+s*V,a[4]=i*S+r*C+o*D+s*B,a[8]=i*w+r*P+o*F+s*N,a[12]=i*I+r*b+o*A+s*O,a[1]=y*f+u*T+d*E+c*V,a[5]=y*S+u*C+d*D+c*B,a[9]=y*w+u*P+d*F+c*N,a[13]=y*I+u*b+d*A+c*O,a[2]=m*f+x*T+p*E+v*V,a[6]=m*S+x*C+p*D+v*B,a[10]=m*w+x*P+p*F+v*N,a[14]=m*I+x*b+p*A+v*O,a[3]=k*f+g*T+h*E+z*V,a[7]=k*S+g*C+h*D+z*B,a[11]=k*w+g*P+h*F+z*N,a[15]=k*I+g*b+h*A+z*O,this}},{key:\"multiply\",value:function(e){return this.multiplyMatrices(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyMatrices(e,this)}},{key:\"multiplyScalar\",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:\"determinant\",value:function(){var e=this.elements,t=e[0],a=e[4],n=e[8],l=e[12],i=e[1],r=e[5],o=e[9],s=e[13],y=e[2],u=e[6],d=e[10],c=e[14],m=e[3],x=e[7],p=e[11],v=e[15],k=t*r,g=t*o,h=t*s,z=a*i,f=a*o,S=a*s,w=n*i,I=n*r,T=n*s,C=l*i,P=l*r,b=l*o;return m*(b*u-T*u-P*d+S*d+I*c-f*c)+x*(g*c-h*d+C*d-w*c+T*y-b*y)+p*(h*u-k*c-C*u+z*c+P*y-S*y)+v*(-I*y-g*u+k*d+w*u-z*d+f*y)}},{key:\"getInverse\",value:function(e){var t,a=this.elements,n=e.elements,l=n[0],i=n[1],r=n[2],o=n[3],s=n[4],y=n[5],u=n[6],d=n[7],c=n[8],m=n[9],x=n[10],p=n[11],v=n[12],k=n[13],g=n[14],h=n[15],z=m*g*d-k*x*d+k*u*p-y*g*p-m*u*h+y*x*h,f=v*x*d-c*g*d-v*u*p+s*g*p+c*u*h-s*x*h,S=c*k*d-v*m*d+v*y*p-s*k*p-c*y*h+s*m*h,w=v*m*u-c*k*u-v*y*x+s*k*x+c*y*g-s*m*g,I=l*z+i*f+r*S+o*w;return 0===I?(console.error(\"Can't invert matrix, determinant is zero\",e),this.identity()):(t=1/I,a[0]=z*t,a[1]=(k*x*o-m*g*o-k*r*p+i*g*p+m*r*h-i*x*h)*t,a[2]=(y*g*o-k*u*o+k*r*d-i*g*d-y*r*h+i*u*h)*t,a[3]=(m*u*o-y*x*o-m*r*d+i*x*d+y*r*p-i*u*p)*t,a[4]=f*t,a[5]=(c*g*o-v*x*o+v*r*p-l*g*p-c*r*h+l*x*h)*t,a[6]=(v*u*o-s*g*o-v*r*d+l*g*d+s*r*h-l*u*h)*t,a[7]=(s*x*o-c*u*o+c*r*d-l*x*d-s*r*p+l*u*p)*t,a[8]=S*t,a[9]=(v*m*o-c*k*o-v*i*p+l*k*p+c*i*h-l*m*h)*t,a[10]=(s*k*o-v*y*o+v*i*d-l*k*d-s*i*h+l*y*h)*t,a[11]=(c*y*o-s*m*o-c*i*d+l*m*d+s*i*p-l*y*p)*t,a[12]=w*t,a[13]=(c*k*r-v*m*r+v*i*x-l*k*x-c*i*g+l*m*g)*t,a[14]=(v*y*r-s*k*r-v*i*u+l*k*u+s*i*g-l*y*g)*t,a[15]=(s*m*r-c*y*r+c*i*u-l*m*u-s*i*x+l*y*x)*t),this}},{key:\"transpose\",value:function(){var e,a=this.elements;return e=a[1],a[1]=a[4],a[4]=e,e=a[2],a[2]=a[8],a[8]=e,e=a[6],a[6]=a[9],a[9]=e,e=a[3],a[3]=a[12],a[12]=e,e=a[7],a[7]=a[13],a[13]=e,e=a[11],a[11]=a[14],a[14]=e,this}},{key:\"scale\",value:function(e,t,a){var n=this.elements;return n[0]*=e,n[4]*=t,n[8]*=a,n[1]*=e,n[5]*=t,n[9]*=a,n[2]*=e,n[6]*=t,n[10]*=a,n[3]*=e,n[7]*=t,n[11]*=a,this}},{key:\"makeScale\",value:function(e,t,a){return this.set(e,0,0,0,0,t,0,0,0,0,a,0,0,0,0,1),this}},{key:\"makeTranslation\",value:function(e,t,a){return this.set(1,0,0,e,0,1,0,t,0,0,1,a,0,0,0,1),this}},{key:\"makeRotationX\",value:function(e){var t=me(e),a=xe(e);return this.set(1,0,0,0,0,t,-a,0,0,a,t,0,0,0,0,1),this}},{key:\"makeRotationY\",value:function(e){var t=me(e),a=xe(e);return this.set(t,0,a,0,0,1,0,0,-a,0,t,0,0,0,0,1),this}},{key:\"makeRotationZ\",value:function(e){var t=me(e),a=xe(e);return this.set(t,-a,0,0,a,t,0,0,0,0,1,0,0,0,0,1),this}},{key:\"makeRotationAxis\",value:function(e,a){var n=me(a),l=xe(a),i=1-n,t=e.x,r=e.y,o=e.z,s=i*t,y=i*r;return this.set(s*t+n,s*r-l*o,s*o+l*r,0,s*r+l*o,y*r+n,y*o-l*t,0,s*o-l*r,y*o+l*t,i*o*o+n,0,0,0,0,1),this}},{key:\"makeShear\",value:function(e,t,a){return this.set(1,t,a,0,e,1,a,0,e,t,1,0,0,0,0,1),this}},{key:\"compose\",value:function(e,t,a){var n=this.elements,l=t.x,i=t.y,r=t.z,o=t.w,s=l+l,y=i+i,u=r+r,d=l*s,c=l*y,m=l*u,x=i*y,p=i*u,v=r*u,k=o*s,g=o*y,h=o*u,z=a.x,f=a.y,S=a.z;return n[0]=(1-(x+v))*z,n[1]=(c+h)*z,n[2]=(m-g)*z,n[3]=0,n[4]=(c-h)*f,n[5]=(1-(d+v))*f,n[6]=(p+k)*f,n[7]=0,n[8]=(m+g)*S,n[9]=(p-k)*S,n[10]=(1-(d+x))*S,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}},{key:\"decompose\",value:function(e,t,a){var n=this.elements,l=n[0],i=n[1],r=n[2],o=n[4],s=n[5],y=n[6],u=n[8],d=n[9],c=n[10],m=this.determinant(),x=Le.set(l,i,r).length()*(0>m?-1:1),p=Le.set(o,s,y).length(),v=Le.set(u,d,c).length(),k=1/x,g=1/p,h=1/v;return e.x=n[12],e.y=n[13],e.z=n[14],n[0]*=k,n[1]*=k,n[2]*=k,n[4]*=g,n[5]*=g,n[6]*=g,n[8]*=h,n[9]*=h,n[10]*=h,t.setFromRotationMatrix(this),n[0]=l,n[1]=i,n[2]=r,n[4]=o,n[5]=s,n[6]=y,n[8]=u,n[9]=d,n[10]=c,a.x=x,a.y=p,a.z=v,this}},{key:\"makePerspective\",value:function(e,t,a,n,l,i){var r=this.elements;return r[0]=2*l/(t-e),r[4]=0,r[8]=(t+e)/(t-e),r[12]=0,r[1]=0,r[5]=2*l/(a-n),r[9]=(a+n)/(a-n),r[13]=0,r[2]=0,r[6]=0,r[10]=-(i+l)/(i-l),r[14]=-2*i*l/(i-l),r[3]=0,r[7]=0,r[11]=-1,r[15]=0,this}},{key:\"makeOrthographic\",value:function(e,t,a,n,l,i){var r=this.elements,o=1/(t-e),s=1/(a-n),y=1/(i-l);return r[0]=2*o,r[4]=0,r[8]=0,r[12]=-((t+e)*o),r[1]=0,r[5]=2*s,r[9]=0,r[13]=-((a+n)*s),r[2]=0,r[6]=0,r[10]=-2*y,r[14]=-((i+l)*y),r[3]=0,r[7]=0,r[11]=0,r[15]=1,this}},{key:\"equals\",value:function(e){var t,a=this.elements,n=e.elements,l=!0;for(t=0;l&&16>t;++t)a[t]!==n[t]&&(l=!1);return l}}]),t}(),Ye=[new fe,new fe,new fe,new fe],Xe=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new fe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new fe;e(this,t),this.origin=a,this.direction=n}return n(t,[{key:\"set\",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:\"copy\",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"at\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new fe;return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:\"lookAt\",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:\"recast\",value:function(e){return this.origin.copy(this.at(e,Ye[0])),this}},{key:\"closestPointToPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new fe,a=t.subVectors(e,this.origin).dot(this.direction);return 0<=a?t.copy(this.direction).multiplyScalar(a).add(this.origin):t.copy(this.origin)}},{key:\"distanceSquaredToPoint\",value:function(e){var t=Ye[0].subVectors(e,this.origin).dot(this.direction);return 0>t?this.origin.distanceToSquared(e):Ye[0].copy(this.direction).multiplyScalar(t).add(this.origin).distanceToSquared(e)}},{key:\"distanceToPoint\",value:function(e){return ue(this.distanceSquaredToPoint(e))}},{key:\"distanceToPlane\",value:function(e){var a=e.normal.dot(this.direction),n=0===a?0===e.distanceToPoint(this.origin)?0:-1:-(this.origin.dot(e.normal)+e.constant)/a;return 0<=n?n:null}},{key:\"distanceSquaredToSegment\",value:function(e,t,a,n){var l,i,r,o,s,y=Ye[0].copy(e).add(t).multiplyScalar(.5),u=Ye[1].copy(t).sub(e).normalize(),d=Ye[2].copy(this.origin).sub(y),m=.5*e.distanceTo(t),x=-this.direction.dot(u),p=d.dot(this.direction),v=-d.dot(u),k=d.lengthSq(),c=ke(1-x*x);return 0<c?(l=x*v-p,i=x*p-v,r=m*c,0<=l?i>=-r?i<=r?(o=1/c,l*=o,i*=o,s=l*(l+x*i+2*p)+i*(x*l+i+2*v)+k):(i=m,l=ge(0,-(x*i+p)),s=-l*l+i*(i+2*v)+k):(i=-m,l=ge(0,-(x*i+p)),s=-l*l+i*(i+2*v)+k):i<=-r?(l=ge(0,-(-x*m+p)),i=0<l?-m:he(ge(-m,-v),m),s=-l*l+i*(i+2*v)+k):i<=r?(l=0,i=he(ge(-m,-v),m),s=i*(i+2*v)+k):(l=ge(0,-(x*m+p)),i=0<l?m:he(ge(-m,-v),m),s=-l*l+i*(i+2*v)+k)):(i=0<x?-m:m,l=ge(0,-(x*i+p)),s=-l*l+i*(i+2*v)+k),void 0!==a&&a.copy(this.direction).multiplyScalar(l).add(this.origin),void 0!==n&&n.copy(u).multiplyScalar(i).add(y),s}},{key:\"intersectSphere\",value:function(e){var t,a,n,l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new fe,i=Ye[0].subVectors(e.center,this.origin),r=i.dot(this.direction),o=i.dot(i)-r*r,s=e.radius*e.radius,y=null;return o<=s&&(t=ue(s-o),a=r-t,n=r+t,(0<=a||0<=n)&&(y=0>a?this.at(n,l):this.at(a,l))),y}},{key:\"intersectsSphere\",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:\"intersectPlane\",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new fe,n=this.distanceToPlane(e);return null===n?null:this.at(n,a)}},{key:\"intersectsPlane\",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t}},{key:\"intersectBox\",value:function(e){var t,a,n,l,i,r,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new fe,s=this.origin,y=this.direction,u=e.min,d=e.max,c=1/y.x,m=1/y.y,x=1/y.z,p=null;return 0<=c?(t=(u.x-s.x)*c,a=(d.x-s.x)*c):(t=(d.x-s.x)*c,a=(u.x-s.x)*c),0<=m?(n=(u.y-s.y)*m,l=(d.y-s.y)*m):(n=(d.y-s.y)*m,l=(u.y-s.y)*m),t<=l&&n<=a&&((n>t||t!==t)&&(t=n),(l<a||a!==a)&&(a=l),0<=x?(i=(u.z-s.z)*x,r=(d.z-s.z)*x):(i=(d.z-s.z)*x,r=(u.z-s.z)*x),t<=r&&i<=a&&((i>t||t!==t)&&(t=i),(r<a||a!==a)&&(a=r),0<=a&&(p=this.at(0<=t?t:a,o)))),p}},{key:\"intersectsBox\",value:function(e){return null!==this.intersectBox(e,Ye[0])}},{key:\"intersectTriangle\",value:function(e,t,a,n,l){var i,r,o,s,y,u=this.direction,d=Ye[0],c=Ye[1],m=Ye[2],x=Ye[3],p=null;return c.subVectors(t,e),m.subVectors(a,e),x.crossVectors(c,m),i=u.dot(x),0===i||n&&0<i||(0<i?r=1:(r=-1,i=-i),d.subVectors(this.origin,e),o=r*u.dot(m.crossVectors(d,m)),0<=o&&(s=r*u.dot(c.cross(d)),0<=s&&o+s<=i&&(y=-r*d.dot(x),0<=y&&(p=this.at(y/i,l))))),p}},{key:\"applyMatrix4\",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:\"equals\",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),t}(),Ze=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.radius=a,this.phi=n,this.theta=l}return n(t,[{key:\"set\",value:function(e,t,a){return this.radius=e,this.phi=t,this.theta=a,this}},{key:\"copy\",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"makeSafe\",value:function(){return this.phi=ge(1e-6,he(re-1e-6,this.phi)),this}},{key:\"setFromVector3\",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:\"setFromCartesianCoords\",value:function(e,t,a){return this.radius=ue(e*e+t*t+a*a),0===this.radius?(this.theta=0,this.phi=0):(this.theta=oe(e,a),this.phi=ye(he(ge(t/this.radius,-1),1))),this}}]),t}(),_e=function(){function t(){e(this,t),this.elements=new Float32Array([1,0,0,1,0,1])}return n(t,[{key:\"set\",value:function(t,a,n,l,i,r){var o=this.elements;return o[0]=t,o[1]=a,o[3]=l,o[2]=n,o[4]=i,o[5]=r,this}},{key:\"identity\",value:function(){return this.set(1,0,0,1,0,1),this}},{key:\"copy\",value:function(e){var t=e.elements;return this.set(t[0],t[1],t[2],t[3],t[4],t[5]),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"toMatrix3\",value:function(e){var t=e.elements;e.set(t[0],t[1],t[2],t[1],t[3],t[4],t[2],t[4],t[5])}},{key:\"add\",value:function(e){var t=this.elements,a=e.elements;return t[0]+=a[0],t[1]+=a[1],t[3]+=a[3],t[2]+=a[2],t[4]+=a[4],t[5]+=a[5],this}},{key:\"norm\",value:function(){var t=this.elements,e=t[1]*t[1],a=t[2]*t[2],n=t[4]*t[4];return ue(t[0]*t[0]+e+a+e+t[3]*t[3]+n+a+n+t[5]*t[5])}},{key:\"off\",value:function(){var t=this.elements;return ue(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:\"applyToVector3\",value:function(t){var a=t.x,n=t.y,l=t.z,i=this.elements;return t.x=i[0]*a+i[1]*n+i[2]*l,t.y=i[1]*a+i[3]*n+i[4]*l,t.z=i[2]*a+i[4]*n+i[5]*l,t}},{key:\"equals\",value:function(e){var t,a=this.elements,n=e.elements,l=!0;for(t=0;l&&6>t;++t)a[t]!==n[t]&&(l=!1);return l}}],[{key:\"calculateIndex\",value:function(e,t){return 3-(3-e)*(2-e)/2+t}}]),t}(),Ue=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;e(this,t),this.x=a,this.y=n,this.z=l,this.w=i}return n(t,[{key:\"set\",value:function(e,t,a,n){return this.x=e,this.y=t,this.z=a,this.w=n,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:\"setAxisAngleFromQuaternion\",value:function(e){this.w=2*ye(e.w);var t=ue(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:\"setAxisAngleFromRotationMatrix\",value:function(e){var t,a,n,l,i,r,o,u,d,c,m,p=.01,v=.1,k=e.elements,g=k[0],h=k[4],f=k[8],S=k[1],w=k[5],I=k[9],T=k[2],C=k[6],P=k[10];return ke(h-S)<p&&ke(f-T)<p&&ke(I-C)<p?ke(h+S)<v&&ke(f+T)<v&&ke(I+C)<v&&ke(g+w+P-3)<v?this.set(1,0,0,0):(t=re,i=(g+1)/2,r=(w+1)/2,o=(P+1)/2,u=(h+S)/4,d=(f+T)/4,c=(I+C)/4,i>r&&i>o?i<p?(a=0,n=.707106781,l=.707106781):(a=ue(i),n=u/a,l=d/a):r>o?r<p?(a=.707106781,n=0,l=.707106781):(n=ue(r),a=u/n,l=c/n):o<p?(a=.707106781,n=.707106781,l=0):(l=ue(o),a=d/l,n=c/l),this.set(a,n,l,t)):(m=ue((C-I)*(C-I)+(f-T)*(f-T)+(S-h)*(S-h)),.001>ke(m)&&(m=1),this.x=(C-I)/m,this.y=(f-T)/m,this.z=(S-h)/m,this.w=ye((g+w+P-1)/2)),this}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:\"addVectors\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:\"addScaledVector\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:\"subVectors\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:\"multiplyVectors\",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this.w=e.w*t.w,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this}},{key:\"applyMatrix4\",value:function(t){var a=this.x,n=this.y,l=this.z,i=this.w,r=t.elements;return this.x=r[0]*a+r[4]*n+r[8]*l+r[12]*i,this.y=r[1]*a+r[5]*n+r[9]*l+r[13]*i,this.z=r[2]*a+r[6]*n+r[10]*l+r[14]*i,this.w=r[3]*a+r[7]*n+r[11]*l+r[15]*i,this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:\"manhattanLength\",value:function(){return ke(this.x)+ke(this.y)+ke(this.z)+ke(this.w)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:\"length\",value:function(){return ue(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:\"manhattanDistanceTo\",value:function(e){return ke(this.x-e.x)+ke(this.y-e.y)+ke(this.z-e.z)+ke(this.w-e.w)}},{key:\"distanceToSquared\",value:function(e){var t=this.x-e.x,a=this.y-e.y,n=this.z-e.z,l=this.w-e.w;return t*t+a*a+n*n+l*l}},{key:\"distanceTo\",value:function(e){return ue(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=he(this.x,e.x),this.y=he(this.y,e.y),this.z=he(this.z,e.z),this.w=he(this.w,e.w),this}},{key:\"max\",value:function(e){return this.x=ge(this.x,e.x),this.y=ge(this.y,e.y),this.z=ge(this.z,e.z),this.w=ge(this.w,e.w),this}},{key:\"clamp\",value:function(e,t){return this.x=ge(e.x,he(t.x,this.x)),this.y=ge(e.y,he(t.y,this.y)),this.z=ge(e.z,he(t.z,this.z)),this.w=ge(e.w,he(t.w,this.w)),this}},{key:\"floor\",value:function(){return this.x=pe(this.x),this.y=pe(this.y),this.z=pe(this.z),this.w=pe(this.w),this}},{key:\"ceil\",value:function(){return this.x=ve(this.x),this.y=ve(this.y),this.z=ve(this.z),this.w=ve(this.w),this}},{key:\"round\",value:function(){return this.x=se(this.x),this.y=se(this.y),this.z=se(this.z),this.w=se(this.w),this}},{key:\"lerp\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:\"lerpVectors\",value:function(e,t,a){return this.subVectors(t,e).multiplyScalar(a).add(e)}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}]),t}(),je=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];e(this,t),this.value=a,this.done=n}return n(t,[{key:\"reset\",value:function(){this.value=null,this.done=!1}}]),t}(),Qe=new fe,Ge=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new fe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new fe;e(this,t),this.min=a,this.max=n,this.children=null}return n(t,[{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new fe;return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getDimensions\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new fe;return e.subVectors(this.max,this.min)}},{key:\"split\",value:function(){var e,t,a=this.min,n=this.max,l=this.getCenter(Qe),r=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)t=He[e],r[e]=new this.constructor(new fe(0===t[0]?a.x:l.x,0===t[1]?a.y:l.y,0===t[2]?a.z:l.z),new fe(0===t[0]?l.x:n.x,0===t[1]?l.y:n.y,0===t[2]?l.z:n.z))}}]),t}(),He=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],Je=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],Ke=new fe,We=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new fe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.min=a,this.size=n,this.children=null}return n(t,[{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new fe;return e.copy(this.min).addScalar(.5*this.size)}},{key:\"getDimensions\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new fe;return e.set(this.size,this.size,this.size)}},{key:\"split\",value:function(){var e,t,a=this.min,n=this.getCenter(Ke),l=.5*this.size,r=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)t=He[e],r[e]=new this.constructor(new fe(0===t[0]?a.x:n.x,0===t[1]?a.y:n.y,0===t[2]?a.z:n.z),l)}},{key:\"max\",get:function(){return this.min.clone().addScalar(this.size)}}]),t}(),$e=new v,et=function(){function t(a){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;e(this,t),this.octree=a,this.region=n,this.cull=null!==n,this.result=new je,this.trace=null,this.indices=null,this.reset()}return n(t,[{key:\"reset\",value:function(){var e=this.octree.root;return this.trace=[],this.indices=[],null!==e&&($e.min=e.min,$e.max=e.max,(!this.cull||this.region.intersectsBox($e))&&(this.trace.push(e),this.indices.push(0))),this.result.reset(),this}},{key:\"next\",value:function(){for(var e,t,a,n=this.cull,l=this.region,i=this.indices,r=this.trace,o=null,s=r.length-1;null===o&&0<=s;)if(e=i[s]++,t=r[s].children,!(8>e))r.pop(),i.pop(),--s;else if(null!==t){if(a=t[e],n&&($e.min=a.min,$e.max=a.max,!l.intersectsBox($e)))continue;r.push(a),i.push(0),++s}else o=r.pop(),i.pop();return this.result.value=o,this.result.done=null===o,this.result}},{key:\"return\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),tt=[new fe,new fe,new fe],at=new v,nt=new Xe,r=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],lt=0,it=function(){function t(){e(this,t)}return n(t,null,[{key:\"intersectOctree\",value:function(e,t,a){var n,l,i,r,o,s,y,u,d,c=at.min.set(0,0,0),m=at.max.subVectors(e.max,e.min),x=e.getDimensions(tt[0]),p=tt[1].copy(x).multiplyScalar(.5),v=nt.origin.copy(t.ray.origin),k=nt.direction.copy(t.ray.direction);v.sub(e.getCenter(tt[2])).add(p),lt=0,0>k.x&&(v.x=x.x-v.x,k.x=-k.x,lt|=4),0>k.y&&(v.y=x.y-v.y,k.y=-k.y,lt|=2),0>k.z&&(v.z=x.z-v.z,k.z=-k.z,lt|=1),n=1/k.x,l=1/k.y,i=1/k.z,r=(c.x-v.x)*n,o=(m.x-v.x)*n,s=(c.y-v.y)*l,y=(m.y-v.y)*l,u=(c.z-v.z)*i,d=(m.z-v.z)*i,ge(ge(r,s),u)<he(he(o,y),d)&&D(e.root,r,s,u,o,y,d,t,a)}}]),t}(),rt=new v,ot=function(){function t(a,n){e(this,t),this.root=void 0!==a&&void 0!==n?new Ge(a,n):null}return n(t,[{key:\"getCenter\",value:function(e){return this.root.getCenter(e)}},{key:\"getDimensions\",value:function(e){return this.root.getDimensions(e)}},{key:\"getDepth\",value:function(){return F(this.root)}},{key:\"cull\",value:function(e){var t=[];return A(this.root,e,t),t}},{key:\"findOctantsByLevel\",value:function(e){var t=[];return V(this.root,e,0,t),t}},{key:\"raycast\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return it.intersectOctree(this,e,t),t}},{key:\"leaves\",value:function(e){return new et(this,e)}},{key:Symbol.iterator,value:function(){return new et(this)}},{key:\"min\",get:function(){return this.root.min}},{key:\"max\",get:function(){return this.root.max}},{key:\"children\",get:function(){return this.root.children}}]),t}(),st=new fe,yt=new fe,p=new fe,ut=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new fe,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new fe;e(this,t),this.a=n,this.b=a,this.index=-1,this.coordinates=new fe,this.t=0,this.n=new fe}return n(t,[{key:\"approximateZeroCrossing\",value:function(e){var t,n,l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,r=ge(1,l-1),o=0,s=1,y=0,u=0;for(st.subVectors(this.b,this.a);u<=r&&(y=(o+s)/2,yt.addVectors(this.a,p.copy(st).multiplyScalar(y)),n=e.sample(yt),!(ke(n)<=1e-4||(s-o)/2<=1e-6));)yt.addVectors(this.a,p.copy(st).multiplyScalar(o)),t=e.sample(yt),ie(n)===ie(t)?o=y:s=y,++u;this.t=y}},{key:\"computeZeroCrossingPosition\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new fe;return e.subVectors(this.b,this.a).multiplyScalar(this.t).add(this.a)}},{key:\"computeSurfaceNormal\",value:function(e){var t=this.computeZeroCrossingPosition(st),a=1e-3,n=e.sample(yt.addVectors(t,p.set(a,0,0)))-e.sample(yt.subVectors(t,p.set(a,0,0))),l=e.sample(yt.addVectors(t,p.set(0,a,0)))-e.sample(yt.subVectors(t,p.set(0,a,0))),i=e.sample(yt.addVectors(t,p.set(0,0,a)))-e.sample(yt.subVectors(t,p.set(0,0,a)));this.n.set(n,l,i).normalize()}}]),t}(),dt=new ut,ct=new fe,mt=new fe,xt=function(){function t(a,n,l){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:3;e(this,t),this.edgeData=a,this.cellPosition=n,this.cellSize=l,this.indices=null,this.zeroCrossings=null,this.normals=null,this.axes=null,this.lengths=null,this.result=new je,this.initialC=i,this.c=i,this.initialD=r,this.d=r,this.i=0,this.l=0,this.reset()}return n(t,[{key:\"reset\",value:function(){var e,t,n,i,r=this.edgeData,o=[],s=[],y=[],u=[],m=[];for(this.i=0,this.c=0,this.d=0,(t=this.initialC,e=4>>t,n=this.initialD);t<n;++t,e>>=1)i=r.indices[t].length,0<i&&(o.push(r.indices[t]),s.push(r.zeroCrossings[t]),y.push(r.normals[t]),u.push(He[e]),m.push(i),++this.d);return this.l=0<m.length?m[0]:0,this.indices=o,this.zeroCrossings=s,this.normals=y,this.axes=u,this.lengths=m,this.result.reset(),this}},{key:\"next\",value:function(){var e,t,a,l,r,o,u,d=this.cellSize,s=this.edgeData.resolution,n=s+1,m=n*n,p=this.result,v=this.cellPosition;return this.i===this.l&&(this.l=++this.c<this.d?this.lengths[this.c]:0,this.i=0),this.i<this.l?(o=this.c,u=this.i,e=this.axes[o],t=this.indices[o][u],dt.index=t,a=t%n,l=le(t%m/n),r=le(t/m),dt.coordinates.set(a,l,r),ct.set(a*d/s,l*d/s,r*d/s),mt.set((a+e[0])*d/s,(l+e[1])*d/s,(r+e[2])*d/s),dt.a.addVectors(v,ct),dt.b.addVectors(v,mt),dt.t=this.zeroCrossings[o][u],dt.n.fromArray(this.normals[o],3*u),p.value=dt,++this.i):(p.value=null,p.done=!0),p}},{key:\"return\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),pt=function(){function t(a){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:n;e(this,t),this.resolution=a,this.indices=0>=n?null:[new Uint32Array(n),new Uint32Array(l),new Uint32Array(i)],this.zeroCrossings=0>=n?null:[new Float32Array(n),new Float32Array(l),new Float32Array(i)],this.normals=0>=n?null:[new Float32Array(3*n),new Float32Array(3*l),new Float32Array(3*i)]}return n(t,[{key:\"serialize\",value:function(){return{resolution:this.resolution,edges:this.edges,zeroCrossings:this.zeroCrossings,normals:this.normals}}},{key:\"deserialize\",value:function(e){var t=this;return null===e?t=null:(this.resolution=e.resolution,this.edges=e.edges,this.zeroCrossings=e.zeroCrossings,this.normals=e.normals),t}},{key:\"createTransferList\",value:function(){var e,t,a,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],r=[this.edges[0],this.edges[1],this.edges[2],this.zeroCrossings[0],this.zeroCrossings[1],this.zeroCrossings[2],this.normals[0],this.normals[1],this.normals[2]];for(t=0,a=r.length;t<a;++t)e=r[t],null!==e&&n.push(e.buffer);return n}},{key:\"edges\",value:function(e,t){return new xt(this,e,t)}},{key:\"edgesX\",value:function(e,t){return new xt(this,e,t,0,1)}},{key:\"edgesY\",value:function(e,t){return new xt(this,e,t,1,2)}},{key:\"edgesZ\",value:function(e,t){return new xt(this,e,t,2,3)}}],[{key:\"calculate1DEdgeCount\",value:function(e){return ne(e+1,2)*e}}]),t}(),vt={AIR:0,SOLID:1},kt=0,gt=0,ht=0,zt=function(){function t(){var a=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];e(this,t),this.materials=0,this.materialIndices=a?new Uint8Array(ht):null,this.runLengths=null,this.edgeData=null}return n(t,[{key:\"set\",value:function(e){return this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,this.edgeData=e.edgeData,this}},{key:\"clear\",value:function(){return this.materials=0,this.materialIndices=null,this.runLengths=null,this.edgeData=null,this}},{key:\"setMaterialIndex\",value:function(e,t){this.materialIndices[e]===vt.AIR?t!==vt.AIR&&++this.materials:t===vt.AIR&&--this.materials,this.materialIndices[e]=t}},{key:\"compress\",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this;return this.compressed?(t.materialIndices=this.materialIndices,t.runLengths=this.runLengths):(e=this.full?new ze([this.materialIndices.length],[vt.SOLID]):ze.encode(this.materialIndices),t.materialIndices=new Uint8Array(e.data),t.runLengths=new Uint32Array(e.runLengths)),t.materials=this.materials,t}},{key:\"decompress\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this;return e.materialIndices=this.compressed?ze.decode(this.runLengths,this.materialIndices,new Uint8Array(ht)):this.materialIndices,e.runLengths=null,e.materials=this.materials,e}},{key:\"serialize\",value:function(){return{materials:this.materials,materialIndices:this.materialIndices,runLengths:this.runLengths,edgeData:null===this.edgeData?null:this.edgeData.serialize()}}},{key:\"deserialize\",value:function(e){var t=this;return null===e?t=null:(this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,null===e.edgeData?this.edgeData=null:(null===this.edgeData&&(this.edgeData=new pt(gt)),this.edgeData.deserialize(e.edgeData))),t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.edgeData&&this.edgeData.createTransferList(e),null!==this.materialIndices&&e.push(this.materialIndices.buffer),null!==this.runLengths&&e.push(this.runLengths.buffer),e}},{key:\"empty\",get:function(){return 0===this.materials}},{key:\"full\",get:function(){return this.materials===ht}},{key:\"compressed\",get:function(){return null!==this.runLengths}},{key:\"neutered\",get:function(){return!this.empty&&null===this.materialIndices}}],[{key:\"isovalue\",get:function(){return kt},set:function(e){kt=e}},{key:\"resolution\",get:function(){return gt},set:function(e){var t=Math.log2;e=ne(2,ge(0,ve(t(e)))),gt=ge(1,he(256,e)),ht=ne(gt+1,3)}}]),t}(),ft=function(){function t(){e(this,t),this.ata=new _e,this.ata.set(0,0,0,0,0,0),this.atb=new fe,this.massPointSum=new fe,this.numPoints=0}return n(t,[{key:\"set\",value:function(e,t,a,n){return this.ata.copy(e),this.atb.copy(t),this.massPointSum.copy(a),this.numPoints=n,this}},{key:\"copy\",value:function(e){return this.set(e.ata,e.atb,e.massPointSum,e.numPoints)}},{key:\"add\",value:function(e,t){var a=t.x,n=t.y,l=t.z,i=e.dot(t),r=this.ata.elements,o=this.atb;r[0]+=a*a,r[1]+=a*n,r[3]+=n*n,r[2]+=a*l,r[4]+=n*l,r[5]+=l*l,o.x+=i*a,o.y+=i*n,o.z+=i*l,this.massPointSum.add(e),++this.numPoints}},{key:\"addData\",value:function(e){this.ata.add(e.ata),this.atb.add(e.atb),this.massPointSum.add(e.massPointSum),this.numPoints+=e.numPoints}},{key:\"clear\",value:function(){this.ata.set(0,0,0,0,0,0),this.atb.set(0,0,0),this.massPointSum.set(0,0,0),this.numPoints=0}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}}]),t}(),St=new Ie,wt=function(){function t(){e(this,t)}return n(t,null,[{key:\"calculateCoefficients\",value:function(e,t,a){var n,l,i;return 0===t?(St.x=1,St.y=0):(n=(a-e)/(2*t),l=ue(1+n*n),i=1/(0<=n?n+l:n-l),St.x=1/ue(1+i*i),St.y=i*St.x),St}}]),t}(),It=function(){function t(){e(this,t)}return n(t,null,[{key:\"rotateXY\",value:function(e,t){var a=t.x,n=t.y,l=e.x,i=e.y;e.set(a*l-n*i,n*l+a*i)}},{key:\"rotateQXY\",value:function(e,t,a){var n=a.x,l=a.y,i=n*n,r=l*l,o=2*n*l*t,s=e.x,y=e.y;e.set(i*s-o+r*y,r*s+o+i*y)}}]),t}(),Tt=.1,Ct=new _e,Pt=new be,bt=new Ie,Et=new fe,Dt=function(){function t(){e(this,t)}return n(t,null,[{key:\"solve\",value:function(e,t,a){var n=L(Ct.copy(e),Pt.identity()),l=R(Pt,n);a.copy(t).applyMatrix3(l)}}]),t}(),Ft=new fe,At=function(){function t(){e(this,t),this.data=null,this.ata=new _e,this.atb=new fe,this.massPoint=new fe,this.hasSolution=!1}return n(t,[{key:\"setData\",value:function(e){return this.data=e,this.hasSolution=!1,this}},{key:\"solve\",value:function(e){var t=this.data,a=this.massPoint,n=this.ata.copy(t.ata),l=this.atb.copy(t.atb),i=1/0;return!this.hasSolution&&null!==t&&0<t.numPoints&&(Ft.copy(t.massPointSum).divideScalar(t.numPoints),a.copy(Ft),n.applyToVector3(Ft),l.sub(Ft),Dt.solve(n,l,e),i=Y(n,l,e),e.add(a),this.hasSolution=!0),i}}]),t}(),Vt=function t(){e(this,t),this.materials=0,this.edgeCount=0,this.index=-1,this.position=new fe,this.normal=new fe,this.qefData=null},Bt=new At,Nt=.1,Ot=-1,qt=function(t){function a(t,n){var l;return e(this,a),l=k(this,s(a).call(this,t,n)),l.voxel=null,l}return i(a,t),n(a,[{key:\"contains\",value:function(e){var t=this.min,a=this.size;return e.x>=t.x-Nt&&e.y>=t.y-Nt&&e.z>=t.z-Nt&&e.x<=t.x+a+Nt&&e.y<=t.y+a+Nt&&e.z<=t.z+a+Nt}},{key:\"collapse\",value:function(){var e,t,a,n,l,r,o,s=this.children,y=[-1,-1,-1,-1,-1,-1,-1,-1],u=new fe,d=-1,c=null!==s,m=0;if(c){for(n=new ft,r=0,o=0;8>o;++o)e=s[o],m+=e.collapse(),a=e.voxel,null===e.children?null!==a&&(n.addData(a.qefData),d=1&a.materials>>7-o,y[o]=1&a.materials>>o,++r):c=!1;if(c&&(l=Bt.setData(n).solve(u),l<=Ot)){for(a=new Vt,a.position.copy(this.contains(u)?u:Bt.massPoint),o=0;8>o;++o)t=y[o],e=s[o],-1===t?a.materials|=d<<o:(a.materials|=t<<o,a.normal.add(e.voxel.normal));a.normal.normalize(),a.qefData=n,this.voxel=a,this.children=null,m+=r-1}}return m}}],[{key:\"errorThreshold\",get:function(){return Ot},set:function(e){Ot=e}}]),a}(We),Lt=function t(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null;e(this,t),this.action=a,this.error=null},Mt=function(){function t(a,n,l,i,r){e(this,t),this.indices=a,this.positions=n,this.normals=l,this.uvs=i,this.materials=r}return n(t,[{key:\"serialize\",value:function(){return{indices:this.indices,positions:this.positions,normals:this.normals,uvs:this.uvs,materials:this.materials}}},{key:\"deserialize\",value:function(e){var t=this;return null===e?t=null:(this.indices=e.indices,this.positions=e.positions,this.normals=e.normals,this.uvs=e.uvs,this.materials=e.materials),t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.indices.buffer),e.push(this.positions.buffer),e.push(this.normals.buffer),e.push(this.uvs.buffer),e.push(this.materials.buffer),e}}]),t}(),Rt=[new Uint8Array([0,4,0]),new Uint8Array([1,5,0]),new Uint8Array([2,6,0]),new Uint8Array([3,7,0]),new Uint8Array([0,2,1]),new Uint8Array([4,6,1]),new Uint8Array([1,3,1]),new Uint8Array([5,7,1]),new Uint8Array([0,1,2]),new Uint8Array([2,3,2]),new Uint8Array([4,5,2]),new Uint8Array([6,7,2])],Yt=[new Uint8Array([0,1,2,3,0]),new Uint8Array([4,5,6,7,0]),new Uint8Array([0,4,1,5,1]),new Uint8Array([2,6,3,7,1]),new Uint8Array([0,2,4,6,2]),new Uint8Array([1,3,5,7,2])],Xt=[[new Uint8Array([4,0,0]),new Uint8Array([5,1,0]),new Uint8Array([6,2,0]),new Uint8Array([7,3,0])],[new Uint8Array([2,0,1]),new Uint8Array([6,4,1]),new Uint8Array([3,1,1]),new Uint8Array([7,5,1])],[new Uint8Array([1,0,2]),new Uint8Array([3,2,2]),new Uint8Array([5,4,2]),new Uint8Array([7,6,2])]],Zt=[[new Uint8Array([1,4,0,5,1,1]),new Uint8Array([1,6,2,7,3,1]),new Uint8Array([0,4,6,0,2,2]),new Uint8Array([0,5,7,1,3,2])],[new Uint8Array([0,2,3,0,1,0]),new Uint8Array([0,6,7,4,5,0]),new Uint8Array([1,2,0,6,4,2]),new Uint8Array([1,3,1,7,5,2])],[new Uint8Array([1,1,0,3,2,0]),new Uint8Array([1,5,4,7,6,0]),new Uint8Array([0,1,5,0,4,1]),new Uint8Array([0,3,7,2,6,1])]],_t=[[new Uint8Array([3,2,1,0,0]),new Uint8Array([7,6,5,4,0])],[new Uint8Array([5,1,4,0,1]),new Uint8Array([7,3,6,2,1])],[new Uint8Array([6,4,2,0,2]),new Uint8Array([7,5,3,1,2])]],Ut=[new Uint8Array([3,2,1,0]),new Uint8Array([7,5,6,4]),new Uint8Array([11,10,9,8])],jt=ne(2,16)-1,Qt=function(){function t(){e(this,t)}return n(t,null,[{key:\"run\",value:function(e){var t=[],a=e.voxelCount,n=null,l=null,i=null,r=null,o=null;return a>jt?console.warn(\"Could not create geometry for cell at position\",e.min,\"(vertex count of\",a,\"exceeds limit of \",jt,\")\"):0<a&&(l=new Float32Array(3*a),i=new Float32Array(3*a),r=new Float32Array(2*a),o=new Uint8Array(a),j(e.root,l,i,0),U(e.root,t),n=new Mt(new Uint16Array(t),l,i,r,o)),n}}]),t}(),Gt=function(t){function a(t){var n,l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new fe,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return e(this,a),n=k(this,s(a).call(this)),n.root=new qt(l,i),n.voxelCount=0,null!==t&&null!==t.edgeData&&n.construct(t),0<=qt.errorThreshold&&n.simplify(),n}return i(a,t),n(a,[{key:\"simplify\",value:function(){this.voxelCount-=this.root.collapse()}},{key:\"construct\",value:function(e){var t,a,l,r,o,s,u,c,m,p,v,k=zt.resolution,n=e.edgeData,g=e.materialIndices,h=new At,f=new fe,S=[n.edgesX(this.min,this.root.size),n.edgesY(this.min,this.root.size),n.edgesZ(this.min,this.root.size)],w=[new Uint8Array([0,1,2,3]),new Uint8Array([0,1,4,5]),new Uint8Array([0,2,4,6])],I=0;for(p=0;3>p;++p){l=w[p],t=S[p];var T=!0,C=!1,P=void 0;try{for(var b,E=t[Symbol.iterator]();!(T=(b=E.next()).done);T=!0)for(a=b.value,a.computeZeroCrossingPosition(f),v=0;4>v;++v)r=He[l[v]],u=a.coordinates.x-r[0],c=a.coordinates.y-r[1],m=a.coordinates.z-r[2],0<=u&&0<=c&&0<=m&&u<k&&c<k&&m<k&&(o=Q(this.root,k,u,c,m),null===o.voxel&&(o.voxel=G(k,u,c,m,g),++I),s=o.voxel,s.normal.add(a.n),s.qefData.add(f,a.n),s.qefData.numPoints===s.edgeCount&&(h.setData(s.qefData).solve(s.position),!o.contains(s.position)&&s.position.copy(h.massPoint),s.normal.normalize()))}catch(e){C=!0,P=e}finally{try{T||null==E[\"return\"]||E[\"return\"]()}finally{if(C)throw P}}}this.voxelCount=I}}]),a}(ot),Ht={EXTRACT:\"worker.extract\",MODIFY:\"worker.modify\",CONFIGURE:\"worker.config\",CLOSE:\"worker.close\"},Jt=function(t){function a(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return e(this,a),t=k(this,s(a).call(this,n)),t.data=null,t}return i(a,t),a}(Lt),Kt=function(t){function a(){var t;return e(this,a),t=k(this,s(a).call(this,Ht.EXTRACT)),t.isosurface=null,t}return i(a,t),a}(Jt),Wt=new zt(!1),$t=function(){function t(){e(this,t),this.data=null,this.response=null}return n(t,[{key:\"getData\",value:function(){return this.data}},{key:\"respond\",value:function(){return this.response.data=this.data.serialize(),this.response}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.data&&this.data.createTransferList(e),e}},{key:\"process\",value:function(e){return this.data=Wt.deserialize(e.data),this}}]),t}(),ea=function(t){function a(){var t;return e(this,a),t=k(this,s(a).call(this)),t.response=new Kt,t.decompressionTarget=new zt(!1),t.isosurface=null,t}return i(a,t),n(a,[{key:\"respond\",value:function(){var e=h(s(a.prototype),\"respond\",this).call(this);return e.isosurface=null===this.isosurface?null:this.isosurface.serialise(),e}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return h(s(a.prototype),\"createTransferList\",this).call(this,e),null===this.isosurface?e:this.isosurface.createTransferList(e)}},{key:\"process\",value:function(e){var t=h(s(a.prototype),\"process\",this).call(this,e).getData(),n=new Gt(t.decompress(this.decompressionTarget));return this.isosurface=Qt.run(n),this.decompressionTarget.clear(),this}}]),a}($t),ta={UNION:\"csg.union\",DIFFERENCE:\"csg.difference\",INTERSECTION:\"csg.intersection\",DENSITY_FUNCTION:\"csg.densityfunction\"},aa=function(){function t(a){e(this,t),this.type=a;for(var n=arguments.length,l=Array(1<n?n-1:0),i=1;i<n;i++)l[i-1]=arguments[i];this.children=l,this.boundingBox=null}return n(t,[{key:\"getBoundingBox\",value:function(){return null===this.boundingBox&&(this.boundingBox=this.computeBoundingBox()),this.boundingBox}},{key:\"computeBoundingBox\",value:function(){var e,t,a=this.children,n=new v;for(e=0,t=a.length;e<t;++e)n.union(a[e].getBoundingBox());return n}}]),t}(),na=function(t){function a(){var t;e(this,a);for(var n=arguments.length,l=Array(n),i=0;i<n;i++)l[i]=arguments[i];return k(this,(t=s(a)).call.apply(t,[this,ta.UNION].concat(l)))}return i(a,t),n(a,[{key:\"updateMaterialIndex\",value:function(e,t,a){var n=a.materialIndices[e];n!==vt.AIR&&t.setMaterialIndex(e,n)}},{key:\"selectEdge\",value:function(e,t,a){return a?e.t>t.t?e:t:e.t<t.t?e:t}}]),a}(aa),la=function(t){function a(){var t;e(this,a);for(var n=arguments.length,l=Array(n),i=0;i<n;i++)l[i]=arguments[i];return k(this,(t=s(a)).call.apply(t,[this,ta.DIFFERENCE].concat(l)))}return i(a,t),n(a,[{key:\"updateMaterialIndex\",value:function(e,t,a){a.materialIndices[e]!==vt.AIR&&t.setMaterialIndex(e,vt.AIR)}},{key:\"selectEdge\",value:function(e,t,a){return a?e.t<t.t?e:t:e.t>t.t?e:t}}]),a}(aa),ia=function(t){function a(){var t;e(this,a);for(var n=arguments.length,l=Array(n),i=0;i<n;i++)l[i]=arguments[i];return k(this,(t=s(a)).call.apply(t,[this,ta.INTERSECTION].concat(l)))}return i(a,t),n(a,[{key:\"updateMaterialIndex\",value:function(e,t,a){var n=a.materialIndices[e];t.setMaterialIndex(e,t.materialIndices[e]!==vt.AIR&&n!==vt.AIR?n:vt.AIR)}},{key:\"selectEdge\",value:function(e,t,a){return a?e.t<t.t?e:t:e.t>t.t?e:t}}]),a}(aa),ra=0,oa=new fe,sa=function(){function t(){e(this,t)}return n(t,null,[{key:\"run\",value:function(e,t,a,n){oa.fromArray(e),ra=t,null===a?n.operation===ta.UNION&&(a=new zt(!1)):a.decompress();var l=n.toCSG(),i=null===a?null:te(l);if(null!==i){switch(n.operation){case ta.UNION:l=new na(l);break;case ta.DIFFERENCE:l=new la(l);break;case ta.INTERSECTION:l=new ia(l);}ee(l,a,i),a.contoured=!1}return null!==a&&a.empty?null:a}}]),t}(),ya=function(t){function a(t){var n;return e(this,a),n=k(this,s(a).call(this,ta.DENSITY_FUNCTION)),n.sdf=t,n}return i(a,t),n(a,[{key:\"computeBoundingBox\",value:function(){return this.sdf.getBoundingBox(!0)}},{key:\"generateMaterialIndex\",value:function(e){return this.sdf.sample(e)<=zt.isovalue?this.sdf.material:vt.AIR}},{key:\"generateEdge\",value:function(e){e.approximateZeroCrossing(this.sdf),e.computeSurfaceNormal(this.sdf)}}]),a}(aa),ua=new c,da=function(){function t(a){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:vt.SOLID;e(this,t),this.type=a,this.operation=null,this.material=he(255,ge(vt.SOLID,le(n))),this.boundingBox=null,this.position=new fe,this.quaternion=new De,this.scale=new fe(1,1,1),this.inverseTransformation=new c,this.updateInverseTransformation(),this.children=[]}return n(t,[{key:\"getTransformation\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new c;return e.compose(this.position,this.quaternion,this.scale)}},{key:\"getBoundingBox\",value:function(){var e,t,a=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],n=this.children,r=this.boundingBox;if(null===r&&(r=this.computeBoundingBox(),this.boundingBox=r),a)for(r=r.clone(),e=0,t=n.length;e<t;++e)r.union(n[e].getBoundingBox(a));return r}},{key:\"setMaterial\",value:function(e){return this.material=he(255,ge(vt.SOLID,le(e))),this}},{key:\"setOperationType\",value:function(e){return this.operation=e,this}},{key:\"updateInverseTransformation\",value:function(){return this.inverseTransformation.getInverse(this.getTransformation(ua)),this.boundingBox=null,this}},{key:\"union\",value:function(e){return this.children.push(e.setOperationType(ta.UNION)),this}},{key:\"subtract\",value:function(e){return this.children.push(e.setOperationType(ta.DIFFERENCE)),this}},{key:\"intersect\",value:function(e){return this.children.push(e.setOperationType(ta.INTERSECTION)),this}},{key:\"toCSG\",value:function(){var e,t,a,n,r=this.children,o=new ya(this);for(a=0,n=r.length;a<n;++a)t=r[a],e!==t.operation&&(e=t.operation,e===ta.UNION?o=new na(o):e===ta.DIFFERENCE?o=new la(o):e===ta.INTERSECTION?o=new ia(o):void 0),o.children.push(t.toCSG());return o}},{key:\"serialize\",value:function(){var e,t,a=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],n={type:this.type,operation:this.operation,material:this.material,position:this.position.toArray(),quaternion:this.quaternion.toArray(),scale:this.scale.toArray(),parameters:null,children:[]};for(e=0,t=this.children.length;e<t;++e)n.children.push(this.children[e].serialize(a));return n}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e}},{key:\"toJSON\",value:function(){return this.serialize(!0)}},{key:\"computeBoundingBox\",value:function(){throw new Error(\"SignedDistanceFunction#computeBoundingBox method not implemented!\")}},{key:\"sample\",value:function(){throw new Error(\"SignedDistanceFunction#sample method not implemented!\")}}]),t}(),ca={HEIGHTFIELD:\"sdf.heightfield\",FRACTAL_NOISE:\"sdf.fractalnoise\",SUPER_PRIMITIVE:\"sdf.superprimitive\"},ma=function(t){function a(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},l=1<arguments.length?arguments[1]:void 0;return e(this,a),t=k(this,s(a).call(this,ca.PERLIN_NOISE,l)),t.min=d(fe,S(n.min)),t.max=d(fe,S(n.max)),t}return i(a,t),n(a,[{key:\"computeBoundingBox\",value:function(){return this.bbox=new v(this.min,this.max),this.bbox}},{key:\"sample\",value:function(){}},{key:\"serialize\",value:function(){var e=h(s(a.prototype),\"serialize\",this).call(this);return e.parameters={min:this.min.toArray(),max:this.max.toArray()},e}}]),a}(da),xa=function(t){function a(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},l=1<arguments.length?arguments[1]:void 0;return e(this,a),t=k(this,s(a).call(this,ca.HEIGHTFIELD,l)),t.width=void 0===n.width?1:n.width,t.height=void 0===n.height?1:n.height,t.smooth=void 0===n.smooth||n.smooth,t.data=void 0===n.data?null:n.data,t.heightmap=null,void 0!==n.image&&t.fromImage(n.image),t}return i(a,t),n(a,[{key:\"fromImage\",value:function(e){var t,a,n,r,o=\"undefined\"==typeof document?null:ae(e),s=null;if(null!==o){for(t=o.data,s=new Uint8ClampedArray(t.length/4),(a=0,n=0,r=s.length);a<r;++a,n+=4)s[a]=t[n];this.heightmap=e,this.width=o.width,this.height=o.height,this.data=s}return this}},{key:\"getHeight\",value:function(e,t){var n,l=this.width,i=this.height,r=this.data;if(e=se(e*l),t=se(t*i),this.smooth){e=ge(he(e,l-1),1),t=ge(he(t,i-1),1);var o=e+1,s=e-1,y=t*l,a=y+l,u=y-l;n=(r[u+s]+r[u+e]+r[u+o]+r[y+s]+r[y+e]+r[y+o]+r[a+s]+r[a+e]+r[a+o])/9}else n=r[t*l+e];return n}},{key:\"computeBoundingBox\",value:function(){var e=new v,t=he(this.width/this.height,1),a=he(this.height/this.width,1);return e.min.set(0,0,0),e.max.set(t,1,a),e.applyMatrix4(this.getTransformation()),e}},{key:\"sample\",value:function(e){var t,a=this.boundingBox;return a.containsPoint(e)?(e.applyMatrix4(this.inverseTransformation),t=e.y-this.getHeight(e.x,e.z)/255):t=a.distanceToPoint(e),t}},{key:\"serialize\",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t=h(s(a.prototype),\"serialize\",this).call(this);return t.parameters={width:this.width,height:this.height,smooth:this.smooth,data:e?null:this.data,dataURL:e&&null!==this.heightmap?this.heightmap.toDataURL():null,image:null},t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.data.buffer),e}}]),a}(da),pa=function(t){function a(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},l=1<arguments.length?arguments[1]:void 0;return e(this,a),t=k(this,s(a).call(this,ca.SUPER_PRIMITIVE,l)),t.s0=d(Ue,S(n.s)),t.r0=d(fe,S(n.r)),t.s=new Ue,t.r=new fe,t.ba=new Ie,t.offset=0,t.precompute(),t}return i(a,t),n(a,[{key:\"setSize\",value:function(e,t,a,n){return this.s0.set(e,t,a,n),this.precompute()}},{key:\"setRadii\",value:function(e,t,a){return this.r0.set(e,t,a),this.precompute()}},{key:\"precompute\",value:function(){var e=this.s.copy(this.s0),t=this.r.copy(this.r0),a=this.ba;e.x-=t.x,e.y-=t.x,t.x-=e.w,e.w-=t.y,e.z-=t.y,this.offset=-2*e.z,a.set(t.z,this.offset);var n=a.dot(a);return 0===n?a.set(0,-1):a.divideScalar(n),this}},{key:\"computeBoundingBox\",value:function(){var e=this.s0,t=new v;return t.min.x=he(-e.x,-1),t.min.y=he(-e.y,-1),t.min.z=he(-e.z,-1),t.max.x=ge(e.x,1),t.max.y=ge(e.y,1),t.max.z=ge(e.z,1),t.applyMatrix4(this.getTransformation()),t}},{key:\"sample\",value:function(e){e.applyMatrix4(this.inverseTransformation);var t=this.s,a=this.r,n=this.ba,l=ke(e.x)-t.x,i=ke(e.y)-t.y,r=ke(e.z)-t.z,o=ge(l,0),s=ge(i,0),y=ue(o*o+s*s),u=e.z-t.z,d=ke(y+he(0,ge(l,i))-a.x)-t.w,m=he(ge(d*n.x+u*n.y,0),1),c=d-a.z*m,x=u-this.offset*m,p=ge(d-a.z,0),v=e.z+t.z,k=ge(d,0),g=d*-n.y+u*n.x,h=ue(he(c*c+x*x,he(p*p+v*v,k*k+u*u)));return h*ie(ge(g,r))-a.y}},{key:\"serialize\",value:function(){var e=h(s(a.prototype),\"serialize\",this).call(this);return e.parameters={s:this.s0.toArray(),r:this.r0.toArray()},e}}],[{key:\"create\",value:function(e){var t=va[e];return new a({s:t[0],r:t[1]})}}]),a}(da),va=[[new Float32Array([1,1,1,1]),new Float32Array([0,0,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,0,0])],[new Float32Array([0,0,1,1]),new Float32Array([0,0,1])],[new Float32Array([1,1,2,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,.25,1]),new Float32Array([1,.25,0])],[new Float32Array([1,1,.25,.25]),new Float32Array([1,.25,0])],[new Float32Array([1,1,1,.25]),new Float32Array([1,.1,0])],[new Float32Array([1,1,1,.25]),new Float32Array([.1,.1,0])]],ka=function(){function t(){e(this,t)}return n(t,[{key:\"revive\",value:function(e){var t,a,n;switch(e.type){case ca.FRACTAL_NOISE:t=new ma(e.parameters,e.material);break;case ca.HEIGHTFIELD:t=new xa(e.parameters,e.material);break;case ca.SUPER_PRIMITIVE:t=new pa(e.parameters,e.material);}for(t.operation=e.operation,t.position.fromArray(e.position),t.quaternion.fromArray(e.quaternion),t.scale.fromArray(e.scale),t.updateInverseTransformation(),(a=0,n=e.children.length);a<n;++a)t.children.push(this.revive(e.children[a]));return t}}]),t}(),ga=function(t){function a(){var t;return e(this,a),t=k(this,s(a).call(this,Ht.MODIFY)),t.sdf=null,t}return i(a,t),a}(Jt),ha=function(t){function a(){var t;return e(this,a),t=k(this,s(a).call(this)),t.response=new ga,t.sdf=null,t}return i(a,t),n(a,[{key:\"respond\",value:function(){var e=h(s(a.prototype),\"respond\",this).call(this);return e.sdf=null===this.sdf?null:this.sdf.serialize(),e}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return h(s(a.prototype),\"createTransferList\",this).call(this,e),null===this.sdf?e:this.sdf.createTransferList(e)}},{key:\"process\",value:function(e){var t=h(s(a.prototype),\"process\",this).call(this,e).getData(),n=this.sdf=ka.revive(e.sdf),l=sa.run(e.cellPosition,e.cellSize,t,n);return f(s(a.prototype),\"data\",null===l?null:l.compress(),this,!0),this}}]),a}($t),za=new ha,fa=new ea,Sa=null;self.addEventListener(\"message\",function(e){var t=e.data;switch(Sa=t.action,Sa){case Ht.MODIFY:postMessage(za.process(t).respond(),za.createTransferList());break;case Ht.EXTRACT:postMessage(fa.process(t).respond(),fa.createTransferList());break;case Ht.CONFIGURE:zt.resolution=t.resolution,qt.errorThreshold=t.errorThreshold;break;case Ht.CLOSE:default:close();}}),self.addEventListener(\"error\",function(e){var t,a=Sa===Ht.MODIFY?za:Sa===Ht.EXTRACT?fa:null;null===a?(t=new Lt(Ht.CLOSE),t.error=e,postMessage(t)):(t=a.respond(),t.action=Ht.CLOSE,t.error=e,postMessage(t,a.createTransferList())),close()})})();\n"],{type:"text/javascript"})),a.maxWorkers=Ae(navigator.hardwareConcurrency,Ce(e,1)),a.workers=[],a.busyWorkers=new WeakSet,a.configurationMessage=new Nn,a}return o(n,e),i(n,[{key:"handleEvent",value:function(e){switch(e.type){case"message":{this.busyWorkers["delete"](e.target),Xn.worker=e.target,Xn.response=e.data,this.dispatchEvent(Xn),this.workers.length>this.maxWorkers&&this.closeWorker(e.target);break}case"error":{console.error("Encountered an unexpected error",e);break}}}},{key:"closeWorker",value:function(e){var t=this.workers.indexOf(e);this.busyWorkers.has(e)?(this.busyWorkers["delete"](e),e.terminate()):e.postMessage(new Bn(Mn.CLOSE)),e.removeEventListener("message",this),e.removeEventListener("error",this),0<=t&&this.workers.splice(t,1)}},{key:"createWorker",value:function(){var e=new Worker(this.workerURL);return this.workers.push(e),e.addEventListener("message",this),e.addEventListener("error",this),e.postMessage(this.configurationMessage),e}},{key:"getWorker",value:function(){var e=null,t,n;for(t=0,n=this.workers.length;t<n;++t)if(!this.busyWorkers.has(this.workers[t])){e=this.workers[t],this.busyWorkers.add(e);break}return null===e&&this.workers.length<this.maxWorkers&&null!==this.workerURL&&(e=this.createWorker(),this.busyWorkers.add(e)),e}},{key:"clear",value:function(){for(;0<this.workers.length;)this.closeWorker(this.workers.pop())}},{key:"dispose",value:function(){this.clear(),URL.revokeObjectURL(this.workerURL),this.workerURL=null}}]),n}(Be),_n=function(e){function n(e){var a;return t(this,n),a=k(this,u(n).call(this,e)),a.octant=null,a.octantId=null,a.error=null,a}return o(n,e),n}(Me),jn=new _n("modificationstart"),Kn=new _n("modificationend"),Gn=new _n("extractionstart"),Hn=new _n("extractionend"),Wn=new _n("load"),Qn=new _n("error"),Jn=function(e){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a;t(this,n);var i=void 0===e.world?{}:e.world;return Xt.resolution=void 0===e.resolution?32:e.resolution,a=k(this,u(n).call(this)),a.object=null,a.world=new En(i.cellSize,i.levels,i.keyDesign),a.clipmap=new On(a.world),a.clipmap.addEventListener("shellupdate",x(a)),a.threadPool=new Zn(e.workers),a.threadPool.addEventListener("message",x(a)),a.tasks=new WeakMap,a.sdfLoader=new tn,a.sdfLoader.addEventListener("load",x(a)),a.history=[],a.dtSq=a.world.getCellSize(),a}return o(n,e),i(n,[{key:"handleEvent",value:function(e){switch(e.type){case"shellupdate":break;case"message":break;case"load":this.revive(e.descriptions),this.dispatchEvent(Wn);}}},{key:"applyCSG",value:function(e){this.world.applyCSG(e),this.history.push(e)}},{key:"union",value:function(e){this.applyCSG(e.setOperationType(Le.UNION))}},{key:"subtract",value:function(e){this.applyCSG(e.setOperationType(Le.DIFFERENCE))}},{key:"intersect",value:function(e){this.applyCSG(e.setOperationType(Le.INTERSECTION))}},{key:"update",value:function(e){this.clipmap.position.distanceToSquared(e)>=this.dtSq&&this.clipmap.update(e)}},{key:"raycast",value:function(e){return this.world.raycast(e)}},{key:"clear",value:function(){this.world.clear(),this.clipmap.clear(),this.threadPool.clear(),this.sdfLoader.clear(),this.tasks=new WeakMap,this.history=[]}},{key:"dispose",value:function(){this.threadPool.dispose()}},{key:"revive",value:function(e){var t,n;for(t=0,n=e.length;t<n;++t)this.applyCSG(Jt.revive(e[t]))}},{key:"save",value:function(){return 0===this.history.length?null:URL.createObjectURL(new Blob([JSON.stringify(this.history)],{type:"text/json"}))}},{key:"load",value:function(e){var t=JSON.parse(e);this.clear(),this.sdfLoader.load(t)}}]),n}(Be),$n=function(){function e(n,a,i,r,s){t(this,e),this.indices=n,this.positions=a,this.normals=i,this.uvs=r,this.materials=s}return i(e,[{key:"serialize",value:function(){return{indices:this.indices,positions:this.positions,normals:this.normals,uvs:this.uvs,materials:this.materials}}},{key:"deserialize",value:function(e){var t=this;return null===e?t=null:(this.indices=e.indices,this.positions=e.positions,this.normals=e.normals,this.uvs=e.uvs,this.materials=e.materials),t}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.indices.buffer),e.push(this.positions.buffer),e.push(this.normals.buffer),e.push(this.uvs.buffer),e.push(this.materials.buffer),e}}]),e}(),ea=[new Uint8Array([0,4,0]),new Uint8Array([1,5,0]),new Uint8Array([2,6,0]),new Uint8Array([3,7,0]),new Uint8Array([0,2,1]),new Uint8Array([4,6,1]),new Uint8Array([1,3,1]),new Uint8Array([5,7,1]),new Uint8Array([0,1,2]),new Uint8Array([2,3,2]),new Uint8Array([4,5,2]),new Uint8Array([6,7,2])],ta=[new Uint8Array([0,1,2,3,0]),new Uint8Array([4,5,6,7,0]),new Uint8Array([0,4,1,5,1]),new Uint8Array([2,6,3,7,1]),new Uint8Array([0,2,4,6,2]),new Uint8Array([1,3,5,7,2])],na=[[new Uint8Array([4,0,0]),new Uint8Array([5,1,0]),new Uint8Array([6,2,0]),new Uint8Array([7,3,0])],[new Uint8Array([2,0,1]),new Uint8Array([6,4,1]),new Uint8Array([3,1,1]),new Uint8Array([7,5,1])],[new Uint8Array([1,0,2]),new Uint8Array([3,2,2]),new Uint8Array([5,4,2]),new Uint8Array([7,6,2])]],aa=[[new Uint8Array([1,4,0,5,1,1]),new Uint8Array([1,6,2,7,3,1]),new Uint8Array([0,4,6,0,2,2]),new Uint8Array([0,5,7,1,3,2])],[new Uint8Array([0,2,3,0,1,0]),new Uint8Array([0,6,7,4,5,0]),new Uint8Array([1,2,0,6,4,2]),new Uint8Array([1,3,1,7,5,2])],[new Uint8Array([1,1,0,3,2,0]),new Uint8Array([1,5,4,7,6,0]),new Uint8Array([0,1,5,0,4,1]),new Uint8Array([0,3,7,2,6,1])]],ia=[[new Uint8Array([3,2,1,0,0]),new Uint8Array([7,6,5,4,0])],[new Uint8Array([5,1,4,0,1]),new Uint8Array([7,3,6,2,1])],[new Uint8Array([6,4,2,0,2]),new Uint8Array([7,5,3,1,2])]],ra=[new Uint8Array([3,2,1,0]),new Uint8Array([7,5,6,4]),new Uint8Array([11,10,9,8])],sa=me(2,16)-1,la=function(){function e(){t(this,e)}return i(e,null,[{key:"run",value:function(e){var t=[],n=e.voxelCount,a=null,i=null,r=null,s=null,l=null;return n>sa?console.warn("Could not create geometry for cell at position",e.min,"(vertex count of",n,"exceeds limit of ",sa,")"):0<n&&(i=new Float32Array(3*n),r=new Float32Array(3*n),s=new Float32Array(2*n),l=new Uint8Array(n),Q(e.root,i,r,0),W(e.root,t),a=new $n(new Uint16Array(t),i,r,s,l)),a}}]),e}(),oa=new qe,ua=function(){function e(){t(this,e)}return i(e,null,[{key:"calculateCoefficients",value:function(e,t,n){var a,i,r;return 0===t?(oa.x=1,oa.y=0):(a=(n-e)/(2*t),i=ze(1+a*a),r=1/(0<=a?a+i:a-i),oa.x=1/ze(1+r*r),oa.y=r*oa.x),oa}}]),e}(),ya=function(){function e(){t(this,e)}return i(e,null,[{key:"rotateXY",value:function(e,t){var n=t.x,a=t.y,i=e.x,r=e.y;e.set(n*i-a*r,a*i+n*r)}},{key:"rotateQXY",value:function(e,t,n){var a=n.x,i=n.y,r=a*a,s=i*i,l=2*a*i*t,o=e.x,u=e.y;e.set(r*o-l+s*u,s*o+l+r*u)}}]),e}(),ha=.1,ca=new ot,da=new je,ma=new qe,va=new Re,ga=function(){function e(){t(this,e)}return i(e,null,[{key:"solve",value:function(e,t,n){var a=te(ca.copy(e),da.identity()),i=ae(da,a);n.copy(t).applyMatrix3(i)}}]),e}(),xa=new Re,fa=function(){function e(){t(this,e),this.data=null,this.ata=new ot,this.atb=new Re,this.massPoint=new Re,this.hasSolution=!1}return i(e,[{key:"setData",value:function(e){return this.data=e,this.hasSolution=!1,this}},{key:"solve",value:function(e){var t=this.data,n=this.massPoint,a=this.ata.copy(t.ata),i=this.atb.copy(t.atb),r=1/0;return!this.hasSolution&&null!==t&&0<t.numPoints&&(xa.copy(t.massPointSum).divideScalar(t.numPoints),n.copy(xa),a.applyToVector3(xa),i.sub(xa),ga.solve(a,i,e),r=ie(a,i,e),e.add(n),this.hasSolution=!0),r}}]),e}(),pa=function(){function e(){t(this,e),this.ata=new ot,this.ata.set(0,0,0,0,0,0),this.atb=new Re,this.massPointSum=new Re,this.numPoints=0}return i(e,[{key:"set",value:function(e,t,n,a){return this.ata.copy(e),this.atb.copy(t),this.massPointSum.copy(n),this.numPoints=a,this}},{key:"copy",value:function(e){return this.set(e.ata,e.atb,e.massPointSum,e.numPoints)}},{key:"add",value:function(e,t){var n=t.x,a=t.y,i=t.z,r=e.dot(t),s=this.ata.elements,l=this.atb;s[0]+=n*n,s[1]+=n*a,s[3]+=a*a,s[2]+=n*i,s[4]+=a*i,s[5]+=i*i,l.x+=r*n,l.y+=r*a,l.z+=r*i,this.massPointSum.add(e),++this.numPoints}},{key:"addData",value:function(e){this.ata.add(e.ata),this.atb.add(e.atb),this.massPointSum.add(e.massPointSum),this.numPoints+=e.numPoints}},{key:"clear",value:function(){this.ata.set(0,0,0,0,0,0),this.atb.set(0,0,0),this.massPointSum.set(0,0,0),this.numPoints=0}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),ka=function e(){t(this,e),this.materials=0,this.edgeCount=0,this.index=-1,this.position=new Re,this.normal=new Re,this.qefData=null},za=new fa,wa=.1,Sa=-1,Ia=function(e){function n(e,a){var i;return t(this,n),i=k(this,u(n).call(this,e,a)),i.voxel=null,i}return o(n,e),i(n,[{key:"contains",value:function(e){var t=this.min,n=this.size;return e.x>=t.x-wa&&e.y>=t.y-wa&&e.z>=t.z-wa&&e.x<=t.x+n+wa&&e.y<=t.y+n+wa&&e.z<=t.z+n+wa}},{key:"collapse",value:function(){var e=this.children,t=[-1,-1,-1,-1,-1,-1,-1,-1],n=new Re,a=-1,r=null!==e,s=0,l,o,u,y,h,c,d;if(r){for(y=new pa,c=0,d=0;8>d;++d)l=e[d],s+=l.collapse(),u=l.voxel,null===l.children?null!==u&&(y.addData(u.qefData),a=1&u.materials>>7-d,t[d]=1&u.materials>>d,++c):r=!1;if(r&&(h=za.setData(y).solve(n),h<=Sa)){for(u=new ka,u.position.copy(this.contains(n)?n:za.massPoint),d=0;8>d;++d)o=t[d],l=e[d],-1===o?u.materials|=a<<d:(u.materials|=o<<d,u.normal.add(l.voxel.normal));u.normal.normalize(),u.qefData=y,this.voxel=u,this.children=null,s+=c-1}}return s}}],[{key:"errorThreshold",get:function(){return Sa},set:function(e){Sa=e}}]),n}(wt),ba=function(e){function n(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Re,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,r;return t(this,n),r=k(this,u(n).call(this)),r.root=new Ia(a,i),r.voxelCount=0,null!==e&&null!==e.edgeData&&r.construct(e),0<=Ia.errorThreshold&&r.simplify(),r}return o(n,e),i(n,[{key:"simplify",value:function(){this.voxelCount-=this.root.collapse()}},{key:"construct",value:function(e){var t=Xt.resolution,n=e.edgeData,a=e.materialIndices,r=new fa,s=new Re,l=[n.edgesX(this.min,this.root.size),n.edgesY(this.min,this.root.size),n.edgesZ(this.min,this.root.size)],o=[new Uint8Array([0,1,2,3]),new Uint8Array([0,1,4,5]),new Uint8Array([0,2,4,6])],u=0,h,c,m,v,g,f,p,k,w,S,I;for(S=0;3>S;++S){m=o[S],h=l[S];var b=!0,T=!1,C=void 0;try{for(var A=h[Symbol.iterator](),E;!(b=(E=A.next()).done);b=!0)for(c=E.value,c.computeZeroCrossingPosition(s),I=0;4>I;++I)v=pt[m[I]],p=c.coordinates.x-v[0],k=c.coordinates.y-v[1],w=c.coordinates.z-v[2],0<=p&&0<=k&&0<=w&&p<t&&k<t&&w<t&&(g=re(this.root,t,p,k,w),null===g.voxel&&(g.voxel=se(t,p,k,w,a),++u),f=g.voxel,f.normal.add(c.n),f.qefData.add(s,c.n),f.qefData.numPoints===f.edgeCount&&(r.setData(f.qefData).solve(f.position),!g.contains(f.position)&&f.position.copy(r.massPoint),f.normal.normalize()))}catch(e){T=!0,C=e}finally{try{b||null==A["return"]||A["return"]()}finally{if(T)throw C}}}this.voxelCount=u}}]),n}(Dt),Ta=0,Ca=new Re,Aa=function(){function e(){t(this,e)}return i(e,null,[{key:"run",value:function(e,t,n,a){Ca.fromArray(e),Ta=t,null===n?a.operation===Le.UNION&&(n=new Xt(!1)):n.decompress();var i=a.toCSG(),r=null===n?null:de(i);if(null!==r){switch(a.operation){case Le.UNION:i=new ct(i);break;case Le.DIFFERENCE:i=new dt(i);break;case Le.INTERSECTION:i=new mt(i);}ce(i,n,r),n.contoured=!1}return null!==n&&n.empty?null:n}}]),e}(),Ea=new Xt(!1),Pa=function(){function e(){t(this,e),this.data=null,this.response=null}return i(e,[{key:"getData",value:function(){return this.data}},{key:"respond",value:function(){return this.response.data=this.data.serialize(),this.response}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.data&&this.data.createTransferList(e),e}},{key:"process",value:function(e){return this.data=Ea.deserialize(e.data),this}}]),e}(),Da=function(e){function n(){var e;return t(this,n),e=k(this,u(n).call(this)),e.response=new Un,e.decompressionTarget=new Xt(!1),e.isosurface=null,e}return o(n,e),i(n,[{key:"respond",value:function(){var e=w(u(n.prototype),"respond",this).call(this);return e.isosurface=null===this.isosurface?null:this.isosurface.serialise(),e}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return w(u(n.prototype),"createTransferList",this).call(this,e),null===this.isosurface?e:this.isosurface.createTransferList(e)}},{key:"process",value:function(e){var t=w(u(n.prototype),"process",this).call(this,e).getData(),a=new ba(t.decompress(this.decompressionTarget));return this.isosurface=la.run(a),this.decompressionTarget.clear(),this}}]),n}(Pa),Fa=function(e){function n(){var e;return t(this,n),e=k(this,u(n).call(this)),e.response=new Yn,e.sdf=null,e}return o(n,e),i(n,[{key:"respond",value:function(){var e=w(u(n.prototype),"respond",this).call(this);return e.sdf=null===this.sdf?null:this.sdf.serialize(),e}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return w(u(n.prototype),"createTransferList",this).call(this,e),null===this.sdf?e:this.sdf.createTransferList(e)}},{key:"process",value:function(e){var t=w(u(n.prototype),"process",this).call(this,e).getData(),a=this.sdf=Jt.revive(e.sdf),i=Aa.run(e.cellPosition,e.cellSize,t,a);return I(u(n.prototype),"data",null===i?null:i.compress(),this,!0),this}}]),n}(Pa);e.Action=Mn,e.BinaryUtils=nn,e.Clipmap=On,e.ConfigurationMessage=Nn,e.ConstructiveSolidGeometry=Aa,e.DataMessage=Ln,e.DataProcessor=Pa,e.Deserializable=Pe,e.Difference=dt,e.Disposable=De,e.DualContouring=la,e.Edge=Mt,e.EdgeData=Nt,e.EdgeIterator=Vt,e.ExtractionRequest=Rn,e.ExtractionResponse=Un,e.FractalNoise=Gt,e.Givens=ua,e.Heightfield=Ht,e.HermiteData=Xt,e.IntermediateWorldOctant=mn,e.Intersection=mt,e.Isosurface=$n,e.KeyDesign=un,e.KeyIterator=an,e.Material=yt,e.Message=Bn,e.ModificationRequest=Vn,e.ModificationResponse=Yn,e.OperationType=Le,e.QEFData=pa,e.QEFSolver=fa,e.Queue=Oe,e.RunLengthEncoding=vt,e.SDFLoader=tn,e.SDFLoaderEvent=$t,e.SDFType=Kt,e.Scene=Pn,e.Schur=ya,e.Serializable=Ee,e.SignedDistanceFunction=jt,e.SingularValueDecomposition=ga,e.SparseVoxelOctree=ba,e.SuperPrimitive=Wt,e.SuperPrimitivePreset={CUBE:0,CYLINDER:1,CONE:2,PILL:3,SPHERE:4,PELLET:5,TORUS:6,PIPE:7,CORRIDOR:8},e.SurfaceExtractor=Da,e.Terrain=Jn,e.TerrainEvent=_n,e.ThreadPool=Zn,e.TransferableContainer=Fe,e.Union=ct,e.VolumeModifier=Fa,e.Voxel=ka,e.VoxelCell=Ia,e.WorkerEvent=qn,e.WorldOctant=dn,e.WorldOctantId=yn,e.WorldOctantIterator=cn,e.WorldOctantWrapper=hn,e.WorldOctree=En,e.WorldOctreeCSG=zn,e.WorldOctreeRaycaster=Cn,Object.defineProperty(e,"__esModule",{value:!0})});
