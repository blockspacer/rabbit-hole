(function(){"use strict";function e(e){o.postMessage({action:s.CONFIGURE,resolution:Number.parseInt(e.target.value)})}function t(e){var t=e.target.id,n=document.createElement("h3");n.appendChild(document.createTextNode("Running "+t+" Test\u2026")),document.getElementById("aside").appendChild(n),document.getElementById("mask").removeAttribute("class"),o.postMessage({action:s.TEST,id:t})}function n(e){var t=e.data,n=document.createElement("div"),i=document.createElement("span"),r=document.createElement("a");r.href=t.reportURL,r.setAttribute("download",t.reportName+".log"),r.setAttribute("class","report"),r.appendChild(document.createTextNode("Report \u2B73")),i.appendChild(document.createTextNode("Test complete")),i.setAttribute("class","status"),i.appendChild(r),n.setAttribute("class","result"),n.appendChild(i),n.appendChild(r),document.getElementById("aside").appendChild(n),document.getElementById("mask").setAttribute("class","hidden")}function i(){var e=document.getElementById("main"),n=document.createElement("ul"),i=void 0,r=void 0,s=void 0,o=!0,l=!1,h=void 0;try{for(var c,y=u[Symbol.iterator]();!(o=(c=y.next()).done);o=!0)i=c.value,r=document.createElement("li"),s=document.createElement("a"),s.appendChild(document.createTextNode(i)),s.setAttribute("href","#"+i),s.setAttribute("id",i),s.addEventListener("click",t),r.appendChild(s),n.appendChild(r)}catch(e){l=!0,h=e}finally{try{!o&&y.return&&y.return()}finally{if(l)throw h}}e.appendChild(n)}function r(e){switch(e.type){case"message":n(e);break;case"error":console.error("Encountered an unexpected error",e);}}var s={CONFIGURE:"worker.config",TEST:"worker.test"},a=URL.createObjectURL(new Blob(["(function(){\"use strict\";function e(e,t,n){return ce(de(e,n),t)}function t(e,t,n,i,a,r){var s=0;return e>t&&e>n?(a<e&&(s|=2),r<e&&(s|=1)):t>n?(i<t&&(s|=4),r<t&&(s|=1)):(i<n&&(s|=4),a<n&&(s|=2)),s}function n(e,t,n,i){var a=void 0,s=0;return t<n?(a=t,s=0):(a=n,s=1),i<a&&(s=2),r[e][s]}function i(e,a,r,s,o,l,u,y,d){var c=e.children,h=void 0,m=void 0,v=void 0,g=void 0;if(0<=o&&0<=l&&0<=u)if(null===c)d.push(e);else{m=.5*(a+o),v=.5*(r+l),g=.5*(s+u),h=t(a,r,s,m,v,g);do 0===h?(i(c[St],a,r,s,m,v,g,y,d),h=n(h,m,v,g)):1===h?(i(c[1^St],a,r,g,m,v,u,y,d),h=n(h,m,v,u)):2===h?(i(c[2^St],a,v,s,m,l,g,y,d),h=n(h,m,l,g)):3===h?(i(c[3^St],a,v,g,m,l,u,y,d),h=n(h,m,l,u)):4===h?(i(c[4^St],m,r,s,o,v,g,y,d),h=n(h,o,v,g)):5===h?(i(c[5^St],m,r,g,o,v,u,y,d),h=n(h,o,v,u)):6===h?(i(c[6^St],m,v,s,o,l,g,y,d),h=n(h,o,l,g)):7===h?(i(c[7^St],m,v,g,o,l,u,y,d),h=8):void 0;while(8>h)}}function s(e){var t=e.children,n=0,a=void 0,r=void 0,o=void 0;if(null!==t)for(a=0,r=t.length;a<r;++a)o=1+s(t[a]),o>n&&(n=o);return n}function o(e,t,n){var a=e.children,r=void 0,s=void 0;if(bt.min=e.min,bt.max=e.max,t.intersectsBox(bt))if(null!==a)for(r=0,s=a.length;r<s;++r)o(a[r],t,n);else n.push(e)}function y(e,t,n,a){var r=e.children,s=void 0,o=void 0;if(n===t)a.push(e);else if(null!==r)for(++n,s=0,o=r.length;s<o;++s)y(r[s],t,n,a)}function h(e){var t=e.children,n=0,a=void 0,r=void 0;if(null!==t)for(a=0,r=t.length;a<r;++a)n+=h(t[a]);else null!==e.points&&(n=e.points.length);return n}function g(e,t,n,a,r){var s=a.children,o=!1,u=!1,y=void 0,d=void 0;if(a.contains(e,n.bias)){if(null===s){if(null===a.points)a.points=[],a.data=[];else for(y=0,d=a.points.length;!o&&y<d;++y)o=a.points[y].equals(e);o?(a.data[y-1]=t,u=!0):a.points.length<n.maxPoints||r===n.maxDepth?(a.points.push(e.clone()),a.data.push(t),++n.pointCount,u=!0):(a.split(),a.redistribute(n.bias),s=a.children)}if(null!==s)for(++r,y=0,d=s.length;!u&&y<d;++y)u=g(e,t,n,s[y],r)}return u}function x(e,t,n,a){var r=n.children,s=null,o=void 0,u=void 0,y=void 0,d=void 0,c=void 0;if(n.contains(e,t.bias))if(null!==r)for(o=0,u=r.length;null===s&&o<u;++o)s=x(e,t,r[o],n);else if(null!==n.points)for(y=n.points,d=n.data,(o=0,u=y.length);o<u;++o)if(y[o].equals(e)){c=u-1,s=d[o],o<c&&(y[o]=y[c],d[o]=d[c]),y.pop(),d.pop(),--t.pointCount,null!==a&&h(a)<=t.maxPoints&&a.merge();break}return s}function k(e,t,n){var a=n.children,r=null,s=void 0,o=void 0,u=void 0;if(n.contains(e,t.bias))if(null!==a)for(s=0,o=a.length;null===r&&s<o;++s)r=k(e,t,a[s]);else if(null!==n.points)for(u=n.points,s=0,o=u.length;null===r&&s<o;++s)e.distanceToSquared(u[s])<=At&&(r=n.data[s]);return r}function z(e,t,n,a,r,s){var o=a.children,u=null,y=void 0,d=void 0,c=void 0;if(a.contains(e,n.bias))if(!a.contains(t,n.bias))u=x(e,n,a,r),g(t,u,n,r,s-1);else if(null!==o)for(++s,y=0,d=o.length;null===u&&y<d;++y)u=z(e,t,n,o[y],a,s);else if(null!==a.points)for(c=a.points,y=0,d=c.length;y<d;++y)if(e.distanceToSquared(c[y])<=At){c[y].copy(t),u=a.data[y];break}return u}function w(e,t,n,a){var r=a.points,s=a.children,o=null,u=t,y=void 0,d=void 0,c=void 0,h=void 0,m=void 0,v=void 0,g=void 0;if(null!==s)for(m=s.map(function(t){return{octant:t,distance:t.distanceToCenterSquared(e)}}).sort(function(e,t){return e.distance-t.distance}),y=0,d=m.length;y<d;++y)v=m[y].octant,v.contains(e,u)&&(g=w(e,u,n,v),null!==g&&(h=g.point.distanceToSquared(e),(!n||0<h)&&h<u&&(u=h,o=g)));else if(null!==r)for(y=0,d=r.length;y<d;++y)c=r[y],h=e.distanceToSquared(c),(!n||0<h)&&h<u&&(u=h,o={point:c.clone(),data:a.data[y]});return o}function S(e,t,n,a,r){var s=a.points,o=a.children,u=void 0,y=void 0,d=void 0,c=void 0,h=void 0;if(null!==o)for(u=0,y=o.length;u<y;++u)h=o[u],h.contains(e,t)&&S(e,t,n,h,r);else if(null!==s)for(u=0,y=s.length;u<y;++u)d=s[u],c=e.distanceToSquared(d),(!n||0<c)&&c<=t*t&&r.push({point:d.clone(),data:a.data[u]})}function P(e){var t=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\"),n=t.getContext(\"2d\");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height)}function I(e,t,n,a,r,s,o){var l=void 0,u=void 0,y=void 0,d=void 0,c=void 0,h=void 0;if(n.csg.add(t),0<o)for(--o,l=e.getGrid(o),u=e.getKeyDesign(),y=n.children,d=zn[o],a<<=1,r<<=1,s<<=1,h=0;8>h;++h)0!=(y&1<<h)&&(c=mt[h],gn.set(a+c[0],r+c[1],s+c[2]),d.containsPoint(gn)&&I(e,t,l.get(u.packKey(gn)),gn.x,gn.y,gn.z,o))}function T(e,t,n,i,a,r){var s=0;return e>t&&e>n?(a<e&&(s|=2),r<e&&(s|=1)):t>n?(i<t&&(s|=4),r<t&&(s|=1)):(i<n&&(s|=4),a<n&&(s|=2)),s}function _(e,t,n,i){var a=void 0,r=0;return t<n?(a=t,r=0):(a=n,r=1),i<a&&(r=2),In[e][r]}function A(e,t,n,a,r,s,o,l,u,y,d,c,h){var m=void 0,v=void 0,g=void 0,x=void 0,p=void 0,f=void 0,k=void 0,z=void 0,w=void 0,S=void 0,P=void 0;if(0<=y&&0<=d&&0<=c)if(m=e.getKeyDesign(),0===s||null!==t.isosurface)v=e.getCellSize(s),g=new cn(t),g.id.set(s,m.packKey(Sn.set(n,a,r))),g.min.copy(Sn).multiplyScalar(v).add(e.min),g.max.copy(g.min).addScalar(v),h.push(g);else if(0<t.children){x=e.getGrid(--s),p=t.children,n<<=1,a<<=1,r<<=1,z=.5*(o+y),w=.5*(l+d),S=.5*(u+c),k=T(o,l,u,z,w,S);do switch(P=Tn^k,k){case 0:{0!=(p&1<<P)&&(f=mt[P],Sn.set(n+f[0],a+f[1],r+f[2]),A(e,x.get(m.packKey(Sn)),Sn.x,Sn.y,Sn.z,s,o,l,u,z,w,S,h)),k=_(k,z,w,S);break}case 1:{0!=(p&1<<P)&&(f=mt[P],Sn.set(n+f[0],a+f[1],r+f[2]),A(e,x.get(m.packKey(Sn)),Sn.x,Sn.y,Sn.z,s,o,l,S,z,w,c,h)),k=_(k,z,w,c);break}case 2:{0!=(p&1<<P)&&(f=mt[P],Sn.set(n+f[0],a+f[1],r+f[2]),A(e,x.get(m.packKey(Sn)),Sn.x,Sn.y,Sn.z,s,o,w,u,z,d,S,h)),k=_(k,z,d,S);break}case 3:{0!=(p&1<<P)&&(f=mt[P],Sn.set(n+f[0],a+f[1],r+f[2]),A(e,x.get(m.packKey(Sn)),Sn.x,Sn.y,Sn.z,s,o,w,S,z,d,c,h)),k=_(k,z,d,c);break}case 4:{0!=(p&1<<P)&&(f=mt[P],Sn.set(n+f[0],a+f[1],r+f[2]),A(e,x.get(m.packKey(Sn)),Sn.x,Sn.y,Sn.z,s,z,l,u,y,w,S,h)),k=_(k,y,w,S);break}case 5:{0!=(p&1<<P)&&(f=mt[P],Sn.set(n+f[0],a+f[1],r+f[2]),A(e,x.get(m.packKey(Sn)),Sn.x,Sn.y,Sn.z,s,z,l,S,y,w,c,h)),k=_(k,y,w,c);break}case 6:{0!=(p&1<<P)&&(f=mt[P],Sn.set(n+f[0],a+f[1],r+f[2]),A(e,x.get(m.packKey(Sn)),Sn.x,Sn.y,Sn.z,s,z,w,u,y,d,S,h)),k=_(k,y,d,S);break}case 7:{0!=(p&1<<P)&&(f=mt[P],Sn.set(n+f[0],a+f[1],r+f[2]),A(e,x.get(m.packKey(Sn)),Sn.x,Sn.y,Sn.z,s,z,w,S,y,d,c,h)),k=8;break}}while(8>k)}}function C(e,t,n,i,a){var r=l.min.set(0,0,0),s=l.max.subVectors(t.max,t.min),o=t.getDimensions(bn.min),u=bn.max.copy(o).multiplyScalar(.5),y=d.origin.copy(i.origin),c=d.direction.copy(i.direction),h=void 0,m=void 0,v=void 0,g=void 0,x=void 0,p=void 0,f=void 0,k=void 0,z=void 0;y.sub(t.getCenter(Sn)).add(u),Tn=0,0>c.x&&(y.x=o.x-y.x,c.x=-c.x,Tn|=4),0>c.y&&(y.y=o.y-y.y,c.y=-c.y,Tn|=2),0>c.z&&(y.z=o.z-y.z,c.z=-c.z,Tn|=1),h=1/c.x,m=1/c.y,v=1/c.z,g=(r.x-y.x)*h,x=(s.x-y.x)*h,p=(r.y-y.y)*m,f=(s.y-y.y)*m,k=(r.z-y.z)*v,z=(s.z-y.z)*v,A(e,t.octant,n.x,n.y,n.z,e.getDepth(),g,p,k,x,f,z,a)}function O(e,t,n,a,r,s){var o=void 0,l=void 0,u=void 0,y=void 0,d=void 0,c=void 0,h=void 0;if(0<s){for(--s,o=e.getGrid(s),l=e.getKeyDesign(),u=t.children,n<<=1,a<<=1,r<<=1,h=0;8>h;++h)0!=(u&1<<h)&&(d=mt[h],An.set(n+d[0],a+d[1],r+d[2]),c=l.packKey(An),y=o.get(c),o.delete(c),O(e,y,An.x,An.y,An.z,s));t.children=0}}function D(e,t,n,a,r){var s,o,l,u;++r<e.levels&&(s=e.getGrid(r),o=Cn.calculateOffsetIndex(t,n,a),An.set(t>>>1,n>>>1,a>>>1),l=e.getKeyDesign().packKey(An),u=s.get(l),u.children&=~(1<<o),0===u.children&&(s.delete(l),D(e,An.x,An.y,An.z,r)))}function E(e,t,n){var a=[-1,-1,-1,-1],r=[!1,!1,!1,!1],s=1/0,o=0,l=!1,u=void 0,y=void 0,d=void 0,c=void 0,h=void 0,m=void 0,v=void 0;for(v=0;4>v;++v)h=e[v],m=ui[t][v],u=vt[m][0],y=vt[m][1],d=1&h.voxel.materials>>u,c=1&h.voxel.materials>>y,h.size<s&&(s=h.size,o=v,l=d!==rt.AIR),a[v]=h.voxel.index,r[v]=d!=c;r[o]&&(l?(n.push(a[0]),n.push(a[3]),n.push(a[1]),n.push(a[0]),n.push(a[2]),n.push(a[3])):(n.push(a[0]),n.push(a[1]),n.push(a[3]),n.push(a[0]),n.push(a[3]),n.push(a[2])))}function F(e,t,n){var a=[0,0,0,0],r=void 0,s=void 0,o=void 0,l=void 0;if(null!==e[0].voxel&&null!==e[1].voxel&&null!==e[2].voxel&&null!==e[3].voxel)E(e,t,n);else for(o=0;2>o;++o){for(a[0]=li[t][o][0],a[1]=li[t][o][1],a[2]=li[t][o][2],a[3]=li[t][o][3],r=[],l=0;4>l;++l)if(s=e[l],null!==s.voxel)r[l]=s;else if(null!==s.children)r[l]=s.children[a[l]];else break;4===l&&F(r,li[t][o][4],n)}}function L(e,t,n){var a=[0,0,0,0],r=[[0,0,1,1],[0,1,0,1]],s=void 0,o=void 0,l=void 0,u=void 0,y=void 0,d=void 0;if(null!==e[0].children||null!==e[1].children){for(y=0;4>y;++y)a[0]=si[t][y][0],a[1]=si[t][y][1],s=[null===e[0].children?e[0]:e[0].children[a[0]],null===e[1].children?e[1]:e[1].children[a[1]]],L(s,si[t][y][2],n);for(y=0;4>y;++y){for(a[0]=oi[t][y][1],a[1]=oi[t][y][2],a[2]=oi[t][y][3],a[3]=oi[t][y][4],l=r[oi[t][y][0]],o=[],d=0;4>d;++d)if(u=e[l[d]],null!==u.voxel)o[d]=u;else if(null!==u.children)o[d]=u.children[a[d]];else break;4===d&&F(o,oi[t][y][5],n)}}}function B(e,t){var n=e.children,a=[0,0,0,0],r=void 0,s=void 0,o=void 0;if(null!==n){for(o=0;8>o;++o)B(n[o],t);for(o=0;12>o;++o)a[0]=ai[o][0],a[1]=ai[o][1],r=[n[a[0]],n[a[1]]],L(r,ai[o][2],t);for(o=0;6>o;++o)a[0]=ri[o][0],a[1]=ri[o][1],a[2]=ri[o][2],a[3]=ri[o][3],s=[n[a[0]],n[a[1]],n[a[2]],n[a[3]]],F(s,ri[o][4],t)}}function V(e,t,n,a){var r,s;if(null!==e.children)for(r=0;8>r;++r)a=V(e.children[r],t,n,a);else null!==e.voxel&&(s=e.voxel,s.index=a,t[3*a]=s.position.x,t[3*a+1]=s.position.y,t[3*a+2]=s.position.z,n[3*a]=s.normal.x,n[3*a+1]=s.normal.y,n[3*a+2]=s.normal.z,++a);return a}function U(e,t){var n=e.elements,i=t.elements,a=void 0;0!==n[1]&&(a=ci.calculateCoefficients(n[0],n[1],n[3]),hi.rotateQXY(xi.set(n[0],n[3]),n[1],a),n[0]=xi.x,n[3]=xi.y,hi.rotateXY(xi.set(n[2],n[4]),a),n[2]=xi.x,n[4]=xi.y,n[1]=0,hi.rotateXY(xi.set(i[0],i[3]),a),i[0]=xi.x,i[3]=xi.y,hi.rotateXY(xi.set(i[1],i[4]),a),i[1]=xi.x,i[4]=xi.y,hi.rotateXY(xi.set(i[2],i[5]),a),i[2]=xi.x,i[5]=xi.y)}function N(e,t){var n=e.elements,i=t.elements,a=void 0;0!==n[2]&&(a=ci.calculateCoefficients(n[0],n[2],n[5]),hi.rotateQXY(xi.set(n[0],n[5]),n[2],a),n[0]=xi.x,n[5]=xi.y,hi.rotateXY(xi.set(n[1],n[4]),a),n[1]=xi.x,n[4]=xi.y,n[2]=0,hi.rotateXY(xi.set(i[0],i[6]),a),i[0]=xi.x,i[6]=xi.y,hi.rotateXY(xi.set(i[1],i[7]),a),i[1]=xi.x,i[7]=xi.y,hi.rotateXY(xi.set(i[2],i[8]),a),i[2]=xi.x,i[8]=xi.y)}function R(e,t){var n=e.elements,i=t.elements,a=void 0;0!==n[4]&&(a=ci.calculateCoefficients(n[3],n[4],n[5]),hi.rotateQXY(xi.set(n[3],n[5]),n[4],a),n[3]=xi.x,n[5]=xi.y,hi.rotateXY(xi.set(n[1],n[2]),a),n[1]=xi.x,n[2]=xi.y,n[4]=0,hi.rotateXY(xi.set(i[3],i[6]),a),i[3]=xi.x,i[6]=xi.y,hi.rotateXY(xi.set(i[4],i[7]),a),i[4]=xi.x,i[7]=xi.y,hi.rotateXY(xi.set(i[5],i[8]),a),i[5]=xi.x,i[8]=xi.y)}function M(t,n){var a=t.elements,e=void 0;for(e=0;e<5;++e)U(t,n),N(t,n),R(t,n);return pi.set(a[0],a[3],a[5])}function Y(e){var t=ue(e)<mi?0:1/e;return ue(t)<mi?0:t}function X(e,t){var n=e.elements,i=n[0],a=n[3],r=n[6],s=n[1],o=n[4],l=n[7],u=n[2],y=n[5],d=n[8],c=Y(t.x),h=Y(t.y),m=Y(t.z);return e.set(i*c*i+a*h*a+r*m*r,i*c*s+a*h*o+r*m*l,i*c*u+a*h*y+r*m*d,s*c*i+o*h*a+l*m*r,s*c*s+o*h*o+l*m*l,s*c*u+o*h*y+l*m*d,u*c*i+y*h*a+d*m*r,u*c*s+y*h*o+d*m*l,u*c*u+y*h*y+d*m*d)}function Z(e,t,n){return e.applyToVector3(ki.copy(n)),ki.subVectors(t,ki),ki.dot(ki)}function j(e,t,a,r,s){var o=0;for(t>>=1;0<t;t>>=1,o=0)a>=t&&(o+=4,a-=t),r>=t&&(o+=2,r-=t),s>=t&&(o+=1,s-=t),null===e.children&&e.split(),e=e.children[o];return e}function K(e,t,n,a,r){var s=e+1,o=new Si,l=void 0,u=void 0,y=void 0,d=void 0,c=void 0,h=void 0,m=void 0,v=void 0,g=void 0,x=void 0;for(l=0,x=0;8>x;++x)d=mt[x],c=(a+d[2])*(s*s)+(n+d[1])*s+(t+d[0]),y=de(r[c],rt.SOLID),l|=y<<x;for(u=0,x=0;12>x;++x)h=vt[x][0],m=vt[x][1],v=1&l>>h,g=1&l>>m,v!=g&&++u;return o.materials=l,o.edgeCount=u,o.qefData=new wi,o}function G(e){var t=Ai,i=Kt.resolution,n=new Oe(0,0,0),a=new Oe(i,i,i),r=new v(Ci,Ci.clone().addScalar(Ai)),s=e.getBoundingBox();return e.type!==Ce.INTERSECTION&&(s.intersectsBox(r)?(n.copy(s.min).max(r.min).sub(r.min),n.x=oe(n.x*i/t),n.y=oe(n.y*i/t),n.z=oe(n.z*i/t),a.copy(s.max).min(r.max).sub(r.min),a.x=le(a.x*i/t),a.y=le(a.y*i/t),a.z=le(a.z*i/t)):(n.set(i,i,i),a.set(0,0,0))),new v(n,a)}function H(e,t,i,a){var r=Kt.resolution,n=r+1,s=a.max.x,o=a.max.y,l=a.max.z,u=void 0,d=void 0,c=void 0;for(c=a.min.z;c<=l;++c)for(d=a.min.y;d<=o;++d)for(u=a.min.x;u<=s;++u)e.updateMaterialIndex(c*(n*n)+d*n+u,t,i)}function $(e,t,i){var a=Ai,r=Kt.resolution,n=r+1,s=t.materialIndices,o=new Oe,l=new Oe,u=i.max.x,d=i.max.y,c=i.max.z,h=void 0,m=0,v=void 0,g=void 0,p=void 0;for(p=i.min.z;p<=c;++p)for(o.z=p*a/r,g=i.min.y;g<=d;++g)for(o.y=g*a/r,v=i.min.x;v<=u;++v)o.x=v*a/r,h=e.generateMaterialIndex(l.addVectors(Ci,o)),h!==rt.AIR&&(s[p*(n*n)+g*n+v]=h,++m);t.materials=m}function W(e,t,a){var r=Kt.resolution,n=r+1,s=new Uint32Array([1,n,n*n]),o=t.materialIndices,l=new Vt,u=new Vt,y=a.edgeData,h=t.edgeData,m=new Uint32Array(3),v=Yt.calculate1DEdgeCount(r),g=new Yt(r,de(v,h.indices[0].length+y.indices[0].length),de(v,h.indices[1].length+y.indices[1].length),de(v,h.indices[2].length+y.indices[2].length)),x=void 0,p=void 0,f=void 0,k=void 0,z=void 0,w=void 0,S=void 0,P=void 0,b=void 0,I=void 0,T=void 0,_=void 0,A=void 0,C=void 0,O=void 0,D=void 0,E=void 0,F=void 0,q=void 0,L=void 0,B=void 0,V=void 0,U=void 0;for(F=0,q=0;3>q;F=0,++q){for(x=y.indices[q],k=h.indices[q],S=g.indices[q],p=y.zeroCrossings[q],z=h.zeroCrossings[q],P=g.zeroCrossings[q],f=y.normals[q],w=h.normals[q],b=g.normals[q],I=s[q],V=x.length,U=k.length,(L=0,B=0);L<V;++L)if(T=x[L],_=T+I,O=o[T],D=o[_],O!==D&&(O===rt.AIR||D===rt.AIR)){for(l.t=p[L],l.n.x=f[3*L],l.n.y=f[3*L+1],l.n.z=f[3*L+2],e.type===Ce.DIFFERENCE&&l.n.negate(),E=l;B<U&&k[B]<=T;)A=k[B],C=A+I,u.t=z[B],u.n.x=w[3*B],u.n.y=w[3*B+1],u.n.z=w[3*B+2],O=o[A],A<T?(D=o[C],O!==D&&(O===rt.AIR||D===rt.AIR)&&(S[F]=A,P[F]=u.t,b[3*F]=u.n.x,b[3*F+1]=u.n.y,b[3*F+2]=u.n.z,++F)):E=e.selectEdge(u,l,O===rt.SOLID),++B;S[F]=T,P[F]=E.t,b[3*F]=E.n.x,b[3*F+1]=E.n.y,b[3*F+2]=E.n.z,++F}for(;B<U;)A=k[B],C=A+I,O=o[A],D=o[C],O!==D&&(O===rt.AIR||D===rt.AIR)&&(S[F]=A,P[F]=z[B],b[3*F]=w[3*B],b[3*F+1]=w[3*B+1],b[3*F+2]=w[3*B+2],++F),++B;m[q]=F}return{edgeData:g,lengths:m}}function Q(e,t,i){var r=Ai,s=Kt.resolution,n=s+1,o=n*n,l=new Uint32Array([1,n,o]),u=t.materialIndices,h=Ci,m=new Oe,v=new Oe,g=new Vt,p=new Uint32Array(3),f=new Yt(s,Yt.calculate1DEdgeCount(s)),k=void 0,w=void 0,S=void 0,P=void 0,b=void 0,I=void 0,T=void 0,_=void 0,A=void 0,C=void 0,O=void 0,D=void 0,E=void 0,F=void 0,q=void 0,L=void 0,B=void 0,V=void 0,U=void 0;for(q=4,E=0,F=0;3>F;q>>=1,E=0,++F){L=mt[q],k=f.indices[F],w=f.zeroCrossings[F],S=f.normals[F],P=l[F],T=i.min.x,C=i.max.x,_=i.min.y,O=i.max.y,A=i.min.z,D=i.max.z;for(0===F?(T=ce(T-1,0),C=de(C,s-1)):1===F?(_=ce(_-1,0),O=de(O,s-1)):2===F?(A=ce(A-1,0),D=de(D,s-1)):void 0,U=A;U<=D;++U)for(V=_;V<=O;++V)for(B=T;B<=C;++B)b=U*o+V*n+B,I=b+P,u[b]!==u[I]&&(m.set(B*r/s,V*r/s,U*r/s),v.set((B+L[0])*r/s,(V+L[1])*r/s,(U+L[2])*r/s),g.a.addVectors(h,m),g.b.addVectors(h,v),e.generateEdge(g),k[E]=b,w[E]=g.t,S[3*E]=g.n.x,S[3*E+1]=g.n.y,S[3*E+2]=g.n.z,++E);p[F]=E}return{edgeData:f,lengths:p}}function J(e,t,n){var i=G(e),a=void 0,r=void 0,s=void 0,o=void 0,l=!1;if(e.type===Ce.DENSITY_FUNCTION?$(e,t,i):t.empty?e.type===Ce.UNION&&(t.set(n),l=!0):!(t.full&&e.type===Ce.UNION)&&H(e,t,n,i),!l&&!t.empty&&!t.full){for(a=e.type===Ce.DENSITY_FUNCTION?Q(e,t,i):W(e,t,n),r=a.edgeData,s=a.lengths,o=0;3>o;++o)r.indices[o]=r.indices[o].slice(0,s[o]),r.zeroCrossings[o]=r.zeroCrossings[o].slice(0,s[o]),r.normals[o]=r.normals[o].slice(0,3*s[o]);t.edgeData=r}}function ee(e){var t=e.children,n=void 0,a=void 0,r=void 0,s=void 0;for(e.type===Ce.DENSITY_FUNCTION&&(n=new Kt,J(e,n)),r=0,s=t.length;r<s&&(a=ee(t[r]),void 0===n?n=a:null===a?e.type===Ce.INTERSECTION&&(n=null):null===n?e.type===Ce.UNION&&(n=a):J(e,n,a),null!==n||e.type===Ce.UNION);++r);return null!==n&&n.empty?null:n}var te=Math.pow,ne=Math.trunc,ie=Math.sign,ae=Math.PI,re=Math.atan2,se=Math.round,oe=Math.ceil,le=Math.floor,ue=Math.abs,ye=Math.acos,de=Math.min,ce=Math.max,he=Math.sqrt,me=Math.cos,ve=Math.sin,ge=function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")},xe=function(){function e(e,t){for(var n=0,a;n<t.length;n++)a=t[n],a.enumerable=a.enumerable||!1,a.configurable=!0,\"value\"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),pe=function e(t,n,i){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,i)}if(\"value\"in a)return a.value;var s=a.get;return void 0===s?void 0:s.call(i)},fe=function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},ke=function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return t&&(\"object\"==typeof t||\"function\"==typeof t)?t:e},ze=function e(t,n,i,a){var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var s=Object.getPrototypeOf(t);null!==s&&e(s,n,i,a)}else if(\"value\"in r&&r.writable)r.value=i;else{var o=r.set;void 0!==o&&o.call(a,i)}return i},we=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},Se=function(){function e(){ge(this,e)}return xe(e,[{key:\"serialize\",value:function(){}}]),e}(),Pe=function(){function e(){ge(this,e)}return xe(e,[{key:\"deserialize\",value:function(){}}]),e}(),be=function(){function e(){ge(this,e)}return xe(e,[{key:\"dispose\",value:function(){}}]),e}(),Ie=function(){function e(){ge(this,e)}return xe(e,[{key:\"createTransferList\",value:function(){}}]),e}(),Te=function(){function e(){ge(this,e),this.elements=[],this.head=0}return xe(e,[{key:\"copy\",value:function(e){return this.elements=Array.from(e.elements),this.head=e.head,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"add\",value:function(e){this.elements.push(e)}},{key:\"peek\",value:function(){return 0<this.elements.length?this.elements[this.head]:void 0}},{key:\"poll\",value:function(){var e=this.elements,t=e.length,n=void 0;return 0<t&&(n=e[this.head++],2*this.head>=t&&(this.elements=e.slice(this.head),this.head=0)),n}},{key:\"clear\",value:function(){this.elements=[],this.head=0}},{key:\"size\",get:function(){return this.elements.length-this.head}},{key:\"empty\",get:function(){return 0===this.elements.length}}]),e}(),_e=function e(t){ge(this,e),this.type=t,this.target=null},Ae=function(){function e(){ge(this,e),this.listenerFunctions=new Map,this.listenerObjects=new Map}return xe(e,[{key:\"addEventListener\",value:function(e,t){var n=\"function\"==typeof t?this.listenerFunctions:this.listenerObjects;n.has(e)?n.get(e).add(t):n.set(e,new Set([t]))}},{key:\"removeEventListener\",value:function(e,t){var n=\"function\"==typeof t?this.listenerFunctions:this.listenerObjects,i=void 0;n.has(e)&&(i=n.get(e),i.delete(t),0===i.size&&n.delete(e))}},{key:\"dispatchEvent\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this,n=t.listenerFunctions,i=t.listenerObjects,a=void 0,r=void 0;if(e.target=t,n.has(e.type)){a=n.get(e.type);var s=!0,o=!1,l=void 0;try{for(var u=a[Symbol.iterator](),y;!(s=(y=u.next()).done);s=!0)r=y.value,r.call(t,e)}catch(e){o=!0,l=e}finally{try{!s&&u.return&&u.return()}finally{if(o)throw l}}}if(i.has(e.type)){a=i.get(e.type);var d=!0,c=!1,h=void 0;try{for(var m=a[Symbol.iterator](),v;!(d=(v=m.next()).done);d=!0)r=v.value,r.handleEvent(e)}catch(e){c=!0,h=e}finally{try{!d&&m.return&&m.return()}finally{if(c)throw h}}}}}]),e}(),Ce={UNION:\"csg.union\",DIFFERENCE:\"csg.difference\",INTERSECTION:\"csg.intersection\",DENSITY_FUNCTION:\"csg.densityfunction\"},Oe=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;ge(this,e),this.x=t,this.y=n,this.z=i}return xe(e,[{key:\"set\",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:\"setFromSpherical\",value:function(e){var t=ve(e.phi)*e.radius;return this.x=t*ve(e.theta),this.y=me(e.phi)*e.radius,this.z=t*me(e.theta),this}},{key:\"setFromCylindrical\",value:function(e){return this.x=e.radius*ve(e.theta),this.y=e.y,this.z=e.radius*me(e.theta),this}},{key:\"setFromMatrixColumn\",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:\"setFromMatrixPosition\",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:\"setFromMatrixScale\",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:\"addVectors\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:\"addScaledVector\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:\"subVectors\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:\"multiplyVectors\",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this}},{key:\"crossVectors\",value:function(e,t){var n=e.x,i=e.y,a=e.z,r=t.x,s=t.y,o=t.z;return this.x=i*o-a*s,this.y=a*r-n*o,this.z=n*s-i*r,this}},{key:\"cross\",value:function(e){return this.crossVectors(this,e)}},{key:\"transformDirection\",value:function(t){var n=this.x,i=this.y,a=this.z,r=t.elements;return this.x=r[0]*n+r[4]*i+r[8]*a,this.y=r[1]*n+r[5]*i+r[9]*a,this.z=r[2]*n+r[6]*i+r[10]*a,this.normalize()}},{key:\"applyMatrix3\",value:function(t){var n=this.x,i=this.y,a=this.z,r=t.elements;return this.x=r[0]*n+r[3]*i+r[6]*a,this.y=r[1]*n+r[4]*i+r[7]*a,this.z=r[2]*n+r[5]*i+r[8]*a,this}},{key:\"applyMatrix4\",value:function(t){var n=this.x,i=this.y,a=this.z,r=t.elements;return this.x=r[0]*n+r[4]*i+r[8]*a+r[12],this.y=r[1]*n+r[5]*i+r[9]*a+r[13],this.z=r[2]*n+r[6]*i+r[10]*a+r[14],this}},{key:\"applyQuaternion\",value:function(e){var t=this.x,n=this.y,i=this.z,a=e.x,r=e.y,s=e.z,o=e.w,l=o*t+r*i-s*n,u=o*n+s*t-a*i,y=o*i+a*n-r*t,d=-a*t-r*n-s*i;return this.x=l*o+d*-a+u*-s-y*-r,this.y=u*o+d*-r+y*-a-l*-s,this.z=y*o+d*-s+l*-r-u*-a,this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:\"reflect\",value:function(e){var t=e.x,n=e.y,i=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(t,n,i),this}},{key:\"angleTo\",value:function(e){var t=this.dot(e)/he(this.lengthSquared()*e.lengthSquared());return ye(de(ce(t,-1),1))}},{key:\"manhattanLength\",value:function(){return ue(this.x)+ue(this.y)+ue(this.z)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:\"length\",value:function(){return he(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:\"manhattanDistanceTo\",value:function(e){return ue(this.x-e.x)+ue(this.y-e.y)+ue(this.z-e.z)}},{key:\"distanceToSquared\",value:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}},{key:\"distanceTo\",value:function(e){return he(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=de(this.x,e.x),this.y=de(this.y,e.y),this.z=de(this.z,e.z),this}},{key:\"max\",value:function(e){return this.x=ce(this.x,e.x),this.y=ce(this.y,e.y),this.z=ce(this.z,e.z),this}},{key:\"clamp\",value:function(e,t){return this.x=ce(e.x,de(t.x,this.x)),this.y=ce(e.y,de(t.y,this.y)),this.z=ce(e.z,de(t.z,this.z)),this}},{key:\"floor\",value:function(){return this.x=le(this.x),this.y=le(this.y),this.z=le(this.z),this}},{key:\"ceil\",value:function(){return this.x=oe(this.x),this.y=oe(this.y),this.z=oe(this.z),this}},{key:\"round\",value:function(){return this.x=se(this.x),this.y=se(this.y),this.z=se(this.z),this}},{key:\"lerp\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:\"lerpVectors\",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}]),e}(),De=new Oe,v=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe(1/0,1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Oe(-Infinity,-Infinity,-Infinity);ge(this,e),this.min=t,this.max=n}return xe(e,[{key:\"set\",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:\"copy\",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"makeEmpty\",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-Infinity,this}},{key:\"isEmpty\",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getSize\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:\"setFromSphere\",value:function(e){return this.set(e.center,e.center),this.expandByScalar(e.radius),this}},{key:\"expandByPoint\",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:\"expandByVector\",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:\"expandByScalar\",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:\"setFromPoints\",value:function(e){var t,n;for(this.min.set(0,0,0),this.max.set(0,0,0),(t=0,n=e.length);t<n;++t)this.expandByPoint(e[t]);return this}},{key:\"setFromCenterAndSize\",value:function(e,t){var n=De.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:\"clampPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Oe;return t.copy(e).clamp(this.min,this.max)}},{key:\"distanceToPoint\",value:function(e){var t=De.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:\"applyMatrix4\",value:function(e){var t=this.min,n=this.max;if(!this.isEmpty()){var i=e.elements,a=i[0]*t.x,r=i[1]*t.x,s=i[2]*t.x,o=i[0]*n.x,l=i[1]*n.x,u=i[2]*n.x,y=i[4]*t.y,d=i[5]*t.y,c=i[6]*t.y,h=i[4]*n.y,m=i[5]*n.y,v=i[6]*n.y,g=i[8]*t.z,x=i[9]*t.z,p=i[10]*t.z,f=i[8]*n.z,k=i[9]*n.z,z=i[10]*n.z;t.x=de(a,o)+de(y,h)+de(g,f)+i[12],t.y=de(r,l)+de(d,m)+de(x,k)+i[13],t.z=de(s,u)+de(c,v)+de(p,z)+i[14],n.x=ce(a,o)+ce(y,h)+ce(g,f)+i[12],n.y=ce(r,l)+ce(d,m)+ce(x,k)+i[13],n.z=ce(s,u)+ce(c,v)+ce(p,z)+i[14]}return this}},{key:\"translate\",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:\"intersect\",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:\"union\",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:\"containsPoint\",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=n.x&&e.y<=n.y&&e.z<=n.z}},{key:\"containsBox\",value:function(e){var t=this.min,n=this.max,i=e.min,a=e.max;return t.x<=i.x&&a.x<=n.x&&t.y<=i.y&&a.y<=n.y&&t.z<=i.z&&a.z<=n.z}},{key:\"intersectsBox\",value:function(e){var t=this.min,n=this.max,i=e.min,a=e.max;return a.x>=t.x&&a.y>=t.y&&a.z>=t.z&&i.x<=n.x&&i.y<=n.y&&i.z<=n.z}},{key:\"intersectsSphere\",value:function(e){var t=this.clampPoint(e.center,De);return t.distanceToSquared(e.center)<=e.radius*e.radius}},{key:\"intersectsPlane\",value:function(e){var t,n;return 0<e.normal.x?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=e.constant&&n>=e.constant}},{key:\"equals\",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),Ee=new v,Fe=new Oe,qe=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;ge(this,e),this.center=t,this.radius=n}return xe(e,[{key:\"set\",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:\"copy\",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromPoints\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Ee.setFromPoints(e).getCenter(this.center),n=0,a=void 0,r=void 0;for(a=0,r=e.length;a<r;++a)n=ce(n,t.distanceToSquared(e[a]));return this.radius=he(n),this}},{key:\"setFromBox\",value:function(e){return e.getCenter(this.center),this.radius=.5*e.getSize(Fe).length(),this}},{key:\"isEmpty\",value:function(){return 0>=this.radius}},{key:\"translate\",value:function(e){return this.center.add(e),this}},{key:\"clampPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Oe,n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:\"distanceToPoint\",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:\"containsPoint\",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:\"intersectsSphere\",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:\"intersectsBox\",value:function(e){return e.intersectsSphere(this)}},{key:\"intersectsPlane\",value:function(e){return ue(e.distanceToPoint(this.center))<=this.radius}},{key:\"equals\",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}]),e}(),Le=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;ge(this,e),this.x=t,this.y=n}return xe(e,[{key:\"set\",value:function(e,t){return this.x=e,this.y=t,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this}},{key:\"addVectors\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:\"addScaledVector\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this}},{key:\"subVectors\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this}},{key:\"applyMatrix3\",value:function(t){var n=this.x,i=this.y,a=t.elements;return this.x=a[0]*n+a[3]*i+a[6],this.y=a[1]*n+a[4]*i+a[7],this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y}},{key:\"manhattanLength\",value:function(){return ue(this.x)+ue(this.y)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y}},{key:\"length\",value:function(){return he(this.x*this.x+this.y*this.y)}},{key:\"manhattanDistanceTo\",value:function(e){return ue(this.x-e.x)+ue(this.y-e.y)}},{key:\"distanceToSquared\",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:\"distanceTo\",value:function(e){return he(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=de(this.x,e.x),this.y=de(this.y,e.y),this}},{key:\"max\",value:function(e){return this.x=ce(this.x,e.x),this.y=ce(this.y,e.y),this}},{key:\"clamp\",value:function(e,t){return this.x=ce(e.x,de(t.x,this.x)),this.y=ce(e.y,de(t.y,this.y)),this}},{key:\"floor\",value:function(){return this.x=le(this.x),this.y=le(this.y),this}},{key:\"ceil\",value:function(){return this.x=oe(this.x),this.y=oe(this.y),this}},{key:\"round\",value:function(){return this.x=se(this.x),this.y=se(this.y),this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:\"angle\",value:function(){var e=re(this.y,this.x);return 0>e&&(e+=2*ae),e}},{key:\"lerp\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:\"lerpVectors\",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:\"rotateAround\",value:function(e,t){var n=me(t),i=ve(t),a=this.x-e.x,r=this.y-e.y;return this.x=a*n-r*i+e.x,this.y=a*i+r*n+e.y,this}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y}},{key:\"width\",get:function(){return this.x},set:function(e){return this.x=e}},{key:\"height\",get:function(){return this.y},set:function(e){return this.y=e}}]),e}(),Be=new Le,Ve=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Le(1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Le(-Infinity,-Infinity);ge(this,e),this.min=t,this.max=n}return xe(e,[{key:\"set\",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:\"copy\",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"makeEmpty\",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-Infinity,this}},{key:\"isEmpty\",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Le;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getSize\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Le;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:\"getBoundingSphere\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new qe;return this.getCenter(e.center),e.radius=.5*this.getSize(Be).length(),e}},{key:\"expandByPoint\",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:\"expandByVector\",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:\"expandByScalar\",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:\"setFromPoints\",value:function(e){var t,n;for(this.min.set(0,0),this.max.set(0,0),(t=0,n=e.length);t<n;++t)this.expandByPoint(e[t]);return this}},{key:\"setFromCenterAndSize\",value:function(e,t){var n=Be.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:\"clampPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Le;return t.copy(e).clamp(this.min,this.max)}},{key:\"distanceToPoint\",value:function(e){var t=Be.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:\"translate\",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:\"intersect\",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:\"union\",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:\"containsPoint\",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.x<=n.x&&e.y<=n.y}},{key:\"containsBox\",value:function(e){var t=this.min,n=this.max,i=e.min,a=e.max;return t.x<=i.x&&a.x<=n.x&&t.y<=i.y&&a.y<=n.y}},{key:\"intersectsBox\",value:function(e){var t=this.min,n=this.max,i=e.min,a=e.max;return a.x>=t.x&&a.y>=t.y&&i.x<=n.x&&i.y<=n.y}},{key:\"equals\",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),Ue=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;ge(this,e),this.radius=t,this.theta=n,this.y=i}return xe(e,[{key:\"set\",value:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}},{key:\"copy\",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromVector3\",value:function(e){return this.radius=he(e.x*e.x+e.z*e.z),this.theta=re(e.x,e.z),this.y=e.y,this}}]),e}(),Ne=function(){function e(){ge(this,e),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return xe(e,[{key:\"set\",value:function(e,t,n,i,a,r,s,o,l){var u=this.elements;return u[0]=e,u[3]=t,u[6]=n,u[1]=i,u[4]=a,u[7]=r,u[2]=s,u[5]=o,u[8]=l,this}},{key:\"identity\",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:\"copy\",value:function(e){var t=e.elements,n=this.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],this}},{key:\"clone\",value:function(){return new this.constructor().fromArray(this.elements)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a=void 0;for(a=0;9>a;++a)n[a]=e[a+t];return this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a=void 0;for(a=0;9>a;++a)e[a+t]=n[a];return e}},{key:\"multiplyMatrices\",value:function(e,t){var n=e.elements,i=t.elements,a=this.elements,r=n[0],s=n[3],o=n[6],l=n[1],u=n[4],y=n[7],d=n[2],c=n[5],h=n[8],m=i[0],v=i[3],g=i[6],x=i[1],p=i[4],f=i[7],k=i[2],z=i[5],w=i[8];return a[0]=r*m+s*x+o*k,a[3]=r*v+s*p+o*z,a[6]=r*g+s*f+o*w,a[1]=l*m+u*x+y*k,a[4]=l*v+u*p+y*z,a[7]=l*g+u*f+y*w,a[2]=d*m+c*x+h*k,a[5]=d*v+c*p+h*z,a[8]=d*g+c*f+h*w,this}},{key:\"multiply\",value:function(e){return this.multiplyMatrices(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyMatrices(e,this)}},{key:\"multiplyScalar\",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:\"determinant\",value:function(){var t=this.elements,n=t[0],a=t[1],r=t[2],s=t[3],o=t[4],e=t[5],l=t[6],u=t[7],y=t[8];return n*o*y-n*e*u-a*s*y+a*e*l+r*s*u-r*o*l}},{key:\"getInverse\",value:function(e){var t=e.elements,n=this.elements,i=t[0],a=t[1],r=t[2],s=t[3],o=t[4],l=t[5],u=t[6],y=t[7],d=t[8],c=d*o-l*y,h=l*u-d*s,m=y*s-o*u,v=i*c+a*h+r*m,g=void 0;return 0==v?(console.error(\"Can't invert matrix, determinant is zero\",e),this.identity()):(g=1/v,n[0]=c*g,n[1]=(r*y-d*a)*g,n[2]=(l*a-r*o)*g,n[3]=h*g,n[4]=(d*i-r*u)*g,n[5]=(r*s-l*i)*g,n[6]=m*g,n[7]=(a*u-y*i)*g,n[8]=(o*i-a*s)*g),this}},{key:\"transpose\",value:function(){var e=this.elements,n=void 0;return n=e[1],e[1]=e[3],e[3]=n,n=e[2],e[2]=e[6],e[6]=n,n=e[5],e[5]=e[7],e[7]=n,this}},{key:\"scale\",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:\"rotate\",value:function(e){var t=me(e),n=ve(e),i=this.elements,a=i[0],r=i[3],s=i[6],o=i[1],l=i[4],u=i[7];return i[0]=t*a+n*o,i[3]=t*r+n*l,i[6]=t*s+n*u,i[1]=-n*a+t*o,i[4]=-n*r+t*l,i[7]=-n*s+t*u,this}},{key:\"translate\",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:\"equals\",value:function(e){var t=this.elements,n=e.elements,a=!0,r=void 0;for(r=0;a&&9>r;++r)t[r]!==n[r]&&(a=!1);return a}}]),e}(),Re={XYZ:\"XYZ\",YZX:\"YZX\",ZXY:\"ZXY\",XZY:\"XZY\",YXZ:\"YXZ\",ZYX:\"ZYX\"},Me=new Oe,Ye=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;ge(this,e),this.x=t,this.y=n,this.z=i,this.w=a}var n=Number.EPSILON;return xe(e,[{key:\"set\",value:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:\"setFromEuler\",value:function(e){var t=e.x,n=e.y,i=e.z,a=me,r=ve,s=a(t/2),o=a(n/2),l=a(i/2),u=r(t/2),y=r(n/2),d=r(i/2);switch(e.order){case Re.XYZ:this.x=u*o*l+s*y*d,this.y=s*y*l-u*o*d,this.z=s*o*d+u*y*l,this.w=s*o*l-u*y*d;break;case Re.YXZ:this.x=u*o*l+s*y*d,this.y=s*y*l-u*o*d,this.z=s*o*d-u*y*l,this.w=s*o*l+u*y*d;break;case Re.ZXY:this.x=u*o*l-s*y*d,this.y=s*y*l+u*o*d,this.z=s*o*d+u*y*l,this.w=s*o*l-u*y*d;break;case Re.ZYX:this.x=u*o*l-s*y*d,this.y=s*y*l+u*o*d,this.z=s*o*d-u*y*l,this.w=s*o*l+u*y*d;break;case Re.YZX:this.x=u*o*l+s*y*d,this.y=s*y*l+u*o*d,this.z=s*o*d-u*y*l,this.w=s*o*l-u*y*d;break;case Re.XZY:this.x=u*o*l-s*y*d,this.y=s*y*l-u*o*d,this.z=s*o*d+u*y*l,this.w=s*o*l+u*y*d;}return this}},{key:\"setFromAxisAngle\",value:function(e,t){var n=t/2,i=ve(n);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=me(n),this}},{key:\"setFromRotationMatrix\",value:function(e){var t=e.elements,n=t[0],i=t[4],a=t[8],r=t[1],o=t[5],l=t[9],u=t[2],y=t[6],d=t[10],c=n+o+d,h=void 0;return 0<c?(h=.5/he(c+1),this.w=.25/h,this.x=(y-l)*h,this.y=(a-u)*h,this.z=(r-i)*h):n>o&&n>d?(h=2*he(1+n-o-d),this.w=(y-l)/h,this.x=.25*h,this.y=(i+r)/h,this.z=(a+u)/h):o>d?(h=2*he(1+o-n-d),this.w=(a-u)/h,this.x=(i+r)/h,this.y=.25*h,this.z=(l+y)/h):(h=2*he(1+d-n-o),this.w=(r-i)/h,this.x=(a+u)/h,this.y=(l+y)/h,this.z=.25*h),this}},{key:\"setFromUnitVectors\",value:function(e,t){var n=e.dot(t)+1;return 1e-6>n?(n=0,ue(e.x)>ue(e.z)?Me.set(-e.y,e.x,0):Me.set(0,-e.z,e.y)):Me.crossVectors(e,t),this.x=Me.x,this.y=Me.y,this.z=Me.z,this.w=n,this.normalize()}},{key:\"invert\",value:function(){return this.conjugate()}},{key:\"conjugate\",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:\"length\",value:function(){return he(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:\"normalize\",value:function(){var e=this.length(),t=void 0;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/e,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:\"multiplyQuaternions\",value:function(e,t){var n=e.x,i=e.y,a=e.z,r=e.w,s=t.x,o=t.y,l=t.z,u=t.w;return this.x=n*u+r*s+i*l-a*o,this.y=i*u+r*o+a*s-n*l,this.z=a*u+r*l+n*o-i*s,this.w=r*u-n*s-i*o-a*l,this}},{key:\"multiply\",value:function(e){return this.multiplyQuaternions(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyQuaternions(e,this)}},{key:\"slerp\",value:function(e,i){var t=this.x,a=this.y,r=this.z,o=this.w,l=void 0,u=void 0,y=void 0,d=void 0,c=void 0,h=void 0,m=void 0;return 1===i?this.copy(e):0<i&&(l=o*e.w+t*e.x+a*e.y+r*e.z,0>l?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,l=-l):this.copy(e),1<=l?(this.w=o,this.x=t,this.y=a,this.z=r):(u=1-l*l,c=1-i,u<=n?(this.w=c*o+i*this.w,this.x=c*t+i*this.x,this.y=c*a+i*this.y,this.z=c*r+i*this.z,this.normalize()):(y=he(u),d=re(y,l),h=ve(c*d)/y,m=ve(i*d)/y,this.w=o*h+this.w*m,this.x=t*h+this.x*m,this.y=a*h+this.y*m,this.z=r*h+this.z*m))),this}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}],[{key:\"slerp\",value:function(e,n,i,a){return i.copy(e).slerp(n,a)}},{key:\"slerpFlat\",value:function(e,i,a,r,o,l,u){var y=o[l],d=o[l+1],c=o[l+2],h=o[l+3],m=a[r],v=a[r+1],g=a[r+2],x=a[r+3],p=void 0,k=void 0,z=void 0,w=void 0,S=void 0,P=void 0,b=void 0,I=void 0;(x!==h||m!==y||v!==d||g!==c)&&(p=1-u,w=m*y+v*d+g*c+x*h,P=0<=w?1:-1,S=1-w*w,S>n&&(z=he(S),b=re(z,w*P),p=ve(p*b)/z,u=ve(u*b)/z),I=u*P,m=m*p+y*I,v=v*p+d*I,g=g*p+c*I,x=x*p+h*I,p===1-u&&(k=1/he(m*m+v*v+g*g+x*x),m*=k,v*=k,g*=k,x*=k)),e[i]=m,e[i+1]=v,e[i+2]=g,e[i+3]=x}}]),e}(),Xe=new Ne,m=new Ye,q=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;ge(this,t),this.x=e,this.y=n,this.z=i,this.order=t.defaultOrder}return xe(t,[{key:\"set\",value:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.order=i,this}},{key:\"copy\",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.order=e[t+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.order,e}},{key:\"toVector3\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe;return e.set(this.x,this.y,this.z)}},{key:\"setFromRotationMatrix\",value:function(t){var n=Math.asin,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order,a=t.elements,r=a[0],s=a[4],o=a[8],l=a[1],u=a[5],y=a[9],d=a[2],c=a[6],h=a[10],m=1-1e-5;switch(i){case Re.XYZ:{this.y=n(e(o,-1,1)),ue(o)<m?(this.x=re(-y,h),this.z=re(-s,r)):(this.x=re(c,u),this.z=0);break}case Re.YXZ:{this.x=n(-e(y,-1,1)),ue(y)<m?(this.y=re(o,h),this.z=re(l,u)):(this.y=re(-d,r),this.z=0);break}case Re.ZXY:{this.x=n(e(c,-1,1)),ue(c)<m?(this.y=re(-d,h),this.z=re(-s,u)):(this.y=0,this.z=re(l,r));break}case Re.ZYX:{this.y=n(-e(d,-1,1)),ue(d)<m?(this.x=re(c,h),this.z=re(l,r)):(this.x=0,this.z=re(-s,u));break}case Re.YZX:{this.z=n(e(l,-1,1)),ue(l)<m?(this.x=re(-y,u),this.y=re(-d,r)):(this.x=0,this.y=re(o,h));break}case Re.XZY:{this.z=n(-e(s,-1,1)),ue(s)<m?(this.x=re(c,u),this.y=re(o,r)):(this.x=re(-y,h),this.y=0);break}}return this.order=i,this}},{key:\"setFromQuaternion\",value:function(e,t){return Xe.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Xe,t)}},{key:\"setFromVector3\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(e.x,e.y,e.z,t)}},{key:\"reorder\",value:function(e){return m.setFromEuler(this),this.setFromQuaternion(m,e)}},{key:\"equals\",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order}}],[{key:\"defaultOrder\",get:function(){return Re.XYZ}}]),t}(),Ze=new Oe,a=new Oe,b=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe(1,0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;ge(this,e),this.normal=t,this.constant=n}return xe(e,[{key:\"set\",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:\"setComponents\",value:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}},{key:\"copy\",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromNormalAndCoplanarPoint\",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:\"setFromCoplanarPoints\",value:function(e,t,n){var i=Ze.subVectors(n,t).cross(a.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,Ze),this}},{key:\"normalize\",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:\"negate\",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:\"distanceToPoint\",value:function(e){return this.normal.dot(e)+this.constant}},{key:\"distanceToSphere\",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:\"projectPoint\",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:\"coplanarPoint\",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:\"translate\",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:\"intersectLine\",value:function(e,n){var i=e.delta(Ze),a=this.normal.dot(i);if(0===a)0===this.distanceToPoint(e.start)&&n.copy(e.start);else{var r=-(e.start.dot(this.normal)+this.constant)/a;0<=r&&1>=r&&n.copy(i).multiplyScalar(r).add(e.start)}return n}},{key:\"intersectsLine\",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return 0>t&&0<n||0>n&&0<t}},{key:\"intersectsBox\",value:function(e){return e.intersectsPlane(this)}},{key:\"intersectsSphere\",value:function(e){return e.intersectsPlane(this)}},{key:\"equals\",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}]),e}(),je=new Oe,Ke=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new b,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new b,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new b,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new b,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new b,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new b;ge(this,e),this.planes=[t,n,i,a,r,s]}return xe(e,[{key:\"set\",value:function(e,t,n,i,a,r){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(i),s[4].copy(a),s[5].copy(r),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"copy\",value:function(e){var t=this.planes,n=void 0;for(n=0;6>n;++n)t[n].copy(e.planes[n]);return this}},{key:\"setFromMatrix\",value:function(e){var t=this.planes,n=e.elements,i=n[0],a=n[1],r=n[2],s=n[3],o=n[4],l=n[5],u=n[6],y=n[7],d=n[8],c=n[9],h=n[10],m=n[11],v=n[12],g=n[13],x=n[14],p=n[15];return t[0].setComponents(s-i,y-o,m-d,p-v).normalize(),t[1].setComponents(s+i,y+o,m+d,p+v).normalize(),t[2].setComponents(s+a,y+l,m+c,p+g).normalize(),t[3].setComponents(s-a,y-l,m-c,p-g).normalize(),t[4].setComponents(s-r,y-u,m-h,p-x).normalize(),t[5].setComponents(s+r,y+u,m+h,p+x).normalize(),this}},{key:\"intersectsSphere\",value:function(e){var t=this.planes,n=e.center,a=-e.radius,r=!0,s=void 0,o=void 0;for(s=0;6>s;++s)if(o=t[s].distanceToPoint(n),o<a){r=!1;break}return r}},{key:\"intersectsBox\",value:function(e){var t=this.planes,n=e.min,a=e.max,r=void 0,s=void 0;for(r=0;6>r;++r)if(s=t[r],je.x=0<s.normal.x?a.x:n.x,je.y=0<s.normal.y?a.y:n.y,je.z=0<s.normal.z?a.z:n.z,0>s.distanceToPoint(je))return!1;return!0}},{key:\"containsPoint\",value:function(e){var t=this.planes,n=!0,a=void 0;for(a=0;6>a;++a)if(0>t[a].distanceToPoint(e)){n=!1;break}return n}}]),e}(),Ge=new Oe,He=new Oe,$e=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Oe;ge(this,e),this.start=t,this.end=n}return xe(e,[{key:\"set\",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:\"copy\",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe;return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:\"delta\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe;return e.subVectors(this.end,this.start)}},{key:\"lengthSquared\",value:function(){return this.start.distanceToSquared(this.end)}},{key:\"length\",value:function(){return this.start.distanceTo(this.end)}},{key:\"at\",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:\"closestPointToPointParameter\",value:function(e,n){Ge.subVectors(e,this.start),He.subVectors(this.end,this.start);var i=He.dot(He),a=He.dot(Ge),r=n?de(ce(a/i,0),1):a/i;return r}},{key:\"closestPointToPoint\",value:function(e){var n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Oe,a=this.closestPointToPointParameter(e,n);return this.delta(i).multiplyScalar(a).add(this.start)}},{key:\"equals\",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}]),e}(),We=new Oe,Qe=new Oe,Je=new Oe,c=function(){function e(){ge(this,e),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return xe(e,[{key:\"set\",value:function(e,t,n,i,a,r,s,o,l,u,y,d,c,h,m,v){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=a,g[5]=r,g[9]=s,g[13]=o,g[2]=l,g[6]=u,g[10]=y,g[14]=d,g[3]=c,g[7]=h,g[11]=m,g[15]=v,this}},{key:\"identity\",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:\"copy\",value:function(e){var t=e.elements,n=this.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],this}},{key:\"clone\",value:function(){return new this.constructor().fromArray(this.elements)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a=void 0;for(a=0;16>a;++a)n[a]=e[a+t];return this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a=void 0;for(a=0;16>a;++a)e[a+t]=n[a];return e}},{key:\"getMaxScaleOnAxis\",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return he(ce(t,n,i))}},{key:\"copyPosition\",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:\"setPosition\",value:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}},{key:\"extractBasis\",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:\"makeBasis\",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:\"extractRotation\",value:function(e){var t=this.elements,n=e.elements,i=1/We.setFromMatrixColumn(e,0).length(),a=1/We.setFromMatrixColumn(e,1).length(),r=1/We.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=0,t[8]=n[8]*r,t[9]=n[9]*r,t[10]=n[10]*r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:\"makeRotationFromEuler\",value:function(t){var n=this.elements,i=t.x,r=t.y,s=t.z,o=me(i),a=ve(i),l=me(r),u=ve(r),y=me(s),e=ve(s),d=void 0,c=void 0,h=void 0,m=void 0,v=void 0,g=void 0,x=void 0,p=void 0,f=void 0,k=void 0,z=void 0,w=void 0;switch(t.order){case Re.XYZ:{d=o*y,c=o*e,h=a*y,m=a*e,n[0]=l*y,n[4]=-l*e,n[8]=u,n[1]=c+h*u,n[5]=d-m*u,n[9]=-a*l,n[2]=m-d*u,n[6]=h+c*u,n[10]=o*l;break}case Re.YXZ:{v=l*y,g=l*e,x=u*y,p=u*e,n[0]=v+p*a,n[4]=x*a-g,n[8]=o*u,n[1]=o*e,n[5]=o*y,n[9]=-a,n[2]=g*a-x,n[6]=p+v*a,n[10]=o*l;break}case Re.ZXY:{v=l*y,g=l*e,x=u*y,p=u*e,n[0]=v-p*a,n[4]=-o*e,n[8]=x+g*a,n[1]=g+x*a,n[5]=o*y,n[9]=p-v*a,n[2]=-o*u,n[6]=a,n[10]=o*l;break}case Re.ZYX:{d=o*y,c=o*e,h=a*y,m=a*e,n[0]=l*y,n[4]=h*u-c,n[8]=d*u+m,n[1]=l*e,n[5]=m*u+d,n[9]=c*u-h,n[2]=-u,n[6]=a*l,n[10]=o*l;break}case Re.YZX:{f=o*l,k=o*u,z=a*l,w=a*u,n[0]=l*y,n[4]=w-f*e,n[8]=z*e+k,n[1]=e,n[5]=o*y,n[9]=-a*y,n[2]=-u*y,n[6]=k*e+z,n[10]=f-w*e;break}case Re.XZY:{f=o*l,k=o*u,z=a*l,w=a*u,n[0]=l*y,n[4]=-e,n[8]=u*y,n[1]=f*e+w,n[5]=o*y,n[9]=k*e-z,n[2]=z*e-k,n[6]=a*y,n[10]=w*e+f;break}}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}},{key:\"makeRotationFromQuaternion\",value:function(e){return this.compose(We.set(0,0,0),e,Qe.set(1,1,1))}},{key:\"lookAt\",value:function(e,t,n){var i=this.elements,a=We,r=Qe,s=Je;return s.subVectors(e,t),0===s.lengthSquared()&&(s.z=1),s.normalize(),a.crossVectors(n,s),0===a.lengthSquared()&&(1===ue(n.z)?s.x+=1e-4:s.z+=1e-4,s.normalize(),a.crossVectors(n,s)),a.normalize(),r.crossVectors(s,a),i[0]=a.x,i[4]=r.x,i[8]=s.x,i[1]=a.y,i[5]=r.y,i[9]=s.y,i[2]=a.z,i[6]=r.z,i[10]=s.z,this}},{key:\"multiplyMatrices\",value:function(e,t){var n=this.elements,i=e.elements,a=t.elements,r=i[0],s=i[4],o=i[8],l=i[12],u=i[1],y=i[5],d=i[9],c=i[13],h=i[2],m=i[6],v=i[10],g=i[14],x=i[3],p=i[7],f=i[11],k=i[15],z=a[0],w=a[4],S=a[8],P=a[12],b=a[1],I=a[5],T=a[9],_=a[13],A=a[2],C=a[6],O=a[10],D=a[14],E=a[3],F=a[7],q=a[11],L=a[15];return n[0]=r*z+s*b+o*A+l*E,n[4]=r*w+s*I+o*C+l*F,n[8]=r*S+s*T+o*O+l*q,n[12]=r*P+s*_+o*D+l*L,n[1]=u*z+y*b+d*A+c*E,n[5]=u*w+y*I+d*C+c*F,n[9]=u*S+y*T+d*O+c*q,n[13]=u*P+y*_+d*D+c*L,n[2]=h*z+m*b+v*A+g*E,n[6]=h*w+m*I+v*C+g*F,n[10]=h*S+m*T+v*O+g*q,n[14]=h*P+m*_+v*D+g*L,n[3]=x*z+p*b+f*A+k*E,n[7]=x*w+p*I+f*C+k*F,n[11]=x*S+p*T+f*O+k*q,n[15]=x*P+p*_+f*D+k*L,this}},{key:\"multiply\",value:function(e){return this.multiplyMatrices(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyMatrices(e,this)}},{key:\"multiplyScalar\",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:\"determinant\",value:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],a=e[12],r=e[1],s=e[5],o=e[9],l=e[13],u=e[2],y=e[6],d=e[10],c=e[14],h=e[3],m=e[7],v=e[11],g=e[15],x=t*s,p=t*o,f=t*l,k=n*r,z=n*o,w=n*l,S=i*r,P=i*s,b=i*l,I=a*r,T=a*s,_=a*o;return h*(_*y-b*y-T*d+w*d+P*c-z*c)+m*(p*c-f*d+I*d-S*c+b*u-_*u)+v*(f*y-x*c-I*y+k*c+T*u-w*u)+g*(-P*u-p*y+x*d+S*y-k*d+z*u)}},{key:\"getInverse\",value:function(e){var t=this.elements,n=e.elements,i=n[0],a=n[1],r=n[2],s=n[3],o=n[4],l=n[5],u=n[6],y=n[7],d=n[8],c=n[9],h=n[10],m=n[11],v=n[12],g=n[13],x=n[14],p=n[15],f=c*x*y-g*h*y+g*u*m-l*x*m-c*u*p+l*h*p,k=v*h*y-d*x*y-v*u*m+o*x*m+d*u*p-o*h*p,z=d*g*y-v*c*y+v*l*m-o*g*m-d*l*p+o*c*p,w=v*c*u-d*g*u-v*l*h+o*g*h+d*l*x-o*c*x,S=i*f+a*k+r*z+s*w,P=void 0;return 0==S?(console.error(\"Can't invert matrix, determinant is zero\",e),this.identity()):(P=1/S,t[0]=f*P,t[1]=(g*h*s-c*x*s-g*r*m+a*x*m+c*r*p-a*h*p)*P,t[2]=(l*x*s-g*u*s+g*r*y-a*x*y-l*r*p+a*u*p)*P,t[3]=(c*u*s-l*h*s-c*r*y+a*h*y+l*r*m-a*u*m)*P,t[4]=k*P,t[5]=(d*x*s-v*h*s+v*r*m-i*x*m-d*r*p+i*h*p)*P,t[6]=(v*u*s-o*x*s-v*r*y+i*x*y+o*r*p-i*u*p)*P,t[7]=(o*h*s-d*u*s+d*r*y-i*h*y-o*r*m+i*u*m)*P,t[8]=z*P,t[9]=(v*c*s-d*g*s-v*a*m+i*g*m+d*a*p-i*c*p)*P,t[10]=(o*g*s-v*l*s+v*a*y-i*g*y-o*a*p+i*l*p)*P,t[11]=(d*l*s-o*c*s-d*a*y+i*c*y+o*a*m-i*l*m)*P,t[12]=w*P,t[13]=(d*g*r-v*c*r+v*a*h-i*g*h-d*a*x+i*c*x)*P,t[14]=(v*l*r-o*g*r-v*a*u+i*g*u+o*a*x-i*l*x)*P,t[15]=(o*c*r-d*l*r+d*a*u-i*c*u-o*a*h+i*l*h)*P),this}},{key:\"transpose\",value:function(){var e=this.elements,n=void 0;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}},{key:\"scale\",value:function(e,t,n){var i=this.elements;return i[0]*=e,i[4]*=t,i[8]*=n,i[1]*=e,i[5]*=t,i[9]*=n,i[2]*=e,i[6]*=t,i[10]*=n,i[3]*=e,i[7]*=t,i[11]*=n,this}},{key:\"makeScale\",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:\"makeTranslation\",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:\"makeRotationX\",value:function(e){var t=me(e),n=ve(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:\"makeRotationY\",value:function(e){var t=me(e),n=ve(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:\"makeRotationZ\",value:function(e){var t=me(e),n=ve(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:\"makeRotationAxis\",value:function(e,n){var i=me(n),a=ve(n),r=1-i,t=e.x,s=e.y,o=e.z,l=r*t,u=r*s;return this.set(l*t+i,l*s-a*o,l*o+a*s,0,l*s+a*o,u*s+i,u*o-a*t,0,l*o-a*s,u*o+a*t,r*o*o+i,0,0,0,0,1),this}},{key:\"makeShear\",value:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}},{key:\"compose\",value:function(e,t,n){var i=this.elements,a=t.x,r=t.y,s=t.z,o=t.w,l=a+a,u=r+r,y=s+s,d=a*l,c=a*u,h=a*y,m=r*u,v=r*y,g=s*y,x=o*l,p=o*u,f=o*y,k=n.x,z=n.y,w=n.z;return i[0]=(1-(m+g))*k,i[1]=(c+f)*k,i[2]=(h-p)*k,i[3]=0,i[4]=(c-f)*z,i[5]=(1-(d+g))*z,i[6]=(v+x)*z,i[7]=0,i[8]=(h+p)*w,i[9]=(v-x)*w,i[10]=(1-(d+m))*w,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}},{key:\"decompose\",value:function(e,t,n){var i=this.elements,a=i[0],r=i[1],s=i[2],o=i[4],l=i[5],u=i[6],y=i[8],d=i[9],c=i[10],h=this.determinant(),m=We.set(a,r,s).length()*(0>h?-1:1),v=We.set(o,l,u).length(),g=We.set(y,d,c).length(),x=1/m,p=1/v,f=1/g;return e.x=i[12],e.y=i[13],e.z=i[14],i[0]*=x,i[1]*=x,i[2]*=x,i[4]*=p,i[5]*=p,i[6]*=p,i[8]*=f,i[9]*=f,i[10]*=f,t.setFromRotationMatrix(this),i[0]=a,i[1]=r,i[2]=s,i[4]=o,i[5]=l,i[6]=u,i[8]=y,i[9]=d,i[10]=c,n.x=m,n.y=v,n.z=g,this}},{key:\"makePerspective\",value:function(e,t,n,i,a,r){var s=this.elements;return s[0]=2*a/(t-e),s[4]=0,s[8]=(t+e)/(t-e),s[12]=0,s[1]=0,s[5]=2*a/(n-i),s[9]=(n+i)/(n-i),s[13]=0,s[2]=0,s[6]=0,s[10]=-(r+a)/(r-a),s[14]=-2*r*a/(r-a),s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}},{key:\"makeOrthographic\",value:function(e,t,n,i,a,r){var s=this.elements,o=1/(t-e),l=1/(n-i),u=1/(r-a);return s[0]=2*o,s[4]=0,s[8]=0,s[12]=-((t+e)*o),s[1]=0,s[5]=2*l,s[9]=0,s[13]=-((n+i)*l),s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-((r+a)*u),s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}},{key:\"equals\",value:function(e){var t=this.elements,n=e.elements,a=!0,r=void 0;for(r=0;a&&16>r;++r)t[r]!==n[r]&&(a=!1);return a}}]),e}(),et=[new Oe,new Oe,new Oe,new Oe],tt=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Oe;ge(this,e),this.origin=t,this.direction=n}return xe(e,[{key:\"set\",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:\"copy\",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"at\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Oe;return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:\"lookAt\",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:\"recast\",value:function(e){return this.origin.copy(this.at(e,et[0])),this}},{key:\"closestPointToPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Oe,n=t.subVectors(e,this.origin).dot(this.direction);return 0<=n?t.copy(this.direction).multiplyScalar(n).add(this.origin):t.copy(this.origin)}},{key:\"distanceSquaredToPoint\",value:function(e){var t=et[0].subVectors(e,this.origin).dot(this.direction);return 0>t?this.origin.distanceToSquared(e):et[0].copy(this.direction).multiplyScalar(t).add(this.origin).distanceToSquared(e)}},{key:\"distanceToPoint\",value:function(e){return he(this.distanceSquaredToPoint(e))}},{key:\"distanceToPlane\",value:function(e){var n=e.normal.dot(this.direction),i=0===n?0===e.distanceToPoint(this.origin)?0:-1:-(this.origin.dot(e.normal)+e.constant)/n;return 0<=i?i:null}},{key:\"distanceSquaredToSegment\",value:function(e,t,n,i){var a=et[0].copy(e).add(t).multiplyScalar(.5),r=et[1].copy(t).sub(e).normalize(),s=et[2].copy(this.origin).sub(a),o=.5*e.distanceTo(t),l=-this.direction.dot(r),u=s.dot(this.direction),y=-s.dot(r),d=s.lengthSq(),c=ue(1-l*l),h=void 0,m=void 0,v=void 0,g=void 0,x=void 0;return 0<c?(h=l*y-u,m=l*u-y,v=o*c,0<=h?m>=-v?m<=v?(g=1/c,h*=g,m*=g,x=h*(h+l*m+2*u)+m*(l*h+m+2*y)+d):(m=o,h=ce(0,-(l*m+u)),x=-h*h+m*(m+2*y)+d):(m=-o,h=ce(0,-(l*m+u)),x=-h*h+m*(m+2*y)+d):m<=-v?(h=ce(0,-(-l*o+u)),m=0<h?-o:de(ce(-o,-y),o),x=-h*h+m*(m+2*y)+d):m<=v?(h=0,m=de(ce(-o,-y),o),x=m*(m+2*y)+d):(h=ce(0,-(l*o+u)),m=0<h?o:de(ce(-o,-y),o),x=-h*h+m*(m+2*y)+d)):(m=0<l?-o:o,h=ce(0,-(l*m+u)),x=-h*h+m*(m+2*y)+d),void 0!==n&&n.copy(this.direction).multiplyScalar(h).add(this.origin),void 0!==i&&i.copy(r).multiplyScalar(m).add(a),x}},{key:\"intersectSphere\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Oe,n=et[0].subVectors(e.center,this.origin),i=n.dot(this.direction),a=n.dot(n)-i*i,r=e.radius*e.radius,s=null,o=void 0,l=void 0,u=void 0;return a<=r&&(o=he(r-a),l=i-o,u=i+o,(0<=l||0<=u)&&(s=0>l?this.at(u,t):this.at(l,t))),s}},{key:\"intersectsSphere\",value:function(e){return this.distanceToPoint(e.center)<=e.radius}},{key:\"intersectPlane\",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Oe,i=this.distanceToPlane(e);return null===i?null:this.at(i,n)}},{key:\"intersectsPlane\",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t}},{key:\"intersectBox\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Oe,n=this.origin,i=this.direction,a=e.min,r=e.max,s=1/i.x,o=1/i.y,l=1/i.z,u=null,y=void 0,d=void 0,c=void 0,h=void 0,m=void 0,v=void 0;return 0<=s?(y=(a.x-n.x)*s,d=(r.x-n.x)*s):(y=(r.x-n.x)*s,d=(a.x-n.x)*s),0<=o?(c=(a.y-n.y)*o,h=(r.y-n.y)*o):(c=(r.y-n.y)*o,h=(a.y-n.y)*o),y<=h&&c<=d&&((c>y||y!=y)&&(y=c),(h<d||d!=d)&&(d=h),0<=l?(m=(a.z-n.z)*l,v=(r.z-n.z)*l):(m=(r.z-n.z)*l,v=(a.z-n.z)*l),y<=v&&m<=d&&((m>y||y!=y)&&(y=m),(v<d||d!=d)&&(d=v),0<=d&&(u=this.at(0<=y?y:d,t)))),u}},{key:\"intersectsBox\",value:function(e){return null!==this.intersectBox(e,et[0])}},{key:\"intersectTriangle\",value:function(e,t,n,i,a){var r=this.direction,s=et[0],o=et[1],l=et[2],u=et[3],y=null,d=void 0,c=void 0,h=void 0,m=void 0,v=void 0;return o.subVectors(t,e),l.subVectors(n,e),u.crossVectors(o,l),d=r.dot(u),0===d||i&&0<d||(0<d?c=1:(c=-1,d=-d),s.subVectors(this.origin,e),h=c*r.dot(l.crossVectors(s,l)),0<=h&&(m=c*r.dot(o.cross(s)),0<=m&&h+m<=d&&(v=-c*s.dot(u),0<=v&&(y=this.at(v/d,a))))),y}},{key:\"applyMatrix4\",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:\"equals\",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),e}(),nt=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;ge(this,e),this.radius=t,this.phi=n,this.theta=i}return xe(e,[{key:\"set\",value:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}},{key:\"copy\",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromVector3\",value:function(e){return this.radius=e.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=re(e.x,e.z),this.phi=ye(de(ce(e.y/this.radius,-1),1))),this.makeSafe()}},{key:\"makeSafe\",value:function(){return this.phi=ce(1e-6,de(ae-1e-6,this.phi)),this}}]),e}(),it=function(){function e(){ge(this,e),this.elements=new Float32Array([1,0,0,1,0,1])}return xe(e,[{key:\"set\",value:function(t,n,i,a,r,s){var o=this.elements;return o[0]=t,o[1]=n,o[3]=a,o[2]=i,o[4]=r,o[5]=s,this}},{key:\"identity\",value:function(){return this.set(1,0,0,1,0,1),this}},{key:\"copy\",value:function(e){var t=e.elements;return this.set(t[0],t[1],t[2],t[3],t[4],t[5]),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"toMatrix3\",value:function(e){var t=e.elements;e.set(t[0],t[1],t[2],t[1],t[3],t[4],t[2],t[4],t[5])}},{key:\"add\",value:function(e){var t=this.elements,n=e.elements;return t[0]+=n[0],t[1]+=n[1],t[3]+=n[3],t[2]+=n[2],t[4]+=n[4],t[5]+=n[5],this}},{key:\"norm\",value:function(){var t=this.elements,e=t[1]*t[1],n=t[2]*t[2],i=t[4]*t[4];return he(t[0]*t[0]+e+n+e+t[3]*t[3]+i+n+i+t[5]*t[5])}},{key:\"off\",value:function(){var t=this.elements;return he(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:\"applyToVector3\",value:function(t){var n=t.x,i=t.y,a=t.z,r=this.elements;return t.x=r[0]*n+r[1]*i+r[2]*a,t.y=r[1]*n+r[3]*i+r[4]*a,t.z=r[2]*n+r[4]*i+r[5]*a,t}},{key:\"equals\",value:function(e){var t=this.elements,n=e.elements,a=!0,r=void 0;for(r=0;a&&6>r;++r)t[r]!==n[r]&&(a=!1);return a}}],[{key:\"calculateIndex\",value:function(e,t){return 3-(3-e)*(2-e)/2+t}}]),e}(),at=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;ge(this,e),this.x=t,this.y=n,this.z=i,this.w=a}return xe(e,[{key:\"set\",value:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:\"setAxisAngleFromQuaternion\",value:function(e){this.w=2*ye(e.w);var t=he(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:\"setAxisAngleFromRotationMatrix\",value:function(e){var t=.01,n=.1,i=e.elements,a=i[0],r=i[4],o=i[8],l=i[1],u=i[5],d=i[9],c=i[2],h=i[6],m=i[10],v=void 0,g=void 0,p=void 0,f=void 0,k=void 0,w=void 0,S=void 0,P=void 0,b=void 0,I=void 0,T=void 0;return ue(r-l)<t&&ue(o-c)<t&&ue(d-h)<t?ue(r+l)<n&&ue(o+c)<n&&ue(d+h)<n&&ue(a+u+m-3)<n?this.set(1,0,0,0):(v=ae,k=(a+1)/2,w=(u+1)/2,S=(m+1)/2,P=(r+l)/4,b=(o+c)/4,I=(d+h)/4,k>w&&k>S?k<t?(g=0,p=.707106781,f=.707106781):(g=he(k),p=P/g,f=b/g):w>S?w<t?(g=.707106781,p=0,f=.707106781):(p=he(w),g=P/p,f=I/p):S<t?(g=.707106781,p=.707106781,f=0):(f=he(S),g=b/f,p=I/f),this.set(g,p,f,v)):(T=he((h-d)*(h-d)+(o-c)*(o-c)+(l-r)*(l-r)),.001>ue(T)&&(T=1),this.x=(h-d)/T,this.y=(o-c)/T,this.z=(l-r)/T,this.w=ye((a+u+m-1)/2)),this}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:\"addVectors\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:\"addScaledVector\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:\"subVectors\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:\"multiplyVectors\",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this.w=e.w*t.w,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this}},{key:\"applyMatrix4\",value:function(t){var n=this.x,i=this.y,a=this.z,r=this.w,s=t.elements;return this.x=s[0]*n+s[4]*i+s[8]*a+s[12]*r,this.y=s[1]*n+s[5]*i+s[9]*a+s[13]*r,this.z=s[2]*n+s[6]*i+s[10]*a+s[14]*r,this.w=s[3]*n+s[7]*i+s[11]*a+s[15]*r,this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:\"manhattanLength\",value:function(){return ue(this.x)+ue(this.y)+ue(this.z)+ue(this.w)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:\"length\",value:function(){return he(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:\"manhattanDistanceTo\",value:function(e){return ue(this.x-e.x)+ue(this.y-e.y)+ue(this.z-e.z)+ue(this.w-e.w)}},{key:\"distanceToSquared\",value:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z,a=this.w-e.w;return t*t+n*n+i*i+a*a}},{key:\"distanceTo\",value:function(e){return he(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=de(this.x,e.x),this.y=de(this.y,e.y),this.z=de(this.z,e.z),this.w=de(this.w,e.w),this}},{key:\"max\",value:function(e){return this.x=ce(this.x,e.x),this.y=ce(this.y,e.y),this.z=ce(this.z,e.z),this.w=ce(this.w,e.w),this}},{key:\"clamp\",value:function(e,t){return this.x=ce(e.x,de(t.x,this.x)),this.y=ce(e.y,de(t.y,this.y)),this.z=ce(e.z,de(t.z,this.z)),this.w=ce(e.w,de(t.w,this.w)),this}},{key:\"floor\",value:function(){return this.x=le(this.x),this.y=le(this.y),this.z=le(this.z),this.w=le(this.w),this}},{key:\"ceil\",value:function(){return this.x=oe(this.x),this.y=oe(this.y),this.z=oe(this.z),this.w=oe(this.w),this}},{key:\"round\",value:function(){return this.x=se(this.x),this.y=se(this.y),this.z=se(this.z),this.w=se(this.w),this}},{key:\"lerp\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:\"lerpVectors\",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}]),e}(),rt={AIR:0,SOLID:1},st=function(){function e(t){ge(this,e),this.type=t;for(var n=arguments.length,i=Array(1<n?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];this.children=i,this.boundingBox=null}return xe(e,[{key:\"getBoundingBox\",value:function(){return null===this.boundingBox&&(this.boundingBox=this.computeBoundingBox()),this.boundingBox}},{key:\"computeBoundingBox\",value:function(){var e=this.children,t=new v,n=void 0,a=void 0;for(n=0,a=e.length;n<a;++n)t.union(e[n].getBoundingBox());return t}}]),e}(),ot=function(e){function t(){var e;ge(this,t);for(var n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];return ke(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this,Ce.UNION].concat(i)))}return fe(t,e),xe(t,[{key:\"updateMaterialIndex\",value:function(e,t,n){var i=n.materialIndices[e];i!==rt.AIR&&t.setMaterialIndex(e,i)}},{key:\"selectEdge\",value:function(e,t,n){return n?e.t>t.t?e:t:e.t<t.t?e:t}}]),t}(st),lt=function(e){function t(){var e;ge(this,t);for(var n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];return ke(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this,Ce.DIFFERENCE].concat(i)))}return fe(t,e),xe(t,[{key:\"updateMaterialIndex\",value:function(e,t,n){n.materialIndices[e]!==rt.AIR&&t.setMaterialIndex(e,rt.AIR)}},{key:\"selectEdge\",value:function(e,t,n){return n?e.t<t.t?e:t:e.t>t.t?e:t}}]),t}(st),ut=function(e){function t(){var e;ge(this,t);for(var n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];return ke(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this,Ce.INTERSECTION].concat(i)))}return fe(t,e),xe(t,[{key:\"updateMaterialIndex\",value:function(e,t,n){var i=n.materialIndices[e];t.setMaterialIndex(e,t.materialIndices[e]!==rt.AIR&&i!==rt.AIR?i:rt.AIR)}},{key:\"selectEdge\",value:function(e,t,n){return n?e.t<t.t?e:t:e.t>t.t?e:t}}]),t}(st),yt=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;ge(this,e),this.runLengths=t,this.data=n}return xe(e,null,[{key:\"encode\",value:function(t){var n=[],a=[],r=t[0],s=1,o=void 0,u=void 0;for(o=1,u=t.length;o<u;++o)r===t[o]?++s:(n.push(s),a.push(r),r=t[o],s=1);return n.push(s),a.push(r),new e(n,a)}},{key:\"decode\",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],a=void 0,r=void 0,s=void 0,o=void 0,l=void 0,u=0;for(r=0,o=t.length;r<o;++r)for(a=t[r],s=0,l=e[r];s<l;++s)n[u++]=a;return n}}]),e}(),dt=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];ge(this,e),this.value=t,this.done=n}return xe(e,[{key:\"reset\",value:function(){this.value=null,this.done=!1}}]),e}(),ct=new Oe,ht=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Oe;ge(this,e),this.min=t,this.max=n,this.children=null}return xe(e,[{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe;return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getDimensions\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe;return e.subVectors(this.max,this.min)}},{key:\"split\",value:function(){var e=this.min,t=this.max,n=this.getCenter(ct),a=this.children=[null,null,null,null,null,null,null,null],r=void 0,s=void 0;for(r=0;8>r;++r)s=mt[r],a[r]=new this.constructor(new Oe(0===s[0]?e.x:n.x,0===s[1]?e.y:n.y,0===s[2]?e.z:n.z),new Oe(0===s[0]?n.x:t.x,0===s[1]?n.y:t.y,0===s[2]?n.z:t.z))}}]),e}(),mt=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],vt=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],gt=new Oe,xt=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;ge(this,e),this.min=t,this.size=n,this.children=null}return xe(e,[{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe;return e.copy(this.min).addScalar(.5*this.size)}},{key:\"getDimensions\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe;return e.set(this.size,this.size,this.size)}},{key:\"split\",value:function(){var e=this.min,t=this.getCenter(gt),n=.5*this.size,a=this.children=[null,null,null,null,null,null,null,null],r=void 0,s=void 0;for(r=0;8>r;++r)s=mt[r],a[r]=new this.constructor(new Oe(0===s[0]?e.x:t.x,0===s[1]?e.y:t.y,0===s[2]?e.z:t.z),n)}},{key:\"max\",get:function(){return this.min.clone().addScalar(this.size)}}]),e}(),pt=new v,ft=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;ge(this,e),this.octree=t,this.region=n,this.cull=null!==n,this.result=new dt,this.trace=null,this.indices=null,this.reset()}return xe(e,[{key:\"reset\",value:function(){var e=this.octree.root;return this.trace=[],this.indices=[],null!==e&&(pt.min=e.min,pt.max=e.max,(!this.cull||this.region.intersectsBox(pt))&&(this.trace.push(e),this.indices.push(0))),this.result.reset(),this}},{key:\"next\",value:function(){for(var e=this.cull,t=this.region,n=this.indices,i=this.trace,a=null,r=i.length-1,s=void 0,o=void 0,l=void 0;null===a&&0<=r;)if(s=n[r]++,o=i[r].children,!(8>s))i.pop(),n.pop(),--r;else if(null!==o){if(l=o[s],e&&(pt.min=l.min,pt.max=l.max,!t.intersectsBox(pt)))continue;i.push(l),n.push(0),++r}else a=i.pop(),n.pop();return this.result.value=a,this.result.done=null===a,this.result}},{key:\"return\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),kt=[new Oe,new Oe,new Oe],zt=new v,wt=new tt,r=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],St=0,Pt=function(){function e(){ge(this,e)}return xe(e,null,[{key:\"intersectOctree\",value:function(e,t,n){var a=zt.min.set(0,0,0),r=zt.max.subVectors(e.max,e.min),s=e.getDimensions(kt[0]),o=kt[1].copy(s).multiplyScalar(.5),l=wt.origin.copy(t.ray.origin),u=wt.direction.copy(t.ray.direction),y=void 0,d=void 0,c=void 0,h=void 0,m=void 0,v=void 0,g=void 0,x=void 0,p=void 0;l.sub(e.getCenter(kt[2])).add(o),St=0,0>u.x&&(l.x=s.x-l.x,u.x=-u.x,St|=4),0>u.y&&(l.y=s.y-l.y,u.y=-u.y,St|=2),0>u.z&&(l.z=s.z-l.z,u.z=-u.z,St|=1),y=1/u.x,d=1/u.y,c=1/u.z,h=(a.x-l.x)*y,m=(r.x-l.x)*y,v=(a.y-l.y)*d,g=(r.y-l.y)*d,x=(a.z-l.z)*c,p=(r.z-l.z)*c,ce(ce(h,v),x)<de(de(m,g),p)&&i(e.root,h,v,x,m,g,p,t,n)}}]),e}(),bt=new v,It=function(){function e(t,n){ge(this,e),this.root=void 0!==t&&void 0!==n?new ht(t,n):null}return xe(e,[{key:\"getCenter\",value:function(e){return this.root.getCenter(e)}},{key:\"getDimensions\",value:function(e){return this.root.getDimensions(e)}},{key:\"getDepth\",value:function(){return s(this.root)}},{key:\"cull\",value:function(e){var t=[];return o(this.root,e,t),t}},{key:\"findOctantsByLevel\",value:function(e){var t=[];return y(this.root,e,0,t),t}},{key:\"raycast\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return Pt.intersectOctree(this,e,t),t}},{key:\"leaves\",value:function(e){return new ft(this,e)}},{key:Symbol.iterator,value:function(){return new ft(this)}},{key:\"min\",get:function(){return this.root.min}},{key:\"max\",get:function(){return this.root.max}},{key:\"children\",get:function(){return this.root.children}}]),e}(),Tt=new Oe,p=function(e){function t(e,n){ge(this,t);var i=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.points=null,i.data=null,i}return fe(t,e),xe(t,[{key:\"distanceToSquared\",value:function(e){var t=Tt.copy(e).clamp(this.min,this.max);return t.sub(e).lengthSquared()}},{key:\"distanceToCenterSquared\",value:function(e){var t=this.getCenter(Tt),n=e.x-t.x,i=e.y-t.x,a=e.z-t.z;return n*n+i*i+a*a}},{key:\"contains\",value:function(e,t){var n=this.min,i=this.max;return e.x>=n.x-t&&e.y>=n.y-t&&e.z>=n.z-t&&e.x<=i.x+t&&e.y<=i.y+t&&e.z<=i.z+t}},{key:\"redistribute\",value:function(e){var t=this.children,n=this.points,a=this.data,r=void 0,s=void 0,o=void 0,l=void 0,u=void 0,y=void 0,d=void 0;if(null!==t&&null!==n)for(r=0,o=n.length;r<o;++r)for(y=n[r],d=a[r],(s=0,l=t.length);s<l;++s)if(u=t[s],u.contains(y,e)){null===u.points&&(u.points=[],u.data=[]),u.points.push(y),u.data.push(d);break}this.points=null,this.data=null}},{key:\"merge\",value:function(){var e=this.children,t=void 0,n=void 0,a=void 0;if(null!==e){for(this.points=[],this.data=[],(t=0,n=e.length);t<n;++t)if(a=e[t],null!==a.points){var r,s;(r=this.points).push.apply(r,we(a.points)),(s=this.data).push.apply(s,we(a.data))}this.children=null}}}]),t}(ht),_t=function e(t,n,i){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;ge(this,e),this.distance=t,this.distanceToRay=n,this.point=i,this.object=a},At=1e-6,Ct=function(e){function t(e,n){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:8;ge(this,t);var s=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return s.root=new p(e,n),s.bias=ce(0,i),s.maxPoints=ce(1,se(a)),s.maxDepth=ce(0,se(r)),s.pointCount=0,s}return fe(t,e),xe(t,[{key:\"countPoints\",value:function(e){return h(e)}},{key:\"put\",value:function(e,t){return g(e,t,this,this.root,0)}},{key:\"remove\",value:function(e){return x(e,this,this.root,null)}},{key:\"fetch\",value:function(e){return k(e,this,this.root)}},{key:\"move\",value:function(e,t){return z(e,t,this,this.root,null,0)}},{key:\"findNearestPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0,n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];return w(e,t,n,this.root)}},{key:\"findPoints\",value:function(e,t){var n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],i=[];return S(e,t,n,this.root,i),i}},{key:\"raycast\",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],i=pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"raycast\",this).call(this,e);return 0<i.length&&this.testPoints(i,e,n),n}},{key:\"testPoints\",value:function(e,t,n){var a=t.params.Points.threshold,r=void 0,s=void 0,o=void 0,l=void 0,u=void 0,y=void 0,d=void 0,c=void 0,h=void 0,m=void 0,v=void 0;for(u=0,d=e.length;u<d;++u)if(h=e[u],m=h.points,null!==m)for(y=0,c=m.length;y<c;++y)v=m[y],l=t.ray.distanceSqToPoint(v),l<a*a&&(r=t.ray.closestPointToPoint(v,new Oe),s=t.ray.origin.distanceTo(r),s>=t.near&&s<=t.far&&(o=he(l),n.push(new _t(s,o,r,h.data[y]))))}}]),t}(It),Ot=new v,Dt=new Oe,Et=new Oe,u=new Oe,Ft=function(){function e(){ge(this,e)}return xe(e,null,[{key:\"recycleOctants\",value:function(e,t){var n=e.min,a=e.getCenter(Et),r=e.getDimensions(u).multiplyScalar(.5),s=e.children,o=t.length,l=void 0,y=void 0,d=void 0,c=void 0;for(l=0;8>l;++l)for(d=mt[l],Ot.min.addVectors(n,Dt.fromArray(d).multiply(r)),Ot.max.addVectors(a,Dt.fromArray(d).multiply(r)),y=0;y<o;++y)if(c=t[y],null!==c&&Ot.min.equals(c.min)&&Ot.max.equals(c.max)){s[l]=c,t[y]=null;break}}}]),e}(),qt=new Oe,Lt=new Oe,Bt=new Oe,Vt=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Oe;ge(this,e),this.a=t,this.b=n,this.index=-1,this.coordinates=new Oe,this.t=0,this.n=new Oe}return xe(e,[{key:\"approximateZeroCrossing\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,n=ce(1,t-1),r=0,s=1,o=0,l=0,u=void 0,y=void 0;for(qt.subVectors(this.b,this.a);l<=n&&(o=(r+s)/2,Lt.addVectors(this.a,Bt.copy(qt).multiplyScalar(o)),y=e.sample(Lt),!(1e-4>=ue(y)||1e-6>=(s-r)/2));)Lt.addVectors(this.a,Bt.copy(qt).multiplyScalar(r)),u=e.sample(Lt),ie(y)===ie(u)?r=o:s=o,++l;this.t=o}},{key:\"computeZeroCrossingPosition\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe;return e.subVectors(this.b,this.a).multiplyScalar(this.t).add(this.a)}},{key:\"computeSurfaceNormal\",value:function(e){var t=this.computeZeroCrossingPosition(qt),n=1e-3,i=e.sample(Lt.addVectors(t,Bt.set(n,0,0)))-e.sample(Lt.subVectors(t,Bt.set(n,0,0))),a=e.sample(Lt.addVectors(t,Bt.set(0,n,0)))-e.sample(Lt.subVectors(t,Bt.set(0,n,0))),r=e.sample(Lt.addVectors(t,Bt.set(0,0,n)))-e.sample(Lt.subVectors(t,Bt.set(0,0,n)));this.n.set(i,a,r).normalize()}}]),e}(),Ut=new Vt,Nt=new Oe,Rt=new Oe,Mt=function(){function e(t,n,i){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:3;ge(this,e),this.edgeData=t,this.cellPosition=n,this.cellSize=i,this.indices=null,this.zeroCrossings=null,this.normals=null,this.axes=null,this.lengths=null,this.result=new dt,this.initialC=a,this.c=a,this.initialD=r,this.d=r,this.i=0,this.l=0,this.reset()}return xe(e,[{key:\"reset\",value:function(){var e=this.edgeData,t=[],n=[],i=[],r=[],s=[],o=void 0,u=void 0,y=void 0,h=void 0;for(this.i=0,this.c=0,this.d=0,(u=this.initialC,o=4>>u,y=this.initialD);u<y;++u,o>>=1)h=e.indices[u].length,0<h&&(t.push(e.indices[u]),n.push(e.zeroCrossings[u]),i.push(e.normals[u]),r.push(mt[o]),s.push(h),++this.d);return this.l=0<s.length?s[0]:0,this.indices=t,this.zeroCrossings=n,this.normals=i,this.axes=r,this.lengths=s,this.result.reset(),this}},{key:\"next\",value:function(){var e=this.cellSize,t=this.edgeData.resolution,n=t+1,a=n*n,r=this.result,s=this.cellPosition,o=void 0,l=void 0,u=void 0,d=void 0,h=void 0,m=void 0,v=void 0;return this.i===this.l&&(this.l=++this.c<this.d?this.lengths[this.c]:0,this.i=0),this.i<this.l?(m=this.c,v=this.i,o=this.axes[m],l=this.indices[m][v],Ut.index=l,u=l%n,d=ne(l%a/n),h=ne(l/a),Ut.coordinates.set(u,d,h),Nt.set(u*e/t,d*e/t,h*e/t),Rt.set((u+o[0])*e/t,(d+o[1])*e/t,(h+o[2])*e/t),Ut.a.addVectors(s,Nt),Ut.b.addVectors(s,Rt),Ut.t=this.zeroCrossings[m][v],Ut.n.fromArray(this.normals[m],3*v),r.value=Ut,++this.i):(r.value=null,r.done=!0),r}},{key:\"return\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),Yt=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:n;ge(this,e),this.resolution=t,this.indices=0>=n?null:[new Uint32Array(n),new Uint32Array(i),new Uint32Array(a)],this.zeroCrossings=0>=n?null:[new Float32Array(n),new Float32Array(i),new Float32Array(a)],this.normals=0>=n?null:[new Float32Array(3*n),new Float32Array(3*i),new Float32Array(3*a)]}return xe(e,[{key:\"serialize\",value:function(){return{resolution:this.resolution,edges:this.edges,zeroCrossings:this.zeroCrossings,normals:this.normals}}},{key:\"deserialize\",value:function(e){var t=this;return null===e?t=null:(this.resolution=e.resolution,this.edges=e.edges,this.zeroCrossings=e.zeroCrossings,this.normals=e.normals),t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=[this.edges[0],this.edges[1],this.edges[2],this.zeroCrossings[0],this.zeroCrossings[1],this.zeroCrossings[2],this.normals[0],this.normals[1],this.normals[2]],n=void 0,a=void 0,r=void 0;for(a=0,r=t.length;a<r;++a)n=t[a],null!==n&&e.push(n.buffer);return e}},{key:\"edges\",value:function(e,t){return new Mt(this,e,t)}},{key:\"edgesX\",value:function(e,t){return new Mt(this,e,t,0,1)}},{key:\"edgesY\",value:function(e,t){return new Mt(this,e,t,1,2)}},{key:\"edgesZ\",value:function(e,t){return new Mt(this,e,t,2,3)}}],[{key:\"calculate1DEdgeCount\",value:function(e){return te(e+1,2)*e}}]),e}(),Xt=0,Zt=0,jt=0,Kt=function(){function e(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];ge(this,e),this.materials=0,this.materialIndices=t?new Uint8Array(jt):null,this.runLengths=null,this.edgeData=null}return xe(e,[{key:\"set\",value:function(e){return this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,this.edgeData=e.edgeData,this}},{key:\"clear\",value:function(){return this.materials=0,this.materialIndices=null,this.runLengths=null,this.edgeData=null,this}},{key:\"setMaterialIndex\",value:function(e,t){this.materialIndices[e]===rt.AIR?t!==rt.AIR&&++this.materials:t===rt.AIR&&--this.materials,this.materialIndices[e]=t}},{key:\"compress\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this,t=void 0;return this.compressed?(e.materialIndices=this.materialIndices,e.runLengths=this.runLengths):(t=this.full?new yt([this.materialIndices.length],[rt.SOLID]):yt.encode(this.materialIndices),e.materialIndices=new Uint8Array(t.data),e.runLengths=new Uint32Array(t.runLengths)),e.materials=this.materials,e}},{key:\"decompress\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this;return e.materialIndices=this.compressed?yt.decode(this.runLengths,this.materialIndices,new Uint8Array(jt)):this.materialIndices,e.runLengths=null,e.materials=this.materials,e}},{key:\"serialize\",value:function(){return{materials:this.materials,materialIndices:this.materialIndices,runLengths:this.runLengths,edgeData:null===this.edgeData?null:this.edgeData.serialize()}}},{key:\"deserialize\",value:function(e){var t=this;return null===e?t=null:(this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,null===e.edgeData?this.edgeData=null:(null===this.edgeData&&(this.edgeData=new Yt(Zt)),this.edgeData.deserialize(e.edgeData))),t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.edgeData&&this.edgeData.createTransferList(e),null!==this.materialIndices&&e.push(this.materialIndices.buffer),null!==this.runLengths&&e.push(this.runLengths.buffer),e}},{key:\"empty\",get:function(){return 0===this.materials}},{key:\"full\",get:function(){return this.materials===jt}},{key:\"compressed\",get:function(){return null!==this.runLengths}},{key:\"neutered\",get:function(){return!this.empty&&null===this.materialIndices}}],[{key:\"isovalue\",get:function(){return Xt},set:function(e){Xt=e}},{key:\"resolution\",get:function(){return Zt},set:function(e){e=te(2,ce(0,oe(Math.log2(e)))),Zt=ce(1,de(256,e)),jt=te(Zt+1,3)}}]),e}(),Gt=function(e){function t(e){ge(this,t);var n=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Ce.DENSITY_FUNCTION));return n.sdf=e,n}return fe(t,e),xe(t,[{key:\"computeBoundingBox\",value:function(){return this.sdf.getBoundingBox(!0)}},{key:\"generateMaterialIndex\",value:function(e){return this.sdf.sample(e)<=Kt.isovalue?this.sdf.material:rt.AIR}},{key:\"generateEdge\",value:function(e){e.approximateZeroCrossing(this.sdf),e.computeSurfaceNormal(this.sdf)}}]),t}(st),Ht=new c,$t=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:rt.SOLID;ge(this,e),this.type=t,this.operation=null,this.material=de(255,ce(rt.SOLID,ne(n))),this.boundingBox=null,this.position=new Oe,this.quaternion=new Ye,this.scale=new Oe(1,1,1),this.inverseTransformation=new c,this.updateInverseTransformation(),this.children=[]}return xe(e,[{key:\"getTransformation\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new c;return e.compose(this.position,this.quaternion,this.scale)}},{key:\"getBoundingBox\",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t=this.children,n=this.boundingBox,a=void 0,r=void 0;if(null===n&&(n=this.computeBoundingBox(),this.boundingBox=n),e)for(n=n.clone(),a=0,r=t.length;a<r;++a)n.union(t[a].getBoundingBox(e));return n}},{key:\"setMaterial\",value:function(e){return this.material=de(255,ce(rt.SOLID,ne(e))),this}},{key:\"setOperationType\",value:function(e){return this.operation=e,this}},{key:\"updateInverseTransformation\",value:function(){return this.inverseTransformation.getInverse(this.getTransformation(Ht)),this.boundingBox=null,this}},{key:\"union\",value:function(e){return this.children.push(e.setOperationType(Ce.UNION)),this}},{key:\"subtract\",value:function(e){return this.children.push(e.setOperationType(Ce.DIFFERENCE)),this}},{key:\"intersect\",value:function(e){return this.children.push(e.setOperationType(Ce.INTERSECTION)),this}},{key:\"toCSG\",value:function(){var e=this.children,t=new Gt(this),n=void 0,a=void 0,r=void 0,s=void 0;for(r=0,s=e.length;r<s;++r)a=e[r],n!==a.operation&&(n=a.operation,n===Ce.UNION?t=new ot(t):n===Ce.DIFFERENCE?t=new lt(t):n===Ce.INTERSECTION?t=new ut(t):void 0),t.children.push(a.toCSG());return t}},{key:\"serialize\",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t={type:this.type,operation:this.operation,material:this.material,position:this.position.toArray(),quaternion:this.quaternion.toArray(),scale:this.scale.toArray(),parameters:null,children:[]},n=void 0,a=void 0;for(n=0,a=this.children.length;n<a;++n)t.children.push(this.children[n].serialize(e));return t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e}},{key:\"toJSON\",value:function(){return this.serialize(!0)}},{key:\"computeBoundingBox\",value:function(){throw new Error(\"SignedDistanceFunction#computeBoundingBox method not implemented!\")}},{key:\"sample\",value:function(){throw new Error(\"SignedDistanceFunction#sample method not implemented!\")}}]),e}(),Wt={HEIGHTFIELD:\"sdf.heightfield\",FRACTAL_NOISE:\"sdf.fractalnoise\",SUPER_PRIMITIVE:\"sdf.superprimitive\"},Qt=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];ge(this,t);var i=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Wt.PERLIN_NOISE,n));return i.min=new(Function.prototype.bind.apply(Oe,[null].concat(we(e.min)))),i.max=new(Function.prototype.bind.apply(Oe,[null].concat(we(e.max)))),i}return fe(t,e),xe(t,[{key:\"computeBoundingBox\",value:function(){return this.bbox=new v(this.min,this.max),this.bbox}},{key:\"sample\",value:function(){}},{key:\"serialize\",value:function(){var e=pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"serialize\",this).call(this);return e.parameters={min:this.min.toArray(),max:this.max.toArray()},e}}]),t}($t),Jt=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];ge(this,t);var i=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Wt.HEIGHTFIELD,n));return i.width=void 0===e.width?1:e.width,i.height=void 0===e.height?1:e.height,i.smooth=void 0===e.smooth||e.smooth,i.data=void 0===e.data?null:e.data,i.heightmap=null,void 0!==e.image&&i.fromImage(e.image),i}return fe(t,e),xe(t,[{key:\"fromImage\",value:function(e){var t=\"undefined\"==typeof document?null:P(e),n=null,a=void 0,r=void 0,s=void 0,o=void 0;if(null!==t){for(a=t.data,n=new Uint8ClampedArray(a.length/4),(r=0,s=0,o=n.length);r<o;++r,s+=4)n[r]=a[s];this.heightmap=e,this.width=t.width,this.height=t.height,this.data=n}return this}},{key:\"getHeight\",value:function(e,t){var n=this.width,i=this.height,r=this.data,s=void 0;if(e=se(e*n),t=se(t*i),this.smooth){e=ce(de(e,n-1),1),t=ce(de(t,i-1),1);var o=e+1,l=e-1,u=t*n,a=u+n,y=u-n;s=(r[y+l]+r[y+e]+r[y+o]+r[u+l]+r[u+e]+r[u+o]+r[a+l]+r[a+e]+r[a+o])/9}else s=r[t*n+e];return s}},{key:\"computeBoundingBox\",value:function(){var e=new v,t=de(this.width/this.height,1),n=de(this.height/this.width,1);return e.min.set(0,0,0),e.max.set(t,1,n),e.applyMatrix4(this.getTransformation()),e}},{key:\"sample\",value:function(e){var t=this.boundingBox,n=void 0;return t.containsPoint(e)?(e.applyMatrix4(this.inverseTransformation),n=e.y-this.getHeight(e.x,e.z)/255):n=t.distanceToPoint(e),n}},{key:\"serialize\",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],n=pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"serialize\",this).call(this);return n.parameters={width:this.width,height:this.height,smooth:this.smooth,data:e?null:this.data,dataURL:e&&null!==this.heightmap?this.heightmap.toDataURL():null,image:null},n}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.data.buffer),e}}]),t}($t),en=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];ge(this,t);var i=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Wt.SUPER_PRIMITIVE,n));return i.s0=new(Function.prototype.bind.apply(at,[null].concat(we(e.s)))),i.r0=new(Function.prototype.bind.apply(Oe,[null].concat(we(e.r)))),i.s=new at,i.r=new Oe,i.ba=new Le,i.offset=0,i.precompute(),i}return fe(t,e),xe(t,[{key:\"setSize\",value:function(e,t,n,i){return this.s0.set(e,t,n,i),this.precompute()}},{key:\"setRadii\",value:function(e,t,n){return this.r0.set(e,t,n),this.precompute()}},{key:\"precompute\",value:function(){var e=this.s.copy(this.s0),t=this.r.copy(this.r0),n=this.ba;e.x-=t.x,e.y-=t.x,t.x-=e.w,e.w-=t.y,e.z-=t.y,this.offset=-2*e.z,n.set(t.z,this.offset);var i=n.dot(n);return 0===i?n.set(0,-1):n.divideScalar(i),this}},{key:\"computeBoundingBox\",value:function(){var e=this.s0,t=new v;return t.min.x=de(-e.x,-1),t.min.y=de(-e.y,-1),t.min.z=de(-e.z,-1),t.max.x=ce(e.x,1),t.max.y=ce(e.y,1),t.max.z=ce(e.z,1),t.applyMatrix4(this.getTransformation()),t}},{key:\"sample\",value:function(e){e.applyMatrix4(this.inverseTransformation);var t=this.s,n=this.r,i=this.ba,a=ue(e.x)-t.x,r=ue(e.y)-t.y,s=ue(e.z)-t.z,o=ce(a,0),l=ce(r,0),u=he(o*o+l*l),y=e.z-t.z,d=ue(u+de(0,ce(a,r))-n.x)-t.w,h=de(ce(d*i.x+y*i.y,0),1),c=d-n.z*h,m=y-this.offset*h,v=ce(d-n.z,0),g=e.z+t.z,x=ce(d,0),p=d*-i.y+y*i.x,f=he(de(c*c+m*m,de(v*v+g*g,x*x+y*y)));return f*ie(ce(p,s))-n.y}},{key:\"serialize\",value:function(){var e=pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"serialize\",this).call(this);return e.parameters={s:this.s0.toArray(),r:this.r0.toArray()},e}}],[{key:\"create\",value:function(e){var n=tn[e];return new t({s:n[0],r:n[1]})}}]),t}($t),tn=[[new Float32Array([1,1,1,1]),new Float32Array([0,0,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,0,0])],[new Float32Array([0,0,1,1]),new Float32Array([0,0,1])],[new Float32Array([1,1,2,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,.25,1]),new Float32Array([1,.25,0])],[new Float32Array([1,1,.25,.25]),new Float32Array([1,.25,0])],[new Float32Array([1,1,1,.25]),new Float32Array([1,.1,0])],[new Float32Array([1,1,1,.25]),new Float32Array([.1,.1,0])]],nn={CUBE:0,CYLINDER:1,CONE:2,PILL:3,SPHERE:4,PELLET:5,TORUS:6,PIPE:7,CORRIDOR:8},an=function(){function e(){ge(this,e)}return xe(e,[{key:\"revive\",value:function(e){var t,n,a;switch(e.type){case Wt.FRACTAL_NOISE:t=new Qt(e.parameters,e.material);break;case Wt.HEIGHTFIELD:t=new Jt(e.parameters,e.material);break;case Wt.SUPER_PRIMITIVE:t=new en(e.parameters,e.material);}for(t.operation=e.operation,t.position.fromArray(e.position),t.quaternion.fromArray(e.quaternion),t.scale.fromArray(e.scale),t.updateInverseTransformation(),(n=0,a=e.children.length);n<a;++n)t.children.push(this.revive(e.children[n]));return t}}]),e}(),rn=function(e){function t(e){ge(this,t);var n=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.descriptions=null,n}return fe(t,e),t}(_e),sn=new rn(\"load\"),on=function(e){function t(){ge(this,t);var e=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.items=0,e.descriptions=null,e.imageMap=new WeakMap,e}return fe(t,e),xe(t,[{key:\"clear\",value:function(){this.imageMap=new WeakMap}},{key:\"handleEvent\",value:function(e){switch(e.type){case\"load\":this.progress(e);}}},{key:\"progress\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=null===e?null:e.target,n=this.imageMap,i=void 0;null!==t&&(n.has(t)&&(i=n.get(t),i.image=t),--this.items),0===this.items&&(this.clear(),sn.descriptions=this.descriptions,this.dispatchEvent(sn))}},{key:\"loadImage\",value:function(e){var t=new Image;this.imageMap.set(t,e),++this.items,t.addEventListener(\"load\",this),t.src=e.dataURL}},{key:\"inflate\",value:function(e){var t;null!==e.dataURL&&this.loadImage(e);var n=!0,i=!1,a=void 0;try{for(var r=e.children[Symbol.iterator](),s;!(n=(s=r.next()).done);n=!0)t=s.value,this.inflate(t)}catch(e){i=!0,a=e}finally{try{!n&&r.return&&r.return()}finally{if(i)throw a}}this.progress()}},{key:\"load\",value:function(e){var t;this.items=0,this.descriptions=e;var n=!0,i=!1,a=void 0;try{for(var r=e[Symbol.iterator](),s;!(n=(s=r.next()).done);n=!0)t=s.value,this.inflate(t)}catch(e){i=!0,a=e}finally{try{!n&&r.return&&r.return()}finally{if(i)throw a}}}}]),t}(Ae),ln=function(){function e(){ge(this,e)}return xe(e,null,[{key:\"parseBin\",value:function(e){return parseInt(e,2)}},{key:\"createBinaryString\",value:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:64,n=0>e?\"-\":\"\",i=ue(e).toString(2);i.length<t;)i=\"0\"+i;return n+i}}]),e}(),un=function(){function e(t,n,i){ge(this,e),this.keyDesign=t,this.min=n,this.max=i,this.keyBase=new Oe,this.key=new Oe,this.limit=new Oe,this.result=new dt,this.reset()}return xe(e,[{key:\"reset\",value:function(){var e=this.keyDesign,t=this.min,n=this.max;return t.x<=n.x&&t.y<=n.y&&t.z<=n.z?(this.keyBase.set(t.x,t.y*e.rangeX,t.z*e.rangeXY),this.limit.set(n.x,n.y*e.rangeX,n.z*e.rangeXY),this.key.copy(this.keyBase)):(this.keyBase.set(1,1,1),this.limit.set(0,0,0),this.key.copy(this.keyBase),console.error(\"Invalid key range\",t,n)),this.result.reset(),this}},{key:\"next\",value:function(){var e=this.result,t=this.keyDesign,n=this.keyBase,i=this.limit,a=this.key;return a.z<=i.z?(e.value=a.z+a.y+a.x,++a.x,a.x>i.x&&(a.x=n.x,a.y+=t.rangeX,a.y>i.y&&(a.y=n.y,a.z+=t.rangeXY))):(e.value=null,e.done=!0),e}},{key:\"return\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),yn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:21,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:11,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t;ge(this,e),this.x=0,this.y=0,this.z=0,this.rangeX=0,this.rangeY=0,this.rangeZ=0,this.rangeXY=0,this.halfRange=null,this.maskX=[0,0],this.maskY=[0,0],this.maskZ=[0,0],this.set(t,n,i)}return xe(e,[{key:\"set\",value:function(e,t,n){(53<e+t+n||32<e||32<t||32<n)&&(console.warn(\"Invalid bit allotment\"),e=21,t=11,n=e),this.x=e,this.y=t,this.z=n,this.rangeX=te(2,e),this.rangeY=te(2,t),this.rangeZ=te(2,n),this.rangeXY=te(2,e+t),this.halfRange=new Oe(this.rangeX/2,this.rangeY/2,this.rangeZ/2),this.updateBitMasks()}},{key:\"updateBitMasks\",value:function(){var e=this.x,t=this.y,n=this.z,i=this.maskX,a=this.maskY,r=this.maskZ,s=32-ce(0,e-32),o=32-ce(0,t+e-32),l=32-ce(0,n+t+e-32);i[1]=32>s?-1>>>s:0,i[0]=-1>>>ce(0,32-e),a[1]=((32>o?-1>>>o:0)&~i[1])>>>0,a[0]=(-1>>>ce(0,32-(e+t))&~i[0])>>>0,r[1]=((32>l?-1>>>l:0)&~a[1]&~i[1])>>>0,r[0]=(-1>>>ce(0,32-(e+t+n))&~a[0]&~i[0])>>>0}},{key:\"unpackKey\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Oe,n=this.maskX,i=this.maskY,a=this.maskZ,r=ne(e/4294967296),s=e%4294967296;return t.set(4294967296*(r&n[1])+((s&n[0])>>>0),(4294967296*(r&i[1])+((s&i[0])>>>0))/this.rangeX,(4294967296*(r&a[1])+((s&a[0])>>>0))/this.rangeXY)}},{key:\"packKey\",value:function(e){return e.z*this.rangeXY+e.y*this.rangeX+e.x}},{key:\"keyRange\",value:function(e,t){return new un(this,e,t)}},{key:\"toString\",value:function(){var e=this.maskX,t=this.maskY,n=this.maskZ;return\"Key Design\\n\\nX-Bits: \"+this.x+\"\\nY-Bits: \"+this.y+\"\\nZ-Bits: \"+this.z+\"\\n\\n\"+ln.createBinaryString(e[1],32)+\" \"+e[1]+\" (HI-Mask X)\\n\"+ln.createBinaryString(e[0],32)+\" \"+e[0]+\" (LO-Mask X)\\n\\n\"+ln.createBinaryString(t[1],32)+\" \"+t[1]+\" (HI-Mask Y)\\n\"+ln.createBinaryString(t[0],32)+\" \"+t[0]+\" (LO-Mask Y)\\n\\n\"+ln.createBinaryString(n[1],32)+\" \"+n[1]+\" (HI-Mask Z)\\n\"+ln.createBinaryString(n[0],32)+\" \"+n[0]+\" (LO-Mask Z)\\n\"}}],[{key:\"BITS\",get:function(){return 53}},{key:\"HI_BITS\",get:function(){return 21}},{key:\"LO_BITS\",get:function(){return 32}}]),e}(),dn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;ge(this,e),this.lod=t,this.key=n}return xe(e,[{key:\"set\",value:function(e,t){this.lod=e,this.key=t}},{key:\"copy\",value:function(e){return this.lod=e.lod,this.key=e.key,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}}]),e}(),cn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new dn;ge(this,e),this.octant=t,this.id=n,this.min=new Oe,this.max=new Oe}return xe(e,[{key:\"copy\",value:function(e){return this.octant=e.octant,this.id.copy(e.id),this.min.copy(e.min),this.max.copy(e.max),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe;return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getDimensions\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Oe;return e.subVectors(this.max,this.min)}},{key:\"containsPoint\",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=n.x&&e.y<=n.y&&e.z<=n.z}}]),e}(),hn=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;ge(this,e),this.world=t,this.cellSize=0,this.iterator=null,this.octantWrapper=new cn,this.octantWrapper.id.lod=n,this.result=new dt,this.reset()}return xe(e,[{key:\"reset\",value:function(){var e=this.octantWrapper.id.lod,t=this.world,n=t.getGrid(e);return void 0===n?console.error(\"Invalid LOD\",e):(this.cellSize=t.getCellSize(e),this.iterator=n.entries(),this.result.reset()),this}},{key:\"next\",value:function(){var e=this.result,t=this.octantWrapper,n=this.iterator.next(),i=n.value;return n.done?(e.value=null,e.done=!0):(this.keyDesign.unpackKey(i[0],t.min),t.min.multiplyScalar(this.cellSize).add(this.world.min),t.max.copy(t.min).addScalar(this.cellSize),t.id.key=i[0],t.octant=i[1],e.value=t),e}},{key:\"return\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),mn=function e(){ge(this,e),this.data=null,this.csg=new Te,this.isosurface=null},vn=function(e){function t(){ge(this,t);var e=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.children=0,e}return fe(t,e),t}(mn),gn=new Oe,xn=new Oe,pn=new v,fn=new v,kn=new v,zn=[],wn=function(){function e(){ge(this,e)}return xe(e,null,[{key:\"applyUnion\",value:function(e,t,n){var r=e.getKeyDesign(),s=e.lodZero,o=fn.min,a=fn.max,l=kn.min,u=kn.max,y=void 0,d=void 0,c=void 0,h=void 0,m=void 0,v=void 0;for(m=e.getDepth();0<m;--m){c=e.getGrid(m),e.calculateKeyCoordinates(t.min,m,o),e.calculateKeyCoordinates(t.max,m,a),e.calculateKeyCoordinates(t.min,m-1,l),e.calculateKeyCoordinates(t.max,m-1,u);var g=!0,x=!1,p=void 0;try{for(var f=r.keyRange(o,a)[Symbol.iterator](),k;!(g=(k=f.next()).done);g=!0)if(y=k.value,!c.has(y))for(h=new vn,h.csg.add(n),c.set(y,h),r.unpackKey(y,xn),xn.x<<=1,xn.y<<=1,xn.z<<=1,v=0;8>v;++v)d=mt[v],gn.set(xn.x+d[0],xn.y+d[1],xn.z+d[2]),kn.containsPoint(gn)&&(h.children|=1<<v)}catch(e){x=!0,p=e}finally{try{!g&&f.return&&f.return()}finally{if(x)throw p}}}e.calculateKeyCoordinates(t.min,0,o),e.calculateKeyCoordinates(t.max,0,a);var z=!0,w=!1,S=void 0;try{for(var P=r.keyRange(o,a)[Symbol.iterator](),b;!(z=(b=P.next()).done);z=!0)y=b.value,s.has(y)?h=s.get(y):(h=new mn,s.set(y,h)),h.csg.add(n)}catch(e){w=!0,S=e}finally{try{!z&&P.return&&P.return()}finally{if(w)throw S}}}},{key:\"applyDifference\",value:function(e,t,n){var r=e.getDepth(),s=e.getKeyDesign(),o=e.getGrid(r),u=e.calculateKeyCoordinates(t.min,r,fn.min),a=e.calculateKeyCoordinates(t.max,r,fn.max),y=void 0,d=void 0,c=void 0,h=void 0;for(y=0,d=r-1;y<d;++y)y<zn.length?(c=zn[y],e.calculateKeyCoordinates(t.min,y,c.min),e.calculateKeyCoordinates(t.max,y,c.max)):zn.push(new v(e.calculateKeyCoordinates(t.min,y),e.calculateKeyCoordinates(t.max,y)));var m=!0,g=!1,x=void 0;try{for(var p=s.keyRange(u,a)[Symbol.iterator](),f;!(m=(f=p.next()).done);m=!0)h=f.value,o.has(h)&&(s.unpackKey(h,xn),I(e,n,o.get(h),xn.x,xn.y,xn.z,r))}catch(e){g=!0,x=e}finally{try{!m&&p.return&&p.return()}finally{if(g)throw x}}}},{key:\"applyIntersection\",value:function(e,t){var n,i;for(n=e.getDepth();0<=n;--n){var a=!0,r=!1,s=void 0;try{for(var o=e.getGrid(n).values()[Symbol.iterator](),l;!(a=(l=o.next()).done);a=!0)i=l.value,i.csg.add(t)}catch(e){r=!0,s=e}finally{try{!a&&o.return&&o.return()}finally{if(r)throw s}}}}},{key:\"applyCSG\",value:function(e,t){var n=pn.copy(t.getBoundingBox(!0));switch(n.min.max(e.min),n.max.min(e.max),t.operation){case Ce.UNION:this.applyUnion(e,n,t);break;case Ce.DIFFERENCE:this.applyDifference(e,n,t);break;case Ce.INTERSECTION:this.applyIntersection(e,t);break;default:console.error(\"No CSG operation type specified\",t);}}}]),e}(),Sn=new Oe,Pn=new $e,l=new v,bn=new v,d=new tt,In=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],Tn=0,_n=function(){function e(){ge(this,e)}return xe(e,null,[{key:\"intersectWorldOctree\",value:function(e,i){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],s=e.getDepth(),o=e.getGrid(s),l=e.getCellSize(s),u=e.getKeyDesign(),y=new cn,c=Pn.start,h=Pn.end,m=e.containsPoint(d.copy(i).origin)?d.origin:d.intersectBox(e,d.origin),a=void 0,v=void 0,g=void 0,x=void 0,p=void 0,f=void 0,k=void 0,z=void 0,w=void 0,S=void 0,P=void 0,I=void 0,T=void 0,_=void 0,A=void 0,O=void 0,D=void 0,E=void 0,F=void 0,q=void 0;if(y.id.lod=s,null!==m)for(g=l<<1,x=d.at(g,Sn),e.calculateKeyCoordinates(m,s,c),e.calculateKeyCoordinates(x,s,h),f=h.x-c.x,k=h.y-c.y,z=h.z-c.z,A=ie(f),O=ie(k),D=ie(z),w=ue(f),S=ue(k),P=ue(z),I=2*w,T=2*S,_=2*P,E=S-w,F=P-w,q=S-P,p=w+S+P;0<p;--p)a=u.packKey(c),o.has(a)&&(v=o.get(a),y.id.key=a,y.octant=v,y.min.copy(c),y.min.multiplyScalar(l),y.min.add(e.min),y.max.copy(y.min).addScalar(l),null===v.isosurface?C(e,y,c,i,r):r.push(y.clone())),0>E?0>F?(c.x+=A,E+=T,F+=_):(c.z+=D,F-=I,q+=T):0>q?(c.z+=D,F-=I,q+=T):(c.y+=O,E-=I,q-=_);return r}}]),e}(),An=new Oe,Cn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:20,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new yn;for(ge(this,e),n=ce(de(ne(n),32),1),this.cellSize=ce(de(ne(t),te(2,33-n)-1),1),this.keyDesign=i,this.grids=[];this.grids.length<n;)this.grids.push(new Map);this.bounds=new cn,this.bounds.min.copy(this.keyDesign.halfRange).multiplyScalar(-this.cellSize),this.bounds.max.copy(this.keyDesign.halfRange).multiplyScalar(this.cellSize)}return xe(e,[{key:\"getKeyDesign\",value:function(){return this.keyDesign}},{key:\"getCellSize\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return this.cellSize<<e>>>0}},{key:\"getCenter\",value:function(e){return this.bounds.getCenter(e)}},{key:\"setCenter\",value:function(e){this.min.copy(this.keyDesign.halfRange).multiplyScalar(-this.cellSize).add(e),this.max.copy(this.keyDesign.halfRange).multiplyScalar(this.cellSize).add(e)}},{key:\"getDimensions\",value:function(e){return this.bounds.getDimensions(e)}},{key:\"getDepth\",value:function(){return this.grids.length-1}},{key:\"getGrid\",value:function(e){return 0<=e&&e<this.grids.length?this.grids[e]:void 0}},{key:\"clear\",value:function(){var e,t;for(e=0,t=this.grids.length;e<t;++e)this.grids[e].clear()}},{key:\"containsPoint\",value:function(e){return this.bounds.containsPoint(e)}},{key:\"findOctantsByLevel\",value:function(e){return this.octants(e)}},{key:\"calculateKeyCoordinates\",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Oe,i=this.cellSize<<t;return An.subVectors(e,this.min),n.set(ne(An.x/i),ne(An.y/i),ne(An.z/i)),n}},{key:\"getOctantByPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.keyDesign,i=this.getGrid(t),a=void 0;return void 0===i?console.error(\"Invalid LOD\",t):this.containsPoint(e)?(this.calculateKeyCoordinates(e,t,An),a=i.get(n.packKey(An))):console.error(\"Position out of range\",e),a}},{key:\"removeOctant\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.keyDesign,i=this.getGrid(t),a=void 0,r=void 0,s=void 0;void 0===i?console.error(\"Invalid LOD\",t):i.has(e)?(n.unpackKey(e,An),a=An.x,r=An.y,s=An.z,O(this,i.get(e),a,r,s,t),i.delete(e),D(this,a,r,s,t)):console.error(\"No octant found\",e)}},{key:\"applyCSG\",value:function(e){wn.applyCSG(this,e)}},{key:\"raycast\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return _n.intersectWorldOctree(this,e,t)}},{key:\"octants\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return new hn(this,e)}},{key:\"min\",get:function(){return this.bounds.min}},{key:\"max\",get:function(){return this.bounds.max}},{key:\"levels\",get:function(){return this.grids.length}},{key:\"lodZero\",get:function(){return this.grids[0]}}],[{key:\"calculateOffsetIndex\",value:function(e,t,n){return((1&e)<<2)+((1&t)<<1)+(1&n)}}]),e}(),On=function(){function e(){ge(this,e)}return xe(e,[{key:\"clone\",value:function(){return new this.constructor(this.levels)}},{key:\"levels\",get:function(){return this.something.length}}]),e}(),Dn=function(e){function t(e){ge(this,t);var n=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.lod=-1,n.left=null,n.entered=null,n.error=null,n}return fe(t,e),t}(_e),En=new Dn(\"update\"),Fn=new Dn(\"error\"),qn=new v,Ln=new Ke,f=new c,Bn=function(e){function t(e){ge(this,t);var n=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.world=e,n.position=new Oe(1/0,1/0,1/0),n.currentScene=new On(n.world.levels),n.previousScene=n.currentScene.clone(),n.nextScene=n.currentScene.clone(),n}return fe(t,e),xe(t,[{key:\"update\",value:function(e){var t=this.position;t.copy(e.position),Ln.setFromMatrix(f.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse))}},{key:\"process\",value:function(){}},{key:\"clear\",value:function(){this.previousScene.clear(),this.currentScene.clear(),this.nextScene.clear()}}]),t}(Ae),Vn={EXTRACT:\"worker.extract\",MODIFY:\"worker.modify\",CONFIGURE:\"worker.config\",CLOSE:\"worker.close\"},Un=function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;ge(this,e),this.action=t,this.error=null},Nn=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;ge(this,t);var n=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.data=null,n}return fe(t,e),t}(Un),Rn=function(e){function t(){return ge(this,t),ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Vn.EXTRACT))}return fe(t,e),t}(Nn),Mn=function(e){function t(){ge(this,t);var e=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Vn.MODIFY));return e.sdf=null,e.cellSize=0,e.cellPosition=null,e}return fe(t,e),t}(Nn),Yn=function(e){function t(){ge(this,t);var e=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Vn.CONFIGURE));return e.resolution=Kt.resolution,e.errorThreshold=.01,e}return fe(t,e),t}(Un),Xn=function(e){function t(){ge(this,t);var e=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Vn.EXTRACT));return e.isosurface=null,e}return fe(t,e),t}(Nn),Zn=function(e){function t(){ge(this,t);var e=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Vn.MODIFY));return e.sdf=null,e}return fe(t,e),t}(Nn),jn=function(e){function t(e){ge(this,t);var n=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.worker=null,n.response=null,n}return fe(t,e),t}(_e),Kn=new jn(\"message\"),Gn=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:navigator.hardwareConcurrency;ge(this,t);var n=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.workerURL=URL.createObjectURL(new Blob([\"(function(){\\\"use strict\\\";function e(e,t,n){return ne(te(e,n),t)}function t(e,t,n,a,i,l){var o=0;return e>t&&e>n?(i<e&&(o|=2),l<e&&(o|=1)):t>n?(a<t&&(o|=4),l<t&&(o|=1)):(a<n&&(o|=4),i<n&&(o|=2)),o}function n(e,t,n,a){var i=void 0,l=0;return t<n?(i=t,l=0):(i=n,l=1),a<i&&(l=2),r[e][l]}function i(e,a,l,o,r,s,y,d,u){var c=e.children,m=void 0,x=void 0,p=void 0,v=void 0;if(0<=r&&0<=s&&0<=y)if(null===c)u.push(e);else{x=.5*(a+r),p=.5*(l+s),v=.5*(o+y),m=t(a,l,o,x,p,v);do 0===m?(i(c[et],a,l,o,x,p,v,d,u),m=n(m,x,p,v)):1===m?(i(c[1^et],a,l,v,x,p,y,d,u),m=n(m,x,p,y)):2===m?(i(c[2^et],a,p,o,x,s,v,d,u),m=n(m,x,s,v)):3===m?(i(c[3^et],a,p,v,x,s,y,d,u),m=n(m,x,s,y)):4===m?(i(c[4^et],x,l,o,r,p,v,d,u),m=n(m,r,p,v)):5===m?(i(c[5^et],x,l,v,r,p,y,d,u),m=n(m,r,p,y)):6===m?(i(c[6^et],x,p,o,r,s,v,d,u),m=n(m,r,s,v)):7===m?(i(c[7^et],x,p,v,r,s,y,d,u),m=8):void 0;while(8>m)}}function o(e){var t=e.children,n=0,a=void 0,r=void 0,s=void 0;if(null!==t)for(a=0,r=t.length;a<r;++a)s=1+o(t[a]),s>n&&(n=s);return n}function s(e,t,n){var a=e.children,o=void 0,r=void 0;if(nt.min=e.min,nt.max=e.max,t.intersectsBox(nt))if(null!==a)for(o=0,r=a.length;o<r;++o)s(a[o],t,n);else n.push(e)}function y(e,t,n,a){var o=e.children,r=void 0,s=void 0;if(n===t)a.push(e);else if(null!==o)for(++n,r=0,s=o.length;r<s;++r)y(o[r],t,n,a)}function d(e){var t=e.children,n=0,a=void 0,o=void 0;if(null!==t)for(a=0,o=t.length;a<o;++a)n+=d(t[a]);else null!==e.points&&(n=e.points.length);return n}function x(e,t,n,a,o){var r=a.children,s=!1,y=!1,d=void 0,u=void 0;if(a.contains(e,n.bias)){if(null===r){if(null===a.points)a.points=[],a.data=[];else for(d=0,u=a.points.length;!s&&d<u;++d)s=a.points[d].equals(e);s?(a.data[d-1]=t,y=!0):a.points.length<n.maxPoints||o===n.maxDepth?(a.points.push(e.clone()),a.data.push(t),++n.pointCount,y=!0):(a.split(),a.redistribute(n.bias),r=a.children)}if(null!==r)for(++o,d=0,u=r.length;!y&&d<u;++d)y=x(e,t,n,r[d],o)}return y}function g(e,t,n,a){var o=n.children,r=null,s=void 0,y=void 0,u=void 0,c=void 0,m=void 0;if(n.contains(e,t.bias))if(null!==o)for(s=0,y=o.length;null===r&&s<y;++s)r=g(e,t,o[s],n);else if(null!==n.points)for(u=n.points,c=n.data,(s=0,y=u.length);s<y;++s)if(u[s].equals(e)){m=y-1,r=c[s],s<m&&(u[s]=u[m],c[s]=c[m]),u.pop(),c.pop(),--t.pointCount,null!==a&&d(a)<=t.maxPoints&&a.merge();break}return r}function k(e,t,n){var a=n.children,o=null,r=void 0,s=void 0,y=void 0;if(n.contains(e,t.bias))if(null!==a)for(r=0,s=a.length;null===o&&r<s;++r)o=k(e,t,a[r]);else if(null!==n.points)for(y=n.points,r=0,s=y.length;null===o&&r<s;++r)e.distanceToSquared(y[r])<=ot&&(o=n.data[r]);return o}function h(e,t,n,a,o,r){var s=a.children,y=null,d=void 0,u=void 0,c=void 0;if(a.contains(e,n.bias))if(!a.contains(t,n.bias))y=g(e,n,a,o),x(t,y,n,o,r-1);else if(null!==s)for(++r,d=0,u=s.length;null===y&&d<u;++d)y=h(e,t,n,s[d],a,r);else if(null!==a.points)for(c=a.points,d=0,u=c.length;d<u;++d)if(e.distanceToSquared(c[d])<=ot){c[d].copy(t),y=a.data[d];break}return y}function z(e,t,n,a){var o=a.points,r=a.children,s=null,y=t,d=void 0,u=void 0,c=void 0,m=void 0,x=void 0,v=void 0,g=void 0;if(null!==r)for(x=r.map(function(t){return{octant:t,distance:t.distanceToCenterSquared(e)}}).sort(function(e,t){return e.distance-t.distance}),d=0,u=x.length;d<u;++d)v=x[d].octant,v.contains(e,y)&&(g=z(e,y,n,v),null!==g&&(m=g.point.distanceToSquared(e),(!n||0<m)&&m<y&&(y=m,s=g)));else if(null!==o)for(d=0,u=o.length;d<u;++d)c=o[d],m=e.distanceToSquared(c),(!n||0<m)&&m<y&&(y=m,s={point:c.clone(),data:a.data[d]});return s}function f(e,t,n,a,o){var r=a.points,s=a.children,y=void 0,d=void 0,u=void 0,c=void 0,m=void 0;if(null!==s)for(y=0,d=s.length;y<d;++y)m=s[y],m.contains(e,t)&&f(e,t,n,m,o);else if(null!==r)for(y=0,d=r.length;y<d;++y)u=r[y],c=e.distanceToSquared(u),(!n||0<c)&&c<=t*t&&o.push({point:u.clone(),data:a.data[y]})}function l(e,t){var n=e.elements,a=t.elements,i=void 0;0!==n[1]&&(i=Ct.calculateCoefficients(n[0],n[1],n[3]),bt.rotateQXY(qt.set(n[0],n[3]),n[1],i),n[0]=qt.x,n[3]=qt.y,bt.rotateXY(qt.set(n[2],n[4]),i),n[2]=qt.x,n[4]=qt.y,n[1]=0,bt.rotateXY(qt.set(a[0],a[3]),i),a[0]=qt.x,a[3]=qt.y,bt.rotateXY(qt.set(a[1],a[4]),i),a[1]=qt.x,a[4]=qt.y,bt.rotateXY(qt.set(a[2],a[5]),i),a[2]=qt.x,a[5]=qt.y)}function S(e,t){var n=e.elements,a=t.elements,i=void 0;0!==n[2]&&(i=Ct.calculateCoefficients(n[0],n[2],n[5]),bt.rotateQXY(qt.set(n[0],n[5]),n[2],i),n[0]=qt.x,n[5]=qt.y,bt.rotateXY(qt.set(n[1],n[4]),i),n[1]=qt.x,n[4]=qt.y,n[2]=0,bt.rotateXY(qt.set(a[0],a[6]),i),a[0]=qt.x,a[6]=qt.y,bt.rotateXY(qt.set(a[1],a[7]),i),a[1]=qt.x,a[7]=qt.y,bt.rotateXY(qt.set(a[2],a[8]),i),a[2]=qt.x,a[8]=qt.y)}function T(e,t){var n=e.elements,a=t.elements,i=void 0;0!==n[4]&&(i=Ct.calculateCoefficients(n[3],n[4],n[5]),bt.rotateQXY(qt.set(n[3],n[5]),n[4],i),n[3]=qt.x,n[5]=qt.y,bt.rotateXY(qt.set(n[1],n[2]),i),n[1]=qt.x,n[2]=qt.y,n[4]=0,bt.rotateXY(qt.set(a[3],a[6]),i),a[3]=qt.x,a[6]=qt.y,bt.rotateXY(qt.set(a[4],a[7]),i),a[4]=qt.x,a[7]=qt.y,bt.rotateXY(qt.set(a[5],a[8]),i),a[5]=qt.x,a[8]=qt.y)}function w(t,n){var a=t.elements,e=void 0;for(e=0;e<5;++e)l(t,n),S(t,n),T(t,n);return At.set(a[0],a[3],a[5])}function P(e){var t=$(e)<Et?0:1/e;return $(t)<Et?0:t}function I(e,t){var n=e.elements,a=n[0],i=n[3],l=n[6],o=n[1],r=n[4],s=n[7],y=n[2],d=n[5],u=n[8],c=P(t.x),m=P(t.y),x=P(t.z);return e.set(a*c*a+i*m*i+l*x*l,a*c*o+i*m*r+l*x*s,a*c*y+i*m*d+l*x*u,o*c*a+r*m*i+s*x*l,o*c*o+r*m*r+s*x*s,o*c*y+r*m*d+s*x*u,y*c*a+d*m*i+u*x*l,y*c*o+d*m*r+u*x*s,y*c*y+d*m*d+u*x*u)}function _(e,t,n){return e.applyToVector3(Ft.copy(n)),Ft.subVectors(t,Ft),Ft.dot(Ft)}function C(e,t,n){var a=[-1,-1,-1,-1],l=[!1,!1,!1,!1],o=1/0,r=0,s=!1,y=void 0,d=void 0,u=void 0,c=void 0,m=void 0,x=void 0,p=void 0;for(p=0;4>p;++p)m=e[p],x=Jt[t][p],y=Ue[x][0],d=Ue[x][1],u=1&m.voxel.materials>>y,c=1&m.voxel.materials>>d,m.size<o&&(o=m.size,r=p,s=u!==ft.AIR),a[p]=m.voxel.index,l[p]=u!=c;l[r]&&(s?(n.push(a[0]),n.push(a[3]),n.push(a[1]),n.push(a[0]),n.push(a[2]),n.push(a[3])):(n.push(a[0]),n.push(a[1]),n.push(a[3]),n.push(a[0]),n.push(a[3]),n.push(a[2])))}function E(e,t,n){var a=[0,0,0,0],l=void 0,o=void 0,r=void 0,s=void 0;if(null!==e[0].voxel&&null!==e[1].voxel&&null!==e[2].voxel&&null!==e[3].voxel)C(e,t,n);else for(r=0;2>r;++r){for(a[0]=Ht[t][r][0],a[1]=Ht[t][r][1],a[2]=Ht[t][r][2],a[3]=Ht[t][r][3],l=[],s=0;4>s;++s)if(o=e[s],null!==o.voxel)l[s]=o;else if(null!==o.children)l[s]=o.children[a[s]];else break;4===s&&E(l,Ht[t][r][4],n)}}function O(e,t,n){var a=[0,0,0,0],l=[[0,0,1,1],[0,1,0,1]],o=void 0,r=void 0,s=void 0,y=void 0,d=void 0,u=void 0;if(null!==e[0].children||null!==e[1].children){for(d=0;4>d;++d)a[0]=Qt[t][d][0],a[1]=Qt[t][d][1],o=[null===e[0].children?e[0]:e[0].children[a[0]],null===e[1].children?e[1]:e[1].children[a[1]]],O(o,Qt[t][d][2],n);for(d=0;4>d;++d){for(a[0]=Gt[t][d][1],a[1]=Gt[t][d][2],a[2]=Gt[t][d][3],a[3]=Gt[t][d][4],s=l[Gt[t][d][0]],r=[],u=0;4>u;++u)if(y=e[s[u]],null!==y.voxel)r[u]=y;else if(null!==y.children)r[u]=y.children[a[u]];else break;4===u&&E(r,Gt[t][d][5],n)}}}function D(e,t){var n=e.children,a=[0,0,0,0],l=void 0,o=void 0,r=void 0;if(null!==n){for(r=0;8>r;++r)D(n[r],t);for(r=0;12>r;++r)a[0]=jt[r][0],a[1]=jt[r][1],l=[n[a[0]],n[a[1]]],O(l,jt[r][2],t);for(r=0;6>r;++r)a[0]=Ut[r][0],a[1]=Ut[r][1],a[2]=Ut[r][2],a[3]=Ut[r][3],o=[n[a[0]],n[a[1]],n[a[2]],n[a[3]]],E(o,Ut[r][4],t)}}function A(e,t,n,a){var l,o;if(null!==e.children)for(l=0;8>l;++l)a=A(e.children[l],t,n,a);else null!==e.voxel&&(o=e.voxel,o.index=a,t[3*a]=o.position.x,t[3*a+1]=o.position.y,t[3*a+2]=o.position.z,n[3*a]=o.normal.x,n[3*a+1]=o.normal.y,n[3*a+2]=o.normal.z,++a);return a}function V(e,t,a,l,o){var r=0;for(t>>=1;0<t;t>>=1,r=0)a>=t&&(r+=4,a-=t),l>=t&&(r+=2,l-=t),o>=t&&(r+=1,o-=t),null===e.children&&e.split(),e=e.children[r];return e}function F(e,t,n,a,l){var o=e+1,r=new Nt,s=void 0,y=void 0,d=void 0,u=void 0,c=void 0,m=void 0,x=void 0,p=void 0,v=void 0,g=void 0;for(s=0,g=0;8>g;++g)u=je[g],c=(a+u[2])*(o*o)+(n+u[1])*o+(t+u[0]),d=te(l[c],ft.SOLID),s|=d<<g;for(y=0,g=0;12>g;++g)m=Ue[g][0],x=Ue[g][1],p=1&s>>m,v=1&s>>x,p!=v&&++y;return r.materials=s,r.edgeCount=y,r.qefData=new It,r}function B(e){var t=un,a=Pt.resolution,n=new xe(0,0,0),i=new xe(a,a,a),l=new v(cn,cn.clone().addScalar(un)),o=e.getBoundingBox();return e.type!==on.INTERSECTION&&(o.intersectsBox(l)?(n.copy(o.min).max(l.min).sub(l.min),n.x=K(n.x*a/t),n.y=K(n.y*a/t),n.z=K(n.z*a/t),i.copy(o.max).min(l.max).sub(l.min),i.x=W(i.x*a/t),i.y=W(i.y*a/t),i.z=W(i.z*a/t)):(n.set(a,a,a),i.set(0,0,0))),new v(n,i)}function N(e,t,a,i){var l=Pt.resolution,n=l+1,o=i.max.x,r=i.max.y,s=i.max.z,d=void 0,u=void 0,c=void 0;for(c=i.min.z;c<=s;++c)for(u=i.min.y;u<=r;++u)for(d=i.min.x;d<=o;++d)e.updateMaterialIndex(c*(n*n)+u*n+d,t,a)}function L(e,t,a){var i=un,l=Pt.resolution,n=l+1,o=t.materialIndices,r=new xe,s=new xe,d=a.max.x,u=a.max.y,c=a.max.z,m=void 0,p=0,v=void 0,g=void 0,k=void 0;for(k=a.min.z;k<=c;++k)for(r.z=k*i/l,g=a.min.y;g<=u;++g)for(r.y=g*i/l,v=a.min.x;v<=d;++v)r.x=v*i/l,m=e.generateMaterialIndex(s.addVectors(cn,r)),m!==ft.AIR&&(o[k*(n*n)+g*n+v]=m,++p);t.materials=p}function R(e,t,a){var l=Pt.resolution,n=l+1,o=new Uint32Array([1,n,n*n]),r=t.materialIndices,s=new pt,y=new pt,u=a.edgeData,m=t.edgeData,x=new Uint32Array(3),p=zt.calculate1DEdgeCount(l),v=new zt(l,te(p,m.indices[0].length+u.indices[0].length),te(p,m.indices[1].length+u.indices[1].length),te(p,m.indices[2].length+u.indices[2].length)),g=void 0,k=void 0,h=void 0,z=void 0,f=void 0,S=void 0,T=void 0,w=void 0,P=void 0,I=void 0,_=void 0,C=void 0,b=void 0,E=void 0,O=void 0,D=void 0,q=void 0,A=void 0,V=void 0,F=void 0,B=void 0,N=void 0,L=void 0;for(A=0,V=0;3>V;A=0,++V){for(g=u.indices[V],z=m.indices[V],T=v.indices[V],k=u.zeroCrossings[V],f=m.zeroCrossings[V],w=v.zeroCrossings[V],h=u.normals[V],S=m.normals[V],P=v.normals[V],I=o[V],N=g.length,L=z.length,(F=0,B=0);F<N;++F)if(_=g[F],C=_+I,O=r[_],D=r[C],O!==D&&(O===ft.AIR||D===ft.AIR)){for(s.t=k[F],s.n.x=h[3*F],s.n.y=h[3*F+1],s.n.z=h[3*F+2],e.type===on.DIFFERENCE&&s.n.negate(),q=s;B<L&&z[B]<=_;)b=z[B],E=b+I,y.t=f[B],y.n.x=S[3*B],y.n.y=S[3*B+1],y.n.z=S[3*B+2],O=r[b],b<_?(D=r[E],O!==D&&(O===ft.AIR||D===ft.AIR)&&(T[A]=b,w[A]=y.t,P[3*A]=y.n.x,P[3*A+1]=y.n.y,P[3*A+2]=y.n.z,++A)):q=e.selectEdge(y,s,O===ft.SOLID),++B;T[A]=_,w[A]=q.t,P[3*A]=q.n.x,P[3*A+1]=q.n.y,P[3*A+2]=q.n.z,++A}for(;B<L;)b=z[B],E=b+I,O=r[b],D=r[E],O!==D&&(O===ft.AIR||D===ft.AIR)&&(T[A]=b,w[A]=f[B],P[3*A]=S[3*B],P[3*A+1]=S[3*B+1],P[3*A+2]=S[3*B+2],++A),++B;x[V]=A}return{edgeData:v,lengths:x}}function Y(e,t,i){var l=un,o=Pt.resolution,n=o+1,r=n*n,s=new Uint32Array([1,n,r]),u=t.materialIndices,m=cn,p=new xe,v=new xe,g=new pt,k=new Uint32Array(3),h=new zt(o,zt.calculate1DEdgeCount(o)),f=void 0,S=void 0,T=void 0,w=void 0,P=void 0,I=void 0,_=void 0,C=void 0,b=void 0,E=void 0,O=void 0,D=void 0,q=void 0,A=void 0,V=void 0,F=void 0,B=void 0,N=void 0,L=void 0;for(V=4,q=0,A=0;3>A;V>>=1,q=0,++A){F=je[V],f=h.indices[A],S=h.zeroCrossings[A],T=h.normals[A],w=s[A],_=i.min.x,E=i.max.x,C=i.min.y,O=i.max.y,b=i.min.z,D=i.max.z;for(0===A?(_=ne(_-1,0),E=te(E,o-1)):1===A?(C=ne(C-1,0),O=te(O,o-1)):2===A?(b=ne(b-1,0),D=te(D,o-1)):void 0,L=b;L<=D;++L)for(N=C;N<=O;++N)for(B=_;B<=E;++B)P=L*r+N*n+B,I=P+w,u[P]!==u[I]&&(p.set(B*l/o,N*l/o,L*l/o),v.set((B+F[0])*l/o,(N+F[1])*l/o,(L+F[2])*l/o),g.a.addVectors(m,p),g.b.addVectors(m,v),e.generateEdge(g),f[q]=P,S[q]=g.t,T[3*q]=g.n.x,T[3*q+1]=g.n.y,T[3*q+2]=g.n.z,++q);k[A]=q}return{edgeData:h,lengths:k}}function M(e,t,n){var a=B(e),i=void 0,l=void 0,o=void 0,r=void 0,s=!1;if(e.type===on.DENSITY_FUNCTION?L(e,t,a):t.empty?e.type===on.UNION&&(t.set(n),s=!0):!(t.full&&e.type===on.UNION)&&N(e,t,n,a),!s&&!t.empty&&!t.full){for(i=e.type===on.DENSITY_FUNCTION?Y(e,t,a):R(e,t,n),l=i.edgeData,o=i.lengths,r=0;3>r;++r)l.indices[r]=l.indices[r].slice(0,o[r]),l.zeroCrossings[r]=l.zeroCrossings[r].slice(0,o[r]),l.normals[r]=l.normals[r].slice(0,3*o[r]);t.edgeData=l}}function X(e){var t=e.children,n=void 0,a=void 0,o=void 0,r=void 0;for(e.type===on.DENSITY_FUNCTION&&(n=new Pt,M(e,n)),o=0,r=t.length;o<r&&(a=X(t[o]),void 0===n?n=a:null===a?e.type===on.INTERSECTION&&(n=null):null===n?e.type===on.UNION&&(n=a):M(e,n,a),null!==n||e.type===on.UNION);++o);return null!==n&&n.empty?null:n}function Z(e){var t=document.createElementNS(\\\"http://www.w3.org/1999/xhtml\\\",\\\"canvas\\\"),n=t.getContext(\\\"2d\\\");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height)}var j=Math.pow,U=Math.trunc,Q=Math.sign,G=Math.PI,H=Math.atan2,J=Math.round,K=Math.ceil,W=Math.floor,$=Math.abs,ee=Math.acos,te=Math.min,ne=Math.max,ae=Math.sqrt,ie=Math.cos,le=Math.sin,oe=function(e,t){if(!(e instanceof t))throw new TypeError(\\\"Cannot call a class as a function\\\")},re=function(){function e(e,t){for(var n,a=0;a<t.length;a++)n=t[a],n.enumerable=n.enumerable||!1,n.configurable=!0,\\\"value\\\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),se=function e(t,n,a){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var l=Object.getPrototypeOf(t);return null===l?void 0:e(l,n,a)}if(\\\"value\\\"in i)return i.value;var o=i.get;return void 0===o?void 0:o.call(a)},ye=function(e,t){if(\\\"function\\\"!=typeof t&&null!==t)throw new TypeError(\\\"Super expression must either be null or a function, not \\\"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},de=function(e,t){if(!e)throw new ReferenceError(\\\"this hasn't been initialised - super() hasn't been called\\\");return t&&(\\\"object\\\"==typeof t||\\\"function\\\"==typeof t)?t:e},ue=function e(t,n,a,i){var l=Object.getOwnPropertyDescriptor(t,n);if(void 0===l){var o=Object.getPrototypeOf(t);null!==o&&e(o,n,a,i)}else if(\\\"value\\\"in l&&l.writable)l.value=a;else{var r=l.set;void 0!==r&&r.call(i,a)}return a},ce=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},me=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;oe(this,e),this.runLengths=t,this.data=n}return re(e,null,[{key:\\\"encode\\\",value:function(t){var n=[],a=[],o=t[0],r=1,s=void 0,y=void 0;for(s=1,y=t.length;s<y;++s)o===t[s]?++r:(n.push(r),a.push(o),o=t[s],r=1);return n.push(r),a.push(o),new e(n,a)}},{key:\\\"decode\\\",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],a=void 0,l=void 0,o=void 0,r=void 0,s=void 0,y=0;for(l=0,r=t.length;l<r;++l)for(a=t[l],o=0,s=e[l];o<s;++o)n[y++]=a;return n}}]),e}(),xe=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;oe(this,e),this.x=t,this.y=n,this.z=a}return re(e,[{key:\\\"set\\\",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:\\\"copy\\\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:\\\"clone\\\",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:\\\"fromArray\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:\\\"toArray\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:\\\"setFromSpherical\\\",value:function(e){var t=le(e.phi)*e.radius;return this.x=t*le(e.theta),this.y=ie(e.phi)*e.radius,this.z=t*ie(e.theta),this}},{key:\\\"setFromCylindrical\\\",value:function(e){return this.x=e.radius*le(e.theta),this.y=e.y,this.z=e.radius*ie(e.theta),this}},{key:\\\"setFromMatrixColumn\\\",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:\\\"setFromMatrixPosition\\\",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:\\\"setFromMatrixScale\\\",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),a=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=a,this}},{key:\\\"add\\\",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:\\\"addScalar\\\",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:\\\"addVectors\\\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:\\\"addScaledVector\\\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:\\\"sub\\\",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:\\\"subScalar\\\",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:\\\"subVectors\\\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:\\\"multiply\\\",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:\\\"multiplyScalar\\\",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:\\\"multiplyVectors\\\",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:\\\"divide\\\",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:\\\"divideScalar\\\",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this}},{key:\\\"crossVectors\\\",value:function(e,t){var n=e.x,a=e.y,i=e.z,l=t.x,o=t.y,r=t.z;return this.x=a*r-i*o,this.y=i*l-n*r,this.z=n*o-a*l,this}},{key:\\\"cross\\\",value:function(e){return this.crossVectors(this,e)}},{key:\\\"transformDirection\\\",value:function(t){var n=this.x,a=this.y,i=this.z,l=t.elements;return this.x=l[0]*n+l[4]*a+l[8]*i,this.y=l[1]*n+l[5]*a+l[9]*i,this.z=l[2]*n+l[6]*a+l[10]*i,this.normalize()}},{key:\\\"applyMatrix3\\\",value:function(t){var n=this.x,a=this.y,i=this.z,l=t.elements;return this.x=l[0]*n+l[3]*a+l[6]*i,this.y=l[1]*n+l[4]*a+l[7]*i,this.z=l[2]*n+l[5]*a+l[8]*i,this}},{key:\\\"applyMatrix4\\\",value:function(t){var n=this.x,a=this.y,i=this.z,l=t.elements;return this.x=l[0]*n+l[4]*a+l[8]*i+l[12],this.y=l[1]*n+l[5]*a+l[9]*i+l[13],this.z=l[2]*n+l[6]*a+l[10]*i+l[14],this}},{key:\\\"applyQuaternion\\\",value:function(e){var t=this.x,n=this.y,a=this.z,i=e.x,l=e.y,o=e.z,r=e.w,s=r*t+l*a-o*n,y=r*n+o*t-i*a,d=r*a+i*n-l*t,u=-i*t-l*n-o*a;return this.x=s*r+u*-i+y*-o-d*-l,this.y=y*r+u*-l+d*-i-s*-o,this.z=d*r+u*-o+s*-l-y*-i,this}},{key:\\\"negate\\\",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:\\\"dot\\\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:\\\"reflect\\\",value:function(e){var t=e.x,n=e.y,a=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(t,n,a),this}},{key:\\\"angleTo\\\",value:function(e){var t=this.dot(e)/ae(this.lengthSquared()*e.lengthSquared());return ee(te(ne(t,-1),1))}},{key:\\\"manhattanLength\\\",value:function(){return $(this.x)+$(this.y)+$(this.z)}},{key:\\\"lengthSquared\\\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:\\\"length\\\",value:function(){return ae(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:\\\"manhattanDistanceTo\\\",value:function(e){return $(this.x-e.x)+$(this.y-e.y)+$(this.z-e.z)}},{key:\\\"distanceToSquared\\\",value:function(e){var t=this.x-e.x,n=this.y-e.y,a=this.z-e.z;return t*t+n*n+a*a}},{key:\\\"distanceTo\\\",value:function(e){return ae(this.distanceToSquared(e))}},{key:\\\"normalize\\\",value:function(){return this.divideScalar(this.length())}},{key:\\\"setLength\\\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\\\"min\\\",value:function(e){return this.x=te(this.x,e.x),this.y=te(this.y,e.y),this.z=te(this.z,e.z),this}},{key:\\\"max\\\",value:function(e){return this.x=ne(this.x,e.x),this.y=ne(this.y,e.y),this.z=ne(this.z,e.z),this}},{key:\\\"clamp\\\",value:function(e,t){return this.x=ne(e.x,te(t.x,this.x)),this.y=ne(e.y,te(t.y,this.y)),this.z=ne(e.z,te(t.z,this.z)),this}},{key:\\\"floor\\\",value:function(){return this.x=W(this.x),this.y=W(this.y),this.z=W(this.z),this}},{key:\\\"ceil\\\",value:function(){return this.x=K(this.x),this.y=K(this.y),this.z=K(this.z),this}},{key:\\\"round\\\",value:function(){return this.x=J(this.x),this.y=J(this.y),this.z=J(this.z),this}},{key:\\\"lerp\\\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:\\\"lerpVectors\\\",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:\\\"equals\\\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}]),e}(),pe=new xe,v=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe(1/0,1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe(-Infinity,-Infinity,-Infinity);oe(this,e),this.min=t,this.max=n}return re(e,[{key:\\\"set\\\",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:\\\"copy\\\",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"makeEmpty\\\",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-Infinity,this}},{key:\\\"isEmpty\\\",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:\\\"getCenter\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\\\"getSize\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:\\\"setFromSphere\\\",value:function(e){return this.set(e.center,e.center),this.expandByScalar(e.radius),this}},{key:\\\"expandByPoint\\\",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:\\\"expandByVector\\\",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:\\\"expandByScalar\\\",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:\\\"setFromPoints\\\",value:function(e){var t,n;for(this.min.set(0,0,0),this.max.set(0,0,0),(t=0,n=e.length);t<n;++t)this.expandByPoint(e[t]);return this}},{key:\\\"setFromCenterAndSize\\\",value:function(e,t){var n=pe.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:\\\"clampPoint\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe;return t.copy(e).clamp(this.min,this.max)}},{key:\\\"distanceToPoint\\\",value:function(e){var t=pe.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:\\\"applyMatrix4\\\",value:function(e){var t=this.min,n=this.max;if(!this.isEmpty()){var a=e.elements,i=a[0]*t.x,l=a[1]*t.x,o=a[2]*t.x,r=a[0]*n.x,s=a[1]*n.x,y=a[2]*n.x,d=a[4]*t.y,u=a[5]*t.y,c=a[6]*t.y,m=a[4]*n.y,x=a[5]*n.y,p=a[6]*n.y,v=a[8]*t.z,g=a[9]*t.z,k=a[10]*t.z,h=a[8]*n.z,z=a[9]*n.z,f=a[10]*n.z;t.x=te(i,r)+te(d,m)+te(v,h)+a[12],t.y=te(l,s)+te(u,x)+te(g,z)+a[13],t.z=te(o,y)+te(c,p)+te(k,f)+a[14],n.x=ne(i,r)+ne(d,m)+ne(v,h)+a[12],n.y=ne(l,s)+ne(u,x)+ne(g,z)+a[13],n.z=ne(o,y)+ne(c,p)+ne(k,f)+a[14]}return this}},{key:\\\"translate\\\",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:\\\"intersect\\\",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:\\\"union\\\",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:\\\"containsPoint\\\",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=n.x&&e.y<=n.y&&e.z<=n.z}},{key:\\\"containsBox\\\",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return t.x<=a.x&&i.x<=n.x&&t.y<=a.y&&i.y<=n.y&&t.z<=a.z&&i.z<=n.z}},{key:\\\"intersectsBox\\\",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&i.z>=t.z&&a.x<=n.x&&a.y<=n.y&&a.z<=n.z}},{key:\\\"intersectsSphere\\\",value:function(e){var t=this.clampPoint(e.center,pe);return t.distanceToSquared(e.center)<=e.radius*e.radius}},{key:\\\"intersectsPlane\\\",value:function(e){var t,n;return 0<e.normal.x?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=e.constant&&n>=e.constant}},{key:\\\"equals\\\",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),ve=new v,ge=new xe,ke=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;oe(this,e),this.center=t,this.radius=n}return re(e,[{key:\\\"set\\\",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:\\\"copy\\\",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"setFromPoints\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:ve.setFromPoints(e).getCenter(this.center),n=0,a=void 0,o=void 0;for(a=0,o=e.length;a<o;++a)n=ne(n,t.distanceToSquared(e[a]));return this.radius=ae(n),this}},{key:\\\"setFromBox\\\",value:function(e){return e.getCenter(this.center),this.radius=.5*e.getSize(ge).length(),this}},{key:\\\"isEmpty\\\",value:function(){return 0>=this.radius}},{key:\\\"translate\\\",value:function(e){return this.center.add(e),this}},{key:\\\"clampPoint\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe,n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:\\\"distanceToPoint\\\",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:\\\"containsPoint\\\",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:\\\"intersectsSphere\\\",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:\\\"intersectsBox\\\",value:function(e){return e.intersectsSphere(this)}},{key:\\\"intersectsPlane\\\",value:function(e){return $(e.distanceToPoint(this.center))<=this.radius}},{key:\\\"equals\\\",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}]),e}(),he=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;oe(this,e),this.x=t,this.y=n}return re(e,[{key:\\\"set\\\",value:function(e,t){return this.x=e,this.y=t,this}},{key:\\\"copy\\\",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:\\\"clone\\\",value:function(){return new this.constructor(this.x,this.y)}},{key:\\\"fromArray\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:\\\"toArray\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:\\\"add\\\",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:\\\"addScalar\\\",value:function(e){return this.x+=e,this.y+=e,this}},{key:\\\"addVectors\\\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:\\\"addScaledVector\\\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:\\\"sub\\\",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:\\\"subScalar\\\",value:function(e){return this.x-=e,this.y-=e,this}},{key:\\\"subVectors\\\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:\\\"multiply\\\",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:\\\"multiplyScalar\\\",value:function(e){return this.x*=e,this.y*=e,this}},{key:\\\"divide\\\",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:\\\"divideScalar\\\",value:function(e){return this.x/=e,this.y/=e,this}},{key:\\\"applyMatrix3\\\",value:function(t){var n=this.x,a=this.y,i=t.elements;return this.x=i[0]*n+i[3]*a+i[6],this.y=i[1]*n+i[4]*a+i[7],this}},{key:\\\"dot\\\",value:function(e){return this.x*e.x+this.y*e.y}},{key:\\\"manhattanLength\\\",value:function(){return $(this.x)+$(this.y)}},{key:\\\"lengthSquared\\\",value:function(){return this.x*this.x+this.y*this.y}},{key:\\\"length\\\",value:function(){return ae(this.x*this.x+this.y*this.y)}},{key:\\\"manhattanDistanceTo\\\",value:function(e){return $(this.x-e.x)+$(this.y-e.y)}},{key:\\\"distanceToSquared\\\",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:\\\"distanceTo\\\",value:function(e){return ae(this.distanceToSquared(e))}},{key:\\\"normalize\\\",value:function(){return this.divideScalar(this.length())}},{key:\\\"setLength\\\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\\\"min\\\",value:function(e){return this.x=te(this.x,e.x),this.y=te(this.y,e.y),this}},{key:\\\"max\\\",value:function(e){return this.x=ne(this.x,e.x),this.y=ne(this.y,e.y),this}},{key:\\\"clamp\\\",value:function(e,t){return this.x=ne(e.x,te(t.x,this.x)),this.y=ne(e.y,te(t.y,this.y)),this}},{key:\\\"floor\\\",value:function(){return this.x=W(this.x),this.y=W(this.y),this}},{key:\\\"ceil\\\",value:function(){return this.x=K(this.x),this.y=K(this.y),this}},{key:\\\"round\\\",value:function(){return this.x=J(this.x),this.y=J(this.y),this}},{key:\\\"negate\\\",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:\\\"angle\\\",value:function(){var e=H(this.y,this.x);return 0>e&&(e+=2*G),e}},{key:\\\"lerp\\\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:\\\"lerpVectors\\\",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:\\\"rotateAround\\\",value:function(e,t){var n=ie(t),a=le(t),i=this.x-e.x,l=this.y-e.y;return this.x=i*n-l*a+e.x,this.y=i*a+l*n+e.y,this}},{key:\\\"equals\\\",value:function(e){return e.x===this.x&&e.y===this.y}},{key:\\\"width\\\",get:function(){return this.x},set:function(e){return this.x=e}},{key:\\\"height\\\",get:function(){return this.y},set:function(e){return this.y=e}}]),e}(),ze=new he,fe=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new he(1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new he(-Infinity,-Infinity);oe(this,e),this.min=t,this.max=n}return re(e,[{key:\\\"set\\\",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:\\\"copy\\\",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"makeEmpty\\\",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-Infinity,this}},{key:\\\"isEmpty\\\",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:\\\"getCenter\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new he;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\\\"getSize\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new he;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:\\\"getBoundingSphere\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new ke;return this.getCenter(e.center),e.radius=.5*this.getSize(ze).length(),e}},{key:\\\"expandByPoint\\\",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:\\\"expandByVector\\\",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:\\\"expandByScalar\\\",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:\\\"setFromPoints\\\",value:function(e){var t,n;for(this.min.set(0,0),this.max.set(0,0),(t=0,n=e.length);t<n;++t)this.expandByPoint(e[t]);return this}},{key:\\\"setFromCenterAndSize\\\",value:function(e,t){var n=ze.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:\\\"clampPoint\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new he;return t.copy(e).clamp(this.min,this.max)}},{key:\\\"distanceToPoint\\\",value:function(e){var t=ze.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:\\\"translate\\\",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:\\\"intersect\\\",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:\\\"union\\\",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:\\\"containsPoint\\\",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.x<=n.x&&e.y<=n.y}},{key:\\\"containsBox\\\",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return t.x<=a.x&&i.x<=n.x&&t.y<=a.y&&i.y<=n.y}},{key:\\\"intersectsBox\\\",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&a.x<=n.x&&a.y<=n.y}},{key:\\\"equals\\\",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),Se=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;oe(this,e),this.radius=t,this.theta=n,this.y=a}return re(e,[{key:\\\"set\\\",value:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}},{key:\\\"copy\\\",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"setFromVector3\\\",value:function(e){return this.radius=ae(e.x*e.x+e.z*e.z),this.theta=H(e.x,e.z),this.y=e.y,this}}]),e}(),Te=function(){function e(){oe(this,e),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return re(e,[{key:\\\"set\\\",value:function(e,t,n,a,i,l,o,r,s){var y=this.elements;return y[0]=e,y[3]=t,y[6]=n,y[1]=a,y[4]=i,y[7]=l,y[2]=o,y[5]=r,y[8]=s,this}},{key:\\\"identity\\\",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:\\\"copy\\\",value:function(e){var t=e.elements,n=this.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],this}},{key:\\\"clone\\\",value:function(){return new this.constructor().fromArray(this.elements)}},{key:\\\"fromArray\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a=void 0;for(a=0;9>a;++a)n[a]=e[a+t];return this}},{key:\\\"toArray\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a=void 0;for(a=0;9>a;++a)e[a+t]=n[a];return e}},{key:\\\"multiplyMatrices\\\",value:function(e,t){var n=e.elements,a=t.elements,i=this.elements,l=n[0],o=n[3],r=n[6],s=n[1],y=n[4],d=n[7],u=n[2],c=n[5],m=n[8],x=a[0],p=a[3],v=a[6],g=a[1],k=a[4],h=a[7],z=a[2],f=a[5],S=a[8];return i[0]=l*x+o*g+r*z,i[3]=l*p+o*k+r*f,i[6]=l*v+o*h+r*S,i[1]=s*x+y*g+d*z,i[4]=s*p+y*k+d*f,i[7]=s*v+y*h+d*S,i[2]=u*x+c*g+m*z,i[5]=u*p+c*k+m*f,i[8]=u*v+c*h+m*S,this}},{key:\\\"multiply\\\",value:function(e){return this.multiplyMatrices(this,e)}},{key:\\\"premultiply\\\",value:function(e){return this.multiplyMatrices(e,this)}},{key:\\\"multiplyScalar\\\",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:\\\"determinant\\\",value:function(){var t=this.elements,n=t[0],a=t[1],l=t[2],o=t[3],r=t[4],e=t[5],s=t[6],y=t[7],d=t[8];return n*r*d-n*e*y-a*o*d+a*e*s+l*o*y-l*r*s}},{key:\\\"getInverse\\\",value:function(e){var t=e.elements,n=this.elements,a=t[0],i=t[1],l=t[2],o=t[3],r=t[4],s=t[5],y=t[6],d=t[7],u=t[8],c=u*r-s*d,m=s*y-u*o,x=d*o-r*y,p=a*c+i*m+l*x,v=void 0;return 0==p?(console.error(\\\"Can't invert matrix, determinant is zero\\\",e),this.identity()):(v=1/p,n[0]=c*v,n[1]=(l*d-u*i)*v,n[2]=(s*i-l*r)*v,n[3]=m*v,n[4]=(u*a-l*y)*v,n[5]=(l*o-s*a)*v,n[6]=x*v,n[7]=(i*y-d*a)*v,n[8]=(r*a-i*o)*v),this}},{key:\\\"transpose\\\",value:function(){var e=this.elements,n=void 0;return n=e[1],e[1]=e[3],e[3]=n,n=e[2],e[2]=e[6],e[6]=n,n=e[5],e[5]=e[7],e[7]=n,this}},{key:\\\"scale\\\",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:\\\"rotate\\\",value:function(e){var t=ie(e),n=le(e),a=this.elements,i=a[0],l=a[3],o=a[6],r=a[1],s=a[4],y=a[7];return a[0]=t*i+n*r,a[3]=t*l+n*s,a[6]=t*o+n*y,a[1]=-n*i+t*r,a[4]=-n*l+t*s,a[7]=-n*o+t*y,this}},{key:\\\"translate\\\",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:\\\"equals\\\",value:function(e){var t=this.elements,n=e.elements,a=!0,l=void 0;for(l=0;a&&9>l;++l)t[l]!==n[l]&&(a=!1);return a}}]),e}(),we={XYZ:\\\"XYZ\\\",YZX:\\\"YZX\\\",ZXY:\\\"ZXY\\\",XZY:\\\"XZY\\\",YXZ:\\\"YXZ\\\",ZYX:\\\"ZYX\\\"},Pe=new xe,Ie=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;oe(this,e),this.x=t,this.y=n,this.z=a,this.w=i}var n=Number.EPSILON;return re(e,[{key:\\\"set\\\",value:function(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.w=a,this}},{key:\\\"copy\\\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:\\\"clone\\\",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:\\\"fromArray\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:\\\"toArray\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:\\\"setFromEuler\\\",value:function(e){var t=e.x,n=e.y,a=e.z,i=ie,l=le,o=i(t/2),r=i(n/2),s=i(a/2),y=l(t/2),d=l(n/2),u=l(a/2);switch(e.order){case we.XYZ:this.x=y*r*s+o*d*u,this.y=o*d*s-y*r*u,this.z=o*r*u+y*d*s,this.w=o*r*s-y*d*u;break;case we.YXZ:this.x=y*r*s+o*d*u,this.y=o*d*s-y*r*u,this.z=o*r*u-y*d*s,this.w=o*r*s+y*d*u;break;case we.ZXY:this.x=y*r*s-o*d*u,this.y=o*d*s+y*r*u,this.z=o*r*u+y*d*s,this.w=o*r*s-y*d*u;break;case we.ZYX:this.x=y*r*s-o*d*u,this.y=o*d*s+y*r*u,this.z=o*r*u-y*d*s,this.w=o*r*s+y*d*u;break;case we.YZX:this.x=y*r*s+o*d*u,this.y=o*d*s+y*r*u,this.z=o*r*u-y*d*s,this.w=o*r*s-y*d*u;break;case we.XZY:this.x=y*r*s-o*d*u,this.y=o*d*s-y*r*u,this.z=o*r*u+y*d*s,this.w=o*r*s+y*d*u;}return this}},{key:\\\"setFromAxisAngle\\\",value:function(e,t){var n=t/2,a=le(n);return this.x=e.x*a,this.y=e.y*a,this.z=e.z*a,this.w=ie(n),this}},{key:\\\"setFromRotationMatrix\\\",value:function(e){var t=e.elements,n=t[0],a=t[4],i=t[8],l=t[1],o=t[5],r=t[9],y=t[2],d=t[6],u=t[10],c=n+o+u,m=void 0;return 0<c?(m=.5/ae(c+1),this.w=.25/m,this.x=(d-r)*m,this.y=(i-y)*m,this.z=(l-a)*m):n>o&&n>u?(m=2*ae(1+n-o-u),this.w=(d-r)/m,this.x=.25*m,this.y=(a+l)/m,this.z=(i+y)/m):o>u?(m=2*ae(1+o-n-u),this.w=(i-y)/m,this.x=(a+l)/m,this.y=.25*m,this.z=(r+d)/m):(m=2*ae(1+u-n-o),this.w=(l-a)/m,this.x=(i+y)/m,this.y=(r+d)/m,this.z=.25*m),this}},{key:\\\"setFromUnitVectors\\\",value:function(e,t){var n=e.dot(t)+1;return 1e-6>n?(n=0,$(e.x)>$(e.z)?Pe.set(-e.y,e.x,0):Pe.set(0,-e.z,e.y)):Pe.crossVectors(e,t),this.x=Pe.x,this.y=Pe.y,this.z=Pe.z,this.w=n,this.normalize()}},{key:\\\"invert\\\",value:function(){return this.conjugate()}},{key:\\\"conjugate\\\",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:\\\"lengthSquared\\\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:\\\"length\\\",value:function(){return ae(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:\\\"normalize\\\",value:function(){var e=this.length(),t=void 0;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/e,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}},{key:\\\"dot\\\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:\\\"multiplyQuaternions\\\",value:function(e,t){var n=e.x,a=e.y,i=e.z,l=e.w,o=t.x,r=t.y,s=t.z,y=t.w;return this.x=n*y+l*o+a*s-i*r,this.y=a*y+l*r+i*o-n*s,this.z=i*y+l*s+n*r-a*o,this.w=l*y-n*o-a*r-i*s,this}},{key:\\\"multiply\\\",value:function(e){return this.multiplyQuaternions(this,e)}},{key:\\\"premultiply\\\",value:function(e){return this.multiplyQuaternions(e,this)}},{key:\\\"slerp\\\",value:function(e,a){var t=this.x,i=this.y,l=this.z,o=this.w,r=void 0,y=void 0,d=void 0,u=void 0,c=void 0,m=void 0,x=void 0;return 1===a?this.copy(e):0<a&&(r=o*e.w+t*e.x+i*e.y+l*e.z,0>r?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,r=-r):this.copy(e),1<=r?(this.w=o,this.x=t,this.y=i,this.z=l):(y=1-r*r,c=1-a,y<=n?(this.w=c*o+a*this.w,this.x=c*t+a*this.x,this.y=c*i+a*this.y,this.z=c*l+a*this.z,this.normalize()):(d=ae(y),u=H(d,r),m=le(c*u)/d,x=le(a*u)/d,this.w=o*m+this.w*x,this.x=t*m+this.x*x,this.y=i*m+this.y*x,this.z=l*m+this.z*x))),this}},{key:\\\"equals\\\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}],[{key:\\\"slerp\\\",value:function(e,n,a,i){return a.copy(e).slerp(n,i)}},{key:\\\"slerpFlat\\\",value:function(e,a,i,l,o,r,y){var d=o[r],u=o[r+1],c=o[r+2],m=o[r+3],x=i[l],p=i[l+1],v=i[l+2],g=i[l+3],k=void 0,h=void 0,z=void 0,S=void 0,T=void 0,w=void 0,P=void 0,I=void 0;(g!==m||x!==d||p!==u||v!==c)&&(k=1-y,S=x*d+p*u+v*c+g*m,w=0<=S?1:-1,T=1-S*S,T>n&&(z=ae(T),P=H(z,S*w),k=le(k*P)/z,y=le(y*P)/z),I=y*w,x=x*k+d*I,p=p*k+u*I,v=v*k+c*I,g=g*k+m*I,k===1-y&&(h=1/ae(x*x+p*p+v*v+g*g),x*=h,p*=h,v*=h,g*=h)),e[a]=x,e[a+1]=p,e[a+2]=v,e[a+3]=g}}]),e}(),_e=new Te,m=new Ie,q=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;oe(this,t),this.x=e,this.y=n,this.z=a,this.order=t.defaultOrder}return re(t,[{key:\\\"set\\\",value:function(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.order=a,this}},{key:\\\"copy\\\",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}},{key:\\\"clone\\\",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:\\\"fromArray\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.order=e[t+3],this}},{key:\\\"toArray\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.order,e}},{key:\\\"toVector3\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return e.set(this.x,this.y,this.z)}},{key:\\\"setFromRotationMatrix\\\",value:function(t){var n=Math.asin,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order,i=t.elements,l=i[0],o=i[4],r=i[8],s=i[1],y=i[5],d=i[9],u=i[2],c=i[6],m=i[10],x=1-1e-5;switch(a){case we.XYZ:{this.y=n(e(r,-1,1)),$(r)<x?(this.x=H(-d,m),this.z=H(-o,l)):(this.x=H(c,y),this.z=0);break}case we.YXZ:{this.x=n(-e(d,-1,1)),$(d)<x?(this.y=H(r,m),this.z=H(s,y)):(this.y=H(-u,l),this.z=0);break}case we.ZXY:{this.x=n(e(c,-1,1)),$(c)<x?(this.y=H(-u,m),this.z=H(-o,y)):(this.y=0,this.z=H(s,l));break}case we.ZYX:{this.y=n(-e(u,-1,1)),$(u)<x?(this.x=H(c,m),this.z=H(s,l)):(this.x=0,this.z=H(-o,y));break}case we.YZX:{this.z=n(e(s,-1,1)),$(s)<x?(this.x=H(-d,y),this.y=H(-u,l)):(this.x=0,this.y=H(r,m));break}case we.XZY:{this.z=n(-e(o,-1,1)),$(o)<x?(this.x=H(c,y),this.y=H(r,l)):(this.x=H(-d,m),this.y=0);break}}return this.order=a,this}},{key:\\\"setFromQuaternion\\\",value:function(e,t){return _e.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_e,t)}},{key:\\\"setFromVector3\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(e.x,e.y,e.z,t)}},{key:\\\"reorder\\\",value:function(e){return m.setFromEuler(this),this.setFromQuaternion(m,e)}},{key:\\\"equals\\\",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order}}],[{key:\\\"defaultOrder\\\",get:function(){return we.XYZ}}]),t}(),Ce=new xe,a=new xe,b=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe(1,0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;oe(this,e),this.normal=t,this.constant=n}return re(e,[{key:\\\"set\\\",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:\\\"setComponents\\\",value:function(e,t,n,a){return this.normal.set(e,t,n),this.constant=a,this}},{key:\\\"copy\\\",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"setFromNormalAndCoplanarPoint\\\",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:\\\"setFromCoplanarPoints\\\",value:function(e,t,n){var i=Ce.subVectors(n,t).cross(a.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,Ce),this}},{key:\\\"normalize\\\",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:\\\"negate\\\",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:\\\"distanceToPoint\\\",value:function(e){return this.normal.dot(e)+this.constant}},{key:\\\"distanceToSphere\\\",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:\\\"projectPoint\\\",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:\\\"coplanarPoint\\\",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:\\\"translate\\\",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:\\\"intersectLine\\\",value:function(e,n){var a=e.delta(Ce),i=this.normal.dot(a);if(0===i)0===this.distanceToPoint(e.start)&&n.copy(e.start);else{var l=-(e.start.dot(this.normal)+this.constant)/i;0<=l&&1>=l&&n.copy(a).multiplyScalar(l).add(e.start)}return n}},{key:\\\"intersectsLine\\\",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return 0>t&&0<n||0>n&&0<t}},{key:\\\"intersectsBox\\\",value:function(e){return e.intersectsPlane(this)}},{key:\\\"intersectsSphere\\\",value:function(e){return e.intersectsPlane(this)}},{key:\\\"equals\\\",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}]),e}(),be=new xe,Ee=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new b,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new b,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new b,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new b,l=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new b,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new b;oe(this,e),this.planes=[t,n,a,i,l,o]}return re(e,[{key:\\\"set\\\",value:function(e,t,n,a,i,l){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(a),o[4].copy(i),o[5].copy(l),this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"copy\\\",value:function(e){var t=this.planes,n=void 0;for(n=0;6>n;++n)t[n].copy(e.planes[n]);return this}},{key:\\\"setFromMatrix\\\",value:function(e){var t=this.planes,n=e.elements,a=n[0],i=n[1],l=n[2],o=n[3],r=n[4],s=n[5],y=n[6],d=n[7],u=n[8],c=n[9],m=n[10],x=n[11],p=n[12],v=n[13],g=n[14],k=n[15];return t[0].setComponents(o-a,d-r,x-u,k-p).normalize(),t[1].setComponents(o+a,d+r,x+u,k+p).normalize(),t[2].setComponents(o+i,d+s,x+c,k+v).normalize(),t[3].setComponents(o-i,d-s,x-c,k-v).normalize(),t[4].setComponents(o-l,d-y,x-m,k-g).normalize(),t[5].setComponents(o+l,d+y,x+m,k+g).normalize(),this}},{key:\\\"intersectsSphere\\\",value:function(e){var t=this.planes,n=e.center,a=-e.radius,l=!0,o=void 0,r=void 0;for(o=0;6>o;++o)if(r=t[o].distanceToPoint(n),r<a){l=!1;break}return l}},{key:\\\"intersectsBox\\\",value:function(e){var t=this.planes,n=e.min,a=e.max,l=void 0,o=void 0;for(l=0;6>l;++l)if(o=t[l],be.x=0<o.normal.x?a.x:n.x,be.y=0<o.normal.y?a.y:n.y,be.z=0<o.normal.z?a.z:n.z,0>o.distanceToPoint(be))return!1;return!0}},{key:\\\"containsPoint\\\",value:function(e){var t=this.planes,n=!0,a=void 0;for(a=0;6>a;++a)if(0>t[a].distanceToPoint(e)){n=!1;break}return n}}]),e}(),Oe=new xe,De=new xe,qe=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe;oe(this,e),this.start=t,this.end=n}return re(e,[{key:\\\"set\\\",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:\\\"copy\\\",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"getCenter\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:\\\"delta\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return e.subVectors(this.end,this.start)}},{key:\\\"lengthSquared\\\",value:function(){return this.start.distanceToSquared(this.end)}},{key:\\\"length\\\",value:function(){return this.start.distanceTo(this.end)}},{key:\\\"at\\\",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:\\\"closestPointToPointParameter\\\",value:function(e,n){Oe.subVectors(e,this.start),De.subVectors(this.end,this.start);var a=De.dot(De),i=De.dot(Oe),l=n?te(ne(i/a,0),1):i/a;return l}},{key:\\\"closestPointToPoint\\\",value:function(e){var n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new xe,i=this.closestPointToPointParameter(e,n);return this.delta(a).multiplyScalar(i).add(this.start)}},{key:\\\"equals\\\",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}]),e}(),Ae=new xe,Ve=new xe,Fe=new xe,c=function(){function e(){oe(this,e),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return re(e,[{key:\\\"set\\\",value:function(e,t,n,a,i,l,o,r,s,y,d,u,c,m,x,p){var v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=a,v[1]=i,v[5]=l,v[9]=o,v[13]=r,v[2]=s,v[6]=y,v[10]=d,v[14]=u,v[3]=c,v[7]=m,v[11]=x,v[15]=p,this}},{key:\\\"identity\\\",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:\\\"copy\\\",value:function(e){var t=e.elements,n=this.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],this}},{key:\\\"clone\\\",value:function(){return new this.constructor().fromArray(this.elements)}},{key:\\\"fromArray\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a=void 0;for(a=0;16>a;++a)n[a]=e[a+t];return this}},{key:\\\"toArray\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a=void 0;for(a=0;16>a;++a)e[a+t]=n[a];return e}},{key:\\\"getMaxScaleOnAxis\\\",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],a=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return ae(ne(t,n,a))}},{key:\\\"copyPosition\\\",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:\\\"setPosition\\\",value:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}},{key:\\\"extractBasis\\\",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:\\\"makeBasis\\\",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:\\\"extractRotation\\\",value:function(e){var t=this.elements,n=e.elements,a=1/Ae.setFromMatrixColumn(e,0).length(),i=1/Ae.setFromMatrixColumn(e,1).length(),l=1/Ae.setFromMatrixColumn(e,2).length();return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*l,t[9]=n[9]*l,t[10]=n[10]*l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:\\\"makeRotationFromEuler\\\",value:function(t){var n=this.elements,i=t.x,l=t.y,o=t.z,r=ie(i),a=le(i),s=ie(l),y=le(l),d=ie(o),e=le(o),u=void 0,c=void 0,m=void 0,x=void 0,p=void 0,v=void 0,g=void 0,k=void 0,h=void 0,z=void 0,f=void 0,S=void 0;switch(t.order){case we.XYZ:{u=r*d,c=r*e,m=a*d,x=a*e,n[0]=s*d,n[4]=-s*e,n[8]=y,n[1]=c+m*y,n[5]=u-x*y,n[9]=-a*s,n[2]=x-u*y,n[6]=m+c*y,n[10]=r*s;break}case we.YXZ:{p=s*d,v=s*e,g=y*d,k=y*e,n[0]=p+k*a,n[4]=g*a-v,n[8]=r*y,n[1]=r*e,n[5]=r*d,n[9]=-a,n[2]=v*a-g,n[6]=k+p*a,n[10]=r*s;break}case we.ZXY:{p=s*d,v=s*e,g=y*d,k=y*e,n[0]=p-k*a,n[4]=-r*e,n[8]=g+v*a,n[1]=v+g*a,n[5]=r*d,n[9]=k-p*a,n[2]=-r*y,n[6]=a,n[10]=r*s;break}case we.ZYX:{u=r*d,c=r*e,m=a*d,x=a*e,n[0]=s*d,n[4]=m*y-c,n[8]=u*y+x,n[1]=s*e,n[5]=x*y+u,n[9]=c*y-m,n[2]=-y,n[6]=a*s,n[10]=r*s;break}case we.YZX:{h=r*s,z=r*y,f=a*s,S=a*y,n[0]=s*d,n[4]=S-h*e,n[8]=f*e+z,n[1]=e,n[5]=r*d,n[9]=-a*d,n[2]=-y*d,n[6]=z*e+f,n[10]=h-S*e;break}case we.XZY:{h=r*s,z=r*y,f=a*s,S=a*y,n[0]=s*d,n[4]=-e,n[8]=y*d,n[1]=h*e+S,n[5]=r*d,n[9]=z*e-f,n[2]=f*e-z,n[6]=a*d,n[10]=S*e+h;break}}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}},{key:\\\"makeRotationFromQuaternion\\\",value:function(e){return this.compose(Ae.set(0,0,0),e,Ve.set(1,1,1))}},{key:\\\"lookAt\\\",value:function(e,t,n){var a=this.elements,i=Ae,l=Ve,o=Fe;return o.subVectors(e,t),0===o.lengthSquared()&&(o.z=1),o.normalize(),i.crossVectors(n,o),0===i.lengthSquared()&&(1===$(n.z)?o.x+=1e-4:o.z+=1e-4,o.normalize(),i.crossVectors(n,o)),i.normalize(),l.crossVectors(o,i),a[0]=i.x,a[4]=l.x,a[8]=o.x,a[1]=i.y,a[5]=l.y,a[9]=o.y,a[2]=i.z,a[6]=l.z,a[10]=o.z,this}},{key:\\\"multiplyMatrices\\\",value:function(e,t){var n=this.elements,a=e.elements,i=t.elements,l=a[0],o=a[4],r=a[8],s=a[12],y=a[1],d=a[5],u=a[9],c=a[13],m=a[2],x=a[6],p=a[10],v=a[14],g=a[3],k=a[7],h=a[11],z=a[15],f=i[0],S=i[4],T=i[8],w=i[12],P=i[1],I=i[5],_=i[9],C=i[13],b=i[2],E=i[6],O=i[10],D=i[14],q=i[3],A=i[7],V=i[11],F=i[15];return n[0]=l*f+o*P+r*b+s*q,n[4]=l*S+o*I+r*E+s*A,n[8]=l*T+o*_+r*O+s*V,n[12]=l*w+o*C+r*D+s*F,n[1]=y*f+d*P+u*b+c*q,n[5]=y*S+d*I+u*E+c*A,n[9]=y*T+d*_+u*O+c*V,n[13]=y*w+d*C+u*D+c*F,n[2]=m*f+x*P+p*b+v*q,n[6]=m*S+x*I+p*E+v*A,n[10]=m*T+x*_+p*O+v*V,n[14]=m*w+x*C+p*D+v*F,n[3]=g*f+k*P+h*b+z*q,n[7]=g*S+k*I+h*E+z*A,n[11]=g*T+k*_+h*O+z*V,n[15]=g*w+k*C+h*D+z*F,this}},{key:\\\"multiply\\\",value:function(e){return this.multiplyMatrices(this,e)}},{key:\\\"premultiply\\\",value:function(e){return this.multiplyMatrices(e,this)}},{key:\\\"multiplyScalar\\\",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:\\\"determinant\\\",value:function(){var e=this.elements,t=e[0],n=e[4],a=e[8],i=e[12],l=e[1],o=e[5],r=e[9],s=e[13],y=e[2],d=e[6],u=e[10],c=e[14],m=e[3],x=e[7],p=e[11],v=e[15],g=t*o,k=t*r,h=t*s,z=n*l,f=n*r,S=n*s,T=a*l,w=a*o,P=a*s,I=i*l,_=i*o,C=i*r;return m*(C*d-P*d-_*u+S*u+w*c-f*c)+x*(k*c-h*u+I*u-T*c+P*y-C*y)+p*(h*d-g*c-I*d+z*c+_*y-S*y)+v*(-w*y-k*d+g*u+T*d-z*u+f*y)}},{key:\\\"getInverse\\\",value:function(e){var t=this.elements,n=e.elements,a=n[0],i=n[1],l=n[2],o=n[3],r=n[4],s=n[5],y=n[6],d=n[7],u=n[8],c=n[9],m=n[10],x=n[11],p=n[12],v=n[13],g=n[14],k=n[15],h=c*g*d-v*m*d+v*y*x-s*g*x-c*y*k+s*m*k,z=p*m*d-u*g*d-p*y*x+r*g*x+u*y*k-r*m*k,f=u*v*d-p*c*d+p*s*x-r*v*x-u*s*k+r*c*k,S=p*c*y-u*v*y-p*s*m+r*v*m+u*s*g-r*c*g,T=a*h+i*z+l*f+o*S,w=void 0;return 0==T?(console.error(\\\"Can't invert matrix, determinant is zero\\\",e),this.identity()):(w=1/T,t[0]=h*w,t[1]=(v*m*o-c*g*o-v*l*x+i*g*x+c*l*k-i*m*k)*w,t[2]=(s*g*o-v*y*o+v*l*d-i*g*d-s*l*k+i*y*k)*w,t[3]=(c*y*o-s*m*o-c*l*d+i*m*d+s*l*x-i*y*x)*w,t[4]=z*w,t[5]=(u*g*o-p*m*o+p*l*x-a*g*x-u*l*k+a*m*k)*w,t[6]=(p*y*o-r*g*o-p*l*d+a*g*d+r*l*k-a*y*k)*w,t[7]=(r*m*o-u*y*o+u*l*d-a*m*d-r*l*x+a*y*x)*w,t[8]=f*w,t[9]=(p*c*o-u*v*o-p*i*x+a*v*x+u*i*k-a*c*k)*w,t[10]=(r*v*o-p*s*o+p*i*d-a*v*d-r*i*k+a*s*k)*w,t[11]=(u*s*o-r*c*o-u*i*d+a*c*d+r*i*x-a*s*x)*w,t[12]=S*w,t[13]=(u*v*l-p*c*l+p*i*m-a*v*m-u*i*g+a*c*g)*w,t[14]=(p*s*l-r*v*l-p*i*y+a*v*y+r*i*g-a*s*g)*w,t[15]=(r*c*l-u*s*l+u*i*y-a*c*y-r*i*m+a*s*m)*w),this}},{key:\\\"transpose\\\",value:function(){var e=this.elements,n=void 0;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}},{key:\\\"scale\\\",value:function(e,t,n){var a=this.elements;return a[0]*=e,a[4]*=t,a[8]*=n,a[1]*=e,a[5]*=t,a[9]*=n,a[2]*=e,a[6]*=t,a[10]*=n,a[3]*=e,a[7]*=t,a[11]*=n,this}},{key:\\\"makeScale\\\",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:\\\"makeTranslation\\\",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:\\\"makeRotationX\\\",value:function(e){var t=ie(e),n=le(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:\\\"makeRotationY\\\",value:function(e){var t=ie(e),n=le(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:\\\"makeRotationZ\\\",value:function(e){var t=ie(e),n=le(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:\\\"makeRotationAxis\\\",value:function(e,n){var a=ie(n),i=le(n),l=1-a,t=e.x,o=e.y,r=e.z,s=l*t,y=l*o;return this.set(s*t+a,s*o-i*r,s*r+i*o,0,s*o+i*r,y*o+a,y*r-i*t,0,s*r-i*o,y*r+i*t,l*r*r+a,0,0,0,0,1),this}},{key:\\\"makeShear\\\",value:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}},{key:\\\"compose\\\",value:function(e,t,n){var a=this.elements,i=t.x,l=t.y,o=t.z,r=t.w,s=i+i,y=l+l,d=o+o,u=i*s,c=i*y,m=i*d,x=l*y,p=l*d,v=o*d,g=r*s,k=r*y,h=r*d,z=n.x,f=n.y,S=n.z;return a[0]=(1-(x+v))*z,a[1]=(c+h)*z,a[2]=(m-k)*z,a[3]=0,a[4]=(c-h)*f,a[5]=(1-(u+v))*f,a[6]=(p+g)*f,a[7]=0,a[8]=(m+k)*S,a[9]=(p-g)*S,a[10]=(1-(u+x))*S,a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1,this}},{key:\\\"decompose\\\",value:function(e,t,n){var a=this.elements,i=a[0],l=a[1],o=a[2],r=a[4],s=a[5],y=a[6],d=a[8],u=a[9],c=a[10],m=this.determinant(),x=Ae.set(i,l,o).length()*(0>m?-1:1),p=Ae.set(r,s,y).length(),v=Ae.set(d,u,c).length(),g=1/x,k=1/p,h=1/v;return e.x=a[12],e.y=a[13],e.z=a[14],a[0]*=g,a[1]*=g,a[2]*=g,a[4]*=k,a[5]*=k,a[6]*=k,a[8]*=h,a[9]*=h,a[10]*=h,t.setFromRotationMatrix(this),a[0]=i,a[1]=l,a[2]=o,a[4]=r,a[5]=s,a[6]=y,a[8]=d,a[9]=u,a[10]=c,n.x=x,n.y=p,n.z=v,this}},{key:\\\"makePerspective\\\",value:function(e,t,n,a,i,l){var o=this.elements;return o[0]=2*i/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*i/(n-a),o[9]=(n+a)/(n-a),o[13]=0,o[2]=0,o[6]=0,o[10]=-(l+i)/(l-i),o[14]=-2*l*i/(l-i),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:\\\"makeOrthographic\\\",value:function(e,t,n,a,i,l){var o=this.elements,r=1/(t-e),s=1/(n-a),y=1/(l-i);return o[0]=2*r,o[4]=0,o[8]=0,o[12]=-((t+e)*r),o[1]=0,o[5]=2*s,o[9]=0,o[13]=-((n+a)*s),o[2]=0,o[6]=0,o[10]=-2*y,o[14]=-((l+i)*y),o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:\\\"equals\\\",value:function(e){var t=this.elements,n=e.elements,a=!0,l=void 0;for(l=0;a&&16>l;++l)t[l]!==n[l]&&(a=!1);return a}}]),e}(),Be=[new xe,new xe,new xe,new xe],Ne=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe;oe(this,e),this.origin=t,this.direction=n}return re(e,[{key:\\\"set\\\",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:\\\"copy\\\",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"at\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe;return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:\\\"lookAt\\\",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:\\\"recast\\\",value:function(e){return this.origin.copy(this.at(e,Be[0])),this}},{key:\\\"closestPointToPoint\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe,n=t.subVectors(e,this.origin).dot(this.direction);return 0<=n?t.copy(this.direction).multiplyScalar(n).add(this.origin):t.copy(this.origin)}},{key:\\\"distanceSquaredToPoint\\\",value:function(e){var t=Be[0].subVectors(e,this.origin).dot(this.direction);return 0>t?this.origin.distanceToSquared(e):Be[0].copy(this.direction).multiplyScalar(t).add(this.origin).distanceToSquared(e)}},{key:\\\"distanceToPoint\\\",value:function(e){return ae(this.distanceSquaredToPoint(e))}},{key:\\\"distanceToPlane\\\",value:function(e){var n=e.normal.dot(this.direction),a=0===n?0===e.distanceToPoint(this.origin)?0:-1:-(this.origin.dot(e.normal)+e.constant)/n;return 0<=a?a:null}},{key:\\\"distanceSquaredToSegment\\\",value:function(e,t,n,a){var i=Be[0].copy(e).add(t).multiplyScalar(.5),l=Be[1].copy(t).sub(e).normalize(),o=Be[2].copy(this.origin).sub(i),r=.5*e.distanceTo(t),s=-this.direction.dot(l),y=o.dot(this.direction),d=-o.dot(l),u=o.lengthSq(),c=$(1-s*s),m=void 0,x=void 0,p=void 0,v=void 0,g=void 0;return 0<c?(m=s*d-y,x=s*y-d,p=r*c,0<=m?x>=-p?x<=p?(v=1/c,m*=v,x*=v,g=m*(m+s*x+2*y)+x*(s*m+x+2*d)+u):(x=r,m=ne(0,-(s*x+y)),g=-m*m+x*(x+2*d)+u):(x=-r,m=ne(0,-(s*x+y)),g=-m*m+x*(x+2*d)+u):x<=-p?(m=ne(0,-(-s*r+y)),x=0<m?-r:te(ne(-r,-d),r),g=-m*m+x*(x+2*d)+u):x<=p?(m=0,x=te(ne(-r,-d),r),g=x*(x+2*d)+u):(m=ne(0,-(s*r+y)),x=0<m?r:te(ne(-r,-d),r),g=-m*m+x*(x+2*d)+u)):(x=0<s?-r:r,m=ne(0,-(s*x+y)),g=-m*m+x*(x+2*d)+u),void 0!==n&&n.copy(this.direction).multiplyScalar(m).add(this.origin),void 0!==a&&a.copy(l).multiplyScalar(x).add(i),g}},{key:\\\"intersectSphere\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe,n=Be[0].subVectors(e.center,this.origin),a=n.dot(this.direction),i=n.dot(n)-a*a,l=e.radius*e.radius,o=null,r=void 0,s=void 0,y=void 0;return i<=l&&(r=ae(l-i),s=a-r,y=a+r,(0<=s||0<=y)&&(o=0>s?this.at(y,t):this.at(s,t))),o}},{key:\\\"intersectsSphere\\\",value:function(e){return this.distanceToPoint(e.center)<=e.radius}},{key:\\\"intersectPlane\\\",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe,a=this.distanceToPlane(e);return null===a?null:this.at(a,n)}},{key:\\\"intersectsPlane\\\",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t}},{key:\\\"intersectBox\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe,n=this.origin,a=this.direction,i=e.min,l=e.max,o=1/a.x,r=1/a.y,s=1/a.z,y=null,d=void 0,u=void 0,c=void 0,m=void 0,x=void 0,p=void 0;return 0<=o?(d=(i.x-n.x)*o,u=(l.x-n.x)*o):(d=(l.x-n.x)*o,u=(i.x-n.x)*o),0<=r?(c=(i.y-n.y)*r,m=(l.y-n.y)*r):(c=(l.y-n.y)*r,m=(i.y-n.y)*r),d<=m&&c<=u&&((c>d||d!=d)&&(d=c),(m<u||u!=u)&&(u=m),0<=s?(x=(i.z-n.z)*s,p=(l.z-n.z)*s):(x=(l.z-n.z)*s,p=(i.z-n.z)*s),d<=p&&x<=u&&((x>d||d!=d)&&(d=x),(p<u||u!=u)&&(u=p),0<=u&&(y=this.at(0<=d?d:u,t)))),y}},{key:\\\"intersectsBox\\\",value:function(e){return null!==this.intersectBox(e,Be[0])}},{key:\\\"intersectTriangle\\\",value:function(e,t,n,a,i){var l=this.direction,o=Be[0],r=Be[1],s=Be[2],y=Be[3],d=null,u=void 0,c=void 0,m=void 0,x=void 0,p=void 0;return r.subVectors(t,e),s.subVectors(n,e),y.crossVectors(r,s),u=l.dot(y),0===u||a&&0<u||(0<u?c=1:(c=-1,u=-u),o.subVectors(this.origin,e),m=c*l.dot(s.crossVectors(o,s)),0<=m&&(x=c*l.dot(r.cross(o)),0<=x&&m+x<=u&&(p=-c*o.dot(y),0<=p&&(d=this.at(p/u,i))))),d}},{key:\\\"applyMatrix4\\\",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:\\\"equals\\\",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),e}(),Le=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;oe(this,e),this.radius=t,this.phi=n,this.theta=a}return re(e,[{key:\\\"set\\\",value:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}},{key:\\\"copy\\\",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"setFromVector3\\\",value:function(e){return this.radius=e.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=H(e.x,e.z),this.phi=ee(te(ne(e.y/this.radius,-1),1))),this.makeSafe()}},{key:\\\"makeSafe\\\",value:function(){return this.phi=ne(1e-6,te(G-1e-6,this.phi)),this}}]),e}(),Re=function(){function e(){oe(this,e),this.elements=new Float32Array([1,0,0,1,0,1])}return re(e,[{key:\\\"set\\\",value:function(t,n,a,i,l,o){var r=this.elements;return r[0]=t,r[1]=n,r[3]=i,r[2]=a,r[4]=l,r[5]=o,this}},{key:\\\"identity\\\",value:function(){return this.set(1,0,0,1,0,1),this}},{key:\\\"copy\\\",value:function(e){var t=e.elements;return this.set(t[0],t[1],t[2],t[3],t[4],t[5]),this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"toMatrix3\\\",value:function(e){var t=e.elements;e.set(t[0],t[1],t[2],t[1],t[3],t[4],t[2],t[4],t[5])}},{key:\\\"add\\\",value:function(e){var t=this.elements,n=e.elements;return t[0]+=n[0],t[1]+=n[1],t[3]+=n[3],t[2]+=n[2],t[4]+=n[4],t[5]+=n[5],this}},{key:\\\"norm\\\",value:function(){var t=this.elements,e=t[1]*t[1],n=t[2]*t[2],a=t[4]*t[4];return ae(t[0]*t[0]+e+n+e+t[3]*t[3]+a+n+a+t[5]*t[5])}},{key:\\\"off\\\",value:function(){var t=this.elements;return ae(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:\\\"applyToVector3\\\",value:function(t){var n=t.x,a=t.y,i=t.z,l=this.elements;return t.x=l[0]*n+l[1]*a+l[2]*i,t.y=l[1]*n+l[3]*a+l[4]*i,t.z=l[2]*n+l[4]*a+l[5]*i,t}},{key:\\\"equals\\\",value:function(e){var t=this.elements,n=e.elements,a=!0,l=void 0;for(l=0;a&&6>l;++l)t[l]!==n[l]&&(a=!1);return a}}],[{key:\\\"calculateIndex\\\",value:function(e,t){return 3-(3-e)*(2-e)/2+t}}]),e}(),Ye=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;oe(this,e),this.x=t,this.y=n,this.z=a,this.w=i}return re(e,[{key:\\\"set\\\",value:function(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.w=a,this}},{key:\\\"copy\\\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:\\\"clone\\\",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:\\\"fromArray\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:\\\"toArray\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:\\\"setAxisAngleFromQuaternion\\\",value:function(e){this.w=2*ee(e.w);var t=ae(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:\\\"setAxisAngleFromRotationMatrix\\\",value:function(e){var t=.01,n=.1,a=e.elements,i=a[0],l=a[4],o=a[8],r=a[1],d=a[5],u=a[9],c=a[2],m=a[6],p=a[10],v=void 0,g=void 0,k=void 0,h=void 0,f=void 0,S=void 0,T=void 0,w=void 0,P=void 0,I=void 0,_=void 0;return $(l-r)<t&&$(o-c)<t&&$(u-m)<t?$(l+r)<n&&$(o+c)<n&&$(u+m)<n&&$(i+d+p-3)<n?this.set(1,0,0,0):(v=G,f=(i+1)/2,S=(d+1)/2,T=(p+1)/2,w=(l+r)/4,P=(o+c)/4,I=(u+m)/4,f>S&&f>T?f<t?(g=0,k=.707106781,h=.707106781):(g=ae(f),k=w/g,h=P/g):S>T?S<t?(g=.707106781,k=0,h=.707106781):(k=ae(S),g=w/k,h=I/k):T<t?(g=.707106781,k=.707106781,h=0):(h=ae(T),g=P/h,k=I/h),this.set(g,k,h,v)):(_=ae((m-u)*(m-u)+(o-c)*(o-c)+(r-l)*(r-l)),.001>$(_)&&(_=1),this.x=(m-u)/_,this.y=(o-c)/_,this.z=(r-l)/_,this.w=ee((i+d+p-1)/2)),this}},{key:\\\"add\\\",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:\\\"addScalar\\\",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:\\\"addVectors\\\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:\\\"addScaledVector\\\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:\\\"sub\\\",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:\\\"subScalar\\\",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:\\\"subVectors\\\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:\\\"multiply\\\",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:\\\"multiplyScalar\\\",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:\\\"multiplyVectors\\\",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this.w=e.w*t.w,this}},{key:\\\"divide\\\",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}},{key:\\\"divideScalar\\\",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this}},{key:\\\"applyMatrix4\\\",value:function(t){var n=this.x,a=this.y,i=this.z,l=this.w,o=t.elements;return this.x=o[0]*n+o[4]*a+o[8]*i+o[12]*l,this.y=o[1]*n+o[5]*a+o[9]*i+o[13]*l,this.z=o[2]*n+o[6]*a+o[10]*i+o[14]*l,this.w=o[3]*n+o[7]*a+o[11]*i+o[15]*l,this}},{key:\\\"negate\\\",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:\\\"dot\\\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:\\\"manhattanLength\\\",value:function(){return $(this.x)+$(this.y)+$(this.z)+$(this.w)}},{key:\\\"lengthSquared\\\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:\\\"length\\\",value:function(){return ae(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:\\\"manhattanDistanceTo\\\",value:function(e){return $(this.x-e.x)+$(this.y-e.y)+$(this.z-e.z)+$(this.w-e.w)}},{key:\\\"distanceToSquared\\\",value:function(e){var t=this.x-e.x,n=this.y-e.y,a=this.z-e.z,i=this.w-e.w;return t*t+n*n+a*a+i*i}},{key:\\\"distanceTo\\\",value:function(e){return ae(this.distanceToSquared(e))}},{key:\\\"normalize\\\",value:function(){return this.divideScalar(this.length())}},{key:\\\"setLength\\\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\\\"min\\\",value:function(e){return this.x=te(this.x,e.x),this.y=te(this.y,e.y),this.z=te(this.z,e.z),this.w=te(this.w,e.w),this}},{key:\\\"max\\\",value:function(e){return this.x=ne(this.x,e.x),this.y=ne(this.y,e.y),this.z=ne(this.z,e.z),this.w=ne(this.w,e.w),this}},{key:\\\"clamp\\\",value:function(e,t){return this.x=ne(e.x,te(t.x,this.x)),this.y=ne(e.y,te(t.y,this.y)),this.z=ne(e.z,te(t.z,this.z)),this.w=ne(e.w,te(t.w,this.w)),this}},{key:\\\"floor\\\",value:function(){return this.x=W(this.x),this.y=W(this.y),this.z=W(this.z),this.w=W(this.w),this}},{key:\\\"ceil\\\",value:function(){return this.x=K(this.x),this.y=K(this.y),this.z=K(this.z),this.w=K(this.w),this}},{key:\\\"round\\\",value:function(){return this.x=J(this.x),this.y=J(this.y),this.z=J(this.z),this.w=J(this.w),this}},{key:\\\"lerp\\\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:\\\"lerpVectors\\\",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:\\\"equals\\\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}]),e}(),Me=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];oe(this,e),this.value=t,this.done=n}return re(e,[{key:\\\"reset\\\",value:function(){this.value=null,this.done=!1}}]),e}(),Xe=new xe,Ze=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe;oe(this,e),this.min=t,this.max=n,this.children=null}return re(e,[{key:\\\"getCenter\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\\\"getDimensions\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return e.subVectors(this.max,this.min)}},{key:\\\"split\\\",value:function(){var e=this.min,t=this.max,n=this.getCenter(Xe),a=this.children=[null,null,null,null,null,null,null,null],l=void 0,o=void 0;for(l=0;8>l;++l)o=je[l],a[l]=new this.constructor(new xe(0===o[0]?e.x:n.x,0===o[1]?e.y:n.y,0===o[2]?e.z:n.z),new xe(0===o[0]?n.x:t.x,0===o[1]?n.y:t.y,0===o[2]?n.z:t.z))}}]),e}(),je=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],Ue=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],Qe=new xe,Ge=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;oe(this,e),this.min=t,this.size=n,this.children=null}return re(e,[{key:\\\"getCenter\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return e.copy(this.min).addScalar(.5*this.size)}},{key:\\\"getDimensions\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return e.set(this.size,this.size,this.size)}},{key:\\\"split\\\",value:function(){var e=this.min,t=this.getCenter(Qe),n=.5*this.size,a=this.children=[null,null,null,null,null,null,null,null],l=void 0,o=void 0;for(l=0;8>l;++l)o=je[l],a[l]=new this.constructor(new xe(0===o[0]?e.x:t.x,0===o[1]?e.y:t.y,0===o[2]?e.z:t.z),n)}},{key:\\\"max\\\",get:function(){return this.min.clone().addScalar(this.size)}}]),e}(),He=new v,Je=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;oe(this,e),this.octree=t,this.region=n,this.cull=null!==n,this.result=new Me,this.trace=null,this.indices=null,this.reset()}return re(e,[{key:\\\"reset\\\",value:function(){var e=this.octree.root;return this.trace=[],this.indices=[],null!==e&&(He.min=e.min,He.max=e.max,(!this.cull||this.region.intersectsBox(He))&&(this.trace.push(e),this.indices.push(0))),this.result.reset(),this}},{key:\\\"next\\\",value:function(){for(var e=this.cull,t=this.region,n=this.indices,a=this.trace,i=null,l=a.length-1,o=void 0,r=void 0,s=void 0;null===i&&0<=l;)if(o=n[l]++,r=a[l].children,!(8>o))a.pop(),n.pop(),--l;else if(null!==r){if(s=r[o],e&&(He.min=s.min,He.max=s.max,!t.intersectsBox(He)))continue;a.push(s),n.push(0),++l}else i=a.pop(),n.pop();return this.result.value=i,this.result.done=null===i,this.result}},{key:\\\"return\\\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),Ke=[new xe,new xe,new xe],We=new v,$e=new Ne,r=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],et=0,tt=function(){function e(){oe(this,e)}return re(e,null,[{key:\\\"intersectOctree\\\",value:function(e,t,n){var a=We.min.set(0,0,0),l=We.max.subVectors(e.max,e.min),o=e.getDimensions(Ke[0]),r=Ke[1].copy(o).multiplyScalar(.5),s=$e.origin.copy(t.ray.origin),y=$e.direction.copy(t.ray.direction),d=void 0,u=void 0,c=void 0,m=void 0,x=void 0,p=void 0,v=void 0,g=void 0,k=void 0;s.sub(e.getCenter(Ke[2])).add(r),et=0,0>y.x&&(s.x=o.x-s.x,y.x=-y.x,et|=4),0>y.y&&(s.y=o.y-s.y,y.y=-y.y,et|=2),0>y.z&&(s.z=o.z-s.z,y.z=-y.z,et|=1),d=1/y.x,u=1/y.y,c=1/y.z,m=(a.x-s.x)*d,x=(l.x-s.x)*d,p=(a.y-s.y)*u,v=(l.y-s.y)*u,g=(a.z-s.z)*c,k=(l.z-s.z)*c,ne(ne(m,p),g)<te(te(x,v),k)&&i(e.root,m,p,g,x,v,k,t,n)}}]),e}(),nt=new v,at=function(){function e(t,n){oe(this,e),this.root=void 0!==t&&void 0!==n?new Ze(t,n):null}return re(e,[{key:\\\"getCenter\\\",value:function(e){return this.root.getCenter(e)}},{key:\\\"getDimensions\\\",value:function(e){return this.root.getDimensions(e)}},{key:\\\"getDepth\\\",value:function(){return o(this.root)}},{key:\\\"cull\\\",value:function(e){var t=[];return s(this.root,e,t),t}},{key:\\\"findOctantsByLevel\\\",value:function(e){var t=[];return y(this.root,e,0,t),t}},{key:\\\"raycast\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return tt.intersectOctree(this,e,t),t}},{key:\\\"leaves\\\",value:function(e){return new Je(this,e)}},{key:Symbol.iterator,value:function(){return new Je(this)}},{key:\\\"min\\\",get:function(){return this.root.min}},{key:\\\"max\\\",get:function(){return this.root.max}},{key:\\\"children\\\",get:function(){return this.root.children}}]),e}(),it=new xe,p=function(e){function t(e,n){oe(this,t);var a=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return a.points=null,a.data=null,a}return ye(t,e),re(t,[{key:\\\"distanceToSquared\\\",value:function(e){var t=it.copy(e).clamp(this.min,this.max);return t.sub(e).lengthSquared()}},{key:\\\"distanceToCenterSquared\\\",value:function(e){var t=this.getCenter(it),n=e.x-t.x,a=e.y-t.x,i=e.z-t.z;return n*n+a*a+i*i}},{key:\\\"contains\\\",value:function(e,t){var n=this.min,a=this.max;return e.x>=n.x-t&&e.y>=n.y-t&&e.z>=n.z-t&&e.x<=a.x+t&&e.y<=a.y+t&&e.z<=a.z+t}},{key:\\\"redistribute\\\",value:function(e){var t=this.children,n=this.points,a=this.data,l=void 0,o=void 0,r=void 0,s=void 0,y=void 0,d=void 0,u=void 0;if(null!==t&&null!==n)for(l=0,r=n.length;l<r;++l)for(d=n[l],u=a[l],(o=0,s=t.length);o<s;++o)if(y=t[o],y.contains(d,e)){null===y.points&&(y.points=[],y.data=[]),y.points.push(d),y.data.push(u);break}this.points=null,this.data=null}},{key:\\\"merge\\\",value:function(){var e=this.children,t=void 0,n=void 0,a=void 0;if(null!==e){for(this.points=[],this.data=[],(t=0,n=e.length);t<n;++t)if(a=e[t],null!==a.points){var o,r;(o=this.points).push.apply(o,ce(a.points)),(r=this.data).push.apply(r,ce(a.data))}this.children=null}}}]),t}(Ze),lt=function e(t,n,a){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;oe(this,e),this.distance=t,this.distanceToRay=n,this.point=a,this.object=i},ot=1e-6,rt=function(e){function t(e,n){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,l=4<arguments.length&&void 0!==arguments[4]?arguments[4]:8;oe(this,t);var o=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.root=new p(e,n),o.bias=ne(0,a),o.maxPoints=ne(1,J(i)),o.maxDepth=ne(0,J(l)),o.pointCount=0,o}return ye(t,e),re(t,[{key:\\\"countPoints\\\",value:function(e){return d(e)}},{key:\\\"put\\\",value:function(e,t){return x(e,t,this,this.root,0)}},{key:\\\"remove\\\",value:function(e){return g(e,this,this.root,null)}},{key:\\\"fetch\\\",value:function(e){return k(e,this,this.root)}},{key:\\\"move\\\",value:function(e,t){return h(e,t,this,this.root,null,0)}},{key:\\\"findNearestPoint\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0,n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];return z(e,t,n,this.root)}},{key:\\\"findPoints\\\",value:function(e,t){var n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],a=[];return f(e,t,n,this.root,a),a}},{key:\\\"raycast\\\",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],a=se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\\\"raycast\\\",this).call(this,e);return 0<a.length&&this.testPoints(a,e,n),n}},{key:\\\"testPoints\\\",value:function(e,t,n){var a=t.params.Points.threshold,l=void 0,o=void 0,r=void 0,s=void 0,y=void 0,d=void 0,u=void 0,c=void 0,m=void 0,x=void 0,p=void 0;for(y=0,u=e.length;y<u;++y)if(m=e[y],x=m.points,null!==x)for(d=0,c=x.length;d<c;++d)p=x[d],s=t.ray.distanceSqToPoint(p),s<a*a&&(l=t.ray.closestPointToPoint(p,new xe),o=t.ray.origin.distanceTo(l),o>=t.near&&o<=t.far&&(r=ae(s),n.push(new lt(o,r,l,m.data[d]))))}}]),t}(at),st=new v,yt=new xe,dt=new xe,u=new xe,ut=function(){function e(){oe(this,e)}return re(e,null,[{key:\\\"recycleOctants\\\",value:function(e,t){var n=e.min,a=e.getCenter(dt),o=e.getDimensions(u).multiplyScalar(.5),r=e.children,s=t.length,l=void 0,y=void 0,d=void 0,c=void 0;for(l=0;8>l;++l)for(d=je[l],st.min.addVectors(n,yt.fromArray(d).multiply(o)),st.max.addVectors(a,yt.fromArray(d).multiply(o)),y=0;y<s;++y)if(c=t[y],null!==c&&st.min.equals(c.min)&&st.max.equals(c.max)){r[l]=c,t[y]=null;break}}}]),e}(),ct=new xe,mt=new xe,xt=new xe,pt=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe;oe(this,e),this.a=t,this.b=n,this.index=-1,this.coordinates=new xe,this.t=0,this.n=new xe}return re(e,[{key:\\\"approximateZeroCrossing\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,n=ne(1,t-1),l=0,o=1,r=0,s=0,y=void 0,d=void 0;for(ct.subVectors(this.b,this.a);s<=n&&(r=(l+o)/2,mt.addVectors(this.a,xt.copy(ct).multiplyScalar(r)),d=e.sample(mt),!(1e-4>=$(d)||1e-6>=(o-l)/2));)mt.addVectors(this.a,xt.copy(ct).multiplyScalar(l)),y=e.sample(mt),Q(d)===Q(y)?l=r:o=r,++s;this.t=r}},{key:\\\"computeZeroCrossingPosition\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return e.subVectors(this.b,this.a).multiplyScalar(this.t).add(this.a)}},{key:\\\"computeSurfaceNormal\\\",value:function(e){var t=this.computeZeroCrossingPosition(ct),n=1e-3,a=e.sample(mt.addVectors(t,xt.set(n,0,0)))-e.sample(mt.subVectors(t,xt.set(n,0,0))),i=e.sample(mt.addVectors(t,xt.set(0,n,0)))-e.sample(mt.subVectors(t,xt.set(0,n,0))),l=e.sample(mt.addVectors(t,xt.set(0,0,n)))-e.sample(mt.subVectors(t,xt.set(0,0,n)));this.n.set(a,i,l).normalize()}}]),e}(),vt=new pt,gt=new xe,kt=new xe,ht=function(){function e(t,n,a){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,l=4<arguments.length&&void 0!==arguments[4]?arguments[4]:3;oe(this,e),this.edgeData=t,this.cellPosition=n,this.cellSize=a,this.indices=null,this.zeroCrossings=null,this.normals=null,this.axes=null,this.lengths=null,this.result=new Me,this.initialC=i,this.c=i,this.initialD=l,this.d=l,this.i=0,this.l=0,this.reset()}return re(e,[{key:\\\"reset\\\",value:function(){var e=this.edgeData,t=[],n=[],i=[],o=[],r=[],s=void 0,y=void 0,u=void 0,m=void 0;for(this.i=0,this.c=0,this.d=0,(y=this.initialC,s=4>>y,u=this.initialD);y<u;++y,s>>=1)m=e.indices[y].length,0<m&&(t.push(e.indices[y]),n.push(e.zeroCrossings[y]),i.push(e.normals[y]),o.push(je[s]),r.push(m),++this.d);return this.l=0<r.length?r[0]:0,this.indices=t,this.zeroCrossings=n,this.normals=i,this.axes=o,this.lengths=r,this.result.reset(),this}},{key:\\\"next\\\",value:function(){var e=this.cellSize,t=this.edgeData.resolution,n=t+1,a=n*n,l=this.result,o=this.cellPosition,r=void 0,s=void 0,d=void 0,u=void 0,m=void 0,p=void 0,v=void 0;return this.i===this.l&&(this.l=++this.c<this.d?this.lengths[this.c]:0,this.i=0),this.i<this.l?(p=this.c,v=this.i,r=this.axes[p],s=this.indices[p][v],vt.index=s,d=s%n,u=U(s%a/n),m=U(s/a),vt.coordinates.set(d,u,m),gt.set(d*e/t,u*e/t,m*e/t),kt.set((d+r[0])*e/t,(u+r[1])*e/t,(m+r[2])*e/t),vt.a.addVectors(o,gt),vt.b.addVectors(o,kt),vt.t=this.zeroCrossings[p][v],vt.n.fromArray(this.normals[p],3*v),l.value=vt,++this.i):(l.value=null,l.done=!0),l}},{key:\\\"return\\\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),zt=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:n;oe(this,e),this.resolution=t,this.indices=0>=n?null:[new Uint32Array(n),new Uint32Array(a),new Uint32Array(i)],this.zeroCrossings=0>=n?null:[new Float32Array(n),new Float32Array(a),new Float32Array(i)],this.normals=0>=n?null:[new Float32Array(3*n),new Float32Array(3*a),new Float32Array(3*i)]}return re(e,[{key:\\\"serialize\\\",value:function(){return{resolution:this.resolution,edges:this.edges,zeroCrossings:this.zeroCrossings,normals:this.normals}}},{key:\\\"deserialize\\\",value:function(e){var t=this;return null===e?t=null:(this.resolution=e.resolution,this.edges=e.edges,this.zeroCrossings=e.zeroCrossings,this.normals=e.normals),t}},{key:\\\"createTransferList\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=[this.edges[0],this.edges[1],this.edges[2],this.zeroCrossings[0],this.zeroCrossings[1],this.zeroCrossings[2],this.normals[0],this.normals[1],this.normals[2]],n=void 0,a=void 0,o=void 0;for(a=0,o=t.length;a<o;++a)n=t[a],null!==n&&e.push(n.buffer);return e}},{key:\\\"edges\\\",value:function(e,t){return new ht(this,e,t)}},{key:\\\"edgesX\\\",value:function(e,t){return new ht(this,e,t,0,1)}},{key:\\\"edgesY\\\",value:function(e,t){return new ht(this,e,t,1,2)}},{key:\\\"edgesZ\\\",value:function(e,t){return new ht(this,e,t,2,3)}}],[{key:\\\"calculate1DEdgeCount\\\",value:function(e){return j(e+1,2)*e}}]),e}(),ft={AIR:0,SOLID:1},St=0,Tt=0,wt=0,Pt=function(){function e(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];oe(this,e),this.materials=0,this.materialIndices=t?new Uint8Array(wt):null,this.runLengths=null,this.edgeData=null}return re(e,[{key:\\\"set\\\",value:function(e){return this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,this.edgeData=e.edgeData,this}},{key:\\\"clear\\\",value:function(){return this.materials=0,this.materialIndices=null,this.runLengths=null,this.edgeData=null,this}},{key:\\\"setMaterialIndex\\\",value:function(e,t){this.materialIndices[e]===ft.AIR?t!==ft.AIR&&++this.materials:t===ft.AIR&&--this.materials,this.materialIndices[e]=t}},{key:\\\"compress\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this,t=void 0;return this.compressed?(e.materialIndices=this.materialIndices,e.runLengths=this.runLengths):(t=this.full?new me([this.materialIndices.length],[ft.SOLID]):me.encode(this.materialIndices),e.materialIndices=new Uint8Array(t.data),e.runLengths=new Uint32Array(t.runLengths)),e.materials=this.materials,e}},{key:\\\"decompress\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this;return e.materialIndices=this.compressed?me.decode(this.runLengths,this.materialIndices,new Uint8Array(wt)):this.materialIndices,e.runLengths=null,e.materials=this.materials,e}},{key:\\\"serialize\\\",value:function(){return{materials:this.materials,materialIndices:this.materialIndices,runLengths:this.runLengths,edgeData:null===this.edgeData?null:this.edgeData.serialize()}}},{key:\\\"deserialize\\\",value:function(e){var t=this;return null===e?t=null:(this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,null===e.edgeData?this.edgeData=null:(null===this.edgeData&&(this.edgeData=new zt(Tt)),this.edgeData.deserialize(e.edgeData))),t}},{key:\\\"createTransferList\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.edgeData&&this.edgeData.createTransferList(e),null!==this.materialIndices&&e.push(this.materialIndices.buffer),null!==this.runLengths&&e.push(this.runLengths.buffer),e}},{key:\\\"empty\\\",get:function(){return 0===this.materials}},{key:\\\"full\\\",get:function(){return this.materials===wt}},{key:\\\"compressed\\\",get:function(){return null!==this.runLengths}},{key:\\\"neutered\\\",get:function(){return!this.empty&&null===this.materialIndices}}],[{key:\\\"isovalue\\\",get:function(){return St},set:function(e){St=e}},{key:\\\"resolution\\\",get:function(){return Tt},set:function(e){e=j(2,ne(0,K(Math.log2(e)))),Tt=ne(1,te(256,e)),wt=j(Tt+1,3)}}]),e}(),It=function(){function e(){oe(this,e),this.ata=new Re,this.ata.set(0,0,0,0,0,0),this.atb=new xe,this.massPointSum=new xe,this.numPoints=0}return re(e,[{key:\\\"set\\\",value:function(e,t,n,a){return this.ata.copy(e),this.atb.copy(t),this.massPointSum.copy(n),this.numPoints=a,this}},{key:\\\"copy\\\",value:function(e){return this.set(e.ata,e.atb,e.massPointSum,e.numPoints)}},{key:\\\"add\\\",value:function(e,t){var n=t.x,a=t.y,i=t.z,l=e.dot(t),o=this.ata.elements,r=this.atb;o[0]+=n*n,o[1]+=n*a,o[3]+=a*a,o[2]+=n*i,o[4]+=a*i,o[5]+=i*i,r.x+=l*n,r.y+=l*a,r.z+=l*i,this.massPointSum.add(e),++this.numPoints}},{key:\\\"addData\\\",value:function(e){this.ata.add(e.ata),this.atb.add(e.atb),this.massPointSum.add(e.massPointSum),this.numPoints+=e.numPoints}},{key:\\\"clear\\\",value:function(){this.ata.set(0,0,0,0,0,0),this.atb.set(0,0,0),this.massPointSum.set(0,0,0),this.numPoints=0}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}}]),e}(),_t=new he,Ct=function(){function e(){oe(this,e)}return re(e,null,[{key:\\\"calculateCoefficients\\\",value:function(e,t,n){var a,i,l;return 0===t?(_t.x=1,_t.y=0):(a=(n-e)/(2*t),i=ae(1+a*a),l=1/(0<=a?a+i:a-i),_t.x=1/ae(1+l*l),_t.y=l*_t.x),_t}}]),e}(),bt=function(){function e(){oe(this,e)}return re(e,null,[{key:\\\"rotateXY\\\",value:function(e,t){var n=t.x,a=t.y,i=e.x,l=e.y;e.set(n*i-a*l,a*i+n*l)}},{key:\\\"rotateQXY\\\",value:function(e,t,n){var a=n.x,i=n.y,l=a*a,o=i*i,r=2*a*i*t,s=e.x,y=e.y;e.set(l*s-r+o*y,o*s+r+l*y)}}]),e}(),Et=.1,Ot=new Re,Dt=new Te,qt=new he,At=new xe,Vt=function(){function e(){oe(this,e)}return re(e,null,[{key:\\\"solve\\\",value:function(e,t,n){var a=w(Ot.copy(e),Dt.identity()),i=I(Dt,a);n.copy(t).applyMatrix3(i)}}]),e}(),Ft=new xe,Bt=function(){function e(){oe(this,e),this.data=null,this.ata=new Re,this.atb=new xe,this.massPoint=new xe,this.hasSolution=!1}return re(e,[{key:\\\"setData\\\",value:function(e){return this.data=e,this.hasSolution=!1,this}},{key:\\\"solve\\\",value:function(e){var t=this.data,n=this.massPoint,a=this.ata.copy(t.ata),i=this.atb.copy(t.atb),l=1/0;return!this.hasSolution&&null!==t&&0<t.numPoints&&(Ft.copy(t.massPointSum).divideScalar(t.numPoints),n.copy(Ft),a.applyToVector3(Ft),i.sub(Ft),Vt.solve(a,i,e),l=_(a,i,e),e.add(n),this.hasSolution=!0),l}}]),e}(),Nt=function e(){oe(this,e),this.materials=0,this.edgeCount=0,this.index=-1,this.position=new xe,this.normal=new xe,this.qefData=null},Lt=new Bt,Rt=.1,Yt=-1,Mt=function(e){function t(e,n){oe(this,t);var a=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return a.voxel=null,a}return ye(t,e),re(t,[{key:\\\"contains\\\",value:function(e){var t=this.min,n=this.size;return e.x>=t.x-Rt&&e.y>=t.y-Rt&&e.z>=t.z-Rt&&e.x<=t.x+n+Rt&&e.y<=t.y+n+Rt&&e.z<=t.z+n+Rt}},{key:\\\"collapse\\\",value:function(){var e=this.children,t=[-1,-1,-1,-1,-1,-1,-1,-1],n=new xe,a=-1,l=null!==e,o=0,r=void 0,s=void 0,y=void 0,d=void 0,u=void 0,c=void 0,m=void 0;if(l){for(d=new It,c=0,m=0;8>m;++m)r=e[m],o+=r.collapse(),y=r.voxel,null===r.children?null!==y&&(d.addData(y.qefData),a=1&y.materials>>7-m,t[m]=1&y.materials>>m,++c):l=!1;if(l&&(u=Lt.setData(d).solve(n),u<=Yt)){for(y=new Nt,y.position.copy(this.contains(n)?n:Lt.massPoint),m=0;8>m;++m)s=t[m],r=e[m],-1===s?y.materials|=a<<m:(y.materials|=s<<m,y.normal.add(r.voxel.normal));y.normal.normalize(),y.qefData=d,this.voxel=y,this.children=null,o+=c-1}}return o}}],[{key:\\\"errorThreshold\\\",get:function(){return Yt},set:function(e){Yt=e}}]),t}(Ge),Xt=function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;oe(this,e),this.action=t,this.error=null},Zt=function(){function e(t,n,a,i,l){oe(this,e),this.indices=t,this.positions=n,this.normals=a,this.uvs=i,this.materials=l}return re(e,[{key:\\\"serialize\\\",value:function(){return{indices:this.indices,positions:this.positions,normals:this.normals,uvs:this.uvs,materials:this.materials}}},{key:\\\"deserialize\\\",value:function(e){var t=this;return null===e?t=null:(this.indices=e.indices,this.positions=e.positions,this.normals=e.normals,this.uvs=e.uvs,this.materials=e.materials),t}},{key:\\\"createTransferList\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.indices.buffer),e.push(this.positions.buffer),e.push(this.normals.buffer),e.push(this.uvs.buffer),e.push(this.materials.buffer),e}}]),e}(),jt=[new Uint8Array([0,4,0]),new Uint8Array([1,5,0]),new Uint8Array([2,6,0]),new Uint8Array([3,7,0]),new Uint8Array([0,2,1]),new Uint8Array([4,6,1]),new Uint8Array([1,3,1]),new Uint8Array([5,7,1]),new Uint8Array([0,1,2]),new Uint8Array([2,3,2]),new Uint8Array([4,5,2]),new Uint8Array([6,7,2])],Ut=[new Uint8Array([0,1,2,3,0]),new Uint8Array([4,5,6,7,0]),new Uint8Array([0,4,1,5,1]),new Uint8Array([2,6,3,7,1]),new Uint8Array([0,2,4,6,2]),new Uint8Array([1,3,5,7,2])],Qt=[[new Uint8Array([4,0,0]),new Uint8Array([5,1,0]),new Uint8Array([6,2,0]),new Uint8Array([7,3,0])],[new Uint8Array([2,0,1]),new Uint8Array([6,4,1]),new Uint8Array([3,1,1]),new Uint8Array([7,5,1])],[new Uint8Array([1,0,2]),new Uint8Array([3,2,2]),new Uint8Array([5,4,2]),new Uint8Array([7,6,2])]],Gt=[[new Uint8Array([1,4,0,5,1,1]),new Uint8Array([1,6,2,7,3,1]),new Uint8Array([0,4,6,0,2,2]),new Uint8Array([0,5,7,1,3,2])],[new Uint8Array([0,2,3,0,1,0]),new Uint8Array([0,6,7,4,5,0]),new Uint8Array([1,2,0,6,4,2]),new Uint8Array([1,3,1,7,5,2])],[new Uint8Array([1,1,0,3,2,0]),new Uint8Array([1,5,4,7,6,0]),new Uint8Array([0,1,5,0,4,1]),new Uint8Array([0,3,7,2,6,1])]],Ht=[[new Uint8Array([3,2,1,0,0]),new Uint8Array([7,6,5,4,0])],[new Uint8Array([5,1,4,0,1]),new Uint8Array([7,3,6,2,1])],[new Uint8Array([6,4,2,0,2]),new Uint8Array([7,5,3,1,2])]],Jt=[new Uint8Array([3,2,1,0]),new Uint8Array([7,5,6,4]),new Uint8Array([11,10,9,8])],Kt=function(){function e(){oe(this,e)}return re(e,null,[{key:\\\"run\\\",value:function(e){var t=[],n=e.voxelCount,a=null,i=null,l=null,o=null,r=null;return 65535<n?console.warn(\\\"Could not create geometry for cell at position\\\",e.min,\\\"(vertex count of\\\",n,\\\"exceeds limit of \\\",65535,\\\")\\\"):0<n&&(i=new Float32Array(3*n),l=new Float32Array(3*n),o=new Float32Array(2*n),r=new Uint8Array(n),A(e.root,i,l,0),D(e.root,t),a=new Zt(new Uint16Array(t),i,l,o,r)),a}}]),e}(),Wt=function(e){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;oe(this,t);var i=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.root=new Mt(n,a),i.voxelCount=0,null!==e&&null!==e.edgeData&&i.construct(e),0<=Mt.errorThreshold&&i.simplify(),i}return ye(t,e),re(t,[{key:\\\"simplify\\\",value:function(){this.voxelCount-=this.root.collapse()}},{key:\\\"construct\\\",value:function(e){var t=Pt.resolution,n=e.edgeData,a=e.materialIndices,l=new Bt,o=new xe,r=[n.edgesX(this.min,this.root.size),n.edgesY(this.min,this.root.size),n.edgesZ(this.min,this.root.size)],s=[new Uint8Array([0,1,2,3]),new Uint8Array([0,1,4,5]),new Uint8Array([0,2,4,6])],u=0,c=void 0,m=void 0,p=void 0,v=void 0,g=void 0,k=void 0,h=void 0,f=void 0,S=void 0,T=void 0,w=void 0;for(T=0;3>T;++T){p=s[T],c=r[T];var P=!0,I=!1,_=void 0;try{for(var C,b=c[Symbol.iterator]();!(P=(C=b.next()).done);P=!0)for(m=C.value,m.computeZeroCrossingPosition(o),w=0;4>w;++w)v=je[p[w]],h=m.coordinates.x-v[0],f=m.coordinates.y-v[1],S=m.coordinates.z-v[2],0<=h&&0<=f&&0<=S&&h<t&&f<t&&S<t&&(g=V(this.root,t,h,f,S),null===g.voxel&&(g.voxel=F(t,h,f,S,a),++u),k=g.voxel,k.normal.add(m.n),k.qefData.add(o,m.n),k.qefData.numPoints===k.edgeCount&&(l.setData(k.qefData).solve(k.position),!g.contains(k.position)&&k.position.copy(l.massPoint),k.normal.normalize()))}catch(e){I=!0,_=e}finally{try{!P&&b.return&&b.return()}finally{if(I)throw _}}}this.voxelCount=u}}]),t}(at),$t={EXTRACT:\\\"worker.extract\\\",MODIFY:\\\"worker.modify\\\",CONFIGURE:\\\"worker.config\\\",CLOSE:\\\"worker.close\\\"},en=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;oe(this,t);var n=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.data=null,n}return ye(t,e),t}(Xt),tn=function(e){function t(){oe(this,t);var e=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,$t.EXTRACT));return e.isosurface=null,e}return ye(t,e),t}(en),nn=new Pt(!1),an=function(){function e(){oe(this,e),this.data=null,this.response=null}return re(e,[{key:\\\"getData\\\",value:function(){return this.data}},{key:\\\"respond\\\",value:function(){return this.response.data=this.data.serialize(),this.response}},{key:\\\"createTransferList\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.data&&this.data.createTransferList(e),e}},{key:\\\"process\\\",value:function(e){return this.data=nn.deserialize(e.data),this}}]),e}(),ln=function(e){function t(){oe(this,t);var e=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.response=new tn,e.decompressionTarget=new Pt(!1),e.isosurface=null,e}return ye(t,e),re(t,[{key:\\\"respond\\\",value:function(){var e=se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\\\"respond\\\",this).call(this);return e.isosurface=null===this.isosurface?null:this.isosurface.serialise(),e}},{key:\\\"createTransferList\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\\\"createTransferList\\\",this).call(this,e),null===this.isosurface?e:this.isosurface.createTransferList(e)}},{key:\\\"process\\\",value:function(e){var n=se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\\\"process\\\",this).call(this,e).getData(),a=new Wt(n.decompress(this.decompressionTarget));return this.isosurface=Kt.run(a),this.decompressionTarget.clear(),this}}]),t}(an),on={UNION:\\\"csg.union\\\",DIFFERENCE:\\\"csg.difference\\\",INTERSECTION:\\\"csg.intersection\\\",DENSITY_FUNCTION:\\\"csg.densityfunction\\\"},rn=function(){function e(t){oe(this,e),this.type=t;for(var n=arguments.length,a=Array(1<n?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];this.children=a,this.boundingBox=null}return re(e,[{key:\\\"getBoundingBox\\\",value:function(){return null===this.boundingBox&&(this.boundingBox=this.computeBoundingBox()),this.boundingBox}},{key:\\\"computeBoundingBox\\\",value:function(){var e=this.children,t=new v,n=void 0,a=void 0;for(n=0,a=e.length;n<a;++n)t.union(e[n].getBoundingBox());return t}}]),e}(),sn=function(e){function t(){var e;oe(this,t);for(var n=arguments.length,a=Array(n),i=0;i<n;i++)a[i]=arguments[i];return de(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this,on.UNION].concat(a)))}return ye(t,e),re(t,[{key:\\\"updateMaterialIndex\\\",value:function(e,t,n){var a=n.materialIndices[e];a!==ft.AIR&&t.setMaterialIndex(e,a)}},{key:\\\"selectEdge\\\",value:function(e,t,n){return n?e.t>t.t?e:t:e.t<t.t?e:t}}]),t}(rn),yn=function(e){function t(){var e;oe(this,t);for(var n=arguments.length,a=Array(n),i=0;i<n;i++)a[i]=arguments[i];return de(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this,on.DIFFERENCE].concat(a)))}return ye(t,e),re(t,[{key:\\\"updateMaterialIndex\\\",value:function(e,t,n){n.materialIndices[e]!==ft.AIR&&t.setMaterialIndex(e,ft.AIR)}},{key:\\\"selectEdge\\\",value:function(e,t,n){return n?e.t<t.t?e:t:e.t>t.t?e:t}}]),t}(rn),dn=function(e){function t(){var e;oe(this,t);for(var n=arguments.length,a=Array(n),i=0;i<n;i++)a[i]=arguments[i];return de(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this,on.INTERSECTION].concat(a)))}return ye(t,e),re(t,[{key:\\\"updateMaterialIndex\\\",value:function(e,t,n){var a=n.materialIndices[e];t.setMaterialIndex(e,t.materialIndices[e]!==ft.AIR&&a!==ft.AIR?a:ft.AIR)}},{key:\\\"selectEdge\\\",value:function(e,t,n){return n?e.t<t.t?e:t:e.t>t.t?e:t}}]),t}(rn),un=0,cn=new xe,mn=function(){function e(){oe(this,e)}return re(e,null,[{key:\\\"run\\\",value:function(e,t,n,a){cn.fromArray(e),un=t,null===n?a.operation===on.UNION&&(n=new Pt(!1)):n.decompress();var i=a.toCSG(),l=null===n?null:X(i);if(null!==l){switch(a.operation){case on.UNION:i=new sn(i);break;case on.DIFFERENCE:i=new yn(i);break;case on.INTERSECTION:i=new dn(i);}M(i,n,l),n.contoured=!1}return null!==n&&n.empty?null:n}}]),e}(),xn=function(e){function t(e){oe(this,t);var n=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,on.DENSITY_FUNCTION));return n.sdf=e,n}return ye(t,e),re(t,[{key:\\\"computeBoundingBox\\\",value:function(){return this.sdf.getBoundingBox(!0)}},{key:\\\"generateMaterialIndex\\\",value:function(e){return this.sdf.sample(e)<=Pt.isovalue?this.sdf.material:ft.AIR}},{key:\\\"generateEdge\\\",value:function(e){e.approximateZeroCrossing(this.sdf),e.computeSurfaceNormal(this.sdf)}}]),t}(rn),pn=new c,vn=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:ft.SOLID;oe(this,e),this.type=t,this.operation=null,this.material=te(255,ne(ft.SOLID,U(n))),this.boundingBox=null,this.position=new xe,this.quaternion=new Ie,this.scale=new xe(1,1,1),this.inverseTransformation=new c,this.updateInverseTransformation(),this.children=[]}return re(e,[{key:\\\"getTransformation\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new c;return e.compose(this.position,this.quaternion,this.scale)}},{key:\\\"getBoundingBox\\\",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t=this.children,n=this.boundingBox,a=void 0,o=void 0;if(null===n&&(n=this.computeBoundingBox(),this.boundingBox=n),e)for(n=n.clone(),a=0,o=t.length;a<o;++a)n.union(t[a].getBoundingBox(e));return n}},{key:\\\"setMaterial\\\",value:function(e){return this.material=te(255,ne(ft.SOLID,U(e))),this}},{key:\\\"setOperationType\\\",value:function(e){return this.operation=e,this}},{key:\\\"updateInverseTransformation\\\",value:function(){return this.inverseTransformation.getInverse(this.getTransformation(pn)),this.boundingBox=null,this}},{key:\\\"union\\\",value:function(e){return this.children.push(e.setOperationType(on.UNION)),this}},{key:\\\"subtract\\\",value:function(e){return this.children.push(e.setOperationType(on.DIFFERENCE)),this}},{key:\\\"intersect\\\",value:function(e){return this.children.push(e.setOperationType(on.INTERSECTION)),this}},{key:\\\"toCSG\\\",value:function(){var e=this.children,t=new xn(this),n=void 0,a=void 0,o=void 0,r=void 0;for(o=0,r=e.length;o<r;++o)a=e[o],n!==a.operation&&(n=a.operation,n===on.UNION?t=new sn(t):n===on.DIFFERENCE?t=new yn(t):n===on.INTERSECTION?t=new dn(t):void 0),t.children.push(a.toCSG());return t}},{key:\\\"serialize\\\",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t={type:this.type,operation:this.operation,material:this.material,position:this.position.toArray(),quaternion:this.quaternion.toArray(),scale:this.scale.toArray(),parameters:null,children:[]},n=void 0,a=void 0;for(n=0,a=this.children.length;n<a;++n)t.children.push(this.children[n].serialize(e));return t}},{key:\\\"createTransferList\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e}},{key:\\\"toJSON\\\",value:function(){return this.serialize(!0)}},{key:\\\"computeBoundingBox\\\",value:function(){throw new Error(\\\"SignedDistanceFunction#computeBoundingBox method not implemented!\\\")}},{key:\\\"sample\\\",value:function(){throw new Error(\\\"SignedDistanceFunction#sample method not implemented!\\\")}}]),e}(),gn={HEIGHTFIELD:\\\"sdf.heightfield\\\",FRACTAL_NOISE:\\\"sdf.fractalnoise\\\",SUPER_PRIMITIVE:\\\"sdf.superprimitive\\\"},kn=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];oe(this,t);var a=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,gn.PERLIN_NOISE,n));return a.min=new(Function.prototype.bind.apply(xe,[null].concat(ce(e.min)))),a.max=new(Function.prototype.bind.apply(xe,[null].concat(ce(e.max)))),a}return ye(t,e),re(t,[{key:\\\"computeBoundingBox\\\",value:function(){return this.bbox=new v(this.min,this.max),this.bbox}},{key:\\\"sample\\\",value:function(){}},{key:\\\"serialize\\\",value:function(){var e=se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\\\"serialize\\\",this).call(this);return e.parameters={min:this.min.toArray(),max:this.max.toArray()},e}}]),t}(vn),hn=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];oe(this,t);var a=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,gn.HEIGHTFIELD,n));return a.width=void 0===e.width?1:e.width,a.height=void 0===e.height?1:e.height,a.smooth=void 0===e.smooth||e.smooth,a.data=void 0===e.data?null:e.data,a.heightmap=null,void 0!==e.image&&a.fromImage(e.image),a}return ye(t,e),re(t,[{key:\\\"fromImage\\\",value:function(e){var t=\\\"undefined\\\"==typeof document?null:Z(e),n=null,a=void 0,o=void 0,r=void 0,s=void 0;if(null!==t){for(a=t.data,n=new Uint8ClampedArray(a.length/4),(o=0,r=0,s=n.length);o<s;++o,r+=4)n[o]=a[r];this.heightmap=e,this.width=t.width,this.height=t.height,this.data=n}return this}},{key:\\\"getHeight\\\",value:function(e,t){var n=this.width,i=this.height,l=this.data,o=void 0;if(e=J(e*n),t=J(t*i),this.smooth){e=ne(te(e,n-1),1),t=ne(te(t,i-1),1);var r=e+1,s=e-1,y=t*n,a=y+n,d=y-n;o=(l[d+s]+l[d+e]+l[d+r]+l[y+s]+l[y+e]+l[y+r]+l[a+s]+l[a+e]+l[a+r])/9}else o=l[t*n+e];return o}},{key:\\\"computeBoundingBox\\\",value:function(){var e=new v,t=te(this.width/this.height,1),n=te(this.height/this.width,1);return e.min.set(0,0,0),e.max.set(t,1,n),e.applyMatrix4(this.getTransformation()),e}},{key:\\\"sample\\\",value:function(e){var t=this.boundingBox,n=void 0;return t.containsPoint(e)?(e.applyMatrix4(this.inverseTransformation),n=e.y-this.getHeight(e.x,e.z)/255):n=t.distanceToPoint(e),n}},{key:\\\"serialize\\\",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],n=se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\\\"serialize\\\",this).call(this);return n.parameters={width:this.width,height:this.height,smooth:this.smooth,data:e?null:this.data,dataURL:e&&null!==this.heightmap?this.heightmap.toDataURL():null,image:null},n}},{key:\\\"createTransferList\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.data.buffer),e}}]),t}(vn),zn=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];oe(this,t);var a=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,gn.SUPER_PRIMITIVE,n));return a.s0=new(Function.prototype.bind.apply(Ye,[null].concat(ce(e.s)))),a.r0=new(Function.prototype.bind.apply(xe,[null].concat(ce(e.r)))),a.s=new Ye,a.r=new xe,a.ba=new he,a.offset=0,a.precompute(),a}return ye(t,e),re(t,[{key:\\\"setSize\\\",value:function(e,t,n,a){return this.s0.set(e,t,n,a),this.precompute()}},{key:\\\"setRadii\\\",value:function(e,t,n){return this.r0.set(e,t,n),this.precompute()}},{key:\\\"precompute\\\",value:function(){var e=this.s.copy(this.s0),t=this.r.copy(this.r0),n=this.ba;e.x-=t.x,e.y-=t.x,t.x-=e.w,e.w-=t.y,e.z-=t.y,this.offset=-2*e.z,n.set(t.z,this.offset);var a=n.dot(n);return 0===a?n.set(0,-1):n.divideScalar(a),this}},{key:\\\"computeBoundingBox\\\",value:function(){var e=this.s0,t=new v;return t.min.x=te(-e.x,-1),t.min.y=te(-e.y,-1),t.min.z=te(-e.z,-1),t.max.x=ne(e.x,1),t.max.y=ne(e.y,1),t.max.z=ne(e.z,1),t.applyMatrix4(this.getTransformation()),t}},{key:\\\"sample\\\",value:function(e){e.applyMatrix4(this.inverseTransformation);var t=this.s,n=this.r,a=this.ba,i=$(e.x)-t.x,l=$(e.y)-t.y,o=$(e.z)-t.z,r=ne(i,0),s=ne(l,0),y=ae(r*r+s*s),d=e.z-t.z,u=$(y+te(0,ne(i,l))-n.x)-t.w,m=te(ne(u*a.x+d*a.y,0),1),c=u-n.z*m,x=d-this.offset*m,p=ne(u-n.z,0),v=e.z+t.z,g=ne(u,0),k=u*-a.y+d*a.x,h=ae(te(c*c+x*x,te(p*p+v*v,g*g+d*d)));return h*Q(ne(k,o))-n.y}},{key:\\\"serialize\\\",value:function(){var e=se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\\\"serialize\\\",this).call(this);return e.parameters={s:this.s0.toArray(),r:this.r0.toArray()},e}}],[{key:\\\"create\\\",value:function(e){var n=fn[e];return new t({s:n[0],r:n[1]})}}]),t}(vn),fn=[[new Float32Array([1,1,1,1]),new Float32Array([0,0,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,0,0])],[new Float32Array([0,0,1,1]),new Float32Array([0,0,1])],[new Float32Array([1,1,2,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,.25,1]),new Float32Array([1,.25,0])],[new Float32Array([1,1,.25,.25]),new Float32Array([1,.25,0])],[new Float32Array([1,1,1,.25]),new Float32Array([1,.1,0])],[new Float32Array([1,1,1,.25]),new Float32Array([.1,.1,0])]],Sn=function(){function e(){oe(this,e)}return re(e,[{key:\\\"revive\\\",value:function(e){var t,n,a;switch(e.type){case gn.FRACTAL_NOISE:t=new kn(e.parameters,e.material);break;case gn.HEIGHTFIELD:t=new hn(e.parameters,e.material);break;case gn.SUPER_PRIMITIVE:t=new zn(e.parameters,e.material);}for(t.operation=e.operation,t.position.fromArray(e.position),t.quaternion.fromArray(e.quaternion),t.scale.fromArray(e.scale),t.updateInverseTransformation(),(n=0,a=e.children.length);n<a;++n)t.children.push(this.revive(e.children[n]));return t}}]),e}(),Tn=function(e){function t(){oe(this,t);var e=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,$t.MODIFY));return e.sdf=null,e}return ye(t,e),t}(en),wn=function(e){function t(){oe(this,t);var e=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.response=new Tn,e.sdf=null,e}return ye(t,e),re(t,[{key:\\\"respond\\\",value:function(){var e=se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\\\"respond\\\",this).call(this);return e.sdf=null===this.sdf?null:this.sdf.serialize(),e}},{key:\\\"createTransferList\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\\\"createTransferList\\\",this).call(this,e),null===this.sdf?e:this.sdf.createTransferList(e)}},{key:\\\"process\\\",value:function(e){var n=se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\\\"process\\\",this).call(this,e).getData(),a=this.sdf=Sn.revive(e.sdf),i=mn.run(e.cellPosition,e.cellSize,n,a);return ue(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\\\"data\\\",null===i?null:i.compress(),this),this}}]),t}(an),Pn=new wn,In=new ln,_n=null;self.addEventListener(\\\"message\\\",function(e){var t=e.data;switch(_n=t.action,_n){case $t.MODIFY:postMessage(Pn.process(t).respond(),Pn.createTransferList());break;case $t.EXTRACT:postMessage(In.process(t).respond(),In.createTransferList());break;case $t.CONFIGURE:Pt.resolution=t.resolution,Mt.errorThreshold=t.errorThreshold;break;case $t.CLOSE:default:close();}}),self.addEventListener(\\\"error\\\",function(e){var t=_n===$t.MODIFY?Pn:_n===$t.EXTRACT?In:null,n=void 0;null===t?(n=new Xt($t.CLOSE),n.error=e,postMessage(n)):(n=t.respond(),n.action=$t.CLOSE,n.error=e,postMessage(n,t.createTransferList())),close()})})();\\n\"],{type:\"text/javascript\"})),n.maxWorkers=de(navigator.hardwareConcurrency,ce(e,1)),n.workers=[],n.busyWorkers=new WeakSet,n.configurationMessage=new Yn,n}return fe(t,e),xe(t,[{key:\"handleEvent\",value:function(e){switch(e.type){case\"message\":{this.busyWorkers.delete(e.target),Kn.worker=e.target,Kn.response=e.data,this.dispatchEvent(Kn),this.workers.length>this.maxWorkers&&this.closeWorker(e.target);break}case\"error\":{console.error(\"Encountered an unexpected error\",e);break}}}},{key:\"closeWorker\",value:function(e){var t=this.workers.indexOf(e);this.busyWorkers.has(e)?(this.busyWorkers.delete(e),e.terminate()):e.postMessage(new Un(Vn.CLOSE)),e.removeEventListener(\"message\",this),e.removeEventListener(\"error\",this),0<=t&&this.workers.splice(t,1)}},{key:\"createWorker\",value:function(){var e=new Worker(this.workerURL);return this.workers.push(e),e.addEventListener(\"message\",this),e.addEventListener(\"error\",this),e.postMessage(this.configurationMessage),e}},{key:\"getWorker\",value:function(){var e=null,t=void 0,n=void 0;for(t=0,n=this.workers.length;t<n;++t)if(!this.busyWorkers.has(this.workers[t])){e=this.workers[t],this.busyWorkers.add(e);break}return null===e&&this.workers.length<this.maxWorkers&&null!==this.workerURL&&(e=this.createWorker(),this.busyWorkers.add(e)),e}},{key:\"clear\",value:function(){for(;0<this.workers.length;)this.closeWorker(this.workers.pop())}},{key:\"dispose\",value:function(){this.clear(),URL.revokeObjectURL(this.workerURL),this.workerURL=null}}]),t}(Ae),Hn=function(e){function t(e){ge(this,t);var n=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.octant=null,n.octantId=null,n.error=null,n}return fe(t,e),t}(_e),$n=new Hn(\"modificationstart\"),Wn=new Hn(\"modificationend\"),Qn=new Hn(\"extractionstart\"),Jn=new Hn(\"extractionend\"),ei=new Hn(\"load\"),ti=new Hn(\"error\"),ni=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};ge(this,t);var n=void 0===e.world?{}:e.world;Kt.resolution=void 0===e.resolution?32:e.resolution;var i=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.object=null,i.world=new Cn(n.cellSize,n.levels,n.keyDesign),i.clipmap=new Bn(i.world),i.clipmap.addEventListener(\"shellupdate\",i),i.threadPool=new Gn(e.workers),i.threadPool.addEventListener(\"message\",i),i.tasks=new WeakMap,i.sdfLoader=new on,i.sdfLoader.addEventListener(\"load\",i),i.history=[],i.dtSq=i.world.getCellSize(),i}return fe(t,e),xe(t,[{key:\"handleEvent\",value:function(e){switch(e.type){case\"shellupdate\":break;case\"message\":break;case\"load\":this.revive(e.descriptions),this.dispatchEvent(ei);}}},{key:\"applyCSG\",value:function(e){this.world.applyCSG(e),this.history.push(e)}},{key:\"union\",value:function(e){this.applyCSG(e.setOperationType(Ce.UNION))}},{key:\"subtract\",value:function(e){this.applyCSG(e.setOperationType(Ce.DIFFERENCE))}},{key:\"intersect\",value:function(e){this.applyCSG(e.setOperationType(Ce.INTERSECTION))}},{key:\"update\",value:function(e){this.clipmap.position.distanceToSquared(e)>=this.dtSq&&this.clipmap.update(e)}},{key:\"raycast\",value:function(e){return this.world.raycast(e)}},{key:\"clear\",value:function(){this.world.clear(),this.clipmap.clear(),this.threadPool.clear(),this.sdfLoader.clear(),this.tasks=new WeakMap,this.history=[]}},{key:\"dispose\",value:function(){this.threadPool.dispose()}},{key:\"revive\",value:function(e){var t,n;for(t=0,n=e.length;t<n;++t)this.applyCSG(an.revive(e[t]))}},{key:\"save\",value:function(){return 0===this.history.length?null:URL.createObjectURL(new Blob([JSON.stringify(this.history)],{type:\"text/json\"}))}},{key:\"load\",value:function(e){var t=JSON.parse(e);this.clear(),this.sdfLoader.load(t)}}]),t}(Ae),ii=function(){function e(t,n,i,a,r){ge(this,e),this.indices=t,this.positions=n,this.normals=i,this.uvs=a,this.materials=r}return xe(e,[{key:\"serialize\",value:function(){return{indices:this.indices,positions:this.positions,normals:this.normals,uvs:this.uvs,materials:this.materials}}},{key:\"deserialize\",value:function(e){var t=this;return null===e?t=null:(this.indices=e.indices,this.positions=e.positions,this.normals=e.normals,this.uvs=e.uvs,this.materials=e.materials),t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.indices.buffer),e.push(this.positions.buffer),e.push(this.normals.buffer),e.push(this.uvs.buffer),e.push(this.materials.buffer),e}}]),e}(),ai=[new Uint8Array([0,4,0]),new Uint8Array([1,5,0]),new Uint8Array([2,6,0]),new Uint8Array([3,7,0]),new Uint8Array([0,2,1]),new Uint8Array([4,6,1]),new Uint8Array([1,3,1]),new Uint8Array([5,7,1]),new Uint8Array([0,1,2]),new Uint8Array([2,3,2]),new Uint8Array([4,5,2]),new Uint8Array([6,7,2])],ri=[new Uint8Array([0,1,2,3,0]),new Uint8Array([4,5,6,7,0]),new Uint8Array([0,4,1,5,1]),new Uint8Array([2,6,3,7,1]),new Uint8Array([0,2,4,6,2]),new Uint8Array([1,3,5,7,2])],si=[[new Uint8Array([4,0,0]),new Uint8Array([5,1,0]),new Uint8Array([6,2,0]),new Uint8Array([7,3,0])],[new Uint8Array([2,0,1]),new Uint8Array([6,4,1]),new Uint8Array([3,1,1]),new Uint8Array([7,5,1])],[new Uint8Array([1,0,2]),new Uint8Array([3,2,2]),new Uint8Array([5,4,2]),new Uint8Array([7,6,2])]],oi=[[new Uint8Array([1,4,0,5,1,1]),new Uint8Array([1,6,2,7,3,1]),new Uint8Array([0,4,6,0,2,2]),new Uint8Array([0,5,7,1,3,2])],[new Uint8Array([0,2,3,0,1,0]),new Uint8Array([0,6,7,4,5,0]),new Uint8Array([1,2,0,6,4,2]),new Uint8Array([1,3,1,7,5,2])],[new Uint8Array([1,1,0,3,2,0]),new Uint8Array([1,5,4,7,6,0]),new Uint8Array([0,1,5,0,4,1]),new Uint8Array([0,3,7,2,6,1])]],li=[[new Uint8Array([3,2,1,0,0]),new Uint8Array([7,6,5,4,0])],[new Uint8Array([5,1,4,0,1]),new Uint8Array([7,3,6,2,1])],[new Uint8Array([6,4,2,0,2]),new Uint8Array([7,5,3,1,2])]],ui=[new Uint8Array([3,2,1,0]),new Uint8Array([7,5,6,4]),new Uint8Array([11,10,9,8])],yi=function(){function e(){ge(this,e)}return xe(e,null,[{key:\"run\",value:function(e){var t=[],n=e.voxelCount,i=null,a=null,r=null,s=null,o=null;return 65535<n?console.warn(\"Could not create geometry for cell at position\",e.min,\"(vertex count of\",n,\"exceeds limit of \",65535,\")\"):0<n&&(a=new Float32Array(3*n),r=new Float32Array(3*n),s=new Float32Array(2*n),o=new Uint8Array(n),V(e.root,a,r,0),B(e.root,t),i=new ii(new Uint16Array(t),a,r,s,o)),i}}]),e}(),di=new Le,ci=function(){function e(){ge(this,e)}return xe(e,null,[{key:\"calculateCoefficients\",value:function(e,t,n){var i,a,r;return 0===t?(di.x=1,di.y=0):(i=(n-e)/(2*t),a=he(1+i*i),r=1/(0<=i?i+a:i-a),di.x=1/he(1+r*r),di.y=r*di.x),di}}]),e}(),hi=function(){function e(){ge(this,e)}return xe(e,null,[{key:\"rotateXY\",value:function(e,t){var n=t.x,i=t.y,a=e.x,r=e.y;e.set(n*a-i*r,i*a+n*r)}},{key:\"rotateQXY\",value:function(e,t,n){var i=n.x,a=n.y,r=i*i,s=a*a,o=2*i*a*t,l=e.x,u=e.y;e.set(r*l-o+s*u,s*l+o+r*u)}}]),e}(),mi=.1,vi=new it,gi=new Ne,xi=new Le,pi=new Oe,fi=function(){function e(){ge(this,e)}return xe(e,null,[{key:\"solve\",value:function(e,t,n){var i=M(vi.copy(e),gi.identity()),a=X(gi,i);n.copy(t).applyMatrix3(a)}}]),e}(),ki=new Oe,zi=function(){function e(){ge(this,e),this.data=null,this.ata=new it,this.atb=new Oe,this.massPoint=new Oe,this.hasSolution=!1}return xe(e,[{key:\"setData\",value:function(e){return this.data=e,this.hasSolution=!1,this}},{key:\"solve\",value:function(e){var t=this.data,n=this.massPoint,i=this.ata.copy(t.ata),a=this.atb.copy(t.atb),r=1/0;return!this.hasSolution&&null!==t&&0<t.numPoints&&(ki.copy(t.massPointSum).divideScalar(t.numPoints),n.copy(ki),i.applyToVector3(ki),a.sub(ki),fi.solve(i,a,e),r=Z(i,a,e),e.add(n),this.hasSolution=!0),r}}]),e}(),wi=function(){function e(){ge(this,e),this.ata=new it,this.ata.set(0,0,0,0,0,0),this.atb=new Oe,this.massPointSum=new Oe,this.numPoints=0}return xe(e,[{key:\"set\",value:function(e,t,n,i){return this.ata.copy(e),this.atb.copy(t),this.massPointSum.copy(n),this.numPoints=i,this}},{key:\"copy\",value:function(e){return this.set(e.ata,e.atb,e.massPointSum,e.numPoints)}},{key:\"add\",value:function(e,t){var n=t.x,i=t.y,a=t.z,r=e.dot(t),s=this.ata.elements,o=this.atb;s[0]+=n*n,s[1]+=n*i,s[3]+=i*i,s[2]+=n*a,s[4]+=i*a,s[5]+=a*a,o.x+=r*n,o.y+=r*i,o.z+=r*a,this.massPointSum.add(e),++this.numPoints}},{key:\"addData\",value:function(e){this.ata.add(e.ata),this.atb.add(e.atb),this.massPointSum.add(e.massPointSum),this.numPoints+=e.numPoints}},{key:\"clear\",value:function(){this.ata.set(0,0,0,0,0,0),this.atb.set(0,0,0),this.massPointSum.set(0,0,0),this.numPoints=0}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}}]),e}(),Si=function e(){ge(this,e),this.materials=0,this.edgeCount=0,this.index=-1,this.position=new Oe,this.normal=new Oe,this.qefData=null},Pi=new zi,bi=.1,Ii=-1,Ti=function(e){function t(e,n){ge(this,t);var i=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.voxel=null,i}return fe(t,e),xe(t,[{key:\"contains\",value:function(e){var t=this.min,n=this.size;return e.x>=t.x-bi&&e.y>=t.y-bi&&e.z>=t.z-bi&&e.x<=t.x+n+bi&&e.y<=t.y+n+bi&&e.z<=t.z+n+bi}},{key:\"collapse\",value:function(){var e=this.children,t=[-1,-1,-1,-1,-1,-1,-1,-1],n=new Oe,a=-1,r=null!==e,s=0,o=void 0,l=void 0,u=void 0,y=void 0,d=void 0,c=void 0,h=void 0;if(r){for(y=new wi,c=0,h=0;8>h;++h)o=e[h],s+=o.collapse(),u=o.voxel,null===o.children?null!==u&&(y.addData(u.qefData),a=1&u.materials>>7-h,t[h]=1&u.materials>>h,++c):r=!1;if(r&&(d=Pi.setData(y).solve(n),d<=Ii)){for(u=new Si,u.position.copy(this.contains(n)?n:Pi.massPoint),h=0;8>h;++h)l=t[h],o=e[h],-1===l?u.materials|=a<<h:(u.materials|=l<<h,u.normal.add(o.voxel.normal));u.normal.normalize(),u.qefData=y,this.voxel=u,this.children=null,s+=c-1}}return s}}],[{key:\"errorThreshold\",get:function(){return Ii},set:function(e){Ii=e}}]),t}(xt),_i=function(e){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Oe,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;ge(this,t);var a=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.root=new Ti(n,i),a.voxelCount=0,null!==e&&null!==e.edgeData&&a.construct(e),0<=Ti.errorThreshold&&a.simplify(),a}return fe(t,e),xe(t,[{key:\"simplify\",value:function(){this.voxelCount-=this.root.collapse()}},{key:\"construct\",value:function(e){var t=Kt.resolution,n=e.edgeData,a=e.materialIndices,r=new zi,s=new Oe,o=[n.edgesX(this.min,this.root.size),n.edgesY(this.min,this.root.size),n.edgesZ(this.min,this.root.size)],l=[new Uint8Array([0,1,2,3]),new Uint8Array([0,1,4,5]),new Uint8Array([0,2,4,6])],u=0,c=void 0,h=void 0,m=void 0,v=void 0,g=void 0,p=void 0,f=void 0,k=void 0,w=void 0,S=void 0,P=void 0;for(S=0;3>S;++S){m=l[S],c=o[S];var b=!0,I=!1,T=void 0;try{for(var _=c[Symbol.iterator](),A;!(b=(A=_.next()).done);b=!0)for(h=A.value,h.computeZeroCrossingPosition(s),P=0;4>P;++P)v=mt[m[P]],f=h.coordinates.x-v[0],k=h.coordinates.y-v[1],w=h.coordinates.z-v[2],0<=f&&0<=k&&0<=w&&f<t&&k<t&&w<t&&(g=j(this.root,t,f,k,w),null===g.voxel&&(g.voxel=K(t,f,k,w,a),++u),p=g.voxel,p.normal.add(h.n),p.qefData.add(s,h.n),p.qefData.numPoints===p.edgeCount&&(r.setData(p.qefData).solve(p.position),!g.contains(p.position)&&p.position.copy(r.massPoint),p.normal.normalize()))}catch(e){I=!0,T=e}finally{try{!b&&_.return&&_.return()}finally{if(I)throw T}}}this.voxelCount=u}}]),t}(It),Ai=0,Ci=new Oe,Oi=function(){function e(){ge(this,e)}return xe(e,null,[{key:\"run\",value:function(e,t,n,i){Ci.fromArray(e),Ai=t,null===n?i.operation===Ce.UNION&&(n=new Kt(!1)):n.decompress();var a=i.toCSG(),r=null===n?null:ee(a);if(null!==r){switch(i.operation){case Ce.UNION:a=new ot(a);break;case Ce.DIFFERENCE:a=new lt(a);break;case Ce.INTERSECTION:a=new ut(a);}J(a,n,r),n.contoured=!1}return null!==n&&n.empty?null:n}}]),e}(),Di=new Kt(!1),Ei=function(){function e(){ge(this,e),this.data=null,this.response=null}return xe(e,[{key:\"getData\",value:function(){return this.data}},{key:\"respond\",value:function(){return this.response.data=this.data.serialize(),this.response}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.data&&this.data.createTransferList(e),e}},{key:\"process\",value:function(e){return this.data=Di.deserialize(e.data),this}}]),e}(),Fi=function(e){function t(){ge(this,t);var e=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.response=new Xn,e.decompressionTarget=new Kt(!1),e.isosurface=null,e}return fe(t,e),xe(t,[{key:\"respond\",value:function(){var e=pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"respond\",this).call(this);return e.isosurface=null===this.isosurface?null:this.isosurface.serialise(),e}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"createTransferList\",this).call(this,e),null===this.isosurface?e:this.isosurface.createTransferList(e)}},{key:\"process\",value:function(e){var n=pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"process\",this).call(this,e).getData(),i=new _i(n.decompress(this.decompressionTarget));return this.isosurface=yi.run(i),this.decompressionTarget.clear(),this}}]),t}(Ei),qi=function(e){function t(){ge(this,t);var e=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.response=new Zn,e.sdf=null,e}return fe(t,e),xe(t,[{key:\"respond\",value:function(){var e=pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"respond\",this).call(this);return e.sdf=null===this.sdf?null:this.sdf.serialize(),e}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"createTransferList\",this).call(this,e),null===this.sdf?e:this.sdf.createTransferList(e)}},{key:\"process\",value:function(e){var n=pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"process\",this).call(this,e).getData(),i=this.sdf=an.revive(e.sdf),a=Oi.run(e.cellPosition,e.cellSize,n,i);return ze(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"data\",null===a?null:a.compress(),this),this}}]),t}(Ei),Li=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:\"Report\";ge(this,e),this.name=t,this.lines=[],this.data=[]}return xe(e,[{key:\"clear\",value:function(){this.data=[]}},{key:\"addLine\",value:function(e){this.lines.push(e)}},{key:\"addValue\",value:function(e){this.data.push(e)}},{key:\"toString\",value:function(){var e=this.lines,t=this.data,n=this.name+\"\\n\\n\",a=void 0,r=void 0;for(a=0,r=e.length;a<r;++a)n+=e[a]+\"\\n\";for(n+=\"\\nValues:\\n\",n+=\"i, ms\\n\",(a=0,r=t.length);a<r;++a)n+=a+1+\", \"+t[a]+\"\\n\";return n}}]),e}(),Bi=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;ge(this,e),this.name=t}return xe(e,[{key:\"initialize\",value:function(){throw new Error(\"Test#initialize method not implemented!\")}},{key:\"clear\",value:function(){throw new Error(\"Test#clear method not implemented!\")}},{key:\"run\",value:function(){throw new Error(\"Test#run method not implemented!\")}}]),e}(),Vi=function(e){function t(){ge(this,t);var e=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,\"Compression Test\"));return e.data=null,e.targetContainer=new Kt(!1),e}return fe(t,e),xe(t,[{key:\"initialize\",value:function(){var e=1/2,t=en.create(nn.PIPE);return t.scale.set(.475,.475,.475),t.updateInverseTransformation(),this.data=Oi.run([-e,-e,-e],1,null,t.setOperationType(Ce.UNION)),this}},{key:\"clear\",value:function(){return this.data=null,this.targetContainer.clear(),this}},{key:\"run\",value:function(){var e=new Li(\"Compression Report\"),t=this.targetContainer,a=this.data,r=Kt.resolution,n=te(r+1,3),s=3*te(r+1,2)*r,o=void 0,l=void 0,u=void 0,y=void 0,d=void 0,c=void 0,h=void 0;for(e.addLine(\"Performing 200 compression tasks\"),h=0;200>h;++h)c=performance.now(),a.compress(t),e.addValue(performance.now()-c);return l=t.materials,u=t.materialIndices.length,y=t.runLengths.length,o=a.edgeData,d=o.indices[0].length+o.indices[1].length+o.indices[2].length,e.addLine(\"Material Statistics\"),e.addLine(\"Total Materials: \"+n+\" (\"+l+\" solid)\"),e.addLine(\"Compressed Materials: \"+u+\" (+ \"+y+\" run-lengths)\"),e.addLine(\"Compression Ratio: \"+(n/(u+4*y)).toFixed(2)),e.addLine(\"Space Savings: \"+(100*(1-(u+4*y)/n)).toFixed(2)+\"%\"),e.addLine(\"Maximum Memory Usage: \"+(8*n/8/1024).toFixed(2)+\" KB\"),e.addLine(\"Estimated Memory Usage: \"+((8*u+32*y)/8/1024).toFixed(2)+\" KB\\n\"),e.addLine(\"Edge Data Statistics\"),e.addLine(\"Total Edges: \"+d+\" (\"+s+\" max)\"),e.addLine(\"Compression Ratio: \"+(s/d).toFixed(2)),e.addLine(\"Space Savings: \"+(100*(1-d/s)).toFixed(2)+\"%\"),e.addLine(\"Maximum Memory Usage: \"+((32*s+32*s+32*(3*s))/8/1024/1024).toFixed(2)+\" MB\"),e.addLine(\"Estimated Memory Usage: \"+((32*d+32*d+32*(3*d))/8/1024).toFixed(2)+\" KB\"),console.log(\"Compressed data\",t),e}}]),t}(Bi),Ui=function(e){function t(){ge(this,t);var e=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,\"Decompression Test\"));return e.data=null,e.targetContainer=new Kt(!1),e}return fe(t,e),xe(t,[{key:\"initialize\",value:function(){var e=1/2,t=en.create(nn.PIPE);return t.scale.set(.475,.475,.475),t.updateInverseTransformation(),this.data=Oi.run([-e,-e,-e],1,null,t.setOperationType(Ce.UNION)),this.data.compress(),this}},{key:\"clear\",value:function(){return this.data=null,this.targetContainer.clear(),this}},{key:\"run\",value:function(){var e=new Li(\"Decompression Report\"),t=this.targetContainer,n=this.data,a=void 0,r=void 0;for(e.addLine(\"Performing 200 decompression tasks\"),r=0;200>r;++r)a=performance.now(),n.decompress(t),e.addValue(performance.now()-a);return console.log(\"Decompressed data\",t),e}}]),t}(Bi),Ni=function(e){function t(){ge(this,t);var e=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,\"CSG Test\"));return e.data=null,e.cellSize=1,e.cellPosition=[-.5,-.5,-.5],e.sdf=null,e}return fe(t,e),xe(t,[{key:\"initialize\",value:function(){var e=en.create(nn.PELLET).setOperationType(Ce.UNION),t=en.create(nn.PIPE).setOperationType(Ce.UNION);return e.scale.set(.475,.475,.475),e.updateInverseTransformation(),t.scale.set(.475,.475,.475),t.updateInverseTransformation(),this.data=Oi.run(this.cellPosition,this.cellSize,null,e),this.sdf=t,this}},{key:\"clear\",value:function(){return this.data=null,this.sdf=null,this}},{key:\"run\",value:function(){var e=new Li(\"CSG Report\"),t=this.cellPosition,n=this.cellSize,a=this.data,r=this.sdf,s=void 0,o=void 0,l=void 0;for(e.addLine(\"Executing 200 CSG Union operations on existing data\"),e.addLine(\"Initial material count: \"+a.materials),e.addLine(\"Initial edge count: \"+(a.edgeData.indices[0].length+a.edgeData.indices[1].length+a.edgeData.indices[2].length)),l=0;200>l;++l)o=performance.now(),s=Oi.run(t,n,a,r),e.addValue(performance.now()-o);return e.addLine(\"Final material count: \"+s.materials),e.addLine(\"Final edge count: \"+(s.edgeData.indices[0].length+s.edgeData.indices[1].length+s.edgeData.indices[2].length)),console.log(\"Generated data\",s),e}}]),t}(Bi),Ri=function(e){function t(){ge(this,t);var e=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,\"SVO Test\"));return e.data=null,e.cellSize=1,e.cellPosition=new Oe(-.5,-.5,-.5),e}return fe(t,e),xe(t,[{key:\"initialize\",value:function(){var e=en.create(nn.PIPE);return e.scale.set(.475,.475,.475),e.updateInverseTransformation(),Ti.errorThreshold=.01,this.data=Oi.run(this.cellPosition.toArray(),this.cellSize,null,e.setOperationType(Ce.UNION)),this}},{key:\"clear\",value:function(){return this.data=null,this}},{key:\"run\",value:function(){var e=new Li(\"SVO Report\"),t=this.cellPosition,n=this.cellSize,a=this.data,r=void 0,s=void 0,o=void 0;for(e.addLine(\"Building 200 sparse voxel octrees\"),e.addLine(\"Material count: \"+a.materials),e.addLine(\"Edge count: \"+(a.edgeData.indices[0].length+a.edgeData.indices[1].length+a.edgeData.indices[2].length)),o=0;200>o;++o)s=performance.now(),r=new _i(a,t,n),e.addValue(performance.now()-s);return e.addLine(\"Final voxel count: \"+r.voxelCount),console.log(\"Sparse voxel octree\",r),e}}]),t}(Bi),Mi=function(e){function t(){ge(this,t);var e=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,\"Contouring Test\"));return e.svo=null,e}return fe(t,e),xe(t,[{key:\"initialize\",value:function(){var e=1/2,t=new Oe(-e,-e,-e),n=en.create(nn.PIPE);return n.scale.set(.475,.475,.475),n.updateInverseTransformation(),Ti.errorThreshold=.01,this.svo=new _i(Oi.run(t.toArray(),1,null,n.setOperationType(Ce.UNION)),t,1),this}},{key:\"clear\",value:function(){return this.svo=null,this}},{key:\"run\",value:function(){var e=new Li(\"Contouring Report\"),t=this.svo,n=void 0,a=void 0,r=void 0;for(e.addLine(\"Performing 200 contouring tasks\"),e.addLine(\"Voxel count: \"+t.voxelCount),r=0;200>r;++r)a=performance.now(),n=yi.run(t),e.addValue(performance.now()-a);return e.addLine(\"Generated vertices: \"+n.positions.length/3),e.addLine(\"Generated triangle indices: \"+n.indices.length),console.log(\"Extracted isosurface\",n),e}}]),t}(Bi),Yi={CONFIGURE:\"worker.config\",TEST:\"worker.test\"},Xi=new Map([[\"Compression\",new Vi],[\"Decompression\",new Ui],[\"Contouring\",new Mi],[\"CSG\",new Ni],[\"SVO\",new Ri]]);self.addEventListener(\"message\",function(e){var t=e.data,n=void 0,i=void 0;switch(t.action){case Yi.CONFIGURE:{Kt.resolution=t.resolution,console.log(\"Setting Hermite data resolution to\",t.resolution);break}case Yi.TEST:{n=Xi.get(t.id).initialize(),i=n.run(),n.clear(),postMessage({reportName:i.name,reportURL:URL.createObjectURL(new Blob([i.toString()],{type:\"text/plain\"}))});break}}})})();\n"],{type:"text/javascript"})),o=null,u=["Compression","Decompression","Contouring","CSG","SVO"];window.addEventListener("load",function t(){window.removeEventListener("load",t),document.getElementById("resolution").addEventListener("change",e),o=new Worker(a),o.addEventListener("message",r),o.addEventListener("error",r),o.postMessage({action:s.CONFIGURE,resolution:64}),i()})})();
