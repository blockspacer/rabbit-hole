(function(){'use strict';function t(t){u.postMessage({action:s.CONFIGURE,resolution:Number.parseInt(t.target.value)})}function e(t){var e=t.target.id,n=document.createElement("h3");n.appendChild(document.createTextNode("Running "+e+" Test\u2026")),document.getElementById("aside").appendChild(n),document.getElementById("mask").removeAttribute("class"),u.postMessage({action:s.TEST,id:e})}function n(t){var e=t.data,n=document.createElement("div"),i=document.createElement("span"),s=document.createElement("a");s.href=e.reportURL,s.setAttribute("download",e.reportName+".log"),s.setAttribute("class","report"),s.appendChild(document.createTextNode("Report \u2B73")),i.appendChild(document.createTextNode("Test complete")),i.setAttribute("class","status"),i.appendChild(s),n.setAttribute("class","result"),n.appendChild(i),n.appendChild(s),document.getElementById("aside").appendChild(n),document.getElementById("mask").setAttribute("class","hidden")}function i(){for(var t,n,i,s=document.getElementById("main"),r=document.createElement("ul"),u=0,l=o;u<l.length;u++)t=l[u],n=document.createElement("li"),i=document.createElement("a"),i.appendChild(document.createTextNode(t)),i.setAttribute("href","#"+t),i.setAttribute("id",t),i.addEventListener("click",e),n.appendChild(i),r.appendChild(n);s.appendChild(r)}function a(t){switch(t.type){case"message":n(t);break;case"error":console.error("Encountered an unexpected error",t);}}var s={CONFIGURE:"worker.config",TEST:"worker.test"},r=URL.createObjectURL(new Blob(["function _typeof(e){return _typeof=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},_typeof(e)}(function(){'use strict';var ze=Math.pow,we=Math.trunc,Se=Math.sign,Ie=Math.PI,Te=Math.atan2,Pe=Math.round,Ce=Math.acos,be=Math.sqrt,Ae=Math.cos,Ee=Math.sin,De=Math.floor,Fe=Math.ceil,Oe=Math.abs,Le=Math.max,Me=Math.min;function e(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function t(e,t){for(var n=0,a;n<t.length;n++)a=t[n],a.enumerable=a.enumerable||!1,a.configurable=!0,\"value\"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function n(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},y(e)}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function g(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function x(){return x=g()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var a=Function.bind.apply(e,i),s=new a;return n&&h(s,n.prototype),s},x.apply(null,arguments)}function k(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}function z(e,t){return t&&(\"object\"===_typeof(t)||\"function\"==typeof t)?t:k(e)}function w(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=y(e),null!==e););return e}function S(e,t,n){return S=\"undefined\"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var a=w(e,t);if(a){var i=Object.getOwnPropertyDescriptor(a,t);return i.get?i.get.call(n):i.value}},S(e,t,n||e)}function I(e,t,n,a){return I=\"undefined\"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,n,a){var s=w(e,t),r;if(s){if(r=Object.getOwnPropertyDescriptor(s,t),r.set)return r.set.call(a,n),!0;if(!r.writable)return!1}if(r=Object.getOwnPropertyDescriptor(a,t),r){if(!r.writable)return!1;r.value=n,Object.defineProperty(a,t,r)}else i(a,t,n);return!0},I(e,t,n,a)}function T(e,t,n,a,i){var r=I(e,t,n,a||e);if(!r&&i)throw new Error(\"failed to set property\");return n}function P(e){return C(e)||A(e)||E()}function C(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function A(e){if(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e))return Array.from(e)}function E(){throw new TypeError(\"Invalid attempt to spread non-iterable instance\")}function D(e,t,n){return Le(Me(e,n),t)}function F(e,t,n,a,i,s){var r=0;return e>t&&e>n?(i<e&&(r|=2),s<e&&(r|=1)):t>n?(a<t&&(r|=4),s<t&&(r|=1)):(a<n&&(r|=4),i<n&&(r|=2)),r}function O(e,t,n,a){var i=0,s;return t<n?(s=t,i=0):(s=n,i=1),a<s&&(i=2),r[e][i]}function L(e,t,n,a,i,s,r,o,l){var u=e.children,y,h,c,d;if(0<=i&&0<=s&&0<=r)if(null===u)l.push(e);else{h=.5*(t+i),c=.5*(n+s),d=.5*(a+r),y=F(t,n,a,h,c,d);do 0===y?(L(u[Bt],t,n,a,h,c,d,o,l),y=O(y,h,c,d)):1===y?(L(u[1^Bt],t,n,d,h,c,r,o,l),y=O(y,h,c,r)):2===y?(L(u[2^Bt],t,c,a,h,s,d,o,l),y=O(y,h,s,d)):3===y?(L(u[3^Bt],t,c,d,h,s,r,o,l),y=O(y,h,s,r)):4===y?(L(u[4^Bt],h,n,a,i,c,d,o,l),y=O(y,i,c,d)):5===y?(L(u[5^Bt],h,n,d,i,c,r,o,l),y=O(y,i,c,r)):6===y?(L(u[6^Bt],h,c,a,i,s,d,o,l),y=O(y,i,s,d)):7===y?(L(u[7^Bt],h,c,d,i,s,r,o,l),y=8):void 0;while(8>y)}}function M(e){var t=e.children,n=0,a,s,r;if(null!==t)for(a=0,s=t.length;a<s;++a)r=1+M(t[a]),r>n&&(n=r);return n}function B(e,t,n){var a=e.children,s,r;if(qt.min=e.min,qt.max=e.max,t.intersectsBox(qt))if(null!==a)for(s=0,r=a.length;s<r;++s)B(a[s],t,n);else n.push(e)}function N(e,t,n,a){var s=e.children,r,o;if(n===t)a.push(e);else if(null!==s)for(++n,r=0,o=s.length;r<o;++r)N(s[r],t,n,a)}function V(e){var t=e.children,n=0,a,s;if(null!==t)for(a=0,s=t.length;a<s;++a)n+=V(t[a]);else null!==e.points&&(n=e.points.length);return n}function R(e,t,n,a,s){var r=a.children,o=!1,u=!1,y,h;if(a.contains(e,n.bias)){if(null===r){if(null===a.points)a.points=[],a.data=[];else for(y=0,h=a.points.length;!o&&y<h;++y)o=a.points[y].equals(e);o?(a.data[y-1]=t,u=!0):a.points.length<n.maxPoints||s===n.maxDepth?(a.points.push(e.clone()),a.data.push(t),++n.pointCount,u=!0):(a.split(),a.redistribute(n.bias),r=a.children)}if(null!==r)for(++s,y=0,h=r.length;!u&&y<h;++y)u=R(e,t,n,r[y],s)}return u}function U(e,t,n,a){var s=n.children,r=null,o,u,y,h,c;if(n.contains(e,t.bias))if(null!==s)for(o=0,u=s.length;null===r&&o<u;++o)r=U(e,t,s[o],n);else if(null!==n.points)for(y=n.points,h=n.data,(o=0,u=y.length);o<u;++o)if(y[o].equals(e)){c=u-1,r=h[o],o<c&&(y[o]=y[c],h[o]=h[c]),y.pop(),h.pop(),--t.pointCount,null!==a&&V(a)<=t.maxPoints&&a.merge();break}return r}function Y(e,t,n){var a=n.children,s=null,r,o,u;if(n.contains(e,t.bias))if(null!==a)for(r=0,o=a.length;null===s&&r<o;++r)s=Y(e,t,a[r]);else if(null!==n.points)for(u=n.points,r=0,o=u.length;null===s&&r<o;++r)e.equals(u[r])&&(s=n.data[r]);return s}function X(e,t,n,a,s,r){var o=a.children,u=null,y,h,c;if(a.contains(e,n.bias))if(!a.contains(t,n.bias))u=U(e,n,a,s),R(t,u,n,s,r-1);else if(null!==o)for(++r,y=0,h=o.length;null===u&&y<h;++y)u=X(e,t,n,o[y],a,r);else if(null!==a.points)for(c=a.points,y=0,h=c.length;y<h;++y)if(e.equals(c[y])){c[y].copy(t),u=a.data[y];break}return u}function j(e,t,n,a){var s=null,r=t,o,u;if(null!==a.children){var y=a.children.map(function(t){return{octant:t,distance:t.distanceToCenterSquared(e)}}).sort(function(e,t){return e.distance-t.distance}),h,c;for(o=0,u=y.length;o<u&&(h=y[o].octant,!(h.contains(e,r)&&(c=j(e,r,n,h),null!==c&&(r=c.distance,s=c,0===r))));++o);}else if(null!==a.points){var d=a.points,m=-1,v;for(o=0,u=d.length;o<u;++o)if(!d[o].equals(e))v=e.distanceTo(d[o]),v<r&&(r=v,m=o);else if(!n){r=0,m=o;break}0<=m&&(s={point:d[m],data:a.data[m],distance:r})}return s}function Z(e,t,n,a,s){var r=a.children,o,u;if(null!==r){var y;for(o=0,u=r.length;o<u;++o)y=r[o],y.contains(e,t)&&Z(e,t,n,y,s)}else if(null!==a.points){var h=a.points,c;for(o=0,u=h.length;o<u;++o)c=h[o],c.equals(e)?!n&&s.push({point:c.clone(),data:a.data[o]}):c.distanceToSquared(e)<=t*t&&s.push({point:c.clone(),data:a.data[o]})}}function G(e){var t=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\"),n=t.getContext(\"2d\");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height)}function _(e,t,n,a,s,r,o){var l,u,y,h,c,d;if(n.csg.add(t),0<o)for(--o,l=e.getGrid(o),u=e.getKeyDesign(),y=n.children,h=Nn[o],a<<=1,s<<=1,r<<=1,d=0;8>d;++d)0!=(y&1<<d)&&(c=Ct[d],Fn.set(a+c[0],s+c[1],r+c[2]),h.containsPoint(Fn)&&_(e,t,l.get(u.packKey(Fn)),Fn.x,Fn.y,Fn.z,o))}function K(e,t,n,a,i,s){var r=0;return e>t&&e>n?(i<e&&(r|=2),s<e&&(r|=1)):t>n?(a<t&&(r|=4),s<t&&(r|=1)):(a<n&&(r|=4),i<n&&(r|=2)),r}function Q(e,t,n,a){var i=0,s;return t<n?(s=t,i=0):(s=n,i=1),a<s&&(i=2),Yn[e][i]}function W(e,t,n,a,s,r,o,l,u,y,h,c,d){var m,v,g,x,p,f,k,z,w,S,I;if(0<=y&&0<=h&&0<=c)if(m=e.getKeyDesign(),0===r||null!==t.isosurface)v=e.getCellSize(r),g=new bn(t),g.id.set(r,m.packKey(Vn.set(n,a,s))),g.min.copy(Vn).multiplyScalar(v).add(e.min),g.max.copy(g.min).addScalar(v),d.push(g);else if(0<t.children){x=e.getGrid(--r),p=t.children,n<<=1,a<<=1,s<<=1,z=.5*(o+y),w=.5*(l+h),S=.5*(u+c),k=K(o,l,u,z,w,S);do switch(I=Xn^k,k){case 0:{0!=(p&1<<I)&&(f=Ct[I],Vn.set(n+f[0],a+f[1],s+f[2]),W(e,x.get(m.packKey(Vn)),Vn.x,Vn.y,Vn.z,r,o,l,u,z,w,S,d)),k=Q(k,z,w,S);break}case 1:{0!=(p&1<<I)&&(f=Ct[I],Vn.set(n+f[0],a+f[1],s+f[2]),W(e,x.get(m.packKey(Vn)),Vn.x,Vn.y,Vn.z,r,o,l,S,z,w,c,d)),k=Q(k,z,w,c);break}case 2:{0!=(p&1<<I)&&(f=Ct[I],Vn.set(n+f[0],a+f[1],s+f[2]),W(e,x.get(m.packKey(Vn)),Vn.x,Vn.y,Vn.z,r,o,w,u,z,h,S,d)),k=Q(k,z,h,S);break}case 3:{0!=(p&1<<I)&&(f=Ct[I],Vn.set(n+f[0],a+f[1],s+f[2]),W(e,x.get(m.packKey(Vn)),Vn.x,Vn.y,Vn.z,r,o,w,S,z,h,c,d)),k=Q(k,z,h,c);break}case 4:{0!=(p&1<<I)&&(f=Ct[I],Vn.set(n+f[0],a+f[1],s+f[2]),W(e,x.get(m.packKey(Vn)),Vn.x,Vn.y,Vn.z,r,z,l,u,y,w,S,d)),k=Q(k,y,w,S);break}case 5:{0!=(p&1<<I)&&(f=Ct[I],Vn.set(n+f[0],a+f[1],s+f[2]),W(e,x.get(m.packKey(Vn)),Vn.x,Vn.y,Vn.z,r,z,l,S,y,w,c,d)),k=Q(k,y,w,c);break}case 6:{0!=(p&1<<I)&&(f=Ct[I],Vn.set(n+f[0],a+f[1],s+f[2]),W(e,x.get(m.packKey(Vn)),Vn.x,Vn.y,Vn.z,r,z,w,u,y,h,S,d)),k=Q(k,y,h,S);break}case 7:{0!=(p&1<<I)&&(f=Ct[I],Vn.set(n+f[0],a+f[1],s+f[2]),W(e,x.get(m.packKey(Vn)),Vn.x,Vn.y,Vn.z,r,z,w,S,y,h,c,d)),k=8;break}}while(8>k)}}function H(e,t,n,a,i){var s=l.min.set(0,0,0),r=l.max.subVectors(t.max,t.min),o=t.getDimensions(Un.min),u=Un.max.copy(o).multiplyScalar(.5),y=d.origin.copy(a.origin),h=d.direction.copy(a.direction),c,m,v,g,x,p,f,k,z;y.sub(t.getCenter(Vn)).add(u),Xn=0,0>h.x&&(y.x=o.x-y.x,h.x=-h.x,Xn|=4),0>h.y&&(y.y=o.y-y.y,h.y=-h.y,Xn|=2),0>h.z&&(y.z=o.z-y.z,h.z=-h.z,Xn|=1),c=1/h.x,m=1/h.y,v=1/h.z,g=(s.x-y.x)*c,x=(r.x-y.x)*c,p=(s.y-y.y)*m,f=(r.y-y.y)*m,k=(s.z-y.z)*v,z=(r.z-y.z)*v,W(e,t.octant,n.x,n.y,n.z,e.getDepth(),g,p,k,x,f,z,i)}function J(e,t,n,a,s,r){var o,l,u,y,h,c,d;if(0<r){for(--r,o=e.getGrid(r),l=e.getKeyDesign(),u=t.children,n<<=1,a<<=1,s<<=1,d=0;8>d;++d)0!=(u&1<<d)&&(h=Ct[d],Zn.set(n+h[0],a+h[1],s+h[2]),c=l.packKey(Zn),y=o.get(c),o[\"delete\"](c),J(e,y,Zn.x,Zn.y,Zn.z,r));t.children=0}}function $(e,t,n,a,s){var r,o,l,u;++s<e.levels&&(r=e.getGrid(s),o=Gn.calculateOffsetIndex(t,n,a),Zn.set(t>>>1,n>>>1,a>>>1),l=e.getKeyDesign().packKey(Zn),u=r.get(l),u.children&=~(1<<o),0===u.children&&(r[\"delete\"](l),$(e,Zn.x,Zn.y,Zn.z,s)))}function ee(e,t,n){var a=[-1,-1,-1,-1],s=[!1,!1,!1,!1],r=1/0,o=0,l=!1,u,y,h,c,d,m,v;for(v=0;4>v;++v)d=e[v],m=Ta[t][v],u=bt[m][0],y=bt[m][1],h=1&d.voxel.materials>>u,c=1&d.voxel.materials>>y,d.size<r&&(r=d.size,o=v,l=h!==pt.AIR),a[v]=d.voxel.index,s[v]=h!==c;s[o]&&(l?(n.push(a[0]),n.push(a[3]),n.push(a[1]),n.push(a[0]),n.push(a[2]),n.push(a[3])):(n.push(a[0]),n.push(a[1]),n.push(a[3]),n.push(a[0]),n.push(a[3]),n.push(a[2])))}function te(e,t,n){var a=[0,0,0,0],s,r,o,l;if(null!==e[0].voxel&&null!==e[1].voxel&&null!==e[2].voxel&&null!==e[3].voxel)ee(e,t,n);else for(o=0;2>o;++o){for(a[0]=Ia[t][o][0],a[1]=Ia[t][o][1],a[2]=Ia[t][o][2],a[3]=Ia[t][o][3],s=[],l=0;4>l;++l)if(r=e[l],null!==r.voxel)s[l]=r;else if(null!==r.children)s[l]=r.children[a[l]];else break;4===l&&te(s,Ia[t][o][4],n)}}function ne(e,t,n){var a=[0,0,0,0],s=[[0,0,1,1],[0,1,0,1]],r,o,l,u,y,h;if(null!==e[0].children||null!==e[1].children){for(y=0;4>y;++y)a[0]=wa[t][y][0],a[1]=wa[t][y][1],r=[null===e[0].children?e[0]:e[0].children[a[0]],null===e[1].children?e[1]:e[1].children[a[1]]],ne(r,wa[t][y][2],n);for(y=0;4>y;++y){for(a[0]=Sa[t][y][1],a[1]=Sa[t][y][2],a[2]=Sa[t][y][3],a[3]=Sa[t][y][4],l=s[Sa[t][y][0]],o=[],h=0;4>h;++h)if(u=e[l[h]],null!==u.voxel)o[h]=u;else if(null!==u.children)o[h]=u.children[a[h]];else break;4===h&&te(o,Sa[t][y][5],n)}}}function ae(e,t){var n=e.children,a=[0,0,0,0],s,r,o;if(null!==n){for(o=0;8>o;++o)ae(n[o],t);for(o=0;12>o;++o)a[0]=ka[o][0],a[1]=ka[o][1],s=[n[a[0]],n[a[1]]],ne(s,ka[o][2],t);for(o=0;6>o;++o)a[0]=za[o][0],a[1]=za[o][1],a[2]=za[o][2],a[3]=za[o][3],r=[n[a[0]],n[a[1]],n[a[2]],n[a[3]]],te(r,za[o][4],t)}}function ie(e,t,n,a){var s,r;if(null!==e.children)for(s=0;8>s;++s)a=ie(e.children[s],t,n,a);else null!==e.voxel&&(r=e.voxel,r.index=a,t[3*a]=r.position.x,t[3*a+1]=r.position.y,t[3*a+2]=r.position.z,n[3*a]=r.normal.x,n[3*a+1]=r.normal.y,n[3*a+2]=r.normal.z,++a);return a}function se(e,t){var n=e.elements,a=t.elements,i;0!==n[1]&&(i=Aa.calculateCoefficients(n[0],n[1],n[3]),Ea.rotateQXY(La.set(n[0],n[3]),n[1],i),n[0]=La.x,n[3]=La.y,Ea.rotateXY(La.set(n[2],n[4]),i),n[2]=La.x,n[4]=La.y,n[1]=0,Ea.rotateXY(La.set(a[0],a[3]),i),a[0]=La.x,a[3]=La.y,Ea.rotateXY(La.set(a[1],a[4]),i),a[1]=La.x,a[4]=La.y,Ea.rotateXY(La.set(a[2],a[5]),i),a[2]=La.x,a[5]=La.y)}function re(e,t){var n=e.elements,a=t.elements,i;0!==n[2]&&(i=Aa.calculateCoefficients(n[0],n[2],n[5]),Ea.rotateQXY(La.set(n[0],n[5]),n[2],i),n[0]=La.x,n[5]=La.y,Ea.rotateXY(La.set(n[1],n[4]),i),n[1]=La.x,n[4]=La.y,n[2]=0,Ea.rotateXY(La.set(a[0],a[6]),i),a[0]=La.x,a[6]=La.y,Ea.rotateXY(La.set(a[1],a[7]),i),a[1]=La.x,a[7]=La.y,Ea.rotateXY(La.set(a[2],a[8]),i),a[2]=La.x,a[8]=La.y)}function oe(e,t){var n=e.elements,a=t.elements,i;0!==n[4]&&(i=Aa.calculateCoefficients(n[3],n[4],n[5]),Ea.rotateQXY(La.set(n[3],n[5]),n[4],i),n[3]=La.x,n[5]=La.y,Ea.rotateXY(La.set(n[1],n[2]),i),n[1]=La.x,n[2]=La.y,n[4]=0,Ea.rotateXY(La.set(a[3],a[6]),i),a[3]=La.x,a[6]=La.y,Ea.rotateXY(La.set(a[4],a[7]),i),a[4]=La.x,a[7]=La.y,Ea.rotateXY(La.set(a[5],a[8]),i),a[5]=La.x,a[8]=La.y)}function le(t,n){var a=t.elements,e;for(e=0;e<5;++e)se(t,n),re(t,n),oe(t,n);return Ma.set(a[0],a[3],a[5])}function ue(e){var t=Oe(e)<Da?0:1/e;return Oe(t)<Da?0:t}function ye(e,t){var n=e.elements,a=n[0],i=n[3],s=n[6],r=n[1],o=n[4],l=n[7],u=n[2],y=n[5],h=n[8],c=ue(t.x),d=ue(t.y),m=ue(t.z);return e.set(a*c*a+i*d*i+s*m*s,a*c*r+i*d*o+s*m*l,a*c*u+i*d*y+s*m*h,r*c*a+o*d*i+l*m*s,r*c*r+o*d*o+l*m*l,r*c*u+o*d*y+l*m*h,u*c*a+y*d*i+h*m*s,u*c*r+y*d*o+h*m*l,u*c*u+y*d*y+h*m*h)}function he(e,t,n){return e.applyToVector3(Na.copy(n)),Na.subVectors(t,Na),Na.dot(Na)}function ce(e,t,a,s,r){var o=0;for(t>>=1;0<t;t>>=1,o=0)a>=t&&(o+=4,a-=t),s>=t&&(o+=2,s-=t),r>=t&&(o+=1,r-=t),null===e.children&&e.split(),e=e.children[o];return e}function de(e,t,n,a,s){var r=e+1,o=new Ra,l,u,y,h,c,d,m,v,g,x;for(l=0,x=0;8>x;++x)h=Ct[x],c=(a+h[2])*(r*r)+(n+h[1])*r+(t+h[0]),y=Me(s[c],pt.SOLID),l|=y<<x;for(u=0,x=0;12>x;++x)d=bt[x][0],m=bt[x][1],v=1&l>>d,g=1&l>>m,v!==g&&++u;return o.materials=l,o.edgeCount=u,o.qefData=new Va,o}function me(e){var t=Ga,a=rn.resolution,n=new je(0,0,0),i=new je(a,a,a),s=new v(_a,_a.clone().addScalar(Ga)),r=e.getBoundingBox();return e.type!==Xe.INTERSECTION&&(r.intersectsBox(s)?(n.copy(r.min).max(s.min).sub(s.min),n.x=Fe(n.x*a/t),n.y=Fe(n.y*a/t),n.z=Fe(n.z*a/t),i.copy(r.max).min(s.max).sub(s.min),i.x=De(i.x*a/t),i.y=De(i.y*a/t),i.z=De(i.z*a/t)):(n.set(a,a,a),i.set(0,0,0))),new v(n,i)}function ve(e,t,a,i){var s=rn.resolution,n=s+1,r=i.max.x,o=i.max.y,l=i.max.z,u,h,c;for(c=i.min.z;c<=l;++c)for(h=i.min.y;h<=o;++h)for(u=i.min.x;u<=r;++u)e.updateMaterialIndex(c*(n*n)+h*n+u,t,a)}function ge(e,t,a){var i=Ga,s=rn.resolution,n=s+1,r=t.materialIndices,o=new je,l=new je,u=a.max.x,h=a.max.y,c=a.max.z,d=0,m,v,g,p;for(p=a.min.z;p<=c;++p)for(o.z=p*i/s,g=a.min.y;g<=h;++g)for(o.y=g*i/s,v=a.min.x;v<=u;++v)o.x=v*i/s,m=e.generateMaterialIndex(l.addVectors(_a,o)),m!==pt.AIR&&(r[p*(n*n)+g*n+v]=m,++d);t.materials=d}function xe(e,t,a){var s=rn.resolution,n=s+1,r=new Uint32Array([1,n,n*n]),o=t.materialIndices,l=new Wt,u=new Wt,y=a.edgeData,h=t.edgeData,m=new Uint32Array(3),v=tn.calculate1DEdgeCount(s),g=new tn(s,Me(v,h.indices[0].length+y.indices[0].length),Me(v,h.indices[1].length+y.indices[1].length),Me(v,h.indices[2].length+y.indices[2].length)),x,p,f,k,z,w,S,I,T,P,C,b,A,E,D,F,O,L,M,B,N,q,V;for(L=0,M=0;3>M;L=0,++M){for(x=y.indices[M],k=h.indices[M],S=g.indices[M],p=y.zeroCrossings[M],z=h.zeroCrossings[M],I=g.zeroCrossings[M],f=y.normals[M],w=h.normals[M],T=g.normals[M],P=r[M],q=x.length,V=k.length,(B=0,N=0);B<q;++B)if(C=x[B],b=C+P,D=o[C],F=o[b],D!==F&&(D===pt.AIR||F===pt.AIR)){for(l.t=p[B],l.n.x=f[3*B],l.n.y=f[3*B+1],l.n.z=f[3*B+2],e.type===Xe.DIFFERENCE&&l.n.negate(),O=l;N<V&&k[N]<=C;)A=k[N],E=A+P,u.t=z[N],u.n.x=w[3*N],u.n.y=w[3*N+1],u.n.z=w[3*N+2],D=o[A],A<C?(F=o[E],D!==F&&(D===pt.AIR||F===pt.AIR)&&(S[L]=A,I[L]=u.t,T[3*L]=u.n.x,T[3*L+1]=u.n.y,T[3*L+2]=u.n.z,++L)):O=e.selectEdge(u,l,D===pt.SOLID),++N;S[L]=C,I[L]=O.t,T[3*L]=O.n.x,T[3*L+1]=O.n.y,T[3*L+2]=O.n.z,++L}for(;N<V;)A=k[N],E=A+P,D=o[A],F=o[E],D!==F&&(D===pt.AIR||F===pt.AIR)&&(S[L]=A,I[L]=z[N],T[3*L]=w[3*N],T[3*L+1]=w[3*N+1],T[3*L+2]=w[3*N+2],++L),++N;m[M]=L}return{edgeData:g,lengths:m}}function pe(e,t,i){var r=Ga,s=rn.resolution,n=s+1,o=n*n,l=new Uint32Array([1,n,o]),u=t.materialIndices,h=_a,m=new je,v=new je,g=new Wt,p=new Uint32Array(3),f=new tn(s,tn.calculate1DEdgeCount(s)),k,w,S,I,T,P,C,b,A,E,D,F,O,L,M,B,N,q,V;for(M=4,O=0,L=0;3>L;M>>=1,O=0,++L){B=Ct[M],k=f.indices[L],w=f.zeroCrossings[L],S=f.normals[L],I=l[L],C=i.min.x,E=i.max.x,b=i.min.y,D=i.max.y,A=i.min.z,F=i.max.z;for(0===L?(C=Le(C-1,0),E=Me(E,s-1)):1===L?(b=Le(b-1,0),D=Me(D,s-1)):2===L?(A=Le(A-1,0),F=Me(F,s-1)):void 0,V=A;V<=F;++V)for(q=b;q<=D;++q)for(N=C;N<=E;++N)T=V*o+q*n+N,P=T+I,u[T]!==u[P]&&(m.set(N*r/s,q*r/s,V*r/s),v.set((N+B[0])*r/s,(q+B[1])*r/s,(V+B[2])*r/s),g.a.addVectors(h,m),g.b.addVectors(h,v),e.generateEdge(g),k[O]=T,w[O]=g.t,S[3*O]=g.n.x,S[3*O+1]=g.n.y,S[3*O+2]=g.n.z,++O);p[L]=O}return{edgeData:f,lengths:p}}function fe(e,t,n){var a=me(e),i=!1,s,r,o,l;if(e.type===Xe.DENSITY_FUNCTION?ge(e,t,a):t.empty?e.type===Xe.UNION&&(t.set(n),i=!0):!(t.full&&e.type===Xe.UNION)&&ve(e,t,n,a),!i&&!t.empty&&!t.full){for(s=e.type===Xe.DENSITY_FUNCTION?pe(e,t,a):xe(e,t,n),r=s.edgeData,o=s.lengths,l=0;3>l;++l)r.indices[l]=r.indices[l].slice(0,o[l]),r.zeroCrossings[l]=r.zeroCrossings[l].slice(0,o[l]),r.normals[l]=r.normals[l].slice(0,3*o[l]);t.edgeData=r}}function ke(e){var t=e.children,n,a,s,r;for(e.type===Xe.DENSITY_FUNCTION&&(n=new rn,fe(e,n)),s=0,r=t.length;s<r&&(a=ke(t[s]),void 0===n?n=a:null===a?e.type===Xe.INTERSECTION&&(n=null):null===n?e.type===Xe.UNION&&(n=a):fe(e,n,a),null!==n||e.type===Xe.UNION);++s);return null!==n&&n.empty?null:n}var Be=function(){function t(){e(this,t)}return n(t,[{key:\"serialize\",value:function(){}}]),t}(),Ne=function(){function t(){e(this,t)}return n(t,[{key:\"deserialize\",value:function(){}}]),t}(),qe=function(){function t(){e(this,t)}return n(t,[{key:\"dispose\",value:function(){}}]),t}(),Ve=function(){function t(){e(this,t)}return n(t,[{key:\"createTransferList\",value:function(){}}]),t}(),Re=function(){function t(){e(this,t),this.elements=[],this.head=0}return n(t,[{key:\"copy\",value:function(e){return this.elements=Array.from(e.elements),this.head=e.head,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"add\",value:function(e){this.elements.push(e)}},{key:\"peek\",value:function(){return 0<this.elements.length?this.elements[this.head]:void 0}},{key:\"poll\",value:function(){var e=this.elements,t=e.length,n;return 0<t&&(n=e[this.head++],2*this.head>=t&&(this.elements=e.slice(this.head),this.head=0)),n}},{key:\"clear\",value:function(){this.elements=[],this.head=0}},{key:\"size\",get:function(){return this.elements.length-this.head}},{key:\"empty\",get:function(){return 0===this.elements.length}}]),t}(),Ue=function t(n){e(this,t),this.type=n,this.target=null},Ye=function(){function t(){e(this,t),this.listenerFunctions=new Map,this.listenerObjects=new Map}return n(t,[{key:\"addEventListener\",value:function(e,t){var n=\"function\"==typeof t?this.listenerFunctions:this.listenerObjects;n.has(e)?n.get(e).add(t):n.set(e,new Set([t]))}},{key:\"removeEventListener\",value:function(e,t){var n=\"function\"==typeof t?this.listenerFunctions:this.listenerObjects,a;n.has(e)&&(a=n.get(e),a[\"delete\"](t),0===a.size&&n[\"delete\"](e))}},{key:\"dispatchEvent\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this,n=t.listenerFunctions,a=t.listenerObjects,i,s;if(e.target=t,n.has(e.type)){i=n.get(e.type);var r=!0,o=!1,l=void 0;try{for(var u=i[Symbol.iterator](),y;!(r=(y=u.next()).done);r=!0)s=y.value,s.call(t,e)}catch(e){o=!0,l=e}finally{try{r||null==u[\"return\"]||u[\"return\"]()}finally{if(o)throw l}}}if(a.has(e.type)){i=a.get(e.type);var h=!0,c=!1,d=void 0;try{for(var m=i[Symbol.iterator](),v;!(h=(v=m.next()).done);h=!0)s=v.value,s.handleEvent(e)}catch(e){c=!0,d=e}finally{try{h||null==m[\"return\"]||m[\"return\"]()}finally{if(c)throw d}}}}}]),t}(),Xe={UNION:\"csg.union\",DIFFERENCE:\"csg.difference\",INTERSECTION:\"csg.intersection\",DENSITY_FUNCTION:\"csg.densityfunction\"},je=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.x=n,this.y=a,this.z=i}return n(t,[{key:\"set\",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:\"setFromSpherical\",value:function(e){this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:\"setFromSphericalCoords\",value:function(e,t,n){var a=Ee(t)*e;return this.x=a*Ee(n),this.y=Ae(t)*e,this.z=a*Ae(n),this}},{key:\"setFromCylindrical\",value:function(e){this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:\"setFromCylindricalCoords\",value:function(e,t,n){return this.x=e*Ee(t),this.y=n,this.z=e*Ae(t),this}},{key:\"setFromMatrixColumn\",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:\"setFromMatrixPosition\",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:\"setFromMatrixScale\",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),a=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=a,this}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:\"addVectors\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:\"addScaledVector\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:\"subVectors\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:\"multiplyVectors\",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this}},{key:\"crossVectors\",value:function(e,t){var n=e.x,a=e.y,i=e.z,s=t.x,r=t.y,o=t.z;return this.x=a*o-i*r,this.y=i*s-n*o,this.z=n*r-a*s,this}},{key:\"cross\",value:function(e){return this.crossVectors(this,e)}},{key:\"transformDirection\",value:function(t){var n=this.x,a=this.y,i=this.z,s=t.elements;return this.x=s[0]*n+s[4]*a+s[8]*i,this.y=s[1]*n+s[5]*a+s[9]*i,this.z=s[2]*n+s[6]*a+s[10]*i,this.normalize()}},{key:\"applyMatrix3\",value:function(t){var n=this.x,a=this.y,i=this.z,s=t.elements;return this.x=s[0]*n+s[3]*a+s[6]*i,this.y=s[1]*n+s[4]*a+s[7]*i,this.z=s[2]*n+s[5]*a+s[8]*i,this}},{key:\"applyMatrix4\",value:function(t){var n=this.x,a=this.y,i=this.z,s=t.elements;return this.x=s[0]*n+s[4]*a+s[8]*i+s[12],this.y=s[1]*n+s[5]*a+s[9]*i+s[13],this.z=s[2]*n+s[6]*a+s[10]*i+s[14],this}},{key:\"applyQuaternion\",value:function(e){var t=this.x,n=this.y,a=this.z,i=e.x,s=e.y,r=e.z,o=e.w,l=o*t+s*a-r*n,u=o*n+r*t-i*a,y=o*a+i*n-s*t,h=-i*t-s*n-r*a;return this.x=l*o+h*-i+u*-r-y*-s,this.y=u*o+h*-s+y*-i-l*-r,this.z=y*o+h*-r+l*-s-u*-i,this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:\"reflect\",value:function(e){var t=e.x,n=e.y,a=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(t,n,a),this}},{key:\"angleTo\",value:function(e){var t=this.dot(e)/be(this.lengthSquared()*e.lengthSquared());return Ce(Me(Le(t,-1),1))}},{key:\"manhattanLength\",value:function(){return Oe(this.x)+Oe(this.y)+Oe(this.z)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:\"length\",value:function(){return be(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:\"manhattanDistanceTo\",value:function(e){return Oe(this.x-e.x)+Oe(this.y-e.y)+Oe(this.z-e.z)}},{key:\"distanceToSquared\",value:function(e){var t=this.x-e.x,n=this.y-e.y,a=this.z-e.z;return t*t+n*n+a*a}},{key:\"distanceTo\",value:function(e){return be(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=Me(this.x,e.x),this.y=Me(this.y,e.y),this.z=Me(this.z,e.z),this}},{key:\"max\",value:function(e){return this.x=Le(this.x,e.x),this.y=Le(this.y,e.y),this.z=Le(this.z,e.z),this}},{key:\"clamp\",value:function(e,t){return this.x=Le(e.x,Me(t.x,this.x)),this.y=Le(e.y,Me(t.y,this.y)),this.z=Le(e.z,Me(t.z,this.z)),this}},{key:\"floor\",value:function(){return this.x=De(this.x),this.y=De(this.y),this.z=De(this.z),this}},{key:\"ceil\",value:function(){return this.x=Fe(this.x),this.y=Fe(this.y),this.z=Fe(this.z),this}},{key:\"round\",value:function(){return this.x=Pe(this.x),this.y=Pe(this.y),this.z=Pe(this.z),this}},{key:\"lerp\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:\"lerpVectors\",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}]),t}(),Ze=new je,o=[new je,new je,new je,new je,new je,new je,new je,new je],v=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je(1/0,1/0,1/0),a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new je(-Infinity,-Infinity,-Infinity);e(this,t),this.min=n,this.max=a}return n(t,[{key:\"set\",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:\"copy\",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"makeEmpty\",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-Infinity,this}},{key:\"isEmpty\",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getSize\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:\"setFromSphere\",value:function(e){return this.set(e.center,e.center),this.expandByScalar(e.radius),this}},{key:\"expandByPoint\",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:\"expandByVector\",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:\"expandByScalar\",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:\"setFromPoints\",value:function(e){var t,n;for(this.min.set(0,0,0),this.max.set(0,0,0),(t=0,n=e.length);t<n;++t)this.expandByPoint(e[t]);return this}},{key:\"setFromCenterAndSize\",value:function(e,t){var n=Ze.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:\"clampPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new je;return t.copy(e).clamp(this.min,this.max)}},{key:\"distanceToPoint\",value:function(e){var t=Ze.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:\"applyMatrix4\",value:function(e){var t=this.min,n=this.max;return this.isEmpty()||(o[0].set(t.x,t.y,t.z).applyMatrix4(e),o[1].set(t.x,t.y,n.z).applyMatrix4(e),o[2].set(t.x,n.y,t.z).applyMatrix4(e),o[3].set(t.x,n.y,n.z).applyMatrix4(e),o[4].set(n.x,t.y,t.z).applyMatrix4(e),o[5].set(n.x,t.y,n.z).applyMatrix4(e),o[6].set(n.x,n.y,t.z).applyMatrix4(e),o[7].set(n.x,n.y,n.z).applyMatrix4(e),this.setFromPoints(o)),this}},{key:\"translate\",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:\"intersect\",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:\"union\",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:\"containsPoint\",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=n.x&&e.y<=n.y&&e.z<=n.z}},{key:\"containsBox\",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return t.x<=a.x&&i.x<=n.x&&t.y<=a.y&&i.y<=n.y&&t.z<=a.z&&i.z<=n.z}},{key:\"intersectsBox\",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&i.z>=t.z&&a.x<=n.x&&a.y<=n.y&&a.z<=n.z}},{key:\"intersectsSphere\",value:function(e){var t=this.clampPoint(e.center,Ze);return t.distanceToSquared(e.center)<=e.radius*e.radius}},{key:\"intersectsPlane\",value:function(e){var t,n;return 0<e.normal.x?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:\"equals\",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),t}(),Ge=new v,_e=new je,Ke=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.center=n,this.radius=a}return n(t,[{key:\"set\",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:\"copy\",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromPoints\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Ge.setFromPoints(e).getCenter(this.center),n=0,a,s;for(a=0,s=e.length;a<s;++a)n=Le(n,t.distanceToSquared(e[a]));return this.radius=be(n),this}},{key:\"setFromBox\",value:function(e){return e.getCenter(this.center),this.radius=.5*e.getSize(_e).length(),this}},{key:\"isEmpty\",value:function(){return 0>=this.radius}},{key:\"translate\",value:function(e){return this.center.add(e),this}},{key:\"clampPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new je,n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:\"distanceToPoint\",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:\"containsPoint\",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:\"intersectsSphere\",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:\"intersectsBox\",value:function(e){return e.intersectsSphere(this)}},{key:\"intersectsPlane\",value:function(e){return Oe(e.distanceToPoint(this.center))<=this.radius}},{key:\"equals\",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}]),t}(),Qe=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.x=n,this.y=a}return n(t,[{key:\"set\",value:function(e,t){return this.x=e,this.y=t,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this}},{key:\"addVectors\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:\"addScaledVector\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this}},{key:\"subVectors\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this}},{key:\"applyMatrix3\",value:function(t){var n=this.x,a=this.y,i=t.elements;return this.x=i[0]*n+i[3]*a+i[6],this.y=i[1]*n+i[4]*a+i[7],this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y}},{key:\"cross\",value:function(e){return this.x*e.y-this.y*e.x}},{key:\"manhattanLength\",value:function(){return Oe(this.x)+Oe(this.y)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y}},{key:\"length\",value:function(){return be(this.x*this.x+this.y*this.y)}},{key:\"manhattanDistanceTo\",value:function(e){return Oe(this.x-e.x)+Oe(this.y-e.y)}},{key:\"distanceToSquared\",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:\"distanceTo\",value:function(e){return be(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=Me(this.x,e.x),this.y=Me(this.y,e.y),this}},{key:\"max\",value:function(e){return this.x=Le(this.x,e.x),this.y=Le(this.y,e.y),this}},{key:\"clamp\",value:function(e,t){return this.x=Le(e.x,Me(t.x,this.x)),this.y=Le(e.y,Me(t.y,this.y)),this}},{key:\"floor\",value:function(){return this.x=De(this.x),this.y=De(this.y),this}},{key:\"ceil\",value:function(){return this.x=Fe(this.x),this.y=Fe(this.y),this}},{key:\"round\",value:function(){return this.x=Pe(this.x),this.y=Pe(this.y),this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:\"angle\",value:function e(){var e=Te(this.y,this.x);return 0>e&&(e+=2*Ie),e}},{key:\"lerp\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:\"lerpVectors\",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:\"rotateAround\",value:function(e,t){var n=Ae(t),a=Ee(t),i=this.x-e.x,s=this.y-e.y;return this.x=i*n-s*a+e.x,this.y=i*a+s*n+e.y,this}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y}},{key:\"width\",get:function(){return this.x},set:function(e){return this.x=e}},{key:\"height\",get:function(){return this.y},set:function(e){return this.y=e}}]),t}(),We=new Qe,He=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qe(1/0,1/0),a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Qe(-Infinity,-Infinity);e(this,t),this.min=n,this.max=a}return n(t,[{key:\"set\",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:\"copy\",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"makeEmpty\",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-Infinity,this}},{key:\"isEmpty\",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qe;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getSize\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qe;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:\"getBoundingSphere\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Ke;return this.getCenter(e.center),e.radius=.5*this.getSize(We).length(),e}},{key:\"expandByPoint\",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:\"expandByVector\",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:\"expandByScalar\",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:\"setFromPoints\",value:function(e){var t,n;for(this.min.set(0,0),this.max.set(0,0),(t=0,n=e.length);t<n;++t)this.expandByPoint(e[t]);return this}},{key:\"setFromCenterAndSize\",value:function(e,t){var n=We.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:\"clampPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Qe;return t.copy(e).clamp(this.min,this.max)}},{key:\"distanceToPoint\",value:function(e){var t=We.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:\"translate\",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:\"intersect\",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:\"union\",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:\"containsPoint\",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.x<=n.x&&e.y<=n.y}},{key:\"containsBox\",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return t.x<=a.x&&i.x<=n.x&&t.y<=a.y&&i.y<=n.y}},{key:\"intersectsBox\",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&a.x<=n.x&&a.y<=n.y}},{key:\"equals\",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),t}(),Je=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.radius=n,this.theta=a,this.y=i}return n(t,[{key:\"set\",value:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}},{key:\"copy\",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromVector3\",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:\"setFromCartesianCoords\",value:function(e,t,n){return this.radius=be(e*e+n*n),this.theta=Te(e,n),this.y=t,this}}]),t}(),$e=function(){function t(){e(this,t),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return n(t,[{key:\"set\",value:function(e,t,n,a,i,s,r,o,l){var u=this.elements;return u[0]=e,u[3]=t,u[6]=n,u[1]=a,u[4]=i,u[7]=s,u[2]=r,u[5]=o,u[8]=l,this}},{key:\"identity\",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:\"copy\",value:function(e){var t=e.elements,n=this.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],this}},{key:\"clone\",value:function(){return new this.constructor().fromArray(this.elements)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a;for(a=0;9>a;++a)n[a]=e[a+t];return this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a;for(a=0;9>a;++a)e[a+t]=n[a];return e}},{key:\"multiplyMatrices\",value:function(e,t){var n=e.elements,a=t.elements,i=this.elements,s=n[0],r=n[3],o=n[6],l=n[1],u=n[4],y=n[7],h=n[2],c=n[5],d=n[8],m=a[0],v=a[3],g=a[6],x=a[1],p=a[4],f=a[7],k=a[2],z=a[5],w=a[8];return i[0]=s*m+r*x+o*k,i[3]=s*v+r*p+o*z,i[6]=s*g+r*f+o*w,i[1]=l*m+u*x+y*k,i[4]=l*v+u*p+y*z,i[7]=l*g+u*f+y*w,i[2]=h*m+c*x+d*k,i[5]=h*v+c*p+d*z,i[8]=h*g+c*f+d*w,this}},{key:\"multiply\",value:function(e){return this.multiplyMatrices(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyMatrices(e,this)}},{key:\"multiplyScalar\",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:\"determinant\",value:function(){var t=this.elements,n=t[0],a=t[1],s=t[2],r=t[3],o=t[4],e=t[5],l=t[6],u=t[7],y=t[8];return n*o*y-n*e*u-a*r*y+a*e*l+s*r*u-s*o*l}},{key:\"getInverse\",value:function(e){var t=e.elements,n=this.elements,a=t[0],i=t[1],s=t[2],r=t[3],o=t[4],l=t[5],u=t[6],y=t[7],h=t[8],c=h*o-l*y,d=l*u-h*r,m=y*r-o*u,v=a*c+i*d+s*m,g;return 0===v?(console.error(\"Can't invert matrix, determinant is zero\",e),this.identity()):(g=1/v,n[0]=c*g,n[1]=(s*y-h*i)*g,n[2]=(l*i-s*o)*g,n[3]=d*g,n[4]=(h*a-s*u)*g,n[5]=(s*r-l*a)*g,n[6]=m*g,n[7]=(i*u-y*a)*g,n[8]=(o*a-i*r)*g),this}},{key:\"transpose\",value:function(){var e=this.elements,n;return n=e[1],e[1]=e[3],e[3]=n,n=e[2],e[2]=e[6],e[6]=n,n=e[5],e[5]=e[7],e[7]=n,this}},{key:\"scale\",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:\"rotate\",value:function(e){var t=Ae(e),n=Ee(e),a=this.elements,i=a[0],s=a[3],r=a[6],o=a[1],l=a[4],u=a[7];return a[0]=t*i+n*o,a[3]=t*s+n*l,a[6]=t*r+n*u,a[1]=-n*i+t*o,a[4]=-n*s+t*l,a[7]=-n*r+t*u,this}},{key:\"translate\",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:\"equals\",value:function(e){var t=this.elements,n=e.elements,a=!0,s;for(s=0;a&&9>s;++s)t[s]!==n[s]&&(a=!1);return a}}]),t}(),et={XYZ:\"XYZ\",YZX:\"YZX\",ZXY:\"ZXY\",XZY:\"XZY\",YXZ:\"YXZ\",ZYX:\"ZYX\"},tt=new je,nt=function(){var a=Number.EPSILON;function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;e(this,t),this.x=n,this.y=a,this.z=i,this.w=s}return n(t,[{key:\"set\",value:function(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.w=a,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:\"setFromEuler\",value:function(e){var t=e.x,n=e.y,a=e.z,i=Ae,s=Ee,r=i(t/2),o=i(n/2),l=i(a/2),u=s(t/2),y=s(n/2),h=s(a/2);switch(e.order){case et.XYZ:this.x=u*o*l+r*y*h,this.y=r*y*l-u*o*h,this.z=r*o*h+u*y*l,this.w=r*o*l-u*y*h;break;case et.YXZ:this.x=u*o*l+r*y*h,this.y=r*y*l-u*o*h,this.z=r*o*h-u*y*l,this.w=r*o*l+u*y*h;break;case et.ZXY:this.x=u*o*l-r*y*h,this.y=r*y*l+u*o*h,this.z=r*o*h+u*y*l,this.w=r*o*l-u*y*h;break;case et.ZYX:this.x=u*o*l-r*y*h,this.y=r*y*l+u*o*h,this.z=r*o*h-u*y*l,this.w=r*o*l+u*y*h;break;case et.YZX:this.x=u*o*l+r*y*h,this.y=r*y*l+u*o*h,this.z=r*o*h-u*y*l,this.w=r*o*l-u*y*h;break;case et.XZY:this.x=u*o*l-r*y*h,this.y=r*y*l-u*o*h,this.z=r*o*h+u*y*l,this.w=r*o*l+u*y*h;}return this}},{key:\"setFromAxisAngle\",value:function(e,t){var n=t/2,a=Ee(n);return this.x=e.x*a,this.y=e.y*a,this.z=e.z*a,this.w=Ae(n),this}},{key:\"setFromRotationMatrix\",value:function(e){var t=e.elements,n=t[0],a=t[4],i=t[8],r=t[1],o=t[5],l=t[9],u=t[2],y=t[6],h=t[10],c=n+o+h,d;return 0<c?(d=.5/be(c+1),this.w=.25/d,this.x=(y-l)*d,this.y=(i-u)*d,this.z=(r-a)*d):n>o&&n>h?(d=2*be(1+n-o-h),this.w=(y-l)/d,this.x=.25*d,this.y=(a+r)/d,this.z=(i+u)/d):o>h?(d=2*be(1+o-n-h),this.w=(i-u)/d,this.x=(a+r)/d,this.y=.25*d,this.z=(l+y)/d):(d=2*be(1+h-n-o),this.w=(r-a)/d,this.x=(i+u)/d,this.y=(l+y)/d,this.z=.25*d),this}},{key:\"setFromUnitVectors\",value:function(e,t){var n=e.dot(t)+1;return 1e-6>n?(n=0,Oe(e.x)>Oe(e.z)?tt.set(-e.y,e.x,0):tt.set(0,-e.z,e.y)):tt.crossVectors(e,t),this.x=tt.x,this.y=tt.y,this.z=tt.z,this.w=n,this.normalize()}},{key:\"angleTo\",value:function(e){return 2*Ce(Oe(Me(Le(this.dot(e),-1),1)))}},{key:\"rotateTowards\",value:function(e,t){var n=this.angleTo(e);return 0!==n&&this.slerp(e,Me(1,t/n)),this}},{key:\"invert\",value:function(){return this.conjugate()}},{key:\"conjugate\",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:\"length\",value:function(){return be(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:\"normalize\",value:function(){var e=this.length(),t;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/e,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:\"multiplyQuaternions\",value:function(e,t){var n=e.x,a=e.y,i=e.z,s=e.w,r=t.x,o=t.y,l=t.z,u=t.w;return this.x=n*u+s*r+a*l-i*o,this.y=a*u+s*o+i*r-n*l,this.z=i*u+s*l+n*o-a*r,this.w=s*u-n*r-a*o-i*l,this}},{key:\"multiply\",value:function(e){return this.multiplyQuaternions(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyQuaternions(e,this)}},{key:\"slerp\",value:function(e,n){var t=this.x,i=this.y,r=this.z,o=this.w,l,u,y,h,c,d,m;return 1===n?this.copy(e):0<n&&(l=o*e.w+t*e.x+i*e.y+r*e.z,0>l?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,l=-l):this.copy(e),1<=l?(this.w=o,this.x=t,this.y=i,this.z=r):(u=1-l*l,c=1-n,u<=a?(this.w=c*o+n*this.w,this.x=c*t+n*this.x,this.y=c*i+n*this.y,this.z=c*r+n*this.z,this.normalize()):(y=be(u),h=Te(y,l),d=Ee(c*h)/y,m=Ee(n*h)/y,this.w=o*d+this.w*m,this.x=t*d+this.x*m,this.y=i*d+this.y*m,this.z=r*d+this.z*m))),this}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}],[{key:\"slerp\",value:function(e,n,a,i){return a.copy(e).slerp(n,i)}},{key:\"slerpFlat\",value:function(e,n,i,r,o,l,u){var y=o[l],h=o[l+1],c=o[l+2],d=o[l+3],m=i[r],v=i[r+1],g=i[r+2],x=i[r+3],p,k,z,w,S,I,T,P;(x!==d||m!==y||v!==h||g!==c)&&(p=1-u,w=m*y+v*h+g*c+x*d,I=0<=w?1:-1,S=1-w*w,S>a&&(z=be(S),T=Te(z,w*I),p=Ee(p*T)/z,u=Ee(u*T)/z),P=u*I,m=m*p+y*P,v=v*p+h*P,g=g*p+c*P,x=x*p+d*P,p===1-u&&(k=1/be(m*m+v*v+g*g+x*x),m*=k,v*=k,g*=k,x*=k)),e[n]=m,e[n+1]=v,e[n+2]=g,e[n+3]=x}}]),t}(),at=new $e,m=new nt,q=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.x=n,this.y=a,this.z=i,this.order=t.defaultOrder}return n(t,[{key:\"set\",value:function(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.order=a,this}},{key:\"copy\",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.order=e[t+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.order,e}},{key:\"toVector3\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je;return e.set(this.x,this.y,this.z)}},{key:\"setFromRotationMatrix\",value:function(e){var t=Math.asin,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order,a=e.elements,i=a[0],s=a[4],r=a[8],o=a[1],l=a[5],u=a[9],y=a[2],h=a[6],c=a[10],d=1-1e-5;switch(n){case et.XYZ:{this.y=t(D(r,-1,1)),Oe(r)<d?(this.x=Te(-u,c),this.z=Te(-s,i)):(this.x=Te(h,l),this.z=0);break}case et.YXZ:{this.x=t(-D(u,-1,1)),Oe(u)<d?(this.y=Te(r,c),this.z=Te(o,l)):(this.y=Te(-y,i),this.z=0);break}case et.ZXY:{this.x=t(D(h,-1,1)),Oe(h)<d?(this.y=Te(-y,c),this.z=Te(-s,l)):(this.y=0,this.z=Te(o,i));break}case et.ZYX:{this.y=t(-D(y,-1,1)),Oe(y)<d?(this.x=Te(h,c),this.z=Te(o,i)):(this.x=0,this.z=Te(-s,l));break}case et.YZX:{this.z=t(D(o,-1,1)),Oe(o)<d?(this.x=Te(-u,l),this.y=Te(-y,i)):(this.x=0,this.y=Te(r,c));break}case et.XZY:{this.z=t(-D(s,-1,1)),Oe(s)<d?(this.x=Te(h,l),this.y=Te(r,i)):(this.x=Te(-u,c),this.y=0);break}}return this.order=n,this}},{key:\"setFromQuaternion\",value:function(e,t){return at.makeRotationFromQuaternion(e),this.setFromRotationMatrix(at,t)}},{key:\"setFromVector3\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(e.x,e.y,e.z,t)}},{key:\"reorder\",value:function(e){return m.setFromEuler(this),this.setFromQuaternion(m,e)}},{key:\"equals\",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order}}],[{key:\"defaultOrder\",get:function(){return et.XYZ}}]),t}(),it=new je,a=new je,b=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je(1,0,0),a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.normal=n,this.constant=a}return n(t,[{key:\"set\",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:\"setComponents\",value:function(e,t,n,a){return this.normal.set(e,t,n),this.constant=a,this}},{key:\"copy\",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromNormalAndCoplanarPoint\",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:\"setFromCoplanarPoints\",value:function(e,t,n){var i=it.subVectors(n,t).cross(a.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,it),this}},{key:\"normalize\",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:\"negate\",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:\"distanceToPoint\",value:function(e){return this.normal.dot(e)+this.constant}},{key:\"distanceToSphere\",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:\"projectPoint\",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:\"coplanarPoint\",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:\"translate\",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:\"intersectLine\",value:function(e,n){var a=e.delta(it),i=this.normal.dot(a);if(0===i)0===this.distanceToPoint(e.start)&&n.copy(e.start);else{var s=-(e.start.dot(this.normal)+this.constant)/i;0<=s&&1>=s&&n.copy(a).multiplyScalar(s).add(e.start)}return n}},{key:\"intersectsLine\",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return 0>t&&0<n||0>n&&0<t}},{key:\"intersectsBox\",value:function(e){return e.intersectsPlane(this)}},{key:\"intersectsSphere\",value:function(e){return e.intersectsPlane(this)}},{key:\"equals\",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}]),t}(),st=new je,rt=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new b,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new b,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new b,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new b,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new b,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new b;e(this,t),this.planes=[n,a,i,s,r,o]}return n(t,[{key:\"set\",value:function(e,t,n,a,i,s){var r=this.planes;return r[0].copy(e),r[1].copy(t),r[2].copy(n),r[3].copy(a),r[4].copy(i),r[5].copy(s),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"copy\",value:function(e){var t=this.planes,n;for(n=0;6>n;++n)t[n].copy(e.planes[n]);return this}},{key:\"setFromMatrix\",value:function(e){var t=this.planes,n=e.elements,a=n[0],i=n[1],s=n[2],r=n[3],o=n[4],l=n[5],u=n[6],y=n[7],h=n[8],c=n[9],d=n[10],m=n[11],v=n[12],g=n[13],x=n[14],p=n[15];return t[0].setComponents(r-a,y-o,m-h,p-v).normalize(),t[1].setComponents(r+a,y+o,m+h,p+v).normalize(),t[2].setComponents(r+i,y+l,m+c,p+g).normalize(),t[3].setComponents(r-i,y-l,m-c,p-g).normalize(),t[4].setComponents(r-s,y-u,m-d,p-x).normalize(),t[5].setComponents(r+s,y+u,m+d,p+x).normalize(),this}},{key:\"intersectsSphere\",value:function(e){var t=this.planes,n=e.center,a=-e.radius,s=!0,r,o;for(r=0;6>r;++r)if(o=t[r].distanceToPoint(n),o<a){s=!1;break}return s}},{key:\"intersectsBox\",value:function(e){var t=this.planes,n=e.min,a=e.max,s,r;for(s=0;6>s;++s)if(r=t[s],st.x=0<r.normal.x?a.x:n.x,st.y=0<r.normal.y?a.y:n.y,st.z=0<r.normal.z?a.z:n.z,0>r.distanceToPoint(st))return!1;return!0}},{key:\"containsPoint\",value:function(e){var t=this.planes,n=!0,a;for(a=0;6>a;++a)if(0>t[a].distanceToPoint(e)){n=!1;break}return n}}]),t}(),ot=new je,lt=new je,ut=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new je;e(this,t),this.start=n,this.end=a}return n(t,[{key:\"set\",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:\"copy\",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je;return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:\"delta\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je;return e.subVectors(this.end,this.start)}},{key:\"lengthSquared\",value:function(){return this.start.distanceToSquared(this.end)}},{key:\"length\",value:function(){return this.start.distanceTo(this.end)}},{key:\"at\",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:\"closestPointToPointParameter\",value:function(e,n){ot.subVectors(e,this.start),lt.subVectors(this.end,this.start);var a=lt.dot(lt),i=lt.dot(ot),s=n?Me(Le(i/a,0),1):i/a;return s}},{key:\"closestPointToPoint\",value:function(e){var n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new je,i=this.closestPointToPointParameter(e,n);return this.delta(a).multiplyScalar(i).add(this.start)}},{key:\"equals\",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}]),t}(),yt=new je,ht=new je,ct=new je,c=function(){function t(){e(this,t),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return n(t,[{key:\"set\",value:function(e,t,n,a,i,s,r,o,l,u,y,h,c,d,m,v){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=a,g[1]=i,g[5]=s,g[9]=r,g[13]=o,g[2]=l,g[6]=u,g[10]=y,g[14]=h,g[3]=c,g[7]=d,g[11]=m,g[15]=v,this}},{key:\"identity\",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:\"copy\",value:function(e){var t=e.elements,n=this.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],this}},{key:\"clone\",value:function(){return new this.constructor().fromArray(this.elements)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a;for(a=0;16>a;++a)n[a]=e[a+t];return this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a;for(a=0;16>a;++a)e[a+t]=n[a];return e}},{key:\"getMaxScaleOnAxis\",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],a=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return be(Le(t,n,a))}},{key:\"copyPosition\",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:\"setPosition\",value:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}},{key:\"extractBasis\",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:\"makeBasis\",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:\"extractRotation\",value:function(e){var t=this.elements,n=e.elements,a=1/yt.setFromMatrixColumn(e,0).length(),i=1/yt.setFromMatrixColumn(e,1).length(),s=1/yt.setFromMatrixColumn(e,2).length();return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:\"makeRotationFromEuler\",value:function(t){var n=this.elements,i=t.x,s=t.y,r=t.z,o=Ae(i),a=Ee(i),l=Ae(s),u=Ee(s),y=Ae(r),e=Ee(r),h,c,d,m,v,g,x,p,f,k,z,w;switch(t.order){case et.XYZ:{h=o*y,c=o*e,d=a*y,m=a*e,n[0]=l*y,n[4]=-l*e,n[8]=u,n[1]=c+d*u,n[5]=h-m*u,n[9]=-a*l,n[2]=m-h*u,n[6]=d+c*u,n[10]=o*l;break}case et.YXZ:{v=l*y,g=l*e,x=u*y,p=u*e,n[0]=v+p*a,n[4]=x*a-g,n[8]=o*u,n[1]=o*e,n[5]=o*y,n[9]=-a,n[2]=g*a-x,n[6]=p+v*a,n[10]=o*l;break}case et.ZXY:{v=l*y,g=l*e,x=u*y,p=u*e,n[0]=v-p*a,n[4]=-o*e,n[8]=x+g*a,n[1]=g+x*a,n[5]=o*y,n[9]=p-v*a,n[2]=-o*u,n[6]=a,n[10]=o*l;break}case et.ZYX:{h=o*y,c=o*e,d=a*y,m=a*e,n[0]=l*y,n[4]=d*u-c,n[8]=h*u+m,n[1]=l*e,n[5]=m*u+h,n[9]=c*u-d,n[2]=-u,n[6]=a*l,n[10]=o*l;break}case et.YZX:{f=o*l,k=o*u,z=a*l,w=a*u,n[0]=l*y,n[4]=w-f*e,n[8]=z*e+k,n[1]=e,n[5]=o*y,n[9]=-a*y,n[2]=-u*y,n[6]=k*e+z,n[10]=f-w*e;break}case et.XZY:{f=o*l,k=o*u,z=a*l,w=a*u,n[0]=l*y,n[4]=-e,n[8]=u*y,n[1]=f*e+w,n[5]=o*y,n[9]=k*e-z,n[2]=z*e-k,n[6]=a*y,n[10]=w*e+f;break}}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}},{key:\"makeRotationFromQuaternion\",value:function(e){return this.compose(yt.set(0,0,0),e,ht.set(1,1,1))}},{key:\"lookAt\",value:function(e,t,n){var a=this.elements,i=yt,s=ht,r=ct;return r.subVectors(e,t),0===r.lengthSquared()&&(r.z=1),r.normalize(),i.crossVectors(n,r),0===i.lengthSquared()&&(1===Oe(n.z)?r.x+=1e-4:r.z+=1e-4,r.normalize(),i.crossVectors(n,r)),i.normalize(),s.crossVectors(r,i),a[0]=i.x,a[4]=s.x,a[8]=r.x,a[1]=i.y,a[5]=s.y,a[9]=r.y,a[2]=i.z,a[6]=s.z,a[10]=r.z,this}},{key:\"multiplyMatrices\",value:function(e,t){var n=this.elements,a=e.elements,i=t.elements,s=a[0],r=a[4],o=a[8],l=a[12],u=a[1],y=a[5],h=a[9],c=a[13],d=a[2],m=a[6],v=a[10],g=a[14],x=a[3],p=a[7],f=a[11],k=a[15],z=i[0],w=i[4],S=i[8],I=i[12],T=i[1],P=i[5],C=i[9],b=i[13],A=i[2],E=i[6],D=i[10],F=i[14],O=i[3],L=i[7],M=i[11],B=i[15];return n[0]=s*z+r*T+o*A+l*O,n[4]=s*w+r*P+o*E+l*L,n[8]=s*S+r*C+o*D+l*M,n[12]=s*I+r*b+o*F+l*B,n[1]=u*z+y*T+h*A+c*O,n[5]=u*w+y*P+h*E+c*L,n[9]=u*S+y*C+h*D+c*M,n[13]=u*I+y*b+h*F+c*B,n[2]=d*z+m*T+v*A+g*O,n[6]=d*w+m*P+v*E+g*L,n[10]=d*S+m*C+v*D+g*M,n[14]=d*I+m*b+v*F+g*B,n[3]=x*z+p*T+f*A+k*O,n[7]=x*w+p*P+f*E+k*L,n[11]=x*S+p*C+f*D+k*M,n[15]=x*I+p*b+f*F+k*B,this}},{key:\"multiply\",value:function(e){return this.multiplyMatrices(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyMatrices(e,this)}},{key:\"multiplyScalar\",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:\"determinant\",value:function(){var e=this.elements,t=e[0],n=e[4],a=e[8],i=e[12],s=e[1],r=e[5],o=e[9],l=e[13],u=e[2],y=e[6],h=e[10],c=e[14],d=e[3],m=e[7],v=e[11],g=e[15],x=t*r,p=t*o,f=t*l,k=n*s,z=n*o,w=n*l,S=a*s,I=a*r,T=a*l,P=i*s,C=i*r,b=i*o;return d*(b*y-T*y-C*h+w*h+I*c-z*c)+m*(p*c-f*h+P*h-S*c+T*u-b*u)+v*(f*y-x*c-P*y+k*c+C*u-w*u)+g*(-I*u-p*y+x*h+S*y-k*h+z*u)}},{key:\"getInverse\",value:function(e){var t=this.elements,n=e.elements,a=n[0],i=n[1],s=n[2],r=n[3],o=n[4],l=n[5],u=n[6],y=n[7],h=n[8],c=n[9],d=n[10],m=n[11],v=n[12],g=n[13],x=n[14],p=n[15],f=c*x*y-g*d*y+g*u*m-l*x*m-c*u*p+l*d*p,k=v*d*y-h*x*y-v*u*m+o*x*m+h*u*p-o*d*p,z=h*g*y-v*c*y+v*l*m-o*g*m-h*l*p+o*c*p,w=v*c*u-h*g*u-v*l*d+o*g*d+h*l*x-o*c*x,S=a*f+i*k+s*z+r*w,I;return 0===S?(console.error(\"Can't invert matrix, determinant is zero\",e),this.identity()):(I=1/S,t[0]=f*I,t[1]=(g*d*r-c*x*r-g*s*m+i*x*m+c*s*p-i*d*p)*I,t[2]=(l*x*r-g*u*r+g*s*y-i*x*y-l*s*p+i*u*p)*I,t[3]=(c*u*r-l*d*r-c*s*y+i*d*y+l*s*m-i*u*m)*I,t[4]=k*I,t[5]=(h*x*r-v*d*r+v*s*m-a*x*m-h*s*p+a*d*p)*I,t[6]=(v*u*r-o*x*r-v*s*y+a*x*y+o*s*p-a*u*p)*I,t[7]=(o*d*r-h*u*r+h*s*y-a*d*y-o*s*m+a*u*m)*I,t[8]=z*I,t[9]=(v*c*r-h*g*r-v*i*m+a*g*m+h*i*p-a*c*p)*I,t[10]=(o*g*r-v*l*r+v*i*y-a*g*y-o*i*p+a*l*p)*I,t[11]=(h*l*r-o*c*r-h*i*y+a*c*y+o*i*m-a*l*m)*I,t[12]=w*I,t[13]=(h*g*s-v*c*s+v*i*d-a*g*d-h*i*x+a*c*x)*I,t[14]=(v*l*s-o*g*s-v*i*u+a*g*u+o*i*x-a*l*x)*I,t[15]=(o*c*s-h*l*s+h*i*u-a*c*u-o*i*d+a*l*d)*I),this}},{key:\"transpose\",value:function(){var e=this.elements,n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}},{key:\"scale\",value:function(e,t,n){var a=this.elements;return a[0]*=e,a[4]*=t,a[8]*=n,a[1]*=e,a[5]*=t,a[9]*=n,a[2]*=e,a[6]*=t,a[10]*=n,a[3]*=e,a[7]*=t,a[11]*=n,this}},{key:\"makeScale\",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:\"makeTranslation\",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:\"makeRotationX\",value:function(e){var t=Ae(e),n=Ee(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:\"makeRotationY\",value:function(e){var t=Ae(e),n=Ee(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:\"makeRotationZ\",value:function(e){var t=Ae(e),n=Ee(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:\"makeRotationAxis\",value:function(e,n){var a=Ae(n),i=Ee(n),s=1-a,t=e.x,r=e.y,o=e.z,l=s*t,u=s*r;return this.set(l*t+a,l*r-i*o,l*o+i*r,0,l*r+i*o,u*r+a,u*o-i*t,0,l*o-i*r,u*o+i*t,s*o*o+a,0,0,0,0,1),this}},{key:\"makeShear\",value:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}},{key:\"compose\",value:function(e,t,n){var a=this.elements,i=t.x,s=t.y,r=t.z,o=t.w,l=i+i,u=s+s,y=r+r,h=i*l,c=i*u,d=i*y,m=s*u,v=s*y,g=r*y,x=o*l,p=o*u,f=o*y,k=n.x,z=n.y,w=n.z;return a[0]=(1-(m+g))*k,a[1]=(c+f)*k,a[2]=(d-p)*k,a[3]=0,a[4]=(c-f)*z,a[5]=(1-(h+g))*z,a[6]=(v+x)*z,a[7]=0,a[8]=(d+p)*w,a[9]=(v-x)*w,a[10]=(1-(h+m))*w,a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1,this}},{key:\"decompose\",value:function(e,t,n){var a=this.elements,i=a[0],s=a[1],r=a[2],o=a[4],l=a[5],u=a[6],y=a[8],h=a[9],c=a[10],d=this.determinant(),m=yt.set(i,s,r).length()*(0>d?-1:1),v=yt.set(o,l,u).length(),g=yt.set(y,h,c).length(),x=1/m,p=1/v,f=1/g;return e.x=a[12],e.y=a[13],e.z=a[14],a[0]*=x,a[1]*=x,a[2]*=x,a[4]*=p,a[5]*=p,a[6]*=p,a[8]*=f,a[9]*=f,a[10]*=f,t.setFromRotationMatrix(this),a[0]=i,a[1]=s,a[2]=r,a[4]=o,a[5]=l,a[6]=u,a[8]=y,a[9]=h,a[10]=c,n.x=m,n.y=v,n.z=g,this}},{key:\"makePerspective\",value:function(e,t,n,a,i,s){var r=this.elements;return r[0]=2*i/(t-e),r[4]=0,r[8]=(t+e)/(t-e),r[12]=0,r[1]=0,r[5]=2*i/(n-a),r[9]=(n+a)/(n-a),r[13]=0,r[2]=0,r[6]=0,r[10]=-(s+i)/(s-i),r[14]=-2*s*i/(s-i),r[3]=0,r[7]=0,r[11]=-1,r[15]=0,this}},{key:\"makeOrthographic\",value:function(e,t,n,a,i,s){var r=this.elements,o=1/(t-e),l=1/(n-a),u=1/(s-i);return r[0]=2*o,r[4]=0,r[8]=0,r[12]=-((t+e)*o),r[1]=0,r[5]=2*l,r[9]=0,r[13]=-((n+a)*l),r[2]=0,r[6]=0,r[10]=-2*u,r[14]=-((s+i)*u),r[3]=0,r[7]=0,r[11]=0,r[15]=1,this}},{key:\"equals\",value:function(e){var t=this.elements,n=e.elements,a=!0,s;for(s=0;a&&16>s;++s)t[s]!==n[s]&&(a=!1);return a}}]),t}(),dt=[new je,new je,new je,new je],mt=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new je;e(this,t),this.origin=n,this.direction=a}return n(t,[{key:\"set\",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:\"copy\",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"at\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new je;return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:\"lookAt\",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:\"recast\",value:function(e){return this.origin.copy(this.at(e,dt[0])),this}},{key:\"closestPointToPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new je,n=t.subVectors(e,this.origin).dot(this.direction);return 0<=n?t.copy(this.direction).multiplyScalar(n).add(this.origin):t.copy(this.origin)}},{key:\"distanceSquaredToPoint\",value:function(e){var t=dt[0].subVectors(e,this.origin).dot(this.direction);return 0>t?this.origin.distanceToSquared(e):dt[0].copy(this.direction).multiplyScalar(t).add(this.origin).distanceToSquared(e)}},{key:\"distanceToPoint\",value:function(e){return be(this.distanceSquaredToPoint(e))}},{key:\"distanceToPlane\",value:function(e){var n=e.normal.dot(this.direction),a=0===n?0===e.distanceToPoint(this.origin)?0:-1:-(this.origin.dot(e.normal)+e.constant)/n;return 0<=a?a:null}},{key:\"distanceSquaredToSegment\",value:function(e,t,n,a){var i=dt[0].copy(e).add(t).multiplyScalar(.5),s=dt[1].copy(t).sub(e).normalize(),r=dt[2].copy(this.origin).sub(i),o=.5*e.distanceTo(t),l=-this.direction.dot(s),u=r.dot(this.direction),y=-r.dot(s),h=r.lengthSq(),c=Oe(1-l*l),d,m,v,g,x;return 0<c?(d=l*y-u,m=l*u-y,v=o*c,0<=d?m>=-v?m<=v?(g=1/c,d*=g,m*=g,x=d*(d+l*m+2*u)+m*(l*d+m+2*y)+h):(m=o,d=Le(0,-(l*m+u)),x=-d*d+m*(m+2*y)+h):(m=-o,d=Le(0,-(l*m+u)),x=-d*d+m*(m+2*y)+h):m<=-v?(d=Le(0,-(-l*o+u)),m=0<d?-o:Me(Le(-o,-y),o),x=-d*d+m*(m+2*y)+h):m<=v?(d=0,m=Me(Le(-o,-y),o),x=m*(m+2*y)+h):(d=Le(0,-(l*o+u)),m=0<d?o:Me(Le(-o,-y),o),x=-d*d+m*(m+2*y)+h)):(m=0<l?-o:o,d=Le(0,-(l*m+u)),x=-d*d+m*(m+2*y)+h),void 0!==n&&n.copy(this.direction).multiplyScalar(d).add(this.origin),void 0!==a&&a.copy(s).multiplyScalar(m).add(i),x}},{key:\"intersectSphere\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new je,n=dt[0].subVectors(e.center,this.origin),a=n.dot(this.direction),i=n.dot(n)-a*a,s=e.radius*e.radius,r=null,o,l,u;return i<=s&&(o=be(s-i),l=a-o,u=a+o,(0<=l||0<=u)&&(r=0>l?this.at(u,t):this.at(l,t))),r}},{key:\"intersectsSphere\",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:\"intersectPlane\",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new je,a=this.distanceToPlane(e);return null===a?null:this.at(a,n)}},{key:\"intersectsPlane\",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t}},{key:\"intersectBox\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new je,n=this.origin,a=this.direction,i=e.min,s=e.max,r=1/a.x,o=1/a.y,l=1/a.z,u=null,y,h,c,d,m,v;return 0<=r?(y=(i.x-n.x)*r,h=(s.x-n.x)*r):(y=(s.x-n.x)*r,h=(i.x-n.x)*r),0<=o?(c=(i.y-n.y)*o,d=(s.y-n.y)*o):(c=(s.y-n.y)*o,d=(i.y-n.y)*o),y<=d&&c<=h&&((c>y||y!==y)&&(y=c),(d<h||h!==h)&&(h=d),0<=l?(m=(i.z-n.z)*l,v=(s.z-n.z)*l):(m=(s.z-n.z)*l,v=(i.z-n.z)*l),y<=v&&m<=h&&((m>y||y!==y)&&(y=m),(v<h||h!==h)&&(h=v),0<=h&&(u=this.at(0<=y?y:h,t)))),u}},{key:\"intersectsBox\",value:function(e){return null!==this.intersectBox(e,dt[0])}},{key:\"intersectTriangle\",value:function(e,t,n,a,i){var s=this.direction,r=dt[0],o=dt[1],l=dt[2],u=dt[3],y=null,h,c,d,m,v;return o.subVectors(t,e),l.subVectors(n,e),u.crossVectors(o,l),h=s.dot(u),0===h||a&&0<h||(0<h?c=1:(c=-1,h=-h),r.subVectors(this.origin,e),d=c*s.dot(l.crossVectors(r,l)),0<=d&&(m=c*s.dot(o.cross(r)),0<=m&&d+m<=h&&(v=-c*r.dot(u),0<=v&&(y=this.at(v/h,i))))),y}},{key:\"applyMatrix4\",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:\"equals\",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),t}(),vt=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.radius=n,this.phi=a,this.theta=i}return n(t,[{key:\"set\",value:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}},{key:\"copy\",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"makeSafe\",value:function(){return this.phi=Le(1e-6,Me(Ie-1e-6,this.phi)),this}},{key:\"setFromVector3\",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:\"setFromCartesianCoords\",value:function(e,t,n){return this.radius=be(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Te(e,n),this.phi=Ce(Me(Le(t/this.radius,-1),1))),this}}]),t}(),gt=function(){function t(){e(this,t),this.elements=new Float32Array([1,0,0,1,0,1])}return n(t,[{key:\"set\",value:function(t,n,a,i,s,r){var o=this.elements;return o[0]=t,o[1]=n,o[3]=i,o[2]=a,o[4]=s,o[5]=r,this}},{key:\"identity\",value:function(){return this.set(1,0,0,1,0,1),this}},{key:\"copy\",value:function(e){var t=e.elements;return this.set(t[0],t[1],t[2],t[3],t[4],t[5]),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"toMatrix3\",value:function(e){var t=e.elements;e.set(t[0],t[1],t[2],t[1],t[3],t[4],t[2],t[4],t[5])}},{key:\"add\",value:function(e){var t=this.elements,n=e.elements;return t[0]+=n[0],t[1]+=n[1],t[3]+=n[3],t[2]+=n[2],t[4]+=n[4],t[5]+=n[5],this}},{key:\"norm\",value:function(){var t=this.elements,e=t[1]*t[1],n=t[2]*t[2],a=t[4]*t[4];return be(t[0]*t[0]+e+n+e+t[3]*t[3]+a+n+a+t[5]*t[5])}},{key:\"off\",value:function(){var t=this.elements;return be(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:\"applyToVector3\",value:function(t){var n=t.x,a=t.y,i=t.z,s=this.elements;return t.x=s[0]*n+s[1]*a+s[2]*i,t.y=s[1]*n+s[3]*a+s[4]*i,t.z=s[2]*n+s[4]*a+s[5]*i,t}},{key:\"equals\",value:function(e){var t=this.elements,n=e.elements,a=!0,s;for(s=0;a&&6>s;++s)t[s]!==n[s]&&(a=!1);return a}}],[{key:\"calculateIndex\",value:function(e,t){return 3-(3-e)*(2-e)/2+t}}]),t}(),xt=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;e(this,t),this.x=n,this.y=a,this.z=i,this.w=s}return n(t,[{key:\"set\",value:function(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.w=a,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:\"setAxisAngleFromQuaternion\",value:function(e){this.w=2*Ce(e.w);var t=be(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:\"setAxisAngleFromRotationMatrix\",value:function(e){var t=.01,n=.1,a=e.elements,i=a[0],r=a[4],o=a[8],l=a[1],u=a[5],h=a[9],c=a[2],d=a[6],m=a[10],v,g,p,f,k,w,S,I,T,P,C;return Oe(r-l)<t&&Oe(o-c)<t&&Oe(h-d)<t?Oe(r+l)<n&&Oe(o+c)<n&&Oe(h+d)<n&&Oe(i+u+m-3)<n?this.set(1,0,0,0):(v=Ie,k=(i+1)/2,w=(u+1)/2,S=(m+1)/2,I=(r+l)/4,T=(o+c)/4,P=(h+d)/4,k>w&&k>S?k<t?(g=0,p=.707106781,f=.707106781):(g=be(k),p=I/g,f=T/g):w>S?w<t?(g=.707106781,p=0,f=.707106781):(p=be(w),g=I/p,f=P/p):S<t?(g=.707106781,p=.707106781,f=0):(f=be(S),g=T/f,p=P/f),this.set(g,p,f,v)):(C=be((d-h)*(d-h)+(o-c)*(o-c)+(l-r)*(l-r)),.001>Oe(C)&&(C=1),this.x=(d-h)/C,this.y=(o-c)/C,this.z=(l-r)/C,this.w=Ce((i+u+m-1)/2)),this}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:\"addVectors\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:\"addScaledVector\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:\"subVectors\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:\"multiplyVectors\",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this.w=e.w*t.w,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this}},{key:\"applyMatrix4\",value:function(t){var n=this.x,a=this.y,i=this.z,s=this.w,r=t.elements;return this.x=r[0]*n+r[4]*a+r[8]*i+r[12]*s,this.y=r[1]*n+r[5]*a+r[9]*i+r[13]*s,this.z=r[2]*n+r[6]*a+r[10]*i+r[14]*s,this.w=r[3]*n+r[7]*a+r[11]*i+r[15]*s,this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:\"manhattanLength\",value:function(){return Oe(this.x)+Oe(this.y)+Oe(this.z)+Oe(this.w)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:\"length\",value:function(){return be(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:\"manhattanDistanceTo\",value:function(e){return Oe(this.x-e.x)+Oe(this.y-e.y)+Oe(this.z-e.z)+Oe(this.w-e.w)}},{key:\"distanceToSquared\",value:function(e){var t=this.x-e.x,n=this.y-e.y,a=this.z-e.z,i=this.w-e.w;return t*t+n*n+a*a+i*i}},{key:\"distanceTo\",value:function(e){return be(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=Me(this.x,e.x),this.y=Me(this.y,e.y),this.z=Me(this.z,e.z),this.w=Me(this.w,e.w),this}},{key:\"max\",value:function(e){return this.x=Le(this.x,e.x),this.y=Le(this.y,e.y),this.z=Le(this.z,e.z),this.w=Le(this.w,e.w),this}},{key:\"clamp\",value:function(e,t){return this.x=Le(e.x,Me(t.x,this.x)),this.y=Le(e.y,Me(t.y,this.y)),this.z=Le(e.z,Me(t.z,this.z)),this.w=Le(e.w,Me(t.w,this.w)),this}},{key:\"floor\",value:function(){return this.x=De(this.x),this.y=De(this.y),this.z=De(this.z),this.w=De(this.w),this}},{key:\"ceil\",value:function(){return this.x=Fe(this.x),this.y=Fe(this.y),this.z=Fe(this.z),this.w=Fe(this.w),this}},{key:\"round\",value:function(){return this.x=Pe(this.x),this.y=Pe(this.y),this.z=Pe(this.z),this.w=Pe(this.w),this}},{key:\"lerp\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:\"lerpVectors\",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}]),t}(),pt={AIR:0,SOLID:1},ft=function(){function t(n){e(this,t),this.type=n;for(var a=arguments.length,i=Array(1<a?a-1:0),s=1;s<a;s++)i[s-1]=arguments[s];this.children=i,this.boundingBox=null}return n(t,[{key:\"getBoundingBox\",value:function(){return null===this.boundingBox&&(this.boundingBox=this.computeBoundingBox()),this.boundingBox}},{key:\"computeBoundingBox\",value:function(){var e=this.children,t=new v,n,a;for(n=0,a=e.length;n<a;++n)t.union(e[n].getBoundingBox());return t}}]),t}(),kt=function(t){function a(){var t;e(this,a);for(var n=arguments.length,i=Array(n),s=0;s<n;s++)i[s]=arguments[s];return z(this,(t=y(a)).call.apply(t,[this,Xe.UNION].concat(i)))}return s(a,t),n(a,[{key:\"updateMaterialIndex\",value:function(e,t,n){var a=n.materialIndices[e];a!==pt.AIR&&t.setMaterialIndex(e,a)}},{key:\"selectEdge\",value:function(e,t,n){return n?e.t>t.t?e:t:e.t<t.t?e:t}}]),a}(ft),zt=function(t){function a(){var t;e(this,a);for(var n=arguments.length,i=Array(n),s=0;s<n;s++)i[s]=arguments[s];return z(this,(t=y(a)).call.apply(t,[this,Xe.DIFFERENCE].concat(i)))}return s(a,t),n(a,[{key:\"updateMaterialIndex\",value:function(e,t,n){n.materialIndices[e]!==pt.AIR&&t.setMaterialIndex(e,pt.AIR)}},{key:\"selectEdge\",value:function(e,t,n){return n?e.t<t.t?e:t:e.t>t.t?e:t}}]),a}(ft),wt=function(t){function a(){var t;e(this,a);for(var n=arguments.length,i=Array(n),s=0;s<n;s++)i[s]=arguments[s];return z(this,(t=y(a)).call.apply(t,[this,Xe.INTERSECTION].concat(i)))}return s(a,t),n(a,[{key:\"updateMaterialIndex\",value:function(e,t,n){var a=n.materialIndices[e];t.setMaterialIndex(e,t.materialIndices[e]!==pt.AIR&&a!==pt.AIR?a:pt.AIR)}},{key:\"selectEdge\",value:function(e,t,n){return n?e.t<t.t?e:t:e.t>t.t?e:t}}]),a}(ft),St=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;e(this,t),this.runLengths=n,this.data=a}return n(t,null,[{key:\"encode\",value:function(e){var n=[],a=[],s=e[0],r=1,o,u;for(o=1,u=e.length;o<u;++o)s===e[o]?++r:(n.push(r),a.push(s),s=e[o],r=1);return n.push(r),a.push(s),new t(n,a)}},{key:\"decode\",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],a=0,s,r,o,l,u;for(r=0,l=t.length;r<l;++r)for(s=t[r],o=0,u=e[r];o<u;++o)n[a++]=s;return n}}]),t}(),It=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,a=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];e(this,t),this.value=n,this.done=a}return n(t,[{key:\"reset\",value:function(){this.value=null,this.done=!1}}]),t}(),Tt=new je,Pt=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new je;e(this,t),this.min=n,this.max=a,this.children=null}return n(t,[{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je;return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getDimensions\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je;return e.subVectors(this.max,this.min)}},{key:\"split\",value:function(){var e=this.min,t=this.max,n=this.getCenter(Tt),a=this.children=[null,null,null,null,null,null,null,null],s,r;for(s=0;8>s;++s)r=Ct[s],a[s]=new this.constructor(new je(0===r[0]?e.x:n.x,0===r[1]?e.y:n.y,0===r[2]?e.z:n.z),new je(0===r[0]?n.x:t.x,0===r[1]?n.y:t.y,0===r[2]?n.z:t.z))}}]),t}(),Ct=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],bt=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],At=new je,Et=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.min=n,this.size=a,this.children=null}return n(t,[{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je;return e.copy(this.min).addScalar(.5*this.size)}},{key:\"getDimensions\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je;return e.set(this.size,this.size,this.size)}},{key:\"split\",value:function(){var e=this.min,t=this.getCenter(At),n=.5*this.size,a=this.children=[null,null,null,null,null,null,null,null],s,r;for(s=0;8>s;++s)r=Ct[s],a[s]=new this.constructor(new je(0===r[0]?e.x:t.x,0===r[1]?e.y:t.y,0===r[2]?e.z:t.z),n)}},{key:\"max\",get:function(){return this.min.clone().addScalar(this.size)}}]),t}(),Dt=new v,Ft=function(){function t(n){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;e(this,t),this.octree=n,this.region=a,this.cull=null!==a,this.result=new It,this.trace=null,this.indices=null,this.reset()}return n(t,[{key:\"reset\",value:function(){var e=this.octree.root;return this.trace=[],this.indices=[],null!==e&&(Dt.min=e.min,Dt.max=e.max,(!this.cull||this.region.intersectsBox(Dt))&&(this.trace.push(e),this.indices.push(0))),this.result.reset(),this}},{key:\"next\",value:function(){for(var e=this.cull,t=this.region,n=this.indices,a=this.trace,i=null,s=a.length-1,r,o,l;null===i&&0<=s;)if(r=n[s]++,o=a[s].children,!(8>r))a.pop(),n.pop(),--s;else if(null!==o){if(l=o[r],e&&(Dt.min=l.min,Dt.max=l.max,!t.intersectsBox(Dt)))continue;a.push(l),n.push(0),++s}else i=a.pop(),n.pop();return this.result.value=i,this.result.done=null===i,this.result}},{key:\"return\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),Ot=[new je,new je,new je],Lt=new v,Mt=new mt,r=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],Bt=0,Nt=function(){function t(){e(this,t)}return n(t,null,[{key:\"intersectOctree\",value:function(e,t,n){var a=Lt.min.set(0,0,0),i=Lt.max.subVectors(e.max,e.min),s=e.getDimensions(Ot[0]),r=Ot[1].copy(s).multiplyScalar(.5),o=Mt.origin.copy(t.ray.origin),l=Mt.direction.copy(t.ray.direction),u,y,h,c,d,m,v,g,x;o.sub(e.getCenter(Ot[2])).add(r),Bt=0,0>l.x&&(o.x=s.x-o.x,l.x=-l.x,Bt|=4),0>l.y&&(o.y=s.y-o.y,l.y=-l.y,Bt|=2),0>l.z&&(o.z=s.z-o.z,l.z=-l.z,Bt|=1),u=1/l.x,y=1/l.y,h=1/l.z,c=(a.x-o.x)*u,d=(i.x-o.x)*u,m=(a.y-o.y)*y,v=(i.y-o.y)*y,g=(a.z-o.z)*h,x=(i.z-o.z)*h,Le(Le(c,m),g)<Me(Me(d,v),x)&&L(e.root,c,m,g,d,v,x,t,n)}}]),t}(),qt=new v,Vt=function(){function t(n,a){e(this,t),this.root=void 0!==n&&void 0!==a?new Pt(n,a):null}return n(t,[{key:\"getCenter\",value:function(e){return this.root.getCenter(e)}},{key:\"getDimensions\",value:function(e){return this.root.getDimensions(e)}},{key:\"getDepth\",value:function(){return M(this.root)}},{key:\"cull\",value:function(e){var t=[];return B(this.root,e,t),t}},{key:\"findOctantsByLevel\",value:function(e){var t=[];return N(this.root,e,0,t),t}},{key:\"raycast\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return Nt.intersectOctree(this,e,t),t}},{key:\"leaves\",value:function(e){return new Ft(this,e)}},{key:Symbol.iterator,value:function(){return new Ft(this)}},{key:\"min\",get:function(){return this.root.min}},{key:\"max\",get:function(){return this.root.max}},{key:\"children\",get:function(){return this.root.children}}]),t}(),Rt=new je,p=function(t){function a(t,n){var i;return e(this,a),i=z(this,y(a).call(this,t,n)),i.points=null,i.data=null,i}return s(a,t),n(a,[{key:\"distanceToSquared\",value:function(e){var t=Rt.copy(e).clamp(this.min,this.max);return t.sub(e).lengthSquared()}},{key:\"distanceToCenterSquared\",value:function(e){var t=this.getCenter(Rt),n=e.x-t.x,a=e.y-t.x,i=e.z-t.z;return n*n+a*a+i*i}},{key:\"contains\",value:function(e,t){var n=this.min,a=this.max;return e.x>=n.x-t&&e.y>=n.y-t&&e.z>=n.z-t&&e.x<=a.x+t&&e.y<=a.y+t&&e.z<=a.z+t}},{key:\"redistribute\",value:function(e){var t=this.children,n=this.points,a=this.data,s,r,o,l,u,y,h;if(null!==t&&null!==n)for(s=0,o=n.length;s<o;++s)for(y=n[s],h=a[s],(r=0,l=t.length);r<l;++r)if(u=t[r],u.contains(y,e)){null===u.points&&(u.points=[],u.data=[]),u.points.push(y),u.data.push(h);break}this.points=null,this.data=null}},{key:\"merge\",value:function(){var e=this.children,t,n,a;if(null!==e){for(this.points=[],this.data=[],(t=0,n=e.length);t<n;++t)if(a=e[t],null!==a.points){var s,r;(s=this.points).push.apply(s,P(a.points)),(r=this.data).push.apply(r,P(a.data))}this.children=null}}}]),a}(Pt),Ut=function t(n,a,i){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;e(this,t),this.distance=n,this.distanceToRay=a,this.point=i,this.object=s},Yt=function(t){function a(t,n){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:8,o;return e(this,a),o=z(this,y(a).call(this)),o.root=new p(t,n),o.bias=Le(0,i),o.maxPoints=Le(1,Pe(s)),o.maxDepth=Le(0,Pe(r)),o.pointCount=0,o}return s(a,t),n(a,[{key:\"countPoints\",value:function(e){return V(e)}},{key:\"put\",value:function(e,t){return R(e,t,this,this.root,0)}},{key:\"remove\",value:function(e){return U(e,this,this.root,null)}},{key:\"fetch\",value:function(e){return Y(e,this,this.root)}},{key:\"move\",value:function(e,t){return X(e,t,this,this.root,null,0)}},{key:\"findNearestPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0,n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],a=j(e,t,n,this.root);return null!==a&&(a.point=a.point.clone()),a}},{key:\"findPoints\",value:function(e,t){var n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],a=[];return Z(e,t,n,this.root,a),a}},{key:\"raycast\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=S(y(a.prototype),\"raycast\",this).call(this,e);return 0<n.length&&this.testPoints(n,e,t),t}},{key:\"testPoints\",value:function(e,t,n){var a=t.params.Points.threshold,s,r,o,l,u,y,h,c,d,m,v;for(u=0,h=e.length;u<h;++u)if(d=e[u],m=d.points,null!==m)for(y=0,c=m.length;y<c;++y)v=m[y],l=t.ray.distanceSqToPoint(v),l<a*a&&(s=t.ray.closestPointToPoint(v,new je),r=t.ray.origin.distanceTo(s),r>=t.near&&r<=t.far&&(o=be(l),n.push(new Ut(r,o,s,d.data[y]))))}}]),a}(Vt),Xt=new v,jt=new je,Zt=new je,u=new je,Gt=function(){function t(){e(this,t)}return n(t,null,[{key:\"recycleOctants\",value:function(e,t){var n=e.min,a=e.getCenter(Zt),s=e.getDimensions(u).multiplyScalar(.5),r=e.children,o=t.length,l,y,h,c;for(l=0;8>l;++l)for(h=Ct[l],Xt.min.addVectors(n,jt.fromArray(h).multiply(s)),Xt.max.addVectors(a,jt.fromArray(h).multiply(s)),y=0;y<o;++y)if(c=t[y],null!==c&&Xt.min.equals(c.min)&&Xt.max.equals(c.max)){r[l]=c,t[y]=null;break}}}]),t}(),_t=new je,Kt=new je,Qt=new je,Wt=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new je;e(this,t),this.a=n,this.b=a,this.index=-1,this.coordinates=new je,this.t=0,this.n=new je}return n(t,[{key:\"approximateZeroCrossing\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,n=Le(1,t-1),s=0,r=1,o=0,l=0,u,y;for(_t.subVectors(this.b,this.a);l<=n&&(o=(s+r)/2,Kt.addVectors(this.a,Qt.copy(_t).multiplyScalar(o)),y=e.sample(Kt),!(Oe(y)<=1e-4||(r-s)/2<=1e-6));)Kt.addVectors(this.a,Qt.copy(_t).multiplyScalar(s)),u=e.sample(Kt),Se(y)===Se(u)?s=o:r=o,++l;this.t=o}},{key:\"computeZeroCrossingPosition\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je;return e.subVectors(this.b,this.a).multiplyScalar(this.t).add(this.a)}},{key:\"computeSurfaceNormal\",value:function(e){var t=this.computeZeroCrossingPosition(_t),n=1e-3,a=e.sample(Kt.addVectors(t,Qt.set(n,0,0)))-e.sample(Kt.subVectors(t,Qt.set(n,0,0))),i=e.sample(Kt.addVectors(t,Qt.set(0,n,0)))-e.sample(Kt.subVectors(t,Qt.set(0,n,0))),s=e.sample(Kt.addVectors(t,Qt.set(0,0,n)))-e.sample(Kt.subVectors(t,Qt.set(0,0,n)));this.n.set(a,i,s).normalize()}}]),t}(),Ht=new Wt,Jt=new je,$t=new je,en=function(){function t(n,a,i){var s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:3;e(this,t),this.edgeData=n,this.cellPosition=a,this.cellSize=i,this.indices=null,this.zeroCrossings=null,this.normals=null,this.axes=null,this.lengths=null,this.result=new It,this.initialC=s,this.c=s,this.initialD=r,this.d=r,this.i=0,this.l=0,this.reset()}return n(t,[{key:\"reset\",value:function(){var e=this.edgeData,t=[],n=[],i=[],s=[],r=[],o,u,y,h;for(this.i=0,this.c=0,this.d=0,(u=this.initialC,o=4>>u,y=this.initialD);u<y;++u,o>>=1)h=e.indices[u].length,0<h&&(t.push(e.indices[u]),n.push(e.zeroCrossings[u]),i.push(e.normals[u]),s.push(Ct[o]),r.push(h),++this.d);return this.l=0<r.length?r[0]:0,this.indices=t,this.zeroCrossings=n,this.normals=i,this.axes=s,this.lengths=r,this.result.reset(),this}},{key:\"next\",value:function(){var e=this.cellSize,t=this.edgeData.resolution,n=t+1,a=n*n,s=this.result,r=this.cellPosition,o,l,u,h,d,m,v;return this.i===this.l&&(this.l=++this.c<this.d?this.lengths[this.c]:0,this.i=0),this.i<this.l?(m=this.c,v=this.i,o=this.axes[m],l=this.indices[m][v],Ht.index=l,u=l%n,h=we(l%a/n),d=we(l/a),Ht.coordinates.set(u,h,d),Jt.set(u*e/t,h*e/t,d*e/t),$t.set((u+o[0])*e/t,(h+o[1])*e/t,(d+o[2])*e/t),Ht.a.addVectors(r,Jt),Ht.b.addVectors(r,$t),Ht.t=this.zeroCrossings[m][v],Ht.n.fromArray(this.normals[m],3*v),s.value=Ht,++this.i):(s.value=null,s.done=!0),s}},{key:\"return\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),tn=function(){function t(a){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:n;e(this,t),this.resolution=a,this.indices=0>=n?null:[new Uint32Array(n),new Uint32Array(i),new Uint32Array(s)],this.zeroCrossings=0>=n?null:[new Float32Array(n),new Float32Array(i),new Float32Array(s)],this.normals=0>=n?null:[new Float32Array(3*n),new Float32Array(3*i),new Float32Array(3*s)]}return n(t,[{key:\"serialize\",value:function(){return{resolution:this.resolution,edges:this.edges,zeroCrossings:this.zeroCrossings,normals:this.normals}}},{key:\"deserialize\",value:function(e){var t=this;return null===e?t=null:(this.resolution=e.resolution,this.edges=e.edges,this.zeroCrossings=e.zeroCrossings,this.normals=e.normals),t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=[this.edges[0],this.edges[1],this.edges[2],this.zeroCrossings[0],this.zeroCrossings[1],this.zeroCrossings[2],this.normals[0],this.normals[1],this.normals[2]],n,a,s;for(a=0,s=t.length;a<s;++a)n=t[a],null!==n&&e.push(n.buffer);return e}},{key:\"edges\",value:function(e,t){return new en(this,e,t)}},{key:\"edgesX\",value:function(e,t){return new en(this,e,t,0,1)}},{key:\"edgesY\",value:function(e,t){return new en(this,e,t,1,2)}},{key:\"edgesZ\",value:function(e,t){return new en(this,e,t,2,3)}}],[{key:\"calculate1DEdgeCount\",value:function(e){return ze(e+1,2)*e}}]),t}(),nn=0,an=0,sn=0,rn=function(){function t(){var n=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];e(this,t),this.materials=0,this.materialIndices=n?new Uint8Array(sn):null,this.runLengths=null,this.edgeData=null}return n(t,[{key:\"set\",value:function(e){return this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,this.edgeData=e.edgeData,this}},{key:\"clear\",value:function(){return this.materials=0,this.materialIndices=null,this.runLengths=null,this.edgeData=null,this}},{key:\"setMaterialIndex\",value:function(e,t){this.materialIndices[e]===pt.AIR?t!==pt.AIR&&++this.materials:t===pt.AIR&&--this.materials,this.materialIndices[e]=t}},{key:\"compress\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this,t;return this.compressed?(e.materialIndices=this.materialIndices,e.runLengths=this.runLengths):(t=this.full?new St([this.materialIndices.length],[pt.SOLID]):St.encode(this.materialIndices),e.materialIndices=new Uint8Array(t.data),e.runLengths=new Uint32Array(t.runLengths)),e.materials=this.materials,e}},{key:\"decompress\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this;return e.materialIndices=this.compressed?St.decode(this.runLengths,this.materialIndices,new Uint8Array(sn)):this.materialIndices,e.runLengths=null,e.materials=this.materials,e}},{key:\"serialize\",value:function(){return{materials:this.materials,materialIndices:this.materialIndices,runLengths:this.runLengths,edgeData:null===this.edgeData?null:this.edgeData.serialize()}}},{key:\"deserialize\",value:function(e){var t=this;return null===e?t=null:(this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,null===e.edgeData?this.edgeData=null:(null===this.edgeData&&(this.edgeData=new tn(an)),this.edgeData.deserialize(e.edgeData))),t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.edgeData&&this.edgeData.createTransferList(e),null!==this.materialIndices&&e.push(this.materialIndices.buffer),null!==this.runLengths&&e.push(this.runLengths.buffer),e}},{key:\"empty\",get:function(){return 0===this.materials}},{key:\"full\",get:function(){return this.materials===sn}},{key:\"compressed\",get:function(){return null!==this.runLengths}},{key:\"neutered\",get:function(){return!this.empty&&null===this.materialIndices}}],[{key:\"isovalue\",get:function(){return nn},set:function(e){nn=e}},{key:\"resolution\",get:function(){return an},set:function(e){var t=Math.log2;e=ze(2,Le(0,Fe(t(e)))),an=Le(1,Me(256,e)),sn=ze(an+1,3)}}]),t}(),on=function(t){function a(t){var n;return e(this,a),n=z(this,y(a).call(this,Xe.DENSITY_FUNCTION)),n.sdf=t,n}return s(a,t),n(a,[{key:\"computeBoundingBox\",value:function(){return this.sdf.getBoundingBox(!0)}},{key:\"generateMaterialIndex\",value:function(e){return this.sdf.sample(e)<=rn.isovalue?this.sdf.material:pt.AIR}},{key:\"generateEdge\",value:function(e){e.approximateZeroCrossing(this.sdf),e.computeSurfaceNormal(this.sdf)}}]),a}(ft),ln=new c,un=function(){function t(n){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:pt.SOLID;e(this,t),this.type=n,this.operation=null,this.material=Me(255,Le(pt.SOLID,we(a))),this.boundingBox=null,this.position=new je,this.quaternion=new nt,this.scale=new je(1,1,1),this.inverseTransformation=new c,this.updateInverseTransformation(),this.children=[]}return n(t,[{key:\"getTransformation\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new c;return e.compose(this.position,this.quaternion,this.scale)}},{key:\"getBoundingBox\",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t=this.children,n=this.boundingBox,a,s;if(null===n&&(n=this.computeBoundingBox(),this.boundingBox=n),e)for(n=n.clone(),a=0,s=t.length;a<s;++a)n.union(t[a].getBoundingBox(e));return n}},{key:\"setMaterial\",value:function(e){return this.material=Me(255,Le(pt.SOLID,we(e))),this}},{key:\"setOperationType\",value:function(e){return this.operation=e,this}},{key:\"updateInverseTransformation\",value:function(){return this.inverseTransformation.getInverse(this.getTransformation(ln)),this.boundingBox=null,this}},{key:\"union\",value:function(e){return this.children.push(e.setOperationType(Xe.UNION)),this}},{key:\"subtract\",value:function(e){return this.children.push(e.setOperationType(Xe.DIFFERENCE)),this}},{key:\"intersect\",value:function(e){return this.children.push(e.setOperationType(Xe.INTERSECTION)),this}},{key:\"toCSG\",value:function(){var e=this.children,t=new on(this),n,a,s,r;for(s=0,r=e.length;s<r;++s)a=e[s],n!==a.operation&&(n=a.operation,n===Xe.UNION?t=new kt(t):n===Xe.DIFFERENCE?t=new zt(t):n===Xe.INTERSECTION?t=new wt(t):void 0),t.children.push(a.toCSG());return t}},{key:\"serialize\",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t={type:this.type,operation:this.operation,material:this.material,position:this.position.toArray(),quaternion:this.quaternion.toArray(),scale:this.scale.toArray(),parameters:null,children:[]},n,a;for(n=0,a=this.children.length;n<a;++n)t.children.push(this.children[n].serialize(e));return t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e}},{key:\"toJSON\",value:function(){return this.serialize(!0)}},{key:\"computeBoundingBox\",value:function(){throw new Error(\"SignedDistanceFunction#computeBoundingBox method not implemented!\")}},{key:\"sample\",value:function(){throw new Error(\"SignedDistanceFunction#sample method not implemented!\")}}]),t}(),yn={HEIGHTFIELD:\"sdf.heightfield\",FRACTAL_NOISE:\"sdf.fractalnoise\",SUPER_PRIMITIVE:\"sdf.superprimitive\"},hn=function(t){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length?arguments[1]:void 0,i;return e(this,a),i=z(this,y(a).call(this,yn.PERLIN_NOISE,n)),i.min=x(je,P(t.min)),i.max=x(je,P(t.max)),i}return s(a,t),n(a,[{key:\"computeBoundingBox\",value:function(){return this.bbox=new v(this.min,this.max),this.bbox}},{key:\"sample\",value:function(){}},{key:\"serialize\",value:function(){var e=S(y(a.prototype),\"serialize\",this).call(this);return e.parameters={min:this.min.toArray(),max:this.max.toArray()},e}}]),a}(un),cn=function(t){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length?arguments[1]:void 0,i;return e(this,a),i=z(this,y(a).call(this,yn.HEIGHTFIELD,n)),i.width=void 0===t.width?1:t.width,i.height=void 0===t.height?1:t.height,i.smooth=void 0===t.smooth||t.smooth,i.data=void 0===t.data?null:t.data,i.heightmap=null,void 0!==t.image&&i.fromImage(t.image),i}return s(a,t),n(a,[{key:\"fromImage\",value:function(e){var t=\"undefined\"==typeof document?null:G(e),n=null,a,s,r,o;if(null!==t){for(a=t.data,n=new Uint8ClampedArray(a.length/4),(s=0,r=0,o=n.length);s<o;++s,r+=4)n[s]=a[r];this.heightmap=e,this.width=t.width,this.height=t.height,this.data=n}return this}},{key:\"getHeight\",value:function(e,t){var n=this.width,i=this.height,s=this.data,r;if(e=Pe(e*n),t=Pe(t*i),this.smooth){e=Le(Me(e,n-1),1),t=Le(Me(t,i-1),1);var o=e+1,l=e-1,u=t*n,a=u+n,y=u-n;r=(s[y+l]+s[y+e]+s[y+o]+s[u+l]+s[u+e]+s[u+o]+s[a+l]+s[a+e]+s[a+o])/9}else r=s[t*n+e];return r}},{key:\"computeBoundingBox\",value:function(){var e=new v,t=Me(this.width/this.height,1),n=Me(this.height/this.width,1);return e.min.set(0,0,0),e.max.set(t,1,n),e.applyMatrix4(this.getTransformation()),e}},{key:\"sample\",value:function(e){var t=this.boundingBox,n;return t.containsPoint(e)?(e.applyMatrix4(this.inverseTransformation),n=e.y-this.getHeight(e.x,e.z)/255):n=t.distanceToPoint(e),n}},{key:\"serialize\",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t=S(y(a.prototype),\"serialize\",this).call(this);return t.parameters={width:this.width,height:this.height,smooth:this.smooth,data:e?null:this.data,dataURL:e&&null!==this.heightmap?this.heightmap.toDataURL():null,image:null},t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.data.buffer),e}}]),a}(un),dn=function(t){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length?arguments[1]:void 0,i;return e(this,a),i=z(this,y(a).call(this,yn.SUPER_PRIMITIVE,n)),i.s0=x(xt,P(t.s)),i.r0=x(je,P(t.r)),i.s=new xt,i.r=new je,i.ba=new Qe,i.offset=0,i.precompute(),i}return s(a,t),n(a,[{key:\"setSize\",value:function(e,t,n,a){return this.s0.set(e,t,n,a),this.precompute()}},{key:\"setRadii\",value:function(e,t,n){return this.r0.set(e,t,n),this.precompute()}},{key:\"precompute\",value:function(){var e=this.s.copy(this.s0),t=this.r.copy(this.r0),n=this.ba;e.x-=t.x,e.y-=t.x,t.x-=e.w,e.w-=t.y,e.z-=t.y,this.offset=-2*e.z,n.set(t.z,this.offset);var a=n.dot(n);return 0===a?n.set(0,-1):n.divideScalar(a),this}},{key:\"computeBoundingBox\",value:function(){var e=this.s0,t=new v;return t.min.x=Me(-e.x,-1),t.min.y=Me(-e.y,-1),t.min.z=Me(-e.z,-1),t.max.x=Le(e.x,1),t.max.y=Le(e.y,1),t.max.z=Le(e.z,1),t.applyMatrix4(this.getTransformation()),t}},{key:\"sample\",value:function(e){e.applyMatrix4(this.inverseTransformation);var t=this.s,n=this.r,a=this.ba,i=Oe(e.x)-t.x,s=Oe(e.y)-t.y,r=Oe(e.z)-t.z,o=Le(i,0),l=Le(s,0),u=be(o*o+l*l),y=e.z-t.z,h=Oe(u+Me(0,Le(i,s))-n.x)-t.w,d=Me(Le(h*a.x+y*a.y,0),1),c=h-n.z*d,m=y-this.offset*d,v=Le(h-n.z,0),g=e.z+t.z,x=Le(h,0),p=h*-a.y+y*a.x,f=be(Me(c*c+m*m,Me(v*v+g*g,x*x+y*y)));return f*Se(Le(p,r))-n.y}},{key:\"serialize\",value:function(){var e=S(y(a.prototype),\"serialize\",this).call(this);return e.parameters={s:this.s0.toArray(),r:this.r0.toArray()},e}}],[{key:\"create\",value:function(e){var t=mn[e];return new a({s:t[0],r:t[1]})}}]),a}(un),mn=[[new Float32Array([1,1,1,1]),new Float32Array([0,0,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,0,0])],[new Float32Array([0,0,1,1]),new Float32Array([0,0,1])],[new Float32Array([1,1,2,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,.25,1]),new Float32Array([1,.25,0])],[new Float32Array([1,1,.25,.25]),new Float32Array([1,.25,0])],[new Float32Array([1,1,1,.25]),new Float32Array([1,.1,0])],[new Float32Array([1,1,1,.25]),new Float32Array([.1,.1,0])]],vn={CUBE:0,CYLINDER:1,CONE:2,PILL:3,SPHERE:4,PELLET:5,TORUS:6,PIPE:7,CORRIDOR:8},gn=function(){function t(){e(this,t)}return n(t,[{key:\"revive\",value:function(e){var t,n,a;switch(e.type){case yn.FRACTAL_NOISE:t=new hn(e.parameters,e.material);break;case yn.HEIGHTFIELD:t=new cn(e.parameters,e.material);break;case yn.SUPER_PRIMITIVE:t=new dn(e.parameters,e.material);}for(t.operation=e.operation,t.position.fromArray(e.position),t.quaternion.fromArray(e.quaternion),t.scale.fromArray(e.scale),t.updateInverseTransformation(),(n=0,a=e.children.length);n<a;++n)t.children.push(this.revive(e.children[n]));return t}}]),t}(),xn=function(t){function n(t){var a;return e(this,n),a=z(this,y(n).call(this,t)),a.descriptions=null,a}return s(n,t),n}(Ue),pn=new xn(\"load\"),fn=function(t){function a(){var t;return e(this,a),t=z(this,y(a).call(this)),t.items=0,t.descriptions=null,t.imageMap=new WeakMap,t}return s(a,t),n(a,[{key:\"clear\",value:function(){this.imageMap=new WeakMap}},{key:\"handleEvent\",value:function(e){switch(e.type){case\"load\":this.progress(e);}}},{key:\"progress\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=null===e?null:e.target,n=this.imageMap,a;null!==t&&(n.has(t)&&(a=n.get(t),a.image=t),--this.items),0===this.items&&(this.clear(),pn.descriptions=this.descriptions,this.dispatchEvent(pn))}},{key:\"loadImage\",value:function(e){var t=new Image;this.imageMap.set(t,e),++this.items,t.addEventListener(\"load\",this),t.src=e.dataURL}},{key:\"inflate\",value:function(e){var t;null!==e.dataURL&&this.loadImage(e);var n=!0,a=!1,i=void 0;try{for(var s=e.children[Symbol.iterator](),r;!(n=(r=s.next()).done);n=!0)t=r.value,this.inflate(t)}catch(e){a=!0,i=e}finally{try{n||null==s[\"return\"]||s[\"return\"]()}finally{if(a)throw i}}this.progress()}},{key:\"load\",value:function(e){var t;this.items=0,this.descriptions=e;var n=!0,a=!1,i=void 0;try{for(var s=e[Symbol.iterator](),r;!(n=(r=s.next()).done);n=!0)t=r.value,this.inflate(t)}catch(e){a=!0,i=e}finally{try{n||null==s[\"return\"]||s[\"return\"]()}finally{if(a)throw i}}}}]),a}(Ye),kn=function(){function t(){e(this,t)}return n(t,null,[{key:\"parseBin\",value:function(e){return parseInt(e,2)}},{key:\"createBinaryString\",value:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:64,n=0>e?\"-\":\"\",a=Oe(e).toString(2);a.length<t;)a=\"0\"+a;return n+a}}]),t}(),zn=function(){function t(n,a,i){e(this,t),this.keyDesign=n,this.min=a,this.max=i,this.keyBase=new je,this.key=new je,this.limit=new je,this.result=new It,this.reset()}return n(t,[{key:\"reset\",value:function(){var e=this.keyDesign,t=this.min,n=this.max;return t.x<=n.x&&t.y<=n.y&&t.z<=n.z?(this.keyBase.set(t.x,t.y*e.rangeX,t.z*e.rangeXY),this.limit.set(n.x,n.y*e.rangeX,n.z*e.rangeXY),this.key.copy(this.keyBase)):(this.keyBase.set(1,1,1),this.limit.set(0,0,0),this.key.copy(this.keyBase),console.error(\"Invalid key range\",t,n)),this.result.reset(),this}},{key:\"next\",value:function(){var e=this.result,t=this.keyDesign,n=this.keyBase,a=this.limit,i=this.key;return i.z<=a.z?(e.value=i.z+i.y+i.x,++i.x,i.x>a.x&&(i.x=n.x,i.y+=t.rangeX,i.y>a.y&&(i.y=n.y,i.z+=t.rangeXY))):(e.value=null,e.done=!0),e}},{key:\"return\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),wn=32,Sn=ze(2,wn),In=53,Tn=32,Pn=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Pe(.4*In),a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Pe(.2*In),i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n;e(this,t),this.x=0,this.y=0,this.z=0,this.rangeX=0,this.rangeY=0,this.rangeZ=0,this.rangeXY=0,this.halfRange=null,this.maskX=[0,0],this.maskY=[0,0],this.maskZ=[0,0],this.set(n,a,i)}return n(t,[{key:\"set\",value:function(e,t,n){(e+t+n>In||e>wn||t>wn||n>wn)&&(console.warn(\"Invalid bit allotment\"),e=Pe(.4*In),t=Pe(.2*In),n=e),this.x=e,this.y=t,this.z=n,this.rangeX=ze(2,e),this.rangeY=ze(2,t),this.rangeZ=ze(2,n),this.rangeXY=ze(2,e+t),this.halfRange=new je(this.rangeX/2,this.rangeY/2,this.rangeZ/2),this.updateBitMasks()}},{key:\"updateBitMasks\",value:function(){var e=this.x,t=this.y,n=this.z,a=this.maskX,i=this.maskY,s=this.maskZ,r=wn-Le(0,e-Tn),o=wn-Le(0,t+e-Tn),l=wn-Le(0,n+t+e-Tn);a[1]=r<wn?-1>>>r:0,a[0]=-1>>>Le(0,Tn-e),i[1]=((o<wn?-1>>>o:0)&~a[1])>>>0,i[0]=(-1>>>Le(0,Tn-(e+t))&~a[0])>>>0,s[1]=((l<wn?-1>>>l:0)&~i[1]&~a[1])>>>0,s[0]=(-1>>>Le(0,Tn-(e+t+n))&~i[0]&~a[0])>>>0}},{key:\"unpackKey\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new je,n=this.maskX,a=this.maskY,i=this.maskZ,s=we(e/Sn),r=e%Sn;return t.set((s&n[1])*Sn+((r&n[0])>>>0),((s&a[1])*Sn+((r&a[0])>>>0))/this.rangeX,((s&i[1])*Sn+((r&i[0])>>>0))/this.rangeXY)}},{key:\"packKey\",value:function(e){return e.z*this.rangeXY+e.y*this.rangeX+e.x}},{key:\"keyRange\",value:function(e,t){return new zn(this,e,t)}},{key:\"toString\",value:function(){var e=this.maskX,t=this.maskY,n=this.maskZ;return\"Key Design\\n\\nX-Bits: \"+this.x+\"\\nY-Bits: \"+this.y+\"\\nZ-Bits: \"+this.z+\"\\n\\n\"+kn.createBinaryString(e[1],wn)+\" \"+e[1]+\" (HI-Mask X)\\n\"+kn.createBinaryString(e[0],wn)+\" \"+e[0]+\" (LO-Mask X)\\n\\n\"+kn.createBinaryString(t[1],wn)+\" \"+t[1]+\" (HI-Mask Y)\\n\"+kn.createBinaryString(t[0],wn)+\" \"+t[0]+\" (LO-Mask Y)\\n\\n\"+kn.createBinaryString(n[1],wn)+\" \"+n[1]+\" (HI-Mask Z)\\n\"+kn.createBinaryString(n[0],wn)+\" \"+n[0]+\" (LO-Mask Z)\\n\"}}],[{key:\"BITS\",get:function(){return In}},{key:\"HI_BITS\",get:function(){return 21}},{key:\"LO_BITS\",get:function(){return Tn}}]),t}(),Cn=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.lod=n,this.key=a}return n(t,[{key:\"set\",value:function(e,t){this.lod=e,this.key=t}},{key:\"copy\",value:function(e){return this.lod=e.lod,this.key=e.key,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}}]),t}(),bn=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Cn;e(this,t),this.octant=n,this.id=a,this.min=new je,this.max=new je}return n(t,[{key:\"copy\",value:function(e){return this.octant=e.octant,this.id.copy(e.id),this.min.copy(e.min),this.max.copy(e.max),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je;return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getDimensions\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new je;return e.subVectors(this.max,this.min)}},{key:\"containsPoint\",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=n.x&&e.y<=n.y&&e.z<=n.z}}]),t}(),An=function(){function t(n){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.world=n,this.cellSize=0,this.iterator=null,this.octantWrapper=new bn,this.octantWrapper.id.lod=a,this.result=new It,this.reset()}return n(t,[{key:\"reset\",value:function(){var e=this.octantWrapper.id.lod,t=this.world,n=t.getGrid(e);return void 0===n?console.error(\"Invalid LOD\",e):(this.cellSize=t.getCellSize(e),this.iterator=n.entries(),this.result.reset()),this}},{key:\"next\",value:function(){var e=this.result,t=this.octantWrapper,n=this.iterator.next(),a=n.value;return n.done?(e.value=null,e.done=!0):(this.keyDesign.unpackKey(a[0],t.min),t.min.multiplyScalar(this.cellSize).add(this.world.min),t.max.copy(t.min).addScalar(this.cellSize),t.id.key=a[0],t.octant=a[1],e.value=t),e}},{key:\"return\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),En=function t(){e(this,t),this.data=null,this.csg=new Re,this.isosurface=null},Dn=function(t){function n(){var t;return e(this,n),t=z(this,y(n).call(this)),t.children=0,t}return s(n,t),n}(En),Fn=new je,On=new je,Ln=new v,Mn=new v,Bn=new v,Nn=[],qn=function(){function t(){e(this,t)}return n(t,null,[{key:\"applyUnion\",value:function(e,t,n){var s=e.getKeyDesign(),r=e.lodZero,o=Mn.min,a=Mn.max,l=Bn.min,u=Bn.max,y,h,c,d,m,v;for(m=e.getDepth();0<m;--m){c=e.getGrid(m),e.calculateKeyCoordinates(t.min,m,o),e.calculateKeyCoordinates(t.max,m,a),e.calculateKeyCoordinates(t.min,m-1,l),e.calculateKeyCoordinates(t.max,m-1,u);var g=!0,x=!1,p=void 0;try{for(var f=s.keyRange(o,a)[Symbol.iterator](),k;!(g=(k=f.next()).done);g=!0)if(y=k.value,!c.has(y))for(d=new Dn,d.csg.add(n),c.set(y,d),s.unpackKey(y,On),On.x<<=1,On.y<<=1,On.z<<=1,v=0;8>v;++v)h=Ct[v],Fn.set(On.x+h[0],On.y+h[1],On.z+h[2]),Bn.containsPoint(Fn)&&(d.children|=1<<v)}catch(e){x=!0,p=e}finally{try{g||null==f[\"return\"]||f[\"return\"]()}finally{if(x)throw p}}}e.calculateKeyCoordinates(t.min,0,o),e.calculateKeyCoordinates(t.max,0,a);var z=!0,w=!1,S=void 0;try{for(var I=s.keyRange(o,a)[Symbol.iterator](),T;!(z=(T=I.next()).done);z=!0)y=T.value,r.has(y)?d=r.get(y):(d=new En,r.set(y,d)),d.csg.add(n)}catch(e){w=!0,S=e}finally{try{z||null==I[\"return\"]||I[\"return\"]()}finally{if(w)throw S}}}},{key:\"applyDifference\",value:function(e,t,n){var s=e.getDepth(),r=e.getKeyDesign(),o=e.getGrid(s),u=e.calculateKeyCoordinates(t.min,s,Mn.min),a=e.calculateKeyCoordinates(t.max,s,Mn.max),y,h,c,d;for(y=0,h=s-1;y<h;++y)y<Nn.length?(c=Nn[y],e.calculateKeyCoordinates(t.min,y,c.min),e.calculateKeyCoordinates(t.max,y,c.max)):Nn.push(new v(e.calculateKeyCoordinates(t.min,y),e.calculateKeyCoordinates(t.max,y)));var m=!0,g=!1,x=void 0;try{for(var p=r.keyRange(u,a)[Symbol.iterator](),f;!(m=(f=p.next()).done);m=!0)d=f.value,o.has(d)&&(r.unpackKey(d,On),_(e,n,o.get(d),On.x,On.y,On.z,s))}catch(e){g=!0,x=e}finally{try{m||null==p[\"return\"]||p[\"return\"]()}finally{if(g)throw x}}}},{key:\"applyIntersection\",value:function(e,t){var n,a;for(n=e.getDepth();0<=n;--n){var i=!0,s=!1,r=void 0;try{for(var o=e.getGrid(n).values()[Symbol.iterator](),l;!(i=(l=o.next()).done);i=!0)a=l.value,a.csg.add(t)}catch(e){s=!0,r=e}finally{try{i||null==o[\"return\"]||o[\"return\"]()}finally{if(s)throw r}}}}},{key:\"applyCSG\",value:function(e,t){var n=Ln.copy(t.getBoundingBox(!0));switch(n.min.max(e.min),n.max.min(e.max),t.operation){case Xe.UNION:this.applyUnion(e,n,t);break;case Xe.DIFFERENCE:this.applyDifference(e,n,t);break;case Xe.INTERSECTION:this.applyIntersection(e,t);break;default:console.error(\"No CSG operation type specified\",t);}}}]),t}(),Vn=new je,Rn=new ut,l=new v,Un=new v,d=new mt,Yn=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],Xn=0,jn=function(){function t(){e(this,t)}return n(t,null,[{key:\"intersectWorldOctree\",value:function(e,i){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],r=e.getDepth(),o=e.getGrid(r),l=e.getCellSize(r),u=e.getKeyDesign(),y=new bn,h=Rn.start,c=Rn.end,m=e.containsPoint(d.copy(i).origin)?d.origin:d.intersectBox(e,d.origin),a,v,g,x,p,f,k,z,w,S,I,T,P,C,A,E,D,F,O,L;if(y.id.lod=r,null!==m)for(g=l<<1,x=d.at(g,Vn),e.calculateKeyCoordinates(m,r,h),e.calculateKeyCoordinates(x,r,c),f=c.x-h.x,k=c.y-h.y,z=c.z-h.z,A=Se(f),E=Se(k),D=Se(z),w=Oe(f),S=Oe(k),I=Oe(z),T=2*w,P=2*S,C=2*I,F=S-w,O=I-w,L=S-I,p=w+S+I;0<p;--p)a=u.packKey(h),o.has(a)&&(v=o.get(a),y.id.key=a,y.octant=v,y.min.copy(h),y.min.multiplyScalar(l),y.min.add(e.min),y.max.copy(y.min).addScalar(l),null===v.isosurface?H(e,y,h,i,s):s.push(y.clone())),0>F?0>O?(h.x+=A,F+=P,O+=C):(h.z+=D,O-=T,L+=P):0>L?(h.z+=D,O-=T,L+=P):(h.y+=E,F-=T,L-=C);return s}}]),t}(),Zn=new je,Gn=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:20,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Pn;for(e(this,t),a=Le(Me(we(a),32),1),this.cellSize=Le(Me(we(n),ze(2,33-a)-1),1),this.keyDesign=i,this.grids=[];this.grids.length<a;)this.grids.push(new Map);this.bounds=new bn,this.bounds.min.copy(this.keyDesign.halfRange).multiplyScalar(-this.cellSize),this.bounds.max.copy(this.keyDesign.halfRange).multiplyScalar(this.cellSize)}return n(t,[{key:\"getKeyDesign\",value:function(){return this.keyDesign}},{key:\"getCellSize\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return this.cellSize<<e>>>0}},{key:\"getCenter\",value:function(e){return this.bounds.getCenter(e)}},{key:\"setCenter\",value:function(e){this.min.copy(this.keyDesign.halfRange).multiplyScalar(-this.cellSize).add(e),this.max.copy(this.keyDesign.halfRange).multiplyScalar(this.cellSize).add(e)}},{key:\"getDimensions\",value:function(e){return this.bounds.getDimensions(e)}},{key:\"getDepth\",value:function(){return this.grids.length-1}},{key:\"getGrid\",value:function(e){return 0<=e&&e<this.grids.length?this.grids[e]:void 0}},{key:\"clear\",value:function(){var e,t;for(e=0,t=this.grids.length;e<t;++e)this.grids[e].clear()}},{key:\"containsPoint\",value:function(e){return this.bounds.containsPoint(e)}},{key:\"findOctantsByLevel\",value:function(e){return this.octants(e)}},{key:\"calculateKeyCoordinates\",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new je,a=this.cellSize<<t;return Zn.subVectors(e,this.min),n.set(we(Zn.x/a),we(Zn.y/a),we(Zn.z/a)),n}},{key:\"getOctantByPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.keyDesign,a=this.getGrid(t),i;return void 0===a?console.error(\"Invalid LOD\",t):this.containsPoint(e)?(this.calculateKeyCoordinates(e,t,Zn),i=a.get(n.packKey(Zn))):console.error(\"Position out of range\",e),i}},{key:\"removeOctant\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.keyDesign,a=this.getGrid(t),i,s,r;void 0===a?console.error(\"Invalid LOD\",t):a.has(e)?(n.unpackKey(e,Zn),i=Zn.x,s=Zn.y,r=Zn.z,J(this,a.get(e),i,s,r,t),a[\"delete\"](e),$(this,i,s,r,t)):console.error(\"No octant found\",e)}},{key:\"applyCSG\",value:function(e){qn.applyCSG(this,e)}},{key:\"raycast\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return jn.intersectWorldOctree(this,e,t)}},{key:\"octants\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return new An(this,e)}},{key:\"min\",get:function(){return this.bounds.min}},{key:\"max\",get:function(){return this.bounds.max}},{key:\"levels\",get:function(){return this.grids.length}},{key:\"lodZero\",get:function(){return this.grids[0]}}],[{key:\"calculateOffsetIndex\",value:function(e,t,n){return((1&e)<<2)+((1&t)<<1)+(1&n)}}]),t}(),_n=function(){function t(){e(this,t)}return n(t,[{key:\"clone\",value:function(){return new this.constructor(this.levels)}},{key:\"levels\",get:function(){return this.something.length}}]),t}(),Kn=function(t){function n(t){var a;return e(this,n),a=z(this,y(n).call(this,t)),a.lod=-1,a.left=null,a.entered=null,a.error=null,a}return s(n,t),n}(Ue),Qn=new Kn(\"update\"),Wn=new Kn(\"error\"),Hn=new v,Jn=new rt,f=new c,$n=function(t){function a(t){var n;return e(this,a),n=z(this,y(a).call(this)),n.world=t,n.position=new je(1/0,1/0,1/0),n.currentScene=new _n(n.world.levels),n.previousScene=n.currentScene.clone(),n.nextScene=n.currentScene.clone(),n}return s(a,t),n(a,[{key:\"update\",value:function(e){var t=this.position;t.copy(e.position),Jn.setFromMatrix(f.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse))}},{key:\"process\",value:function(){}},{key:\"clear\",value:function(){this.previousScene.clear(),this.currentScene.clear(),this.nextScene.clear()}}]),a}(Ye),ea={EXTRACT:\"worker.extract\",MODIFY:\"worker.modify\",CONFIGURE:\"worker.config\",CLOSE:\"worker.close\"},ta=function t(){var n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null;e(this,t),this.action=n,this.error=null},na=function(t){function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,a;return e(this,n),a=z(this,y(n).call(this,t)),a.data=null,a}return s(n,t),n}(ta),aa=function(t){function n(){return e(this,n),z(this,y(n).call(this,ea.EXTRACT))}return s(n,t),n}(na),ia=function(t){function n(){var t;return e(this,n),t=z(this,y(n).call(this,ea.MODIFY)),t.sdf=null,t.cellSize=0,t.cellPosition=null,t}return s(n,t),n}(na),sa=function(t){function n(){var t;return e(this,n),t=z(this,y(n).call(this,ea.CONFIGURE)),t.resolution=rn.resolution,t.errorThreshold=.01,t}return s(n,t),n}(ta),ra=function(t){function n(){var t;return e(this,n),t=z(this,y(n).call(this,ea.EXTRACT)),t.isosurface=null,t}return s(n,t),n}(na),oa=function(t){function n(){var t;return e(this,n),t=z(this,y(n).call(this,ea.MODIFY)),t.sdf=null,t}return s(n,t),n}(na),la=function(t){function n(t){var a;return e(this,n),a=z(this,y(n).call(this,t)),a.worker=null,a.response=null,a}return s(n,t),n}(Ue),ua=new la(\"message\"),ya=function(t){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:navigator.hardwareConcurrency,n;return e(this,a),n=z(this,y(a).call(this)),n.workerURL=URL.createObjectURL(new Blob([\"function _typeof(e){return _typeof=\\\"function\\\"==typeof Symbol&&\\\"symbol\\\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\\\"function\\\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\\\"symbol\\\":typeof e},_typeof(e)}(function(){'use strict';var ue=Math.pow,ce=Math.trunc,me=Math.sign,xe=Math.PI,pe=Math.atan2,ve=Math.round,ge=Math.acos,ke=Math.sqrt,he=Math.cos,ze=Math.sin,fe=Math.floor,Se=Math.ceil,we=Math.abs,Te=Math.max,Ie=Math.min;function e(e,t){if(!(e instanceof t))throw new TypeError(\\\"Cannot call a class as a function\\\")}function t(e,t){for(var a,n=0;n<t.length;n++)a=t[n],a.enumerable=a.enumerable||!1,a.configurable=!0,\\\"value\\\"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function n(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){if(\\\"function\\\"!=typeof t&&null!==t)throw new TypeError(\\\"Super expression must either be null or a function\\\");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function y(){if(\\\"undefined\\\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\\\"function\\\"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function x(){return x=y()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var a=Function.bind.apply(e,i),l=new a;return n&&d(l,n.prototype),l},x.apply(null,arguments)}function g(e){if(void 0===e)throw new ReferenceError(\\\"this hasn't been initialised - super() hasn't been called\\\");return e}function k(e,t){return t&&(\\\"object\\\"===_typeof(t)||\\\"function\\\"==typeof t)?t:g(e)}function h(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=s(e),null!==e););return e}function z(e,t,a){return z=\\\"undefined\\\"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var n=h(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(a):i.value}},z(e,t,a||e)}function f(e,t,a,n){return f=\\\"undefined\\\"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,a,n){var l,o=h(e,t);if(o){if(l=Object.getOwnPropertyDescriptor(o,t),l.set)return l.set.call(n,a),!0;if(!l.writable)return!1}if(l=Object.getOwnPropertyDescriptor(n,t),l){if(!l.writable)return!1;l.value=a,Object.defineProperty(n,t,l)}else i(n,t,a);return!0},f(e,t,a,n)}function S(e,t,a,n,i){var l=f(e,t,a,n||e);if(!l&&i)throw new Error(\\\"failed to set property\\\");return a}function w(e){return T(e)||I(e)||C()}function T(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}}function I(e){if(Symbol.iterator in Object(e)||\\\"[object Arguments]\\\"===Object.prototype.toString.call(e))return Array.from(e)}function C(){throw new TypeError(\\\"Invalid attempt to spread non-iterable instance\\\")}function P(e,t,a){return Te(Ie(e,a),t)}function E(e,t,a,n,i,l){var o=0;return e>t&&e>a?(i<e&&(o|=2),l<e&&(o|=1)):t>a?(n<t&&(o|=4),l<t&&(o|=1)):(n<a&&(o|=4),i<a&&(o|=2)),o}function D(e,t,a,n){var i,l=0;return t<a?(i=t,l=0):(i=a,l=1),n<i&&(l=2),r[e][l]}function F(e,t,a,n,i,l,o,s,r){var d,y,u,c,m=e.children;if(0<=i&&0<=l&&0<=o)if(null===m)r.push(e);else{y=.5*(t+i),u=.5*(a+l),c=.5*(n+o),d=E(t,a,n,y,u,c);do 0===d?(F(m[mt],t,a,n,y,u,c,s,r),d=D(d,y,u,c)):1===d?(F(m[1^mt],t,a,c,y,u,o,s,r),d=D(d,y,u,o)):2===d?(F(m[2^mt],t,u,n,y,l,c,s,r),d=D(d,y,l,c)):3===d?(F(m[3^mt],t,u,c,y,l,o,s,r),d=D(d,y,l,o)):4===d?(F(m[4^mt],y,a,n,i,u,c,s,r),d=D(d,i,u,c)):5===d?(F(m[5^mt],y,a,c,i,u,o,s,r),d=D(d,i,u,o)):6===d?(F(m[6^mt],y,u,n,i,l,c,s,r),d=D(d,i,l,c)):7===d?(F(m[7^mt],y,u,c,i,l,o,s,r),d=8):void 0;while(8>d)}}function A(e){var t,a,n,o=e.children,s=0;if(null!==o)for(t=0,a=o.length;t<a;++t)n=1+A(o[t]),n>s&&(s=n);return s}function V(e,t,a){var n,o,s=e.children;if(pt.min=e.min,pt.max=e.max,t.intersectsBox(pt))if(null!==s)for(n=0,o=s.length;n<o;++n)V(s[n],t,a);else a.push(e)}function B(e,t,a,n){var o,s,r=e.children;if(a===t)n.push(e);else if(null!==r)for(++a,o=0,s=r.length;o<s;++o)B(r[o],t,a,n)}function N(e){var t,a,n=e.children,o=0;if(null!==n)for(t=0,a=n.length;t<a;++t)o+=N(n[t]);else null!==e.points&&(o=e.points.length);return o}function O(e,t,a,n,o){var s,r,d=n.children,y=!1,u=!1;if(n.contains(e,a.bias)){if(null===d){if(null===n.points)n.points=[],n.data=[];else for(s=0,r=n.points.length;!y&&s<r;++s)y=n.points[s].equals(e);y?(n.data[s-1]=t,u=!0):n.points.length<a.maxPoints||o===a.maxDepth?(n.points.push(e.clone()),n.data.push(t),++a.pointCount,u=!0):(n.split(),n.redistribute(a.bias),d=n.children)}if(null!==d)for(++o,s=0,r=d.length;!u&&s<r;++s)u=O(e,t,a,d[s],o)}return u}function L(e,t,a,n){var o,s,r,d,y,u=a.children,c=null;if(a.contains(e,t.bias))if(null!==u)for(o=0,s=u.length;null===c&&o<s;++o)c=L(e,t,u[o],a);else if(null!==a.points)for(r=a.points,d=a.data,(o=0,s=r.length);o<s;++o)if(r[o].equals(e)){y=s-1,c=d[o],o<y&&(r[o]=r[y],d[o]=d[y]),r.pop(),d.pop(),--t.pointCount,null!==n&&N(n)<=t.maxPoints&&n.merge();break}return c}function M(e,t,a){var n,o,s,r=a.children,d=null;if(a.contains(e,t.bias))if(null!==r)for(n=0,o=r.length;null===d&&n<o;++n)d=M(e,t,r[n]);else if(null!==a.points)for(s=a.points,n=0,o=s.length;null===d&&n<o;++n)e.equals(s[n])&&(d=a.data[n]);return d}function R(e,t,a,n,o,s){var r,d,y,u=n.children,c=null;if(n.contains(e,a.bias))if(!n.contains(t,a.bias))c=L(e,a,n,o),O(t,c,a,o,s-1);else if(null!==u)for(++s,r=0,d=u.length;null===c&&r<d;++r)c=R(e,t,a,u[r],n,s);else if(null!==n.points)for(y=n.points,r=0,d=y.length;r<d;++r)if(e.equals(y[r])){y[r].copy(t),c=n.data[r];break}return c}function Y(e,t,a,n){var o,s,r=null,d=t;if(null!==n.children){var y,u,c=n.children.map(function(t){return{octant:t,distance:t.distanceToCenterSquared(e)}}).sort(function(e,t){return e.distance-t.distance});for(o=0,s=c.length;o<s&&(y=c[o].octant,!(y.contains(e,d)&&(u=Y(e,d,a,y),null!==u&&(d=u.distance,r=u,0===d))));++o);}else if(null!==n.points){var m,x=n.points,p=-1;for(o=0,s=x.length;o<s;++o)if(!x[o].equals(e))m=e.distanceTo(x[o]),m<d&&(d=m,p=o);else if(!a){d=0,p=o;break}0<=p&&(r={point:x[p],data:n.data[p],distance:d})}return r}function X(e,t,a,n,o){var s,r,d=n.children;if(null!==d){var y;for(s=0,r=d.length;s<r;++s)y=d[s],y.contains(e,t)&&X(e,t,a,y,o)}else if(null!==n.points){var u,c=n.points;for(s=0,r=c.length;s<r;++s)u=c[s],u.equals(e)?!a&&o.push({point:u.clone(),data:n.data[s]}):u.distanceToSquared(e)<=t*t&&o.push({point:u.clone(),data:n.data[s]})}}function Z(e,t){var a,n=e.elements,i=t.elements;0!==n[1]&&(a=Rt.calculateCoefficients(n[0],n[1],n[3]),Yt.rotateQXY(jt.set(n[0],n[3]),n[1],a),n[0]=jt.x,n[3]=jt.y,Yt.rotateXY(jt.set(n[2],n[4]),a),n[2]=jt.x,n[4]=jt.y,n[1]=0,Yt.rotateXY(jt.set(i[0],i[3]),a),i[0]=jt.x,i[3]=jt.y,Yt.rotateXY(jt.set(i[1],i[4]),a),i[1]=jt.x,i[4]=jt.y,Yt.rotateXY(jt.set(i[2],i[5]),a),i[2]=jt.x,i[5]=jt.y)}function _(e,t){var a,n=e.elements,i=t.elements;0!==n[2]&&(a=Rt.calculateCoefficients(n[0],n[2],n[5]),Yt.rotateQXY(jt.set(n[0],n[5]),n[2],a),n[0]=jt.x,n[5]=jt.y,Yt.rotateXY(jt.set(n[1],n[4]),a),n[1]=jt.x,n[4]=jt.y,n[2]=0,Yt.rotateXY(jt.set(i[0],i[6]),a),i[0]=jt.x,i[6]=jt.y,Yt.rotateXY(jt.set(i[1],i[7]),a),i[1]=jt.x,i[7]=jt.y,Yt.rotateXY(jt.set(i[2],i[8]),a),i[2]=jt.x,i[8]=jt.y)}function j(e,t){var a,n=e.elements,i=t.elements;0!==n[4]&&(a=Rt.calculateCoefficients(n[3],n[4],n[5]),Yt.rotateQXY(jt.set(n[3],n[5]),n[4],a),n[3]=jt.x,n[5]=jt.y,Yt.rotateXY(jt.set(n[1],n[2]),a),n[1]=jt.x,n[2]=jt.y,n[4]=0,Yt.rotateXY(jt.set(i[3],i[6]),a),i[3]=jt.x,i[6]=jt.y,Yt.rotateXY(jt.set(i[4],i[7]),a),i[4]=jt.x,i[7]=jt.y,Yt.rotateXY(jt.set(i[5],i[8]),a),i[5]=jt.x,i[8]=jt.y)}function U(t,a){var n,l=t.elements;for(n=0;n<5;++n)Z(t,a),_(t,a),j(t,a);return Ut.set(l[0],l[3],l[5])}function Q(e){var t=we(e)<Xt?0:1/e;return we(t)<Xt?0:t}function G(e,t){var a=e.elements,n=a[0],i=a[3],l=a[6],o=a[1],s=a[4],r=a[7],d=a[2],y=a[5],u=a[8],c=Q(t.x),m=Q(t.y),x=Q(t.z);return e.set(n*c*n+i*m*i+l*x*l,n*c*o+i*m*s+l*x*r,n*c*d+i*m*y+l*x*u,o*c*n+s*m*i+r*x*l,o*c*o+s*m*s+r*x*r,o*c*d+s*m*y+r*x*u,d*c*n+y*m*i+u*x*l,d*c*o+y*m*s+u*x*r,d*c*d+y*m*y+u*x*u)}function H(e,t,a){return e.applyToVector3(Gt.copy(a)),Gt.subVectors(t,Gt),Gt.dot(Gt)}function J(e,t,a){var n,l,o,s,r,d,y,u=[-1,-1,-1,-1],c=[!1,!1,!1,!1],m=1/0,x=0,p=!1;for(y=0;4>y;++y)r=e[y],d=ra[t][y],n=lt[d][0],l=lt[d][1],o=1&r.voxel.materials>>n,s=1&r.voxel.materials>>l,r.size<m&&(m=r.size,x=y,p=o!==At.AIR),u[y]=r.voxel.index,c[y]=o!==s;c[x]&&(p?(a.push(u[0]),a.push(u[3]),a.push(u[1]),a.push(u[0]),a.push(u[2]),a.push(u[3])):(a.push(u[0]),a.push(u[1]),a.push(u[3]),a.push(u[0]),a.push(u[3]),a.push(u[2])))}function K(e,t,a){var n,l,o,s,r=[0,0,0,0];if(null!==e[0].voxel&&null!==e[1].voxel&&null!==e[2].voxel&&null!==e[3].voxel)J(e,t,a);else for(o=0;2>o;++o){for(r[0]=sa[t][o][0],r[1]=sa[t][o][1],r[2]=sa[t][o][2],r[3]=sa[t][o][3],n=[],s=0;4>s;++s)if(l=e[s],null!==l.voxel)n[s]=l;else if(null!==l.children)n[s]=l.children[r[s]];else break;4===s&&K(n,sa[t][o][4],a)}}function W(e,t,a){var n,l,o,s,r,d,y=[0,0,0,0],u=[[0,0,1,1],[0,1,0,1]];if(null!==e[0].children||null!==e[1].children){for(r=0;4>r;++r)y[0]=la[t][r][0],y[1]=la[t][r][1],n=[null===e[0].children?e[0]:e[0].children[y[0]],null===e[1].children?e[1]:e[1].children[y[1]]],W(n,la[t][r][2],a);for(r=0;4>r;++r){for(y[0]=oa[t][r][1],y[1]=oa[t][r][2],y[2]=oa[t][r][3],y[3]=oa[t][r][4],o=u[oa[t][r][0]],l=[],d=0;4>d;++d)if(s=e[o[d]],null!==s.voxel)l[d]=s;else if(null!==s.children)l[d]=s.children[y[d]];else break;4===d&&K(l,oa[t][r][5],a)}}}function $(e,t){var a,n,l,o=e.children,s=[0,0,0,0];if(null!==o){for(l=0;8>l;++l)$(o[l],t);for(l=0;12>l;++l)s[0]=na[l][0],s[1]=na[l][1],a=[o[s[0]],o[s[1]]],W(a,na[l][2],t);for(l=0;6>l;++l)s[0]=ia[l][0],s[1]=ia[l][1],s[2]=ia[l][2],s[3]=ia[l][3],n=[o[s[0]],o[s[1]],o[s[2]],o[s[3]]],K(n,ia[l][4],t)}}function ee(e,t,a,n){var l,o;if(null!==e.children)for(l=0;8>l;++l)n=ee(e.children[l],t,a,n);else null!==e.voxel&&(o=e.voxel,o.index=n,t[3*n]=o.position.x,t[3*n+1]=o.position.y,t[3*n+2]=o.position.z,a[3*n]=o.normal.x,a[3*n+1]=o.normal.y,a[3*n+2]=o.normal.z,++n);return n}function te(e,t,a,l,o){var s=0;for(t>>=1;0<t;t>>=1,s=0)a>=t&&(s+=4,a-=t),l>=t&&(s+=2,l-=t),o>=t&&(s+=1,o-=t),null===e.children&&e.split(),e=e.children[s];return e}function ae(e,t,a,n,l){var o,s,r,d,y,u,c,x,p,v,g=e+1,m=new Jt;for(o=0,v=0;8>v;++v)d=it[v],y=(n+d[2])*(g*g)+(a+d[1])*g+(t+d[0]),r=Ie(l[y],At.SOLID),o|=r<<v;for(s=0,v=0;12>v;++v)u=lt[v][0],c=lt[v][1],x=1&o>>u,p=1&o>>c,x!==p&&++s;return m.materials=o,m.edgeCount=s,m.qefData=new Lt,m}function ne(e){var t=wa,a=Ot.resolution,n=new Pe(0,0,0),i=new Pe(a,a,a),l=new v(Ta,Ta.clone().addScalar(wa)),o=e.getBoundingBox();return e.type!==ka.INTERSECTION&&(o.intersectsBox(l)?(n.copy(o.min).max(l.min).sub(l.min),n.x=Se(n.x*a/t),n.y=Se(n.y*a/t),n.z=Se(n.z*a/t),i.copy(o.max).min(l.max).sub(l.min),i.x=fe(i.x*a/t),i.y=fe(i.y*a/t),i.z=fe(i.z*a/t)):(n.set(a,a,a),i.set(0,0,0))),new v(n,i)}function ie(e,t,a,i){var l,o,s,r=Ot.resolution,n=r+1,d=i.max.x,u=i.max.y,c=i.max.z;for(s=i.min.z;s<=c;++s)for(o=i.min.y;o<=u;++o)for(l=i.min.x;l<=d;++l)e.updateMaterialIndex(s*(n*n)+o*n+l,t,a)}function le(e,t,a){var i,l,o,r,d=wa,s=Ot.resolution,n=s+1,u=t.materialIndices,c=new Pe,m=new Pe,p=a.max.x,v=a.max.y,g=a.max.z,k=0;for(r=a.min.z;r<=g;++r)for(c.z=r*d/s,o=a.min.y;o<=v;++o)for(c.y=o*d/s,l=a.min.x;l<=p;++l)c.x=l*d/s,i=e.generateMaterialIndex(m.addVectors(Ta,c)),i!==At.AIR&&(u[r*(n*n)+o*n+l]=i,++k);t.materials=k}function oe(e,t,a){var l,o,s,r,y,u,x,p,v,g,k,h,z,f,S,w,T,I,C,P,b,E,D,F=Ot.resolution,n=F+1,m=new Uint32Array([1,n,n*n]),q=t.materialIndices,A=new Pt,V=new Pt,B=a.edgeData,N=t.edgeData,O=new Uint32Array(3),L=qt.calculate1DEdgeCount(F),M=new qt(F,Ie(L,N.indices[0].length+B.indices[0].length),Ie(L,N.indices[1].length+B.indices[1].length),Ie(L,N.indices[2].length+B.indices[2].length));for(I=0,C=0;3>C;I=0,++C){for(l=B.indices[C],r=N.indices[C],x=M.indices[C],o=B.zeroCrossings[C],y=N.zeroCrossings[C],p=M.zeroCrossings[C],s=B.normals[C],u=N.normals[C],v=M.normals[C],g=m[C],E=l.length,D=r.length,(P=0,b=0);P<E;++P)if(k=l[P],h=k+g,S=q[k],w=q[h],S!==w&&(S===At.AIR||w===At.AIR)){for(A.t=o[P],A.n.x=s[3*P],A.n.y=s[3*P+1],A.n.z=s[3*P+2],e.type===ka.DIFFERENCE&&A.n.negate(),T=A;b<D&&r[b]<=k;)z=r[b],f=z+g,V.t=y[b],V.n.x=u[3*b],V.n.y=u[3*b+1],V.n.z=u[3*b+2],S=q[z],z<k?(w=q[f],S!==w&&(S===At.AIR||w===At.AIR)&&(x[I]=z,p[I]=V.t,v[3*I]=V.n.x,v[3*I+1]=V.n.y,v[3*I+2]=V.n.z,++I)):T=e.selectEdge(V,A,S===At.SOLID),++b;x[I]=k,p[I]=T.t,v[3*I]=T.n.x,v[3*I+1]=T.n.y,v[3*I+2]=T.n.z,++I}for(;b<D;)z=r[b],f=z+g,S=q[z],w=q[f],S!==w&&(S===At.AIR||w===At.AIR)&&(x[I]=z,p[I]=y[b],v[3*I]=u[3*b],v[3*I+1]=u[3*b+1],v[3*I+2]=u[3*b+2],++I),++b;O[C]=I}return{edgeData:M,lengths:O}}function se(e,t,i){var l,o,r,u,p,v,g,k,h,f,S,w,T,I,C,P,b,E,D,F=wa,s=Ot.resolution,n=s+1,m=n*n,q=new Uint32Array([1,n,m]),A=t.materialIndices,V=Ta,B=new Pe,N=new Pe,O=new Pt,L=new Uint32Array(3),M=new qt(s,qt.calculate1DEdgeCount(s));for(C=4,T=0,I=0;3>I;C>>=1,T=0,++I){P=it[C],l=M.indices[I],o=M.zeroCrossings[I],r=M.normals[I],u=q[I],g=i.min.x,f=i.max.x,k=i.min.y,S=i.max.y,h=i.min.z,w=i.max.z;for(0===I?(g=Te(g-1,0),f=Ie(f,s-1)):1===I?(k=Te(k-1,0),S=Ie(S,s-1)):2===I?(h=Te(h-1,0),w=Ie(w,s-1)):void 0,D=h;D<=w;++D)for(E=k;E<=S;++E)for(b=g;b<=f;++b)p=D*m+E*n+b,v=p+u,A[p]!==A[v]&&(B.set(b*F/s,E*F/s,D*F/s),N.set((b+P[0])*F/s,(E+P[1])*F/s,(D+P[2])*F/s),O.a.addVectors(V,B),O.b.addVectors(V,N),e.generateEdge(O),l[T]=p,o[T]=O.t,r[3*T]=O.n.x,r[3*T+1]=O.n.y,r[3*T+2]=O.n.z,++T);L[I]=T}return{edgeData:M,lengths:L}}function re(e,t,a){var n,i,l,o,s=ne(e),r=!1;if(e.type===ka.DENSITY_FUNCTION?le(e,t,s):t.empty?e.type===ka.UNION&&(t.set(a),r=!0):!(t.full&&e.type===ka.UNION)&&ie(e,t,a,s),!r&&!t.empty&&!t.full){for(n=e.type===ka.DENSITY_FUNCTION?se(e,t,s):oe(e,t,a),i=n.edgeData,l=n.lengths,o=0;3>o;++o)i.indices[o]=i.indices[o].slice(0,l[o]),i.zeroCrossings[o]=i.zeroCrossings[o].slice(0,l[o]),i.normals[o]=i.normals[o].slice(0,3*l[o]);t.edgeData=i}}function de(e){var t,a,n,o,s=e.children;for(e.type===ka.DENSITY_FUNCTION&&(t=new Ot,re(e,t)),n=0,o=s.length;n<o&&(a=de(s[n]),void 0===t?t=a:null===a?e.type===ka.INTERSECTION&&(t=null):null===t?e.type===ka.UNION&&(t=a):re(e,t,a),null!==t||e.type===ka.UNION);++n);return null!==t&&t.empty?null:t}function ye(e){var t=document.createElementNS(\\\"http://www.w3.org/1999/xhtml\\\",\\\"canvas\\\"),a=t.getContext(\\\"2d\\\");return t.width=e.width,t.height=e.height,a.drawImage(e,0,0),a.getImageData(0,0,e.width,e.height)}var Ce=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;e(this,t),this.runLengths=a,this.data=n}return n(t,null,[{key:\\\"encode\\\",value:function(e){var a,n,o=[],s=[],r=e[0],d=1;for(a=1,n=e.length;a<n;++a)r===e[a]?++d:(o.push(d),s.push(r),r=e[a],d=1);return o.push(d),s.push(r),new t(o,s)}},{key:\\\"decode\\\",value:function(e,t){var a,n,l,o,s,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],d=0;for(n=0,o=t.length;n<o;++n)for(a=t[n],l=0,s=e[n];l<s;++l)r[d++]=a;return r}}]),t}(),Pe=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.x=a,this.y=n,this.z=i}return n(t,[{key:\\\"set\\\",value:function(e,t,a){return this.x=e,this.y=t,this.z=a,this}},{key:\\\"copy\\\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:\\\"clone\\\",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:\\\"fromArray\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:\\\"toArray\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:\\\"setFromSpherical\\\",value:function(e){this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:\\\"setFromSphericalCoords\\\",value:function(e,t,a){var n=ze(t)*e;return this.x=n*ze(a),this.y=he(t)*e,this.z=n*he(a),this}},{key:\\\"setFromCylindrical\\\",value:function(e){this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:\\\"setFromCylindricalCoords\\\",value:function(e,t,a){return this.x=e*ze(t),this.y=a,this.z=e*he(t),this}},{key:\\\"setFromMatrixColumn\\\",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:\\\"setFromMatrixPosition\\\",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:\\\"setFromMatrixScale\\\",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),a=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=a,this.z=n,this}},{key:\\\"add\\\",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:\\\"addScalar\\\",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:\\\"addVectors\\\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:\\\"addScaledVector\\\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:\\\"sub\\\",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:\\\"subScalar\\\",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:\\\"subVectors\\\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:\\\"multiply\\\",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:\\\"multiplyScalar\\\",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:\\\"multiplyVectors\\\",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:\\\"divide\\\",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:\\\"divideScalar\\\",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this}},{key:\\\"crossVectors\\\",value:function(e,t){var a=e.x,n=e.y,i=e.z,l=t.x,o=t.y,s=t.z;return this.x=n*s-i*o,this.y=i*l-a*s,this.z=a*o-n*l,this}},{key:\\\"cross\\\",value:function(e){return this.crossVectors(this,e)}},{key:\\\"transformDirection\\\",value:function(t){var a=this.x,n=this.y,i=this.z,l=t.elements;return this.x=l[0]*a+l[4]*n+l[8]*i,this.y=l[1]*a+l[5]*n+l[9]*i,this.z=l[2]*a+l[6]*n+l[10]*i,this.normalize()}},{key:\\\"applyMatrix3\\\",value:function(t){var a=this.x,n=this.y,i=this.z,l=t.elements;return this.x=l[0]*a+l[3]*n+l[6]*i,this.y=l[1]*a+l[4]*n+l[7]*i,this.z=l[2]*a+l[5]*n+l[8]*i,this}},{key:\\\"applyMatrix4\\\",value:function(t){var a=this.x,n=this.y,i=this.z,l=t.elements;return this.x=l[0]*a+l[4]*n+l[8]*i+l[12],this.y=l[1]*a+l[5]*n+l[9]*i+l[13],this.z=l[2]*a+l[6]*n+l[10]*i+l[14],this}},{key:\\\"applyQuaternion\\\",value:function(e){var t=this.x,a=this.y,n=this.z,i=e.x,l=e.y,o=e.z,s=e.w,r=s*t+l*n-o*a,d=s*a+o*t-i*n,y=s*n+i*a-l*t,u=-i*t-l*a-o*n;return this.x=r*s+u*-i+d*-o-y*-l,this.y=d*s+u*-l+y*-i-r*-o,this.z=y*s+u*-o+r*-l-d*-i,this}},{key:\\\"negate\\\",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:\\\"dot\\\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:\\\"reflect\\\",value:function(e){var t=e.x,a=e.y,n=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(t,a,n),this}},{key:\\\"angleTo\\\",value:function(e){var t=this.dot(e)/ke(this.lengthSquared()*e.lengthSquared());return ge(Ie(Te(t,-1),1))}},{key:\\\"manhattanLength\\\",value:function(){return we(this.x)+we(this.y)+we(this.z)}},{key:\\\"lengthSquared\\\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:\\\"length\\\",value:function(){return ke(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:\\\"manhattanDistanceTo\\\",value:function(e){return we(this.x-e.x)+we(this.y-e.y)+we(this.z-e.z)}},{key:\\\"distanceToSquared\\\",value:function(e){var t=this.x-e.x,a=this.y-e.y,n=this.z-e.z;return t*t+a*a+n*n}},{key:\\\"distanceTo\\\",value:function(e){return ke(this.distanceToSquared(e))}},{key:\\\"normalize\\\",value:function(){return this.divideScalar(this.length())}},{key:\\\"setLength\\\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\\\"min\\\",value:function(e){return this.x=Ie(this.x,e.x),this.y=Ie(this.y,e.y),this.z=Ie(this.z,e.z),this}},{key:\\\"max\\\",value:function(e){return this.x=Te(this.x,e.x),this.y=Te(this.y,e.y),this.z=Te(this.z,e.z),this}},{key:\\\"clamp\\\",value:function(e,t){return this.x=Te(e.x,Ie(t.x,this.x)),this.y=Te(e.y,Ie(t.y,this.y)),this.z=Te(e.z,Ie(t.z,this.z)),this}},{key:\\\"floor\\\",value:function(){return this.x=fe(this.x),this.y=fe(this.y),this.z=fe(this.z),this}},{key:\\\"ceil\\\",value:function(){return this.x=Se(this.x),this.y=Se(this.y),this.z=Se(this.z),this}},{key:\\\"round\\\",value:function(){return this.x=ve(this.x),this.y=ve(this.y),this.z=ve(this.z),this}},{key:\\\"lerp\\\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:\\\"lerpVectors\\\",value:function(e,t,a){return this.subVectors(t,e).multiplyScalar(a).add(e)}},{key:\\\"equals\\\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}]),t}(),be=new Pe,o=[new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe],v=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe(1/0,1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe(-Infinity,-Infinity,-Infinity);e(this,t),this.min=a,this.max=n}return n(t,[{key:\\\"set\\\",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:\\\"copy\\\",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"makeEmpty\\\",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-Infinity,this}},{key:\\\"isEmpty\\\",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:\\\"getCenter\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\\\"getSize\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:\\\"setFromSphere\\\",value:function(e){return this.set(e.center,e.center),this.expandByScalar(e.radius),this}},{key:\\\"expandByPoint\\\",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:\\\"expandByVector\\\",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:\\\"expandByScalar\\\",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:\\\"setFromPoints\\\",value:function(e){var t,a;for(this.min.set(0,0,0),this.max.set(0,0,0),(t=0,a=e.length);t<a;++t)this.expandByPoint(e[t]);return this}},{key:\\\"setFromCenterAndSize\\\",value:function(e,t){var a=be.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(a),this.max.copy(e).add(a),this}},{key:\\\"clampPoint\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe;return t.copy(e).clamp(this.min,this.max)}},{key:\\\"distanceToPoint\\\",value:function(e){var t=be.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:\\\"applyMatrix4\\\",value:function(e){var t=this.min,a=this.max;return this.isEmpty()||(o[0].set(t.x,t.y,t.z).applyMatrix4(e),o[1].set(t.x,t.y,a.z).applyMatrix4(e),o[2].set(t.x,a.y,t.z).applyMatrix4(e),o[3].set(t.x,a.y,a.z).applyMatrix4(e),o[4].set(a.x,t.y,t.z).applyMatrix4(e),o[5].set(a.x,t.y,a.z).applyMatrix4(e),o[6].set(a.x,a.y,t.z).applyMatrix4(e),o[7].set(a.x,a.y,a.z).applyMatrix4(e),this.setFromPoints(o)),this}},{key:\\\"translate\\\",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:\\\"intersect\\\",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:\\\"union\\\",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:\\\"containsPoint\\\",value:function(e){var t=this.min,a=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=a.x&&e.y<=a.y&&e.z<=a.z}},{key:\\\"containsBox\\\",value:function(e){var t=this.min,a=this.max,n=e.min,i=e.max;return t.x<=n.x&&i.x<=a.x&&t.y<=n.y&&i.y<=a.y&&t.z<=n.z&&i.z<=a.z}},{key:\\\"intersectsBox\\\",value:function(e){var t=this.min,a=this.max,n=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&i.z>=t.z&&n.x<=a.x&&n.y<=a.y&&n.z<=a.z}},{key:\\\"intersectsSphere\\\",value:function(e){var t=this.clampPoint(e.center,be);return t.distanceToSquared(e.center)<=e.radius*e.radius}},{key:\\\"intersectsPlane\\\",value:function(e){var t,a;return 0<e.normal.x?(t=e.normal.x*this.min.x,a=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,a=e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,a+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,a+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,a+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,a+=e.normal.z*this.min.z),t<=-e.constant&&a>=-e.constant}},{key:\\\"equals\\\",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),t}(),Ee=new v,De=new Pe,Fe=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.center=a,this.radius=n}return n(t,[{key:\\\"set\\\",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:\\\"copy\\\",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"setFromPoints\\\",value:function(e){var t,a,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Ee.setFromPoints(e).getCenter(this.center),o=0;for(t=0,a=e.length;t<a;++t)o=Te(o,n.distanceToSquared(e[t]));return this.radius=ke(o),this}},{key:\\\"setFromBox\\\",value:function(e){return e.getCenter(this.center),this.radius=.5*e.getSize(De).length(),this}},{key:\\\"isEmpty\\\",value:function(){return 0>=this.radius}},{key:\\\"translate\\\",value:function(e){return this.center.add(e),this}},{key:\\\"clampPoint\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe,a=this.center.distanceToSquared(e);return t.copy(e),a>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:\\\"distanceToPoint\\\",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:\\\"containsPoint\\\",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:\\\"intersectsSphere\\\",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:\\\"intersectsBox\\\",value:function(e){return e.intersectsSphere(this)}},{key:\\\"intersectsPlane\\\",value:function(e){return we(e.distanceToPoint(this.center))<=this.radius}},{key:\\\"equals\\\",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}]),t}(),qe=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.x=a,this.y=n}return n(t,[{key:\\\"set\\\",value:function(e,t){return this.x=e,this.y=t,this}},{key:\\\"copy\\\",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:\\\"clone\\\",value:function(){return new this.constructor(this.x,this.y)}},{key:\\\"fromArray\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:\\\"toArray\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:\\\"add\\\",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:\\\"addScalar\\\",value:function(e){return this.x+=e,this.y+=e,this}},{key:\\\"addVectors\\\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:\\\"addScaledVector\\\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:\\\"sub\\\",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:\\\"subScalar\\\",value:function(e){return this.x-=e,this.y-=e,this}},{key:\\\"subVectors\\\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:\\\"multiply\\\",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:\\\"multiplyScalar\\\",value:function(e){return this.x*=e,this.y*=e,this}},{key:\\\"divide\\\",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:\\\"divideScalar\\\",value:function(e){return this.x/=e,this.y/=e,this}},{key:\\\"applyMatrix3\\\",value:function(t){var a=this.x,n=this.y,i=t.elements;return this.x=i[0]*a+i[3]*n+i[6],this.y=i[1]*a+i[4]*n+i[7],this}},{key:\\\"dot\\\",value:function(e){return this.x*e.x+this.y*e.y}},{key:\\\"cross\\\",value:function(e){return this.x*e.y-this.y*e.x}},{key:\\\"manhattanLength\\\",value:function(){return we(this.x)+we(this.y)}},{key:\\\"lengthSquared\\\",value:function(){return this.x*this.x+this.y*this.y}},{key:\\\"length\\\",value:function(){return ke(this.x*this.x+this.y*this.y)}},{key:\\\"manhattanDistanceTo\\\",value:function(e){return we(this.x-e.x)+we(this.y-e.y)}},{key:\\\"distanceToSquared\\\",value:function(e){var t=this.x-e.x,a=this.y-e.y;return t*t+a*a}},{key:\\\"distanceTo\\\",value:function(e){return ke(this.distanceToSquared(e))}},{key:\\\"normalize\\\",value:function(){return this.divideScalar(this.length())}},{key:\\\"setLength\\\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\\\"min\\\",value:function(e){return this.x=Ie(this.x,e.x),this.y=Ie(this.y,e.y),this}},{key:\\\"max\\\",value:function(e){return this.x=Te(this.x,e.x),this.y=Te(this.y,e.y),this}},{key:\\\"clamp\\\",value:function(e,t){return this.x=Te(e.x,Ie(t.x,this.x)),this.y=Te(e.y,Ie(t.y,this.y)),this}},{key:\\\"floor\\\",value:function(){return this.x=fe(this.x),this.y=fe(this.y),this}},{key:\\\"ceil\\\",value:function(){return this.x=Se(this.x),this.y=Se(this.y),this}},{key:\\\"round\\\",value:function(){return this.x=ve(this.x),this.y=ve(this.y),this}},{key:\\\"negate\\\",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:\\\"angle\\\",value:function e(){var e=pe(this.y,this.x);return 0>e&&(e+=2*xe),e}},{key:\\\"lerp\\\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:\\\"lerpVectors\\\",value:function(e,t,a){return this.subVectors(t,e).multiplyScalar(a).add(e)}},{key:\\\"rotateAround\\\",value:function(e,t){var a=he(t),n=ze(t),i=this.x-e.x,l=this.y-e.y;return this.x=i*a-l*n+e.x,this.y=i*n+l*a+e.y,this}},{key:\\\"equals\\\",value:function(e){return e.x===this.x&&e.y===this.y}},{key:\\\"width\\\",get:function(){return this.x},set:function(e){return this.x=e}},{key:\\\"height\\\",get:function(){return this.y},set:function(e){return this.y=e}}]),t}(),Ae=new qe,Ve=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new qe(1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new qe(-Infinity,-Infinity);e(this,t),this.min=a,this.max=n}return n(t,[{key:\\\"set\\\",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:\\\"copy\\\",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"makeEmpty\\\",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-Infinity,this}},{key:\\\"isEmpty\\\",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:\\\"getCenter\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new qe;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\\\"getSize\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new qe;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:\\\"getBoundingSphere\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Fe;return this.getCenter(e.center),e.radius=.5*this.getSize(Ae).length(),e}},{key:\\\"expandByPoint\\\",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:\\\"expandByVector\\\",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:\\\"expandByScalar\\\",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:\\\"setFromPoints\\\",value:function(e){var t,a;for(this.min.set(0,0),this.max.set(0,0),(t=0,a=e.length);t<a;++t)this.expandByPoint(e[t]);return this}},{key:\\\"setFromCenterAndSize\\\",value:function(e,t){var a=Ae.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(a),this.max.copy(e).add(a),this}},{key:\\\"clampPoint\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new qe;return t.copy(e).clamp(this.min,this.max)}},{key:\\\"distanceToPoint\\\",value:function(e){var t=Ae.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:\\\"translate\\\",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:\\\"intersect\\\",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:\\\"union\\\",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:\\\"containsPoint\\\",value:function(e){var t=this.min,a=this.max;return e.x>=t.x&&e.y>=t.y&&e.x<=a.x&&e.y<=a.y}},{key:\\\"containsBox\\\",value:function(e){var t=this.min,a=this.max,n=e.min,i=e.max;return t.x<=n.x&&i.x<=a.x&&t.y<=n.y&&i.y<=a.y}},{key:\\\"intersectsBox\\\",value:function(e){var t=this.min,a=this.max,n=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&n.x<=a.x&&n.y<=a.y}},{key:\\\"equals\\\",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),t}(),Be=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.radius=a,this.theta=n,this.y=i}return n(t,[{key:\\\"set\\\",value:function(e,t,a){return this.radius=e,this.theta=t,this.y=a,this}},{key:\\\"copy\\\",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"setFromVector3\\\",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:\\\"setFromCartesianCoords\\\",value:function(e,t,a){return this.radius=ke(e*e+a*a),this.theta=pe(e,a),this.y=t,this}}]),t}(),Ne=function(){function t(){e(this,t),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return n(t,[{key:\\\"set\\\",value:function(e,t,a,n,i,l,o,s,r){var d=this.elements;return d[0]=e,d[3]=t,d[6]=a,d[1]=n,d[4]=i,d[7]=l,d[2]=o,d[5]=s,d[8]=r,this}},{key:\\\"identity\\\",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:\\\"copy\\\",value:function(e){var t=e.elements,a=this.elements;return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],this}},{key:\\\"clone\\\",value:function(){return new this.constructor().fromArray(this.elements)}},{key:\\\"fromArray\\\",value:function(e){var t,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(t=0;9>t;++t)n[t]=e[t+a];return this}},{key:\\\"toArray\\\",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(e=0;9>e;++e)t[e+a]=n[e];return t}},{key:\\\"multiplyMatrices\\\",value:function(e,t){var a=e.elements,n=t.elements,i=this.elements,l=a[0],o=a[3],s=a[6],r=a[1],d=a[4],y=a[7],u=a[2],c=a[5],m=a[8],x=n[0],p=n[3],v=n[6],g=n[1],k=n[4],h=n[7],z=n[2],f=n[5],S=n[8];return i[0]=l*x+o*g+s*z,i[3]=l*p+o*k+s*f,i[6]=l*v+o*h+s*S,i[1]=r*x+d*g+y*z,i[4]=r*p+d*k+y*f,i[7]=r*v+d*h+y*S,i[2]=u*x+c*g+m*z,i[5]=u*p+c*k+m*f,i[8]=u*v+c*h+m*S,this}},{key:\\\"multiply\\\",value:function(e){return this.multiplyMatrices(this,e)}},{key:\\\"premultiply\\\",value:function(e){return this.multiplyMatrices(e,this)}},{key:\\\"multiplyScalar\\\",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:\\\"determinant\\\",value:function(){var t=this.elements,n=t[0],a=t[1],l=t[2],o=t[3],s=t[4],e=t[5],r=t[6],d=t[7],y=t[8];return n*s*y-n*e*d-a*o*y+a*e*r+l*o*d-l*s*r}},{key:\\\"getInverse\\\",value:function(e){var t,a=e.elements,n=this.elements,i=a[0],l=a[1],o=a[2],s=a[3],r=a[4],d=a[5],y=a[6],u=a[7],c=a[8],m=c*r-d*u,x=d*y-c*s,p=u*s-r*y,v=i*m+l*x+o*p;return 0===v?(console.error(\\\"Can't invert matrix, determinant is zero\\\",e),this.identity()):(t=1/v,n[0]=m*t,n[1]=(o*u-c*l)*t,n[2]=(d*l-o*r)*t,n[3]=x*t,n[4]=(c*i-o*y)*t,n[5]=(o*s-d*i)*t,n[6]=p*t,n[7]=(l*y-u*i)*t,n[8]=(r*i-l*s)*t),this}},{key:\\\"transpose\\\",value:function(){var e,a=this.elements;return e=a[1],a[1]=a[3],a[3]=e,e=a[2],a[2]=a[6],a[6]=e,e=a[5],a[5]=a[7],a[7]=e,this}},{key:\\\"scale\\\",value:function(e,t){var a=this.elements;return a[0]*=e,a[3]*=e,a[6]*=e,a[1]*=t,a[4]*=t,a[7]*=t,this}},{key:\\\"rotate\\\",value:function(e){var t=he(e),a=ze(e),n=this.elements,i=n[0],l=n[3],o=n[6],s=n[1],r=n[4],d=n[7];return n[0]=t*i+a*s,n[3]=t*l+a*r,n[6]=t*o+a*d,n[1]=-a*i+t*s,n[4]=-a*l+t*r,n[7]=-a*o+t*d,this}},{key:\\\"translate\\\",value:function(e,t){var a=this.elements;return a[0]+=e*a[2],a[3]+=e*a[5],a[6]+=e*a[8],a[1]+=t*a[2],a[4]+=t*a[5],a[7]+=t*a[8],this}},{key:\\\"equals\\\",value:function(e){var t,a=this.elements,n=e.elements,l=!0;for(t=0;l&&9>t;++t)a[t]!==n[t]&&(l=!1);return l}}]),t}(),Oe={XYZ:\\\"XYZ\\\",YZX:\\\"YZX\\\",ZXY:\\\"ZXY\\\",XZY:\\\"XZY\\\",YXZ:\\\"YXZ\\\",ZYX:\\\"ZYX\\\"},Le=new Pe,Me=function(){var a=Number.EPSILON;function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;e(this,t),this.x=a,this.y=n,this.z=i,this.w=l}return n(t,[{key:\\\"set\\\",value:function(e,t,a,n){return this.x=e,this.y=t,this.z=a,this.w=n,this}},{key:\\\"copy\\\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:\\\"clone\\\",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:\\\"fromArray\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:\\\"toArray\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:\\\"setFromEuler\\\",value:function(e){var t=e.x,a=e.y,n=e.z,i=he,l=ze,o=i(t/2),s=i(a/2),r=i(n/2),d=l(t/2),y=l(a/2),u=l(n/2);switch(e.order){case Oe.XYZ:this.x=d*s*r+o*y*u,this.y=o*y*r-d*s*u,this.z=o*s*u+d*y*r,this.w=o*s*r-d*y*u;break;case Oe.YXZ:this.x=d*s*r+o*y*u,this.y=o*y*r-d*s*u,this.z=o*s*u-d*y*r,this.w=o*s*r+d*y*u;break;case Oe.ZXY:this.x=d*s*r-o*y*u,this.y=o*y*r+d*s*u,this.z=o*s*u+d*y*r,this.w=o*s*r-d*y*u;break;case Oe.ZYX:this.x=d*s*r-o*y*u,this.y=o*y*r+d*s*u,this.z=o*s*u-d*y*r,this.w=o*s*r+d*y*u;break;case Oe.YZX:this.x=d*s*r+o*y*u,this.y=o*y*r+d*s*u,this.z=o*s*u-d*y*r,this.w=o*s*r-d*y*u;break;case Oe.XZY:this.x=d*s*r-o*y*u,this.y=o*y*r-d*s*u,this.z=o*s*u+d*y*r,this.w=o*s*r+d*y*u;}return this}},{key:\\\"setFromAxisAngle\\\",value:function(e,t){var a=t/2,n=ze(a);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=he(a),this}},{key:\\\"setFromRotationMatrix\\\",value:function(e){var t,a=e.elements,n=a[0],i=a[4],l=a[8],o=a[1],r=a[5],d=a[9],y=a[2],u=a[6],c=a[10],m=n+r+c;return 0<m?(t=.5/ke(m+1),this.w=.25/t,this.x=(u-d)*t,this.y=(l-y)*t,this.z=(o-i)*t):n>r&&n>c?(t=2*ke(1+n-r-c),this.w=(u-d)/t,this.x=.25*t,this.y=(i+o)/t,this.z=(l+y)/t):r>c?(t=2*ke(1+r-n-c),this.w=(l-y)/t,this.x=(i+o)/t,this.y=.25*t,this.z=(d+u)/t):(t=2*ke(1+c-n-r),this.w=(o-i)/t,this.x=(l+y)/t,this.y=(d+u)/t,this.z=.25*t),this}},{key:\\\"setFromUnitVectors\\\",value:function(e,t){var a=e.dot(t)+1;return 1e-6>a?(a=0,we(e.x)>we(e.z)?Le.set(-e.y,e.x,0):Le.set(0,-e.z,e.y)):Le.crossVectors(e,t),this.x=Le.x,this.y=Le.y,this.z=Le.z,this.w=a,this.normalize()}},{key:\\\"angleTo\\\",value:function(e){return 2*ge(we(Ie(Te(this.dot(e),-1),1)))}},{key:\\\"rotateTowards\\\",value:function(e,t){var a=this.angleTo(e);return 0!==a&&this.slerp(e,Ie(1,t/a)),this}},{key:\\\"invert\\\",value:function(){return this.conjugate()}},{key:\\\"conjugate\\\",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:\\\"lengthSquared\\\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:\\\"length\\\",value:function(){return ke(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:\\\"normalize\\\",value:function(){var e,t=this.length();return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/t,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:\\\"dot\\\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:\\\"multiplyQuaternions\\\",value:function(e,t){var a=e.x,n=e.y,i=e.z,l=e.w,o=t.x,s=t.y,r=t.z,d=t.w;return this.x=a*d+l*o+n*r-i*s,this.y=n*d+l*s+i*o-a*r,this.z=i*d+l*r+a*s-n*o,this.w=l*d-a*o-n*s-i*r,this}},{key:\\\"multiply\\\",value:function(e){return this.multiplyQuaternions(this,e)}},{key:\\\"premultiply\\\",value:function(e){return this.multiplyQuaternions(e,this)}},{key:\\\"slerp\\\",value:function(e,n){var t,i,l,o,r,d,u,c=this.x,m=this.y,y=this.z,x=this.w;return 1===n?this.copy(e):0<n&&(t=x*e.w+c*e.x+m*e.y+y*e.z,0>t?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,t=-t):this.copy(e),1<=t?(this.w=x,this.x=c,this.y=m,this.z=y):(i=1-t*t,r=1-n,i<=a?(this.w=r*x+n*this.w,this.x=r*c+n*this.x,this.y=r*m+n*this.y,this.z=r*y+n*this.z,this.normalize()):(l=ke(i),o=pe(l,t),d=ze(r*o)/l,u=ze(n*o)/l,this.w=x*d+this.w*u,this.x=c*d+this.x*u,this.y=m*d+this.y*u,this.z=y*d+this.z*u))),this}},{key:\\\"equals\\\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}],[{key:\\\"slerp\\\",value:function(e,a,n,i){return n.copy(e).slerp(a,i)}},{key:\\\"slerpFlat\\\",value:function(e,n,i,l,o,r,d){var y,u,c,m,x,p,v,g,k=o[r],h=o[r+1],z=o[r+2],S=o[r+3],w=i[l],T=i[l+1],I=i[l+2],C=i[l+3];(C!==S||w!==k||T!==h||I!==z)&&(y=1-d,m=w*k+T*h+I*z+C*S,p=0<=m?1:-1,x=1-m*m,x>a&&(c=ke(x),v=pe(c,m*p),y=ze(y*v)/c,d=ze(d*v)/c),g=d*p,w=w*y+k*g,T=T*y+h*g,I=I*y+z*g,C=C*y+S*g,y===1-d&&(u=1/ke(w*w+T*T+I*I+C*C),w*=u,T*=u,I*=u,C*=u)),e[n]=w,e[n+1]=T,e[n+2]=I,e[n+3]=C}}]),t}(),Re=new Ne,m=new Me,q=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.x=a,this.y=n,this.z=i,this.order=t.defaultOrder}return n(t,[{key:\\\"set\\\",value:function(e,t,a,n){return this.x=e,this.y=t,this.z=a,this.order=n,this}},{key:\\\"copy\\\",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}},{key:\\\"clone\\\",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:\\\"fromArray\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.order=e[t+3],this}},{key:\\\"toArray\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.order,e}},{key:\\\"toVector3\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return e.set(this.x,this.y,this.z)}},{key:\\\"setFromRotationMatrix\\\",value:function(e){var t=Math.asin,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order,n=e.elements,i=n[0],l=n[4],o=n[8],s=n[1],r=n[5],d=n[9],y=n[2],u=n[6],c=n[10],m=1-1e-5;switch(a){case Oe.XYZ:{this.y=t(P(o,-1,1)),we(o)<m?(this.x=pe(-d,c),this.z=pe(-l,i)):(this.x=pe(u,r),this.z=0);break}case Oe.YXZ:{this.x=t(-P(d,-1,1)),we(d)<m?(this.y=pe(o,c),this.z=pe(s,r)):(this.y=pe(-y,i),this.z=0);break}case Oe.ZXY:{this.x=t(P(u,-1,1)),we(u)<m?(this.y=pe(-y,c),this.z=pe(-l,r)):(this.y=0,this.z=pe(s,i));break}case Oe.ZYX:{this.y=t(-P(y,-1,1)),we(y)<m?(this.x=pe(u,c),this.z=pe(s,i)):(this.x=0,this.z=pe(-l,r));break}case Oe.YZX:{this.z=t(P(s,-1,1)),we(s)<m?(this.x=pe(-d,r),this.y=pe(-y,i)):(this.x=0,this.y=pe(o,c));break}case Oe.XZY:{this.z=t(-P(l,-1,1)),we(l)<m?(this.x=pe(u,r),this.y=pe(o,i)):(this.x=pe(-d,c),this.y=0);break}}return this.order=a,this}},{key:\\\"setFromQuaternion\\\",value:function(e,t){return Re.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Re,t)}},{key:\\\"setFromVector3\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(e.x,e.y,e.z,t)}},{key:\\\"reorder\\\",value:function(e){return m.setFromEuler(this),this.setFromQuaternion(m,e)}},{key:\\\"equals\\\",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order}}],[{key:\\\"defaultOrder\\\",get:function(){return Oe.XYZ}}]),t}(),Ye=new Pe,a=new Pe,b=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe(1,0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.normal=a,this.constant=n}return n(t,[{key:\\\"set\\\",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:\\\"setComponents\\\",value:function(e,t,a,n){return this.normal.set(e,t,a),this.constant=n,this}},{key:\\\"copy\\\",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"setFromNormalAndCoplanarPoint\\\",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:\\\"setFromCoplanarPoints\\\",value:function(e,t,n){var i=Ye.subVectors(n,t).cross(a.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,Ye),this}},{key:\\\"normalize\\\",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:\\\"negate\\\",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:\\\"distanceToPoint\\\",value:function(e){return this.normal.dot(e)+this.constant}},{key:\\\"distanceToSphere\\\",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:\\\"projectPoint\\\",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:\\\"coplanarPoint\\\",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:\\\"translate\\\",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:\\\"intersectLine\\\",value:function(e,a){var n=e.delta(Ye),i=this.normal.dot(n);if(0===i)0===this.distanceToPoint(e.start)&&a.copy(e.start);else{var l=-(e.start.dot(this.normal)+this.constant)/i;0<=l&&1>=l&&a.copy(n).multiplyScalar(l).add(e.start)}return a}},{key:\\\"intersectsLine\\\",value:function(e){var t=this.distanceToPoint(e.start),a=this.distanceToPoint(e.end);return 0>t&&0<a||0>a&&0<t}},{key:\\\"intersectsBox\\\",value:function(e){return e.intersectsPlane(this)}},{key:\\\"intersectsSphere\\\",value:function(e){return e.intersectsPlane(this)}},{key:\\\"equals\\\",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}]),t}(),Xe=new Pe,Ze=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new b,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new b,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new b,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new b,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new b,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new b;e(this,t),this.planes=[a,n,i,l,o,s]}return n(t,[{key:\\\"set\\\",value:function(e,t,a,n,i,l){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(a),o[3].copy(n),o[4].copy(i),o[5].copy(l),this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"copy\\\",value:function(e){var t,a=this.planes;for(t=0;6>t;++t)a[t].copy(e.planes[t]);return this}},{key:\\\"setFromMatrix\\\",value:function(e){var t=this.planes,a=e.elements,n=a[0],i=a[1],l=a[2],o=a[3],s=a[4],r=a[5],d=a[6],y=a[7],u=a[8],c=a[9],m=a[10],x=a[11],p=a[12],v=a[13],g=a[14],k=a[15];return t[0].setComponents(o-n,y-s,x-u,k-p).normalize(),t[1].setComponents(o+n,y+s,x+u,k+p).normalize(),t[2].setComponents(o+i,y+r,x+c,k+v).normalize(),t[3].setComponents(o-i,y-r,x-c,k-v).normalize(),t[4].setComponents(o-l,y-d,x-m,k-g).normalize(),t[5].setComponents(o+l,y+d,x+m,k+g).normalize(),this}},{key:\\\"intersectsSphere\\\",value:function(e){var t,a,n=this.planes,l=e.center,o=-e.radius,s=!0;for(t=0;6>t;++t)if(a=n[t].distanceToPoint(l),a<o){s=!1;break}return s}},{key:\\\"intersectsBox\\\",value:function(e){var t,a,n=this.planes,l=e.min,o=e.max;for(t=0;6>t;++t)if(a=n[t],Xe.x=0<a.normal.x?o.x:l.x,Xe.y=0<a.normal.y?o.y:l.y,Xe.z=0<a.normal.z?o.z:l.z,0>a.distanceToPoint(Xe))return!1;return!0}},{key:\\\"containsPoint\\\",value:function(e){var t,a=this.planes,n=!0;for(t=0;6>t;++t)if(0>a[t].distanceToPoint(e)){n=!1;break}return n}}]),t}(),_e=new Pe,je=new Pe,Ue=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe;e(this,t),this.start=a,this.end=n}return n(t,[{key:\\\"set\\\",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:\\\"copy\\\",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"getCenter\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:\\\"delta\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return e.subVectors(this.end,this.start)}},{key:\\\"lengthSquared\\\",value:function(){return this.start.distanceToSquared(this.end)}},{key:\\\"length\\\",value:function(){return this.start.distanceTo(this.end)}},{key:\\\"at\\\",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:\\\"closestPointToPointParameter\\\",value:function(e,a){_e.subVectors(e,this.start),je.subVectors(this.end,this.start);var n=je.dot(je),i=je.dot(_e),l=a?Ie(Te(i/n,0),1):i/n;return l}},{key:\\\"closestPointToPoint\\\",value:function(e){var a=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Pe,i=this.closestPointToPointParameter(e,a);return this.delta(n).multiplyScalar(i).add(this.start)}},{key:\\\"equals\\\",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}]),t}(),Qe=new Pe,Ge=new Pe,He=new Pe,c=function(){function t(){e(this,t),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return n(t,[{key:\\\"set\\\",value:function(e,t,a,n,i,l,o,s,r,d,y,u,c,m,x,p){var v=this.elements;return v[0]=e,v[4]=t,v[8]=a,v[12]=n,v[1]=i,v[5]=l,v[9]=o,v[13]=s,v[2]=r,v[6]=d,v[10]=y,v[14]=u,v[3]=c,v[7]=m,v[11]=x,v[15]=p,this}},{key:\\\"identity\\\",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:\\\"copy\\\",value:function(e){var t=e.elements,a=this.elements;return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],this}},{key:\\\"clone\\\",value:function(){return new this.constructor().fromArray(this.elements)}},{key:\\\"fromArray\\\",value:function(e){var t,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(t=0;16>t;++t)n[t]=e[t+a];return this}},{key:\\\"toArray\\\",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(e=0;16>e;++e)t[e+a]=n[e];return t}},{key:\\\"getMaxScaleOnAxis\\\",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],a=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return ke(Te(t,a,n))}},{key:\\\"copyPosition\\\",value:function(e){var t=this.elements,a=e.elements;return t[12]=a[12],t[13]=a[13],t[14]=a[14],this}},{key:\\\"setPosition\\\",value:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}},{key:\\\"extractBasis\\\",value:function(e,t,a){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),a.setFromMatrixColumn(this,2),this}},{key:\\\"makeBasis\\\",value:function(e,t,a){return this.set(e.x,t.x,a.x,0,e.y,t.y,a.y,0,e.z,t.z,a.z,0,0,0,0,1),this}},{key:\\\"extractRotation\\\",value:function(e){var t=this.elements,a=e.elements,n=1/Qe.setFromMatrixColumn(e,0).length(),i=1/Qe.setFromMatrixColumn(e,1).length(),l=1/Qe.setFromMatrixColumn(e,2).length();return t[0]=a[0]*n,t[1]=a[1]*n,t[2]=a[2]*n,t[3]=0,t[4]=a[4]*i,t[5]=a[5]*i,t[6]=a[6]*i,t[7]=0,t[8]=a[8]*l,t[9]=a[9]*l,t[10]=a[10]*l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:\\\"makeRotationFromEuler\\\",value:function(t){var n,i,l,o,s,r,u,m,p,v,g,k,h=this.elements,S=t.x,x=t.y,y=t.z,z=he(S),a=ze(S),w=he(x),c=ze(x),d=he(y),e=ze(y);switch(t.order){case Oe.XYZ:{n=z*d,i=z*e,l=a*d,o=a*e,h[0]=w*d,h[4]=-w*e,h[8]=c,h[1]=i+l*c,h[5]=n-o*c,h[9]=-a*w,h[2]=o-n*c,h[6]=l+i*c,h[10]=z*w;break}case Oe.YXZ:{s=w*d,r=w*e,u=c*d,m=c*e,h[0]=s+m*a,h[4]=u*a-r,h[8]=z*c,h[1]=z*e,h[5]=z*d,h[9]=-a,h[2]=r*a-u,h[6]=m+s*a,h[10]=z*w;break}case Oe.ZXY:{s=w*d,r=w*e,u=c*d,m=c*e,h[0]=s-m*a,h[4]=-z*e,h[8]=u+r*a,h[1]=r+u*a,h[5]=z*d,h[9]=m-s*a,h[2]=-z*c,h[6]=a,h[10]=z*w;break}case Oe.ZYX:{n=z*d,i=z*e,l=a*d,o=a*e,h[0]=w*d,h[4]=l*c-i,h[8]=n*c+o,h[1]=w*e,h[5]=o*c+n,h[9]=i*c-l,h[2]=-c,h[6]=a*w,h[10]=z*w;break}case Oe.YZX:{p=z*w,v=z*c,g=a*w,k=a*c,h[0]=w*d,h[4]=k-p*e,h[8]=g*e+v,h[1]=e,h[5]=z*d,h[9]=-a*d,h[2]=-c*d,h[6]=v*e+g,h[10]=p-k*e;break}case Oe.XZY:{p=z*w,v=z*c,g=a*w,k=a*c,h[0]=w*d,h[4]=-e,h[8]=c*d,h[1]=p*e+k,h[5]=z*d,h[9]=v*e-g,h[2]=g*e-v,h[6]=a*d,h[10]=k*e+p;break}}return h[3]=0,h[7]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,this}},{key:\\\"makeRotationFromQuaternion\\\",value:function(e){return this.compose(Qe.set(0,0,0),e,Ge.set(1,1,1))}},{key:\\\"lookAt\\\",value:function(e,t,a){var n=this.elements,i=Qe,l=Ge,o=He;return o.subVectors(e,t),0===o.lengthSquared()&&(o.z=1),o.normalize(),i.crossVectors(a,o),0===i.lengthSquared()&&(1===we(a.z)?o.x+=1e-4:o.z+=1e-4,o.normalize(),i.crossVectors(a,o)),i.normalize(),l.crossVectors(o,i),n[0]=i.x,n[4]=l.x,n[8]=o.x,n[1]=i.y,n[5]=l.y,n[9]=o.y,n[2]=i.z,n[6]=l.z,n[10]=o.z,this}},{key:\\\"multiplyMatrices\\\",value:function(e,t){var a=this.elements,n=e.elements,i=t.elements,l=n[0],o=n[4],s=n[8],r=n[12],d=n[1],y=n[5],u=n[9],c=n[13],m=n[2],x=n[6],p=n[10],v=n[14],g=n[3],k=n[7],h=n[11],z=n[15],f=i[0],S=i[4],w=i[8],T=i[12],I=i[1],C=i[5],P=i[9],b=i[13],E=i[2],D=i[6],F=i[10],q=i[14],A=i[3],V=i[7],B=i[11],N=i[15];return a[0]=l*f+o*I+s*E+r*A,a[4]=l*S+o*C+s*D+r*V,a[8]=l*w+o*P+s*F+r*B,a[12]=l*T+o*b+s*q+r*N,a[1]=d*f+y*I+u*E+c*A,a[5]=d*S+y*C+u*D+c*V,a[9]=d*w+y*P+u*F+c*B,a[13]=d*T+y*b+u*q+c*N,a[2]=m*f+x*I+p*E+v*A,a[6]=m*S+x*C+p*D+v*V,a[10]=m*w+x*P+p*F+v*B,a[14]=m*T+x*b+p*q+v*N,a[3]=g*f+k*I+h*E+z*A,a[7]=g*S+k*C+h*D+z*V,a[11]=g*w+k*P+h*F+z*B,a[15]=g*T+k*b+h*q+z*N,this}},{key:\\\"multiply\\\",value:function(e){return this.multiplyMatrices(this,e)}},{key:\\\"premultiply\\\",value:function(e){return this.multiplyMatrices(e,this)}},{key:\\\"multiplyScalar\\\",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:\\\"determinant\\\",value:function(){var e=this.elements,t=e[0],a=e[4],n=e[8],i=e[12],l=e[1],o=e[5],s=e[9],r=e[13],d=e[2],y=e[6],u=e[10],c=e[14],m=e[3],x=e[7],p=e[11],v=e[15],g=t*o,k=t*s,h=t*r,z=a*l,f=a*s,S=a*r,w=n*l,T=n*o,I=n*r,C=i*l,P=i*o,b=i*s;return m*(b*y-I*y-P*u+S*u+T*c-f*c)+x*(k*c-h*u+C*u-w*c+I*d-b*d)+p*(h*y-g*c-C*y+z*c+P*d-S*d)+v*(-T*d-k*y+g*u+w*y-z*u+f*d)}},{key:\\\"getInverse\\\",value:function(e){var t,a=this.elements,n=e.elements,i=n[0],l=n[1],o=n[2],s=n[3],r=n[4],d=n[5],y=n[6],u=n[7],c=n[8],m=n[9],x=n[10],p=n[11],v=n[12],g=n[13],k=n[14],h=n[15],z=m*k*u-g*x*u+g*y*p-d*k*p-m*y*h+d*x*h,f=v*x*u-c*k*u-v*y*p+r*k*p+c*y*h-r*x*h,S=c*g*u-v*m*u+v*d*p-r*g*p-c*d*h+r*m*h,w=v*m*y-c*g*y-v*d*x+r*g*x+c*d*k-r*m*k,T=i*z+l*f+o*S+s*w;return 0===T?(console.error(\\\"Can't invert matrix, determinant is zero\\\",e),this.identity()):(t=1/T,a[0]=z*t,a[1]=(g*x*s-m*k*s-g*o*p+l*k*p+m*o*h-l*x*h)*t,a[2]=(d*k*s-g*y*s+g*o*u-l*k*u-d*o*h+l*y*h)*t,a[3]=(m*y*s-d*x*s-m*o*u+l*x*u+d*o*p-l*y*p)*t,a[4]=f*t,a[5]=(c*k*s-v*x*s+v*o*p-i*k*p-c*o*h+i*x*h)*t,a[6]=(v*y*s-r*k*s-v*o*u+i*k*u+r*o*h-i*y*h)*t,a[7]=(r*x*s-c*y*s+c*o*u-i*x*u-r*o*p+i*y*p)*t,a[8]=S*t,a[9]=(v*m*s-c*g*s-v*l*p+i*g*p+c*l*h-i*m*h)*t,a[10]=(r*g*s-v*d*s+v*l*u-i*g*u-r*l*h+i*d*h)*t,a[11]=(c*d*s-r*m*s-c*l*u+i*m*u+r*l*p-i*d*p)*t,a[12]=w*t,a[13]=(c*g*o-v*m*o+v*l*x-i*g*x-c*l*k+i*m*k)*t,a[14]=(v*d*o-r*g*o-v*l*y+i*g*y+r*l*k-i*d*k)*t,a[15]=(r*m*o-c*d*o+c*l*y-i*m*y-r*l*x+i*d*x)*t),this}},{key:\\\"transpose\\\",value:function(){var e,a=this.elements;return e=a[1],a[1]=a[4],a[4]=e,e=a[2],a[2]=a[8],a[8]=e,e=a[6],a[6]=a[9],a[9]=e,e=a[3],a[3]=a[12],a[12]=e,e=a[7],a[7]=a[13],a[13]=e,e=a[11],a[11]=a[14],a[14]=e,this}},{key:\\\"scale\\\",value:function(e,t,a){var n=this.elements;return n[0]*=e,n[4]*=t,n[8]*=a,n[1]*=e,n[5]*=t,n[9]*=a,n[2]*=e,n[6]*=t,n[10]*=a,n[3]*=e,n[7]*=t,n[11]*=a,this}},{key:\\\"makeScale\\\",value:function(e,t,a){return this.set(e,0,0,0,0,t,0,0,0,0,a,0,0,0,0,1),this}},{key:\\\"makeTranslation\\\",value:function(e,t,a){return this.set(1,0,0,e,0,1,0,t,0,0,1,a,0,0,0,1),this}},{key:\\\"makeRotationX\\\",value:function(e){var t=he(e),a=ze(e);return this.set(1,0,0,0,0,t,-a,0,0,a,t,0,0,0,0,1),this}},{key:\\\"makeRotationY\\\",value:function(e){var t=he(e),a=ze(e);return this.set(t,0,a,0,0,1,0,0,-a,0,t,0,0,0,0,1),this}},{key:\\\"makeRotationZ\\\",value:function(e){var t=he(e),a=ze(e);return this.set(t,-a,0,0,a,t,0,0,0,0,1,0,0,0,0,1),this}},{key:\\\"makeRotationAxis\\\",value:function(e,a){var n=he(a),i=ze(a),l=1-n,t=e.x,o=e.y,s=e.z,r=l*t,d=l*o;return this.set(r*t+n,r*o-i*s,r*s+i*o,0,r*o+i*s,d*o+n,d*s-i*t,0,r*s-i*o,d*s+i*t,l*s*s+n,0,0,0,0,1),this}},{key:\\\"makeShear\\\",value:function(e,t,a){return this.set(1,t,a,0,e,1,a,0,e,t,1,0,0,0,0,1),this}},{key:\\\"compose\\\",value:function(e,t,a){var n=this.elements,i=t.x,l=t.y,o=t.z,s=t.w,r=i+i,d=l+l,y=o+o,u=i*r,c=i*d,m=i*y,x=l*d,p=l*y,v=o*y,g=s*r,k=s*d,h=s*y,z=a.x,f=a.y,S=a.z;return n[0]=(1-(x+v))*z,n[1]=(c+h)*z,n[2]=(m-k)*z,n[3]=0,n[4]=(c-h)*f,n[5]=(1-(u+v))*f,n[6]=(p+g)*f,n[7]=0,n[8]=(m+k)*S,n[9]=(p-g)*S,n[10]=(1-(u+x))*S,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}},{key:\\\"decompose\\\",value:function(e,t,a){var n=this.elements,i=n[0],l=n[1],o=n[2],s=n[4],r=n[5],d=n[6],y=n[8],u=n[9],c=n[10],m=this.determinant(),x=Qe.set(i,l,o).length()*(0>m?-1:1),p=Qe.set(s,r,d).length(),v=Qe.set(y,u,c).length(),g=1/x,k=1/p,h=1/v;return e.x=n[12],e.y=n[13],e.z=n[14],n[0]*=g,n[1]*=g,n[2]*=g,n[4]*=k,n[5]*=k,n[6]*=k,n[8]*=h,n[9]*=h,n[10]*=h,t.setFromRotationMatrix(this),n[0]=i,n[1]=l,n[2]=o,n[4]=s,n[5]=r,n[6]=d,n[8]=y,n[9]=u,n[10]=c,a.x=x,a.y=p,a.z=v,this}},{key:\\\"makePerspective\\\",value:function(e,t,a,n,i,l){var o=this.elements;return o[0]=2*i/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*i/(a-n),o[9]=(a+n)/(a-n),o[13]=0,o[2]=0,o[6]=0,o[10]=-(l+i)/(l-i),o[14]=-2*l*i/(l-i),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:\\\"makeOrthographic\\\",value:function(e,t,a,n,i,l){var o=this.elements,s=1/(t-e),r=1/(a-n),d=1/(l-i);return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-((t+e)*s),o[1]=0,o[5]=2*r,o[9]=0,o[13]=-((a+n)*r),o[2]=0,o[6]=0,o[10]=-2*d,o[14]=-((l+i)*d),o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:\\\"equals\\\",value:function(e){var t,a=this.elements,n=e.elements,l=!0;for(t=0;l&&16>t;++t)a[t]!==n[t]&&(l=!1);return l}}]),t}(),Je=[new Pe,new Pe,new Pe,new Pe],Ke=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe;e(this,t),this.origin=a,this.direction=n}return n(t,[{key:\\\"set\\\",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:\\\"copy\\\",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"at\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe;return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:\\\"lookAt\\\",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:\\\"recast\\\",value:function(e){return this.origin.copy(this.at(e,Je[0])),this}},{key:\\\"closestPointToPoint\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe,a=t.subVectors(e,this.origin).dot(this.direction);return 0<=a?t.copy(this.direction).multiplyScalar(a).add(this.origin):t.copy(this.origin)}},{key:\\\"distanceSquaredToPoint\\\",value:function(e){var t=Je[0].subVectors(e,this.origin).dot(this.direction);return 0>t?this.origin.distanceToSquared(e):Je[0].copy(this.direction).multiplyScalar(t).add(this.origin).distanceToSquared(e)}},{key:\\\"distanceToPoint\\\",value:function(e){return ke(this.distanceSquaredToPoint(e))}},{key:\\\"distanceToPlane\\\",value:function(e){var a=e.normal.dot(this.direction),n=0===a?0===e.distanceToPoint(this.origin)?0:-1:-(this.origin.dot(e.normal)+e.constant)/a;return 0<=n?n:null}},{key:\\\"distanceSquaredToSegment\\\",value:function(e,t,a,n){var i,l,o,s,r,d=Je[0].copy(e).add(t).multiplyScalar(.5),y=Je[1].copy(t).sub(e).normalize(),u=Je[2].copy(this.origin).sub(d),m=.5*e.distanceTo(t),x=-this.direction.dot(y),p=u.dot(this.direction),v=-u.dot(y),g=u.lengthSq(),c=we(1-x*x);return 0<c?(i=x*v-p,l=x*p-v,o=m*c,0<=i?l>=-o?l<=o?(s=1/c,i*=s,l*=s,r=i*(i+x*l+2*p)+l*(x*i+l+2*v)+g):(l=m,i=Te(0,-(x*l+p)),r=-i*i+l*(l+2*v)+g):(l=-m,i=Te(0,-(x*l+p)),r=-i*i+l*(l+2*v)+g):l<=-o?(i=Te(0,-(-x*m+p)),l=0<i?-m:Ie(Te(-m,-v),m),r=-i*i+l*(l+2*v)+g):l<=o?(i=0,l=Ie(Te(-m,-v),m),r=l*(l+2*v)+g):(i=Te(0,-(x*m+p)),l=0<i?m:Ie(Te(-m,-v),m),r=-i*i+l*(l+2*v)+g)):(l=0<x?-m:m,i=Te(0,-(x*l+p)),r=-i*i+l*(l+2*v)+g),void 0!==a&&a.copy(this.direction).multiplyScalar(i).add(this.origin),void 0!==n&&n.copy(y).multiplyScalar(l).add(d),r}},{key:\\\"intersectSphere\\\",value:function(e){var t,a,n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe,l=Je[0].subVectors(e.center,this.origin),o=l.dot(this.direction),s=l.dot(l)-o*o,r=e.radius*e.radius,d=null;return s<=r&&(t=ke(r-s),a=o-t,n=o+t,(0<=a||0<=n)&&(d=0>a?this.at(n,i):this.at(a,i))),d}},{key:\\\"intersectsSphere\\\",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:\\\"intersectPlane\\\",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe,n=this.distanceToPlane(e);return null===n?null:this.at(n,a)}},{key:\\\"intersectsPlane\\\",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t}},{key:\\\"intersectBox\\\",value:function(e){var t,a,n,i,l,o,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe,r=this.origin,d=this.direction,y=e.min,u=e.max,c=1/d.x,m=1/d.y,x=1/d.z,p=null;return 0<=c?(t=(y.x-r.x)*c,a=(u.x-r.x)*c):(t=(u.x-r.x)*c,a=(y.x-r.x)*c),0<=m?(n=(y.y-r.y)*m,i=(u.y-r.y)*m):(n=(u.y-r.y)*m,i=(y.y-r.y)*m),t<=i&&n<=a&&((n>t||t!==t)&&(t=n),(i<a||a!==a)&&(a=i),0<=x?(l=(y.z-r.z)*x,o=(u.z-r.z)*x):(l=(u.z-r.z)*x,o=(y.z-r.z)*x),t<=o&&l<=a&&((l>t||t!==t)&&(t=l),(o<a||a!==a)&&(a=o),0<=a&&(p=this.at(0<=t?t:a,s)))),p}},{key:\\\"intersectsBox\\\",value:function(e){return null!==this.intersectBox(e,Je[0])}},{key:\\\"intersectTriangle\\\",value:function(e,t,a,n,i){var l,o,s,r,d,y=this.direction,u=Je[0],c=Je[1],m=Je[2],x=Je[3],p=null;return c.subVectors(t,e),m.subVectors(a,e),x.crossVectors(c,m),l=y.dot(x),0===l||n&&0<l||(0<l?o=1:(o=-1,l=-l),u.subVectors(this.origin,e),s=o*y.dot(m.crossVectors(u,m)),0<=s&&(r=o*y.dot(c.cross(u)),0<=r&&s+r<=l&&(d=-o*u.dot(x),0<=d&&(p=this.at(d/l,i))))),p}},{key:\\\"applyMatrix4\\\",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:\\\"equals\\\",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),t}(),We=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.radius=a,this.phi=n,this.theta=i}return n(t,[{key:\\\"set\\\",value:function(e,t,a){return this.radius=e,this.phi=t,this.theta=a,this}},{key:\\\"copy\\\",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"makeSafe\\\",value:function(){return this.phi=Te(1e-6,Ie(xe-1e-6,this.phi)),this}},{key:\\\"setFromVector3\\\",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:\\\"setFromCartesianCoords\\\",value:function(e,t,a){return this.radius=ke(e*e+t*t+a*a),0===this.radius?(this.theta=0,this.phi=0):(this.theta=pe(e,a),this.phi=ge(Ie(Te(t/this.radius,-1),1))),this}}]),t}(),$e=function(){function t(){e(this,t),this.elements=new Float32Array([1,0,0,1,0,1])}return n(t,[{key:\\\"set\\\",value:function(t,a,n,i,l,o){var s=this.elements;return s[0]=t,s[1]=a,s[3]=i,s[2]=n,s[4]=l,s[5]=o,this}},{key:\\\"identity\\\",value:function(){return this.set(1,0,0,1,0,1),this}},{key:\\\"copy\\\",value:function(e){var t=e.elements;return this.set(t[0],t[1],t[2],t[3],t[4],t[5]),this}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}},{key:\\\"toMatrix3\\\",value:function(e){var t=e.elements;e.set(t[0],t[1],t[2],t[1],t[3],t[4],t[2],t[4],t[5])}},{key:\\\"add\\\",value:function(e){var t=this.elements,a=e.elements;return t[0]+=a[0],t[1]+=a[1],t[3]+=a[3],t[2]+=a[2],t[4]+=a[4],t[5]+=a[5],this}},{key:\\\"norm\\\",value:function(){var t=this.elements,e=t[1]*t[1],a=t[2]*t[2],n=t[4]*t[4];return ke(t[0]*t[0]+e+a+e+t[3]*t[3]+n+a+n+t[5]*t[5])}},{key:\\\"off\\\",value:function(){var t=this.elements;return ke(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:\\\"applyToVector3\\\",value:function(t){var a=t.x,n=t.y,i=t.z,l=this.elements;return t.x=l[0]*a+l[1]*n+l[2]*i,t.y=l[1]*a+l[3]*n+l[4]*i,t.z=l[2]*a+l[4]*n+l[5]*i,t}},{key:\\\"equals\\\",value:function(e){var t,a=this.elements,n=e.elements,l=!0;for(t=0;l&&6>t;++t)a[t]!==n[t]&&(l=!1);return l}}],[{key:\\\"calculateIndex\\\",value:function(e,t){return 3-(3-e)*(2-e)/2+t}}]),t}(),et=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;e(this,t),this.x=a,this.y=n,this.z=i,this.w=l}return n(t,[{key:\\\"set\\\",value:function(e,t,a,n){return this.x=e,this.y=t,this.z=a,this.w=n,this}},{key:\\\"copy\\\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:\\\"clone\\\",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:\\\"fromArray\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:\\\"toArray\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:\\\"setAxisAngleFromQuaternion\\\",value:function(e){this.w=2*ge(e.w);var t=ke(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:\\\"setAxisAngleFromRotationMatrix\\\",value:function(e){var t,a,n,i,l,o,r,d,u,c,m,p=.01,v=.1,g=e.elements,k=g[0],h=g[4],f=g[8],S=g[1],w=g[5],T=g[9],I=g[2],C=g[6],P=g[10];return we(h-S)<p&&we(f-I)<p&&we(T-C)<p?we(h+S)<v&&we(f+I)<v&&we(T+C)<v&&we(k+w+P-3)<v?this.set(1,0,0,0):(t=xe,l=(k+1)/2,o=(w+1)/2,r=(P+1)/2,d=(h+S)/4,u=(f+I)/4,c=(T+C)/4,l>o&&l>r?l<p?(a=0,n=.707106781,i=.707106781):(a=ke(l),n=d/a,i=u/a):o>r?o<p?(a=.707106781,n=0,i=.707106781):(n=ke(o),a=d/n,i=c/n):r<p?(a=.707106781,n=.707106781,i=0):(i=ke(r),a=u/i,n=c/i),this.set(a,n,i,t)):(m=ke((C-T)*(C-T)+(f-I)*(f-I)+(S-h)*(S-h)),.001>we(m)&&(m=1),this.x=(C-T)/m,this.y=(f-I)/m,this.z=(S-h)/m,this.w=ge((k+w+P-1)/2)),this}},{key:\\\"add\\\",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:\\\"addScalar\\\",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:\\\"addVectors\\\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:\\\"addScaledVector\\\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:\\\"sub\\\",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:\\\"subScalar\\\",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:\\\"subVectors\\\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:\\\"multiply\\\",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:\\\"multiplyScalar\\\",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:\\\"multiplyVectors\\\",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this.w=e.w*t.w,this}},{key:\\\"divide\\\",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}},{key:\\\"divideScalar\\\",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this}},{key:\\\"applyMatrix4\\\",value:function(t){var a=this.x,n=this.y,i=this.z,l=this.w,o=t.elements;return this.x=o[0]*a+o[4]*n+o[8]*i+o[12]*l,this.y=o[1]*a+o[5]*n+o[9]*i+o[13]*l,this.z=o[2]*a+o[6]*n+o[10]*i+o[14]*l,this.w=o[3]*a+o[7]*n+o[11]*i+o[15]*l,this}},{key:\\\"negate\\\",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:\\\"dot\\\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:\\\"manhattanLength\\\",value:function(){return we(this.x)+we(this.y)+we(this.z)+we(this.w)}},{key:\\\"lengthSquared\\\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:\\\"length\\\",value:function(){return ke(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:\\\"manhattanDistanceTo\\\",value:function(e){return we(this.x-e.x)+we(this.y-e.y)+we(this.z-e.z)+we(this.w-e.w)}},{key:\\\"distanceToSquared\\\",value:function(e){var t=this.x-e.x,a=this.y-e.y,n=this.z-e.z,i=this.w-e.w;return t*t+a*a+n*n+i*i}},{key:\\\"distanceTo\\\",value:function(e){return ke(this.distanceToSquared(e))}},{key:\\\"normalize\\\",value:function(){return this.divideScalar(this.length())}},{key:\\\"setLength\\\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\\\"min\\\",value:function(e){return this.x=Ie(this.x,e.x),this.y=Ie(this.y,e.y),this.z=Ie(this.z,e.z),this.w=Ie(this.w,e.w),this}},{key:\\\"max\\\",value:function(e){return this.x=Te(this.x,e.x),this.y=Te(this.y,e.y),this.z=Te(this.z,e.z),this.w=Te(this.w,e.w),this}},{key:\\\"clamp\\\",value:function(e,t){return this.x=Te(e.x,Ie(t.x,this.x)),this.y=Te(e.y,Ie(t.y,this.y)),this.z=Te(e.z,Ie(t.z,this.z)),this.w=Te(e.w,Ie(t.w,this.w)),this}},{key:\\\"floor\\\",value:function(){return this.x=fe(this.x),this.y=fe(this.y),this.z=fe(this.z),this.w=fe(this.w),this}},{key:\\\"ceil\\\",value:function(){return this.x=Se(this.x),this.y=Se(this.y),this.z=Se(this.z),this.w=Se(this.w),this}},{key:\\\"round\\\",value:function(){return this.x=ve(this.x),this.y=ve(this.y),this.z=ve(this.z),this.w=ve(this.w),this}},{key:\\\"lerp\\\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:\\\"lerpVectors\\\",value:function(e,t,a){return this.subVectors(t,e).multiplyScalar(a).add(e)}},{key:\\\"equals\\\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}]),t}(),tt=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];e(this,t),this.value=a,this.done=n}return n(t,[{key:\\\"reset\\\",value:function(){this.value=null,this.done=!1}}]),t}(),at=new Pe,nt=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe;e(this,t),this.min=a,this.max=n,this.children=null}return n(t,[{key:\\\"getCenter\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\\\"getDimensions\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return e.subVectors(this.max,this.min)}},{key:\\\"split\\\",value:function(){var e,t,a=this.min,n=this.max,l=this.getCenter(at),o=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)t=it[e],o[e]=new this.constructor(new Pe(0===t[0]?a.x:l.x,0===t[1]?a.y:l.y,0===t[2]?a.z:l.z),new Pe(0===t[0]?l.x:n.x,0===t[1]?l.y:n.y,0===t[2]?l.z:n.z))}}]),t}(),it=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],lt=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],ot=new Pe,st=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.min=a,this.size=n,this.children=null}return n(t,[{key:\\\"getCenter\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return e.copy(this.min).addScalar(.5*this.size)}},{key:\\\"getDimensions\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return e.set(this.size,this.size,this.size)}},{key:\\\"split\\\",value:function(){var e,t,a=this.min,n=this.getCenter(ot),l=.5*this.size,o=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)t=it[e],o[e]=new this.constructor(new Pe(0===t[0]?a.x:n.x,0===t[1]?a.y:n.y,0===t[2]?a.z:n.z),l)}},{key:\\\"max\\\",get:function(){return this.min.clone().addScalar(this.size)}}]),t}(),rt=new v,dt=function(){function t(a){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;e(this,t),this.octree=a,this.region=n,this.cull=null!==n,this.result=new tt,this.trace=null,this.indices=null,this.reset()}return n(t,[{key:\\\"reset\\\",value:function(){var e=this.octree.root;return this.trace=[],this.indices=[],null!==e&&(rt.min=e.min,rt.max=e.max,(!this.cull||this.region.intersectsBox(rt))&&(this.trace.push(e),this.indices.push(0))),this.result.reset(),this}},{key:\\\"next\\\",value:function(){for(var e,t,a,n=this.cull,i=this.region,l=this.indices,o=this.trace,s=null,r=o.length-1;null===s&&0<=r;)if(e=l[r]++,t=o[r].children,!(8>e))o.pop(),l.pop(),--r;else if(null!==t){if(a=t[e],n&&(rt.min=a.min,rt.max=a.max,!i.intersectsBox(rt)))continue;o.push(a),l.push(0),++r}else s=o.pop(),l.pop();return this.result.value=s,this.result.done=null===s,this.result}},{key:\\\"return\\\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),yt=[new Pe,new Pe,new Pe],ut=new v,ct=new Ke,r=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],mt=0,xt=function(){function t(){e(this,t)}return n(t,null,[{key:\\\"intersectOctree\\\",value:function(e,t,a){var n,i,l,o,s,r,d,y,u,c=ut.min.set(0,0,0),m=ut.max.subVectors(e.max,e.min),x=e.getDimensions(yt[0]),p=yt[1].copy(x).multiplyScalar(.5),v=ct.origin.copy(t.ray.origin),g=ct.direction.copy(t.ray.direction);v.sub(e.getCenter(yt[2])).add(p),mt=0,0>g.x&&(v.x=x.x-v.x,g.x=-g.x,mt|=4),0>g.y&&(v.y=x.y-v.y,g.y=-g.y,mt|=2),0>g.z&&(v.z=x.z-v.z,g.z=-g.z,mt|=1),n=1/g.x,i=1/g.y,l=1/g.z,o=(c.x-v.x)*n,s=(m.x-v.x)*n,r=(c.y-v.y)*i,d=(m.y-v.y)*i,y=(c.z-v.z)*l,u=(m.z-v.z)*l,Te(Te(o,r),y)<Ie(Ie(s,d),u)&&F(e.root,o,r,y,s,d,u,t,a)}}]),t}(),pt=new v,vt=function(){function t(a,n){e(this,t),this.root=void 0!==a&&void 0!==n?new nt(a,n):null}return n(t,[{key:\\\"getCenter\\\",value:function(e){return this.root.getCenter(e)}},{key:\\\"getDimensions\\\",value:function(e){return this.root.getDimensions(e)}},{key:\\\"getDepth\\\",value:function(){return A(this.root)}},{key:\\\"cull\\\",value:function(e){var t=[];return V(this.root,e,t),t}},{key:\\\"findOctantsByLevel\\\",value:function(e){var t=[];return B(this.root,e,0,t),t}},{key:\\\"raycast\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return xt.intersectOctree(this,e,t),t}},{key:\\\"leaves\\\",value:function(e){return new dt(this,e)}},{key:Symbol.iterator,value:function(){return new dt(this)}},{key:\\\"min\\\",get:function(){return this.root.min}},{key:\\\"max\\\",get:function(){return this.root.max}},{key:\\\"children\\\",get:function(){return this.root.children}}]),t}(),gt=new Pe,p=function(t){function a(t,n){var i;return e(this,a),i=k(this,s(a).call(this,t,n)),i.points=null,i.data=null,i}return l(a,t),n(a,[{key:\\\"distanceToSquared\\\",value:function(e){var t=gt.copy(e).clamp(this.min,this.max);return t.sub(e).lengthSquared()}},{key:\\\"distanceToCenterSquared\\\",value:function(e){var t=this.getCenter(gt),a=e.x-t.x,n=e.y-t.x,i=e.z-t.z;return a*a+n*n+i*i}},{key:\\\"contains\\\",value:function(e,t){var a=this.min,n=this.max;return e.x>=a.x-t&&e.y>=a.y-t&&e.z>=a.z-t&&e.x<=n.x+t&&e.y<=n.y+t&&e.z<=n.z+t}},{key:\\\"redistribute\\\",value:function(e){var t,a,n,l,o,s,r,d=this.children,y=this.points,u=this.data;if(null!==d&&null!==y)for(t=0,n=y.length;t<n;++t)for(s=y[t],r=u[t],(a=0,l=d.length);a<l;++a)if(o=d[a],o.contains(s,e)){null===o.points&&(o.points=[],o.data=[]),o.points.push(s),o.data.push(r);break}this.points=null,this.data=null}},{key:\\\"merge\\\",value:function(){var e,t,a,n=this.children;if(null!==n){for(this.points=[],this.data=[],(e=0,t=n.length);e<t;++e)if(a=n[e],null!==a.points){var o,s;(o=this.points).push.apply(o,w(a.points)),(s=this.data).push.apply(s,w(a.data))}this.children=null}}}]),a}(nt),kt=function t(a,n,i){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;e(this,t),this.distance=a,this.distanceToRay=n,this.point=i,this.object=l},ht=function(t){function a(t,n){var i,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:8;return e(this,a),i=k(this,s(a).call(this)),i.root=new p(t,n),i.bias=Te(0,l),i.maxPoints=Te(1,ve(o)),i.maxDepth=Te(0,ve(r)),i.pointCount=0,i}return l(a,t),n(a,[{key:\\\"countPoints\\\",value:function(e){return N(e)}},{key:\\\"put\\\",value:function(e,t){return O(e,t,this,this.root,0)}},{key:\\\"remove\\\",value:function(e){return L(e,this,this.root,null)}},{key:\\\"fetch\\\",value:function(e){return M(e,this,this.root)}},{key:\\\"move\\\",value:function(e,t){return R(e,t,this,this.root,null,0)}},{key:\\\"findNearestPoint\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0,a=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],n=Y(e,t,a,this.root);return null!==n&&(n.point=n.point.clone()),n}},{key:\\\"findPoints\\\",value:function(e,t){var a=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],n=[];return X(e,t,a,this.root,n),n}},{key:\\\"raycast\\\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=z(s(a.prototype),\\\"raycast\\\",this).call(this,e);return 0<n.length&&this.testPoints(n,e,t),t}},{key:\\\"testPoints\\\",value:function(e,t,a){var n,l,o,s,r,d,y,u,c,m,x,p=t.params.Points.threshold;for(r=0,y=e.length;r<y;++r)if(c=e[r],m=c.points,null!==m)for(d=0,u=m.length;d<u;++d)x=m[d],s=t.ray.distanceSqToPoint(x),s<p*p&&(n=t.ray.closestPointToPoint(x,new Pe),l=t.ray.origin.distanceTo(n),l>=t.near&&l<=t.far&&(o=ke(s),a.push(new kt(l,o,n,c.data[d]))))}}]),a}(vt),zt=new v,ft=new Pe,St=new Pe,u=new Pe,wt=function(){function t(){e(this,t)}return n(t,null,[{key:\\\"recycleOctants\\\",value:function(e,t){var a,n,o,s,r=e.min,d=e.getCenter(St),y=e.getDimensions(u).multiplyScalar(.5),c=e.children,m=t.length;for(a=0;8>a;++a)for(o=it[a],zt.min.addVectors(r,ft.fromArray(o).multiply(y)),zt.max.addVectors(d,ft.fromArray(o).multiply(y)),n=0;n<m;++n)if(s=t[n],null!==s&&zt.min.equals(s.min)&&zt.max.equals(s.max)){c[a]=s,t[n]=null;break}}}]),t}(),Tt=new Pe,It=new Pe,Ct=new Pe,Pt=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe;e(this,t),this.a=n,this.b=a,this.index=-1,this.coordinates=new Pe,this.t=0,this.n=new Pe}return n(t,[{key:\\\"approximateZeroCrossing\\\",value:function(e){var t,n,l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,o=Te(1,l-1),s=0,r=1,d=0,y=0;for(Tt.subVectors(this.b,this.a);y<=o&&(d=(s+r)/2,It.addVectors(this.a,Ct.copy(Tt).multiplyScalar(d)),n=e.sample(It),!(we(n)<=1e-4||(r-s)/2<=1e-6));)It.addVectors(this.a,Ct.copy(Tt).multiplyScalar(s)),t=e.sample(It),me(n)===me(t)?s=d:r=d,++y;this.t=d}},{key:\\\"computeZeroCrossingPosition\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return e.subVectors(this.b,this.a).multiplyScalar(this.t).add(this.a)}},{key:\\\"computeSurfaceNormal\\\",value:function(e){var t=this.computeZeroCrossingPosition(Tt),a=1e-3,n=e.sample(It.addVectors(t,Ct.set(a,0,0)))-e.sample(It.subVectors(t,Ct.set(a,0,0))),i=e.sample(It.addVectors(t,Ct.set(0,a,0)))-e.sample(It.subVectors(t,Ct.set(0,a,0))),l=e.sample(It.addVectors(t,Ct.set(0,0,a)))-e.sample(It.subVectors(t,Ct.set(0,0,a)));this.n.set(n,i,l).normalize()}}]),t}(),bt=new Pt,Et=new Pe,Dt=new Pe,Ft=function(){function t(a,n,i){var l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:3;e(this,t),this.edgeData=a,this.cellPosition=n,this.cellSize=i,this.indices=null,this.zeroCrossings=null,this.normals=null,this.axes=null,this.lengths=null,this.result=new tt,this.initialC=l,this.c=l,this.initialD=o,this.d=o,this.i=0,this.l=0,this.reset()}return n(t,[{key:\\\"reset\\\",value:function(){var e,t,n,i,o=this.edgeData,s=[],r=[],y=[],u=[],m=[];for(this.i=0,this.c=0,this.d=0,(t=this.initialC,e=4>>t,n=this.initialD);t<n;++t,e>>=1)i=o.indices[t].length,0<i&&(s.push(o.indices[t]),r.push(o.zeroCrossings[t]),y.push(o.normals[t]),u.push(it[e]),m.push(i),++this.d);return this.l=0<m.length?m[0]:0,this.indices=s,this.zeroCrossings=r,this.normals=y,this.axes=u,this.lengths=m,this.result.reset(),this}},{key:\\\"next\\\",value:function(){var e,t,a,l,o,r,d,u=this.cellSize,s=this.edgeData.resolution,n=s+1,m=n*n,p=this.result,v=this.cellPosition;return this.i===this.l&&(this.l=++this.c<this.d?this.lengths[this.c]:0,this.i=0),this.i<this.l?(r=this.c,d=this.i,e=this.axes[r],t=this.indices[r][d],bt.index=t,a=t%n,l=ce(t%m/n),o=ce(t/m),bt.coordinates.set(a,l,o),Et.set(a*u/s,l*u/s,o*u/s),Dt.set((a+e[0])*u/s,(l+e[1])*u/s,(o+e[2])*u/s),bt.a.addVectors(v,Et),bt.b.addVectors(v,Dt),bt.t=this.zeroCrossings[r][d],bt.n.fromArray(this.normals[r],3*d),p.value=bt,++this.i):(p.value=null,p.done=!0),p}},{key:\\\"return\\\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),qt=function(){function t(a){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:n;e(this,t),this.resolution=a,this.indices=0>=n?null:[new Uint32Array(n),new Uint32Array(i),new Uint32Array(l)],this.zeroCrossings=0>=n?null:[new Float32Array(n),new Float32Array(i),new Float32Array(l)],this.normals=0>=n?null:[new Float32Array(3*n),new Float32Array(3*i),new Float32Array(3*l)]}return n(t,[{key:\\\"serialize\\\",value:function(){return{resolution:this.resolution,edges:this.edges,zeroCrossings:this.zeroCrossings,normals:this.normals}}},{key:\\\"deserialize\\\",value:function(e){var t=this;return null===e?t=null:(this.resolution=e.resolution,this.edges=e.edges,this.zeroCrossings=e.zeroCrossings,this.normals=e.normals),t}},{key:\\\"createTransferList\\\",value:function(){var e,t,a,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],o=[this.edges[0],this.edges[1],this.edges[2],this.zeroCrossings[0],this.zeroCrossings[1],this.zeroCrossings[2],this.normals[0],this.normals[1],this.normals[2]];for(t=0,a=o.length;t<a;++t)e=o[t],null!==e&&n.push(e.buffer);return n}},{key:\\\"edges\\\",value:function(e,t){return new Ft(this,e,t)}},{key:\\\"edgesX\\\",value:function(e,t){return new Ft(this,e,t,0,1)}},{key:\\\"edgesY\\\",value:function(e,t){return new Ft(this,e,t,1,2)}},{key:\\\"edgesZ\\\",value:function(e,t){return new Ft(this,e,t,2,3)}}],[{key:\\\"calculate1DEdgeCount\\\",value:function(e){return ue(e+1,2)*e}}]),t}(),At={AIR:0,SOLID:1},Vt=0,Bt=0,Nt=0,Ot=function(){function t(){var a=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];e(this,t),this.materials=0,this.materialIndices=a?new Uint8Array(Nt):null,this.runLengths=null,this.edgeData=null}return n(t,[{key:\\\"set\\\",value:function(e){return this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,this.edgeData=e.edgeData,this}},{key:\\\"clear\\\",value:function(){return this.materials=0,this.materialIndices=null,this.runLengths=null,this.edgeData=null,this}},{key:\\\"setMaterialIndex\\\",value:function(e,t){this.materialIndices[e]===At.AIR?t!==At.AIR&&++this.materials:t===At.AIR&&--this.materials,this.materialIndices[e]=t}},{key:\\\"compress\\\",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this;return this.compressed?(t.materialIndices=this.materialIndices,t.runLengths=this.runLengths):(e=this.full?new Ce([this.materialIndices.length],[At.SOLID]):Ce.encode(this.materialIndices),t.materialIndices=new Uint8Array(e.data),t.runLengths=new Uint32Array(e.runLengths)),t.materials=this.materials,t}},{key:\\\"decompress\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this;return e.materialIndices=this.compressed?Ce.decode(this.runLengths,this.materialIndices,new Uint8Array(Nt)):this.materialIndices,e.runLengths=null,e.materials=this.materials,e}},{key:\\\"serialize\\\",value:function(){return{materials:this.materials,materialIndices:this.materialIndices,runLengths:this.runLengths,edgeData:null===this.edgeData?null:this.edgeData.serialize()}}},{key:\\\"deserialize\\\",value:function(e){var t=this;return null===e?t=null:(this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,null===e.edgeData?this.edgeData=null:(null===this.edgeData&&(this.edgeData=new qt(Bt)),this.edgeData.deserialize(e.edgeData))),t}},{key:\\\"createTransferList\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.edgeData&&this.edgeData.createTransferList(e),null!==this.materialIndices&&e.push(this.materialIndices.buffer),null!==this.runLengths&&e.push(this.runLengths.buffer),e}},{key:\\\"empty\\\",get:function(){return 0===this.materials}},{key:\\\"full\\\",get:function(){return this.materials===Nt}},{key:\\\"compressed\\\",get:function(){return null!==this.runLengths}},{key:\\\"neutered\\\",get:function(){return!this.empty&&null===this.materialIndices}}],[{key:\\\"isovalue\\\",get:function(){return Vt},set:function(e){Vt=e}},{key:\\\"resolution\\\",get:function(){return Bt},set:function(e){var t=Math.log2;e=ue(2,Te(0,Se(t(e)))),Bt=Te(1,Ie(256,e)),Nt=ue(Bt+1,3)}}]),t}(),Lt=function(){function t(){e(this,t),this.ata=new $e,this.ata.set(0,0,0,0,0,0),this.atb=new Pe,this.massPointSum=new Pe,this.numPoints=0}return n(t,[{key:\\\"set\\\",value:function(e,t,a,n){return this.ata.copy(e),this.atb.copy(t),this.massPointSum.copy(a),this.numPoints=n,this}},{key:\\\"copy\\\",value:function(e){return this.set(e.ata,e.atb,e.massPointSum,e.numPoints)}},{key:\\\"add\\\",value:function(e,t){var a=t.x,n=t.y,i=t.z,l=e.dot(t),o=this.ata.elements,s=this.atb;o[0]+=a*a,o[1]+=a*n,o[3]+=n*n,o[2]+=a*i,o[4]+=n*i,o[5]+=i*i,s.x+=l*a,s.y+=l*n,s.z+=l*i,this.massPointSum.add(e),++this.numPoints}},{key:\\\"addData\\\",value:function(e){this.ata.add(e.ata),this.atb.add(e.atb),this.massPointSum.add(e.massPointSum),this.numPoints+=e.numPoints}},{key:\\\"clear\\\",value:function(){this.ata.set(0,0,0,0,0,0),this.atb.set(0,0,0),this.massPointSum.set(0,0,0),this.numPoints=0}},{key:\\\"clone\\\",value:function(){return new this.constructor().copy(this)}}]),t}(),Mt=new qe,Rt=function(){function t(){e(this,t)}return n(t,null,[{key:\\\"calculateCoefficients\\\",value:function(e,t,a){var n,i,l;return 0===t?(Mt.x=1,Mt.y=0):(n=(a-e)/(2*t),i=ke(1+n*n),l=1/(0<=n?n+i:n-i),Mt.x=1/ke(1+l*l),Mt.y=l*Mt.x),Mt}}]),t}(),Yt=function(){function t(){e(this,t)}return n(t,null,[{key:\\\"rotateXY\\\",value:function(e,t){var a=t.x,n=t.y,i=e.x,l=e.y;e.set(a*i-n*l,n*i+a*l)}},{key:\\\"rotateQXY\\\",value:function(e,t,a){var n=a.x,i=a.y,l=n*n,o=i*i,s=2*n*i*t,r=e.x,d=e.y;e.set(l*r-s+o*d,o*r+s+l*d)}}]),t}(),Xt=.1,Zt=new $e,_t=new Ne,jt=new qe,Ut=new Pe,Qt=function(){function t(){e(this,t)}return n(t,null,[{key:\\\"solve\\\",value:function(e,t,a){var n=U(Zt.copy(e),_t.identity()),i=G(_t,n);a.copy(t).applyMatrix3(i)}}]),t}(),Gt=new Pe,Ht=function(){function t(){e(this,t),this.data=null,this.ata=new $e,this.atb=new Pe,this.massPoint=new Pe,this.hasSolution=!1}return n(t,[{key:\\\"setData\\\",value:function(e){return this.data=e,this.hasSolution=!1,this}},{key:\\\"solve\\\",value:function(e){var t=this.data,a=this.massPoint,n=this.ata.copy(t.ata),i=this.atb.copy(t.atb),l=1/0;return!this.hasSolution&&null!==t&&0<t.numPoints&&(Gt.copy(t.massPointSum).divideScalar(t.numPoints),a.copy(Gt),n.applyToVector3(Gt),i.sub(Gt),Qt.solve(n,i,e),l=H(n,i,e),e.add(a),this.hasSolution=!0),l}}]),t}(),Jt=function t(){e(this,t),this.materials=0,this.edgeCount=0,this.index=-1,this.position=new Pe,this.normal=new Pe,this.qefData=null},Kt=new Ht,Wt=.1,$t=-1,ea=function(t){function a(t,n){var i;return e(this,a),i=k(this,s(a).call(this,t,n)),i.voxel=null,i}return l(a,t),n(a,[{key:\\\"contains\\\",value:function(e){var t=this.min,a=this.size;return e.x>=t.x-Wt&&e.y>=t.y-Wt&&e.z>=t.z-Wt&&e.x<=t.x+a+Wt&&e.y<=t.y+a+Wt&&e.z<=t.z+a+Wt}},{key:\\\"collapse\\\",value:function(){var e,t,a,n,l,o,s,r=this.children,d=[-1,-1,-1,-1,-1,-1,-1,-1],y=new Pe,u=-1,c=null!==r,m=0;if(c){for(n=new Lt,o=0,s=0;8>s;++s)e=r[s],m+=e.collapse(),a=e.voxel,null===e.children?null!==a&&(n.addData(a.qefData),u=1&a.materials>>7-s,d[s]=1&a.materials>>s,++o):c=!1;if(c&&(l=Kt.setData(n).solve(y),l<=$t)){for(a=new Jt,a.position.copy(this.contains(y)?y:Kt.massPoint),s=0;8>s;++s)t=d[s],e=r[s],-1===t?a.materials|=u<<s:(a.materials|=t<<s,a.normal.add(e.voxel.normal));a.normal.normalize(),a.qefData=n,this.voxel=a,this.children=null,m+=o-1}}return m}}],[{key:\\\"errorThreshold\\\",get:function(){return $t},set:function(e){$t=e}}]),a}(st),ta=function t(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null;e(this,t),this.action=a,this.error=null},aa=function(){function t(a,n,i,l,o){e(this,t),this.indices=a,this.positions=n,this.normals=i,this.uvs=l,this.materials=o}return n(t,[{key:\\\"serialize\\\",value:function(){return{indices:this.indices,positions:this.positions,normals:this.normals,uvs:this.uvs,materials:this.materials}}},{key:\\\"deserialize\\\",value:function(e){var t=this;return null===e?t=null:(this.indices=e.indices,this.positions=e.positions,this.normals=e.normals,this.uvs=e.uvs,this.materials=e.materials),t}},{key:\\\"createTransferList\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.indices.buffer),e.push(this.positions.buffer),e.push(this.normals.buffer),e.push(this.uvs.buffer),e.push(this.materials.buffer),e}}]),t}(),na=[new Uint8Array([0,4,0]),new Uint8Array([1,5,0]),new Uint8Array([2,6,0]),new Uint8Array([3,7,0]),new Uint8Array([0,2,1]),new Uint8Array([4,6,1]),new Uint8Array([1,3,1]),new Uint8Array([5,7,1]),new Uint8Array([0,1,2]),new Uint8Array([2,3,2]),new Uint8Array([4,5,2]),new Uint8Array([6,7,2])],ia=[new Uint8Array([0,1,2,3,0]),new Uint8Array([4,5,6,7,0]),new Uint8Array([0,4,1,5,1]),new Uint8Array([2,6,3,7,1]),new Uint8Array([0,2,4,6,2]),new Uint8Array([1,3,5,7,2])],la=[[new Uint8Array([4,0,0]),new Uint8Array([5,1,0]),new Uint8Array([6,2,0]),new Uint8Array([7,3,0])],[new Uint8Array([2,0,1]),new Uint8Array([6,4,1]),new Uint8Array([3,1,1]),new Uint8Array([7,5,1])],[new Uint8Array([1,0,2]),new Uint8Array([3,2,2]),new Uint8Array([5,4,2]),new Uint8Array([7,6,2])]],oa=[[new Uint8Array([1,4,0,5,1,1]),new Uint8Array([1,6,2,7,3,1]),new Uint8Array([0,4,6,0,2,2]),new Uint8Array([0,5,7,1,3,2])],[new Uint8Array([0,2,3,0,1,0]),new Uint8Array([0,6,7,4,5,0]),new Uint8Array([1,2,0,6,4,2]),new Uint8Array([1,3,1,7,5,2])],[new Uint8Array([1,1,0,3,2,0]),new Uint8Array([1,5,4,7,6,0]),new Uint8Array([0,1,5,0,4,1]),new Uint8Array([0,3,7,2,6,1])]],sa=[[new Uint8Array([3,2,1,0,0]),new Uint8Array([7,6,5,4,0])],[new Uint8Array([5,1,4,0,1]),new Uint8Array([7,3,6,2,1])],[new Uint8Array([6,4,2,0,2]),new Uint8Array([7,5,3,1,2])]],ra=[new Uint8Array([3,2,1,0]),new Uint8Array([7,5,6,4]),new Uint8Array([11,10,9,8])],da=ue(2,16)-1,ya=function(){function t(){e(this,t)}return n(t,null,[{key:\\\"run\\\",value:function(e){var t=[],a=e.voxelCount,n=null,i=null,l=null,o=null,s=null;return a>da?console.warn(\\\"Could not create geometry for cell at position\\\",e.min,\\\"(vertex count of\\\",a,\\\"exceeds limit of \\\",da,\\\")\\\"):0<a&&(i=new Float32Array(3*a),l=new Float32Array(3*a),o=new Float32Array(2*a),s=new Uint8Array(a),ee(e.root,i,l,0),$(e.root,t),n=new aa(new Uint16Array(t),i,l,o,s)),n}}]),t}(),ua=function(t){function a(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return e(this,a),n=k(this,s(a).call(this)),n.root=new ea(i,l),n.voxelCount=0,null!==t&&null!==t.edgeData&&n.construct(t),0<=ea.errorThreshold&&n.simplify(),n}return l(a,t),n(a,[{key:\\\"simplify\\\",value:function(){this.voxelCount-=this.root.collapse()}},{key:\\\"construct\\\",value:function(e){var t,a,l,o,s,r,u,c,m,p,v,g=Ot.resolution,n=e.edgeData,k=e.materialIndices,h=new Ht,f=new Pe,S=[n.edgesX(this.min,this.root.size),n.edgesY(this.min,this.root.size),n.edgesZ(this.min,this.root.size)],w=[new Uint8Array([0,1,2,3]),new Uint8Array([0,1,4,5]),new Uint8Array([0,2,4,6])],T=0;for(p=0;3>p;++p){l=w[p],t=S[p];var I=!0,C=!1,P=void 0;try{for(var b,E=t[Symbol.iterator]();!(I=(b=E.next()).done);I=!0)for(a=b.value,a.computeZeroCrossingPosition(f),v=0;4>v;++v)o=it[l[v]],u=a.coordinates.x-o[0],c=a.coordinates.y-o[1],m=a.coordinates.z-o[2],0<=u&&0<=c&&0<=m&&u<g&&c<g&&m<g&&(s=te(this.root,g,u,c,m),null===s.voxel&&(s.voxel=ae(g,u,c,m,k),++T),r=s.voxel,r.normal.add(a.n),r.qefData.add(f,a.n),r.qefData.numPoints===r.edgeCount&&(h.setData(r.qefData).solve(r.position),!s.contains(r.position)&&r.position.copy(h.massPoint),r.normal.normalize()))}catch(e){C=!0,P=e}finally{try{I||null==E[\\\"return\\\"]||E[\\\"return\\\"]()}finally{if(C)throw P}}}this.voxelCount=T}}]),a}(vt),ca={EXTRACT:\\\"worker.extract\\\",MODIFY:\\\"worker.modify\\\",CONFIGURE:\\\"worker.config\\\",CLOSE:\\\"worker.close\\\"},ma=function(t){function a(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return e(this,a),t=k(this,s(a).call(this,n)),t.data=null,t}return l(a,t),a}(ta),xa=function(t){function a(){var t;return e(this,a),t=k(this,s(a).call(this,ca.EXTRACT)),t.isosurface=null,t}return l(a,t),a}(ma),pa=new Ot(!1),va=function(){function t(){e(this,t),this.data=null,this.response=null}return n(t,[{key:\\\"getData\\\",value:function(){return this.data}},{key:\\\"respond\\\",value:function(){return this.response.data=this.data.serialize(),this.response}},{key:\\\"createTransferList\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.data&&this.data.createTransferList(e),e}},{key:\\\"process\\\",value:function(e){return this.data=pa.deserialize(e.data),this}}]),t}(),ga=function(t){function a(){var t;return e(this,a),t=k(this,s(a).call(this)),t.response=new xa,t.decompressionTarget=new Ot(!1),t.isosurface=null,t}return l(a,t),n(a,[{key:\\\"respond\\\",value:function(){var e=z(s(a.prototype),\\\"respond\\\",this).call(this);return e.isosurface=null===this.isosurface?null:this.isosurface.serialise(),e}},{key:\\\"createTransferList\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return z(s(a.prototype),\\\"createTransferList\\\",this).call(this,e),null===this.isosurface?e:this.isosurface.createTransferList(e)}},{key:\\\"process\\\",value:function(e){var t=z(s(a.prototype),\\\"process\\\",this).call(this,e).getData(),n=new ua(t.decompress(this.decompressionTarget));return this.isosurface=ya.run(n),this.decompressionTarget.clear(),this}}]),a}(va),ka={UNION:\\\"csg.union\\\",DIFFERENCE:\\\"csg.difference\\\",INTERSECTION:\\\"csg.intersection\\\",DENSITY_FUNCTION:\\\"csg.densityfunction\\\"},ha=function(){function t(a){e(this,t),this.type=a;for(var n=arguments.length,i=Array(1<n?n-1:0),l=1;l<n;l++)i[l-1]=arguments[l];this.children=i,this.boundingBox=null}return n(t,[{key:\\\"getBoundingBox\\\",value:function(){return null===this.boundingBox&&(this.boundingBox=this.computeBoundingBox()),this.boundingBox}},{key:\\\"computeBoundingBox\\\",value:function(){var e,t,a=this.children,n=new v;for(e=0,t=a.length;e<t;++e)n.union(a[e].getBoundingBox());return n}}]),t}(),za=function(t){function a(){var t;e(this,a);for(var n=arguments.length,i=Array(n),l=0;l<n;l++)i[l]=arguments[l];return k(this,(t=s(a)).call.apply(t,[this,ka.UNION].concat(i)))}return l(a,t),n(a,[{key:\\\"updateMaterialIndex\\\",value:function(e,t,a){var n=a.materialIndices[e];n!==At.AIR&&t.setMaterialIndex(e,n)}},{key:\\\"selectEdge\\\",value:function(e,t,a){return a?e.t>t.t?e:t:e.t<t.t?e:t}}]),a}(ha),fa=function(t){function a(){var t;e(this,a);for(var n=arguments.length,i=Array(n),l=0;l<n;l++)i[l]=arguments[l];return k(this,(t=s(a)).call.apply(t,[this,ka.DIFFERENCE].concat(i)))}return l(a,t),n(a,[{key:\\\"updateMaterialIndex\\\",value:function(e,t,a){a.materialIndices[e]!==At.AIR&&t.setMaterialIndex(e,At.AIR)}},{key:\\\"selectEdge\\\",value:function(e,t,a){return a?e.t<t.t?e:t:e.t>t.t?e:t}}]),a}(ha),Sa=function(t){function a(){var t;e(this,a);for(var n=arguments.length,i=Array(n),l=0;l<n;l++)i[l]=arguments[l];return k(this,(t=s(a)).call.apply(t,[this,ka.INTERSECTION].concat(i)))}return l(a,t),n(a,[{key:\\\"updateMaterialIndex\\\",value:function(e,t,a){var n=a.materialIndices[e];t.setMaterialIndex(e,t.materialIndices[e]!==At.AIR&&n!==At.AIR?n:At.AIR)}},{key:\\\"selectEdge\\\",value:function(e,t,a){return a?e.t<t.t?e:t:e.t>t.t?e:t}}]),a}(ha),wa=0,Ta=new Pe,Ia=function(){function t(){e(this,t)}return n(t,null,[{key:\\\"run\\\",value:function(e,t,a,n){Ta.fromArray(e),wa=t,null===a?n.operation===ka.UNION&&(a=new Ot(!1)):a.decompress();var i=n.toCSG(),l=null===a?null:de(i);if(null!==l){switch(n.operation){case ka.UNION:i=new za(i);break;case ka.DIFFERENCE:i=new fa(i);break;case ka.INTERSECTION:i=new Sa(i);}re(i,a,l),a.contoured=!1}return null!==a&&a.empty?null:a}}]),t}(),Ca=function(t){function a(t){var n;return e(this,a),n=k(this,s(a).call(this,ka.DENSITY_FUNCTION)),n.sdf=t,n}return l(a,t),n(a,[{key:\\\"computeBoundingBox\\\",value:function(){return this.sdf.getBoundingBox(!0)}},{key:\\\"generateMaterialIndex\\\",value:function(e){return this.sdf.sample(e)<=Ot.isovalue?this.sdf.material:At.AIR}},{key:\\\"generateEdge\\\",value:function(e){e.approximateZeroCrossing(this.sdf),e.computeSurfaceNormal(this.sdf)}}]),a}(ha),Pa=new c,ba=function(){function t(a){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:At.SOLID;e(this,t),this.type=a,this.operation=null,this.material=Ie(255,Te(At.SOLID,ce(n))),this.boundingBox=null,this.position=new Pe,this.quaternion=new Me,this.scale=new Pe(1,1,1),this.inverseTransformation=new c,this.updateInverseTransformation(),this.children=[]}return n(t,[{key:\\\"getTransformation\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new c;return e.compose(this.position,this.quaternion,this.scale)}},{key:\\\"getBoundingBox\\\",value:function(){var e,t,a=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],n=this.children,o=this.boundingBox;if(null===o&&(o=this.computeBoundingBox(),this.boundingBox=o),a)for(o=o.clone(),e=0,t=n.length;e<t;++e)o.union(n[e].getBoundingBox(a));return o}},{key:\\\"setMaterial\\\",value:function(e){return this.material=Ie(255,Te(At.SOLID,ce(e))),this}},{key:\\\"setOperationType\\\",value:function(e){return this.operation=e,this}},{key:\\\"updateInverseTransformation\\\",value:function(){return this.inverseTransformation.getInverse(this.getTransformation(Pa)),this.boundingBox=null,this}},{key:\\\"union\\\",value:function(e){return this.children.push(e.setOperationType(ka.UNION)),this}},{key:\\\"subtract\\\",value:function(e){return this.children.push(e.setOperationType(ka.DIFFERENCE)),this}},{key:\\\"intersect\\\",value:function(e){return this.children.push(e.setOperationType(ka.INTERSECTION)),this}},{key:\\\"toCSG\\\",value:function(){var e,t,a,n,o=this.children,s=new Ca(this);for(a=0,n=o.length;a<n;++a)t=o[a],e!==t.operation&&(e=t.operation,e===ka.UNION?s=new za(s):e===ka.DIFFERENCE?s=new fa(s):e===ka.INTERSECTION?s=new Sa(s):void 0),s.children.push(t.toCSG());return s}},{key:\\\"serialize\\\",value:function(){var e,t,a=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],n={type:this.type,operation:this.operation,material:this.material,position:this.position.toArray(),quaternion:this.quaternion.toArray(),scale:this.scale.toArray(),parameters:null,children:[]};for(e=0,t=this.children.length;e<t;++e)n.children.push(this.children[e].serialize(a));return n}},{key:\\\"createTransferList\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e}},{key:\\\"toJSON\\\",value:function(){return this.serialize(!0)}},{key:\\\"computeBoundingBox\\\",value:function(){throw new Error(\\\"SignedDistanceFunction#computeBoundingBox method not implemented!\\\")}},{key:\\\"sample\\\",value:function(){throw new Error(\\\"SignedDistanceFunction#sample method not implemented!\\\")}}]),t}(),Ea={HEIGHTFIELD:\\\"sdf.heightfield\\\",FRACTAL_NOISE:\\\"sdf.fractalnoise\\\",SUPER_PRIMITIVE:\\\"sdf.superprimitive\\\"},Da=function(t){function a(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=1<arguments.length?arguments[1]:void 0;return e(this,a),t=k(this,s(a).call(this,Ea.PERLIN_NOISE,i)),t.min=x(Pe,w(n.min)),t.max=x(Pe,w(n.max)),t}return l(a,t),n(a,[{key:\\\"computeBoundingBox\\\",value:function(){return this.bbox=new v(this.min,this.max),this.bbox}},{key:\\\"sample\\\",value:function(){}},{key:\\\"serialize\\\",value:function(){var e=z(s(a.prototype),\\\"serialize\\\",this).call(this);return e.parameters={min:this.min.toArray(),max:this.max.toArray()},e}}]),a}(ba),Fa=function(t){function a(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=1<arguments.length?arguments[1]:void 0;return e(this,a),t=k(this,s(a).call(this,Ea.HEIGHTFIELD,i)),t.width=void 0===n.width?1:n.width,t.height=void 0===n.height?1:n.height,t.smooth=void 0===n.smooth||n.smooth,t.data=void 0===n.data?null:n.data,t.heightmap=null,void 0!==n.image&&t.fromImage(n.image),t}return l(a,t),n(a,[{key:\\\"fromImage\\\",value:function(e){var t,a,n,o,s=\\\"undefined\\\"==typeof document?null:ye(e),r=null;if(null!==s){for(t=s.data,r=new Uint8ClampedArray(t.length/4),(a=0,n=0,o=r.length);a<o;++a,n+=4)r[a]=t[n];this.heightmap=e,this.width=s.width,this.height=s.height,this.data=r}return this}},{key:\\\"getHeight\\\",value:function(e,t){var n,i=this.width,l=this.height,o=this.data;if(e=ve(e*i),t=ve(t*l),this.smooth){e=Te(Ie(e,i-1),1),t=Te(Ie(t,l-1),1);var s=e+1,r=e-1,d=t*i,a=d+i,y=d-i;n=(o[y+r]+o[y+e]+o[y+s]+o[d+r]+o[d+e]+o[d+s]+o[a+r]+o[a+e]+o[a+s])/9}else n=o[t*i+e];return n}},{key:\\\"computeBoundingBox\\\",value:function(){var e=new v,t=Ie(this.width/this.height,1),a=Ie(this.height/this.width,1);return e.min.set(0,0,0),e.max.set(t,1,a),e.applyMatrix4(this.getTransformation()),e}},{key:\\\"sample\\\",value:function(e){var t,a=this.boundingBox;return a.containsPoint(e)?(e.applyMatrix4(this.inverseTransformation),t=e.y-this.getHeight(e.x,e.z)/255):t=a.distanceToPoint(e),t}},{key:\\\"serialize\\\",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t=z(s(a.prototype),\\\"serialize\\\",this).call(this);return t.parameters={width:this.width,height:this.height,smooth:this.smooth,data:e?null:this.data,dataURL:e&&null!==this.heightmap?this.heightmap.toDataURL():null,image:null},t}},{key:\\\"createTransferList\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.data.buffer),e}}]),a}(ba),qa=function(t){function a(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=1<arguments.length?arguments[1]:void 0;return e(this,a),t=k(this,s(a).call(this,Ea.SUPER_PRIMITIVE,i)),t.s0=x(et,w(n.s)),t.r0=x(Pe,w(n.r)),t.s=new et,t.r=new Pe,t.ba=new qe,t.offset=0,t.precompute(),t}return l(a,t),n(a,[{key:\\\"setSize\\\",value:function(e,t,a,n){return this.s0.set(e,t,a,n),this.precompute()}},{key:\\\"setRadii\\\",value:function(e,t,a){return this.r0.set(e,t,a),this.precompute()}},{key:\\\"precompute\\\",value:function(){var e=this.s.copy(this.s0),t=this.r.copy(this.r0),a=this.ba;e.x-=t.x,e.y-=t.x,t.x-=e.w,e.w-=t.y,e.z-=t.y,this.offset=-2*e.z,a.set(t.z,this.offset);var n=a.dot(a);return 0===n?a.set(0,-1):a.divideScalar(n),this}},{key:\\\"computeBoundingBox\\\",value:function(){var e=this.s0,t=new v;return t.min.x=Ie(-e.x,-1),t.min.y=Ie(-e.y,-1),t.min.z=Ie(-e.z,-1),t.max.x=Te(e.x,1),t.max.y=Te(e.y,1),t.max.z=Te(e.z,1),t.applyMatrix4(this.getTransformation()),t}},{key:\\\"sample\\\",value:function(e){e.applyMatrix4(this.inverseTransformation);var t=this.s,a=this.r,n=this.ba,i=we(e.x)-t.x,l=we(e.y)-t.y,o=we(e.z)-t.z,s=Te(i,0),r=Te(l,0),d=ke(s*s+r*r),y=e.z-t.z,u=we(d+Ie(0,Te(i,l))-a.x)-t.w,m=Ie(Te(u*n.x+y*n.y,0),1),c=u-a.z*m,x=y-this.offset*m,p=Te(u-a.z,0),v=e.z+t.z,g=Te(u,0),k=u*-n.y+y*n.x,h=ke(Ie(c*c+x*x,Ie(p*p+v*v,g*g+y*y)));return h*me(Te(k,o))-a.y}},{key:\\\"serialize\\\",value:function(){var e=z(s(a.prototype),\\\"serialize\\\",this).call(this);return e.parameters={s:this.s0.toArray(),r:this.r0.toArray()},e}}],[{key:\\\"create\\\",value:function(e){var t=Aa[e];return new a({s:t[0],r:t[1]})}}]),a}(ba),Aa=[[new Float32Array([1,1,1,1]),new Float32Array([0,0,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,0,0])],[new Float32Array([0,0,1,1]),new Float32Array([0,0,1])],[new Float32Array([1,1,2,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,.25,1]),new Float32Array([1,.25,0])],[new Float32Array([1,1,.25,.25]),new Float32Array([1,.25,0])],[new Float32Array([1,1,1,.25]),new Float32Array([1,.1,0])],[new Float32Array([1,1,1,.25]),new Float32Array([.1,.1,0])]],Va=function(){function t(){e(this,t)}return n(t,[{key:\\\"revive\\\",value:function(e){var t,a,n;switch(e.type){case Ea.FRACTAL_NOISE:t=new Da(e.parameters,e.material);break;case Ea.HEIGHTFIELD:t=new Fa(e.parameters,e.material);break;case Ea.SUPER_PRIMITIVE:t=new qa(e.parameters,e.material);}for(t.operation=e.operation,t.position.fromArray(e.position),t.quaternion.fromArray(e.quaternion),t.scale.fromArray(e.scale),t.updateInverseTransformation(),(a=0,n=e.children.length);a<n;++a)t.children.push(this.revive(e.children[a]));return t}}]),t}(),Ba=function(t){function a(){var t;return e(this,a),t=k(this,s(a).call(this,ca.MODIFY)),t.sdf=null,t}return l(a,t),a}(ma),Na=function(t){function a(){var t;return e(this,a),t=k(this,s(a).call(this)),t.response=new Ba,t.sdf=null,t}return l(a,t),n(a,[{key:\\\"respond\\\",value:function(){var e=z(s(a.prototype),\\\"respond\\\",this).call(this);return e.sdf=null===this.sdf?null:this.sdf.serialize(),e}},{key:\\\"createTransferList\\\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return z(s(a.prototype),\\\"createTransferList\\\",this).call(this,e),null===this.sdf?e:this.sdf.createTransferList(e)}},{key:\\\"process\\\",value:function(e){var t=z(s(a.prototype),\\\"process\\\",this).call(this,e).getData(),n=this.sdf=Va.revive(e.sdf),i=Ia.run(e.cellPosition,e.cellSize,t,n);return S(s(a.prototype),\\\"data\\\",null===i?null:i.compress(),this,!0),this}}]),a}(va),Oa=new Na,La=new ga,Ma=null;self.addEventListener(\\\"message\\\",function(e){var t=e.data;switch(Ma=t.action,Ma){case ca.MODIFY:postMessage(Oa.process(t).respond(),Oa.createTransferList());break;case ca.EXTRACT:postMessage(La.process(t).respond(),La.createTransferList());break;case ca.CONFIGURE:Ot.resolution=t.resolution,ea.errorThreshold=t.errorThreshold;break;case ca.CLOSE:default:close();}}),self.addEventListener(\\\"error\\\",function(e){var t,a=Ma===ca.MODIFY?Oa:Ma===ca.EXTRACT?La:null;null===a?(t=new ta(ca.CLOSE),t.error=e,postMessage(t)):(t=a.respond(),t.action=ca.CLOSE,t.error=e,postMessage(t,a.createTransferList())),close()})})();\\n\"],{type:\"text/javascript\"})),n.maxWorkers=Me(navigator.hardwareConcurrency,Le(t,1)),n.workers=[],n.busyWorkers=new WeakSet,n.configurationMessage=new sa,n}return s(a,t),n(a,[{key:\"handleEvent\",value:function(e){switch(e.type){case\"message\":{this.busyWorkers[\"delete\"](e.target),ua.worker=e.target,ua.response=e.data,this.dispatchEvent(ua),this.workers.length>this.maxWorkers&&this.closeWorker(e.target);break}case\"error\":{console.error(\"Encountered an unexpected error\",e);break}}}},{key:\"closeWorker\",value:function(e){var t=this.workers.indexOf(e);this.busyWorkers.has(e)?(this.busyWorkers[\"delete\"](e),e.terminate()):e.postMessage(new ta(ea.CLOSE)),e.removeEventListener(\"message\",this),e.removeEventListener(\"error\",this),0<=t&&this.workers.splice(t,1)}},{key:\"createWorker\",value:function(){var e=new Worker(this.workerURL);return this.workers.push(e),e.addEventListener(\"message\",this),e.addEventListener(\"error\",this),e.postMessage(this.configurationMessage),e}},{key:\"getWorker\",value:function(){var e=null,t,n;for(t=0,n=this.workers.length;t<n;++t)if(!this.busyWorkers.has(this.workers[t])){e=this.workers[t],this.busyWorkers.add(e);break}return null===e&&this.workers.length<this.maxWorkers&&null!==this.workerURL&&(e=this.createWorker(),this.busyWorkers.add(e)),e}},{key:\"clear\",value:function(){for(;0<this.workers.length;)this.closeWorker(this.workers.pop())}},{key:\"dispose\",value:function(){this.clear(),URL.revokeObjectURL(this.workerURL),this.workerURL=null}}]),a}(Ye),ha=function(t){function n(t){var a;return e(this,n),a=z(this,y(n).call(this,t)),a.octant=null,a.octantId=null,a.error=null,a}return s(n,t),n}(Ue),ca=new ha(\"modificationstart\"),da=new ha(\"modificationend\"),ma=new ha(\"extractionstart\"),va=new ha(\"extractionend\"),ga=new ha(\"load\"),xa=new ha(\"error\"),pa=function(t){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n;e(this,a);var i=void 0===t.world?{}:t.world;return rn.resolution=void 0===t.resolution?32:t.resolution,n=z(this,y(a).call(this)),n.object=null,n.world=new Gn(i.cellSize,i.levels,i.keyDesign),n.clipmap=new $n(n.world),n.clipmap.addEventListener(\"shellupdate\",k(n)),n.threadPool=new ya(t.workers),n.threadPool.addEventListener(\"message\",k(n)),n.tasks=new WeakMap,n.sdfLoader=new fn,n.sdfLoader.addEventListener(\"load\",k(n)),n.history=[],n.dtSq=n.world.getCellSize(),n}return s(a,t),n(a,[{key:\"handleEvent\",value:function(e){switch(e.type){case\"shellupdate\":break;case\"message\":break;case\"load\":this.revive(e.descriptions),this.dispatchEvent(ga);}}},{key:\"applyCSG\",value:function(e){this.world.applyCSG(e),this.history.push(e)}},{key:\"union\",value:function(e){this.applyCSG(e.setOperationType(Xe.UNION))}},{key:\"subtract\",value:function(e){this.applyCSG(e.setOperationType(Xe.DIFFERENCE))}},{key:\"intersect\",value:function(e){this.applyCSG(e.setOperationType(Xe.INTERSECTION))}},{key:\"update\",value:function(e){this.clipmap.position.distanceToSquared(e)>=this.dtSq&&this.clipmap.update(e)}},{key:\"raycast\",value:function(e){return this.world.raycast(e)}},{key:\"clear\",value:function(){this.world.clear(),this.clipmap.clear(),this.threadPool.clear(),this.sdfLoader.clear(),this.tasks=new WeakMap,this.history=[]}},{key:\"dispose\",value:function(){this.threadPool.dispose()}},{key:\"revive\",value:function(e){var t,n;for(t=0,n=e.length;t<n;++t)this.applyCSG(gn.revive(e[t]))}},{key:\"save\",value:function(){return 0===this.history.length?null:URL.createObjectURL(new Blob([JSON.stringify(this.history)],{type:\"text/json\"}))}},{key:\"load\",value:function(e){var t=JSON.parse(e);this.clear(),this.sdfLoader.load(t)}}]),a}(Ye),fa=function(){function t(n,a,i,s,r){e(this,t),this.indices=n,this.positions=a,this.normals=i,this.uvs=s,this.materials=r}return n(t,[{key:\"serialize\",value:function(){return{indices:this.indices,positions:this.positions,normals:this.normals,uvs:this.uvs,materials:this.materials}}},{key:\"deserialize\",value:function(e){var t=this;return null===e?t=null:(this.indices=e.indices,this.positions=e.positions,this.normals=e.normals,this.uvs=e.uvs,this.materials=e.materials),t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.indices.buffer),e.push(this.positions.buffer),e.push(this.normals.buffer),e.push(this.uvs.buffer),e.push(this.materials.buffer),e}}]),t}(),ka=[new Uint8Array([0,4,0]),new Uint8Array([1,5,0]),new Uint8Array([2,6,0]),new Uint8Array([3,7,0]),new Uint8Array([0,2,1]),new Uint8Array([4,6,1]),new Uint8Array([1,3,1]),new Uint8Array([5,7,1]),new Uint8Array([0,1,2]),new Uint8Array([2,3,2]),new Uint8Array([4,5,2]),new Uint8Array([6,7,2])],za=[new Uint8Array([0,1,2,3,0]),new Uint8Array([4,5,6,7,0]),new Uint8Array([0,4,1,5,1]),new Uint8Array([2,6,3,7,1]),new Uint8Array([0,2,4,6,2]),new Uint8Array([1,3,5,7,2])],wa=[[new Uint8Array([4,0,0]),new Uint8Array([5,1,0]),new Uint8Array([6,2,0]),new Uint8Array([7,3,0])],[new Uint8Array([2,0,1]),new Uint8Array([6,4,1]),new Uint8Array([3,1,1]),new Uint8Array([7,5,1])],[new Uint8Array([1,0,2]),new Uint8Array([3,2,2]),new Uint8Array([5,4,2]),new Uint8Array([7,6,2])]],Sa=[[new Uint8Array([1,4,0,5,1,1]),new Uint8Array([1,6,2,7,3,1]),new Uint8Array([0,4,6,0,2,2]),new Uint8Array([0,5,7,1,3,2])],[new Uint8Array([0,2,3,0,1,0]),new Uint8Array([0,6,7,4,5,0]),new Uint8Array([1,2,0,6,4,2]),new Uint8Array([1,3,1,7,5,2])],[new Uint8Array([1,1,0,3,2,0]),new Uint8Array([1,5,4,7,6,0]),new Uint8Array([0,1,5,0,4,1]),new Uint8Array([0,3,7,2,6,1])]],Ia=[[new Uint8Array([3,2,1,0,0]),new Uint8Array([7,6,5,4,0])],[new Uint8Array([5,1,4,0,1]),new Uint8Array([7,3,6,2,1])],[new Uint8Array([6,4,2,0,2]),new Uint8Array([7,5,3,1,2])]],Ta=[new Uint8Array([3,2,1,0]),new Uint8Array([7,5,6,4]),new Uint8Array([11,10,9,8])],Pa=ze(2,16)-1,Ca=function(){function t(){e(this,t)}return n(t,null,[{key:\"run\",value:function(e){var t=[],n=e.voxelCount,a=null,i=null,s=null,r=null,o=null;return n>Pa?console.warn(\"Could not create geometry for cell at position\",e.min,\"(vertex count of\",n,\"exceeds limit of \",Pa,\")\"):0<n&&(i=new Float32Array(3*n),s=new Float32Array(3*n),r=new Float32Array(2*n),o=new Uint8Array(n),ie(e.root,i,s,0),ae(e.root,t),a=new fa(new Uint16Array(t),i,s,r,o)),a}}]),t}(),ba=new Qe,Aa=function(){function t(){e(this,t)}return n(t,null,[{key:\"calculateCoefficients\",value:function(e,t,n){var a,i,s;return 0===t?(ba.x=1,ba.y=0):(a=(n-e)/(2*t),i=be(1+a*a),s=1/(0<=a?a+i:a-i),ba.x=1/be(1+s*s),ba.y=s*ba.x),ba}}]),t}(),Ea=function(){function t(){e(this,t)}return n(t,null,[{key:\"rotateXY\",value:function(e,t){var n=t.x,a=t.y,i=e.x,s=e.y;e.set(n*i-a*s,a*i+n*s)}},{key:\"rotateQXY\",value:function(e,t,n){var a=n.x,i=n.y,s=a*a,r=i*i,o=2*a*i*t,l=e.x,u=e.y;e.set(s*l-o+r*u,r*l+o+s*u)}}]),t}(),Da=.1,Fa=new gt,Oa=new $e,La=new Qe,Ma=new je,Ba=function(){function t(){e(this,t)}return n(t,null,[{key:\"solve\",value:function(e,t,n){var a=le(Fa.copy(e),Oa.identity()),i=ye(Oa,a);n.copy(t).applyMatrix3(i)}}]),t}(),Na=new je,qa=function(){function t(){e(this,t),this.data=null,this.ata=new gt,this.atb=new je,this.massPoint=new je,this.hasSolution=!1}return n(t,[{key:\"setData\",value:function(e){return this.data=e,this.hasSolution=!1,this}},{key:\"solve\",value:function(e){var t=this.data,n=this.massPoint,a=this.ata.copy(t.ata),i=this.atb.copy(t.atb),s=1/0;return!this.hasSolution&&null!==t&&0<t.numPoints&&(Na.copy(t.massPointSum).divideScalar(t.numPoints),n.copy(Na),a.applyToVector3(Na),i.sub(Na),Ba.solve(a,i,e),s=he(a,i,e),e.add(n),this.hasSolution=!0),s}}]),t}(),Va=function(){function t(){e(this,t),this.ata=new gt,this.ata.set(0,0,0,0,0,0),this.atb=new je,this.massPointSum=new je,this.numPoints=0}return n(t,[{key:\"set\",value:function(e,t,n,a){return this.ata.copy(e),this.atb.copy(t),this.massPointSum.copy(n),this.numPoints=a,this}},{key:\"copy\",value:function(e){return this.set(e.ata,e.atb,e.massPointSum,e.numPoints)}},{key:\"add\",value:function(e,t){var n=t.x,a=t.y,i=t.z,s=e.dot(t),r=this.ata.elements,o=this.atb;r[0]+=n*n,r[1]+=n*a,r[3]+=a*a,r[2]+=n*i,r[4]+=a*i,r[5]+=i*i,o.x+=s*n,o.y+=s*a,o.z+=s*i,this.massPointSum.add(e),++this.numPoints}},{key:\"addData\",value:function(e){this.ata.add(e.ata),this.atb.add(e.atb),this.massPointSum.add(e.massPointSum),this.numPoints+=e.numPoints}},{key:\"clear\",value:function(){this.ata.set(0,0,0,0,0,0),this.atb.set(0,0,0),this.massPointSum.set(0,0,0),this.numPoints=0}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}}]),t}(),Ra=function t(){e(this,t),this.materials=0,this.edgeCount=0,this.index=-1,this.position=new je,this.normal=new je,this.qefData=null},Ua=new qa,Ya=.1,Xa=-1,ja=function(t){function a(t,n){var i;return e(this,a),i=z(this,y(a).call(this,t,n)),i.voxel=null,i}return s(a,t),n(a,[{key:\"contains\",value:function(e){var t=this.min,n=this.size;return e.x>=t.x-Ya&&e.y>=t.y-Ya&&e.z>=t.z-Ya&&e.x<=t.x+n+Ya&&e.y<=t.y+n+Ya&&e.z<=t.z+n+Ya}},{key:\"collapse\",value:function(){var e=this.children,t=[-1,-1,-1,-1,-1,-1,-1,-1],n=new je,a=-1,s=null!==e,r=0,o,l,u,y,h,c,d;if(s){for(y=new Va,c=0,d=0;8>d;++d)o=e[d],r+=o.collapse(),u=o.voxel,null===o.children?null!==u&&(y.addData(u.qefData),a=1&u.materials>>7-d,t[d]=1&u.materials>>d,++c):s=!1;if(s&&(h=Ua.setData(y).solve(n),h<=Xa)){for(u=new Ra,u.position.copy(this.contains(n)?n:Ua.massPoint),d=0;8>d;++d)l=t[d],o=e[d],-1===l?u.materials|=a<<d:(u.materials|=l<<d,u.normal.add(o.voxel.normal));u.normal.normalize(),u.qefData=y,this.voxel=u,this.children=null,r+=c-1}}return r}}],[{key:\"errorThreshold\",get:function(){return Xa},set:function(e){Xa=e}}]),a}(Et),Za=function(t){function a(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new je,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,s;return e(this,a),s=z(this,y(a).call(this)),s.root=new ja(n,i),s.voxelCount=0,null!==t&&null!==t.edgeData&&s.construct(t),0<=ja.errorThreshold&&s.simplify(),s}return s(a,t),n(a,[{key:\"simplify\",value:function(){this.voxelCount-=this.root.collapse()}},{key:\"construct\",value:function(e){var t=rn.resolution,n=e.edgeData,a=e.materialIndices,s=new qa,r=new je,o=[n.edgesX(this.min,this.root.size),n.edgesY(this.min,this.root.size),n.edgesZ(this.min,this.root.size)],l=[new Uint8Array([0,1,2,3]),new Uint8Array([0,1,4,5]),new Uint8Array([0,2,4,6])],u=0,h,c,m,v,g,p,f,k,w,S,I;for(S=0;3>S;++S){m=l[S],h=o[S];var T=!0,P=!1,C=void 0;try{for(var b=h[Symbol.iterator](),A;!(T=(A=b.next()).done);T=!0)for(c=A.value,c.computeZeroCrossingPosition(r),I=0;4>I;++I)v=Ct[m[I]],f=c.coordinates.x-v[0],k=c.coordinates.y-v[1],w=c.coordinates.z-v[2],0<=f&&0<=k&&0<=w&&f<t&&k<t&&w<t&&(g=ce(this.root,t,f,k,w),null===g.voxel&&(g.voxel=de(t,f,k,w,a),++u),p=g.voxel,p.normal.add(c.n),p.qefData.add(r,c.n),p.qefData.numPoints===p.edgeCount&&(s.setData(p.qefData).solve(p.position),!g.contains(p.position)&&p.position.copy(s.massPoint),p.normal.normalize()))}catch(e){P=!0,C=e}finally{try{T||null==b[\"return\"]||b[\"return\"]()}finally{if(P)throw C}}}this.voxelCount=u}}]),a}(Vt),Ga=0,_a=new je,Ka=function(){function t(){e(this,t)}return n(t,null,[{key:\"run\",value:function(e,t,n,a){_a.fromArray(e),Ga=t,null===n?a.operation===Xe.UNION&&(n=new rn(!1)):n.decompress();var i=a.toCSG(),s=null===n?null:ke(i);if(null!==s){switch(a.operation){case Xe.UNION:i=new kt(i);break;case Xe.DIFFERENCE:i=new zt(i);break;case Xe.INTERSECTION:i=new wt(i);}fe(i,n,s),n.contoured=!1}return null!==n&&n.empty?null:n}}]),t}(),Qa=new rn(!1),Wa=function(){function t(){e(this,t),this.data=null,this.response=null}return n(t,[{key:\"getData\",value:function(){return this.data}},{key:\"respond\",value:function(){return this.response.data=this.data.serialize(),this.response}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.data&&this.data.createTransferList(e),e}},{key:\"process\",value:function(e){return this.data=Qa.deserialize(e.data),this}}]),t}(),Ha=function(t){function a(){var t;return e(this,a),t=z(this,y(a).call(this)),t.response=new ra,t.decompressionTarget=new rn(!1),t.isosurface=null,t}return s(a,t),n(a,[{key:\"respond\",value:function(){var e=S(y(a.prototype),\"respond\",this).call(this);return e.isosurface=null===this.isosurface?null:this.isosurface.serialise(),e}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return S(y(a.prototype),\"createTransferList\",this).call(this,e),null===this.isosurface?e:this.isosurface.createTransferList(e)}},{key:\"process\",value:function(e){var t=S(y(a.prototype),\"process\",this).call(this,e).getData(),n=new Za(t.decompress(this.decompressionTarget));return this.isosurface=Ca.run(n),this.decompressionTarget.clear(),this}}]),a}(Wa),Ja=function(t){function a(){var t;return e(this,a),t=z(this,y(a).call(this)),t.response=new oa,t.sdf=null,t}return s(a,t),n(a,[{key:\"respond\",value:function(){var e=S(y(a.prototype),\"respond\",this).call(this);return e.sdf=null===this.sdf?null:this.sdf.serialize(),e}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return S(y(a.prototype),\"createTransferList\",this).call(this,e),null===this.sdf?e:this.sdf.createTransferList(e)}},{key:\"process\",value:function(e){var t=S(y(a.prototype),\"process\",this).call(this,e).getData(),n=this.sdf=gn.revive(e.sdf),i=Ka.run(e.cellPosition,e.cellSize,t,n);return T(y(a.prototype),\"data\",null===i?null:i.compress(),this,!0),this}}]),a}(Wa),$a=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:\"Report\";e(this,t),this.name=n,this.lines=[],this.data=[]}return n(t,[{key:\"clear\",value:function(){this.data=[]}},{key:\"addLine\",value:function(e){this.lines.push(e)}},{key:\"addValue\",value:function(e){this.data.push(e)}},{key:\"toString\",value:function(){var e=this.lines,t=this.data,n=this.name+\"\\n\\n\",a,s;for(a=0,s=e.length;a<s;++a)n+=e[a]+\"\\n\";for(n+=\"\\nValues:\\n\",n+=\"i, ms\\n\",(a=0,s=t.length);a<s;++a)n+=a+1+\", \"+t[a]+\"\\n\";return n}}]),t}(),ei=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;e(this,t),this.name=n}return n(t,[{key:\"initialize\",value:function(){throw new Error(\"Test#initialize method not implemented!\")}},{key:\"clear\",value:function(){throw new Error(\"Test#clear method not implemented!\")}},{key:\"run\",value:function(){throw new Error(\"Test#run method not implemented!\")}}]),t}(),ti=function(t){function a(){var t;return e(this,a),t=z(this,y(a).call(this,\"Compression Test\")),t.data=null,t.targetContainer=new rn(!1),t}return s(a,t),n(a,[{key:\"initialize\",value:function(){var e=1/2,t=dn.create(vn.PIPE);return t.scale.set(.475,.475,.475),t.updateInverseTransformation(),this.data=Ka.run([-e,-e,-e],1,null,t.setOperationType(Xe.UNION)),this}},{key:\"clear\",value:function(){return this.data=null,this.targetContainer.clear(),this}},{key:\"run\",value:function(){var e=new $a(\"Compression Report\"),t=this.targetContainer,a=this.data,s=rn.resolution,n=ze(s+1,3),r=3*ze(s+1,2)*s,o,l,u,y,h,c,d;for(e.addLine(\"Performing 200 compression tasks\"),d=0;200>d;++d)c=performance.now(),a.compress(t),e.addValue(performance.now()-c);return l=t.materials,u=t.materialIndices.length,y=t.runLengths.length,o=a.edgeData,h=o.indices[0].length+o.indices[1].length+o.indices[2].length,e.addLine(\"Material Statistics\"),e.addLine(\"Total Materials: \"+n+\" (\"+l+\" solid)\"),e.addLine(\"Compressed Materials: \"+u+\" (+ \"+y+\" run-lengths)\"),e.addLine(\"Compression Ratio: \"+(n/(u+4*y)).toFixed(2)),e.addLine(\"Space Savings: \"+(100*(1-(u+4*y)/n)).toFixed(2)+\"%\"),e.addLine(\"Maximum Memory Usage: \"+(8*n/8/1024).toFixed(2)+\" KB\"),e.addLine(\"Estimated Memory Usage: \"+((8*u+32*y)/8/1024).toFixed(2)+\" KB\\n\"),e.addLine(\"Edge Data Statistics\"),e.addLine(\"Total Edges: \"+h+\" (\"+r+\" max)\"),e.addLine(\"Compression Ratio: \"+(r/h).toFixed(2)),e.addLine(\"Space Savings: \"+(100*(1-h/r)).toFixed(2)+\"%\"),e.addLine(\"Maximum Memory Usage: \"+((32*r+32*r+32*(3*r))/8/1024/1024).toFixed(2)+\" MB\"),e.addLine(\"Estimated Memory Usage: \"+((32*h+32*h+32*(3*h))/8/1024).toFixed(2)+\" KB\"),console.log(\"Compressed data\",t),e}}]),a}(ei),ni=function(t){function a(){var t;return e(this,a),t=z(this,y(a).call(this,\"Decompression Test\")),t.data=null,t.targetContainer=new rn(!1),t}return s(a,t),n(a,[{key:\"initialize\",value:function(){var e=1/2,t=dn.create(vn.PIPE);return t.scale.set(.475,.475,.475),t.updateInverseTransformation(),this.data=Ka.run([-e,-e,-e],1,null,t.setOperationType(Xe.UNION)),this.data.compress(),this}},{key:\"clear\",value:function(){return this.data=null,this.targetContainer.clear(),this}},{key:\"run\",value:function(){var e=new $a(\"Decompression Report\"),t=this.targetContainer,n=this.data,a,s;for(e.addLine(\"Performing 200 decompression tasks\"),s=0;200>s;++s)a=performance.now(),n.decompress(t),e.addValue(performance.now()-a);return console.log(\"Decompressed data\",t),e}}]),a}(ei),ai=function(t){function a(){var t;return e(this,a),t=z(this,y(a).call(this,\"CSG Test\")),t.data=null,t.cellSize=1,t.cellPosition=[-.5,-.5,-.5],t.sdf=null,t}return s(a,t),n(a,[{key:\"initialize\",value:function(){var e=dn.create(vn.PELLET).setOperationType(Xe.UNION),t=dn.create(vn.PIPE).setOperationType(Xe.UNION);return e.scale.set(.475,.475,.475),e.updateInverseTransformation(),t.scale.set(.475,.475,.475),t.updateInverseTransformation(),this.data=Ka.run(this.cellPosition,this.cellSize,null,e),this.sdf=t,this}},{key:\"clear\",value:function(){return this.data=null,this.sdf=null,this}},{key:\"run\",value:function(){var e=new $a(\"CSG Report\"),t=this.cellPosition,n=this.cellSize,a=this.data,s=this.sdf,r,o,l;for(e.addLine(\"Executing 200 CSG Union operations on existing data\"),e.addLine(\"Initial material count: \"+a.materials),e.addLine(\"Initial edge count: \"+(a.edgeData.indices[0].length+a.edgeData.indices[1].length+a.edgeData.indices[2].length)),l=0;200>l;++l)o=performance.now(),r=Ka.run(t,n,a,s),e.addValue(performance.now()-o);return e.addLine(\"Final material count: \"+r.materials),e.addLine(\"Final edge count: \"+(r.edgeData.indices[0].length+r.edgeData.indices[1].length+r.edgeData.indices[2].length)),console.log(\"Generated data\",r),e}}]),a}(ei),ii=function(t){function a(){var t;return e(this,a),t=z(this,y(a).call(this,\"SVO Test\")),t.data=null,t.cellSize=1,t.cellPosition=new je(-.5,-.5,-.5),t}return s(a,t),n(a,[{key:\"initialize\",value:function(){var e=dn.create(vn.PIPE);return e.scale.set(.475,.475,.475),e.updateInverseTransformation(),ja.errorThreshold=.01,this.data=Ka.run(this.cellPosition.toArray(),this.cellSize,null,e.setOperationType(Xe.UNION)),this}},{key:\"clear\",value:function(){return this.data=null,this}},{key:\"run\",value:function(){var e=new $a(\"SVO Report\"),t=this.cellPosition,n=this.cellSize,a=this.data,s,r,o;for(e.addLine(\"Building 200 sparse voxel octrees\"),e.addLine(\"Material count: \"+a.materials),e.addLine(\"Edge count: \"+(a.edgeData.indices[0].length+a.edgeData.indices[1].length+a.edgeData.indices[2].length)),o=0;200>o;++o)r=performance.now(),s=new Za(a,t,n),e.addValue(performance.now()-r);return e.addLine(\"Final voxel count: \"+s.voxelCount),console.log(\"Sparse voxel octree\",s),e}}]),a}(ei),si=function(t){function a(){var t;return e(this,a),t=z(this,y(a).call(this,\"Contouring Test\")),t.svo=null,t}return s(a,t),n(a,[{key:\"initialize\",value:function(){var e=1/2,t=new je(-e,-e,-e),n=dn.create(vn.PIPE);return n.scale.set(.475,.475,.475),n.updateInverseTransformation(),ja.errorThreshold=.01,this.svo=new Za(Ka.run(t.toArray(),1,null,n.setOperationType(Xe.UNION)),t,1),this}},{key:\"clear\",value:function(){return this.svo=null,this}},{key:\"run\",value:function(){var e=new $a(\"Contouring Report\"),t=this.svo,n,a,s;for(e.addLine(\"Performing 200 contouring tasks\"),e.addLine(\"Voxel count: \"+t.voxelCount),s=0;200>s;++s)a=performance.now(),n=Ca.run(t),e.addValue(performance.now()-a);return e.addLine(\"Generated vertices: \"+n.positions.length/3),e.addLine(\"Generated triangle indices: \"+n.indices.length),console.log(\"Extracted isosurface\",n),e}}]),a}(ei),ri={CONFIGURE:\"worker.config\",TEST:\"worker.test\"},oi=new Map([[\"Compression\",new ti],[\"Decompression\",new ni],[\"Contouring\",new si],[\"CSG\",new ai],[\"SVO\",new ii]]);self.addEventListener(\"message\",function(e){var t=e.data,n,a;switch(t.action){case ri.CONFIGURE:{rn.resolution=t.resolution,console.log(\"Setting Hermite data resolution to\",t.resolution);break}case ri.TEST:{n=oi.get(t.id).initialize(),a=n.run(),n.clear(),postMessage({reportName:a.name,reportURL:URL.createObjectURL(new Blob([a.toString()],{type:\"text/plain\"}))});break}}})})();\n"],{type:"text/javascript"})),u=null,o=["Compression","Decompression","Contouring","CSG","SVO"];window.addEventListener("load",function e(){window.removeEventListener("load",e),document.getElementById("resolution").addEventListener("change",t),u=new Worker(r),u.addEventListener("message",a),u.addEventListener("error",a),u.postMessage({action:s.CONFIGURE,resolution:64}),i()})})();
