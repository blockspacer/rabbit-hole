(function(){'use strict';function t(t){u.postMessage({action:r.CONFIGURE,resolution:Number.parseInt(t.target.value)})}function e(t){var e=t.target.id,n=document.createElement("h3");n.appendChild(document.createTextNode("Running "+e+" Test\u2026")),document.getElementById("aside").appendChild(n),document.getElementById("mask").removeAttribute("class"),u.postMessage({action:r.TEST,id:e})}function n(t){var e=t.data,n=document.createElement("div"),i=document.createElement("span"),s=document.createElement("a");s.href=e.reportURL,s.setAttribute("download",e.reportName+".log"),s.setAttribute("class","report"),s.appendChild(document.createTextNode("Report \u2B73")),i.appendChild(document.createTextNode("Test complete")),i.setAttribute("class","status"),i.appendChild(s),n.setAttribute("class","result"),n.appendChild(i),n.appendChild(s),document.getElementById("aside").appendChild(n),document.getElementById("mask").setAttribute("class","hidden")}function i(){var t,n,i,s=document.getElementById("main"),r=document.createElement("ul"),u=!0,l=!1,h=void 0;try{for(var c,y=o[Symbol.iterator]();!(u=(c=y.next()).done);u=!0)t=c.value,n=document.createElement("li"),i=document.createElement("a"),i.appendChild(document.createTextNode(t)),i.setAttribute("href","#"+t),i.setAttribute("id",t),i.addEventListener("click",e),n.appendChild(i),r.appendChild(n)}catch(t){l=!0,h=t}finally{try{u||null==y["return"]||y["return"]()}finally{if(l)throw h}}s.appendChild(r)}function s(t){switch(t.type){case"message":n(t);break;case"error":console.error("Encountered an unexpected error",t);}}var r={CONFIGURE:"worker.config",TEST:"worker.test"},a=URL.createObjectURL(new Blob(["function _typeof(e){return _typeof=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},_typeof(e)}(function(){'use strict';var de=Math.pow,ye=Math.trunc,ue=Math.sign,ce=Math.PI,me=Math.atan2,xe=Math.round,pe=Math.acos,ve=Math.cos,ge=Math.sin,ke=Math.floor,he=Math.ceil,ze=Math.abs,fe=Math.sqrt,Se=Math.max,Ie=Math.min;function e(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function t(e,t){for(var n,a=0;a<t.length;a++)n=t[a],n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}function n(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}function i(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function y(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function u(){return u=y()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var a=Function.bind.apply(e,i),l=new a;return n&&s(l,n.prototype),l},u.apply(null,arguments)}function x(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}function g(e,t){return t&&(\"object\"===_typeof(t)||\"function\"==typeof t)?t:x(e)}function k(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=l(e),null!==e););return e}function h(e,t,n){return h=\"undefined\"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var a=k(e,t);if(a){var i=Object.getOwnPropertyDescriptor(a,t);return i.get?i.get.call(n):i.value}},h(e,t,n||e)}function z(e){return f(e)||S(e)||I()}function f(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function S(e){if(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e))return Array.from(e)}function I(){throw new TypeError(\"Invalid attempt to spread non-iterable instance\")}function C(e,t,n){return Se(Ie(e,n),t)}function T(e,t,n){var a,l,o,s,r,d,y,u,c,m,x,p=t.params.Points.threshold;for(r=0,y=e.length;r<y;++r)if(c=e[r],m=c.points,null!==m)for(d=0,u=m.length;d<u;++d)x=m[d],s=t.ray.distanceSqToPoint(x),s<p*p&&(a=t.ray.closestPointToPoint(x,new Te),l=t.ray.origin.distanceTo(a),l>=t.near&&l<=t.far&&(o=fe(s),n.push(new ut(l,o,a,c.data[d]))))}function w(e,t,n,a,i,l){var o=0;return e>t&&e>n?(i<e&&(o|=2),l<e&&(o|=1)):t>n?(a<t&&(o|=4),l<t&&(o|=1)):(a<n&&(o|=4),i<n&&(o|=2)),o}function P(e,t,n,a){var i,l=0;return t<n?(i=t,l=0):(i=n,l=1),a<i&&(l=2),ct[e][l]}function E(e,t,n){var a,i,l,o,s,r,y,u,c,m=xt.min.set(0,0,0),x=xt.max.subVectors(e.max,e.min),p=e.getDimensions(pt.min),v=pt.max.copy(p).multiplyScalar(.5),g=d.origin.copy(t.origin),k=d.direction.copy(t.direction);return g.sub(e.getCenter(mt)).add(v),n.value=0,0>k.x&&(g.x=p.x-g.x,k.x=-k.x,n.value|=4),0>k.y&&(g.y=p.y-g.y,k.y=-k.y,n.value|=2),0>k.z&&(g.z=p.z-g.z,k.z=-k.z,n.value|=1),a=1/k.x,i=1/k.y,l=1/k.z,o=(m.x-g.x)*a,s=(x.x-g.x)*a,r=(m.y-g.y)*i,y=(x.y-g.y)*i,u=(m.z-g.z)*l,c=(x.z-g.z)*l,Se(Se(o,r),u)<Ie(Ie(s,y),c)?[o,r,u,s,y,c]:null}function D(e,t,n,a,i,l,o,s){if(0<=i&&0<=l&&0<=o){var d=e.children;if(null===d)s.push(e);else{var y=.5*(t+i),u=.5*(n+l),c=.5*(a+o),m=r.value,x=w(t,n,a,y,u,c);do 0===x?(D(d[m],t,n,a,y,u,c,s),x=P(x,y,u,c)):1===x?(D(d[1^m],t,n,c,y,u,o,s),x=P(x,y,u,o)):2===x?(D(d[2^m],t,u,a,y,l,c,s),x=P(x,y,l,c)):3===x?(D(d[3^m],t,u,c,y,l,o,s),x=P(x,y,l,o)):4===x?(D(d[4^m],y,n,a,i,u,c,s),x=P(x,i,u,c)):5===x?(D(d[5^m],y,n,c,i,u,o,s),x=P(x,i,u,o)):6===x?(D(d[6^m],y,u,a,i,l,c,s),x=P(x,i,l,c)):7===x?(D(d[7^m],y,u,c,i,l,o,s),x=8):void 0;while(8>x)}}}function F(e){var t,n,a,o=e.children,s=0;if(null!==o)for(t=0,n=o.length;t<n;++t)a=1+F(o[t]),a>s&&(s=a);return s}function V(e,t,n){var a,o,s=e.children;if(ht.min=e.min,ht.max=e.max,t.intersectsBox(ht))if(null!==s)for(a=0,o=s.length;a<o;++a)V(s[a],t,n);else n.push(e)}function L(e,t,n,a){var o,s,r=e.children;if(n===t)a.push(e);else if(null!==r)for(++n,o=0,s=r.length;o<s;++o)L(r[o],t,n,a)}function N(e){var t,n,a=e.children,o=0;if(null!==a)for(t=0,n=a.length;t<n;++t)o+=N(a[t]);else null!==e.points&&(o=e.points.length);return o}function O(e,t,n,a,o){var s,r,d=a.children,y=!1,u=!1;if(a.contains(e,n.bias)){if(null===d){if(null===a.points)a.points=[],a.data=[];else for(s=0,r=a.points.length;!y&&s<r;++s)y=a.points[s].equals(e);y?(a.data[s-1]=t,u=!0):a.points.length<n.maxPoints||o===n.maxDepth?(a.points.push(e.clone()),a.data.push(t),++n.pointCount,u=!0):(a.split(),a.redistribute(n.bias),d=a.children)}if(null!==d)for(++o,s=0,r=d.length;!u&&s<r;++s)u=O(e,t,n,d[s],o)}return u}function B(e,t,n,a){var o,s,r,d,y,u=n.children,c=null;if(n.contains(e,t.bias))if(null!==u)for(o=0,s=u.length;null===c&&o<s;++o)c=B(e,t,u[o],n);else if(null!==n.points)for(r=n.points,d=n.data,(o=0,s=r.length);o<s;++o)if(r[o].equals(e)){y=s-1,c=d[o],o<y&&(r[o]=r[y],d[o]=d[y]),r.pop(),d.pop(),--t.pointCount,null!==a&&N(a)<=t.maxPoints&&a.merge();break}return c}function R(e,t,n){var a,o,s,r=n.children,d=null;if(n.contains(e,t.bias))if(null!==r)for(a=0,o=r.length;null===d&&a<o;++a)d=R(e,t,r[a]);else if(null!==n.points)for(s=n.points,a=0,o=s.length;null===d&&a<o;++a)e.equals(s[a])&&(d=n.data[a]);return d}function A(e,t,n,a,o,s){var r,d,y,u=a.children,c=null;if(a.contains(e,n.bias))if(!a.contains(t,n.bias))c=B(e,n,a,o),O(t,c,n,o,s-1);else if(null!==u)for(++s,r=0,d=u.length;null===c&&r<d;++r)c=A(e,t,n,u[r],a,s);else if(null!==a.points)for(y=a.points,r=0,d=y.length;r<d;++r)if(e.equals(y[r])){y[r].copy(t),c=a.data[r];break}return c}function M(e,t,n,a){var o,s,r=null,d=t;if(null!==a.children){var y,u,c=a.children.map(function(t){return{octant:t,distance:t.distanceToCenterSquared(e)}}).sort(function(e,t){return e.distance-t.distance});for(o=0,s=c.length;o<s&&(y=c[o].octant,!(y.contains(e,d)&&(u=M(e,d,n,y),null!==u&&(d=u.distance,r=u,0===d))));++o);}else if(null!==a.points){var m,x=a.points,p=-1;for(o=0,s=x.length;o<s;++o)if(!x[o].equals(e))m=e.distanceTo(x[o]),m<d&&(d=m,p=o);else if(!n){d=0,p=o;break}0<=p&&(r={point:x[p],data:a.data[p],distance:d})}return r}function Y(e,t,n,a,o){var s,r,d=a.children;if(null!==d){var y;for(s=0,r=d.length;s<r;++s)y=d[s],y.contains(e,t)&&Y(e,t,n,y,o)}else if(null!==a.points){var u,c=a.points;for(s=0,r=c.length;s<r;++s)u=c[s],u.equals(e)?!n&&o.push({point:u.clone(),data:a.data[s]}):u.distanceToSquared(e)<=t*t&&o.push({point:u.clone(),data:a.data[s]})}}function X(e,t,n){var a,l,o,s,r,d,y,u=[-1,-1,-1,-1],c=[!1,!1,!1,!1],m=1/0,x=0,p=!1;for(y=0;4>y;++y)r=e[y],d=Ht[t][y],a=lt[d][0],l=lt[d][1],o=1&r.voxel.materials>>a,s=1&r.voxel.materials>>l,r.size<m&&(m=r.size,x=y,p=o!==We.AIR),u[y]=r.voxel.index,c[y]=o!==s;c[x]&&(p?(n.push(u[0]),n.push(u[3]),n.push(u[1]),n.push(u[0]),n.push(u[2]),n.push(u[3])):(n.push(u[0]),n.push(u[1]),n.push(u[3]),n.push(u[0]),n.push(u[3]),n.push(u[2])))}function Z(e,t,n){var a,l,o,s,r=[0,0,0,0];if(null!==e[0].voxel&&null!==e[1].voxel&&null!==e[2].voxel&&null!==e[3].voxel)X(e,t,n);else for(o=0;2>o;++o){for(r[0]=Qt[t][o][0],r[1]=Qt[t][o][1],r[2]=Qt[t][o][2],r[3]=Qt[t][o][3],a=[],s=0;4>s;++s)if(l=e[s],null!==l.voxel)a[s]=l;else if(null!==l.children)a[s]=l.children[r[s]];else break;4===s&&Z(a,Qt[t][o][4],n)}}function U(e,t,n){var a,l,o,s,r,d,y=[0,0,0,0],u=[[0,0,1,1],[0,1,0,1]];if(null!==e[0].children||null!==e[1].children){for(r=0;4>r;++r)y[0]=_t[t][r][0],y[1]=_t[t][r][1],a=[null===e[0].children?e[0]:e[0].children[y[0]],null===e[1].children?e[1]:e[1].children[y[1]]],U(a,_t[t][r][2],n);for(r=0;4>r;++r){for(y[0]=Gt[t][r][1],y[1]=Gt[t][r][2],y[2]=Gt[t][r][3],y[3]=Gt[t][r][4],o=u[Gt[t][r][0]],l=[],d=0;4>d;++d)if(s=e[o[d]],null!==s.voxel)l[d]=s;else if(null!==s.children)l[d]=s.children[y[d]];else break;4===d&&Z(l,Gt[t][r][5],n)}}}function j(e,t){var n,a,l,o=e.children,s=[0,0,0,0];if(null!==o){for(l=0;8>l;++l)j(o[l],t);for(l=0;12>l;++l)s[0]=Ut[l][0],s[1]=Ut[l][1],n=[o[s[0]],o[s[1]]],U(n,Ut[l][2],t);for(l=0;6>l;++l)s[0]=jt[l][0],s[1]=jt[l][1],s[2]=jt[l][2],s[3]=jt[l][3],a=[o[s[0]],o[s[1]],o[s[2]],o[s[3]]],Z(a,jt[l][4],t)}}function _(e,t,n,a){var l,o;if(null!==e.children)for(l=0;8>l;++l)a=_(e.children[l],t,n,a);else null!==e.voxel&&(o=e.voxel,o.index=a,t[3*a]=o.position.x,t[3*a+1]=o.position.y,t[3*a+2]=o.position.z,n[3*a]=o.normal.x,n[3*a+1]=o.normal.y,n[3*a+2]=o.normal.z,++a);return a}function G(e,t){var n,a=e.elements,i=t.elements;0!==a[1]&&(n=$t.calculateCoefficients(a[0],a[1],a[3]),en.rotateQXY(ln.set(a[0],a[3]),a[1],n),a[0]=ln.x,a[3]=ln.y,en.rotateXY(ln.set(a[2],a[4]),n),a[2]=ln.x,a[4]=ln.y,a[1]=0,en.rotateXY(ln.set(i[0],i[3]),n),i[0]=ln.x,i[3]=ln.y,en.rotateXY(ln.set(i[1],i[4]),n),i[1]=ln.x,i[4]=ln.y,en.rotateXY(ln.set(i[2],i[5]),n),i[2]=ln.x,i[5]=ln.y)}function Q(e,t){var n,a=e.elements,i=t.elements;0!==a[2]&&(n=$t.calculateCoefficients(a[0],a[2],a[5]),en.rotateQXY(ln.set(a[0],a[5]),a[2],n),a[0]=ln.x,a[5]=ln.y,en.rotateXY(ln.set(a[1],a[4]),n),a[1]=ln.x,a[4]=ln.y,a[2]=0,en.rotateXY(ln.set(i[0],i[6]),n),i[0]=ln.x,i[6]=ln.y,en.rotateXY(ln.set(i[1],i[7]),n),i[1]=ln.x,i[7]=ln.y,en.rotateXY(ln.set(i[2],i[8]),n),i[2]=ln.x,i[8]=ln.y)}function H(e,t){var n,a=e.elements,i=t.elements;0!==a[4]&&(n=$t.calculateCoefficients(a[3],a[4],a[5]),en.rotateQXY(ln.set(a[3],a[5]),a[4],n),a[3]=ln.x,a[5]=ln.y,en.rotateXY(ln.set(a[1],a[2]),n),a[1]=ln.x,a[2]=ln.y,a[4]=0,en.rotateXY(ln.set(i[3],i[6]),n),i[3]=ln.x,i[6]=ln.y,en.rotateXY(ln.set(i[4],i[7]),n),i[4]=ln.x,i[7]=ln.y,en.rotateXY(ln.set(i[5],i[8]),n),i[5]=ln.x,i[8]=ln.y)}function K(t,n){var a,l=t.elements;for(a=0;a<5;++a)G(t,n),Q(t,n),H(t,n);return on.set(l[0],l[3],l[5])}function J(e){var t=ze(e)<tn?0:1/e;return ze(t)<tn?0:t}function W(e,t){var n=e.elements,a=n[0],i=n[3],l=n[6],o=n[1],s=n[4],r=n[7],d=n[2],y=n[5],u=n[8],c=J(t.x),m=J(t.y),x=J(t.z);return e.set(a*c*a+i*m*i+l*x*l,a*c*o+i*m*s+l*x*r,a*c*d+i*m*y+l*x*u,o*c*a+s*m*i+r*x*l,o*c*o+s*m*s+r*x*r,o*c*d+s*m*y+r*x*u,d*c*a+y*m*i+u*x*l,d*c*o+y*m*s+u*x*r,d*c*d+y*m*y+u*x*u)}function $(e,t,n){return e.applyToVector3(rn.copy(n)),rn.subVectors(t,rn),rn.dot(rn)}function ee(e,t,a,l,o){var s=0;for(t>>=1;0<t;t>>=1,s=0)a>=t&&(s+=4,a-=t),l>=t&&(s+=2,l-=t),o>=t&&(s+=1,o-=t),null===e.children&&e.split(),e=e.children[s];return e}function te(e,t,n,a,l){var o,s,r,d,y,u,c,x,p,v,g=e+1,m=new un;for(o=0,v=0;8>v;++v)d=ot[v],y=(a+d[2])*(g*g)+(n+d[1])*g+(t+d[0]),r=Ie(l[y],We.SOLID),o|=r<<v;for(s=0,v=0;12>v;++v)u=lt[v][0],c=lt[v][1],x=1&o>>u,p=1&o>>c,x!==p&&++s;return m.materials=o,m.edgeCount=s,m.qefData=new yn,m}function ne(e){var t=gn,a=qt.resolution,n=new Te(0,0,0),i=new Te(a,a,a),l=new v(kn,kn.clone().addScalar(gn)),o=e.getBoundingBox();return e.type!==Ce.INTERSECTION&&(o.intersectsBox(l)?(n.copy(o.min).max(l.min).sub(l.min),n.x=he(n.x*a/t),n.y=he(n.y*a/t),n.z=he(n.z*a/t),i.copy(o.max).min(l.max).sub(l.min),i.x=ke(i.x*a/t),i.y=ke(i.y*a/t),i.z=ke(i.z*a/t)):(n.set(a,a,a),i.set(0,0,0))),new v(n,i)}function ae(e,t,a,i){var l,o,s,r=qt.resolution,n=r+1,d=i.max.x,u=i.max.y,c=i.max.z;for(s=i.min.z;s<=c;++s)for(o=i.min.y;o<=u;++o)for(l=i.min.x;l<=d;++l)e.updateMaterialIndex(s*(n*n)+o*n+l,t,a)}function ie(e,t,a){var i,l,o,r,d=gn,s=qt.resolution,n=s+1,u=t.materialIndices,c=new Te,m=new Te,p=a.max.x,v=a.max.y,g=a.max.z,k=0;for(r=a.min.z;r<=g;++r)for(c.z=r*d/s,o=a.min.y;o<=v;++o)for(c.y=o*d/s,l=a.min.x;l<=p;++l)c.x=l*d/s,i=e.generateMaterialIndex(m.addVectors(kn,c)),i!==We.AIR&&(u[r*(n*n)+o*n+l]=i,++k);t.materials=k}function le(e,t,a){var l,o,s,r,y,u,x,p,v,g,k,h,z,f,S,I,C,T,w,P,b,E,D,F=qt.resolution,n=F+1,m=new Uint32Array([1,n,n*n]),V=t.materialIndices,L=new wt,N=new wt,q=a.edgeData,O=t.edgeData,B=new Uint32Array(3),R=Ft.calculate1DEdgeCount(F),A=new Ft(F,Ie(R,O.indices[0].length+q.indices[0].length),Ie(R,O.indices[1].length+q.indices[1].length),Ie(R,O.indices[2].length+q.indices[2].length));for(T=0,w=0;3>w;T=0,++w){for(l=q.indices[w],r=O.indices[w],x=A.indices[w],o=q.zeroCrossings[w],y=O.zeroCrossings[w],p=A.zeroCrossings[w],s=q.normals[w],u=O.normals[w],v=A.normals[w],g=m[w],E=l.length,D=r.length,(P=0,b=0);P<E;++P)if(k=l[P],h=k+g,S=V[k],I=V[h],S!==I&&(S===We.AIR||I===We.AIR)){for(L.t=o[P],L.n.x=s[3*P],L.n.y=s[3*P+1],L.n.z=s[3*P+2],e.type===Ce.DIFFERENCE&&L.n.negate(),C=L;b<D&&r[b]<=k;)z=r[b],f=z+g,N.t=y[b],N.n.x=u[3*b],N.n.y=u[3*b+1],N.n.z=u[3*b+2],S=V[z],z<k?(I=V[f],S!==I&&(S===We.AIR||I===We.AIR)&&(x[T]=z,p[T]=N.t,v[3*T]=N.n.x,v[3*T+1]=N.n.y,v[3*T+2]=N.n.z,++T)):C=e.selectEdge(N,L,S===We.SOLID),++b;x[T]=k,p[T]=C.t,v[3*T]=C.n.x,v[3*T+1]=C.n.y,v[3*T+2]=C.n.z,++T}for(;b<D;)z=r[b],f=z+g,S=V[z],I=V[f],S!==I&&(S===We.AIR||I===We.AIR)&&(x[T]=z,p[T]=y[b],v[3*T]=u[3*b],v[3*T+1]=u[3*b+1],v[3*T+2]=u[3*b+2],++T),++b;B[w]=T}return{edgeData:A,lengths:B}}function oe(e,t,i){var l,o,r,u,p,v,g,k,h,f,S,I,C,T,w,P,b,E,D,F=gn,s=qt.resolution,n=s+1,m=n*n,V=new Uint32Array([1,n,m]),L=t.materialIndices,N=kn,q=new Te,O=new Te,B=new wt,R=new Uint32Array(3),A=new Ft(s,Ft.calculate1DEdgeCount(s));for(w=4,C=0,T=0;3>T;w>>=1,C=0,++T){P=ot[w],l=A.indices[T],o=A.zeroCrossings[T],r=A.normals[T],u=V[T],g=i.min.x,f=i.max.x,k=i.min.y,S=i.max.y,h=i.min.z,I=i.max.z;for(0===T?(g=Se(g-1,0),f=Ie(f,s-1)):1===T?(k=Se(k-1,0),S=Ie(S,s-1)):2===T?(h=Se(h-1,0),I=Ie(I,s-1)):void 0,D=h;D<=I;++D)for(E=k;E<=S;++E)for(b=g;b<=f;++b)p=D*m+E*n+b,v=p+u,L[p]!==L[v]&&(q.set(b*F/s,E*F/s,D*F/s),O.set((b+P[0])*F/s,(E+P[1])*F/s,(D+P[2])*F/s),B.a.addVectors(N,q),B.b.addVectors(N,O),e.generateEdge(B),l[C]=p,o[C]=B.t,r[3*C]=B.n.x,r[3*C+1]=B.n.y,r[3*C+2]=B.n.z,++C);R[T]=C}return{edgeData:A,lengths:R}}function se(e,t,n){var a,i,l,o,s=ne(e),r=!1;if(e.type===Ce.DENSITY_FUNCTION?ie(e,t,s):t.empty?e.type===Ce.UNION&&(t.set(n),r=!0):!(t.full&&e.type===Ce.UNION)&&ae(e,t,n,s),!r&&!t.empty&&!t.full){for(a=e.type===Ce.DENSITY_FUNCTION?oe(e,t,s):le(e,t,n),i=a.edgeData,l=a.lengths,o=0;3>o;++o)i.indices[o]=i.indices[o].slice(0,l[o]),i.zeroCrossings[o]=i.zeroCrossings[o].slice(0,l[o]),i.normals[o]=i.normals[o].slice(0,3*l[o]);t.edgeData=i}}function re(e){var t,n,a,o,s=e.children;for(e.type===Ce.DENSITY_FUNCTION&&(t=new qt,se(e,t)),a=0,o=s.length;a<o&&(n=re(s[a]),void 0===t?t=n:null===n?e.type===Ce.INTERSECTION&&(t=null):null===t?e.type===Ce.UNION&&(t=n):se(e,t,n),null!==t||e.type===Ce.UNION);++a);return null!==t&&t.empty?null:t}var Ce={UNION:\"csg.union\",DIFFERENCE:\"csg.difference\",INTERSECTION:\"csg.intersection\",DENSITY_FUNCTION:\"csg.densityfunction\"},Te=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.x=n,this.y=a,this.z=i}return n(t,[{key:\"set\",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:\"setFromSpherical\",value:function(e){this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:\"setFromSphericalCoords\",value:function(e,t,n){var a=ge(t)*e;return this.x=a*ge(n),this.y=ve(t)*e,this.z=a*ve(n),this}},{key:\"setFromCylindrical\",value:function(e){this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:\"setFromCylindricalCoords\",value:function(e,t,n){return this.x=e*ge(t),this.y=n,this.z=e*ve(t),this}},{key:\"setFromMatrixColumn\",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:\"setFromMatrixPosition\",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:\"setFromMatrixScale\",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),a=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=a,this}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:\"addVectors\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:\"addScaledVector\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:\"subVectors\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:\"multiplyVectors\",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this}},{key:\"crossVectors\",value:function(e,t){var n=e.x,a=e.y,i=e.z,l=t.x,o=t.y,s=t.z;return this.x=a*s-i*o,this.y=i*l-n*s,this.z=n*o-a*l,this}},{key:\"cross\",value:function(e){return this.crossVectors(this,e)}},{key:\"transformDirection\",value:function(t){var n=this.x,a=this.y,i=this.z,l=t.elements;return this.x=l[0]*n+l[4]*a+l[8]*i,this.y=l[1]*n+l[5]*a+l[9]*i,this.z=l[2]*n+l[6]*a+l[10]*i,this.normalize()}},{key:\"applyMatrix3\",value:function(t){var n=this.x,a=this.y,i=this.z,l=t.elements;return this.x=l[0]*n+l[3]*a+l[6]*i,this.y=l[1]*n+l[4]*a+l[7]*i,this.z=l[2]*n+l[5]*a+l[8]*i,this}},{key:\"applyMatrix4\",value:function(t){var n=this.x,a=this.y,i=this.z,l=t.elements;return this.x=l[0]*n+l[4]*a+l[8]*i+l[12],this.y=l[1]*n+l[5]*a+l[9]*i+l[13],this.z=l[2]*n+l[6]*a+l[10]*i+l[14],this}},{key:\"applyQuaternion\",value:function(e){var t=this.x,n=this.y,a=this.z,i=e.x,l=e.y,o=e.z,s=e.w,r=s*t+l*a-o*n,d=s*n+o*t-i*a,y=s*a+i*n-l*t,u=-i*t-l*n-o*a;return this.x=r*s+u*-i+d*-o-y*-l,this.y=d*s+u*-l+y*-i-r*-o,this.z=y*s+u*-o+r*-l-d*-i,this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:\"reflect\",value:function(e){var t=e.x,n=e.y,a=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(t,n,a),this}},{key:\"angleTo\",value:function(e){var t=this.dot(e)/fe(this.lengthSquared()*e.lengthSquared());return pe(Ie(Se(t,-1),1))}},{key:\"manhattanLength\",value:function(){return ze(this.x)+ze(this.y)+ze(this.z)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:\"length\",value:function(){return fe(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:\"manhattanDistanceTo\",value:function(e){return ze(this.x-e.x)+ze(this.y-e.y)+ze(this.z-e.z)}},{key:\"distanceToSquared\",value:function(e){var t=this.x-e.x,n=this.y-e.y,a=this.z-e.z;return t*t+n*n+a*a}},{key:\"distanceTo\",value:function(e){return fe(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=Ie(this.x,e.x),this.y=Ie(this.y,e.y),this.z=Ie(this.z,e.z),this}},{key:\"max\",value:function(e){return this.x=Se(this.x,e.x),this.y=Se(this.y,e.y),this.z=Se(this.z,e.z),this}},{key:\"clamp\",value:function(e,t){return this.x=Se(e.x,Ie(t.x,this.x)),this.y=Se(e.y,Ie(t.y,this.y)),this.z=Se(e.z,Ie(t.z,this.z)),this}},{key:\"floor\",value:function(){return this.x=ke(this.x),this.y=ke(this.y),this.z=ke(this.z),this}},{key:\"ceil\",value:function(){return this.x=he(this.x),this.y=he(this.y),this.z=he(this.z),this}},{key:\"round\",value:function(){return this.x=xe(this.x),this.y=xe(this.y),this.z=xe(this.z),this}},{key:\"lerp\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:\"lerpVectors\",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}]),t}(),we=new Te,o=[new Te,new Te,new Te,new Te,new Te,new Te,new Te,new Te],v=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Te(1/0,1/0,1/0),a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Te(-Infinity,-Infinity,-Infinity);e(this,t),this.min=n,this.max=a}return n(t,[{key:\"set\",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:\"copy\",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"makeEmpty\",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-Infinity,this}},{key:\"isEmpty\",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Te;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getSize\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Te;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:\"setFromSphere\",value:function(e){return this.set(e.center,e.center),this.expandByScalar(e.radius),this}},{key:\"expandByPoint\",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:\"expandByVector\",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:\"expandByScalar\",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:\"setFromPoints\",value:function(e){var t,n;for(this.min.set(0,0,0),this.max.set(0,0,0),(t=0,n=e.length);t<n;++t)this.expandByPoint(e[t]);return this}},{key:\"setFromCenterAndSize\",value:function(e,t){var n=we.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:\"clampPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Te;return t.copy(e).clamp(this.min,this.max)}},{key:\"distanceToPoint\",value:function(e){var t=we.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:\"applyMatrix4\",value:function(e){var t=this.min,n=this.max;return this.isEmpty()||(o[0].set(t.x,t.y,t.z).applyMatrix4(e),o[1].set(t.x,t.y,n.z).applyMatrix4(e),o[2].set(t.x,n.y,t.z).applyMatrix4(e),o[3].set(t.x,n.y,n.z).applyMatrix4(e),o[4].set(n.x,t.y,t.z).applyMatrix4(e),o[5].set(n.x,t.y,n.z).applyMatrix4(e),o[6].set(n.x,n.y,t.z).applyMatrix4(e),o[7].set(n.x,n.y,n.z).applyMatrix4(e),this.setFromPoints(o)),this}},{key:\"translate\",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:\"intersect\",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:\"union\",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:\"containsPoint\",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=n.x&&e.y<=n.y&&e.z<=n.z}},{key:\"containsBox\",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return t.x<=a.x&&i.x<=n.x&&t.y<=a.y&&i.y<=n.y&&t.z<=a.z&&i.z<=n.z}},{key:\"intersectsBox\",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&i.z>=t.z&&a.x<=n.x&&a.y<=n.y&&a.z<=n.z}},{key:\"intersectsSphere\",value:function(e){var t=this.clampPoint(e.center,we);return t.distanceToSquared(e.center)<=e.radius*e.radius}},{key:\"intersectsPlane\",value:function(e){var t,n;return 0<e.normal.x?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:\"equals\",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),t}(),Pe=new v,be=new Te,Ee=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Te,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.center=n,this.radius=a}return n(t,[{key:\"set\",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:\"copy\",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromPoints\",value:function(e){var t,n,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Pe.setFromPoints(e).getCenter(this.center),o=0;for(t=0,n=e.length;t<n;++t)o=Se(o,a.distanceToSquared(e[t]));return this.radius=fe(o),this}},{key:\"setFromBox\",value:function(e){return e.getCenter(this.center),this.radius=.5*e.getSize(be).length(),this}},{key:\"isEmpty\",value:function(){return 0>=this.radius}},{key:\"translate\",value:function(e){return this.center.add(e),this}},{key:\"clampPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Te,n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:\"distanceToPoint\",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:\"containsPoint\",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:\"intersectsSphere\",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:\"intersectsBox\",value:function(e){return e.intersectsSphere(this)}},{key:\"intersectsPlane\",value:function(e){return ze(e.distanceToPoint(this.center))<=this.radius}},{key:\"equals\",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}]),t}(),De=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.x=n,this.y=a}return n(t,[{key:\"set\",value:function(e,t){return this.x=e,this.y=t,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this}},{key:\"addVectors\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:\"addScaledVector\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this}},{key:\"subVectors\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this}},{key:\"applyMatrix3\",value:function(t){var n=this.x,a=this.y,i=t.elements;return this.x=i[0]*n+i[3]*a+i[6],this.y=i[1]*n+i[4]*a+i[7],this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y}},{key:\"cross\",value:function(e){return this.x*e.y-this.y*e.x}},{key:\"manhattanLength\",value:function(){return ze(this.x)+ze(this.y)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y}},{key:\"length\",value:function(){return fe(this.x*this.x+this.y*this.y)}},{key:\"manhattanDistanceTo\",value:function(e){return ze(this.x-e.x)+ze(this.y-e.y)}},{key:\"distanceToSquared\",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:\"distanceTo\",value:function(e){return fe(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=Ie(this.x,e.x),this.y=Ie(this.y,e.y),this}},{key:\"max\",value:function(e){return this.x=Se(this.x,e.x),this.y=Se(this.y,e.y),this}},{key:\"clamp\",value:function(e,t){return this.x=Se(e.x,Ie(t.x,this.x)),this.y=Se(e.y,Ie(t.y,this.y)),this}},{key:\"floor\",value:function(){return this.x=ke(this.x),this.y=ke(this.y),this}},{key:\"ceil\",value:function(){return this.x=he(this.x),this.y=he(this.y),this}},{key:\"round\",value:function(){return this.x=xe(this.x),this.y=xe(this.y),this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:\"angle\",value:function e(){var e=me(this.y,this.x);return 0>e&&(e+=2*ce),e}},{key:\"lerp\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:\"lerpVectors\",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:\"rotateAround\",value:function(e,t){var n=ve(t),a=ge(t),i=this.x-e.x,l=this.y-e.y;return this.x=i*n-l*a+e.x,this.y=i*a+l*n+e.y,this}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y}},{key:\"width\",get:function(){return this.x},set:function(e){return this.x=e}},{key:\"height\",get:function(){return this.y},set:function(e){return this.y=e}}]),t}(),Fe=new De,Ve=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new De(1/0,1/0),a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new De(-Infinity,-Infinity);e(this,t),this.min=n,this.max=a}return n(t,[{key:\"set\",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:\"copy\",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"makeEmpty\",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-Infinity,this}},{key:\"isEmpty\",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new De;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getSize\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new De;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:\"getBoundingSphere\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Ee;return this.getCenter(e.center),e.radius=.5*this.getSize(Fe).length(),e}},{key:\"expandByPoint\",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:\"expandByVector\",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:\"expandByScalar\",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:\"setFromPoints\",value:function(e){var t,n;for(this.min.set(0,0),this.max.set(0,0),(t=0,n=e.length);t<n;++t)this.expandByPoint(e[t]);return this}},{key:\"setFromCenterAndSize\",value:function(e,t){var n=Fe.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:\"clampPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new De;return t.copy(e).clamp(this.min,this.max)}},{key:\"distanceToPoint\",value:function(e){var t=Fe.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:\"translate\",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:\"intersect\",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:\"union\",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:\"containsPoint\",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.x<=n.x&&e.y<=n.y}},{key:\"containsBox\",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return t.x<=a.x&&i.x<=n.x&&t.y<=a.y&&i.y<=n.y}},{key:\"intersectsBox\",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&a.x<=n.x&&a.y<=n.y}},{key:\"equals\",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),t}(),Le=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.radius=n,this.theta=a,this.y=i}return n(t,[{key:\"set\",value:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}},{key:\"copy\",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromVector3\",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:\"setFromCartesianCoords\",value:function(e,t,n){return this.radius=fe(e*e+n*n),this.theta=me(e,n),this.y=t,this}}]),t}(),Ne=function(){function t(){e(this,t),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return n(t,[{key:\"set\",value:function(e,t,n,a,i,l,o,s,r){var d=this.elements;return d[0]=e,d[3]=t,d[6]=n,d[1]=a,d[4]=i,d[7]=l,d[2]=o,d[5]=s,d[8]=r,this}},{key:\"identity\",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:\"copy\",value:function(e){var t=e.elements,n=this.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],this}},{key:\"clone\",value:function(){return new this.constructor().fromArray(this.elements)}},{key:\"fromArray\",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=this.elements;for(t=0;9>t;++t)a[t]=e[t+n];return this}},{key:\"toArray\",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=this.elements;for(e=0;9>e;++e)t[e+n]=a[e];return t}},{key:\"multiplyMatrices\",value:function(e,t){var n=e.elements,a=t.elements,i=this.elements,l=n[0],o=n[3],s=n[6],r=n[1],d=n[4],y=n[7],u=n[2],c=n[5],m=n[8],x=a[0],p=a[3],v=a[6],g=a[1],k=a[4],h=a[7],z=a[2],f=a[5],S=a[8];return i[0]=l*x+o*g+s*z,i[3]=l*p+o*k+s*f,i[6]=l*v+o*h+s*S,i[1]=r*x+d*g+y*z,i[4]=r*p+d*k+y*f,i[7]=r*v+d*h+y*S,i[2]=u*x+c*g+m*z,i[5]=u*p+c*k+m*f,i[8]=u*v+c*h+m*S,this}},{key:\"multiply\",value:function(e){return this.multiplyMatrices(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyMatrices(e,this)}},{key:\"multiplyScalar\",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:\"determinant\",value:function(){var t=this.elements,n=t[0],a=t[1],l=t[2],o=t[3],s=t[4],e=t[5],r=t[6],d=t[7],y=t[8];return n*s*y-n*e*d-a*o*y+a*e*r+l*o*d-l*s*r}},{key:\"getInverse\",value:function(e){var t,n=e.elements,a=this.elements,i=n[0],l=n[1],o=n[2],s=n[3],r=n[4],d=n[5],y=n[6],u=n[7],c=n[8],m=c*r-d*u,x=d*y-c*s,p=u*s-r*y,v=i*m+l*x+o*p;return 0===v?(console.error(\"Can't invert matrix, determinant is zero\",e),this.identity()):(t=1/v,a[0]=m*t,a[1]=(o*u-c*l)*t,a[2]=(d*l-o*r)*t,a[3]=x*t,a[4]=(c*i-o*y)*t,a[5]=(o*s-d*i)*t,a[6]=p*t,a[7]=(l*y-u*i)*t,a[8]=(r*i-l*s)*t),this}},{key:\"transpose\",value:function(){var e,n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}},{key:\"scale\",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:\"rotate\",value:function(e){var t=ve(e),n=ge(e),a=this.elements,i=a[0],l=a[3],o=a[6],s=a[1],r=a[4],d=a[7];return a[0]=t*i+n*s,a[3]=t*l+n*r,a[6]=t*o+n*d,a[1]=-n*i+t*s,a[4]=-n*l+t*r,a[7]=-n*o+t*d,this}},{key:\"translate\",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:\"equals\",value:function(e){var t,n=this.elements,a=e.elements,l=!0;for(t=0;l&&9>t;++t)n[t]!==a[t]&&(l=!1);return l}}]),t}(),qe={XYZ:\"XYZ\",YZX:\"YZX\",ZXY:\"ZXY\",XZY:\"XZY\",YXZ:\"YXZ\",ZYX:\"ZYX\"},Oe=function(){var a=Number.EPSILON;function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;e(this,t),this.x=n,this.y=a,this.z=i,this.w=l}return n(t,[{key:\"set\",value:function(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.w=a,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:\"setFromEuler\",value:function(e){var t=e.x,n=e.y,a=e.z,i=ve,l=ge,o=i(t/2),s=i(n/2),r=i(a/2),d=l(t/2),y=l(n/2),u=l(a/2);switch(e.order){case qe.XYZ:this.x=d*s*r+o*y*u,this.y=o*y*r-d*s*u,this.z=o*s*u+d*y*r,this.w=o*s*r-d*y*u;break;case qe.YXZ:this.x=d*s*r+o*y*u,this.y=o*y*r-d*s*u,this.z=o*s*u-d*y*r,this.w=o*s*r+d*y*u;break;case qe.ZXY:this.x=d*s*r-o*y*u,this.y=o*y*r+d*s*u,this.z=o*s*u+d*y*r,this.w=o*s*r-d*y*u;break;case qe.ZYX:this.x=d*s*r-o*y*u,this.y=o*y*r+d*s*u,this.z=o*s*u-d*y*r,this.w=o*s*r+d*y*u;break;case qe.YZX:this.x=d*s*r+o*y*u,this.y=o*y*r+d*s*u,this.z=o*s*u-d*y*r,this.w=o*s*r-d*y*u;break;case qe.XZY:this.x=d*s*r-o*y*u,this.y=o*y*r-d*s*u,this.z=o*s*u+d*y*r,this.w=o*s*r+d*y*u;}return this}},{key:\"setFromAxisAngle\",value:function(e,t){var n=t/2,a=ge(n);return this.x=e.x*a,this.y=e.y*a,this.z=e.z*a,this.w=ve(n),this}},{key:\"setFromRotationMatrix\",value:function(e){var t,n=e.elements,a=n[0],i=n[4],l=n[8],o=n[1],r=n[5],d=n[9],y=n[2],u=n[6],c=n[10],m=a+r+c;return 0<m?(t=.5/fe(m+1),this.w=.25/t,this.x=(u-d)*t,this.y=(l-y)*t,this.z=(o-i)*t):a>r&&a>c?(t=2*fe(1+a-r-c),this.w=(u-d)/t,this.x=.25*t,this.y=(i+o)/t,this.z=(l+y)/t):r>c?(t=2*fe(1+r-a-c),this.w=(l-y)/t,this.x=(i+o)/t,this.y=.25*t,this.z=(d+u)/t):(t=2*fe(1+c-a-r),this.w=(o-i)/t,this.x=(l+y)/t,this.y=(d+u)/t,this.z=.25*t),this}},{key:\"setFromUnitVectors\",value:function(e,t){var n=e.dot(t)+1;return 1e-6>n?(n=0,ze(e.x)>ze(e.z)?(this.x=-e.y,this.y=e.x,this.z=0,this.w=n):(this.x=0,this.y=-e.z,this.z=e.y,this.w=n)):(this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this.w=n),this.normalize()}},{key:\"angleTo\",value:function(e){return 2*pe(ze(Ie(Se(this.dot(e),-1),1)))}},{key:\"rotateTowards\",value:function(e,t){var n=this.angleTo(e);return 0!==n&&this.slerp(e,Ie(1,t/n)),this}},{key:\"invert\",value:function(){return this.conjugate()}},{key:\"conjugate\",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:\"length\",value:function(){return fe(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:\"normalize\",value:function(){var e,t=this.length();return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/t,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:\"multiplyQuaternions\",value:function(e,t){var n=e.x,a=e.y,i=e.z,l=e.w,o=t.x,s=t.y,r=t.z,d=t.w;return this.x=n*d+l*o+a*r-i*s,this.y=a*d+l*s+i*o-n*r,this.z=i*d+l*r+n*s-a*o,this.w=l*d-n*o-a*s-i*r,this}},{key:\"multiply\",value:function(e){return this.multiplyQuaternions(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyQuaternions(e,this)}},{key:\"slerp\",value:function(e,n){var t,i,l,o,r,d,u,c=this.x,m=this.y,y=this.z,x=this.w;return 1===n?this.copy(e):0<n&&(t=x*e.w+c*e.x+m*e.y+y*e.z,0>t?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,t=-t):this.copy(e),1<=t?(this.w=x,this.x=c,this.y=m,this.z=y):(i=1-t*t,r=1-n,i<=a?(this.w=r*x+n*this.w,this.x=r*c+n*this.x,this.y=r*m+n*this.y,this.z=r*y+n*this.z,this.normalize()):(l=fe(i),o=me(l,t),d=ge(r*o)/l,u=ge(n*o)/l,this.w=x*d+this.w*u,this.x=c*d+this.x*u,this.y=m*d+this.y*u,this.z=y*d+this.z*u))),this}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}],[{key:\"slerp\",value:function(e,n,a,i){return a.copy(e).slerp(n,i)}},{key:\"slerpFlat\",value:function(e,n,i,l,o,r,d){var y,u,c,m,x,p,v,g,k=o[r],h=o[r+1],z=o[r+2],S=o[r+3],I=i[l],C=i[l+1],T=i[l+2],w=i[l+3];(w!==S||I!==k||C!==h||T!==z)&&(y=1-d,m=I*k+C*h+T*z+w*S,p=0<=m?1:-1,x=1-m*m,x>a&&(c=fe(x),v=me(c,m*p),y=ge(y*v)/c,d=ge(d*v)/c),g=d*p,I=I*y+k*g,C=C*y+h*g,T=T*y+z*g,w=w*y+S*g,y===1-d&&(u=1/fe(I*I+C*C+T*T+w*w),I*=u,C*=u,T*=u,w*=u)),e[n]=I,e[n+1]=C,e[n+2]=T,e[n+3]=w}}]),t}(),Be=new Ne,m=new Oe,q=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.x=n,this.y=a,this.z=i,this.order=t.defaultOrder}return n(t,[{key:\"set\",value:function(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.order=a,this}},{key:\"copy\",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.order=e[t+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.order,e}},{key:\"toVector3\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Te;return e.set(this.x,this.y,this.z)}},{key:\"setFromRotationMatrix\",value:function(e){var t=Math.asin,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order,a=e.elements,i=a[0],l=a[4],o=a[8],s=a[1],r=a[5],d=a[9],y=a[2],u=a[6],c=a[10],m=1-1e-5;switch(n){case qe.XYZ:{this.y=t(C(o,-1,1)),ze(o)<m?(this.x=me(-d,c),this.z=me(-l,i)):(this.x=me(u,r),this.z=0);break}case qe.YXZ:{this.x=t(-C(d,-1,1)),ze(d)<m?(this.y=me(o,c),this.z=me(s,r)):(this.y=me(-y,i),this.z=0);break}case qe.ZXY:{this.x=t(C(u,-1,1)),ze(u)<m?(this.y=me(-y,c),this.z=me(-l,r)):(this.y=0,this.z=me(s,i));break}case qe.ZYX:{this.y=t(-C(y,-1,1)),ze(y)<m?(this.x=me(u,c),this.z=me(s,i)):(this.x=0,this.z=me(-l,r));break}case qe.YZX:{this.z=t(C(s,-1,1)),ze(s)<m?(this.x=me(-d,r),this.y=me(-y,i)):(this.x=0,this.y=me(o,c));break}case qe.XZY:{this.z=t(-C(l,-1,1)),ze(l)<m?(this.x=me(u,r),this.y=me(o,i)):(this.x=me(-d,c),this.y=0);break}}return this.order=n,this}},{key:\"setFromQuaternion\",value:function(e,t){return Be.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Be,t)}},{key:\"setFromVector3\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(e.x,e.y,e.z,t)}},{key:\"reorder\",value:function(e){return m.setFromEuler(this),this.setFromQuaternion(m,e)}},{key:\"equals\",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order}}],[{key:\"defaultOrder\",get:function(){return qe.XYZ}}]),t}(),Re=new Te,a=new Te,b=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Te(1,0,0),a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.normal=n,this.constant=a}return n(t,[{key:\"set\",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:\"setComponents\",value:function(e,t,n,a){return this.normal.set(e,t,n),this.constant=a,this}},{key:\"copy\",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromNormalAndCoplanarPoint\",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:\"setFromCoplanarPoints\",value:function(e,t,n){var i=Re.subVectors(n,t).cross(a.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,Re),this}},{key:\"normalize\",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:\"negate\",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:\"distanceToPoint\",value:function(e){return this.normal.dot(e)+this.constant}},{key:\"distanceToSphere\",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:\"projectPoint\",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:\"coplanarPoint\",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:\"translate\",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:\"intersectLine\",value:function(e,n){var a=e.delta(Re),i=this.normal.dot(a);if(0===i)0===this.distanceToPoint(e.start)&&n.copy(e.start);else{var l=-(e.start.dot(this.normal)+this.constant)/i;0<=l&&1>=l&&n.copy(a).multiplyScalar(l).add(e.start)}return n}},{key:\"intersectsLine\",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return 0>t&&0<n||0>n&&0<t}},{key:\"intersectsBox\",value:function(e){return e.intersectsPlane(this)}},{key:\"intersectsSphere\",value:function(e){return e.intersectsPlane(this)}},{key:\"equals\",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}]),t}(),Ae=new Te,Me=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new b,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new b,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new b,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new b,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new b,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new b;e(this,t),this.planes=[n,a,i,l,o,s]}return n(t,[{key:\"set\",value:function(e,t,n,a,i,l){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(a),o[4].copy(i),o[5].copy(l),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"copy\",value:function(e){var t,n=this.planes;for(t=0;6>t;++t)n[t].copy(e.planes[t]);return this}},{key:\"setFromMatrix\",value:function(e){var t=this.planes,n=e.elements,a=n[0],i=n[1],l=n[2],o=n[3],s=n[4],r=n[5],d=n[6],y=n[7],u=n[8],c=n[9],m=n[10],x=n[11],p=n[12],v=n[13],g=n[14],k=n[15];return t[0].setComponents(o-a,y-s,x-u,k-p).normalize(),t[1].setComponents(o+a,y+s,x+u,k+p).normalize(),t[2].setComponents(o+i,y+r,x+c,k+v).normalize(),t[3].setComponents(o-i,y-r,x-c,k-v).normalize(),t[4].setComponents(o-l,y-d,x-m,k-g).normalize(),t[5].setComponents(o+l,y+d,x+m,k+g).normalize(),this}},{key:\"intersectsSphere\",value:function(e){var t,n,a=this.planes,l=e.center,o=-e.radius,s=!0;for(t=0;6>t;++t)if(n=a[t].distanceToPoint(l),n<o){s=!1;break}return s}},{key:\"intersectsBox\",value:function(e){var t,n,a=this.planes,l=e.min,o=e.max;for(t=0;6>t;++t)if(n=a[t],Ae.x=0<n.normal.x?o.x:l.x,Ae.y=0<n.normal.y?o.y:l.y,Ae.z=0<n.normal.z?o.z:l.z,0>n.distanceToPoint(Ae))return!1;return!0}},{key:\"containsPoint\",value:function(e){var t,n=this.planes,a=!0;for(t=0;6>t;++t)if(0>n[t].distanceToPoint(e)){a=!1;break}return a}}]),t}(),Ye=new Te,Xe=new Te,Ze=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Te,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Te;e(this,t),this.start=n,this.end=a}return n(t,[{key:\"set\",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:\"copy\",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Te;return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:\"delta\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Te;return e.subVectors(this.end,this.start)}},{key:\"lengthSquared\",value:function(){return this.start.distanceToSquared(this.end)}},{key:\"length\",value:function(){return this.start.distanceTo(this.end)}},{key:\"at\",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:\"closestPointToPointParameter\",value:function(e,n){Ye.subVectors(e,this.start),Xe.subVectors(this.end,this.start);var a=Xe.dot(Xe),i=Xe.dot(Ye),l=n?Ie(Se(i/a,0),1):i/a;return l}},{key:\"closestPointToPoint\",value:function(e){var n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Te,i=this.closestPointToPointParameter(e,n);return this.delta(a).multiplyScalar(i).add(this.start)}},{key:\"equals\",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}]),t}(),Ue=new Te,je=new Te,_e=new Te,c=function(){function t(){e(this,t),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return n(t,[{key:\"set\",value:function(e,t,n,a,i,l,o,s,r,d,y,u,c,m,x,p){var v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=a,v[1]=i,v[5]=l,v[9]=o,v[13]=s,v[2]=r,v[6]=d,v[10]=y,v[14]=u,v[3]=c,v[7]=m,v[11]=x,v[15]=p,this}},{key:\"identity\",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:\"copy\",value:function(e){var t=e.elements,n=this.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],this}},{key:\"clone\",value:function(){return new this.constructor().fromArray(this.elements)}},{key:\"fromArray\",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=this.elements;for(t=0;16>t;++t)a[t]=e[t+n];return this}},{key:\"toArray\",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=this.elements;for(e=0;16>e;++e)t[e+n]=a[e];return t}},{key:\"getMaxScaleOnAxis\",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],a=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return fe(Se(t,n,a))}},{key:\"copyPosition\",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:\"setPosition\",value:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}},{key:\"extractBasis\",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:\"makeBasis\",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:\"extractRotation\",value:function(e){var t=this.elements,n=e.elements,a=1/Ue.setFromMatrixColumn(e,0).length(),i=1/Ue.setFromMatrixColumn(e,1).length(),l=1/Ue.setFromMatrixColumn(e,2).length();return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*l,t[9]=n[9]*l,t[10]=n[10]*l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:\"makeRotationFromEuler\",value:function(t){var n,i,l,o,s,r,u,m,p,v,g,k,h=this.elements,S=t.x,x=t.y,y=t.z,z=ve(S),a=ge(S),I=ve(x),c=ge(x),d=ve(y),e=ge(y);switch(t.order){case qe.XYZ:{n=z*d,i=z*e,l=a*d,o=a*e,h[0]=I*d,h[4]=-I*e,h[8]=c,h[1]=i+l*c,h[5]=n-o*c,h[9]=-a*I,h[2]=o-n*c,h[6]=l+i*c,h[10]=z*I;break}case qe.YXZ:{s=I*d,r=I*e,u=c*d,m=c*e,h[0]=s+m*a,h[4]=u*a-r,h[8]=z*c,h[1]=z*e,h[5]=z*d,h[9]=-a,h[2]=r*a-u,h[6]=m+s*a,h[10]=z*I;break}case qe.ZXY:{s=I*d,r=I*e,u=c*d,m=c*e,h[0]=s-m*a,h[4]=-z*e,h[8]=u+r*a,h[1]=r+u*a,h[5]=z*d,h[9]=m-s*a,h[2]=-z*c,h[6]=a,h[10]=z*I;break}case qe.ZYX:{n=z*d,i=z*e,l=a*d,o=a*e,h[0]=I*d,h[4]=l*c-i,h[8]=n*c+o,h[1]=I*e,h[5]=o*c+n,h[9]=i*c-l,h[2]=-c,h[6]=a*I,h[10]=z*I;break}case qe.YZX:{p=z*I,v=z*c,g=a*I,k=a*c,h[0]=I*d,h[4]=k-p*e,h[8]=g*e+v,h[1]=e,h[5]=z*d,h[9]=-a*d,h[2]=-c*d,h[6]=v*e+g,h[10]=p-k*e;break}case qe.XZY:{p=z*I,v=z*c,g=a*I,k=a*c,h[0]=I*d,h[4]=-e,h[8]=c*d,h[1]=p*e+k,h[5]=z*d,h[9]=v*e-g,h[2]=g*e-v,h[6]=a*d,h[10]=k*e+p;break}}return h[3]=0,h[7]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,this}},{key:\"makeRotationFromQuaternion\",value:function(e){return this.compose(Ue.set(0,0,0),e,je.set(1,1,1))}},{key:\"lookAt\",value:function(e,t,n){var a=this.elements,i=Ue,l=je,o=_e;return o.subVectors(e,t),0===o.lengthSquared()&&(o.z=1),o.normalize(),i.crossVectors(n,o),0===i.lengthSquared()&&(1===ze(n.z)?o.x+=1e-4:o.z+=1e-4,o.normalize(),i.crossVectors(n,o)),i.normalize(),l.crossVectors(o,i),a[0]=i.x,a[4]=l.x,a[8]=o.x,a[1]=i.y,a[5]=l.y,a[9]=o.y,a[2]=i.z,a[6]=l.z,a[10]=o.z,this}},{key:\"multiplyMatrices\",value:function(e,t){var n=this.elements,a=e.elements,i=t.elements,l=a[0],o=a[4],s=a[8],r=a[12],d=a[1],y=a[5],u=a[9],c=a[13],m=a[2],x=a[6],p=a[10],v=a[14],g=a[3],k=a[7],h=a[11],z=a[15],f=i[0],S=i[4],I=i[8],C=i[12],T=i[1],w=i[5],P=i[9],b=i[13],E=i[2],D=i[6],F=i[10],V=i[14],L=i[3],N=i[7],q=i[11],O=i[15];return n[0]=l*f+o*T+s*E+r*L,n[4]=l*S+o*w+s*D+r*N,n[8]=l*I+o*P+s*F+r*q,n[12]=l*C+o*b+s*V+r*O,n[1]=d*f+y*T+u*E+c*L,n[5]=d*S+y*w+u*D+c*N,n[9]=d*I+y*P+u*F+c*q,n[13]=d*C+y*b+u*V+c*O,n[2]=m*f+x*T+p*E+v*L,n[6]=m*S+x*w+p*D+v*N,n[10]=m*I+x*P+p*F+v*q,n[14]=m*C+x*b+p*V+v*O,n[3]=g*f+k*T+h*E+z*L,n[7]=g*S+k*w+h*D+z*N,n[11]=g*I+k*P+h*F+z*q,n[15]=g*C+k*b+h*V+z*O,this}},{key:\"multiply\",value:function(e){return this.multiplyMatrices(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyMatrices(e,this)}},{key:\"multiplyScalar\",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:\"determinant\",value:function(){var e=this.elements,t=e[0],n=e[4],a=e[8],i=e[12],l=e[1],o=e[5],s=e[9],r=e[13],d=e[2],y=e[6],u=e[10],c=e[14],m=e[3],x=e[7],p=e[11],v=e[15],g=t*o,k=t*s,h=t*r,z=n*l,f=n*s,S=n*r,I=a*l,C=a*o,T=a*r,w=i*l,P=i*o,b=i*s;return m*(b*y-T*y-P*u+S*u+C*c-f*c)+x*(k*c-h*u+w*u-I*c+T*d-b*d)+p*(h*y-g*c-w*y+z*c+P*d-S*d)+v*(-C*d-k*y+g*u+I*y-z*u+f*d)}},{key:\"getInverse\",value:function(e){var t,n=this.elements,a=e.elements,i=a[0],l=a[1],o=a[2],s=a[3],r=a[4],d=a[5],y=a[6],u=a[7],c=a[8],m=a[9],x=a[10],p=a[11],v=a[12],g=a[13],k=a[14],h=a[15],z=m*k*u-g*x*u+g*y*p-d*k*p-m*y*h+d*x*h,f=v*x*u-c*k*u-v*y*p+r*k*p+c*y*h-r*x*h,S=c*g*u-v*m*u+v*d*p-r*g*p-c*d*h+r*m*h,I=v*m*y-c*g*y-v*d*x+r*g*x+c*d*k-r*m*k,C=i*z+l*f+o*S+s*I;return 0===C?(console.error(\"Can't invert matrix, determinant is zero\",e),this.identity()):(t=1/C,n[0]=z*t,n[1]=(g*x*s-m*k*s-g*o*p+l*k*p+m*o*h-l*x*h)*t,n[2]=(d*k*s-g*y*s+g*o*u-l*k*u-d*o*h+l*y*h)*t,n[3]=(m*y*s-d*x*s-m*o*u+l*x*u+d*o*p-l*y*p)*t,n[4]=f*t,n[5]=(c*k*s-v*x*s+v*o*p-i*k*p-c*o*h+i*x*h)*t,n[6]=(v*y*s-r*k*s-v*o*u+i*k*u+r*o*h-i*y*h)*t,n[7]=(r*x*s-c*y*s+c*o*u-i*x*u-r*o*p+i*y*p)*t,n[8]=S*t,n[9]=(v*m*s-c*g*s-v*l*p+i*g*p+c*l*h-i*m*h)*t,n[10]=(r*g*s-v*d*s+v*l*u-i*g*u-r*l*h+i*d*h)*t,n[11]=(c*d*s-r*m*s-c*l*u+i*m*u+r*l*p-i*d*p)*t,n[12]=I*t,n[13]=(c*g*o-v*m*o+v*l*x-i*g*x-c*l*k+i*m*k)*t,n[14]=(v*d*o-r*g*o-v*l*y+i*g*y+r*l*k-i*d*k)*t,n[15]=(r*m*o-c*d*o+c*l*y-i*m*y-r*l*x+i*d*x)*t),this}},{key:\"transpose\",value:function(){var e,n=this.elements;return e=n[1],n[1]=n[4],n[4]=e,e=n[2],n[2]=n[8],n[8]=e,e=n[6],n[6]=n[9],n[9]=e,e=n[3],n[3]=n[12],n[12]=e,e=n[7],n[7]=n[13],n[13]=e,e=n[11],n[11]=n[14],n[14]=e,this}},{key:\"scale\",value:function(e,t,n){var a=this.elements;return a[0]*=e,a[4]*=t,a[8]*=n,a[1]*=e,a[5]*=t,a[9]*=n,a[2]*=e,a[6]*=t,a[10]*=n,a[3]*=e,a[7]*=t,a[11]*=n,this}},{key:\"makeScale\",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:\"makeTranslation\",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:\"makeRotationX\",value:function(e){var t=ve(e),n=ge(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:\"makeRotationY\",value:function(e){var t=ve(e),n=ge(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:\"makeRotationZ\",value:function(e){var t=ve(e),n=ge(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:\"makeRotationAxis\",value:function(e,n){var a=ve(n),i=ge(n),l=1-a,t=e.x,o=e.y,s=e.z,r=l*t,d=l*o;return this.set(r*t+a,r*o-i*s,r*s+i*o,0,r*o+i*s,d*o+a,d*s-i*t,0,r*s-i*o,d*s+i*t,l*s*s+a,0,0,0,0,1),this}},{key:\"makeShear\",value:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}},{key:\"compose\",value:function(e,t,n){var a=this.elements,i=t.x,l=t.y,o=t.z,s=t.w,r=i+i,d=l+l,y=o+o,u=i*r,c=i*d,m=i*y,x=l*d,p=l*y,v=o*y,g=s*r,k=s*d,h=s*y,z=n.x,f=n.y,S=n.z;return a[0]=(1-(x+v))*z,a[1]=(c+h)*z,a[2]=(m-k)*z,a[3]=0,a[4]=(c-h)*f,a[5]=(1-(u+v))*f,a[6]=(p+g)*f,a[7]=0,a[8]=(m+k)*S,a[9]=(p-g)*S,a[10]=(1-(u+x))*S,a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1,this}},{key:\"decompose\",value:function(e,t,n){var a=this.elements,i=a[0],l=a[1],o=a[2],s=a[4],r=a[5],d=a[6],y=a[8],u=a[9],c=a[10],m=this.determinant(),x=Ue.set(i,l,o).length()*(0>m?-1:1),p=Ue.set(s,r,d).length(),v=Ue.set(y,u,c).length(),g=1/x,k=1/p,h=1/v;return e.x=a[12],e.y=a[13],e.z=a[14],a[0]*=g,a[1]*=g,a[2]*=g,a[4]*=k,a[5]*=k,a[6]*=k,a[8]*=h,a[9]*=h,a[10]*=h,t.setFromRotationMatrix(this),a[0]=i,a[1]=l,a[2]=o,a[4]=s,a[5]=r,a[6]=d,a[8]=y,a[9]=u,a[10]=c,n.x=x,n.y=p,n.z=v,this}},{key:\"makePerspective\",value:function(e,t,n,a,i,l){var o=this.elements;return o[0]=2*i/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*i/(n-a),o[9]=(n+a)/(n-a),o[13]=0,o[2]=0,o[6]=0,o[10]=-(l+i)/(l-i),o[14]=-2*l*i/(l-i),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:\"makeOrthographic\",value:function(e,t,n,a,i,l){var o=this.elements,s=1/(t-e),r=1/(n-a),d=1/(l-i);return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-((t+e)*s),o[1]=0,o[5]=2*r,o[9]=0,o[13]=-((n+a)*r),o[2]=0,o[6]=0,o[10]=-2*d,o[14]=-((l+i)*d),o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:\"equals\",value:function(e){var t,n=this.elements,a=e.elements,l=!0;for(t=0;l&&16>t;++t)n[t]!==a[t]&&(l=!1);return l}}]),t}(),Ge=[new Te,new Te,new Te,new Te],Qe=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Te,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Te;e(this,t),this.origin=n,this.direction=a}return n(t,[{key:\"set\",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:\"copy\",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"at\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Te;return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:\"lookAt\",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:\"recast\",value:function(e){return this.origin.copy(this.at(e,Ge[0])),this}},{key:\"closestPointToPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Te,n=t.subVectors(e,this.origin).dot(this.direction);return 0<=n?t.copy(this.direction).multiplyScalar(n).add(this.origin):t.copy(this.origin)}},{key:\"distanceSquaredToPoint\",value:function(e){var t=Ge[0].subVectors(e,this.origin).dot(this.direction);return 0>t?this.origin.distanceToSquared(e):Ge[0].copy(this.direction).multiplyScalar(t).add(this.origin).distanceToSquared(e)}},{key:\"distanceToPoint\",value:function(e){return fe(this.distanceSquaredToPoint(e))}},{key:\"distanceToPlane\",value:function(e){var n=e.normal.dot(this.direction),a=0===n?0===e.distanceToPoint(this.origin)?0:-1:-(this.origin.dot(e.normal)+e.constant)/n;return 0<=a?a:null}},{key:\"distanceSquaredToSegment\",value:function(e,t,n,a){var i,l,o,s,r,d=Ge[0].copy(e).add(t).multiplyScalar(.5),y=Ge[1].copy(t).sub(e).normalize(),u=Ge[2].copy(this.origin).sub(d),m=.5*e.distanceTo(t),x=-this.direction.dot(y),p=u.dot(this.direction),v=-u.dot(y),g=u.lengthSq(),c=ze(1-x*x);return 0<c?(i=x*v-p,l=x*p-v,o=m*c,0<=i?l>=-o?l<=o?(s=1/c,i*=s,l*=s,r=i*(i+x*l+2*p)+l*(x*i+l+2*v)+g):(l=m,i=Se(0,-(x*l+p)),r=-i*i+l*(l+2*v)+g):(l=-m,i=Se(0,-(x*l+p)),r=-i*i+l*(l+2*v)+g):l<=-o?(i=Se(0,-(-x*m+p)),l=0<i?-m:Ie(Se(-m,-v),m),r=-i*i+l*(l+2*v)+g):l<=o?(i=0,l=Ie(Se(-m,-v),m),r=l*(l+2*v)+g):(i=Se(0,-(x*m+p)),l=0<i?m:Ie(Se(-m,-v),m),r=-i*i+l*(l+2*v)+g)):(l=0<x?-m:m,i=Se(0,-(x*l+p)),r=-i*i+l*(l+2*v)+g),void 0!==n&&n.copy(this.direction).multiplyScalar(i).add(this.origin),void 0!==a&&a.copy(y).multiplyScalar(l).add(d),r}},{key:\"intersectSphere\",value:function(e){var t,n,a,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Te,l=Ge[0].subVectors(e.center,this.origin),o=l.dot(this.direction),s=l.dot(l)-o*o,r=e.radius*e.radius,d=null;return s<=r&&(t=fe(r-s),n=o-t,a=o+t,(0<=n||0<=a)&&(d=0>n?this.at(a,i):this.at(n,i))),d}},{key:\"intersectsSphere\",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:\"intersectPlane\",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Te,a=this.distanceToPlane(e);return null===a?null:this.at(a,n)}},{key:\"intersectsPlane\",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t}},{key:\"intersectBox\",value:function(e){var t,n,a,i,l,o,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Te,r=this.origin,d=this.direction,y=e.min,u=e.max,c=1/d.x,m=1/d.y,x=1/d.z,p=null;return 0<=c?(t=(y.x-r.x)*c,n=(u.x-r.x)*c):(t=(u.x-r.x)*c,n=(y.x-r.x)*c),0<=m?(a=(y.y-r.y)*m,i=(u.y-r.y)*m):(a=(u.y-r.y)*m,i=(y.y-r.y)*m),t<=i&&a<=n&&((a>t||t!==t)&&(t=a),(i<n||n!==n)&&(n=i),0<=x?(l=(y.z-r.z)*x,o=(u.z-r.z)*x):(l=(u.z-r.z)*x,o=(y.z-r.z)*x),t<=o&&l<=n&&((l>t||t!==t)&&(t=l),(o<n||n!==n)&&(n=o),0<=n&&(p=this.at(0<=t?t:n,s)))),p}},{key:\"intersectsBox\",value:function(e){return null!==this.intersectBox(e,Ge[0])}},{key:\"intersectTriangle\",value:function(e,t,n,a,i){var l,o,s,r,d,y=this.direction,u=Ge[0],c=Ge[1],m=Ge[2],x=Ge[3],p=null;return c.subVectors(t,e),m.subVectors(n,e),x.crossVectors(c,m),l=y.dot(x),0===l||a&&0<l||(0<l?o=1:(o=-1,l=-l),u.subVectors(this.origin,e),s=o*y.dot(m.crossVectors(u,m)),0<=s&&(r=o*y.dot(c.cross(u)),0<=r&&s+r<=l&&(d=-o*u.dot(x),0<=d&&(p=this.at(d/l,i))))),p}},{key:\"applyMatrix4\",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:\"equals\",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),t}(),He=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.radius=n,this.phi=a,this.theta=i}return n(t,[{key:\"set\",value:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}},{key:\"copy\",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"makeSafe\",value:function(){return this.phi=Se(1e-6,Ie(ce-1e-6,this.phi)),this}},{key:\"setFromVector3\",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:\"setFromCartesianCoords\",value:function(e,t,n){return this.radius=fe(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=me(e,n),this.phi=pe(Ie(Se(t/this.radius,-1),1))),this}}]),t}(),Ke=function(){function t(){e(this,t),this.elements=new Float32Array([1,0,0,1,0,1])}return n(t,[{key:\"set\",value:function(t,n,a,i,l,o){var s=this.elements;return s[0]=t,s[1]=n,s[3]=i,s[2]=a,s[4]=l,s[5]=o,this}},{key:\"identity\",value:function(){return this.set(1,0,0,1,0,1),this}},{key:\"copy\",value:function(e){var t=e.elements;return this.set(t[0],t[1],t[2],t[3],t[4],t[5]),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"toMatrix3\",value:function(e){var t=e.elements;e.set(t[0],t[1],t[2],t[1],t[3],t[4],t[2],t[4],t[5])}},{key:\"add\",value:function(e){var t=this.elements,n=e.elements;return t[0]+=n[0],t[1]+=n[1],t[3]+=n[3],t[2]+=n[2],t[4]+=n[4],t[5]+=n[5],this}},{key:\"norm\",value:function(){var t=this.elements,e=t[1]*t[1],n=t[2]*t[2],a=t[4]*t[4];return fe(t[0]*t[0]+e+n+e+t[3]*t[3]+a+n+a+t[5]*t[5])}},{key:\"off\",value:function(){var t=this.elements;return fe(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:\"applyToVector3\",value:function(t){var n=t.x,a=t.y,i=t.z,l=this.elements;return t.x=l[0]*n+l[1]*a+l[2]*i,t.y=l[1]*n+l[3]*a+l[4]*i,t.z=l[2]*n+l[4]*a+l[5]*i,t}},{key:\"equals\",value:function(e){var t,n=this.elements,a=e.elements,l=!0;for(t=0;l&&6>t;++t)n[t]!==a[t]&&(l=!1);return l}}],[{key:\"calculateIndex\",value:function(e,t){return 3-(3-e)*(2-e)/2+t}}]),t}(),Je=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;e(this,t),this.x=n,this.y=a,this.z=i,this.w=l}return n(t,[{key:\"set\",value:function(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.w=a,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:\"setAxisAngleFromQuaternion\",value:function(e){this.w=2*pe(e.w);var t=fe(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:\"setAxisAngleFromRotationMatrix\",value:function(e){var t,n,a,i,l,o,r,d,u,c,m,p=.01,v=.1,g=e.elements,k=g[0],h=g[4],f=g[8],S=g[1],I=g[5],C=g[9],T=g[2],w=g[6],P=g[10];return ze(h-S)<p&&ze(f-T)<p&&ze(C-w)<p?ze(h+S)<v&&ze(f+T)<v&&ze(C+w)<v&&ze(k+I+P-3)<v?this.set(1,0,0,0):(t=ce,l=(k+1)/2,o=(I+1)/2,r=(P+1)/2,d=(h+S)/4,u=(f+T)/4,c=(C+w)/4,l>o&&l>r?l<p?(n=0,a=.707106781,i=.707106781):(n=fe(l),a=d/n,i=u/n):o>r?o<p?(n=.707106781,a=0,i=.707106781):(a=fe(o),n=d/a,i=c/a):r<p?(n=.707106781,a=.707106781,i=0):(i=fe(r),n=u/i,a=c/i),this.set(n,a,i,t)):(m=fe((w-C)*(w-C)+(f-T)*(f-T)+(S-h)*(S-h)),.001>ze(m)&&(m=1),this.x=(w-C)/m,this.y=(f-T)/m,this.z=(S-h)/m,this.w=pe((k+I+P-1)/2)),this}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:\"addVectors\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:\"addScaledVector\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:\"subVectors\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:\"multiplyVectors\",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this.w=e.w*t.w,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this}},{key:\"applyMatrix4\",value:function(t){var n=this.x,a=this.y,i=this.z,l=this.w,o=t.elements;return this.x=o[0]*n+o[4]*a+o[8]*i+o[12]*l,this.y=o[1]*n+o[5]*a+o[9]*i+o[13]*l,this.z=o[2]*n+o[6]*a+o[10]*i+o[14]*l,this.w=o[3]*n+o[7]*a+o[11]*i+o[15]*l,this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:\"manhattanLength\",value:function(){return ze(this.x)+ze(this.y)+ze(this.z)+ze(this.w)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:\"length\",value:function(){return fe(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:\"manhattanDistanceTo\",value:function(e){return ze(this.x-e.x)+ze(this.y-e.y)+ze(this.z-e.z)+ze(this.w-e.w)}},{key:\"distanceToSquared\",value:function(e){var t=this.x-e.x,n=this.y-e.y,a=this.z-e.z,i=this.w-e.w;return t*t+n*n+a*a+i*i}},{key:\"distanceTo\",value:function(e){return fe(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=Ie(this.x,e.x),this.y=Ie(this.y,e.y),this.z=Ie(this.z,e.z),this.w=Ie(this.w,e.w),this}},{key:\"max\",value:function(e){return this.x=Se(this.x,e.x),this.y=Se(this.y,e.y),this.z=Se(this.z,e.z),this.w=Se(this.w,e.w),this}},{key:\"clamp\",value:function(e,t){return this.x=Se(e.x,Ie(t.x,this.x)),this.y=Se(e.y,Ie(t.y,this.y)),this.z=Se(e.z,Ie(t.z,this.z)),this.w=Se(e.w,Ie(t.w,this.w)),this}},{key:\"floor\",value:function(){return this.x=ke(this.x),this.y=ke(this.y),this.z=ke(this.z),this.w=ke(this.w),this}},{key:\"ceil\",value:function(){return this.x=he(this.x),this.y=he(this.y),this.z=he(this.z),this.w=he(this.w),this}},{key:\"round\",value:function(){return this.x=xe(this.x),this.y=xe(this.y),this.z=xe(this.z),this.w=xe(this.w),this}},{key:\"lerp\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:\"lerpVectors\",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}]),t}(),We={AIR:0,SOLID:1},$e=function(){function t(n){e(this,t),this.type=n;for(var a=arguments.length,i=Array(1<a?a-1:0),l=1;l<a;l++)i[l-1]=arguments[l];this.children=i,this.boundingBox=null}return n(t,[{key:\"getBoundingBox\",value:function(){return null===this.boundingBox&&(this.boundingBox=this.computeBoundingBox()),this.boundingBox}},{key:\"computeBoundingBox\",value:function(){var e,t,n=this.children,a=new v;for(e=0,t=n.length;e<t;++e)a.union(n[e].getBoundingBox());return a}}]),t}(),et=function(t){function a(){var t;e(this,a);for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];return g(this,(t=l(a)).call.apply(t,[this,Ce.UNION].concat(i)))}return i(a,t),n(a,[{key:\"updateMaterialIndex\",value:function(e,t,n){var a=n.materialIndices[e];a!==We.AIR&&t.setMaterialIndex(e,a)}},{key:\"selectEdge\",value:function(e,t,n){return n?e.t>t.t?e:t:e.t<t.t?e:t}}]),a}($e),tt=function(t){function a(){var t;e(this,a);for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];return g(this,(t=l(a)).call.apply(t,[this,Ce.DIFFERENCE].concat(i)))}return i(a,t),n(a,[{key:\"updateMaterialIndex\",value:function(e,t,n){n.materialIndices[e]!==We.AIR&&t.setMaterialIndex(e,We.AIR)}},{key:\"selectEdge\",value:function(e,t,n){return n?e.t<t.t?e:t:e.t>t.t?e:t}}]),a}($e),nt=function(t){function a(){var t;e(this,a);for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];return g(this,(t=l(a)).call.apply(t,[this,Ce.INTERSECTION].concat(i)))}return i(a,t),n(a,[{key:\"updateMaterialIndex\",value:function(e,t,n){var a=n.materialIndices[e];t.setMaterialIndex(e,t.materialIndices[e]!==We.AIR&&a!==We.AIR?a:We.AIR)}},{key:\"selectEdge\",value:function(e,t,n){return n?e.t<t.t?e:t:e.t>t.t?e:t}}]),a}($e),at=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;e(this,t),this.runLengths=n,this.data=a}return n(t,null,[{key:\"encode\",value:function(e){var n,a,o=[],s=[],r=e[0],d=1;for(n=1,a=e.length;n<a;++n)r===e[n]?++d:(o.push(d),s.push(r),r=e[n],d=1);return o.push(d),s.push(r),new t(o,s)}},{key:\"decode\",value:function(e,t){var n,a,l,o,s,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],d=0;for(a=0,o=t.length;a<o;++a)for(n=t[a],l=0,s=e[a];l<s;++l)r[d++]=n;return r}}]),t}(),it=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,a=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];e(this,t),this.value=n,this.done=a}return n(t,[{key:\"reset\",value:function(){this.value=null,this.done=!1}}]),t}(),lt=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],ot=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],st=new Te,rt=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Te,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.min=n,this.size=a,this.children=null}return n(t,[{key:\"getCenter\",value:function(e){return e.copy(this.min).addScalar(.5*this.size)}},{key:\"getDimensions\",value:function(e){return e.set(this.size,this.size,this.size)}},{key:\"split\",value:function(){var e,t,n=this.min,a=this.getCenter(st),l=.5*this.size,o=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)t=ot[e],o[e]=new this.constructor(new Te(0===t[0]?n.x:a.x,0===t[1]?n.y:a.y,0===t[2]?n.z:a.z),l)}},{key:\"max\",get:function(){return this.min.clone().addScalar(this.size)}}]),t}(),dt=new Te,yt=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Te,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Te;e(this,t),this.min=n,this.max=a,this.children=null}return n(t,[{key:\"getCenter\",value:function(e){return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getDimensions\",value:function(e){return e.subVectors(this.max,this.min)}},{key:\"split\",value:function(){var e,t,n=this.min,a=this.max,l=this.getCenter(dt),o=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)t=ot[e],o[e]=new this.constructor(new Te(0===t[0]?n.x:l.x,0===t[1]?n.y:l.y,0===t[2]?n.z:l.z),new Te(0===t[0]?l.x:a.x,0===t[1]?l.y:a.y,0===t[2]?l.z:a.z))}}]),t}(),ut=function t(n,a,i){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;e(this,t),this.distance=n,this.distanceToRay=a,this.point=i,this.object=l},ct=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],mt=new Te,xt=new v,pt=new v,d=new Qe,r=new function t(){e(this,t),this.value=0},vt=function(){function t(){e(this,t)}return n(t,null,[{key:\"intersectOctree\",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],a=E(e,t,r);null!==a&&D.apply(void 0,[e.root].concat(z(a),[n]))}}]),t}(),gt=new v,kt=function(){function t(n){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;e(this,t),this.octree=n,this.region=a,this.cull=null!==a,this.result=new it,this.trace=null,this.indices=null,this.reset()}return n(t,[{key:\"reset\",value:function(){var e=this.octree.root;return this.trace=[],this.indices=[],null!==e&&(gt.min=e.min,gt.max=e.max,(!this.cull||this.region.intersectsBox(gt))&&(this.trace.push(e),this.indices.push(0))),this.result.reset(),this}},{key:\"next\",value:function(){for(var e,t,n,a=this.cull,i=this.region,l=this.indices,o=this.trace,s=null,r=o.length-1;null===s&&0<=r;)if(e=l[r]++,t=o[r].children,!(8>e))o.pop(),l.pop(),--r;else if(null!==t){if(n=t[e],a&&(gt.min=n.min,gt.max=n.max,!i.intersectsBox(gt)))continue;o.push(n),l.push(0),++r}else s=o.pop(),l.pop();return this.result.value=s,this.result.done=null===s,this.result}},{key:\"return\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),ht=new v,zt=function(){function t(n){e(this,t),this.root=n}return n(t,[{key:\"getCenter\",value:function(e){return this.root.getCenter(e)}},{key:\"getDimensions\",value:function(e){return this.root.getDimensions(e)}},{key:\"cull\",value:function(e){var t=[];return V(this.root,e,t),t}},{key:\"getDepth\",value:function(){return F(this.root)}},{key:\"findNodesByLevel\",value:function(e){var t=[];return L(this.root,e,0,t),t}},{key:\"raycast\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return vt.intersectOctree(this,e.ray,t),t}},{key:\"leaves\",value:function(e){return new kt(this,e)}},{key:Symbol.iterator,value:function(){return new kt(this)}},{key:\"min\",get:function(){return this.root.min}},{key:\"max\",get:function(){return this.root.max}},{key:\"children\",get:function(){return this.root.children}}]),t}(),ft=new Te,p=function(t){function a(t,n){var i;return e(this,a),i=g(this,l(a).call(this,t,n)),i.points=null,i.data=null,i}return i(a,t),n(a,[{key:\"distanceToSquared\",value:function(e){var t=ft.copy(e).clamp(this.min,this.max);return t.sub(e).lengthSquared()}},{key:\"distanceToCenterSquared\",value:function(e){var t=this.getCenter(ft),n=e.x-t.x,a=e.y-t.x,i=e.z-t.z;return n*n+a*a+i*i}},{key:\"contains\",value:function(e,t){var n=this.min,a=this.max;return e.x>=n.x-t&&e.y>=n.y-t&&e.z>=n.z-t&&e.x<=a.x+t&&e.y<=a.y+t&&e.z<=a.z+t}},{key:\"redistribute\",value:function(e){var t,n,a,l,o,s,r,d=this.children,y=this.points,u=this.data;if(null!==d&&null!==y){for(t=0,a=y.length;t<a;++t)for(s=y[t],r=u[t],(n=0,l=d.length);n<l;++n)if(o=d[n],o.contains(s,e)){null===o.points&&(o.points=[],o.data=[]),o.points.push(s),o.data.push(r);break}this.points=null,this.data=null}}},{key:\"merge\",value:function(){var e=this.children;if(null!==e){var t,n,a,o=[],s=[];for(t=0,n=e.length;t<n;++t)a=e[t],null!==a.points&&(o=o.concat(a.points),s=s.concat(a.data));this.children=null,this.points=o,this.data=s}}}]),a}(yt),St=function(t){function a(t,n){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:8;return e(this,a),i=g(this,l(a).call(this,new p(t,n))),i.bias=Se(0,o),i.maxPoints=Se(1,xe(s)),i.maxDepth=Se(0,xe(r)),i.pointCount=0,i}return i(a,t),n(a,[{key:\"countPoints\",value:function(e){return N(e)}},{key:\"insert\",value:function(e,t){return O(e,t,this,this.root,0)}},{key:\"remove\",value:function(e){return B(e,this,this.root,null)}},{key:\"get\",value:function(e){return R(e,this,this.root)}},{key:\"move\",value:function(e,t){return A(e,t,this,this.root,null,0)}},{key:\"findNearestPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0,n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],a=M(e,t,n,this.root);return null!==a&&(a.point=a.point.clone()),a}},{key:\"findPoints\",value:function(e,t){var n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],a=[];return Y(e,t,n,this.root,a),a}},{key:\"raycast\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=h(l(a.prototype),\"raycast\",this).call(this,e);return 0<n.length&&T(n,e,t),t}}]),a}(zt),It=new Te,Ct=new Te,Tt=new Te,wt=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Te,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Te;e(this,t),this.a=n,this.b=a,this.index=-1,this.coordinates=new Te,this.t=0,this.n=new Te}return n(t,[{key:\"approximateZeroCrossing\",value:function(e){var t,n,l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,o=Se(1,l-1),s=0,r=1,d=0,y=0;for(It.subVectors(this.b,this.a);y<=o&&(d=(s+r)/2,Ct.addVectors(this.a,Tt.copy(It).multiplyScalar(d)),n=e.sample(Ct),!(ze(n)<=1e-4||(r-s)/2<=1e-6));)Ct.addVectors(this.a,Tt.copy(It).multiplyScalar(s)),t=e.sample(Ct),ue(n)===ue(t)?s=d:r=d,++y;this.t=d}},{key:\"computeZeroCrossingPosition\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Te;return e.subVectors(this.b,this.a).multiplyScalar(this.t).add(this.a)}},{key:\"computeSurfaceNormal\",value:function(e){var t=this.computeZeroCrossingPosition(It),n=1e-3,a=e.sample(Ct.addVectors(t,Tt.set(n,0,0)))-e.sample(Ct.subVectors(t,Tt.set(n,0,0))),i=e.sample(Ct.addVectors(t,Tt.set(0,n,0)))-e.sample(Ct.subVectors(t,Tt.set(0,n,0))),l=e.sample(Ct.addVectors(t,Tt.set(0,0,n)))-e.sample(Ct.subVectors(t,Tt.set(0,0,n)));this.n.set(a,i,l).normalize()}}]),t}(),Pt=new wt,bt=new Te,Et=new Te,Dt=function(){function t(n,a,i){var l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:3;e(this,t),this.edgeData=n,this.cellPosition=a,this.cellSize=i,this.indices=null,this.zeroCrossings=null,this.normals=null,this.axes=null,this.lengths=null,this.result=new it,this.initialC=l,this.c=l,this.initialD=o,this.d=o,this.i=0,this.l=0,this.reset()}return n(t,[{key:\"reset\",value:function(){var e,t,n,i,o=this.edgeData,s=[],r=[],y=[],u=[],m=[];for(this.i=0,this.c=0,this.d=0,(t=this.initialC,e=4>>t,n=this.initialD);t<n;++t,e>>=1)i=o.indices[t].length,0<i&&(s.push(o.indices[t]),r.push(o.zeroCrossings[t]),y.push(o.normals[t]),u.push(ot[e]),m.push(i),++this.d);return this.l=0<m.length?m[0]:0,this.indices=s,this.zeroCrossings=r,this.normals=y,this.axes=u,this.lengths=m,this.result.reset(),this}},{key:\"next\",value:function(){var e,t,a,l,o,r,d,u=this.cellSize,s=this.edgeData.resolution,n=s+1,m=n*n,p=this.result,v=this.cellPosition;return this.i===this.l&&(this.l=++this.c<this.d?this.lengths[this.c]:0,this.i=0),this.i<this.l?(r=this.c,d=this.i,e=this.axes[r],t=this.indices[r][d],Pt.index=t,a=t%n,l=ye(t%m/n),o=ye(t/m),Pt.coordinates.set(a,l,o),bt.set(a*u/s,l*u/s,o*u/s),Et.set((a+e[0])*u/s,(l+e[1])*u/s,(o+e[2])*u/s),Pt.a.addVectors(v,bt),Pt.b.addVectors(v,Et),Pt.t=this.zeroCrossings[r][d],Pt.n.fromArray(this.normals[r],3*d),p.value=Pt,++this.i):(p.value=null,p.done=!0),p}},{key:\"return\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),Ft=function(){function t(a){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:n;e(this,t),this.resolution=a,this.indices=0>=n?null:[new Uint32Array(n),new Uint32Array(i),new Uint32Array(l)],this.zeroCrossings=0>=n?null:[new Float32Array(n),new Float32Array(i),new Float32Array(l)],this.normals=0>=n?null:[new Float32Array(3*n),new Float32Array(3*i),new Float32Array(3*l)]}return n(t,[{key:\"serialize\",value:function(){return{resolution:this.resolution,edges:this.edges,zeroCrossings:this.zeroCrossings,normals:this.normals}}},{key:\"deserialize\",value:function(e){var t=this;return null===e?t=null:(this.resolution=e.resolution,this.edges=e.edges,this.zeroCrossings=e.zeroCrossings,this.normals=e.normals),t}},{key:\"createTransferList\",value:function(){var e,t,n,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],o=[this.edges[0],this.edges[1],this.edges[2],this.zeroCrossings[0],this.zeroCrossings[1],this.zeroCrossings[2],this.normals[0],this.normals[1],this.normals[2]];for(t=0,n=o.length;t<n;++t)e=o[t],null!==e&&a.push(e.buffer);return a}},{key:\"edges\",value:function(e,t){return new Dt(this,e,t)}},{key:\"edgesX\",value:function(e,t){return new Dt(this,e,t,0,1)}},{key:\"edgesY\",value:function(e,t){return new Dt(this,e,t,1,2)}},{key:\"edgesZ\",value:function(e,t){return new Dt(this,e,t,2,3)}}],[{key:\"calculate1DEdgeCount\",value:function(e){return de(e+1,2)*e}}]),t}(),Vt=0,Lt=0,Nt=0,qt=function(){function t(){var n=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];e(this,t),this.materials=0,this.materialIndices=n?new Uint8Array(Nt):null,this.runLengths=null,this.edgeData=null}return n(t,[{key:\"set\",value:function(e){return this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,this.edgeData=e.edgeData,this}},{key:\"clear\",value:function(){return this.materials=0,this.materialIndices=null,this.runLengths=null,this.edgeData=null,this}},{key:\"setMaterialIndex\",value:function(e,t){this.materialIndices[e]===We.AIR?t!==We.AIR&&++this.materials:t===We.AIR&&--this.materials,this.materialIndices[e]=t}},{key:\"compress\",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this;return this.compressed?(t.materialIndices=this.materialIndices,t.runLengths=this.runLengths):(e=this.full?new at([this.materialIndices.length],[We.SOLID]):at.encode(this.materialIndices),t.materialIndices=new Uint8Array(e.data),t.runLengths=new Uint32Array(e.runLengths)),t.materials=this.materials,t}},{key:\"decompress\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this;return e.materialIndices=this.compressed?at.decode(this.runLengths,this.materialIndices,new Uint8Array(Nt)):this.materialIndices,e.runLengths=null,e.materials=this.materials,e}},{key:\"serialize\",value:function(){return{materials:this.materials,materialIndices:this.materialIndices,runLengths:this.runLengths,edgeData:null===this.edgeData?null:this.edgeData.serialize()}}},{key:\"deserialize\",value:function(e){var t=this;return null===e?t=null:(this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,null===e.edgeData?this.edgeData=null:(null===this.edgeData&&(this.edgeData=new Ft(Lt)),this.edgeData.deserialize(e.edgeData))),t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.edgeData&&this.edgeData.createTransferList(e),null!==this.materialIndices&&e.push(this.materialIndices.buffer),null!==this.runLengths&&e.push(this.runLengths.buffer),e}},{key:\"empty\",get:function(){return 0===this.materials}},{key:\"full\",get:function(){return this.materials===Nt}},{key:\"compressed\",get:function(){return null!==this.runLengths}},{key:\"neutered\",get:function(){return!this.empty&&null===this.materialIndices}}],[{key:\"isovalue\",get:function(){return Vt},set:function(e){Vt=e}},{key:\"resolution\",get:function(){return Lt},set:function(e){var t=Math.log2;e=de(2,Se(0,he(t(e)))),Lt=Se(1,Ie(256,e)),Nt=de(Lt+1,3)}}]),t}(),Ot=function(t){function a(t){var n;return e(this,a),n=g(this,l(a).call(this,Ce.DENSITY_FUNCTION)),n.sdf=t,n}return i(a,t),n(a,[{key:\"computeBoundingBox\",value:function(){return this.sdf.getBoundingBox(!0)}},{key:\"generateMaterialIndex\",value:function(e){return this.sdf.sample(e)<=qt.isovalue?this.sdf.material:We.AIR}},{key:\"generateEdge\",value:function(e){e.approximateZeroCrossing(this.sdf),e.computeSurfaceNormal(this.sdf)}}]),a}($e),Bt=new c,Rt=function(){function t(n){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:We.SOLID;e(this,t),this.type=n,this.operation=null,this.material=Ie(255,Se(We.SOLID,ye(a))),this.boundingBox=null,this.position=new Te,this.quaternion=new Oe,this.scale=new Te(1,1,1),this.inverseTransformation=new c,this.updateInverseTransformation(),this.children=[]}return n(t,[{key:\"getTransformation\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new c;return e.compose(this.position,this.quaternion,this.scale)}},{key:\"getBoundingBox\",value:function(){var e,t,n=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],a=this.children,o=this.boundingBox;if(null===o&&(o=this.computeBoundingBox(),this.boundingBox=o),n)for(o=o.clone(),e=0,t=a.length;e<t;++e)o.union(a[e].getBoundingBox(n));return o}},{key:\"setMaterial\",value:function(e){return this.material=Ie(255,Se(We.SOLID,ye(e))),this}},{key:\"setOperationType\",value:function(e){return this.operation=e,this}},{key:\"updateInverseTransformation\",value:function(){return this.inverseTransformation.getInverse(this.getTransformation(Bt)),this.boundingBox=null,this}},{key:\"union\",value:function(e){return this.children.push(e.setOperationType(Ce.UNION)),this}},{key:\"subtract\",value:function(e){return this.children.push(e.setOperationType(Ce.DIFFERENCE)),this}},{key:\"intersect\",value:function(e){return this.children.push(e.setOperationType(Ce.INTERSECTION)),this}},{key:\"toCSG\",value:function(){var e,t,n,a,o=this.children,s=new Ot(this);for(n=0,a=o.length;n<a;++n)t=o[n],e!==t.operation&&(e=t.operation,e===Ce.UNION?s=new et(s):e===Ce.DIFFERENCE?s=new tt(s):e===Ce.INTERSECTION?s=new nt(s):void 0),s.children.push(t.toCSG());return s}},{key:\"serialize\",value:function(){var e,t,n=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],a={type:this.type,operation:this.operation,material:this.material,position:this.position.toArray(),quaternion:this.quaternion.toArray(),scale:this.scale.toArray(),parameters:null,children:[]};for(e=0,t=this.children.length;e<t;++e)a.children.push(this.children[e].serialize(n));return a}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e}},{key:\"toJSON\",value:function(){return this.serialize(!0)}},{key:\"computeBoundingBox\",value:function(){throw new Error(\"SignedDistanceFunction#computeBoundingBox method not implemented!\")}},{key:\"sample\",value:function(){throw new Error(\"SignedDistanceFunction#sample method not implemented!\")}}]),t}(),At={HEIGHTFIELD:\"sdf.heightfield\",FRACTAL_NOISE:\"sdf.fractalnoise\",SUPER_PRIMITIVE:\"sdf.superprimitive\"},Mt=function(t){function a(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=1<arguments.length?arguments[1]:void 0;return e(this,a),t=g(this,l(a).call(this,At.SUPER_PRIMITIVE,i)),t.s0=u(Je,z(n.s)),t.r0=u(Te,z(n.r)),t.s=new Je,t.r=new Te,t.ba=new De,t.offset=0,t.precompute(),t}return i(a,t),n(a,[{key:\"setSize\",value:function(e,t,n,a){return this.s0.set(e,t,n,a),this.precompute()}},{key:\"setRadii\",value:function(e,t,n){return this.r0.set(e,t,n),this.precompute()}},{key:\"precompute\",value:function(){var e=this.s.copy(this.s0),t=this.r.copy(this.r0),n=this.ba;e.x-=t.x,e.y-=t.x,t.x-=e.w,e.w-=t.y,e.z-=t.y,this.offset=-2*e.z,n.set(t.z,this.offset);var a=n.dot(n);return 0===a?n.set(0,-1):n.divideScalar(a),this}},{key:\"computeBoundingBox\",value:function(){var e=this.s0,t=new v;return t.min.x=Ie(-e.x,-1),t.min.y=Ie(-e.y,-1),t.min.z=Ie(-e.z,-1),t.max.x=Se(e.x,1),t.max.y=Se(e.y,1),t.max.z=Se(e.z,1),t.applyMatrix4(this.getTransformation()),t}},{key:\"sample\",value:function(e){e.applyMatrix4(this.inverseTransformation);var t=this.s,n=this.r,a=this.ba,i=ze(e.x)-t.x,l=ze(e.y)-t.y,o=ze(e.z)-t.z,s=Se(i,0),r=Se(l,0),d=fe(s*s+r*r),y=e.z-t.z,u=ze(d+Ie(0,Se(i,l))-n.x)-t.w,m=Ie(Se(u*a.x+y*a.y,0),1),c=u-n.z*m,x=y-this.offset*m,p=Se(u-n.z,0),v=e.z+t.z,g=Se(u,0),k=u*-a.y+y*a.x,h=fe(Ie(c*c+x*x,Ie(p*p+v*v,g*g+y*y)));return h*ue(Se(k,o))-n.y}},{key:\"serialize\",value:function(){var e=h(l(a.prototype),\"serialize\",this).call(this);return e.parameters={s:this.s0.toArray(),r:this.r0.toArray()},e}}],[{key:\"create\",value:function(e){var t=Yt[e];return new a({s:t[0],r:t[1]})}}]),a}(Rt),Yt=[[new Float32Array([1,1,1,1]),new Float32Array([0,0,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,0,0])],[new Float32Array([0,0,1,1]),new Float32Array([0,0,1])],[new Float32Array([1,1,2,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,.25,1]),new Float32Array([1,.25,0])],[new Float32Array([1,1,.25,.25]),new Float32Array([1,.25,0])],[new Float32Array([1,1,1,.25]),new Float32Array([1,.1,0])],[new Float32Array([1,1,1,.25]),new Float32Array([.1,.1,0])]],Xt={CUBE:0,CYLINDER:1,CONE:2,PILL:3,SPHERE:4,PELLET:5,TORUS:6,PIPE:7,CORRIDOR:8},Zt=function(){function t(n,a,i,l,o){e(this,t),this.indices=n,this.positions=a,this.normals=i,this.uvs=l,this.materials=o}return n(t,[{key:\"serialize\",value:function(){return{indices:this.indices,positions:this.positions,normals:this.normals,uvs:this.uvs,materials:this.materials}}},{key:\"deserialize\",value:function(e){var t=this;return null===e?t=null:(this.indices=e.indices,this.positions=e.positions,this.normals=e.normals,this.uvs=e.uvs,this.materials=e.materials),t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.indices.buffer),e.push(this.positions.buffer),e.push(this.normals.buffer),e.push(this.uvs.buffer),e.push(this.materials.buffer),e}}]),t}(),Ut=[new Uint8Array([0,4,0]),new Uint8Array([1,5,0]),new Uint8Array([2,6,0]),new Uint8Array([3,7,0]),new Uint8Array([0,2,1]),new Uint8Array([4,6,1]),new Uint8Array([1,3,1]),new Uint8Array([5,7,1]),new Uint8Array([0,1,2]),new Uint8Array([2,3,2]),new Uint8Array([4,5,2]),new Uint8Array([6,7,2])],jt=[new Uint8Array([0,1,2,3,0]),new Uint8Array([4,5,6,7,0]),new Uint8Array([0,4,1,5,1]),new Uint8Array([2,6,3,7,1]),new Uint8Array([0,2,4,6,2]),new Uint8Array([1,3,5,7,2])],_t=[[new Uint8Array([4,0,0]),new Uint8Array([5,1,0]),new Uint8Array([6,2,0]),new Uint8Array([7,3,0])],[new Uint8Array([2,0,1]),new Uint8Array([6,4,1]),new Uint8Array([3,1,1]),new Uint8Array([7,5,1])],[new Uint8Array([1,0,2]),new Uint8Array([3,2,2]),new Uint8Array([5,4,2]),new Uint8Array([7,6,2])]],Gt=[[new Uint8Array([1,4,0,5,1,1]),new Uint8Array([1,6,2,7,3,1]),new Uint8Array([0,4,6,0,2,2]),new Uint8Array([0,5,7,1,3,2])],[new Uint8Array([0,2,3,0,1,0]),new Uint8Array([0,6,7,4,5,0]),new Uint8Array([1,2,0,6,4,2]),new Uint8Array([1,3,1,7,5,2])],[new Uint8Array([1,1,0,3,2,0]),new Uint8Array([1,5,4,7,6,0]),new Uint8Array([0,1,5,0,4,1]),new Uint8Array([0,3,7,2,6,1])]],Qt=[[new Uint8Array([3,2,1,0,0]),new Uint8Array([7,6,5,4,0])],[new Uint8Array([5,1,4,0,1]),new Uint8Array([7,3,6,2,1])],[new Uint8Array([6,4,2,0,2]),new Uint8Array([7,5,3,1,2])]],Ht=[new Uint8Array([3,2,1,0]),new Uint8Array([7,5,6,4]),new Uint8Array([11,10,9,8])],Kt=de(2,16)-1,Jt=function(){function t(){e(this,t)}return n(t,null,[{key:\"run\",value:function(e){var t=[],n=e.voxelCount,a=null,i=null,l=null,o=null,s=null;return n>Kt?console.warn(\"Could not create geometry for cell at position\",e.min,\"(vertex count of\",n,\"exceeds limit of \",Kt,\")\"):0<n&&(i=new Float32Array(3*n),l=new Float32Array(3*n),o=new Float32Array(2*n),s=new Uint8Array(n),_(e.root,i,l,0),j(e.root,t),a=new Zt(new Uint16Array(t),i,l,o,s)),a}}]),t}(),Wt=new De,$t=function(){function t(){e(this,t)}return n(t,null,[{key:\"calculateCoefficients\",value:function(e,t,n){var a,i,l;return 0===t?(Wt.x=1,Wt.y=0):(a=(n-e)/(2*t),i=fe(1+a*a),l=1/(0<=a?a+i:a-i),Wt.x=1/fe(1+l*l),Wt.y=l*Wt.x),Wt}}]),t}(),en=function(){function t(){e(this,t)}return n(t,null,[{key:\"rotateXY\",value:function(e,t){var n=t.x,a=t.y,i=e.x,l=e.y;e.set(n*i-a*l,a*i+n*l)}},{key:\"rotateQXY\",value:function(e,t,n){var a=n.x,i=n.y,l=a*a,o=i*i,s=2*a*i*t,r=e.x,d=e.y;e.set(l*r-s+o*d,o*r+s+l*d)}}]),t}(),tn=.1,nn=new Ke,an=new Ne,ln=new De,on=new Te,sn=function(){function t(){e(this,t)}return n(t,null,[{key:\"solve\",value:function(e,t,n){var a=K(nn.copy(e),an.identity()),i=W(an,a);n.copy(t).applyMatrix3(i)}}]),t}(),rn=new Te,dn=function(){function t(){e(this,t),this.data=null,this.ata=new Ke,this.atb=new Te,this.massPoint=new Te,this.hasSolution=!1}return n(t,[{key:\"setData\",value:function(e){return this.data=e,this.hasSolution=!1,this}},{key:\"solve\",value:function(e){var t=this.data,n=this.massPoint,a=this.ata.copy(t.ata),i=this.atb.copy(t.atb),l=1/0;return!this.hasSolution&&null!==t&&0<t.numPoints&&(rn.copy(t.massPointSum).divideScalar(t.numPoints),n.copy(rn),a.applyToVector3(rn),i.sub(rn),sn.solve(a,i,e),l=$(a,i,e),e.add(n),this.hasSolution=!0),l}}]),t}(),yn=function(){function t(){e(this,t),this.ata=new Ke,this.ata.set(0,0,0,0,0,0),this.atb=new Te,this.massPointSum=new Te,this.numPoints=0}return n(t,[{key:\"set\",value:function(e,t,n,a){return this.ata.copy(e),this.atb.copy(t),this.massPointSum.copy(n),this.numPoints=a,this}},{key:\"copy\",value:function(e){return this.set(e.ata,e.atb,e.massPointSum,e.numPoints)}},{key:\"add\",value:function(e,t){var n=t.x,a=t.y,i=t.z,l=e.dot(t),o=this.ata.elements,s=this.atb;o[0]+=n*n,o[1]+=n*a,o[3]+=a*a,o[2]+=n*i,o[4]+=a*i,o[5]+=i*i,s.x+=l*n,s.y+=l*a,s.z+=l*i,this.massPointSum.add(e),++this.numPoints}},{key:\"addData\",value:function(e){this.ata.add(e.ata),this.atb.add(e.atb),this.massPointSum.add(e.massPointSum),this.numPoints+=e.numPoints}},{key:\"clear\",value:function(){this.ata.set(0,0,0,0,0,0),this.atb.set(0,0,0),this.massPointSum.set(0,0,0),this.numPoints=0}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}}]),t}(),un=function t(){e(this,t),this.materials=0,this.edgeCount=0,this.index=-1,this.position=new Te,this.normal=new Te,this.qefData=null},cn=new dn,mn=.1,xn=-1,pn=function(t){function a(t,n){var i;return e(this,a),i=g(this,l(a).call(this,t,n)),i.voxel=null,i}return i(a,t),n(a,[{key:\"contains\",value:function(e){var t=this.min,n=this.size;return e.x>=t.x-mn&&e.y>=t.y-mn&&e.z>=t.z-mn&&e.x<=t.x+n+mn&&e.y<=t.y+n+mn&&e.z<=t.z+n+mn}},{key:\"collapse\",value:function(){var e,t,n,a,l,o,s,r=this.children,d=[-1,-1,-1,-1,-1,-1,-1,-1],y=new Te,u=-1,c=null!==r,m=0;if(c){for(a=new yn,o=0,s=0;8>s;++s)e=r[s],m+=e.collapse(),n=e.voxel,null===e.children?null!==n&&(a.addData(n.qefData),u=1&n.materials>>7-s,d[s]=1&n.materials>>s,++o):c=!1;if(c&&(l=cn.setData(a).solve(y),l<=xn)){for(n=new un,n.position.copy(this.contains(y)?y:cn.massPoint),s=0;8>s;++s)t=d[s],e=r[s],-1===t?n.materials|=u<<s:(n.materials|=t<<s,n.normal.add(e.voxel.normal));n.normal.normalize(),n.qefData=a,this.voxel=n,this.children=null,m+=o-1}}return m}}],[{key:\"errorThreshold\",get:function(){return xn},set:function(e){xn=e}}]),a}(rt),vn=function(t){function a(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Te,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return e(this,a),n=g(this,l(a).call(this)),n.root=new pn(i,o),n.voxelCount=0,null!==t&&null!==t.edgeData&&n.construct(t),0<=pn.errorThreshold&&n.simplify(),n}return i(a,t),n(a,[{key:\"simplify\",value:function(){this.voxelCount-=this.root.collapse()}},{key:\"construct\",value:function(e){var t,a,l,o,s,r,u,c,m,p,v,g=qt.resolution,n=e.edgeData,k=e.materialIndices,h=new dn,f=new Te,S=[n.edgesX(this.min,this.root.size),n.edgesY(this.min,this.root.size),n.edgesZ(this.min,this.root.size)],I=[new Uint8Array([0,1,2,3]),new Uint8Array([0,1,4,5]),new Uint8Array([0,2,4,6])],C=0;for(p=0;3>p;++p){l=I[p],t=S[p];var T=!0,w=!1,P=void 0;try{for(var b,E=t[Symbol.iterator]();!(T=(b=E.next()).done);T=!0)for(a=b.value,a.computeZeroCrossingPosition(f),v=0;4>v;++v)o=ot[l[v]],u=a.coordinates.x-o[0],c=a.coordinates.y-o[1],m=a.coordinates.z-o[2],0<=u&&0<=c&&0<=m&&u<g&&c<g&&m<g&&(s=ee(this.root,g,u,c,m),null===s.voxel&&(s.voxel=te(g,u,c,m,k),++C),r=s.voxel,r.normal.add(a.n),r.qefData.add(f,a.n),r.qefData.numPoints===r.edgeCount&&(h.setData(r.qefData).solve(r.position),!s.contains(r.position)&&r.position.copy(h.massPoint),r.normal.normalize()))}catch(e){w=!0,P=e}finally{try{T||null==E[\"return\"]||E[\"return\"]()}finally{if(w)throw P}}}this.voxelCount=C}}]),a}(zt),gn=0,kn=new Te,hn=function(){function t(){e(this,t)}return n(t,null,[{key:\"run\",value:function(e,t,n,a){kn.fromArray(e),gn=t,null===n?a.operation===Ce.UNION&&(n=new qt(!1)):n.decompress();var i=a.toCSG(),l=null===n?null:re(i);if(null!==l){switch(a.operation){case Ce.UNION:i=new et(i);break;case Ce.DIFFERENCE:i=new tt(i);break;case Ce.INTERSECTION:i=new nt(i);}se(i,n,l),n.contoured=!1}return null!==n&&n.empty?null:n}}]),t}(),zn=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:\"Report\";e(this,t),this.name=n,this.lines=[],this.data=[]}return n(t,[{key:\"clear\",value:function(){this.data=[]}},{key:\"addLine\",value:function(e){this.lines.push(e)}},{key:\"addValue\",value:function(e){this.data.push(e)}},{key:\"toString\",value:function(){var e,t,n=this.lines,a=this.data,o=this.name+\"\\n\\n\";for(e=0,t=n.length;e<t;++e)o+=n[e]+\"\\n\";for(o+=\"\\nValues:\\n\",o+=\"i, ms\\n\",(e=0,t=a.length);e<t;++e)o+=e+1+\", \"+a[e]+\"\\n\";return o}}]),t}(),fn=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;e(this,t),this.name=n}return n(t,[{key:\"initialize\",value:function(){throw new Error(\"Test#initialize method not implemented!\")}},{key:\"clear\",value:function(){throw new Error(\"Test#clear method not implemented!\")}},{key:\"run\",value:function(){throw new Error(\"Test#run method not implemented!\")}}]),t}(),Sn=function(t){function a(){var t;return e(this,a),t=g(this,l(a).call(this,\"Compression Test\")),t.data=null,t.targetContainer=new qt(!1),t}return i(a,t),n(a,[{key:\"initialize\",value:function(){var e=1/2,t=Mt.create(Xt.PIPE);return t.scale.set(.475,.475,.475),t.updateInverseTransformation(),this.data=hn.run([-e,-e,-e],1,null,t.setOperationType(Ce.UNION)),this}},{key:\"clear\",value:function(){return this.data=null,this.targetContainer.clear(),this}},{key:\"run\",value:function(){var e,t,a,l,o,s,r,d=new zn(\"Compression Report\"),y=this.targetContainer,u=this.data,c=qt.resolution,n=de(c+1,3),m=3*de(c+1,2)*c;for(d.addLine(\"Performing 200 compression tasks\"),r=0;200>r;++r)s=performance.now(),u.compress(y),d.addValue(performance.now()-s);return t=y.materials,a=y.materialIndices.length,l=y.runLengths.length,e=u.edgeData,o=e.indices[0].length+e.indices[1].length+e.indices[2].length,d.addLine(\"Material Statistics\"),d.addLine(\"Total Materials: \"+n+\" (\"+t+\" solid)\"),d.addLine(\"Compressed Materials: \"+a+\" (+ \"+l+\" run-lengths)\"),d.addLine(\"Compression Ratio: \"+(n/(a+4*l)).toFixed(2)),d.addLine(\"Space Savings: \"+(100*(1-(a+4*l)/n)).toFixed(2)+\"%\"),d.addLine(\"Maximum Memory Usage: \"+(8*n/8/1024).toFixed(2)+\" KB\"),d.addLine(\"Estimated Memory Usage: \"+((8*a+32*l)/8/1024).toFixed(2)+\" KB\\n\"),d.addLine(\"Edge Data Statistics\"),d.addLine(\"Total Edges: \"+o+\" (\"+m+\" max)\"),d.addLine(\"Compression Ratio: \"+(m/o).toFixed(2)),d.addLine(\"Space Savings: \"+(100*(1-o/m)).toFixed(2)+\"%\"),d.addLine(\"Maximum Memory Usage: \"+((32*m+32*m+32*(3*m))/8/1024/1024).toFixed(2)+\" MB\"),d.addLine(\"Estimated Memory Usage: \"+((32*o+32*o+32*(3*o))/8/1024).toFixed(2)+\" KB\"),console.log(\"Compressed data\",y),d}}]),a}(fn),In=function(t){function a(){var t;return e(this,a),t=g(this,l(a).call(this,\"Decompression Test\")),t.data=null,t.targetContainer=new qt(!1),t}return i(a,t),n(a,[{key:\"initialize\",value:function(){var e=1/2,t=Mt.create(Xt.PIPE);return t.scale.set(.475,.475,.475),t.updateInverseTransformation(),this.data=hn.run([-e,-e,-e],1,null,t.setOperationType(Ce.UNION)),this.data.compress(),this}},{key:\"clear\",value:function(){return this.data=null,this.targetContainer.clear(),this}},{key:\"run\",value:function(){var e,t,n=new zn(\"Decompression Report\"),a=this.targetContainer,l=this.data;for(n.addLine(\"Performing 200 decompression tasks\"),t=0;200>t;++t)e=performance.now(),l.decompress(a),n.addValue(performance.now()-e);return console.log(\"Decompressed data\",a),n}}]),a}(fn),Cn=function(t){function a(){var t;return e(this,a),t=g(this,l(a).call(this,\"CSG Test\")),t.data=null,t.cellSize=1,t.cellPosition=[-.5,-.5,-.5],t.sdf=null,t}return i(a,t),n(a,[{key:\"initialize\",value:function(){var e=Mt.create(Xt.PELLET).setOperationType(Ce.UNION),t=Mt.create(Xt.PIPE).setOperationType(Ce.UNION);return e.scale.set(.475,.475,.475),e.updateInverseTransformation(),t.scale.set(.475,.475,.475),t.updateInverseTransformation(),this.data=hn.run(this.cellPosition,this.cellSize,null,e),this.sdf=t,this}},{key:\"clear\",value:function(){return this.data=null,this.sdf=null,this}},{key:\"run\",value:function(){var e,t,n,a=new zn(\"CSG Report\"),l=this.cellPosition,o=this.cellSize,s=this.data,r=this.sdf;for(a.addLine(\"Executing 200 CSG Union operations on existing data\"),a.addLine(\"Initial material count: \"+s.materials),a.addLine(\"Initial edge count: \"+(s.edgeData.indices[0].length+s.edgeData.indices[1].length+s.edgeData.indices[2].length)),n=0;200>n;++n)t=performance.now(),e=hn.run(l,o,s,r),a.addValue(performance.now()-t);return a.addLine(\"Final material count: \"+e.materials),a.addLine(\"Final edge count: \"+(e.edgeData.indices[0].length+e.edgeData.indices[1].length+e.edgeData.indices[2].length)),console.log(\"Generated data\",e),a}}]),a}(fn),Tn=function(t){function a(){var t;return e(this,a),t=g(this,l(a).call(this,\"SVO Test\")),t.data=null,t.cellSize=1,t.cellPosition=new Te(-.5,-.5,-.5),t}return i(a,t),n(a,[{key:\"initialize\",value:function(){var e=Mt.create(Xt.PIPE);return e.scale.set(.475,.475,.475),e.updateInverseTransformation(),pn.errorThreshold=.01,this.data=hn.run(this.cellPosition.toArray(),this.cellSize,null,e.setOperationType(Ce.UNION)),this}},{key:\"clear\",value:function(){return this.data=null,this}},{key:\"run\",value:function(){var e,t,n,a=new zn(\"SVO Report\"),l=this.cellPosition,o=this.cellSize,s=this.data;for(a.addLine(\"Building 200 sparse voxel octrees\"),a.addLine(\"Material count: \"+s.materials),a.addLine(\"Edge count: \"+(s.edgeData.indices[0].length+s.edgeData.indices[1].length+s.edgeData.indices[2].length)),n=0;200>n;++n)t=performance.now(),e=new vn(s,l,o),a.addValue(performance.now()-t);return a.addLine(\"Final voxel count: \"+e.voxelCount),console.log(\"Sparse voxel octree\",e),a}}]),a}(fn),wn=function(t){function a(){var t;return e(this,a),t=g(this,l(a).call(this,\"Contouring Test\")),t.svo=null,t}return i(a,t),n(a,[{key:\"initialize\",value:function(){var e=1/2,t=new Te(-e,-e,-e),n=Mt.create(Xt.PIPE);return n.scale.set(.475,.475,.475),n.updateInverseTransformation(),pn.errorThreshold=.01,this.svo=new vn(hn.run(t.toArray(),1,null,n.setOperationType(Ce.UNION)),t,1),this}},{key:\"clear\",value:function(){return this.svo=null,this}},{key:\"run\",value:function(){var e,t,n,a=new zn(\"Contouring Report\"),l=this.svo;for(a.addLine(\"Performing 200 contouring tasks\"),a.addLine(\"Voxel count: \"+l.voxelCount),n=0;200>n;++n)t=performance.now(),e=Jt.run(l),a.addValue(performance.now()-t);return a.addLine(\"Generated vertices: \"+e.positions.length/3),a.addLine(\"Generated triangle indices: \"+e.indices.length),console.log(\"Extracted isosurface\",e),a}}]),a}(fn),Pn={CONFIGURE:\"worker.config\",TEST:\"worker.test\"},bn=new Map([[\"Compression\",new Sn],[\"Decompression\",new In],[\"Contouring\",new wn],[\"CSG\",new Cn],[\"SVO\",new Tn]]);self.addEventListener(\"message\",function(e){var t,n,a=e.data;switch(a.action){case Pn.CONFIGURE:{qt.resolution=a.resolution,console.log(\"Setting Hermite data resolution to\",a.resolution);break}case Pn.TEST:{t=bn.get(a.id).initialize(),n=t.run(),t.clear(),postMessage({reportName:n.name,reportURL:URL.createObjectURL(new Blob([n.toString()],{type:\"text/plain\"}))});break}}})})();\n"],{type:"text/javascript"})),u=null,o=["Compression","Decompression","Contouring","CSG","SVO"];window.addEventListener("load",function e(){window.removeEventListener("load",e),document.getElementById("resolution").addEventListener("change",t),u=new Worker(a),u.addEventListener("message",s),u.addEventListener("error",s),u.postMessage({action:r.CONFIGURE,resolution:64}),i()})})();
