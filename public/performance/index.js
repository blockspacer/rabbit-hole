(function () {
	'use strict';

	var Action = {
	  CONFIGURE: "worker.config",
	  TEST: "worker.test"
	};

	var workerCode = "function _typeof(e){return _typeof=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},_typeof(e)}(function(){'use strict';var $=Math.pow,ee=Math.trunc,ae=Math.sign,te=Math.PI,ne=Math.atan2,ie=Math.round,le=Math.acos,oe=Math.sqrt,se=Math.cos,re=Math.sin,ye=Math.floor,de=Math.ceil,ue=Math.abs,ce=Math.max,me=Math.min;function e(e,a){if(!(e instanceof a))throw new TypeError(\"Cannot call a class as a function\")}function t(e,a){for(var t,n=0;n<a.length;n++)t=a[n],t.enumerable=t.enumerable||!1,t.configurable=!0,\"value\"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}function n(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}function i(e,a){if(\"function\"!=typeof a&&null!==a)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),a&&s(e,a)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function s(e,a){return s=Object.setPrototypeOf||function(e,a){return e.__proto__=a,e},s(e,a)}function y(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function d(){return d=y()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var a=Function.bind.apply(e,i),l=new a;return n&&s(l,n.prototype),l},d.apply(null,arguments)}function u(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}function x(e,a){return a&&(\"object\"===_typeof(a)||\"function\"==typeof a)?a:u(e)}function k(e,a){for(;!Object.prototype.hasOwnProperty.call(e,a)&&(e=l(e),null!==e););return e}function g(e,a,t){return g=\"undefined\"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,a,t){var n=k(e,a);if(n){var i=Object.getOwnPropertyDescriptor(n,a);return i.get?i.get.call(t):i.value}},g(e,a,t||e)}function z(e){return h(e)||f(e)||S()}function h(e){if(Array.isArray(e)){for(var a=0,t=Array(e.length);a<e.length;a++)t[a]=e[a];return t}}function f(e){if(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e))return Array.from(e)}function S(){throw new TypeError(\"Invalid attempt to spread non-iterable instance\")}function I(e,a,t){return ce(me(e,t),a)}function C(e,a,t,n,i,l){var o=0;return e>a&&e>t?(i<e&&(o|=2),l<e&&(o|=1)):a>t?(n<a&&(o|=4),l<a&&(o|=1)):(n<t&&(o|=4),i<t&&(o|=2)),o}function w(e,a,t,n){var i,l=0;return a<t?(i=a,l=0):(i=t,l=1),n<i&&(l=2),r[e][l]}function T(e,a,t,n,i,l,o,s,r){var y,d,u,c,m=e.children;if(0<=i&&0<=l&&0<=o)if(null===m)r.push(e);else{d=.5*(a+i),u=.5*(t+l),c=.5*(n+o),y=C(a,t,n,d,u,c);do 0===y?(T(m[oa],a,t,n,d,u,c,s,r),y=w(y,d,u,c)):1===y?(T(m[1^oa],a,t,c,d,u,o,s,r),y=w(y,d,u,o)):2===y?(T(m[2^oa],a,u,n,d,l,c,s,r),y=w(y,d,l,c)):3===y?(T(m[3^oa],a,u,c,d,l,o,s,r),y=w(y,d,l,o)):4===y?(T(m[4^oa],d,t,n,i,u,c,s,r),y=w(y,i,u,c)):5===y?(T(m[5^oa],d,t,c,i,u,o,s,r),y=w(y,i,u,o)):6===y?(T(m[6^oa],d,u,n,i,l,c,s,r),y=w(y,i,l,c)):7===y?(T(m[7^oa],d,u,c,i,l,o,s,r),y=8):void 0;while(8>y)}}function P(e){var a,t,n,o=e.children,s=0;if(null!==o)for(a=0,t=o.length;a<t;++a)n=1+P(o[a]),n>s&&(s=n);return s}function E(e,a,t){var n,o,s=e.children;if(ra.min=e.min,ra.max=e.max,a.intersectsBox(ra))if(null!==s)for(n=0,o=s.length;n<o;++n)E(s[n],a,t);else t.push(e)}function D(e,a,t,n){var o,s,r=e.children;if(t===a)n.push(e);else if(null!==r)for(++t,o=0,s=r.length;o<s;++o)D(r[o],a,t,n)}function F(e,a,t){var n,l,o,s,r,y,d,u=[-1,-1,-1,-1],c=[!1,!1,!1,!1],m=1/0,x=0,p=!1;for(d=0;4>d;++d)r=e[d],y=Oa[a][d],n=We[y][0],l=We[y][1],o=1&r.voxel.materials>>n,s=1&r.voxel.materials>>l,r.size<m&&(m=r.size,x=d,p=o!==Xe.AIR),u[d]=r.voxel.index,c[d]=o!==s;c[x]&&(p?(t.push(u[0]),t.push(u[3]),t.push(u[1]),t.push(u[0]),t.push(u[2]),t.push(u[3])):(t.push(u[0]),t.push(u[1]),t.push(u[3]),t.push(u[0]),t.push(u[3]),t.push(u[2])))}function V(e,a,t){var n,l,o,s,r=[0,0,0,0];if(null!==e[0].voxel&&null!==e[1].voxel&&null!==e[2].voxel&&null!==e[3].voxel)F(e,a,t);else for(o=0;2>o;++o){for(r[0]=Na[a][o][0],r[1]=Na[a][o][1],r[2]=Na[a][o][2],r[3]=Na[a][o][3],n=[],s=0;4>s;++s)if(l=e[s],null!==l.voxel)n[s]=l;else if(null!==l.children)n[s]=l.children[r[s]];else break;4===s&&V(n,Na[a][o][4],t)}}function L(e,a,t){var n,l,o,s,r,y,d=[0,0,0,0],u=[[0,0,1,1],[0,1,0,1]];if(null!==e[0].children||null!==e[1].children){for(r=0;4>r;++r)d[0]=Va[a][r][0],d[1]=Va[a][r][1],n=[null===e[0].children?e[0]:e[0].children[d[0]],null===e[1].children?e[1]:e[1].children[d[1]]],L(n,Va[a][r][2],t);for(r=0;4>r;++r){for(d[0]=La[a][r][1],d[1]=La[a][r][2],d[2]=La[a][r][3],d[3]=La[a][r][4],o=u[La[a][r][0]],l=[],y=0;4>y;++y)if(s=e[o[y]],null!==s.voxel)l[y]=s;else if(null!==s.children)l[y]=s.children[d[y]];else break;4===y&&V(l,La[a][r][5],t)}}}function N(e,a){var t,n,l,o=e.children,s=[0,0,0,0];if(null!==o){for(l=0;8>l;++l)N(o[l],a);for(l=0;12>l;++l)s[0]=Da[l][0],s[1]=Da[l][1],t=[o[s[0]],o[s[1]]],L(t,Da[l][2],a);for(l=0;6>l;++l)s[0]=Fa[l][0],s[1]=Fa[l][1],s[2]=Fa[l][2],s[3]=Fa[l][3],n=[o[s[0]],o[s[1]],o[s[2]],o[s[3]]],V(n,Fa[l][4],a)}}function O(e,a,t,n){var l,o;if(null!==e.children)for(l=0;8>l;++l)n=O(e.children[l],a,t,n);else null!==e.voxel&&(o=e.voxel,o.index=n,a[3*n]=o.position.x,a[3*n+1]=o.position.y,a[3*n+2]=o.position.z,t[3*n]=o.normal.x,t[3*n+1]=o.normal.y,t[3*n+2]=o.normal.z,++n);return n}function B(e,a){var t,n=e.elements,i=a.elements;0!==n[1]&&(t=Ma.calculateCoefficients(n[0],n[1],n[3]),qa.rotateQXY(Ua.set(n[0],n[3]),n[1],t),n[0]=Ua.x,n[3]=Ua.y,qa.rotateXY(Ua.set(n[2],n[4]),t),n[2]=Ua.x,n[4]=Ua.y,n[1]=0,qa.rotateXY(Ua.set(i[0],i[3]),t),i[0]=Ua.x,i[3]=Ua.y,qa.rotateXY(Ua.set(i[1],i[4]),t),i[1]=Ua.x,i[4]=Ua.y,qa.rotateXY(Ua.set(i[2],i[5]),t),i[2]=Ua.x,i[5]=Ua.y)}function R(e,a){var t,n=e.elements,i=a.elements;0!==n[2]&&(t=Ma.calculateCoefficients(n[0],n[2],n[5]),qa.rotateQXY(Ua.set(n[0],n[5]),n[2],t),n[0]=Ua.x,n[5]=Ua.y,qa.rotateXY(Ua.set(n[1],n[4]),t),n[1]=Ua.x,n[4]=Ua.y,n[2]=0,qa.rotateXY(Ua.set(i[0],i[6]),t),i[0]=Ua.x,i[6]=Ua.y,qa.rotateXY(Ua.set(i[1],i[7]),t),i[1]=Ua.x,i[7]=Ua.y,qa.rotateXY(Ua.set(i[2],i[8]),t),i[2]=Ua.x,i[8]=Ua.y)}function A(e,a){var t,n=e.elements,i=a.elements;0!==n[4]&&(t=Ma.calculateCoefficients(n[3],n[4],n[5]),qa.rotateQXY(Ua.set(n[3],n[5]),n[4],t),n[3]=Ua.x,n[5]=Ua.y,qa.rotateXY(Ua.set(n[1],n[2]),t),n[1]=Ua.x,n[2]=Ua.y,n[4]=0,qa.rotateXY(Ua.set(i[3],i[6]),t),i[3]=Ua.x,i[6]=Ua.y,qa.rotateXY(Ua.set(i[4],i[7]),t),i[4]=Ua.x,i[7]=Ua.y,qa.rotateXY(Ua.set(i[5],i[8]),t),i[5]=Ua.x,i[8]=Ua.y)}function M(a,t){var n,l=a.elements;for(n=0;n<5;++n)B(a,t),R(a,t),A(a,t);return _a.set(l[0],l[3],l[5])}function Y(e){var a=ue(e)<Ya?0:1/e;return ue(a)<Ya?0:a}function X(e,a){var t=e.elements,n=t[0],i=t[3],l=t[6],o=t[1],s=t[4],r=t[7],y=t[2],d=t[5],u=t[8],c=Y(a.x),m=Y(a.y),x=Y(a.z);return e.set(n*c*n+i*m*i+l*x*l,n*c*o+i*m*s+l*x*r,n*c*y+i*m*d+l*x*u,o*c*n+s*m*i+r*x*l,o*c*o+s*m*s+r*x*r,o*c*y+s*m*d+r*x*u,y*c*n+d*m*i+u*x*l,y*c*o+d*m*s+u*x*r,y*c*y+d*m*d+u*x*u)}function Z(e,a,t){return e.applyToVector3(Ga.copy(t)),Ga.subVectors(a,Ga),Ga.dot(Ga)}function U(e,a,t,l,o){var s=0;for(a>>=1;0<a;a>>=1,s=0)t>=a&&(s+=4,t-=a),l>=a&&(s+=2,l-=a),o>=a&&(s+=1,o-=a),null===e.children&&e.split(),e=e.children[s];return e}function _(e,a,t,n,l){var o,s,r,y,d,u,c,x,p,v,k=e+1,m=new Ka;for(o=0,v=0;8>v;++v)y=Je[v],d=(n+y[2])*(k*k)+(t+y[1])*k+(a+y[0]),r=me(l[d],Xe.SOLID),o|=r<<v;for(s=0,v=0;12>v;++v)u=We[v][0],c=We[v][1],x=1&o>>u,p=1&o>>c,x!==p&&++s;return m.materials=o,m.edgeCount=s,m.qefData=new Ha,m}function j(e){var a=tt,t=fa.resolution,n=new pe(0,0,0),i=new pe(t,t,t),l=new v(nt,nt.clone().addScalar(tt)),o=e.getBoundingBox();return e.type!==xe.INTERSECTION&&(o.intersectsBox(l)?(n.copy(o.min).max(l.min).sub(l.min),n.x=de(n.x*t/a),n.y=de(n.y*t/a),n.z=de(n.z*t/a),i.copy(o.max).min(l.max).sub(l.min),i.x=ye(i.x*t/a),i.y=ye(i.y*t/a),i.z=ye(i.z*t/a)):(n.set(t,t,t),i.set(0,0,0))),new v(n,i)}function G(e,a,t,i){var l,o,s,r=fa.resolution,n=r+1,d=i.max.x,u=i.max.y,c=i.max.z;for(s=i.min.z;s<=c;++s)for(o=i.min.y;o<=u;++o)for(l=i.min.x;l<=d;++l)e.updateMaterialIndex(s*(n*n)+o*n+l,a,t)}function Q(e,a,t){var i,l,o,r,d=tt,s=fa.resolution,n=s+1,u=a.materialIndices,c=new pe,m=new pe,p=t.max.x,v=t.max.y,k=t.max.z,g=0;for(r=t.min.z;r<=k;++r)for(c.z=r*d/s,o=t.min.y;o<=v;++o)for(c.y=o*d/s,l=t.min.x;l<=p;++l)c.x=l*d/s,i=e.generateMaterialIndex(m.addVectors(nt,c)),i!==Xe.AIR&&(u[r*(n*n)+o*n+l]=i,++g);a.materials=g}function H(e,a,t){var l,o,s,r,y,u,x,p,v,k,g,z,h,f,S,I,C,w,T,P,b,E,D,F=fa.resolution,n=F+1,m=new Uint32Array([1,n,n*n]),V=a.materialIndices,L=new ca,N=new ca,O=t.edgeData,B=a.edgeData,R=new Uint32Array(3),A=ka.calculate1DEdgeCount(F),M=new ka(F,me(A,B.indices[0].length+O.indices[0].length),me(A,B.indices[1].length+O.indices[1].length),me(A,B.indices[2].length+O.indices[2].length));for(w=0,T=0;3>T;w=0,++T){for(l=O.indices[T],r=B.indices[T],x=M.indices[T],o=O.zeroCrossings[T],y=B.zeroCrossings[T],p=M.zeroCrossings[T],s=O.normals[T],u=B.normals[T],v=M.normals[T],k=m[T],E=l.length,D=r.length,(P=0,b=0);P<E;++P)if(g=l[P],z=g+k,S=V[g],I=V[z],S!==I&&(S===Xe.AIR||I===Xe.AIR)){for(L.t=o[P],L.n.x=s[3*P],L.n.y=s[3*P+1],L.n.z=s[3*P+2],e.type===xe.DIFFERENCE&&L.n.negate(),C=L;b<D&&r[b]<=g;)h=r[b],f=h+k,N.t=y[b],N.n.x=u[3*b],N.n.y=u[3*b+1],N.n.z=u[3*b+2],S=V[h],h<g?(I=V[f],S!==I&&(S===Xe.AIR||I===Xe.AIR)&&(x[w]=h,p[w]=N.t,v[3*w]=N.n.x,v[3*w+1]=N.n.y,v[3*w+2]=N.n.z,++w)):C=e.selectEdge(N,L,S===Xe.SOLID),++b;x[w]=g,p[w]=C.t,v[3*w]=C.n.x,v[3*w+1]=C.n.y,v[3*w+2]=C.n.z,++w}for(;b<D;)h=r[b],f=h+k,S=V[h],I=V[f],S!==I&&(S===Xe.AIR||I===Xe.AIR)&&(x[w]=h,p[w]=y[b],v[3*w]=u[3*b],v[3*w+1]=u[3*b+1],v[3*w+2]=u[3*b+2],++w),++b;R[T]=w}return{edgeData:M,lengths:R}}function K(e,t,i){var l,o,r,u,p,v,k,g,h,f,S,I,C,w,T,P,b,E,D,F=tt,s=fa.resolution,n=s+1,m=n*n,V=new Uint32Array([1,n,m]),L=t.materialIndices,N=nt,O=new pe,B=new pe,R=new ca,A=new Uint32Array(3),M=new ka(s,ka.calculate1DEdgeCount(s));for(T=4,C=0,w=0;3>w;T>>=1,C=0,++w){P=Je[T],l=M.indices[w],o=M.zeroCrossings[w],r=M.normals[w],u=V[w],k=i.min.x,f=i.max.x,g=i.min.y,S=i.max.y,h=i.min.z,I=i.max.z;for(0===w?(k=ce(k-1,0),f=me(f,s-1)):1===w?(g=ce(g-1,0),S=me(S,s-1)):2===w?(h=ce(h-1,0),I=me(I,s-1)):void 0,D=h;D<=I;++D)for(E=g;E<=S;++E)for(b=k;b<=f;++b)p=D*m+E*n+b,v=p+u,L[p]!==L[v]&&(O.set(b*F/s,E*F/s,D*F/s),B.set((b+P[0])*F/s,(E+P[1])*F/s,(D+P[2])*F/s),R.a.addVectors(N,O),R.b.addVectors(N,B),e.generateEdge(R),l[C]=p,o[C]=R.t,r[3*C]=R.n.x,r[3*C+1]=R.n.y,r[3*C+2]=R.n.z,++C);A[w]=C}return{edgeData:M,lengths:A}}function J(e,a,t){var n,i,l,o,s=j(e),r=!1;if(e.type===xe.DENSITY_FUNCTION?Q(e,a,s):a.empty?e.type===xe.UNION&&(a.set(t),r=!0):!(a.full&&e.type===xe.UNION)&&G(e,a,t,s),!r&&!a.empty&&!a.full){for(n=e.type===xe.DENSITY_FUNCTION?K(e,a,s):H(e,a,t),i=n.edgeData,l=n.lengths,o=0;3>o;++o)i.indices[o]=i.indices[o].slice(0,l[o]),i.zeroCrossings[o]=i.zeroCrossings[o].slice(0,l[o]),i.normals[o]=i.normals[o].slice(0,3*l[o]);a.edgeData=i}}function W(e){var a,t,n,o,s=e.children;for(e.type===xe.DENSITY_FUNCTION&&(a=new fa,J(e,a)),n=0,o=s.length;n<o&&(t=W(s[n]),void 0===a?a=t:null===t?e.type===xe.INTERSECTION&&(a=null):null===a?e.type===xe.UNION&&(a=t):J(e,a,t),null!==a||e.type===xe.UNION);++n);return null!==a&&a.empty?null:a}var xe={UNION:\"csg.union\",DIFFERENCE:\"csg.difference\",INTERSECTION:\"csg.intersection\",DENSITY_FUNCTION:\"csg.densityfunction\"},pe=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,a),this.x=t,this.y=n,this.z=i}return n(a,[{key:\"set\",value:function(e,a,t){return this.x=e,this.y=a,this.z=t,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:\"fromArray\",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[a],this.y=e[a+1],this.z=e[a+2],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[a]=this.x,e[a+1]=this.y,e[a+2]=this.z,e}},{key:\"setFromSpherical\",value:function(e){this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:\"setFromSphericalCoords\",value:function(e,a,t){var n=re(a)*e;return this.x=n*re(t),this.y=se(a)*e,this.z=n*se(t),this}},{key:\"setFromCylindrical\",value:function(e){this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:\"setFromCylindricalCoords\",value:function(e,a,t){return this.x=e*re(a),this.y=t,this.z=e*se(a),this}},{key:\"setFromMatrixColumn\",value:function(e,a){return this.fromArray(e.elements,4*a)}},{key:\"setFromMatrixPosition\",value:function(e){var a=e.elements;return this.x=a[12],this.y=a[13],this.z=a[14],this}},{key:\"setFromMatrixScale\",value:function(e){var a=this.setFromMatrixColumn(e,0).length(),t=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=a,this.y=t,this.z=n,this}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:\"addVectors\",value:function(e,a){return this.x=e.x+a.x,this.y=e.y+a.y,this.z=e.z+a.z,this}},{key:\"addScaledVector\",value:function(e,a){return this.x+=e.x*a,this.y+=e.y*a,this.z+=e.z*a,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:\"subVectors\",value:function(e,a){return this.x=e.x-a.x,this.y=e.y-a.y,this.z=e.z-a.z,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:\"multiplyVectors\",value:function(e,a){return this.x=e.x*a.x,this.y=e.y*a.y,this.z=e.z*a.z,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this}},{key:\"crossVectors\",value:function(e,a){var t=e.x,n=e.y,i=e.z,l=a.x,o=a.y,s=a.z;return this.x=n*s-i*o,this.y=i*l-t*s,this.z=t*o-n*l,this}},{key:\"cross\",value:function(e){return this.crossVectors(this,e)}},{key:\"transformDirection\",value:function(a){var t=this.x,n=this.y,i=this.z,l=a.elements;return this.x=l[0]*t+l[4]*n+l[8]*i,this.y=l[1]*t+l[5]*n+l[9]*i,this.z=l[2]*t+l[6]*n+l[10]*i,this.normalize()}},{key:\"applyMatrix3\",value:function(a){var t=this.x,n=this.y,i=this.z,l=a.elements;return this.x=l[0]*t+l[3]*n+l[6]*i,this.y=l[1]*t+l[4]*n+l[7]*i,this.z=l[2]*t+l[5]*n+l[8]*i,this}},{key:\"applyMatrix4\",value:function(a){var t=this.x,n=this.y,i=this.z,l=a.elements;return this.x=l[0]*t+l[4]*n+l[8]*i+l[12],this.y=l[1]*t+l[5]*n+l[9]*i+l[13],this.z=l[2]*t+l[6]*n+l[10]*i+l[14],this}},{key:\"applyQuaternion\",value:function(e){var a=this.x,t=this.y,n=this.z,i=e.x,l=e.y,o=e.z,s=e.w,r=s*a+l*n-o*t,y=s*t+o*a-i*n,d=s*n+i*t-l*a,u=-i*a-l*t-o*n;return this.x=r*s+u*-i+y*-o-d*-l,this.y=y*s+u*-l+d*-i-r*-o,this.z=d*s+u*-o+r*-l-y*-i,this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:\"reflect\",value:function(e){var a=e.x,t=e.y,n=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(a,t,n),this}},{key:\"angleTo\",value:function(e){var a=this.dot(e)/oe(this.lengthSquared()*e.lengthSquared());return le(me(ce(a,-1),1))}},{key:\"manhattanLength\",value:function(){return ue(this.x)+ue(this.y)+ue(this.z)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:\"length\",value:function(){return oe(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:\"manhattanDistanceTo\",value:function(e){return ue(this.x-e.x)+ue(this.y-e.y)+ue(this.z-e.z)}},{key:\"distanceToSquared\",value:function(e){var a=this.x-e.x,t=this.y-e.y,n=this.z-e.z;return a*a+t*t+n*n}},{key:\"distanceTo\",value:function(e){return oe(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=me(this.x,e.x),this.y=me(this.y,e.y),this.z=me(this.z,e.z),this}},{key:\"max\",value:function(e){return this.x=ce(this.x,e.x),this.y=ce(this.y,e.y),this.z=ce(this.z,e.z),this}},{key:\"clamp\",value:function(e,a){return this.x=ce(e.x,me(a.x,this.x)),this.y=ce(e.y,me(a.y,this.y)),this.z=ce(e.z,me(a.z,this.z)),this}},{key:\"floor\",value:function(){return this.x=ye(this.x),this.y=ye(this.y),this.z=ye(this.z),this}},{key:\"ceil\",value:function(){return this.x=de(this.x),this.y=de(this.y),this.z=de(this.z),this}},{key:\"round\",value:function(){return this.x=ie(this.x),this.y=ie(this.y),this.z=ie(this.z),this}},{key:\"lerp\",value:function(e,a){return this.x+=(e.x-this.x)*a,this.y+=(e.y-this.y)*a,this.z+=(e.z-this.z)*a,this}},{key:\"lerpVectors\",value:function(e,a,t){return this.subVectors(a,e).multiplyScalar(t).add(e)}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}]),a}(),ve=new pe,o=[new pe,new pe,new pe,new pe,new pe,new pe,new pe,new pe],v=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pe(1/0,1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new pe(-Infinity,-Infinity,-Infinity);e(this,a),this.min=t,this.max=n}return n(a,[{key:\"set\",value:function(e,a){return this.min.copy(e),this.max.copy(a),this}},{key:\"copy\",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"makeEmpty\",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-Infinity,this}},{key:\"isEmpty\",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pe;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getSize\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pe;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:\"setFromSphere\",value:function(e){return this.set(e.center,e.center),this.expandByScalar(e.radius),this}},{key:\"expandByPoint\",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:\"expandByVector\",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:\"expandByScalar\",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:\"setFromPoints\",value:function(e){var a,t;for(this.min.set(0,0,0),this.max.set(0,0,0),(a=0,t=e.length);a<t;++a)this.expandByPoint(e[a]);return this}},{key:\"setFromCenterAndSize\",value:function(e,a){var t=ve.copy(a).multiplyScalar(.5);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this}},{key:\"clampPoint\",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new pe;return a.copy(e).clamp(this.min,this.max)}},{key:\"distanceToPoint\",value:function(e){var a=ve.copy(e).clamp(this.min,this.max);return a.sub(e).length()}},{key:\"applyMatrix4\",value:function(e){var a=this.min,t=this.max;return this.isEmpty()||(o[0].set(a.x,a.y,a.z).applyMatrix4(e),o[1].set(a.x,a.y,t.z).applyMatrix4(e),o[2].set(a.x,t.y,a.z).applyMatrix4(e),o[3].set(a.x,t.y,t.z).applyMatrix4(e),o[4].set(t.x,a.y,a.z).applyMatrix4(e),o[5].set(t.x,a.y,t.z).applyMatrix4(e),o[6].set(t.x,t.y,a.z).applyMatrix4(e),o[7].set(t.x,t.y,t.z).applyMatrix4(e),this.setFromPoints(o)),this}},{key:\"translate\",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:\"intersect\",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:\"union\",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:\"containsPoint\",value:function(e){var a=this.min,t=this.max;return e.x>=a.x&&e.y>=a.y&&e.z>=a.z&&e.x<=t.x&&e.y<=t.y&&e.z<=t.z}},{key:\"containsBox\",value:function(e){var a=this.min,t=this.max,n=e.min,i=e.max;return a.x<=n.x&&i.x<=t.x&&a.y<=n.y&&i.y<=t.y&&a.z<=n.z&&i.z<=t.z}},{key:\"intersectsBox\",value:function(e){var a=this.min,t=this.max,n=e.min,i=e.max;return i.x>=a.x&&i.y>=a.y&&i.z>=a.z&&n.x<=t.x&&n.y<=t.y&&n.z<=t.z}},{key:\"intersectsSphere\",value:function(e){var a=this.clampPoint(e.center,ve);return a.distanceToSquared(e.center)<=e.radius*e.radius}},{key:\"intersectsPlane\",value:function(e){var a,t;return 0<e.normal.x?(a=e.normal.x*this.min.x,t=e.normal.x*this.max.x):(a=e.normal.x*this.max.x,t=e.normal.x*this.min.x),0<e.normal.y?(a+=e.normal.y*this.min.y,t+=e.normal.y*this.max.y):(a+=e.normal.y*this.max.y,t+=e.normal.y*this.min.y),0<e.normal.z?(a+=e.normal.z*this.min.z,t+=e.normal.z*this.max.z):(a+=e.normal.z*this.max.z,t+=e.normal.z*this.min.z),a<=-e.constant&&t>=-e.constant}},{key:\"equals\",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),a}(),ke=new v,ge=new pe,ze=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,a),this.center=t,this.radius=n}return n(a,[{key:\"set\",value:function(e,a){return this.center.copy(e),this.radius=a,this}},{key:\"copy\",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromPoints\",value:function(e){var a,t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:ke.setFromPoints(e).getCenter(this.center),o=0;for(a=0,t=e.length;a<t;++a)o=ce(o,n.distanceToSquared(e[a]));return this.radius=oe(o),this}},{key:\"setFromBox\",value:function(e){return e.getCenter(this.center),this.radius=.5*e.getSize(ge).length(),this}},{key:\"isEmpty\",value:function(){return 0>=this.radius}},{key:\"translate\",value:function(e){return this.center.add(e),this}},{key:\"clampPoint\",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new pe,t=this.center.distanceToSquared(e);return a.copy(e),t>this.radius*this.radius&&(a.sub(this.center).normalize(),a.multiplyScalar(this.radius).add(this.center)),a}},{key:\"distanceToPoint\",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:\"containsPoint\",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:\"intersectsSphere\",value:function(e){var a=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=a*a}},{key:\"intersectsBox\",value:function(e){return e.intersectsSphere(this)}},{key:\"intersectsPlane\",value:function(e){return ue(e.distanceToPoint(this.center))<=this.radius}},{key:\"equals\",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}]),a}(),he=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,a),this.x=t,this.y=n}return n(a,[{key:\"set\",value:function(e,a){return this.x=e,this.y=a,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y)}},{key:\"fromArray\",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[a],this.y=e[a+1],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[a]=this.x,e[a+1]=this.y,e}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this}},{key:\"addVectors\",value:function(e,a){return this.x=e.x+a.x,this.y=e.y+a.y,this}},{key:\"addScaledVector\",value:function(e,a){return this.x+=e.x*a,this.y+=e.y*a,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this}},{key:\"subVectors\",value:function(e,a){return this.x=e.x-a.x,this.y=e.y-a.y,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this}},{key:\"applyMatrix3\",value:function(a){var t=this.x,n=this.y,i=a.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y}},{key:\"cross\",value:function(e){return this.x*e.y-this.y*e.x}},{key:\"manhattanLength\",value:function(){return ue(this.x)+ue(this.y)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y}},{key:\"length\",value:function(){return oe(this.x*this.x+this.y*this.y)}},{key:\"manhattanDistanceTo\",value:function(e){return ue(this.x-e.x)+ue(this.y-e.y)}},{key:\"distanceToSquared\",value:function(e){var a=this.x-e.x,t=this.y-e.y;return a*a+t*t}},{key:\"distanceTo\",value:function(e){return oe(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=me(this.x,e.x),this.y=me(this.y,e.y),this}},{key:\"max\",value:function(e){return this.x=ce(this.x,e.x),this.y=ce(this.y,e.y),this}},{key:\"clamp\",value:function(e,a){return this.x=ce(e.x,me(a.x,this.x)),this.y=ce(e.y,me(a.y,this.y)),this}},{key:\"floor\",value:function(){return this.x=ye(this.x),this.y=ye(this.y),this}},{key:\"ceil\",value:function(){return this.x=de(this.x),this.y=de(this.y),this}},{key:\"round\",value:function(){return this.x=ie(this.x),this.y=ie(this.y),this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:\"angle\",value:function e(){var e=ne(this.y,this.x);return 0>e&&(e+=2*te),e}},{key:\"lerp\",value:function(e,a){return this.x+=(e.x-this.x)*a,this.y+=(e.y-this.y)*a,this}},{key:\"lerpVectors\",value:function(e,a,t){return this.subVectors(a,e).multiplyScalar(t).add(e)}},{key:\"rotateAround\",value:function(e,a){var t=se(a),n=re(a),i=this.x-e.x,l=this.y-e.y;return this.x=i*t-l*n+e.x,this.y=i*n+l*t+e.y,this}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y}},{key:\"width\",get:function(){return this.x},set:function(e){return this.x=e}},{key:\"height\",get:function(){return this.y},set:function(e){return this.y=e}}]),a}(),fe=new he,Se=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new he(1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new he(-Infinity,-Infinity);e(this,a),this.min=t,this.max=n}return n(a,[{key:\"set\",value:function(e,a){return this.min.copy(e),this.max.copy(a),this}},{key:\"copy\",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"makeEmpty\",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-Infinity,this}},{key:\"isEmpty\",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new he;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getSize\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new he;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:\"getBoundingSphere\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new ze;return this.getCenter(e.center),e.radius=.5*this.getSize(fe).length(),e}},{key:\"expandByPoint\",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:\"expandByVector\",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:\"expandByScalar\",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:\"setFromPoints\",value:function(e){var a,t;for(this.min.set(0,0),this.max.set(0,0),(a=0,t=e.length);a<t;++a)this.expandByPoint(e[a]);return this}},{key:\"setFromCenterAndSize\",value:function(e,a){var t=fe.copy(a).multiplyScalar(.5);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this}},{key:\"clampPoint\",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new he;return a.copy(e).clamp(this.min,this.max)}},{key:\"distanceToPoint\",value:function(e){var a=fe.copy(e).clamp(this.min,this.max);return a.sub(e).length()}},{key:\"translate\",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:\"intersect\",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:\"union\",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:\"containsPoint\",value:function(e){var a=this.min,t=this.max;return e.x>=a.x&&e.y>=a.y&&e.x<=t.x&&e.y<=t.y}},{key:\"containsBox\",value:function(e){var a=this.min,t=this.max,n=e.min,i=e.max;return a.x<=n.x&&i.x<=t.x&&a.y<=n.y&&i.y<=t.y}},{key:\"intersectsBox\",value:function(e){var a=this.min,t=this.max,n=e.min,i=e.max;return i.x>=a.x&&i.y>=a.y&&n.x<=t.x&&n.y<=t.y}},{key:\"equals\",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),a}(),Ie=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,a),this.radius=t,this.theta=n,this.y=i}return n(a,[{key:\"set\",value:function(e,a,t){return this.radius=e,this.theta=a,this.y=t,this}},{key:\"copy\",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromVector3\",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:\"setFromCartesianCoords\",value:function(e,a,t){return this.radius=oe(e*e+t*t),this.theta=ne(e,t),this.y=a,this}}]),a}(),Ce=function(){function a(){e(this,a),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return n(a,[{key:\"set\",value:function(e,a,t,n,i,l,o,s,r){var y=this.elements;return y[0]=e,y[3]=a,y[6]=t,y[1]=n,y[4]=i,y[7]=l,y[2]=o,y[5]=s,y[8]=r,this}},{key:\"identity\",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:\"copy\",value:function(e){var a=e.elements,t=this.elements;return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],this}},{key:\"clone\",value:function(){return new this.constructor().fromArray(this.elements)}},{key:\"fromArray\",value:function(e){var a,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(a=0;9>a;++a)n[a]=e[a+t];return this}},{key:\"toArray\",value:function(){var e,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(e=0;9>e;++e)a[e+t]=n[e];return a}},{key:\"multiplyMatrices\",value:function(e,a){var t=e.elements,n=a.elements,i=this.elements,l=t[0],o=t[3],s=t[6],r=t[1],y=t[4],d=t[7],u=t[2],c=t[5],m=t[8],x=n[0],p=n[3],v=n[6],k=n[1],g=n[4],z=n[7],h=n[2],f=n[5],S=n[8];return i[0]=l*x+o*k+s*h,i[3]=l*p+o*g+s*f,i[6]=l*v+o*z+s*S,i[1]=r*x+y*k+d*h,i[4]=r*p+y*g+d*f,i[7]=r*v+y*z+d*S,i[2]=u*x+c*k+m*h,i[5]=u*p+c*g+m*f,i[8]=u*v+c*z+m*S,this}},{key:\"multiply\",value:function(e){return this.multiplyMatrices(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyMatrices(e,this)}},{key:\"multiplyScalar\",value:function(e){var a=this.elements;return a[0]*=e,a[3]*=e,a[6]*=e,a[1]*=e,a[4]*=e,a[7]*=e,a[2]*=e,a[5]*=e,a[8]*=e,this}},{key:\"determinant\",value:function(){var t=this.elements,n=t[0],a=t[1],l=t[2],o=t[3],s=t[4],e=t[5],r=t[6],y=t[7],d=t[8];return n*s*d-n*e*y-a*o*d+a*e*r+l*o*y-l*s*r}},{key:\"getInverse\",value:function(e){var a,t=e.elements,n=this.elements,i=t[0],l=t[1],o=t[2],s=t[3],r=t[4],y=t[5],d=t[6],u=t[7],c=t[8],m=c*r-y*u,x=y*d-c*s,p=u*s-r*d,v=i*m+l*x+o*p;return 0===v?(console.error(\"Can't invert matrix, determinant is zero\",e),this.identity()):(a=1/v,n[0]=m*a,n[1]=(o*u-c*l)*a,n[2]=(y*l-o*r)*a,n[3]=x*a,n[4]=(c*i-o*d)*a,n[5]=(o*s-y*i)*a,n[6]=p*a,n[7]=(l*d-u*i)*a,n[8]=(r*i-l*s)*a),this}},{key:\"transpose\",value:function(){var e,a=this.elements;return e=a[1],a[1]=a[3],a[3]=e,e=a[2],a[2]=a[6],a[6]=e,e=a[5],a[5]=a[7],a[7]=e,this}},{key:\"scale\",value:function(e,a){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=a,t[4]*=a,t[7]*=a,this}},{key:\"rotate\",value:function(e){var a=se(e),t=re(e),n=this.elements,i=n[0],l=n[3],o=n[6],s=n[1],r=n[4],y=n[7];return n[0]=a*i+t*s,n[3]=a*l+t*r,n[6]=a*o+t*y,n[1]=-t*i+a*s,n[4]=-t*l+a*r,n[7]=-t*o+a*y,this}},{key:\"translate\",value:function(e,a){var t=this.elements;return t[0]+=e*t[2],t[3]+=e*t[5],t[6]+=e*t[8],t[1]+=a*t[2],t[4]+=a*t[5],t[7]+=a*t[8],this}},{key:\"equals\",value:function(e){var a,t=this.elements,n=e.elements,l=!0;for(a=0;l&&9>a;++a)t[a]!==n[a]&&(l=!1);return l}}]),a}(),we={XYZ:\"XYZ\",YZX:\"YZX\",ZXY:\"ZXY\",XZY:\"XZY\",YXZ:\"YXZ\",ZYX:\"ZYX\"},Te=function(){var i=Number.EPSILON;function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;e(this,a),this.x=t,this.y=n,this.z=i,this.w=l}return n(a,[{key:\"set\",value:function(e,a,t,n){return this.x=e,this.y=a,this.z=t,this.w=n,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:\"fromArray\",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[a],this.y=e[a+1],this.z=e[a+2],this.w=e[a+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[a]=this.x,e[a+1]=this.y,e[a+2]=this.z,e[a+3]=this.w,e}},{key:\"setFromEuler\",value:function(e){var a=e.x,t=e.y,n=e.z,i=se,l=re,o=i(a/2),s=i(t/2),r=i(n/2),y=l(a/2),d=l(t/2),u=l(n/2);switch(e.order){case we.XYZ:this.x=y*s*r+o*d*u,this.y=o*d*r-y*s*u,this.z=o*s*u+y*d*r,this.w=o*s*r-y*d*u;break;case we.YXZ:this.x=y*s*r+o*d*u,this.y=o*d*r-y*s*u,this.z=o*s*u-y*d*r,this.w=o*s*r+y*d*u;break;case we.ZXY:this.x=y*s*r-o*d*u,this.y=o*d*r+y*s*u,this.z=o*s*u+y*d*r,this.w=o*s*r-y*d*u;break;case we.ZYX:this.x=y*s*r-o*d*u,this.y=o*d*r+y*s*u,this.z=o*s*u-y*d*r,this.w=o*s*r+y*d*u;break;case we.YZX:this.x=y*s*r+o*d*u,this.y=o*d*r+y*s*u,this.z=o*s*u-y*d*r,this.w=o*s*r-y*d*u;break;case we.XZY:this.x=y*s*r-o*d*u,this.y=o*d*r-y*s*u,this.z=o*s*u+y*d*r,this.w=o*s*r+y*d*u;}return this}},{key:\"setFromAxisAngle\",value:function(e,a){var t=a/2,n=re(t);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=se(t),this}},{key:\"setFromRotationMatrix\",value:function(e){var a,t=e.elements,n=t[0],i=t[4],l=t[8],o=t[1],r=t[5],y=t[9],d=t[2],u=t[6],c=t[10],m=n+r+c;return 0<m?(a=.5/oe(m+1),this.w=.25/a,this.x=(u-y)*a,this.y=(l-d)*a,this.z=(o-i)*a):n>r&&n>c?(a=2*oe(1+n-r-c),this.w=(u-y)/a,this.x=.25*a,this.y=(i+o)/a,this.z=(l+d)/a):r>c?(a=2*oe(1+r-n-c),this.w=(l-d)/a,this.x=(i+o)/a,this.y=.25*a,this.z=(y+u)/a):(a=2*oe(1+c-n-r),this.w=(o-i)/a,this.x=(l+d)/a,this.y=(y+u)/a,this.z=.25*a),this}},{key:\"setFromUnitVectors\",value:function(e,a){var t=e.dot(a)+1;return 1e-6>t?(t=0,ue(e.x)>ue(e.z)?(this.x=-e.y,this.y=e.x,this.z=0,this.w=t):(this.x=0,this.y=-e.z,this.z=e.y,this.w=t)):(this.x=e.y*a.z-e.z*a.y,this.y=e.z*a.x-e.x*a.z,this.z=e.x*a.y-e.y*a.x,this.w=t),this.normalize()}},{key:\"angleTo\",value:function(e){return 2*le(ue(me(ce(this.dot(e),-1),1)))}},{key:\"rotateTowards\",value:function(e,a){var t=this.angleTo(e);return 0!==t&&this.slerp(e,me(1,a/t)),this}},{key:\"invert\",value:function(){return this.conjugate()}},{key:\"conjugate\",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:\"length\",value:function(){return oe(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:\"normalize\",value:function(){var e,a=this.length();return 0===a?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/a,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:\"multiplyQuaternions\",value:function(e,a){var t=e.x,n=e.y,i=e.z,l=e.w,o=a.x,s=a.y,r=a.z,y=a.w;return this.x=t*y+l*o+n*r-i*s,this.y=n*y+l*s+i*o-t*r,this.z=i*y+l*r+t*s-n*o,this.w=l*y-t*o-n*s-i*r,this}},{key:\"multiply\",value:function(e){return this.multiplyQuaternions(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyQuaternions(e,this)}},{key:\"slerp\",value:function(e,a){var t,n,l,o,r,d,u,c=this.x,m=this.y,y=this.z,x=this.w;return 1===a?this.copy(e):0<a&&(t=x*e.w+c*e.x+m*e.y+y*e.z,0>t?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,t=-t):this.copy(e),1<=t?(this.w=x,this.x=c,this.y=m,this.z=y):(n=1-t*t,r=1-a,n<=i?(this.w=r*x+a*this.w,this.x=r*c+a*this.x,this.y=r*m+a*this.y,this.z=r*y+a*this.z,this.normalize()):(l=oe(n),o=ne(l,t),d=re(r*o)/l,u=re(a*o)/l,this.w=x*d+this.w*u,this.x=c*d+this.x*u,this.y=m*d+this.y*u,this.z=y*d+this.z*u))),this}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}],[{key:\"slerp\",value:function(e,a,n,i){return n.copy(e).slerp(a,i)}},{key:\"slerpFlat\",value:function(e,a,n,l,o,r,y){var d,u,c,m,x,p,v,k,g=o[r],z=o[r+1],h=o[r+2],S=o[r+3],I=n[l],C=n[l+1],w=n[l+2],T=n[l+3];(T!==S||I!==g||C!==z||w!==h)&&(d=1-y,m=I*g+C*z+w*h+T*S,p=0<=m?1:-1,x=1-m*m,x>i&&(c=oe(x),v=ne(c,m*p),d=re(d*v)/c,y=re(y*v)/c),k=y*p,I=I*d+g*k,C=C*d+z*k,w=w*d+h*k,T=T*d+S*k,d===1-y&&(u=1/oe(I*I+C*C+w*w+T*T),I*=u,C*=u,w*=u,T*=u)),e[a]=I,e[a+1]=C,e[a+2]=w,e[a+3]=T}}]),a}(),Pe=new Ce,m=new Te,q=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,a),this.x=t,this.y=n,this.z=i,this.order=a.defaultOrder}return n(a,[{key:\"set\",value:function(e,a,t,n){return this.x=e,this.y=a,this.z=t,this.order=n,this}},{key:\"copy\",value:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.order=a.order,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:\"fromArray\",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[a],this.y=e[a+1],this.z=e[a+2],this.order=e[a+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[a]=this.x,e[a+1]=this.y,e[a+2]=this.z,e[a+3]=this.order,e}},{key:\"toVector3\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pe;return e.set(this.x,this.y,this.z)}},{key:\"setFromRotationMatrix\",value:function(e){var a=Math.asin,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order,n=e.elements,i=n[0],l=n[4],o=n[8],s=n[1],r=n[5],y=n[9],d=n[2],u=n[6],c=n[10],m=1-1e-5;switch(t){case we.XYZ:{this.y=a(I(o,-1,1)),ue(o)<m?(this.x=ne(-y,c),this.z=ne(-l,i)):(this.x=ne(u,r),this.z=0);break}case we.YXZ:{this.x=a(-I(y,-1,1)),ue(y)<m?(this.y=ne(o,c),this.z=ne(s,r)):(this.y=ne(-d,i),this.z=0);break}case we.ZXY:{this.x=a(I(u,-1,1)),ue(u)<m?(this.y=ne(-d,c),this.z=ne(-l,r)):(this.y=0,this.z=ne(s,i));break}case we.ZYX:{this.y=a(-I(d,-1,1)),ue(d)<m?(this.x=ne(u,c),this.z=ne(s,i)):(this.x=0,this.z=ne(-l,r));break}case we.YZX:{this.z=a(I(s,-1,1)),ue(s)<m?(this.x=ne(-y,r),this.y=ne(-d,i)):(this.x=0,this.y=ne(o,c));break}case we.XZY:{this.z=a(-I(l,-1,1)),ue(l)<m?(this.x=ne(u,r),this.y=ne(o,i)):(this.x=ne(-y,c),this.y=0);break}}return this.order=t,this}},{key:\"setFromQuaternion\",value:function(e,a){return Pe.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Pe,a)}},{key:\"setFromVector3\",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(e.x,e.y,e.z,a)}},{key:\"reorder\",value:function(e){return m.setFromEuler(this),this.setFromQuaternion(m,e)}},{key:\"equals\",value:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.order===this.order}}],[{key:\"defaultOrder\",get:function(){return we.XYZ}}]),a}(),be=new pe,a=new pe,b=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pe(1,0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.normal=a,this.constant=n}return n(t,[{key:\"set\",value:function(e,a){return this.normal.copy(e),this.constant=a,this}},{key:\"setComponents\",value:function(e,a,t,n){return this.normal.set(e,a,t),this.constant=n,this}},{key:\"copy\",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromNormalAndCoplanarPoint\",value:function(e,a){return this.normal.copy(e),this.constant=-a.dot(this.normal),this}},{key:\"setFromCoplanarPoints\",value:function(e,t,n){var i=be.subVectors(n,t).cross(a.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,be),this}},{key:\"normalize\",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:\"negate\",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:\"distanceToPoint\",value:function(e){return this.normal.dot(e)+this.constant}},{key:\"distanceToSphere\",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:\"projectPoint\",value:function(e,a){return a.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:\"coplanarPoint\",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:\"translate\",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:\"intersectLine\",value:function(e,a){var n=e.delta(be),i=this.normal.dot(n);if(0===i)0===this.distanceToPoint(e.start)&&a.copy(e.start);else{var l=-(e.start.dot(this.normal)+this.constant)/i;0<=l&&1>=l&&a.copy(n).multiplyScalar(l).add(e.start)}return a}},{key:\"intersectsLine\",value:function(e){var a=this.distanceToPoint(e.start),t=this.distanceToPoint(e.end);return 0>a&&0<t||0>t&&0<a}},{key:\"intersectsBox\",value:function(e){return e.intersectsPlane(this)}},{key:\"intersectsSphere\",value:function(e){return e.intersectsPlane(this)}},{key:\"equals\",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}]),t}(),Ee=new pe,De=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new b,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new b,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new b,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new b,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new b,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new b;e(this,a),this.planes=[t,n,i,l,o,s]}return n(a,[{key:\"set\",value:function(e,a,t,n,i,l){var o=this.planes;return o[0].copy(e),o[1].copy(a),o[2].copy(t),o[3].copy(n),o[4].copy(i),o[5].copy(l),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"copy\",value:function(e){var a,t=this.planes;for(a=0;6>a;++a)t[a].copy(e.planes[a]);return this}},{key:\"setFromMatrix\",value:function(e){var a=this.planes,t=e.elements,n=t[0],i=t[1],l=t[2],o=t[3],s=t[4],r=t[5],y=t[6],d=t[7],u=t[8],c=t[9],m=t[10],x=t[11],p=t[12],v=t[13],k=t[14],g=t[15];return a[0].setComponents(o-n,d-s,x-u,g-p).normalize(),a[1].setComponents(o+n,d+s,x+u,g+p).normalize(),a[2].setComponents(o+i,d+r,x+c,g+v).normalize(),a[3].setComponents(o-i,d-r,x-c,g-v).normalize(),a[4].setComponents(o-l,d-y,x-m,g-k).normalize(),a[5].setComponents(o+l,d+y,x+m,g+k).normalize(),this}},{key:\"intersectsSphere\",value:function(e){var a,t,n=this.planes,l=e.center,o=-e.radius,s=!0;for(a=0;6>a;++a)if(t=n[a].distanceToPoint(l),t<o){s=!1;break}return s}},{key:\"intersectsBox\",value:function(e){var a,t,n=this.planes,l=e.min,o=e.max;for(a=0;6>a;++a)if(t=n[a],Ee.x=0<t.normal.x?o.x:l.x,Ee.y=0<t.normal.y?o.y:l.y,Ee.z=0<t.normal.z?o.z:l.z,0>t.distanceToPoint(Ee))return!1;return!0}},{key:\"containsPoint\",value:function(e){var a,t=this.planes,n=!0;for(a=0;6>a;++a)if(0>t[a].distanceToPoint(e)){n=!1;break}return n}}]),a}(),Fe=new pe,Ve=new pe,Le=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new pe;e(this,a),this.start=t,this.end=n}return n(a,[{key:\"set\",value:function(e,a){return this.start.copy(e),this.end.copy(a),this}},{key:\"copy\",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pe;return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:\"delta\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pe;return e.subVectors(this.end,this.start)}},{key:\"lengthSquared\",value:function(){return this.start.distanceToSquared(this.end)}},{key:\"length\",value:function(){return this.start.distanceTo(this.end)}},{key:\"at\",value:function(e,a){return this.delta(a).multiplyScalar(e).add(this.start)}},{key:\"closestPointToPointParameter\",value:function(e,a){Fe.subVectors(e,this.start),Ve.subVectors(this.end,this.start);var n=Ve.dot(Ve),i=Ve.dot(Fe),l=a?me(ce(i/n,0),1):i/n;return l}},{key:\"closestPointToPoint\",value:function(e){var a=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new pe,i=this.closestPointToPointParameter(e,a);return this.delta(n).multiplyScalar(i).add(this.start)}},{key:\"equals\",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}]),a}(),Ne=new pe,Oe=new pe,Be=new pe,c=function(){function a(){e(this,a),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return n(a,[{key:\"set\",value:function(e,a,t,n,i,l,o,s,r,y,d,u,c,m,x,p){var v=this.elements;return v[0]=e,v[4]=a,v[8]=t,v[12]=n,v[1]=i,v[5]=l,v[9]=o,v[13]=s,v[2]=r,v[6]=y,v[10]=d,v[14]=u,v[3]=c,v[7]=m,v[11]=x,v[15]=p,this}},{key:\"identity\",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:\"copy\",value:function(e){var a=e.elements,t=this.elements;return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],this}},{key:\"clone\",value:function(){return new this.constructor().fromArray(this.elements)}},{key:\"fromArray\",value:function(e){var a,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(a=0;16>a;++a)n[a]=e[a+t];return this}},{key:\"toArray\",value:function(){var e,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(e=0;16>e;++e)a[e+t]=n[e];return a}},{key:\"getMaxScaleOnAxis\",value:function(){var e=this.elements,a=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],t=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return oe(ce(a,t,n))}},{key:\"copyPosition\",value:function(e){var a=this.elements,t=e.elements;return a[12]=t[12],a[13]=t[13],a[14]=t[14],this}},{key:\"setPosition\",value:function(e){var a=this.elements;return a[12]=e.x,a[13]=e.y,a[14]=e.z,this}},{key:\"extractBasis\",value:function(e,a,t){return e.setFromMatrixColumn(this,0),a.setFromMatrixColumn(this,1),t.setFromMatrixColumn(this,2),this}},{key:\"makeBasis\",value:function(e,a,t){return this.set(e.x,a.x,t.x,0,e.y,a.y,t.y,0,e.z,a.z,t.z,0,0,0,0,1),this}},{key:\"extractRotation\",value:function(e){var a=this.elements,t=e.elements,n=1/Ne.setFromMatrixColumn(e,0).length(),i=1/Ne.setFromMatrixColumn(e,1).length(),l=1/Ne.setFromMatrixColumn(e,2).length();return a[0]=t[0]*n,a[1]=t[1]*n,a[2]=t[2]*n,a[3]=0,a[4]=t[4]*i,a[5]=t[5]*i,a[6]=t[6]*i,a[7]=0,a[8]=t[8]*l,a[9]=t[9]*l,a[10]=t[10]*l,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this}},{key:\"makeRotationFromEuler\",value:function(t){var n,i,l,o,s,r,u,m,p,v,k,g,h=this.elements,S=t.x,x=t.y,y=t.z,z=se(S),a=re(S),I=se(x),c=re(x),d=se(y),e=re(y);switch(t.order){case we.XYZ:{n=z*d,i=z*e,l=a*d,o=a*e,h[0]=I*d,h[4]=-I*e,h[8]=c,h[1]=i+l*c,h[5]=n-o*c,h[9]=-a*I,h[2]=o-n*c,h[6]=l+i*c,h[10]=z*I;break}case we.YXZ:{s=I*d,r=I*e,u=c*d,m=c*e,h[0]=s+m*a,h[4]=u*a-r,h[8]=z*c,h[1]=z*e,h[5]=z*d,h[9]=-a,h[2]=r*a-u,h[6]=m+s*a,h[10]=z*I;break}case we.ZXY:{s=I*d,r=I*e,u=c*d,m=c*e,h[0]=s-m*a,h[4]=-z*e,h[8]=u+r*a,h[1]=r+u*a,h[5]=z*d,h[9]=m-s*a,h[2]=-z*c,h[6]=a,h[10]=z*I;break}case we.ZYX:{n=z*d,i=z*e,l=a*d,o=a*e,h[0]=I*d,h[4]=l*c-i,h[8]=n*c+o,h[1]=I*e,h[5]=o*c+n,h[9]=i*c-l,h[2]=-c,h[6]=a*I,h[10]=z*I;break}case we.YZX:{p=z*I,v=z*c,k=a*I,g=a*c,h[0]=I*d,h[4]=g-p*e,h[8]=k*e+v,h[1]=e,h[5]=z*d,h[9]=-a*d,h[2]=-c*d,h[6]=v*e+k,h[10]=p-g*e;break}case we.XZY:{p=z*I,v=z*c,k=a*I,g=a*c,h[0]=I*d,h[4]=-e,h[8]=c*d,h[1]=p*e+g,h[5]=z*d,h[9]=v*e-k,h[2]=k*e-v,h[6]=a*d,h[10]=g*e+p;break}}return h[3]=0,h[7]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,this}},{key:\"makeRotationFromQuaternion\",value:function(e){return this.compose(Ne.set(0,0,0),e,Oe.set(1,1,1))}},{key:\"lookAt\",value:function(e,a,t){var n=this.elements,i=Ne,l=Oe,o=Be;return o.subVectors(e,a),0===o.lengthSquared()&&(o.z=1),o.normalize(),i.crossVectors(t,o),0===i.lengthSquared()&&(1===ue(t.z)?o.x+=1e-4:o.z+=1e-4,o.normalize(),i.crossVectors(t,o)),i.normalize(),l.crossVectors(o,i),n[0]=i.x,n[4]=l.x,n[8]=o.x,n[1]=i.y,n[5]=l.y,n[9]=o.y,n[2]=i.z,n[6]=l.z,n[10]=o.z,this}},{key:\"multiplyMatrices\",value:function(e,a){var t=this.elements,n=e.elements,i=a.elements,l=n[0],o=n[4],s=n[8],r=n[12],y=n[1],d=n[5],u=n[9],c=n[13],m=n[2],x=n[6],p=n[10],v=n[14],k=n[3],g=n[7],z=n[11],h=n[15],f=i[0],S=i[4],I=i[8],C=i[12],w=i[1],T=i[5],P=i[9],b=i[13],E=i[2],D=i[6],F=i[10],V=i[14],L=i[3],N=i[7],O=i[11],B=i[15];return t[0]=l*f+o*w+s*E+r*L,t[4]=l*S+o*T+s*D+r*N,t[8]=l*I+o*P+s*F+r*O,t[12]=l*C+o*b+s*V+r*B,t[1]=y*f+d*w+u*E+c*L,t[5]=y*S+d*T+u*D+c*N,t[9]=y*I+d*P+u*F+c*O,t[13]=y*C+d*b+u*V+c*B,t[2]=m*f+x*w+p*E+v*L,t[6]=m*S+x*T+p*D+v*N,t[10]=m*I+x*P+p*F+v*O,t[14]=m*C+x*b+p*V+v*B,t[3]=k*f+g*w+z*E+h*L,t[7]=k*S+g*T+z*D+h*N,t[11]=k*I+g*P+z*F+h*O,t[15]=k*C+g*b+z*V+h*B,this}},{key:\"multiply\",value:function(e){return this.multiplyMatrices(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyMatrices(e,this)}},{key:\"multiplyScalar\",value:function(e){var a=this.elements;return a[0]*=e,a[4]*=e,a[8]*=e,a[12]*=e,a[1]*=e,a[5]*=e,a[9]*=e,a[13]*=e,a[2]*=e,a[6]*=e,a[10]*=e,a[14]*=e,a[3]*=e,a[7]*=e,a[11]*=e,a[15]*=e,this}},{key:\"determinant\",value:function(){var e=this.elements,a=e[0],t=e[4],n=e[8],i=e[12],l=e[1],o=e[5],s=e[9],r=e[13],y=e[2],d=e[6],u=e[10],c=e[14],m=e[3],x=e[7],p=e[11],v=e[15],k=a*o,g=a*s,z=a*r,h=t*l,f=t*s,S=t*r,I=n*l,C=n*o,w=n*r,T=i*l,P=i*o,b=i*s;return m*(b*d-w*d-P*u+S*u+C*c-f*c)+x*(g*c-z*u+T*u-I*c+w*y-b*y)+p*(z*d-k*c-T*d+h*c+P*y-S*y)+v*(-C*y-g*d+k*u+I*d-h*u+f*y)}},{key:\"getInverse\",value:function(e){var a,t=this.elements,n=e.elements,i=n[0],l=n[1],o=n[2],s=n[3],r=n[4],y=n[5],d=n[6],u=n[7],c=n[8],m=n[9],x=n[10],p=n[11],v=n[12],k=n[13],g=n[14],z=n[15],h=m*g*u-k*x*u+k*d*p-y*g*p-m*d*z+y*x*z,f=v*x*u-c*g*u-v*d*p+r*g*p+c*d*z-r*x*z,S=c*k*u-v*m*u+v*y*p-r*k*p-c*y*z+r*m*z,I=v*m*d-c*k*d-v*y*x+r*k*x+c*y*g-r*m*g,C=i*h+l*f+o*S+s*I;return 0===C?(console.error(\"Can't invert matrix, determinant is zero\",e),this.identity()):(a=1/C,t[0]=h*a,t[1]=(k*x*s-m*g*s-k*o*p+l*g*p+m*o*z-l*x*z)*a,t[2]=(y*g*s-k*d*s+k*o*u-l*g*u-y*o*z+l*d*z)*a,t[3]=(m*d*s-y*x*s-m*o*u+l*x*u+y*o*p-l*d*p)*a,t[4]=f*a,t[5]=(c*g*s-v*x*s+v*o*p-i*g*p-c*o*z+i*x*z)*a,t[6]=(v*d*s-r*g*s-v*o*u+i*g*u+r*o*z-i*d*z)*a,t[7]=(r*x*s-c*d*s+c*o*u-i*x*u-r*o*p+i*d*p)*a,t[8]=S*a,t[9]=(v*m*s-c*k*s-v*l*p+i*k*p+c*l*z-i*m*z)*a,t[10]=(r*k*s-v*y*s+v*l*u-i*k*u-r*l*z+i*y*z)*a,t[11]=(c*y*s-r*m*s-c*l*u+i*m*u+r*l*p-i*y*p)*a,t[12]=I*a,t[13]=(c*k*o-v*m*o+v*l*x-i*k*x-c*l*g+i*m*g)*a,t[14]=(v*y*o-r*k*o-v*l*d+i*k*d+r*l*g-i*y*g)*a,t[15]=(r*m*o-c*y*o+c*l*d-i*m*d-r*l*x+i*y*x)*a),this}},{key:\"transpose\",value:function(){var e,a=this.elements;return e=a[1],a[1]=a[4],a[4]=e,e=a[2],a[2]=a[8],a[8]=e,e=a[6],a[6]=a[9],a[9]=e,e=a[3],a[3]=a[12],a[12]=e,e=a[7],a[7]=a[13],a[13]=e,e=a[11],a[11]=a[14],a[14]=e,this}},{key:\"scale\",value:function(e,a,t){var n=this.elements;return n[0]*=e,n[4]*=a,n[8]*=t,n[1]*=e,n[5]*=a,n[9]*=t,n[2]*=e,n[6]*=a,n[10]*=t,n[3]*=e,n[7]*=a,n[11]*=t,this}},{key:\"makeScale\",value:function(e,a,t){return this.set(e,0,0,0,0,a,0,0,0,0,t,0,0,0,0,1),this}},{key:\"makeTranslation\",value:function(e,a,t){return this.set(1,0,0,e,0,1,0,a,0,0,1,t,0,0,0,1),this}},{key:\"makeRotationX\",value:function(e){var a=se(e),t=re(e);return this.set(1,0,0,0,0,a,-t,0,0,t,a,0,0,0,0,1),this}},{key:\"makeRotationY\",value:function(e){var a=se(e),t=re(e);return this.set(a,0,t,0,0,1,0,0,-t,0,a,0,0,0,0,1),this}},{key:\"makeRotationZ\",value:function(e){var a=se(e),t=re(e);return this.set(a,-t,0,0,t,a,0,0,0,0,1,0,0,0,0,1),this}},{key:\"makeRotationAxis\",value:function(e,a){var n=se(a),i=re(a),l=1-n,t=e.x,o=e.y,s=e.z,r=l*t,y=l*o;return this.set(r*t+n,r*o-i*s,r*s+i*o,0,r*o+i*s,y*o+n,y*s-i*t,0,r*s-i*o,y*s+i*t,l*s*s+n,0,0,0,0,1),this}},{key:\"makeShear\",value:function(e,a,t){return this.set(1,a,t,0,e,1,t,0,e,a,1,0,0,0,0,1),this}},{key:\"compose\",value:function(e,a,t){var n=this.elements,i=a.x,l=a.y,o=a.z,s=a.w,r=i+i,y=l+l,d=o+o,u=i*r,c=i*y,m=i*d,x=l*y,p=l*d,v=o*d,k=s*r,g=s*y,z=s*d,h=t.x,f=t.y,S=t.z;return n[0]=(1-(x+v))*h,n[1]=(c+z)*h,n[2]=(m-g)*h,n[3]=0,n[4]=(c-z)*f,n[5]=(1-(u+v))*f,n[6]=(p+k)*f,n[7]=0,n[8]=(m+g)*S,n[9]=(p-k)*S,n[10]=(1-(u+x))*S,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}},{key:\"decompose\",value:function(e,a,t){var n=this.elements,i=n[0],l=n[1],o=n[2],s=n[4],r=n[5],y=n[6],d=n[8],u=n[9],c=n[10],m=this.determinant(),x=Ne.set(i,l,o).length()*(0>m?-1:1),p=Ne.set(s,r,y).length(),v=Ne.set(d,u,c).length(),k=1/x,g=1/p,z=1/v;return e.x=n[12],e.y=n[13],e.z=n[14],n[0]*=k,n[1]*=k,n[2]*=k,n[4]*=g,n[5]*=g,n[6]*=g,n[8]*=z,n[9]*=z,n[10]*=z,a.setFromRotationMatrix(this),n[0]=i,n[1]=l,n[2]=o,n[4]=s,n[5]=r,n[6]=y,n[8]=d,n[9]=u,n[10]=c,t.x=x,t.y=p,t.z=v,this}},{key:\"makePerspective\",value:function(e,a,t,n,i,l){var o=this.elements;return o[0]=2*i/(a-e),o[4]=0,o[8]=(a+e)/(a-e),o[12]=0,o[1]=0,o[5]=2*i/(t-n),o[9]=(t+n)/(t-n),o[13]=0,o[2]=0,o[6]=0,o[10]=-(l+i)/(l-i),o[14]=-2*l*i/(l-i),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:\"makeOrthographic\",value:function(e,a,t,n,i,l){var o=this.elements,s=1/(a-e),r=1/(t-n),y=1/(l-i);return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-((a+e)*s),o[1]=0,o[5]=2*r,o[9]=0,o[13]=-((t+n)*r),o[2]=0,o[6]=0,o[10]=-2*y,o[14]=-((l+i)*y),o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:\"equals\",value:function(e){var a,t=this.elements,n=e.elements,l=!0;for(a=0;l&&16>a;++a)t[a]!==n[a]&&(l=!1);return l}}]),a}(),Re=[new pe,new pe,new pe,new pe],Ae=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new pe;e(this,a),this.origin=t,this.direction=n}return n(a,[{key:\"set\",value:function(e,a){return this.origin.copy(e),this.direction.copy(a),this}},{key:\"copy\",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"at\",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new pe;return a.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:\"lookAt\",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:\"recast\",value:function(e){return this.origin.copy(this.at(e,Re[0])),this}},{key:\"closestPointToPoint\",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new pe,t=a.subVectors(e,this.origin).dot(this.direction);return 0<=t?a.copy(this.direction).multiplyScalar(t).add(this.origin):a.copy(this.origin)}},{key:\"distanceSquaredToPoint\",value:function(e){var a=Re[0].subVectors(e,this.origin).dot(this.direction);return 0>a?this.origin.distanceToSquared(e):Re[0].copy(this.direction).multiplyScalar(a).add(this.origin).distanceToSquared(e)}},{key:\"distanceToPoint\",value:function(e){return oe(this.distanceSquaredToPoint(e))}},{key:\"distanceToPlane\",value:function(e){var a=e.normal.dot(this.direction),n=0===a?0===e.distanceToPoint(this.origin)?0:-1:-(this.origin.dot(e.normal)+e.constant)/a;return 0<=n?n:null}},{key:\"distanceSquaredToSegment\",value:function(e,a,t,n){var i,l,o,s,r,y=Re[0].copy(e).add(a).multiplyScalar(.5),d=Re[1].copy(a).sub(e).normalize(),u=Re[2].copy(this.origin).sub(y),m=.5*e.distanceTo(a),x=-this.direction.dot(d),p=u.dot(this.direction),v=-u.dot(d),k=u.lengthSq(),c=ue(1-x*x);return 0<c?(i=x*v-p,l=x*p-v,o=m*c,0<=i?l>=-o?l<=o?(s=1/c,i*=s,l*=s,r=i*(i+x*l+2*p)+l*(x*i+l+2*v)+k):(l=m,i=ce(0,-(x*l+p)),r=-i*i+l*(l+2*v)+k):(l=-m,i=ce(0,-(x*l+p)),r=-i*i+l*(l+2*v)+k):l<=-o?(i=ce(0,-(-x*m+p)),l=0<i?-m:me(ce(-m,-v),m),r=-i*i+l*(l+2*v)+k):l<=o?(i=0,l=me(ce(-m,-v),m),r=l*(l+2*v)+k):(i=ce(0,-(x*m+p)),l=0<i?m:me(ce(-m,-v),m),r=-i*i+l*(l+2*v)+k)):(l=0<x?-m:m,i=ce(0,-(x*l+p)),r=-i*i+l*(l+2*v)+k),void 0!==t&&t.copy(this.direction).multiplyScalar(i).add(this.origin),void 0!==n&&n.copy(d).multiplyScalar(l).add(y),r}},{key:\"intersectSphere\",value:function(e){var a,t,n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new pe,l=Re[0].subVectors(e.center,this.origin),o=l.dot(this.direction),s=l.dot(l)-o*o,r=e.radius*e.radius,y=null;return s<=r&&(a=oe(r-s),t=o-a,n=o+a,(0<=t||0<=n)&&(y=0>t?this.at(n,i):this.at(t,i))),y}},{key:\"intersectsSphere\",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:\"intersectPlane\",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new pe,n=this.distanceToPlane(e);return null===n?null:this.at(n,a)}},{key:\"intersectsPlane\",value:function(e){var a=e.distanceToPoint(this.origin);return 0===a||0>e.normal.dot(this.direction)*a}},{key:\"intersectBox\",value:function(e){var a,t,n,i,l,o,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new pe,r=this.origin,y=this.direction,d=e.min,u=e.max,c=1/y.x,m=1/y.y,x=1/y.z,p=null;return 0<=c?(a=(d.x-r.x)*c,t=(u.x-r.x)*c):(a=(u.x-r.x)*c,t=(d.x-r.x)*c),0<=m?(n=(d.y-r.y)*m,i=(u.y-r.y)*m):(n=(u.y-r.y)*m,i=(d.y-r.y)*m),a<=i&&n<=t&&((n>a||a!==a)&&(a=n),(i<t||t!==t)&&(t=i),0<=x?(l=(d.z-r.z)*x,o=(u.z-r.z)*x):(l=(u.z-r.z)*x,o=(d.z-r.z)*x),a<=o&&l<=t&&((l>a||a!==a)&&(a=l),(o<t||t!==t)&&(t=o),0<=t&&(p=this.at(0<=a?a:t,s)))),p}},{key:\"intersectsBox\",value:function(e){return null!==this.intersectBox(e,Re[0])}},{key:\"intersectTriangle\",value:function(e,a,t,n,i){var l,o,s,r,y,d=this.direction,u=Re[0],c=Re[1],m=Re[2],x=Re[3],p=null;return c.subVectors(a,e),m.subVectors(t,e),x.crossVectors(c,m),l=d.dot(x),0===l||n&&0<l||(0<l?o=1:(o=-1,l=-l),u.subVectors(this.origin,e),s=o*d.dot(m.crossVectors(u,m)),0<=s&&(r=o*d.dot(c.cross(u)),0<=r&&s+r<=l&&(y=-o*u.dot(x),0<=y&&(p=this.at(y/l,i))))),p}},{key:\"applyMatrix4\",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:\"equals\",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),a}(),Me=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,a),this.radius=t,this.phi=n,this.theta=i}return n(a,[{key:\"set\",value:function(e,a,t){return this.radius=e,this.phi=a,this.theta=t,this}},{key:\"copy\",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"makeSafe\",value:function(){return this.phi=ce(1e-6,me(te-1e-6,this.phi)),this}},{key:\"setFromVector3\",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:\"setFromCartesianCoords\",value:function(e,a,t){return this.radius=oe(e*e+a*a+t*t),0===this.radius?(this.theta=0,this.phi=0):(this.theta=ne(e,t),this.phi=le(me(ce(a/this.radius,-1),1))),this}}]),a}(),qe=function(){function a(){e(this,a),this.elements=new Float32Array([1,0,0,1,0,1])}return n(a,[{key:\"set\",value:function(a,t,n,i,l,o){var s=this.elements;return s[0]=a,s[1]=t,s[3]=i,s[2]=n,s[4]=l,s[5]=o,this}},{key:\"identity\",value:function(){return this.set(1,0,0,1,0,1),this}},{key:\"copy\",value:function(e){var a=e.elements;return this.set(a[0],a[1],a[2],a[3],a[4],a[5]),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"toMatrix3\",value:function(e){var a=e.elements;e.set(a[0],a[1],a[2],a[1],a[3],a[4],a[2],a[4],a[5])}},{key:\"add\",value:function(e){var a=this.elements,t=e.elements;return a[0]+=t[0],a[1]+=t[1],a[3]+=t[3],a[2]+=t[2],a[4]+=t[4],a[5]+=t[5],this}},{key:\"norm\",value:function(){var a=this.elements,e=a[1]*a[1],t=a[2]*a[2],n=a[4]*a[4];return oe(a[0]*a[0]+e+t+e+a[3]*a[3]+n+t+n+a[5]*a[5])}},{key:\"off\",value:function(){var a=this.elements;return oe(2*(a[1]*a[1]+a[2]*a[2]+a[4]*a[4]))}},{key:\"applyToVector3\",value:function(a){var t=a.x,n=a.y,i=a.z,l=this.elements;return a.x=l[0]*t+l[1]*n+l[2]*i,a.y=l[1]*t+l[3]*n+l[4]*i,a.z=l[2]*t+l[4]*n+l[5]*i,a}},{key:\"equals\",value:function(e){var a,t=this.elements,n=e.elements,l=!0;for(a=0;l&&6>a;++a)t[a]!==n[a]&&(l=!1);return l}}],[{key:\"calculateIndex\",value:function(e,a){return 3-(3-e)*(2-e)/2+a}}]),a}(),Ye=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;e(this,a),this.x=t,this.y=n,this.z=i,this.w=l}return n(a,[{key:\"set\",value:function(e,a,t,n){return this.x=e,this.y=a,this.z=t,this.w=n,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:\"fromArray\",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[a],this.y=e[a+1],this.z=e[a+2],this.w=e[a+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[a]=this.x,e[a+1]=this.y,e[a+2]=this.z,e[a+3]=this.w,e}},{key:\"setAxisAngleFromQuaternion\",value:function(e){this.w=2*le(e.w);var a=oe(1-e.w*e.w);return 1e-4>a?(this.x=1,this.y=0,this.z=0):(this.x=e.x/a,this.y=e.y/a,this.z=e.z/a),this}},{key:\"setAxisAngleFromRotationMatrix\",value:function(e){var a,t,n,i,l,o,r,d,u,c,m,p=.01,v=.1,k=e.elements,g=k[0],h=k[4],f=k[8],S=k[1],I=k[5],C=k[9],w=k[2],T=k[6],P=k[10];return ue(h-S)<p&&ue(f-w)<p&&ue(C-T)<p?ue(h+S)<v&&ue(f+w)<v&&ue(C+T)<v&&ue(g+I+P-3)<v?this.set(1,0,0,0):(a=te,l=(g+1)/2,o=(I+1)/2,r=(P+1)/2,d=(h+S)/4,u=(f+w)/4,c=(C+T)/4,l>o&&l>r?l<p?(t=0,n=.707106781,i=.707106781):(t=oe(l),n=d/t,i=u/t):o>r?o<p?(t=.707106781,n=0,i=.707106781):(n=oe(o),t=d/n,i=c/n):r<p?(t=.707106781,n=.707106781,i=0):(i=oe(r),t=u/i,n=c/i),this.set(t,n,i,a)):(m=oe((T-C)*(T-C)+(f-w)*(f-w)+(S-h)*(S-h)),.001>ue(m)&&(m=1),this.x=(T-C)/m,this.y=(f-w)/m,this.z=(S-h)/m,this.w=le((g+I+P-1)/2)),this}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:\"addVectors\",value:function(e,a){return this.x=e.x+a.x,this.y=e.y+a.y,this.z=e.z+a.z,this.w=e.w+a.w,this}},{key:\"addScaledVector\",value:function(e,a){return this.x+=e.x*a,this.y+=e.y*a,this.z+=e.z*a,this.w+=e.w*a,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:\"subVectors\",value:function(e,a){return this.x=e.x-a.x,this.y=e.y-a.y,this.z=e.z-a.z,this.w=e.w-a.w,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:\"multiplyVectors\",value:function(e,a){return this.x=e.x*a.x,this.y=e.y*a.y,this.z=e.z*a.z,this.w=e.w*a.w,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this}},{key:\"applyMatrix4\",value:function(a){var t=this.x,n=this.y,i=this.z,l=this.w,o=a.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*l,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*l,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*l,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*l,this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:\"manhattanLength\",value:function(){return ue(this.x)+ue(this.y)+ue(this.z)+ue(this.w)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:\"length\",value:function(){return oe(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:\"manhattanDistanceTo\",value:function(e){return ue(this.x-e.x)+ue(this.y-e.y)+ue(this.z-e.z)+ue(this.w-e.w)}},{key:\"distanceToSquared\",value:function(e){var a=this.x-e.x,t=this.y-e.y,n=this.z-e.z,i=this.w-e.w;return a*a+t*t+n*n+i*i}},{key:\"distanceTo\",value:function(e){return oe(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=me(this.x,e.x),this.y=me(this.y,e.y),this.z=me(this.z,e.z),this.w=me(this.w,e.w),this}},{key:\"max\",value:function(e){return this.x=ce(this.x,e.x),this.y=ce(this.y,e.y),this.z=ce(this.z,e.z),this.w=ce(this.w,e.w),this}},{key:\"clamp\",value:function(e,a){return this.x=ce(e.x,me(a.x,this.x)),this.y=ce(e.y,me(a.y,this.y)),this.z=ce(e.z,me(a.z,this.z)),this.w=ce(e.w,me(a.w,this.w)),this}},{key:\"floor\",value:function(){return this.x=ye(this.x),this.y=ye(this.y),this.z=ye(this.z),this.w=ye(this.w),this}},{key:\"ceil\",value:function(){return this.x=de(this.x),this.y=de(this.y),this.z=de(this.z),this.w=de(this.w),this}},{key:\"round\",value:function(){return this.x=ie(this.x),this.y=ie(this.y),this.z=ie(this.z),this.w=ie(this.w),this}},{key:\"lerp\",value:function(e,a){return this.x+=(e.x-this.x)*a,this.y+=(e.y-this.y)*a,this.z+=(e.z-this.z)*a,this.w+=(e.w-this.w)*a,this}},{key:\"lerpVectors\",value:function(e,a,t){return this.subVectors(a,e).multiplyScalar(t).add(e)}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}]),a}(),Xe={AIR:0,SOLID:1},Ze=function(){function a(t){e(this,a),this.type=t;for(var n=arguments.length,i=Array(1<n?n-1:0),l=1;l<n;l++)i[l-1]=arguments[l];this.children=i,this.boundingBox=null}return n(a,[{key:\"getBoundingBox\",value:function(){return null===this.boundingBox&&(this.boundingBox=this.computeBoundingBox()),this.boundingBox}},{key:\"computeBoundingBox\",value:function(){var e,a,t=this.children,n=new v;for(e=0,a=t.length;e<a;++e)n.union(t[e].getBoundingBox());return n}}]),a}(),Ue=function(a){function t(){var a;e(this,t);for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];return x(this,(a=l(t)).call.apply(a,[this,xe.UNION].concat(i)))}return i(t,a),n(t,[{key:\"updateMaterialIndex\",value:function(e,a,t){var n=t.materialIndices[e];n!==Xe.AIR&&a.setMaterialIndex(e,n)}},{key:\"selectEdge\",value:function(e,a,t){return t?e.t>a.t?e:a:e.t<a.t?e:a}}]),t}(Ze),_e=function(a){function t(){var a;e(this,t);for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];return x(this,(a=l(t)).call.apply(a,[this,xe.DIFFERENCE].concat(i)))}return i(t,a),n(t,[{key:\"updateMaterialIndex\",value:function(e,a,t){t.materialIndices[e]!==Xe.AIR&&a.setMaterialIndex(e,Xe.AIR)}},{key:\"selectEdge\",value:function(e,a,t){return t?e.t<a.t?e:a:e.t>a.t?e:a}}]),t}(Ze),je=function(a){function t(){var a;e(this,t);for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];return x(this,(a=l(t)).call.apply(a,[this,xe.INTERSECTION].concat(i)))}return i(t,a),n(t,[{key:\"updateMaterialIndex\",value:function(e,a,t){var n=t.materialIndices[e];a.setMaterialIndex(e,a.materialIndices[e]!==Xe.AIR&&n!==Xe.AIR?n:Xe.AIR)}},{key:\"selectEdge\",value:function(e,a,t){return t?e.t<a.t?e:a:e.t>a.t?e:a}}]),t}(Ze),Ge=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;e(this,a),this.runLengths=t,this.data=n}return n(a,null,[{key:\"encode\",value:function(e){var t,n,o=[],s=[],r=e[0],y=1;for(t=1,n=e.length;t<n;++t)r===e[t]?++y:(o.push(y),s.push(r),r=e[t],y=1);return o.push(y),s.push(r),new a(o,s)}},{key:\"decode\",value:function(e,a){var t,n,l,o,s,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],y=0;for(n=0,o=a.length;n<o;++n)for(t=a[n],l=0,s=e[n];l<s;++l)r[y++]=t;return r}}]),a}(),Qe=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];e(this,a),this.value=t,this.done=n}return n(a,[{key:\"reset\",value:function(){this.value=null,this.done=!1}}]),a}(),He=new pe,Ke=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new pe;e(this,a),this.min=t,this.max=n,this.children=null}return n(a,[{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pe;return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getDimensions\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pe;return e.subVectors(this.max,this.min)}},{key:\"split\",value:function(){var e,a,t=this.min,n=this.max,l=this.getCenter(He),o=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)a=Je[e],o[e]=new this.constructor(new pe(0===a[0]?t.x:l.x,0===a[1]?t.y:l.y,0===a[2]?t.z:l.z),new pe(0===a[0]?l.x:n.x,0===a[1]?l.y:n.y,0===a[2]?l.z:n.z))}}]),a}(),Je=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],We=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],$e=new pe,ea=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,a),this.min=t,this.size=n,this.children=null}return n(a,[{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pe;return e.copy(this.min).addScalar(.5*this.size)}},{key:\"getDimensions\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pe;return e.set(this.size,this.size,this.size)}},{key:\"split\",value:function(){var e,a,t=this.min,n=this.getCenter($e),l=.5*this.size,o=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)a=Je[e],o[e]=new this.constructor(new pe(0===a[0]?t.x:n.x,0===a[1]?t.y:n.y,0===a[2]?t.z:n.z),l)}},{key:\"max\",get:function(){return this.min.clone().addScalar(this.size)}}]),a}(),aa=new v,ta=function(){function a(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;e(this,a),this.octree=t,this.region=n,this.cull=null!==n,this.result=new Qe,this.trace=null,this.indices=null,this.reset()}return n(a,[{key:\"reset\",value:function(){var e=this.octree.root;return this.trace=[],this.indices=[],null!==e&&(aa.min=e.min,aa.max=e.max,(!this.cull||this.region.intersectsBox(aa))&&(this.trace.push(e),this.indices.push(0))),this.result.reset(),this}},{key:\"next\",value:function(){for(var e,a,t,n=this.cull,i=this.region,l=this.indices,o=this.trace,s=null,r=o.length-1;null===s&&0<=r;)if(e=l[r]++,a=o[r].children,!(8>e))o.pop(),l.pop(),--r;else if(null!==a){if(t=a[e],n&&(aa.min=t.min,aa.max=t.max,!i.intersectsBox(aa)))continue;o.push(t),l.push(0),++r}else s=o.pop(),l.pop();return this.result.value=s,this.result.done=null===s,this.result}},{key:\"return\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),a}(),na=[new pe,new pe,new pe],ia=new v,la=new Ae,r=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],oa=0,sa=function(){function a(){e(this,a)}return n(a,null,[{key:\"intersectOctree\",value:function(e,a,t){var n,i,l,o,s,r,y,d,u,c=ia.min.set(0,0,0),m=ia.max.subVectors(e.max,e.min),x=e.getDimensions(na[0]),p=na[1].copy(x).multiplyScalar(.5),v=la.origin.copy(a.ray.origin),k=la.direction.copy(a.ray.direction);v.sub(e.getCenter(na[2])).add(p),oa=0,0>k.x&&(v.x=x.x-v.x,k.x=-k.x,oa|=4),0>k.y&&(v.y=x.y-v.y,k.y=-k.y,oa|=2),0>k.z&&(v.z=x.z-v.z,k.z=-k.z,oa|=1),n=1/k.x,i=1/k.y,l=1/k.z,o=(c.x-v.x)*n,s=(m.x-v.x)*n,r=(c.y-v.y)*i,y=(m.y-v.y)*i,d=(c.z-v.z)*l,u=(m.z-v.z)*l,ce(ce(o,r),d)<me(me(s,y),u)&&T(e.root,o,r,d,s,y,u,a,t)}}]),a}(),ra=new v,ya=function(){function a(t,n){e(this,a),this.root=void 0!==t&&void 0!==n?new Ke(t,n):null}return n(a,[{key:\"getCenter\",value:function(e){return this.root.getCenter(e)}},{key:\"getDimensions\",value:function(e){return this.root.getDimensions(e)}},{key:\"getDepth\",value:function(){return P(this.root)}},{key:\"cull\",value:function(e){var a=[];return E(this.root,e,a),a}},{key:\"findOctantsByLevel\",value:function(e){var a=[];return D(this.root,e,0,a),a}},{key:\"raycast\",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return sa.intersectOctree(this,e,a),a}},{key:\"leaves\",value:function(e){return new ta(this,e)}},{key:Symbol.iterator,value:function(){return new ta(this)}},{key:\"min\",get:function(){return this.root.min}},{key:\"max\",get:function(){return this.root.max}},{key:\"children\",get:function(){return this.root.children}}]),a}(),da=new pe,ua=new pe,p=new pe,ca=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pe,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new pe;e(this,t),this.a=n,this.b=a,this.index=-1,this.coordinates=new pe,this.t=0,this.n=new pe}return n(t,[{key:\"approximateZeroCrossing\",value:function(e){var t,n,l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,o=ce(1,l-1),s=0,r=1,y=0,d=0;for(da.subVectors(this.b,this.a);d<=o&&(y=(s+r)/2,ua.addVectors(this.a,p.copy(da).multiplyScalar(y)),n=e.sample(ua),!(ue(n)<=1e-4||(r-s)/2<=1e-6));)ua.addVectors(this.a,p.copy(da).multiplyScalar(s)),t=e.sample(ua),ae(n)===ae(t)?s=y:r=y,++d;this.t=y}},{key:\"computeZeroCrossingPosition\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pe;return e.subVectors(this.b,this.a).multiplyScalar(this.t).add(this.a)}},{key:\"computeSurfaceNormal\",value:function(e){var a=this.computeZeroCrossingPosition(da),t=1e-3,n=e.sample(ua.addVectors(a,p.set(t,0,0)))-e.sample(ua.subVectors(a,p.set(t,0,0))),i=e.sample(ua.addVectors(a,p.set(0,t,0)))-e.sample(ua.subVectors(a,p.set(0,t,0))),l=e.sample(ua.addVectors(a,p.set(0,0,t)))-e.sample(ua.subVectors(a,p.set(0,0,t)));this.n.set(n,i,l).normalize()}}]),t}(),ma=new ca,xa=new pe,pa=new pe,va=function(){function a(t,n,i){var l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:3;e(this,a),this.edgeData=t,this.cellPosition=n,this.cellSize=i,this.indices=null,this.zeroCrossings=null,this.normals=null,this.axes=null,this.lengths=null,this.result=new Qe,this.initialC=l,this.c=l,this.initialD=o,this.d=o,this.i=0,this.l=0,this.reset()}return n(a,[{key:\"reset\",value:function(){var e,t,n,i,o=this.edgeData,s=[],r=[],y=[],u=[],m=[];for(this.i=0,this.c=0,this.d=0,(t=this.initialC,e=4>>t,n=this.initialD);t<n;++t,e>>=1)i=o.indices[t].length,0<i&&(s.push(o.indices[t]),r.push(o.zeroCrossings[t]),y.push(o.normals[t]),u.push(Je[e]),m.push(i),++this.d);return this.l=0<m.length?m[0]:0,this.indices=s,this.zeroCrossings=r,this.normals=y,this.axes=u,this.lengths=m,this.result.reset(),this}},{key:\"next\",value:function(){var e,a,t,l,o,r,d,u=this.cellSize,s=this.edgeData.resolution,n=s+1,m=n*n,p=this.result,v=this.cellPosition;return this.i===this.l&&(this.l=++this.c<this.d?this.lengths[this.c]:0,this.i=0),this.i<this.l?(r=this.c,d=this.i,e=this.axes[r],a=this.indices[r][d],ma.index=a,t=a%n,l=ee(a%m/n),o=ee(a/m),ma.coordinates.set(t,l,o),xa.set(t*u/s,l*u/s,o*u/s),pa.set((t+e[0])*u/s,(l+e[1])*u/s,(o+e[2])*u/s),ma.a.addVectors(v,xa),ma.b.addVectors(v,pa),ma.t=this.zeroCrossings[r][d],ma.n.fromArray(this.normals[r],3*d),p.value=ma,++this.i):(p.value=null,p.done=!0),p}},{key:\"return\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),a}(),ka=function(){function a(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:n;e(this,a),this.resolution=t,this.indices=0>=n?null:[new Uint32Array(n),new Uint32Array(i),new Uint32Array(l)],this.zeroCrossings=0>=n?null:[new Float32Array(n),new Float32Array(i),new Float32Array(l)],this.normals=0>=n?null:[new Float32Array(3*n),new Float32Array(3*i),new Float32Array(3*l)]}return n(a,[{key:\"serialize\",value:function(){return{resolution:this.resolution,edges:this.edges,zeroCrossings:this.zeroCrossings,normals:this.normals}}},{key:\"deserialize\",value:function(e){var a=this;return null===e?a=null:(this.resolution=e.resolution,this.edges=e.edges,this.zeroCrossings=e.zeroCrossings,this.normals=e.normals),a}},{key:\"createTransferList\",value:function(){var e,a,t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],o=[this.edges[0],this.edges[1],this.edges[2],this.zeroCrossings[0],this.zeroCrossings[1],this.zeroCrossings[2],this.normals[0],this.normals[1],this.normals[2]];for(a=0,t=o.length;a<t;++a)e=o[a],null!==e&&n.push(e.buffer);return n}},{key:\"edges\",value:function(e,a){return new va(this,e,a)}},{key:\"edgesX\",value:function(e,a){return new va(this,e,a,0,1)}},{key:\"edgesY\",value:function(e,a){return new va(this,e,a,1,2)}},{key:\"edgesZ\",value:function(e,a){return new va(this,e,a,2,3)}}],[{key:\"calculate1DEdgeCount\",value:function(e){return $(e+1,2)*e}}]),a}(),ga=0,za=0,ha=0,fa=function(){function a(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];e(this,a),this.materials=0,this.materialIndices=t?new Uint8Array(ha):null,this.runLengths=null,this.edgeData=null}return n(a,[{key:\"set\",value:function(e){return this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,this.edgeData=e.edgeData,this}},{key:\"clear\",value:function(){return this.materials=0,this.materialIndices=null,this.runLengths=null,this.edgeData=null,this}},{key:\"setMaterialIndex\",value:function(e,a){this.materialIndices[e]===Xe.AIR?a!==Xe.AIR&&++this.materials:a===Xe.AIR&&--this.materials,this.materialIndices[e]=a}},{key:\"compress\",value:function(){var e,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this;return this.compressed?(a.materialIndices=this.materialIndices,a.runLengths=this.runLengths):(e=this.full?new Ge([this.materialIndices.length],[Xe.SOLID]):Ge.encode(this.materialIndices),a.materialIndices=new Uint8Array(e.data),a.runLengths=new Uint32Array(e.runLengths)),a.materials=this.materials,a}},{key:\"decompress\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this;return e.materialIndices=this.compressed?Ge.decode(this.runLengths,this.materialIndices,new Uint8Array(ha)):this.materialIndices,e.runLengths=null,e.materials=this.materials,e}},{key:\"serialize\",value:function(){return{materials:this.materials,materialIndices:this.materialIndices,runLengths:this.runLengths,edgeData:null===this.edgeData?null:this.edgeData.serialize()}}},{key:\"deserialize\",value:function(e){var a=this;return null===e?a=null:(this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,null===e.edgeData?this.edgeData=null:(null===this.edgeData&&(this.edgeData=new ka(za)),this.edgeData.deserialize(e.edgeData))),a}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.edgeData&&this.edgeData.createTransferList(e),null!==this.materialIndices&&e.push(this.materialIndices.buffer),null!==this.runLengths&&e.push(this.runLengths.buffer),e}},{key:\"empty\",get:function(){return 0===this.materials}},{key:\"full\",get:function(){return this.materials===ha}},{key:\"compressed\",get:function(){return null!==this.runLengths}},{key:\"neutered\",get:function(){return!this.empty&&null===this.materialIndices}}],[{key:\"isovalue\",get:function(){return ga},set:function(e){ga=e}},{key:\"resolution\",get:function(){return za},set:function(e){var a=Math.log2;e=$(2,ce(0,de(a(e)))),za=ce(1,me(256,e)),ha=$(za+1,3)}}]),a}(),Sa=function(a){function t(a){var n;return e(this,t),n=x(this,l(t).call(this,xe.DENSITY_FUNCTION)),n.sdf=a,n}return i(t,a),n(t,[{key:\"computeBoundingBox\",value:function(){return this.sdf.getBoundingBox(!0)}},{key:\"generateMaterialIndex\",value:function(e){return this.sdf.sample(e)<=fa.isovalue?this.sdf.material:Xe.AIR}},{key:\"generateEdge\",value:function(e){e.approximateZeroCrossing(this.sdf),e.computeSurfaceNormal(this.sdf)}}]),t}(Ze),Ia=new c,Ca=function(){function a(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Xe.SOLID;e(this,a),this.type=t,this.operation=null,this.material=me(255,ce(Xe.SOLID,ee(n))),this.boundingBox=null,this.position=new pe,this.quaternion=new Te,this.scale=new pe(1,1,1),this.inverseTransformation=new c,this.updateInverseTransformation(),this.children=[]}return n(a,[{key:\"getTransformation\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new c;return e.compose(this.position,this.quaternion,this.scale)}},{key:\"getBoundingBox\",value:function(){var e,a,t=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],n=this.children,o=this.boundingBox;if(null===o&&(o=this.computeBoundingBox(),this.boundingBox=o),t)for(o=o.clone(),e=0,a=n.length;e<a;++e)o.union(n[e].getBoundingBox(t));return o}},{key:\"setMaterial\",value:function(e){return this.material=me(255,ce(Xe.SOLID,ee(e))),this}},{key:\"setOperationType\",value:function(e){return this.operation=e,this}},{key:\"updateInverseTransformation\",value:function(){return this.inverseTransformation.getInverse(this.getTransformation(Ia)),this.boundingBox=null,this}},{key:\"union\",value:function(e){return this.children.push(e.setOperationType(xe.UNION)),this}},{key:\"subtract\",value:function(e){return this.children.push(e.setOperationType(xe.DIFFERENCE)),this}},{key:\"intersect\",value:function(e){return this.children.push(e.setOperationType(xe.INTERSECTION)),this}},{key:\"toCSG\",value:function(){var e,a,t,n,o=this.children,s=new Sa(this);for(t=0,n=o.length;t<n;++t)a=o[t],e!==a.operation&&(e=a.operation,e===xe.UNION?s=new Ue(s):e===xe.DIFFERENCE?s=new _e(s):e===xe.INTERSECTION?s=new je(s):void 0),s.children.push(a.toCSG());return s}},{key:\"serialize\",value:function(){var e,a,t=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],n={type:this.type,operation:this.operation,material:this.material,position:this.position.toArray(),quaternion:this.quaternion.toArray(),scale:this.scale.toArray(),parameters:null,children:[]};for(e=0,a=this.children.length;e<a;++e)n.children.push(this.children[e].serialize(t));return n}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e}},{key:\"toJSON\",value:function(){return this.serialize(!0)}},{key:\"computeBoundingBox\",value:function(){throw new Error(\"SignedDistanceFunction#computeBoundingBox method not implemented!\")}},{key:\"sample\",value:function(){throw new Error(\"SignedDistanceFunction#sample method not implemented!\")}}]),a}(),wa={HEIGHTFIELD:\"sdf.heightfield\",FRACTAL_NOISE:\"sdf.fractalnoise\",SUPER_PRIMITIVE:\"sdf.superprimitive\"},Ta=function(a){function t(){var a,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=1<arguments.length?arguments[1]:void 0;return e(this,t),a=x(this,l(t).call(this,wa.SUPER_PRIMITIVE,i)),a.s0=d(Ye,z(n.s)),a.r0=d(pe,z(n.r)),a.s=new Ye,a.r=new pe,a.ba=new he,a.offset=0,a.precompute(),a}return i(t,a),n(t,[{key:\"setSize\",value:function(e,a,t,n){return this.s0.set(e,a,t,n),this.precompute()}},{key:\"setRadii\",value:function(e,a,t){return this.r0.set(e,a,t),this.precompute()}},{key:\"precompute\",value:function(){var e=this.s.copy(this.s0),a=this.r.copy(this.r0),t=this.ba;e.x-=a.x,e.y-=a.x,a.x-=e.w,e.w-=a.y,e.z-=a.y,this.offset=-2*e.z,t.set(a.z,this.offset);var n=t.dot(t);return 0===n?t.set(0,-1):t.divideScalar(n),this}},{key:\"computeBoundingBox\",value:function(){var e=this.s0,a=new v;return a.min.x=me(-e.x,-1),a.min.y=me(-e.y,-1),a.min.z=me(-e.z,-1),a.max.x=ce(e.x,1),a.max.y=ce(e.y,1),a.max.z=ce(e.z,1),a.applyMatrix4(this.getTransformation()),a}},{key:\"sample\",value:function(e){e.applyMatrix4(this.inverseTransformation);var a=this.s,t=this.r,n=this.ba,i=ue(e.x)-a.x,l=ue(e.y)-a.y,o=ue(e.z)-a.z,s=ce(i,0),r=ce(l,0),y=oe(s*s+r*r),d=e.z-a.z,u=ue(y+me(0,ce(i,l))-t.x)-a.w,m=me(ce(u*n.x+d*n.y,0),1),c=u-t.z*m,x=d-this.offset*m,p=ce(u-t.z,0),v=e.z+a.z,k=ce(u,0),g=u*-n.y+d*n.x,z=oe(me(c*c+x*x,me(p*p+v*v,k*k+d*d)));return z*ae(ce(g,o))-t.y}},{key:\"serialize\",value:function(){var e=g(l(t.prototype),\"serialize\",this).call(this);return e.parameters={s:this.s0.toArray(),r:this.r0.toArray()},e}}],[{key:\"create\",value:function(e){var a=Pa[e];return new t({s:a[0],r:a[1]})}}]),t}(Ca),Pa=[[new Float32Array([1,1,1,1]),new Float32Array([0,0,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,0,0])],[new Float32Array([0,0,1,1]),new Float32Array([0,0,1])],[new Float32Array([1,1,2,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,.25,1]),new Float32Array([1,.25,0])],[new Float32Array([1,1,.25,.25]),new Float32Array([1,.25,0])],[new Float32Array([1,1,1,.25]),new Float32Array([1,.1,0])],[new Float32Array([1,1,1,.25]),new Float32Array([.1,.1,0])]],ba={CUBE:0,CYLINDER:1,CONE:2,PILL:3,SPHERE:4,PELLET:5,TORUS:6,PIPE:7,CORRIDOR:8},Ea=function(){function a(t,n,i,l,o){e(this,a),this.indices=t,this.positions=n,this.normals=i,this.uvs=l,this.materials=o}return n(a,[{key:\"serialize\",value:function(){return{indices:this.indices,positions:this.positions,normals:this.normals,uvs:this.uvs,materials:this.materials}}},{key:\"deserialize\",value:function(e){var a=this;return null===e?a=null:(this.indices=e.indices,this.positions=e.positions,this.normals=e.normals,this.uvs=e.uvs,this.materials=e.materials),a}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.indices.buffer),e.push(this.positions.buffer),e.push(this.normals.buffer),e.push(this.uvs.buffer),e.push(this.materials.buffer),e}}]),a}(),Da=[new Uint8Array([0,4,0]),new Uint8Array([1,5,0]),new Uint8Array([2,6,0]),new Uint8Array([3,7,0]),new Uint8Array([0,2,1]),new Uint8Array([4,6,1]),new Uint8Array([1,3,1]),new Uint8Array([5,7,1]),new Uint8Array([0,1,2]),new Uint8Array([2,3,2]),new Uint8Array([4,5,2]),new Uint8Array([6,7,2])],Fa=[new Uint8Array([0,1,2,3,0]),new Uint8Array([4,5,6,7,0]),new Uint8Array([0,4,1,5,1]),new Uint8Array([2,6,3,7,1]),new Uint8Array([0,2,4,6,2]),new Uint8Array([1,3,5,7,2])],Va=[[new Uint8Array([4,0,0]),new Uint8Array([5,1,0]),new Uint8Array([6,2,0]),new Uint8Array([7,3,0])],[new Uint8Array([2,0,1]),new Uint8Array([6,4,1]),new Uint8Array([3,1,1]),new Uint8Array([7,5,1])],[new Uint8Array([1,0,2]),new Uint8Array([3,2,2]),new Uint8Array([5,4,2]),new Uint8Array([7,6,2])]],La=[[new Uint8Array([1,4,0,5,1,1]),new Uint8Array([1,6,2,7,3,1]),new Uint8Array([0,4,6,0,2,2]),new Uint8Array([0,5,7,1,3,2])],[new Uint8Array([0,2,3,0,1,0]),new Uint8Array([0,6,7,4,5,0]),new Uint8Array([1,2,0,6,4,2]),new Uint8Array([1,3,1,7,5,2])],[new Uint8Array([1,1,0,3,2,0]),new Uint8Array([1,5,4,7,6,0]),new Uint8Array([0,1,5,0,4,1]),new Uint8Array([0,3,7,2,6,1])]],Na=[[new Uint8Array([3,2,1,0,0]),new Uint8Array([7,6,5,4,0])],[new Uint8Array([5,1,4,0,1]),new Uint8Array([7,3,6,2,1])],[new Uint8Array([6,4,2,0,2]),new Uint8Array([7,5,3,1,2])]],Oa=[new Uint8Array([3,2,1,0]),new Uint8Array([7,5,6,4]),new Uint8Array([11,10,9,8])],Ba=$(2,16)-1,Ra=function(){function a(){e(this,a)}return n(a,null,[{key:\"run\",value:function(e){var a=[],t=e.voxelCount,n=null,i=null,l=null,o=null,s=null;return t>Ba?console.warn(\"Could not create geometry for cell at position\",e.min,\"(vertex count of\",t,\"exceeds limit of \",Ba,\")\"):0<t&&(i=new Float32Array(3*t),l=new Float32Array(3*t),o=new Float32Array(2*t),s=new Uint8Array(t),O(e.root,i,l,0),N(e.root,a),n=new Ea(new Uint16Array(a),i,l,o,s)),n}}]),a}(),Aa=new he,Ma=function(){function a(){e(this,a)}return n(a,null,[{key:\"calculateCoefficients\",value:function(e,a,t){var n,i,l;return 0===a?(Aa.x=1,Aa.y=0):(n=(t-e)/(2*a),i=oe(1+n*n),l=1/(0<=n?n+i:n-i),Aa.x=1/oe(1+l*l),Aa.y=l*Aa.x),Aa}}]),a}(),qa=function(){function a(){e(this,a)}return n(a,null,[{key:\"rotateXY\",value:function(e,a){var t=a.x,n=a.y,i=e.x,l=e.y;e.set(t*i-n*l,n*i+t*l)}},{key:\"rotateQXY\",value:function(e,a,t){var n=t.x,i=t.y,l=n*n,o=i*i,s=2*n*i*a,r=e.x,y=e.y;e.set(l*r-s+o*y,o*r+s+l*y)}}]),a}(),Ya=.1,Xa=new qe,Za=new Ce,Ua=new he,_a=new pe,ja=function(){function a(){e(this,a)}return n(a,null,[{key:\"solve\",value:function(e,a,t){var n=M(Xa.copy(e),Za.identity()),i=X(Za,n);t.copy(a).applyMatrix3(i)}}]),a}(),Ga=new pe,Qa=function(){function a(){e(this,a),this.data=null,this.ata=new qe,this.atb=new pe,this.massPoint=new pe,this.hasSolution=!1}return n(a,[{key:\"setData\",value:function(e){return this.data=e,this.hasSolution=!1,this}},{key:\"solve\",value:function(e){var a=this.data,t=this.massPoint,n=this.ata.copy(a.ata),i=this.atb.copy(a.atb),l=1/0;return!this.hasSolution&&null!==a&&0<a.numPoints&&(Ga.copy(a.massPointSum).divideScalar(a.numPoints),t.copy(Ga),n.applyToVector3(Ga),i.sub(Ga),ja.solve(n,i,e),l=Z(n,i,e),e.add(t),this.hasSolution=!0),l}}]),a}(),Ha=function(){function a(){e(this,a),this.ata=new qe,this.ata.set(0,0,0,0,0,0),this.atb=new pe,this.massPointSum=new pe,this.numPoints=0}return n(a,[{key:\"set\",value:function(e,a,t,n){return this.ata.copy(e),this.atb.copy(a),this.massPointSum.copy(t),this.numPoints=n,this}},{key:\"copy\",value:function(e){return this.set(e.ata,e.atb,e.massPointSum,e.numPoints)}},{key:\"add\",value:function(e,a){var t=a.x,n=a.y,i=a.z,l=e.dot(a),o=this.ata.elements,s=this.atb;o[0]+=t*t,o[1]+=t*n,o[3]+=n*n,o[2]+=t*i,o[4]+=n*i,o[5]+=i*i,s.x+=l*t,s.y+=l*n,s.z+=l*i,this.massPointSum.add(e),++this.numPoints}},{key:\"addData\",value:function(e){this.ata.add(e.ata),this.atb.add(e.atb),this.massPointSum.add(e.massPointSum),this.numPoints+=e.numPoints}},{key:\"clear\",value:function(){this.ata.set(0,0,0,0,0,0),this.atb.set(0,0,0),this.massPointSum.set(0,0,0),this.numPoints=0}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}}]),a}(),Ka=function a(){e(this,a),this.materials=0,this.edgeCount=0,this.index=-1,this.position=new pe,this.normal=new pe,this.qefData=null},Ja=new Qa,Wa=.1,$a=-1,et=function(a){function t(a,n){var i;return e(this,t),i=x(this,l(t).call(this,a,n)),i.voxel=null,i}return i(t,a),n(t,[{key:\"contains\",value:function(e){var a=this.min,t=this.size;return e.x>=a.x-Wa&&e.y>=a.y-Wa&&e.z>=a.z-Wa&&e.x<=a.x+t+Wa&&e.y<=a.y+t+Wa&&e.z<=a.z+t+Wa}},{key:\"collapse\",value:function(){var e,a,t,n,l,o,s,r=this.children,y=[-1,-1,-1,-1,-1,-1,-1,-1],d=new pe,u=-1,c=null!==r,m=0;if(c){for(n=new Ha,o=0,s=0;8>s;++s)e=r[s],m+=e.collapse(),t=e.voxel,null===e.children?null!==t&&(n.addData(t.qefData),u=1&t.materials>>7-s,y[s]=1&t.materials>>s,++o):c=!1;if(c&&(l=Ja.setData(n).solve(d),l<=$a)){for(t=new Ka,t.position.copy(this.contains(d)?d:Ja.massPoint),s=0;8>s;++s)a=y[s],e=r[s],-1===a?t.materials|=u<<s:(t.materials|=a<<s,t.normal.add(e.voxel.normal));t.normal.normalize(),t.qefData=n,this.voxel=t,this.children=null,m+=o-1}}return m}}],[{key:\"errorThreshold\",get:function(){return $a},set:function(e){$a=e}}]),t}(ea),at=function(a){function t(a){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new pe,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return e(this,t),n=x(this,l(t).call(this)),n.root=new et(i,o),n.voxelCount=0,null!==a&&null!==a.edgeData&&n.construct(a),0<=et.errorThreshold&&n.simplify(),n}return i(t,a),n(t,[{key:\"simplify\",value:function(){this.voxelCount-=this.root.collapse()}},{key:\"construct\",value:function(e){var a,t,l,o,s,r,u,c,m,p,v,k=fa.resolution,n=e.edgeData,g=e.materialIndices,h=new Qa,f=new pe,S=[n.edgesX(this.min,this.root.size),n.edgesY(this.min,this.root.size),n.edgesZ(this.min,this.root.size)],I=[new Uint8Array([0,1,2,3]),new Uint8Array([0,1,4,5]),new Uint8Array([0,2,4,6])],C=0;for(p=0;3>p;++p){l=I[p],a=S[p];var w=!0,T=!1,P=void 0;try{for(var b,E=a[Symbol.iterator]();!(w=(b=E.next()).done);w=!0)for(t=b.value,t.computeZeroCrossingPosition(f),v=0;4>v;++v)o=Je[l[v]],u=t.coordinates.x-o[0],c=t.coordinates.y-o[1],m=t.coordinates.z-o[2],0<=u&&0<=c&&0<=m&&u<k&&c<k&&m<k&&(s=U(this.root,k,u,c,m),null===s.voxel&&(s.voxel=_(k,u,c,m,g),++C),r=s.voxel,r.normal.add(t.n),r.qefData.add(f,t.n),r.qefData.numPoints===r.edgeCount&&(h.setData(r.qefData).solve(r.position),!s.contains(r.position)&&r.position.copy(h.massPoint),r.normal.normalize()))}catch(e){T=!0,P=e}finally{try{w||null==E[\"return\"]||E[\"return\"]()}finally{if(T)throw P}}}this.voxelCount=C}}]),t}(ya),tt=0,nt=new pe,it=function(){function a(){e(this,a)}return n(a,null,[{key:\"run\",value:function(e,a,t,n){nt.fromArray(e),tt=a,null===t?n.operation===xe.UNION&&(t=new fa(!1)):t.decompress();var i=n.toCSG(),l=null===t?null:W(i);if(null!==l){switch(n.operation){case xe.UNION:i=new Ue(i);break;case xe.DIFFERENCE:i=new _e(i);break;case xe.INTERSECTION:i=new je(i);}J(i,t,l),t.contoured=!1}return null!==t&&t.empty?null:t}}]),a}(),lt=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:\"Report\";e(this,a),this.name=t,this.lines=[],this.data=[]}return n(a,[{key:\"clear\",value:function(){this.data=[]}},{key:\"addLine\",value:function(e){this.lines.push(e)}},{key:\"addValue\",value:function(e){this.data.push(e)}},{key:\"toString\",value:function(){var e,a,t=this.lines,n=this.data,o=this.name+\"\\n\\n\";for(e=0,a=t.length;e<a;++e)o+=t[e]+\"\\n\";for(o+=\"\\nValues:\\n\",o+=\"i, ms\\n\",(e=0,a=n.length);e<a;++e)o+=e+1+\", \"+n[e]+\"\\n\";return o}}]),a}(),ot=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;e(this,a),this.name=t}return n(a,[{key:\"initialize\",value:function(){throw new Error(\"Test#initialize method not implemented!\")}},{key:\"clear\",value:function(){throw new Error(\"Test#clear method not implemented!\")}},{key:\"run\",value:function(){throw new Error(\"Test#run method not implemented!\")}}]),a}(),st=function(a){function t(){var a;return e(this,t),a=x(this,l(t).call(this,\"Compression Test\")),a.data=null,a.targetContainer=new fa(!1),a}return i(t,a),n(t,[{key:\"initialize\",value:function(){var e=1/2,a=Ta.create(ba.PIPE);return a.scale.set(.475,.475,.475),a.updateInverseTransformation(),this.data=it.run([-e,-e,-e],1,null,a.setOperationType(xe.UNION)),this}},{key:\"clear\",value:function(){return this.data=null,this.targetContainer.clear(),this}},{key:\"run\",value:function(){var e,a,t,l,o,s,r,y=new lt(\"Compression Report\"),d=this.targetContainer,u=this.data,c=fa.resolution,n=$(c+1,3),m=3*$(c+1,2)*c;for(y.addLine(\"Performing 200 compression tasks\"),r=0;200>r;++r)s=performance.now(),u.compress(d),y.addValue(performance.now()-s);return a=d.materials,t=d.materialIndices.length,l=d.runLengths.length,e=u.edgeData,o=e.indices[0].length+e.indices[1].length+e.indices[2].length,y.addLine(\"Material Statistics\"),y.addLine(\"Total Materials: \"+n+\" (\"+a+\" solid)\"),y.addLine(\"Compressed Materials: \"+t+\" (+ \"+l+\" run-lengths)\"),y.addLine(\"Compression Ratio: \"+(n/(t+4*l)).toFixed(2)),y.addLine(\"Space Savings: \"+(100*(1-(t+4*l)/n)).toFixed(2)+\"%\"),y.addLine(\"Maximum Memory Usage: \"+(8*n/8/1024).toFixed(2)+\" KB\"),y.addLine(\"Estimated Memory Usage: \"+((8*t+32*l)/8/1024).toFixed(2)+\" KB\\n\"),y.addLine(\"Edge Data Statistics\"),y.addLine(\"Total Edges: \"+o+\" (\"+m+\" max)\"),y.addLine(\"Compression Ratio: \"+(m/o).toFixed(2)),y.addLine(\"Space Savings: \"+(100*(1-o/m)).toFixed(2)+\"%\"),y.addLine(\"Maximum Memory Usage: \"+((32*m+32*m+32*(3*m))/8/1024/1024).toFixed(2)+\" MB\"),y.addLine(\"Estimated Memory Usage: \"+((32*o+32*o+32*(3*o))/8/1024).toFixed(2)+\" KB\"),console.log(\"Compressed data\",d),y}}]),t}(ot),rt=function(a){function t(){var a;return e(this,t),a=x(this,l(t).call(this,\"Decompression Test\")),a.data=null,a.targetContainer=new fa(!1),a}return i(t,a),n(t,[{key:\"initialize\",value:function(){var e=1/2,a=Ta.create(ba.PIPE);return a.scale.set(.475,.475,.475),a.updateInverseTransformation(),this.data=it.run([-e,-e,-e],1,null,a.setOperationType(xe.UNION)),this.data.compress(),this}},{key:\"clear\",value:function(){return this.data=null,this.targetContainer.clear(),this}},{key:\"run\",value:function(){var e,a,t=new lt(\"Decompression Report\"),n=this.targetContainer,l=this.data;for(t.addLine(\"Performing 200 decompression tasks\"),a=0;200>a;++a)e=performance.now(),l.decompress(n),t.addValue(performance.now()-e);return console.log(\"Decompressed data\",n),t}}]),t}(ot),yt=function(a){function t(){var a;return e(this,t),a=x(this,l(t).call(this,\"CSG Test\")),a.data=null,a.cellSize=1,a.cellPosition=[-.5,-.5,-.5],a.sdf=null,a}return i(t,a),n(t,[{key:\"initialize\",value:function(){var e=Ta.create(ba.PELLET).setOperationType(xe.UNION),a=Ta.create(ba.PIPE).setOperationType(xe.UNION);return e.scale.set(.475,.475,.475),e.updateInverseTransformation(),a.scale.set(.475,.475,.475),a.updateInverseTransformation(),this.data=it.run(this.cellPosition,this.cellSize,null,e),this.sdf=a,this}},{key:\"clear\",value:function(){return this.data=null,this.sdf=null,this}},{key:\"run\",value:function(){var e,a,t,n=new lt(\"CSG Report\"),l=this.cellPosition,o=this.cellSize,s=this.data,r=this.sdf;for(n.addLine(\"Executing 200 CSG Union operations on existing data\"),n.addLine(\"Initial material count: \"+s.materials),n.addLine(\"Initial edge count: \"+(s.edgeData.indices[0].length+s.edgeData.indices[1].length+s.edgeData.indices[2].length)),t=0;200>t;++t)a=performance.now(),e=it.run(l,o,s,r),n.addValue(performance.now()-a);return n.addLine(\"Final material count: \"+e.materials),n.addLine(\"Final edge count: \"+(e.edgeData.indices[0].length+e.edgeData.indices[1].length+e.edgeData.indices[2].length)),console.log(\"Generated data\",e),n}}]),t}(ot),dt=function(a){function t(){var a;return e(this,t),a=x(this,l(t).call(this,\"SVO Test\")),a.data=null,a.cellSize=1,a.cellPosition=new pe(-.5,-.5,-.5),a}return i(t,a),n(t,[{key:\"initialize\",value:function(){var e=Ta.create(ba.PIPE);return e.scale.set(.475,.475,.475),e.updateInverseTransformation(),et.errorThreshold=.01,this.data=it.run(this.cellPosition.toArray(),this.cellSize,null,e.setOperationType(xe.UNION)),this}},{key:\"clear\",value:function(){return this.data=null,this}},{key:\"run\",value:function(){var e,a,t,n=new lt(\"SVO Report\"),l=this.cellPosition,o=this.cellSize,s=this.data;for(n.addLine(\"Building 200 sparse voxel octrees\"),n.addLine(\"Material count: \"+s.materials),n.addLine(\"Edge count: \"+(s.edgeData.indices[0].length+s.edgeData.indices[1].length+s.edgeData.indices[2].length)),t=0;200>t;++t)a=performance.now(),e=new at(s,l,o),n.addValue(performance.now()-a);return n.addLine(\"Final voxel count: \"+e.voxelCount),console.log(\"Sparse voxel octree\",e),n}}]),t}(ot),ut=function(a){function t(){var a;return e(this,t),a=x(this,l(t).call(this,\"Contouring Test\")),a.svo=null,a}return i(t,a),n(t,[{key:\"initialize\",value:function(){var e=1/2,a=new pe(-e,-e,-e),t=Ta.create(ba.PIPE);return t.scale.set(.475,.475,.475),t.updateInverseTransformation(),et.errorThreshold=.01,this.svo=new at(it.run(a.toArray(),1,null,t.setOperationType(xe.UNION)),a,1),this}},{key:\"clear\",value:function(){return this.svo=null,this}},{key:\"run\",value:function(){var e,a,t,n=new lt(\"Contouring Report\"),l=this.svo;for(n.addLine(\"Performing 200 contouring tasks\"),n.addLine(\"Voxel count: \"+l.voxelCount),t=0;200>t;++t)a=performance.now(),e=Ra.run(l),n.addValue(performance.now()-a);return n.addLine(\"Generated vertices: \"+e.positions.length/3),n.addLine(\"Generated triangle indices: \"+e.indices.length),console.log(\"Extracted isosurface\",e),n}}]),t}(ot),ct={CONFIGURE:\"worker.config\",TEST:\"worker.test\"},mt=new Map([[\"Compression\",new st],[\"Decompression\",new rt],[\"Contouring\",new ut],[\"CSG\",new yt],[\"SVO\",new dt]]);self.addEventListener(\"message\",function(e){var a,t,n=e.data;switch(n.action){case ct.CONFIGURE:{fa.resolution=n.resolution,console.log(\"Setting Hermite data resolution to\",n.resolution);break}case ct.TEST:{a=mt.get(n.id).initialize(),t=a.run(),a.clear(),postMessage({reportName:t.name,reportURL:URL.createObjectURL(new Blob([t.toString()],{type:\"text/plain\"}))});break}}})})();\n";

	var workerURL = URL.createObjectURL(new Blob([workerCode], {
	  type: "text/javascript"
	}));
	var worker = null;
	var tests = ["Compression", "Decompression", "Contouring", "CSG", "SVO"];

	function configure(event) {
	  worker.postMessage({
	    action: Action.CONFIGURE,
	    resolution: Number.parseInt(event.target.value)
	  });
	}

	function runTest(event) {
	  var id = event.target.id;
	  var h3 = document.createElement("h3");
	  h3.appendChild(document.createTextNode("Running " + id + " Test\u2026"));
	  document.getElementById("aside").appendChild(h3);
	  document.getElementById("mask").removeAttribute("class");
	  worker.postMessage({
	    action: Action.TEST,
	    id: id
	  });
	}

	function showResult(event) {
	  var response = event.data;
	  var div = document.createElement("div");
	  var span = document.createElement("span");
	  var a = document.createElement("a");
	  a.href = response.reportURL;
	  a.setAttribute("download", response.reportName + ".log");
	  a.setAttribute("class", "report");
	  a.appendChild(document.createTextNode("Report \u2B73"));
	  span.appendChild(document.createTextNode("Test complete"));
	  span.setAttribute("class", "status");
	  span.appendChild(a);
	  div.setAttribute("class", "result");
	  div.appendChild(span);
	  div.appendChild(a);
	  document.getElementById("aside").appendChild(div);
	  document.getElementById("mask").setAttribute("class", "hidden");
	}

	function showAvailableTests() {
	  var main = document.getElementById("main");
	  var ul = document.createElement("ul");
	  var test, li, a;
	  var _iteratorNormalCompletion = true;
	  var _didIteratorError = false;
	  var _iteratorError = undefined;

	  try {
	    for (var _iterator = tests[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
	      test = _step.value;
	      li = document.createElement("li");
	      a = document.createElement("a");
	      a.appendChild(document.createTextNode(test));
	      a.setAttribute("href", "#" + test);
	      a.setAttribute("id", test);
	      a.addEventListener("click", runTest);
	      li.appendChild(a);
	      ul.appendChild(li);
	    }
	  } catch (err) {
	    _didIteratorError = true;
	    _iteratorError = err;
	  } finally {
	    try {
	      if (!_iteratorNormalCompletion && _iterator["return"] != null) {
	        _iterator["return"]();
	      }
	    } finally {
	      if (_didIteratorError) {
	        throw _iteratorError;
	      }
	    }
	  }

	  main.appendChild(ul);
	}

	function handleEvent(event) {
	  switch (event.type) {
	    case "message":
	      showResult(event);
	      break;

	    case "error":
	      console.error("Encountered an unexpected error", event);
	      break;
	  }
	}

	window.addEventListener("load", function main(event) {
	  window.removeEventListener("load", main);
	  document.getElementById("resolution").addEventListener("change", configure);
	  worker = new Worker(workerURL);
	  worker.addEventListener("message", handleEvent);
	  worker.addEventListener("error", handleEvent);
	  worker.postMessage({
	    action: Action.CONFIGURE,
	    resolution: 64
	  });
	  showAvailableTests();
	});

}());
