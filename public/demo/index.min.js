!function(t,e,n){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n;var i=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},a=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},u=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},h="uniform sampler2D tPreviousLum;\r\nuniform sampler2D tCurrentLum;\r\nuniform float minLuminance;\r\nuniform float delta;\r\nuniform float tau;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tfloat previousLum = texture2D(tPreviousLum, vUv, MIP_LEVEL_1X1).r;\r\n\tfloat currentLum = texture2D(tCurrentLum, vUv, MIP_LEVEL_1X1).r;\r\n\r\n\tpreviousLum = max(minLuminance, previousLum);\r\n\tcurrentLum = max(minLuminance, currentLum);\r\n\r\n\t// Adapt the luminance using Pattanaik's technique.\r\n\tfloat adaptedLum = previousLum + (currentLum - previousLum) * (1.0 - exp(-delta * tau));\r\n\r\n\tgl_FragColor.r = adaptedLum;\r\n\r\n}\r\n",l="varying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvUv = uv;\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n\r\n}\r\n",c=function(e){a(n,e);function n(){return i(this,n),o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{type:"AdaptiveLuminosityMaterial",defines:{MIP_LEVEL_1X1:"0.0"},uniforms:{tPreviousLum:new t.Uniform(null),tCurrentLum:new t.Uniform(null),minLuminance:new t.Uniform(.01),delta:new t.Uniform(0),tau:new t.Uniform(1)},fragmentShader:h,vertexShader:l,depthWrite:!1,depthTest:!1}))}return n}(t.ShaderMaterial),d="uniform sampler2D tDiffuse;\r\nuniform sampler2D tDepth;\r\n\r\nuniform float focus;\r\nuniform float dof;\r\nuniform float aspect;\r\nuniform float aperture;\r\nuniform float maxBlur;\r\n\r\nvarying vec2 vUv;\r\n\r\n#ifndef USE_LOGDEPTHBUF\r\n\r\n\t#include <packing>\r\n\r\n\tuniform float cameraNear;\r\n\tuniform float cameraFar;\r\n\r\n\tfloat readDepth(sampler2D depthSampler, vec2 coord) {\r\n\r\n\t\tfloat fragCoordZ = texture2D(depthSampler, coord).x;\r\n\t\tfloat viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);\r\n\r\n\t\treturn viewZToOrthographicDepth(viewZ, cameraNear, cameraFar);\r\n\r\n\t}\r\n\r\n#endif\r\n\r\nvoid main() {\r\n\r\n\tvec2 aspectCorrection = vec2(1.0, aspect);\r\n\r\n\t#ifdef USE_LOGDEPTHBUF\r\n\r\n\t\tfloat depth = texture2D(tDepth, vUv).x;\r\n\r\n\t#else\r\n\r\n\t\tfloat depth = readDepth(tDepth, vUv);\r\n\r\n\t#endif\r\n\r\n\tfloat focusNear = clamp(focus - dof, 0.0, 1.0);\r\n\tfloat focusFar = clamp(focus + dof, 0.0, 1.0);\r\n\r\n\t// Calculate a DoF mask.\r\n\tfloat low = step(depth, focusNear);\r\n\tfloat high = step(focusFar, depth);\r\n\r\n\tfloat factor = (depth - focusNear) * low + (depth - focusFar) * high;\r\n\r\n\tvec2 dofBlur = vec2(clamp(factor * aperture, -maxBlur, maxBlur));\r\n\r\n\tvec2 dofblur9 = dofBlur * 0.9;\r\n\tvec2 dofblur7 = dofBlur * 0.7;\r\n\tvec2 dofblur4 = dofBlur * 0.4;\r\n\r\n\tvec4 color = vec4(0.0);\r\n\r\n\tcolor += texture2D(tDiffuse, vUv);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.0,   0.4 ) * aspectCorrection) * dofBlur);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.15,  0.37) * aspectCorrection) * dofBlur);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.29,  0.29) * aspectCorrection) * dofBlur);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2(-0.37,  0.15) * aspectCorrection) * dofBlur);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.40,  0.0 ) * aspectCorrection) * dofBlur);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.37, -0.15) * aspectCorrection) * dofBlur);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.29, -0.29) * aspectCorrection) * dofBlur);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2(-0.15, -0.37) * aspectCorrection) * dofBlur);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.0,  -0.4 ) * aspectCorrection) * dofBlur);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2(-0.15,  0.37) * aspectCorrection) * dofBlur);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2(-0.29,  0.29) * aspectCorrection) * dofBlur);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.37,  0.15) * aspectCorrection) * dofBlur);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2(-0.4,   0.0 ) * aspectCorrection) * dofBlur);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2(-0.37, -0.15) * aspectCorrection) * dofBlur);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2(-0.29, -0.29) * aspectCorrection) * dofBlur);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.15, -0.37) * aspectCorrection) * dofBlur);\r\n\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.15,  0.37) * aspectCorrection) * dofblur9);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2(-0.37,  0.15) * aspectCorrection) * dofblur9);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.37, -0.15) * aspectCorrection) * dofblur9);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2(-0.15, -0.37) * aspectCorrection) * dofblur9);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2(-0.15,  0.37) * aspectCorrection) * dofblur9);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.37,  0.15) * aspectCorrection) * dofblur9);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2(-0.37, -0.15) * aspectCorrection) * dofblur9);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.15, -0.37) * aspectCorrection) * dofblur9);\r\n\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.29,  0.29) * aspectCorrection) * dofblur7);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.40,  0.0 ) * aspectCorrection) * dofblur7);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.29, -0.29) * aspectCorrection) * dofblur7);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.0,  -0.4 ) * aspectCorrection) * dofblur7);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2(-0.29,  0.29) * aspectCorrection) * dofblur7);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2(-0.4,   0.0 ) * aspectCorrection) * dofblur7);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2(-0.29, -0.29) * aspectCorrection) * dofblur7);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.0,   0.4 ) * aspectCorrection) * dofblur7);\r\n\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.29,  0.29) * aspectCorrection) * dofblur4);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.4,   0.0 ) * aspectCorrection) * dofblur4);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.29, -0.29) * aspectCorrection) * dofblur4);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.0,  -0.4 ) * aspectCorrection) * dofblur4);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2(-0.29,  0.29) * aspectCorrection) * dofblur4);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2(-0.4,   0.0 ) * aspectCorrection) * dofblur4);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2(-0.29, -0.29) * aspectCorrection) * dofblur4);\r\n\tcolor += texture2D(tDiffuse, vUv + (vec2( 0.0,   0.4 ) * aspectCorrection) * dofblur4);\r\n\r\n\tgl_FragColor = color / 41.0;\r\n\r\n}\r\n",v="varying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvUv = uv;\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n\r\n}\r\n",f=function(e){a(n,e);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,n);var s=Object.assign({focus:1,dof:.02,aperture:.025,maxBlur:1},r),a=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{type:"BokehMaterial",uniforms:{cameraNear:new t.Uniform(.1),cameraFar:new t.Uniform(2e3),aspect:new t.Uniform(1),tDiffuse:new t.Uniform(null),tDepth:new t.Uniform(null),focus:new t.Uniform(s.focus),dof:new t.Uniform(s.dof),aperture:new t.Uniform(s.aperture),maxBlur:new t.Uniform(s.maxBlur)},fragmentShader:d,vertexShader:v,depthWrite:!1,depthTest:!1}));return a.adoptCameraSettings(e),a}return r(n,[{key:"adoptCameraSettings",value:function(t){null!==t&&(this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far,this.uniforms.aspect.value=t.aspect)}}]),n}(t.ShaderMaterial),y="uniform sampler2D tDiffuse;\r\n\r\nvarying vec2 vUv;\r\nvarying vec4 vOffset[3];\r\n\r\nvoid main() {\r\n\r\n\tconst vec2 threshold = vec2(EDGE_THRESHOLD);\r\n\r\n\t// Calculate color deltas.\r\n\tvec4 delta;\r\n\tvec3 c = texture2D(tDiffuse, vUv).rgb;\r\n\r\n\tvec3 cLeft = texture2D(tDiffuse, vOffset[0].xy).rgb;\r\n\tvec3 t = abs(c - cLeft);\r\n\tdelta.x = max(max(t.r, t.g), t.b);\r\n\r\n\tvec3 cTop = texture2D(tDiffuse, vOffset[0].zw).rgb;\r\n\tt = abs(c - cTop);\r\n\tdelta.y = max(max(t.r, t.g), t.b);\r\n\r\n\t// We do the usual threshold.\r\n\tvec2 edges = step(threshold, delta.xy);\r\n\r\n\t// Then discard if there is no edge.\r\n\tif(dot(edges, vec2(1.0)) == 0.0) {\r\n\r\n\t\tdiscard;\r\n\r\n\t}\r\n\r\n\t// Calculate right and bottom deltas.\r\n\tvec3 cRight = texture2D(tDiffuse, vOffset[1].xy).rgb;\r\n\tt = abs(c - cRight);\r\n\tdelta.z = max(max(t.r, t.g), t.b);\r\n\r\n\tvec3 cBottom = texture2D(tDiffuse, vOffset[1].zw).rgb;\r\n\tt = abs(c - cBottom);\r\n\tdelta.w = max(max(t.r, t.g), t.b);\r\n\r\n\t// Calculate the maximum delta in the direct neighborhood.\r\n\tfloat maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);\r\n\r\n\t// Calculate left-left and top-top deltas.\r\n\tvec3 cLeftLeft = texture2D(tDiffuse, vOffset[2].xy).rgb;\r\n\tt = abs(c - cLeftLeft);\r\n\tdelta.z = max(max(t.r, t.g), t.b);\r\n\r\n\tvec3 cTopTop = texture2D(tDiffuse, vOffset[2].zw).rgb;\r\n\tt = abs(c - cTopTop);\r\n\tdelta.w = max(max(t.r, t.g), t.b);\r\n\r\n\t// Calculate the final maximum delta.\r\n\tmaxDelta = max(max(maxDelta, delta.z), delta.w);\r\n\r\n\t// Local contrast adaptation in action.\r\n\tedges.xy *= step(0.5 * maxDelta, delta.xy);\r\n\r\n\tgl_FragColor = vec4(edges, 0.0, 0.0);\r\n\r\n}\r\n",m="uniform vec2 texelSize;\r\n\r\nvarying vec2 vUv;\r\nvarying vec4 vOffset[3];\r\n\r\nvoid main() {\r\n\r\n\tvUv = uv;\r\n\r\n\tvOffset[0] = uv.xyxy + texelSize.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // Changed sign in W component.\r\n\tvOffset[1] = uv.xyxy + texelSize.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // Changed sign in W component.\r\n\tvOffset[2] = uv.xyxy + texelSize.xyxy * vec4(-2.0, 0.0, 0.0, 2.0); // Changed sign in W component.\r\n\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n\r\n}\r\n",g=function(e){a(n,e);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new t.Vector2;return i(this,n),o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{type:"ColorEdgesMaterial",defines:{EDGE_THRESHOLD:"0.1"},uniforms:{tDiffuse:new t.Uniform(null),texelSize:new t.Uniform(e)},fragmentShader:y,vertexShader:m,depthWrite:!1,depthTest:!1}))}return r(n,[{key:"setEdgeDetectionThreshold",value:function(t){this.defines.EDGE_THRESHOLD=t.toFixed("2"),this.needsUpdate=!0}}]),n}(t.ShaderMaterial),p="uniform sampler2D texture1;\r\nuniform sampler2D texture2;\r\n\r\nuniform float opacity1;\r\nuniform float opacity2;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvec4 texel1 = opacity1 * texture2D(texture1, vUv);\r\n\tvec4 texel2 = opacity2 * texture2D(texture2, vUv);\r\n\r\n\t#ifdef SCREEN_MODE\r\n\r\n\t\tvec3 invTexel1 = vec3(1.0) - texel1.rgb;\r\n\t\tvec3 invTexel2 = vec3(1.0) - texel2.rgb;\r\n\r\n\t\tvec4 color = vec4(\r\n\t\t\tvec3(1.0) - invTexel1 * invTexel2,\r\n\t\t\ttexel1.a + texel2.a\r\n\t\t);\r\n\r\n\t#else\r\n\r\n\t\tvec4 color = texel1 + texel2;\r\n\r\n\t#endif\r\n\r\n\tgl_FragColor = color;\r\n\r\n}\r\n",x="varying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvUv = uv;\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n\r\n}\r\n",A=function(e){a(n,e);function n(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];i(this,n);var r=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{type:"CombineMaterial",uniforms:{texture1:new t.Uniform(null),texture2:new t.Uniform(null),opacity1:new t.Uniform(1),opacity2:new t.Uniform(1)},fragmentShader:p,vertexShader:x,depthWrite:!1,depthTest:!1}));return r.setScreenModeEnabled(e),r}return r(n,[{key:"setScreenModeEnabled",value:function(t){t?this.defines.SCREEN_MODE="1":delete this.defines.SCREEN_MODE,this.needsUpdate=!0}}]),n}(t.ShaderMaterial),w="#include <common>\r\n#include <dithering_pars_fragment>\r\n\r\nuniform sampler2D tDiffuse;\r\n\r\nvarying vec2 vUv0;\r\nvarying vec2 vUv1;\r\nvarying vec2 vUv2;\r\nvarying vec2 vUv3;\r\n\r\nvoid main() {\r\n\r\n\t// Sample top left texel.\r\n\tvec4 sum = texture2D(tDiffuse, vUv0);\r\n\r\n\t// Sample top right texel.\r\n\tsum += texture2D(tDiffuse, vUv1);\r\n\r\n\t// Sample bottom right texel.\r\n\tsum += texture2D(tDiffuse, vUv2);\r\n\r\n\t// Sample bottom left texel.\r\n\tsum += texture2D(tDiffuse, vUv3);\r\n\r\n\t// Compute the average.\r\n\tgl_FragColor = sum * 0.25;\r\n\r\n\t#include <dithering_fragment>\r\n\r\n}\r\n",k="uniform vec2 texelSize;\r\nuniform vec2 halfTexelSize;\r\nuniform float kernel;\r\n\r\nvarying vec2 vUv0;\r\nvarying vec2 vUv1;\r\nvarying vec2 vUv2;\r\nvarying vec2 vUv3;\r\n\r\nvoid main() {\r\n\r\n\tvec2 dUv = (texelSize * vec2(kernel)) + halfTexelSize;\r\n\r\n\tvUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);\r\n\tvUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);\r\n\tvUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);\r\n\tvUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);\r\n\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n\r\n}\r\n",M=function(e){a(n,e);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new t.Vector2;i(this,n);var r=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{type:"ConvolutionMaterial",uniforms:{tDiffuse:new t.Uniform(null),texelSize:new t.Uniform(new t.Vector2),halfTexelSize:new t.Uniform(new t.Vector2),kernel:new t.Uniform(0)},fragmentShader:w,vertexShader:k,depthWrite:!1,depthTest:!1}));return r.setTexelSize(e.x,e.y),r.kernelSize=D.LARGE,r}return r(n,[{key:"getKernel",value:function(){return z[this.kernelSize]}},{key:"setTexelSize",value:function(t,e){this.uniforms.texelSize.value.set(t,e),this.uniforms.halfTexelSize.value.set(t,e).multiplyScalar(.5)}}]),n}(t.ShaderMaterial),z=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],D={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},C="uniform sampler2D tDiffuse;\r\nuniform float opacity;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvec4 texel = texture2D(tDiffuse, vUv);\r\n\tgl_FragColor = opacity * texel;\r\n\r\n}\r\n",S="varying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvUv = uv;\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n\r\n}\r\n",b=function(e){a(n,e);function n(){return i(this,n),o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{type:"CopyMaterial",uniforms:{tDiffuse:new t.Uniform(null),opacity:new t.Uniform(1)},fragmentShader:C,vertexShader:S,depthWrite:!1,depthTest:!1}))}return n}(t.ShaderMaterial),E="uniform sampler2D tDiffuse;\r\n\r\nuniform float angle;\r\nuniform float scale;\r\nuniform float intensity;\r\n\r\nvarying vec2 vUv;\r\nvarying vec2 vUvPattern;\r\n\r\nfloat pattern() {\r\n\r\n\tfloat s = sin(angle);\r\n\tfloat c = cos(angle);\r\n\r\n\tvec2 point = vec2(c * vUvPattern.x - s * vUvPattern.y, s * vUvPattern.x + c * vUvPattern.y) * scale;\r\n\r\n\treturn (sin(point.x) * sin(point.y)) * 4.0;\r\n\r\n}\r\n\r\nvoid main() {\r\n\r\n\tvec4 texel = texture2D(tDiffuse, vUv);\r\n\tvec3 color = texel.rgb;\r\n\r\n\t#ifdef AVERAGE\r\n\r\n\t\tcolor = vec3((color.r + color.g + color.b) / 3.0);\r\n\r\n\t#endif\r\n\r\n\tcolor = vec3(color * 10.0 - 5.0 + pattern());\r\n\tcolor = texel.rgb + (color - texel.rgb) * intensity;\r\n\r\n\tgl_FragColor = vec4(color, texel.a);\r\n\r\n}\r\n",P="uniform vec4 offsetRepeat;\r\n\r\nvarying vec2 vUv;\r\nvarying vec2 vUvPattern;\r\n\r\nvoid main() {\r\n\r\n\tvUv = uv;\r\n\tvUvPattern = uv * offsetRepeat.zw + offsetRepeat.xy;\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n\r\n}\r\n",B=function(e){a(n,e);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,n);var r=Object.assign({average:!1,angle:1.57,scale:1,intensity:1},e),s=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{type:"DotScreenMaterial",uniforms:{tDiffuse:new t.Uniform(null),angle:new t.Uniform(r.angle),scale:new t.Uniform(r.scale),intensity:new t.Uniform(r.intensity),offsetRepeat:new t.Uniform(new t.Vector4(.5,.5,1,1))},fragmentShader:E,vertexShader:P,depthWrite:!1,depthTest:!1}));return s.setAverageEnabled(r.average),s}return r(n,[{key:"setAverageEnabled",value:function(t){t?this.defines.AVERAGE="1":delete this.defines.AVERAGE,this.needsUpdate=!0}}]),n}(t.ShaderMaterial),I="uniform sampler2D tDiffuse;\r\nuniform float time;\r\n\r\nvarying vec2 vUv;\r\n\r\n#ifdef NOISE\r\n\r\n\tuniform float noiseIntensity;\r\n\r\n#endif\r\n\r\n#ifdef SCANLINES\r\n\r\n\tuniform float scanlineIntensity;\r\n\tuniform float scanlineCount;\r\n\r\n#endif\r\n\r\n#ifdef GREYSCALE\r\n\r\n\t#include <common>\r\n\r\n\tuniform float greyscaleIntensity;\r\n\r\n#elif defined(SEPIA)\r\n\r\n\tuniform float sepiaIntensity;\r\n\r\n#endif\r\n\r\n#ifdef VIGNETTE\r\n\r\n\tuniform float vignetteOffset;\r\n\tuniform float vignetteDarkness;\r\n\r\n#endif\r\n\r\nvoid main() {\r\n\r\n\tvec4 texel = texture2D(tDiffuse, vUv);\r\n\tvec3 color = texel.rgb;\r\n\r\n\t#ifdef SCREEN_MODE\r\n\r\n\t\tvec3 invColor;\r\n\r\n\t#endif\r\n\r\n\t#ifdef NOISE\r\n\r\n\t\tfloat x = vUv.x * vUv.y * time * 1000.0;\r\n\t\tx = mod(x, 13.0) * mod(x, 123.0);\r\n\t\tx = mod(x, 0.01);\r\n\r\n\t\tvec3 noise = texel.rgb * clamp(0.1 + x * 100.0, 0.0, 1.0) * noiseIntensity;\r\n\r\n\t\t#ifdef SCREEN_MODE\r\n\r\n\t\t\tinvColor = vec3(1.0) - color;\r\n\t\t\tvec3 invNoise = vec3(1.0) - noise;\r\n\r\n\t\t\tcolor = vec3(1.0) - invColor * invNoise;\r\n\r\n\t\t#else\r\n\r\n\t\t\tcolor += noise;\r\n\r\n\t\t#endif\r\n\r\n\t#endif\r\n\r\n\t#ifdef SCANLINES\r\n\r\n\t\tvec2 sl = vec2(sin(vUv.y * scanlineCount), cos(vUv.y * scanlineCount));\r\n\t\tvec3 scanlines = texel.rgb * vec3(sl.x, sl.y, sl.x) * scanlineIntensity;\r\n\r\n\t\t#ifdef SCREEN_MODE\r\n\r\n\t\t\tinvColor = vec3(1.0) - color;\r\n\t\t\tvec3 invScanlines = vec3(1.0) - scanlines;\r\n\r\n\t\t\tcolor = vec3(1.0) - invColor * invScanlines;\r\n\r\n\t\t#else\r\n\r\n\t\t\tcolor += scanlines;\r\n\r\n\t\t#endif\r\n\r\n\t#endif\r\n\r\n\t#ifdef GREYSCALE\r\n\r\n\t\tcolor = mix(color, vec3(linearToRelativeLuminance(color)), greyscaleIntensity);\r\n\r\n\t#elif defined(SEPIA)\r\n\r\n\t\tvec3 c = color.rgb;\r\n\r\n\t\tcolor.r = dot(c, vec3(1.0 - 0.607 * sepiaIntensity, 0.769 * sepiaIntensity, 0.189 * sepiaIntensity));\r\n\t\tcolor.g = dot(c, vec3(0.349 * sepiaIntensity, 1.0 - 0.314 * sepiaIntensity, 0.168 * sepiaIntensity));\r\n\t\tcolor.b = dot(c, vec3(0.272 * sepiaIntensity, 0.534 * sepiaIntensity, 1.0 - 0.869 * sepiaIntensity));\r\n\r\n\t#endif\r\n\r\n\t#ifdef VIGNETTE\r\n\r\n\t\tconst vec2 center = vec2(0.5);\r\n\r\n\t\t#ifdef ESKIL\r\n\r\n\t\t\tvec2 uv = (vUv - center) * vec2(vignetteOffset);\r\n\t\t\tcolor = mix(color.rgb, vec3(1.0 - vignetteDarkness), dot(uv, uv));\r\n\r\n\t\t#else\r\n\r\n\t\t\tfloat dist = distance(vUv, center);\r\n\t\t\tcolor *= smoothstep(0.8, vignetteOffset * 0.799, dist * (vignetteDarkness + vignetteOffset));\r\n\r\n\t\t#endif\t\t\r\n\r\n\t#endif\r\n\r\n\tgl_FragColor = vec4(clamp(color, 0.0, 1.0), texel.a);\r\n\r\n}\r\n",T="varying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvUv = uv;\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n\r\n}\r\n",O=function(e){a(n,e);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,n);var r=Object.assign({screenMode:!0,noise:!0,scanlines:!0,greyscale:!1,sepia:!1,vignette:!1,eskil:!1,noiseIntensity:.5,scanlineIntensity:.05,greyscaleIntensity:1,sepiaIntensity:1,vignetteOffset:1,vignetteDarkness:1},e),s=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{type:"FilmMaterial",uniforms:{tDiffuse:new t.Uniform(null),time:new t.Uniform(0),noiseIntensity:new t.Uniform(r.noiseIntensity),scanlineIntensity:new t.Uniform(r.scanlineIntensity),scanlineCount:new t.Uniform(0),greyscaleIntensity:new t.Uniform(r.greyscaleIntensity),sepiaIntensity:new t.Uniform(r.sepiaIntensity),vignetteOffset:new t.Uniform(r.vignetteOffset),vignetteDarkness:new t.Uniform(r.vignetteDarkness)},fragmentShader:I,vertexShader:T,depthWrite:!1,depthTest:!1}));return s.setScreenModeEnabled(r.screenMode),s.setNoiseEnabled(r.noise),s.setScanlinesEnabled(r.scanlines),s.setGreyscaleEnabled(r.greyscale),s.setSepiaEnabled(r.sepia),s.setVignetteEnabled(r.vignette),s.setEskilEnabled(r.eskil),s}return r(n,[{key:"setScreenModeEnabled",value:function(t){t?this.defines.SCREEN_MODE="1":delete this.defines.SCREEN_MODE,this.needsUpdate=!0}},{key:"setNoiseEnabled",value:function(t){t?this.defines.NOISE="1":delete this.defines.NOISE,this.needsUpdate=!0}},{key:"setScanlinesEnabled",value:function(t){t?this.defines.SCANLINES="1":delete this.defines.SCANLINES,this.needsUpdate=!0}},{key:"setGreyscaleEnabled",value:function(t){t?this.defines.GREYSCALE="1":delete this.defines.GREYSCALE,this.needsUpdate=!0}},{key:"setSepiaEnabled",value:function(t){t?this.defines.SEPIA="1":delete this.defines.SEPIA,this.needsUpdate=!0}},{key:"setVignetteEnabled",value:function(t){t?this.defines.VIGNETTE="1":delete this.defines.VIGNETTE,this.needsUpdate=!0}},{key:"setEskilEnabled",value:function(t){t?this.defines.ESKIL="1":delete this.defines.ESKIL,this.needsUpdate=!0}}]),n}(t.ShaderMaterial),U="uniform sampler2D tDiffuse;\r\nuniform sampler2D tPerturb;\r\n\r\nuniform bool active;\r\n\r\nuniform float amount;\r\nuniform float angle;\r\nuniform float seed;\r\nuniform float seedX;\r\nuniform float seedY;\r\nuniform float distortionX;\r\nuniform float distortionY;\r\nuniform float colS;\r\n\r\nvarying vec2 vUv;\r\n\r\nfloat rand(vec2 tc) {\r\n\r\n\tconst float a = 12.9898;\r\n\tconst float b = 78.233;\r\n\tconst float c = 43758.5453;\r\n\r\n\tfloat dt = dot(tc, vec2(a, b));\r\n\tfloat sn = mod(dt, 3.14);\r\n\r\n\treturn fract(sin(sn) * c);\r\n\r\n}\r\n\r\nvoid main() {\r\n\r\n\tvec2 coord = vUv;\r\n\r\n\tfloat xs, ys;\r\n\tvec4 normal;\r\n\r\n\tvec2 offset;\r\n\tvec4 cr, cga, cb;\r\n\tvec4 snow, color;\r\n\r\n\tfloat sx, sy;\r\n\r\n\tif(active) {\r\n\r\n\t\txs = floor(gl_FragCoord.x / 0.5);\r\n\t\tys = floor(gl_FragCoord.y / 0.5);\r\n\r\n\t\tnormal = texture2D(tPerturb, coord * seed * seed);\r\n\r\n\t\tif(coord.y < distortionX + colS && coord.y > distortionX - colS * seed) {\r\n\r\n\t\t\tsx = clamp(ceil(seedX), 0.0, 1.0);\r\n\t\t\tcoord.y = sx * (1.0 - (coord.y + distortionY)) + (1.0 - sx) * distortionY;\r\n\r\n\t\t}\r\n\r\n\t\tif(coord.x < distortionY + colS && coord.x > distortionY - colS * seed) {\r\n\r\n\t\t\tsy = clamp(ceil(seedY), 0.0, 1.0);\r\n\t\t\tcoord.x = sy * distortionX + (1.0 - sy) * (1.0 - (coord.x + distortionX));\r\n\r\n\t\t}\r\n\r\n\t\tcoord.x += normal.x * seedX * (seed / 5.0);\r\n\t\tcoord.y += normal.y * seedY * (seed / 5.0);\r\n\r\n\t\toffset = amount * vec2(cos(angle), sin(angle));\r\n\r\n\t\tcr = texture2D(tDiffuse, coord + offset);\r\n\t\tcga = texture2D(tDiffuse, coord);\r\n\t\tcb = texture2D(tDiffuse, coord - offset);\r\n\r\n\t\tcolor = vec4(cr.r, cga.g, cb.b, cga.a);\r\n\t\tsnow = 200.0 * amount * vec4(rand(vec2(xs * seed, ys * seed * 50.0)) * 0.2);\r\n\t\tcolor += snow;\r\n\r\n\t} else {\r\n\r\n\t\tcolor = texture2D(tDiffuse, vUv);\r\n\r\n\t}\r\n\r\n\tgl_FragColor = color;\r\n\r\n}\r\n",F="varying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvUv = uv;\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n\r\n}\r\n",L=function(e){a(n,e);function n(){return i(this,n),o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{type:"GlitchMaterial",uniforms:{tDiffuse:new t.Uniform(null),tPerturb:new t.Uniform(null),active:new t.Uniform(1),amount:new t.Uniform(.8),angle:new t.Uniform(.02),seed:new t.Uniform(.02),seedX:new t.Uniform(.02),seedY:new t.Uniform(.02),distortionX:new t.Uniform(.5),distortionY:new t.Uniform(.6),colS:new t.Uniform(.05)},fragmentShader:U,vertexShader:F,depthWrite:!1,depthTest:!1}))}return n}(t.ShaderMaterial),R="#include <common>\r\n#include <dithering_pars_fragment>\r\n\r\nuniform sampler2D tDiffuse;\r\nuniform vec3 lightPosition;\r\n\r\nuniform float exposure;\r\nuniform float decay;\r\nuniform float density;\r\nuniform float weight;\r\nuniform float clampMax;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvec2 texCoord = vUv;\r\n\r\n\t// Calculate vector from pixel to light source in screen space.\r\n\tvec2 deltaTexCoord = texCoord - lightPosition.st;\r\n\tdeltaTexCoord *= 1.0 / NUM_SAMPLES_FLOAT * density;\r\n\r\n\t// A decreasing illumination factor.\r\n\tfloat illuminationDecay = 1.0;\r\n\r\n\tvec4 sample;\r\n\tvec4 color = vec4(0.0);\r\n\r\n\t// Estimate the probability of occlusion at each pixel by summing samples along a ray to the light source.\r\n\tfor(int i = 0; i < NUM_SAMPLES_INT; ++i) {\r\n\r\n\t\ttexCoord -= deltaTexCoord;\r\n\t\tsample = texture2D(tDiffuse, texCoord);\r\n\r\n\t\t// Apply sample attenuation scale/decay factors.\r\n\t\tsample *= illuminationDecay * weight;\r\n\r\n\t\tcolor += sample;\r\n\r\n\t\t// Update exponential decay factor.\r\n\t\tilluminationDecay *= decay;\r\n\r\n\t}\r\n\r\n\tgl_FragColor = clamp(color * exposure, 0.0, clampMax);\r\n\r\n\t#include <dithering_fragment>\r\n\r\n}\r\n",V="varying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvUv = uv;\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n\r\n}\r\n",G=function(e){a(n,e);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,n);var r=Object.assign({exposure:.6,density:.93,decay:.96,weight:.4,clampMax:1},e);return o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{type:"GodRaysMaterial",defines:{NUM_SAMPLES_FLOAT:"60.0",NUM_SAMPLES_INT:"60"},uniforms:{tDiffuse:new t.Uniform(null),lightPosition:new t.Uniform(null),exposure:new t.Uniform(r.exposure),decay:new t.Uniform(r.decay),density:new t.Uniform(r.density),weight:new t.Uniform(r.weight),clampMax:new t.Uniform(r.clampMax)},fragmentShader:R,vertexShader:V,depthWrite:!1,depthTest:!1}))}return n}(t.ShaderMaterial),Q="#include <common>\r\n\r\nuniform sampler2D tDiffuse;\r\nuniform float distinction;\r\nuniform vec2 range;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvec4 texel = texture2D(tDiffuse, vUv);\r\n\tfloat l = linearToRelativeLuminance(texel.rgb);\r\n\r\n\t#ifdef RANGE\r\n\r\n\t\tfloat low = step(range.x, l);\r\n\t\tfloat high = step(l, range.y);\r\n\r\n\t\t// Apply the mask.\r\n\t\tl *= low * high;\r\n\r\n\t#endif\r\n\r\n\tl = pow(abs(l), distinction);\r\n\r\n\t#ifdef COLOR\r\n\r\n\t\tgl_FragColor = vec4(texel.rgb * l, texel.a);\r\n\r\n\t#else\r\n\r\n\t\tgl_FragColor = vec4(l, l, l, texel.a);\r\n\r\n\t#endif\r\n\r\n}\r\n",N="varying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvUv = uv;\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n\r\n}\r\n",Y=function(e){a(n,e);function n(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i(this,n);var s=null!==r,a=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{type:"LuminosityMaterial",uniforms:{tDiffuse:new t.Uniform(null),distinction:new t.Uniform(1),range:new t.Uniform(s?r:new t.Vector2)},fragmentShader:Q,vertexShader:N}));return a.setColorOutputEnabled(e),a.setLuminanceRangeEnabled(s),a}return r(n,[{key:"setColorOutputEnabled",value:function(t){t?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}},{key:"setLuminanceRangeEnabled",value:function(t){t?this.defines.RANGE="1":delete this.defines.RANGE,this.needsUpdate=!0}}]),n}(t.ShaderMaterial),H="uniform sampler2D tDiffuse;\r\nuniform float granularity;\r\nuniform float dx;\r\nuniform float dy;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvec4 texel;\r\n\r\n\tif(granularity > 0.0) {\r\n\r\n\t\tvec2 coord = vec2(\r\n\t\t\tdx * (floor(vUv.x / dx) + 0.5),\r\n\t\t\tdy * (floor(vUv.y / dy) + 0.5)\r\n\t\t);\r\n\r\n\t\ttexel = texture2D(tDiffuse, coord);\r\n\r\n\t} else {\r\n\r\n\t\ttexel = texture2D(tDiffuse, vUv);\r\n\r\n\t}\r\n\r\n\tgl_FragColor = texel;\r\n\r\n}\r\n",q="varying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvUv = uv;\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n\r\n}\r\n",j=function(e){a(n,e);function n(){return i(this,n),o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{type:"PixelationMaterial",uniforms:{tDiffuse:new t.Uniform(null),granularity:new t.Uniform(1),resolution:new t.Uniform(new t.Vector2(1,1)),dx:new t.Uniform(1),dy:new t.Uniform(1)},fragmentShader:H,vertexShader:q,depthWrite:!1,depthTest:!1}))}return r(n,[{key:"setResolution",value:function(t,e){this.uniforms.resolution.value.set(t,e),this.granularity=this.granularity}},{key:"granularity",get:function(){return this.uniforms.granularity.value},set:function(t){var e=this.uniforms,n=e.resolution.value;e.granularity.value=t,e.dx.value=t/n.x,e.dy.value=t/n.y}}]),n}(t.ShaderMaterial),X="#include <common>\r\n\r\nuniform sampler2D tDiffuse;\r\nuniform sampler2D tDepth;\r\n\r\nuniform vec2 texelSize;\r\nuniform vec2 halfTexelSize;\r\n\r\nuniform float cameraNear;\r\nuniform float cameraFar;\r\n\r\nuniform float focalLength;\r\nuniform float focalStop;\r\n\r\nuniform float maxBlur;\r\nuniform float luminanceThreshold;\r\nuniform float luminanceGain;\r\nuniform float bias;\r\nuniform float fringe;\r\nuniform float ditherStrength;\r\n\r\n#ifdef SHADER_FOCUS\r\n\r\n\tuniform vec2 focusCoords;\r\n\r\n#else\r\n\r\n\tuniform float focalDepth;\r\n\r\n#endif\r\n\r\nvarying vec2 vUv;\r\n\r\n#ifndef USE_LOGDEPTHBUF\r\n\r\n\t#include <packing>\r\n\r\n\tfloat readDepth(sampler2D depthSampler, vec2 coord) {\r\n\r\n\t\tfloat fragCoordZ = texture2D(depthSampler, coord).x;\r\n\t\tfloat viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);\r\n\r\n\t\treturn viewZToOrthographicDepth(viewZ, cameraNear, cameraFar);\r\n\r\n\t}\r\n\r\n#endif\r\n\r\n#ifdef PENTAGON\r\n\r\n\tfloat penta(vec2 coords) {\r\n\r\n\t\tconst vec4 HS0 = vec4( 1.0,          0.0,         0.0, 1.0);\r\n\t\tconst vec4 HS1 = vec4( 0.309016994,  0.951056516, 0.0, 1.0);\r\n\t\tconst vec4 HS2 = vec4(-0.809016994,  0.587785252, 0.0, 1.0);\r\n\t\tconst vec4 HS3 = vec4(-0.809016994, -0.587785252, 0.0, 1.0);\r\n\t\tconst vec4 HS4 = vec4( 0.309016994, -0.951056516, 0.0, 1.0);\r\n\t\tconst vec4 HS5 = vec4( 0.0,          0.0,         1.0, 1.0);\r\n\r\n\t\tconst vec4 ONE = vec4(1.0);\r\n\r\n\t\tconst float P_FEATHER = 0.4;\r\n\t\tconst float N_FEATHER = -P_FEATHER;\r\n\r\n\t\tfloat inOrOut = -4.0;\r\n\r\n\t\tvec4 P = vec4(coords, vec2(RINGS_FLOAT - 1.3));\r\n\r\n\t\tvec4 dist = vec4(\r\n\t\t\tdot(P, HS0),\r\n\t\t\tdot(P, HS1),\r\n\t\t\tdot(P, HS2),\r\n\t\t\tdot(P, HS3)\r\n\t\t);\r\n\r\n\t\tdist = smoothstep(N_FEATHER, P_FEATHER, dist);\r\n\r\n\t\tinOrOut += dot(dist, ONE);\r\n\r\n\t\tdist.x = dot(P, HS4);\r\n\t\tdist.y = HS5.w - abs(P.z);\r\n\r\n\t\tdist = smoothstep(N_FEATHER, P_FEATHER, dist);\r\n\t\tinOrOut += dist.x;\r\n\r\n\t\treturn clamp(inOrOut, 0.0, 1.0);\r\n\r\n\t}\r\n\r\n#endif\r\n\r\n#ifdef SHOW_FOCUS\r\n\r\n\tvec3 debugFocus(vec3 c, float blur, float depth) {\r\n\r\n\t\tfloat edge = 0.002 * depth;\r\n\t\tfloat m = clamp(smoothstep(0.0, edge, blur), 0.0, 1.0);\r\n\t\tfloat e = clamp(smoothstep(1.0 - edge, 1.0, blur), 0.0, 1.0);\r\n\r\n\t\tc = mix(c, vec3(1.0, 0.5, 0.0), (1.0 - m) * 0.6);\r\n\t\tc = mix(c, vec3(0.0, 0.5, 1.0), ((1.0 - e) - (1.0 - m)) * 0.2);\r\n\r\n\t\treturn c;\r\n\r\n\t}\r\n\r\n#endif\r\n\r\n#ifdef VIGNETTE\r\n\r\n\tfloat vignette() {\r\n\r\n\t\tconst vec2 CENTER = vec2(0.5);\r\n\r\n\t\tconst float VIGNETTE_OUT = 1.3;\r\n\t\tconst float VIGNETTE_IN = 0.0;\r\n\t\tconst float VIGNETTE_FADE = 22.0; \r\n\r\n\t\tfloat d = distance(vUv, CENTER);\r\n\t\td = smoothstep(VIGNETTE_OUT + (focalStop / VIGNETTE_FADE), VIGNETTE_IN + (focalStop / VIGNETTE_FADE), d);\r\n\r\n\t\treturn clamp(d, 0.0, 1.0);\r\n\r\n\t}\r\n\r\n#endif\r\n\r\nvec2 rand2(vec2 coord) {\r\n\r\n\tvec2 noise;\r\n\r\n\t#ifdef NOISE\r\n\r\n\t\tconst float a = 12.9898;\r\n\t\tconst float b = 78.233;\r\n\t\tconst float c = 43758.5453;\r\n\r\n\t\tnoise.x = clamp(fract(sin(mod(dot(coord, vec2(a, b)), 3.14)) * c), 0.0, 1.0) * 2.0 - 1.0;\r\n\t\tnoise.y = clamp(fract(sin(mod(dot(coord, vec2(a, b) * 2.0), 3.14)) * c), 0.0, 1.0) * 2.0 - 1.0;\r\n\r\n\t#else\r\n\r\n\t\tnoise.x = ((fract(1.0 - coord.s * halfTexelSize.x) * 0.25) + (fract(coord.t * halfTexelSize.y) * 0.75)) * 2.0 - 1.0;\r\n\t\tnoise.y = ((fract(1.0 - coord.s * halfTexelSize.x) * 0.75) + (fract(coord.t * halfTexelSize.y) * 0.25)) * 2.0 - 1.0;\r\n\r\n\t#endif\r\n\r\n\treturn noise;\r\n\r\n}\r\n\r\nvec3 processTexel(vec2 coords, float blur) {\r\n\r\n\tvec3 c;\r\n\tc.r = texture2D(tDiffuse, coords + vec2(0.0, 1.0) * texelSize * fringe * blur).r;\r\n\tc.g = texture2D(tDiffuse, coords + vec2(-0.866, -0.5) * texelSize * fringe * blur).g;\r\n\tc.b = texture2D(tDiffuse, coords + vec2(0.866, -0.5) * texelSize * fringe * blur).b;\r\n\r\n\t// Calculate the luminance of the constructed colour.\r\n\tfloat luminance = linearToRelativeLuminance(c);\r\n\tfloat threshold = max((luminance - luminanceThreshold) * luminanceGain, 0.0);\r\n\r\n\treturn c + mix(vec3(0.0), c, threshold * blur);\r\n\r\n}\r\n\r\nfloat linearize(float depth) {\r\n\r\n\treturn -cameraFar * cameraNear / (depth * (cameraFar - cameraNear) - cameraFar);\r\n\r\n}\r\n\r\nfloat gather(float i, float j, float ringSamples, inout vec3 color, float w, float h, float blur) {\r\n\r\n\tconst float TWO_PI = 6.28318531;\r\n\r\n\tfloat step = TWO_PI / ringSamples;\r\n\tfloat pw = cos(j * step) * i;\r\n\tfloat ph = sin(j * step) * i;\r\n\r\n\t#ifdef PENTAGON\r\n\r\n\t\tfloat p = penta(vec2(pw, ph));\r\n\r\n\t#else\r\n\r\n\t\tfloat p = 1.0;\r\n\r\n\t#endif\r\n\r\n\tcolor += processTexel(vUv + vec2(pw * w, ph * h), blur) * mix(1.0, i / RINGS_FLOAT, bias) * p;\r\n\r\n\treturn mix(1.0, i / RINGS_FLOAT, bias) * p;\r\n\r\n}\r\n\r\nvoid main() {\r\n\r\n\t#ifdef USE_LOGDEPTHBUF\r\n\r\n\t\tfloat depth = linearize(texture2D(tDepth, vUv).x);\r\n\r\n\t#else\r\n\r\n\t\tfloat depth = linearize(readDepth(tDepth, vUv));\r\n\r\n\t#endif\r\n\r\n\t#ifdef SHADER_FOCUS\r\n\r\n\t\t#ifdef USE_LOGDEPTHBUF\r\n\r\n\t\t\tfloat fDepth = linearize(texture2D(tDepth, focusCoords).x);\r\n\r\n\t\t#else\r\n\r\n\t\t\tfloat fDepth = linearize(readDepth(tDepth, focusCoords));\r\n\r\n\t\t#endif\r\n\r\n\t#else\r\n\r\n\t\tfloat fDepth = focalDepth;\r\n\r\n\t#endif\r\n\r\n\t#ifdef MANUAL_DOF\r\n\r\n\t\tconst float nDoFStart = 1.0; \r\n\t\tconst float nDoFDist = 2.0;\r\n\t\tconst float fDoFStart = 1.0;\r\n\t\tconst float fDoFDist = 3.0;\r\n\r\n\t\tfloat focalPlane = depth - fDepth;\r\n\t\tfloat farDoF = (focalPlane - fDoFStart) / fDoFDist;\r\n\t\tfloat nearDoF = (-focalPlane - nDoFStart) / nDoFDist;\r\n\r\n\t\tfloat blur = (focalPlane > 0.0) ? farDoF : nearDoF;\r\n\r\n\t#else\r\n\r\n\t\tconst float CIRCLE_OF_CONFUSION = 0.03; // 35mm film = 0.03mm CoC.\r\n\r\n\t\tfloat focalPlaneMM = fDepth * 1000.0;\r\n\t\tfloat depthMM = depth * 1000.0;\r\n\r\n\t\tfloat focalPlane = (depthMM * focalLength) / (depthMM - focalLength);\r\n\t\tfloat farDoF = (focalPlaneMM * focalLength) / (focalPlaneMM - focalLength);\r\n\t\tfloat nearDoF = (focalPlaneMM - focalLength) / (focalPlaneMM * focalStop * CIRCLE_OF_CONFUSION);\r\n\r\n\t\tfloat blur = abs(focalPlane - farDoF) * nearDoF;\r\n\r\n\t#endif\r\n\r\n\tblur = clamp(blur, 0.0, 1.0);\r\n\r\n\t// Dithering.\r\n\tvec2 noise = rand2(vUv) * ditherStrength * blur;\r\n\r\n\tfloat blurFactorX = texelSize.x * blur * maxBlur + noise.x;\r\n\tfloat blurFactorY = texelSize.y * blur * maxBlur + noise.y;\r\n\r\n\tconst int MAX_RING_SAMPLES = RINGS_INT * SAMPLES_INT;\r\n\r\n\t// Calculation of final color.\r\n\tvec4 color;\r\n\r\n\tif(blur < 0.05) {\r\n\r\n\t\tcolor = texture2D(tDiffuse, vUv);\r\n\r\n\t} else {\r\n\r\n\t\tcolor = texture2D(tDiffuse, vUv);\r\n\r\n\t\tfloat s = 1.0;\r\n\t\tint ringSamples;\r\n\r\n\t\tfor(int i = 1; i <= RINGS_INT; ++i) {\r\n\r\n\t\t\tringSamples = i * SAMPLES_INT;\r\n\r\n\t\t\t// Constant loop.\r\n\t\t\tfor(int j = 0; j < MAX_RING_SAMPLES; ++j) {\r\n\r\n\t\t\t\t// Break earlier.\r\n\t\t\t\tif(j >= ringSamples) { break; }\r\n\r\n\t\t\t\ts += gather(float(i), float(j), float(ringSamples), color.rgb, blurFactorX, blurFactorY, blur);\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tcolor.rgb /= s; // Divide by sample count.\r\n\r\n\t}\r\n\r\n\t#ifdef SHOW_FOCUS\r\n\r\n\t\tcolor.rgb = debugFocus(color.rgb, blur, depth);\r\n\r\n\t#endif\r\n\r\n\t#ifdef VIGNETTE\r\n\r\n\t\tcolor.rgb *= vignette();\r\n\r\n\t#endif\r\n\r\n\tgl_FragColor = color;\r\n\r\n}\r\n",W="varying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvUv = uv;\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n\r\n}\r\n",K=function(e){a(n,e);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,n);var s=Object.assign({texelSize:null,rings:3,samples:2,showFocus:!1,manualDoF:!1,vignette:!1,pentagon:!1,shaderFocus:!0,noise:!0,maxBlur:1,luminanceThreshold:.5,luminanceGain:2,bias:.5,fringe:.7,ditherStrength:1e-4},r),a=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{type:"RealisticBokehMaterial",defines:{RINGS_INT:s.rings.toFixed(0),RINGS_FLOAT:s.rings.toFixed(1),SAMPLES_INT:s.samples.toFixed(0),SAMPLES_FLOAT:s.samples.toFixed(1)},uniforms:{tDiffuse:new t.Uniform(null),tDepth:new t.Uniform(null),texelSize:new t.Uniform(new t.Vector2),halfTexelSize:new t.Uniform(new t.Vector2),cameraNear:new t.Uniform(.1),cameraFar:new t.Uniform(2e3),focalLength:new t.Uniform(24),focalStop:new t.Uniform(.9),maxBlur:new t.Uniform(s.maxBlur),luminanceThreshold:new t.Uniform(s.luminanceThreshold),luminanceGain:new t.Uniform(s.luminanceGain),bias:new t.Uniform(s.bias),fringe:new t.Uniform(s.fringe),ditherStrength:new t.Uniform(s.ditherStrength),focusCoords:new t.Uniform(new t.Vector2(.5,.5)),focalDepth:new t.Uniform(1)},fragmentShader:X,vertexShader:W,depthWrite:!1,depthTest:!1}));return a.setShowFocusEnabled(s.showFocus),a.setManualDepthOfFieldEnabled(s.manualDoF),a.setVignetteEnabled(s.vignette),a.setPentagonEnabled(s.pentagon),a.setShaderFocusEnabled(s.shaderFocus),a.setNoiseEnabled(s.noise),null!==s.texelSize&&a.setTexelSize(s.texelSize.x,s.texelSize.y),a.adoptCameraSettings(e),a}return r(n,[{key:"setShowFocusEnabled",value:function(t){t?this.defines.SHOW_FOCUS="1":delete this.defines.SHOW_FOCUS,this.needsUpdate=!0}},{key:"setManualDepthOfFieldEnabled",value:function(t){t?this.defines.MANUAL_DOF="1":delete this.defines.MANUAL_DOF,this.needsUpdate=!0}},{key:"setVignetteEnabled",value:function(t){t?this.defines.VIGNETTE="1":delete this.defines.VIGNETTE,this.needsUpdate=!0}},{key:"setPentagonEnabled",value:function(t){t?this.defines.PENTAGON="1":delete this.defines.PENTAGON,this.needsUpdate=!0}},{key:"setShaderFocusEnabled",value:function(t){t?this.defines.SHADER_FOCUS="1":delete this.defines.SHADER_FOCUS,this.needsUpdate=!0}},{key:"setNoiseEnabled",value:function(t){t?this.defines.NOISE="1":delete this.defines.NOISE,this.needsUpdate=!0}},{key:"setTexelSize",value:function(t,e){this.uniforms.texelSize.value.set(t,e),this.uniforms.halfTexelSize.value.set(t,e).multiplyScalar(.5)}},{key:"adoptCameraSettings",value:function(t){null!==t&&(this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far,this.uniforms.focalLength.value=t.getFocalLength())}}]),n}(t.ShaderMaterial),J="#include <common>\r\n\r\nuniform sampler2D tDiffuse;\r\nuniform vec2 center;\r\nuniform float aspect;\r\nuniform float waveSize;\r\nuniform float radius;\r\nuniform float maxRadius;\r\nuniform float amplitude;\r\n\r\nvarying vec2 vUv;\r\nvarying float vSize;\r\n\r\nvoid main() {\r\n\r\n\tvec2 aspectCorrection = vec2(aspect, 1.0);\r\n\r\n\tvec2 difference = vUv * aspectCorrection - center * aspectCorrection;\r\n\tfloat distance = sqrt(dot(difference, difference)) * vSize;\r\n\r\n\tvec2 displacement = vec2(0.0);\r\n\r\n\tif(distance > radius) {\r\n\r\n\t\tif(distance < radius + waveSize) {\r\n\r\n\t\t\tfloat angle = (distance - radius) * PI2 / waveSize;\r\n\t\t\tfloat cosSin = (1.0 - cos(angle)) * 0.5;\r\n\r\n\t\t\tfloat extent = maxRadius + waveSize;\r\n\t\t\tfloat decay = max(extent - distance * distance, 0.0) / extent;\r\n\r\n\t\t\tdisplacement = ((cosSin * amplitude * difference) / distance) * decay;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tgl_FragColor = texture2D(tDiffuse, vUv - displacement);\r\n\r\n}\r\n",Z="uniform float size;\r\nuniform float scale;\r\nuniform float cameraDistance;\r\n\r\nvarying vec2 vUv;\r\nvarying float vSize;\r\n\r\nvoid main() {\r\n\r\n\tvUv = uv;\r\n\tvSize = (0.1 * cameraDistance) / size;\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n\r\n}\r\n",_=function(e){a(n,e);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,n);var r=Object.assign({maxRadius:1,waveSize:.2,amplitude:.05},e);return o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{type:"ShockWaveMaterial",uniforms:{tDiffuse:new t.Uniform(null),center:new t.Uniform(new t.Vector2(.5,.5)),aspect:new t.Uniform(1),cameraDistance:new t.Uniform(1),size:new t.Uniform(1),radius:new t.Uniform(-r.waveSize),maxRadius:new t.Uniform(r.maxRadius),waveSize:new t.Uniform(r.waveSize),amplitude:new t.Uniform(r.amplitude)},fragmentShader:J,vertexShader:Z,depthWrite:!1,depthTest:!1}))}return n}(t.ShaderMaterial),$="uniform sampler2D tDiffuse;\r\nuniform sampler2D tWeights;\r\n\r\nuniform vec2 texelSize;\r\n\r\nvarying vec2 vUv;\r\nvarying vec4 vOffset;\r\n\r\nvoid main() {\r\n\r\n\t// Fetch the blending weights for current pixel.\r\n\tvec4 a;\r\n\ta.xz = texture2D(tWeights, vUv).xz;\r\n\ta.y = texture2D(tWeights, vOffset.zw).g;\r\n\ta.w = texture2D(tWeights, vOffset.xy).a;\r\n\r\n\tvec4 color;\r\n\r\n\t// Check if there is any blending weight with a value greater than 0.0.\r\n\tif(dot(a, vec4(1.0)) < 1e-5) {\r\n\r\n\t\tcolor = texture2D(tDiffuse, vUv, 0.0);\r\n\r\n\t} else {\r\n\r\n\t\t/* Up to four lines can be crossing a pixel (one through each edge).\r\n\t\t * The line with the maximum weight for each direction is favoured.\r\n\t\t */\r\n\r\n\t\tvec2 offset;\r\n\t\toffset.x = a.a > a.b ? a.a : -a.b; // Left vs. right.\r\n\t\toffset.y = a.g > a.r ? -a.g : a.r; // Top vs. bottom (changed signs).\r\n\r\n\t\t// Go in the direction with the maximum weight (horizontal vs. vertical).\r\n\t\tif(abs(offset.x) > abs(offset.y)) {\r\n\r\n\t\t\toffset.y = 0.0;\r\n\r\n\t\t} else {\r\n\r\n\t\t\toffset.x = 0.0;\r\n\r\n\t\t}\r\n\r\n\t\t// Fetch the opposite color and lerp by hand.\r\n\t\tcolor = texture2D(tDiffuse, vUv, 0.0);\r\n\t\tvec2 coord = vUv + sign(offset) * texelSize;\r\n\t\tvec4 oppositeColor = texture2D(tDiffuse, coord, 0.0);\r\n\t\tfloat s = abs(offset.x) > abs(offset.y) ? abs(offset.x) : abs(offset.y);\r\n\r\n\t\t// Gamma correction.\r\n\t\tcolor.rgb = pow(abs(color.rgb), vec3(2.2));\r\n\t\toppositeColor.rgb = pow(abs(oppositeColor.rgb), vec3(2.2));\r\n\t\tcolor = mix(color, oppositeColor, s);\r\n\t\tcolor.rgb = pow(abs(color.rgb), vec3(1.0 / 2.2));\r\n\r\n\t}\r\n\r\n\tgl_FragColor = color;\r\n\r\n}\r\n",tt="uniform vec2 texelSize;\r\n\r\nvarying vec2 vUv;\r\nvarying vec4 vOffset;\r\n\r\nvoid main() {\r\n\r\n\tvUv = uv;\r\n\r\n\tvOffset = uv.xyxy + texelSize.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // Changed sign in W component.\r\n\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n\r\n}\r\n",et=function(e){a(n,e);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new t.Vector2;return i(this,n),o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{type:"SMAABlendMaterial",uniforms:{tDiffuse:new t.Uniform(null),tWeights:new t.Uniform(null),texelSize:new t.Uniform(e)},fragmentShader:$,vertexShader:tt,depthWrite:!1,depthTest:!1}))}return n}(t.ShaderMaterial),nt="#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + float(offset) * texelSize, 0.0)\r\n\r\nuniform sampler2D tDiffuse;\r\nuniform sampler2D tArea;\r\nuniform sampler2D tSearch;\r\n\r\nuniform vec2 texelSize;\r\n\r\nvarying vec2 vUv;\r\nvarying vec4 vOffset[3];\r\nvarying vec2 vPixCoord;\r\n\r\nvec2 round(vec2 x) {\r\n\r\n\treturn sign(x) * floor(abs(x) + 0.5);\r\n\r\n}\r\n\r\nfloat searchLength(vec2 e, float bias, float scale) {\r\n\r\n\t// Not required if tSearch accesses are set to point.\r\n\t// const vec2 SEARCH_TEX_PIXEL_SIZE = 1.0 / vec2(66.0, 33.0);\r\n\t// e = vec2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE + e * vec2(scale, 1.0) * vec2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;\r\n\r\n\te.r = bias + e.r * scale;\r\n\r\n\treturn 255.0 * texture2D(tSearch, e, 0.0).r;\r\n\r\n}\r\n\r\nfloat searchXLeft(vec2 texCoord, float end) {\r\n\r\n\t/* @PSEUDO_GATHER4\r\n\t * This texCoord has been offset by (-0.25, -0.125) in the vertex shader to\r\n\t * sample between edge, thus fetching four edges in a row.\r\n\t * Sampling with different offsets in each direction allows to disambiguate\r\n\t * which edges are active from the four fetched ones.\r\n\t */\r\n\r\n\tvec2 e = vec2(0.0, 1.0);\r\n\r\n\tfor(int i = 0; i < MAX_SEARCH_STEPS_INT; ++i) {\r\n\r\n\t\te = texture2D(tDiffuse, texCoord, 0.0).rg;\r\n\t\ttexCoord -= vec2(2.0, 0.0) * texelSize;\r\n\r\n\t\tif(!(texCoord.x > end && e.g > 0.8281 && e.r == 0.0)) { break; }\r\n\r\n\t}\r\n\r\n\t// Correct the previously applied offset (-0.25, -0.125).\r\n\ttexCoord.x += 0.25 * texelSize.x;\r\n\r\n\t// The searches are biased by 1, so adjust the coords accordingly.\r\n\ttexCoord.x += texelSize.x;\r\n\r\n\t// Disambiguate the length added by the last step.\r\n\ttexCoord.x += 2.0 * texelSize.x; // Undo last step.\r\n\ttexCoord.x -= texelSize.x * searchLength(e, 0.0, 0.5);\r\n\r\n\treturn texCoord.x;\r\n\r\n}\r\n\r\nfloat searchXRight(vec2 texCoord, float end) {\r\n\r\n\tvec2 e = vec2(0.0, 1.0);\r\n\r\n\tfor(int i = 0; i < MAX_SEARCH_STEPS_INT; ++i) {\r\n\r\n\t\te = texture2D(tDiffuse, texCoord, 0.0).rg;\r\n\t\ttexCoord += vec2(2.0, 0.0) * texelSize;\r\n\r\n\t\tif(!(texCoord.x < end && e.g > 0.8281 && e.r == 0.0)) { break; }\r\n\r\n\t}\r\n\r\n\ttexCoord.x -= 0.25 * texelSize.x;\r\n\ttexCoord.x -= texelSize.x;\r\n\ttexCoord.x -= 2.0 * texelSize.x;\r\n\ttexCoord.x += texelSize.x * searchLength(e, 0.5, 0.5);\r\n\r\n\treturn texCoord.x;\r\n\r\n}\r\n\r\nfloat searchYUp(vec2 texCoord, float end) {\r\n\r\n\tvec2 e = vec2(1.0, 0.0);\r\n\r\n\tfor(int i = 0; i < MAX_SEARCH_STEPS_INT; ++i) {\r\n\r\n\t\te = texture2D(tDiffuse, texCoord, 0.0).rg;\r\n\t\ttexCoord += vec2(0.0, 2.0) * texelSize; // Changed sign.\r\n\r\n\t\tif(!(texCoord.y > end && e.r > 0.8281 && e.g == 0.0)) { break; }\r\n\r\n\t}\r\n\r\n\ttexCoord.y -= 0.25 * texelSize.y; // Changed sign.\r\n\ttexCoord.y -= texelSize.y; // Changed sign.\r\n\ttexCoord.y -= 2.0 * texelSize.y; // Changed sign.\r\n\ttexCoord.y += texelSize.y * searchLength(e.gr, 0.0, 0.5); // Changed sign.\r\n\r\n\treturn texCoord.y;\r\n\r\n}\r\n\r\nfloat searchYDown(vec2 texCoord, float end) {\r\n\r\n\tvec2 e = vec2(1.0, 0.0);\r\n\r\n\tfor(int i = 0; i < MAX_SEARCH_STEPS_INT; ++i ) {\r\n\r\n\t\te = texture2D(tDiffuse, texCoord, 0.0).rg;\r\n\t\ttexCoord -= vec2(0.0, 2.0) * texelSize; // Changed sign.\r\n\r\n\t\tif(!(texCoord.y < end && e.r > 0.8281 && e.g == 0.0)) { break; }\r\n\r\n\t}\r\n\r\n\ttexCoord.y += 0.25 * texelSize.y; // Changed sign.\r\n\ttexCoord.y += texelSize.y; // Changed sign.\r\n\ttexCoord.y += 2.0 * texelSize.y; // Changed sign.\r\n\ttexCoord.y -= texelSize.y * searchLength(e.gr, 0.5, 0.5); // Changed sign.\r\n\r\n\treturn texCoord.y;\r\n\r\n}\r\n\r\nvec2 area(vec2 dist, float e1, float e2, float offset) {\r\n\r\n\t// Rounding prevents precision errors of bilinear filtering.\r\n\tvec2 texCoord = AREATEX_MAX_DISTANCE * round(4.0 * vec2(e1, e2)) + dist;\r\n\r\n\t// Scale and bias for texel space translation.\r\n\ttexCoord = AREATEX_PIXEL_SIZE * texCoord + (0.5 * AREATEX_PIXEL_SIZE);\r\n\r\n\t// Move to proper place, according to the subpixel offset.\r\n\ttexCoord.y += AREATEX_SUBTEX_SIZE * offset;\r\n\r\n\treturn texture2D(tArea, texCoord, 0.0).rg;\r\n\r\n}\r\n\r\nvoid main() {\r\n\r\n\tvec4 weights = vec4(0.0);\r\n\tvec4 subsampleIndices = vec4(0.0);\r\n\tvec2 e = texture2D(tDiffuse, vUv).rg;\r\n\r\n\tif(e.g > 0.0) {\r\n\r\n\t\t// Edge at north.\r\n\t\tvec2 d;\r\n\r\n\t\t// Find the distance to the left.\r\n\t\tvec2 coords;\r\n\t\tcoords.x = searchXLeft(vOffset[0].xy, vOffset[2].x);\r\n\t\tcoords.y = vOffset[1].y; // vOffset[1].y = vUv.y - 0.25 * texelSize.y (@CROSSING_OFFSET)\r\n\t\td.x = coords.x;\r\n\r\n\t\t/* Now fetch the left crossing edges, two at a time using bilinear\r\n\t\tfiltering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to discern what\r\n\t\tvalue each edge has. */\r\n\t\tfloat e1 = texture2D(tDiffuse, coords, 0.0).r;\r\n\r\n\t\t// Find the distance to the right.\r\n\t\tcoords.x = searchXRight(vOffset[0].zw, vOffset[2].y);\r\n\t\td.y = coords.x;\r\n\r\n\t\t/* Translate distances to pixel units for better interleave arithmetic and\r\n\t\tmemory accesses. */\r\n\t\td = d / texelSize.x - vPixCoord.x;\r\n\r\n\t\t// The area texture is compressed quadratically.\r\n\t\tvec2 sqrtD = sqrt(abs(d));\r\n\r\n\t\t// Fetch the right crossing edges.\r\n\t\tcoords.y -= texelSize.y; // WebGL port note: Added.\r\n\t\tfloat e2 = sampleLevelZeroOffset(tDiffuse, coords, ivec2(1, 0)).r;\r\n\r\n\t\t// Pattern recognised, now get the actual area.\r\n\t\tweights.rg = area(sqrtD, e1, e2, subsampleIndices.y);\r\n\r\n\t}\r\n\r\n\tif(e.r > 0.0) {\r\n\r\n\t\t// Edge at west.\r\n\t\tvec2 d;\r\n\r\n\t\t// Find the distance to the top.\r\n\t\tvec2 coords;\r\n\t\tcoords.y = searchYUp(vOffset[1].xy, vOffset[2].z);\r\n\t\tcoords.x = vOffset[0].x; // vOffset[1].x = vUv.x - 0.25 * texelSize.x;\r\n\t\td.x = coords.y;\r\n\r\n\t\t// Fetch the top crossing edges.\r\n\t\tfloat e1 = texture2D(tDiffuse, coords, 0.0).g;\r\n\r\n\t\t// Find the distance to the bottom.\r\n\t\tcoords.y = searchYDown(vOffset[1].zw, vOffset[2].w);\r\n\t\td.y = coords.y;\r\n\r\n\t\t// Distances in pixel units.\r\n\t\td = d / texelSize.y - vPixCoord.y;\r\n\r\n\t\t// The area texture is compressed quadratically.\r\n\t\tvec2 sqrtD = sqrt(abs(d));\r\n\r\n\t\t// Fetch the bottom crossing edges.\r\n\t\tcoords.y -= texelSize.y; // WebGL port note: Added.\r\n\t\tfloat e2 = sampleLevelZeroOffset(tDiffuse, coords, ivec2(0, 1)).g;\r\n\r\n\t\t// Get the area for this direction.\r\n\t\tweights.ba = area(sqrtD, e1, e2, subsampleIndices.x);\r\n\r\n\t}\r\n\r\n\tgl_FragColor = weights;\r\n\r\n}\r\n",it="uniform vec2 texelSize;\r\n\r\nvarying vec2 vUv;\r\nvarying vec4 vOffset[3];\r\nvarying vec2 vPixCoord;\r\n\r\nvoid main() {\r\n\r\n\tvUv = uv;\r\n\r\n\tvPixCoord = uv / texelSize;\r\n\r\n\t// Offsets for the searches (see @PSEUDO_GATHER4).\r\n\tvOffset[0] = uv.xyxy + texelSize.xyxy * vec4(-0.25, 0.125, 1.25, 0.125); // Changed sign in Y and W components.\r\n\tvOffset[1] = uv.xyxy + texelSize.xyxy * vec4(-0.125, 0.25, -0.125, -1.25); //Changed sign in Y and W components.\r\n\r\n\t// This indicates the ends of the loops.\r\n\tvOffset[2] = vec4(vOffset[0].xz, vOffset[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * texelSize.xxyy * MAX_SEARCH_STEPS_FLOAT;\r\n\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n\r\n}\r\n",rt=function(e){a(n,e);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new t.Vector2;return i(this,n),o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{type:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"8",MAX_SEARCH_STEPS_FLOAT:"8.0",AREATEX_MAX_DISTANCE:"16.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{tDiffuse:new t.Uniform(null),tArea:new t.Uniform(null),tSearch:new t.Uniform(null),texelSize:new t.Uniform(e)},fragmentShader:nt,vertexShader:it,depthWrite:!1,depthTest:!1}))}return r(n,[{key:"setOrthogonalSearchSteps",value:function(t){this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}}]),n}(t.ShaderMaterial),st="#include <common>\r\n#include <dithering_pars_fragment>\r\n\r\nuniform sampler2D tDiffuse;\r\nuniform float middleGrey;\r\nuniform float maxLuminance;\r\n\r\n#ifdef ADAPTED_LUMINANCE\r\n\r\n\tuniform sampler2D luminanceMap;\r\n\r\n#else\r\n\r\n\tuniform float averageLuminance;\r\n\r\n#endif\r\n\r\nvarying vec2 vUv;\r\n\r\nvec3 toneMap(vec3 c) {\r\n\r\n\t#ifdef ADAPTED_LUMINANCE\r\n\r\n\t\t// Get the calculated average luminance by sampling the center.\r\n\t\tfloat lumAvg = texture2D(luminanceMap, vec2(0.5)).r;\r\n\r\n\t#else\r\n\r\n\t\tfloat lumAvg = averageLuminance;\r\n\r\n\t#endif\r\n\r\n\t// Calculate the luminance of the current pixel.\r\n\tfloat lumPixel = linearToRelativeLuminance(c);\r\n\r\n\t// Apply the modified operator (Reinhard Eq. 4).\r\n\tfloat lumScaled = (lumPixel * middleGrey) / lumAvg;\r\n\r\n\tfloat lumCompressed = (lumScaled * (1.0 + (lumScaled / (maxLuminance * maxLuminance)))) / (1.0 + lumScaled);\r\n\r\n\treturn lumCompressed * c;\r\n\r\n}\r\n\r\nvoid main() {\r\n\r\n\tvec4 texel = texture2D(tDiffuse, vUv);\r\n\tgl_FragColor = vec4(toneMap(texel.rgb), texel.a);\r\n\r\n\t#include <dithering_fragment>\r\n\r\n}\r\n",at="varying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvUv = uv;\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n\r\n}\r\n",ot=function(e){a(n,e);function n(){return i(this,n),o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{type:"ToneMappingMaterial",uniforms:{tDiffuse:new t.Uniform(null),luminanceMap:new t.Uniform(null),averageLuminance:new t.Uniform(1),maxLuminance:new t.Uniform(16),middleGrey:new t.Uniform(.6)},fragmentShader:st,vertexShader:at,depthWrite:!1,depthTest:!1}))}return n}(t.ShaderMaterial),ut=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new t.Scene,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t.OrthographicCamera(-1,1,1,-1,0,1),s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.Mesh(new t.PlaneBufferGeometry(2,2),null);i(this,e),this.name="Pass",this.scene=n,this.camera=r,this.quad=s,null!==this.quad&&(this.quad.frustumCulled=!1,null!==this.scene&&this.scene.add(this.quad)),this.needsSwap=!1,this.enabled=!0,this.renderToScreen=!1}return r(e,[{key:"render",value:function(t,e,n,i,r){throw new Error("Render method not implemented!")}},{key:"setSize",value:function(t,e){}},{key:"initialize",value:function(t,e){}},{key:"dispose",value:function(){var t=void 0,e=!0,n=!1,i=void 0;try{for(var r,s=Object.keys(this)[Symbol.iterator]();!(e=(r=s.next()).done);e=!0)null!==this[t=r.value]&&"function"==typeof this[t].dispose&&(this[t].dispose(),this[t]=null)}catch(t){n=!0,i=t}finally{try{!e&&s.return&&s.return()}finally{if(n)throw i}}}}]),e}(),ht=function(e){a(n,ut);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,n);var r=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r.name="BlurPass",r.needsSwap=!0,r.renderTargetX=new t.WebGLRenderTarget(1,1,{minFilter:t.LinearFilter,magFilter:t.LinearFilter,stencilBuffer:!1,depthBuffer:!1}),r.renderTargetX.texture.name="Blur.TargetX",r.renderTargetX.texture.generateMipmaps=!1,r.renderTargetY=r.renderTargetX.clone(),r.renderTargetY.texture.name="Blur.TargetY",r.resolutionScale=void 0!==e.resolutionScale?e.resolutionScale:.5,r.convolutionMaterial=new M,r.ditheredConvolutionMaterial=new M,r.ditheredConvolutionMaterial.dithering=!0,r.dithering=!1,r.kernelSize=e.kernelSize,r}return r(n,[{key:"render",value:function(t,e,n){var i=this.scene,r=this.camera,s=this.renderTargetX,a=this.renderTargetY,o=this.convolutionMaterial,u=o.uniforms,h=o.getKernel(),l=e,c=void 0,d=void 0,v=void 0;for(this.quad.material=o,d=0,v=h.length-1;d<v;++d)c=d%2==0?s:a,u.kernel.value=h[d],u.tDiffuse.value=l.texture,t.render(i,r,c),l=c;this.dithering&&(u=(o=this.ditheredConvolutionMaterial).uniforms,this.quad.material=o),u.kernel.value=h[d],u.tDiffuse.value=l.texture,t.render(i,r,this.renderToScreen?null:n)}},{key:"initialize",value:function(e,n){n||(this.renderTargetX.texture.format=t.RGBFormat,this.renderTargetY.texture.format=t.RGBFormat)}},{key:"setSize",value:function(t,e){t=Math.max(1,Math.floor(t*this.resolutionScale)),e=Math.max(1,Math.floor(e*this.resolutionScale)),this.renderTargetX.setSize(t,e),this.renderTargetY.setSize(t,e),this.convolutionMaterial.setTexelSize(1/t,1/e),this.ditheredConvolutionMaterial.setTexelSize(1/t,1/e)}},{key:"width",get:function(){return this.renderTargetX.width}},{key:"height",get:function(){return this.renderTargetX.height}},{key:"kernelSize",get:function(){return this.convolutionMaterial.kernelSize},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D.LARGE;this.convolutionMaterial.kernelSize=t,this.ditheredConvolutionMaterial.kernelSize=t}}]),n}(),lt=(function(e){a(n,ut);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,n);var r=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r.name="BloomPass",r.needsSwap=!0,r.blurPass=new ht(e),r.renderTarget=new t.WebGLRenderTarget(1,1,{minFilter:t.LinearFilter,magFilter:t.LinearFilter,stencilBuffer:!1,depthBuffer:!1}),r.renderTarget.texture.name="Bloom.Target",r.renderTarget.texture.generateMipmaps=!1,r.combineMaterial=new A(void 0===e.screenMode||e.screenMode),r.intensity=e.intensity,r.luminosityMaterial=new Y(!0),r.distinction=e.distinction,r}r(n,[{key:"render",value:function(t,e,n){var i=this.quad,r=this.scene,s=this.camera,a=this.blurPass,o=this.luminosityMaterial,u=this.combineMaterial,h=this.renderTarget;i.material=o,o.uniforms.tDiffuse.value=e.texture,t.render(r,s,h),a.render(t,h,h),i.material=u,u.uniforms.texture1.value=e.texture,u.uniforms.texture2.value=h.texture,t.render(r,s,this.renderToScreen?null:n)}},{key:"initialize",value:function(e,n){this.blurPass.initialize(e,n),n||(this.renderTarget.texture.format=t.RGBFormat)}},{key:"setSize",value:function(t,e){this.blurPass.setSize(t,e),t=this.blurPass.width,e=this.blurPass.height,this.renderTarget.setSize(t,e)}},{key:"resolutionScale",get:function(){return this.blurPass.resolutionScale},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;this.blurPass.resolutionScale=t}},{key:"kernelSize",get:function(){return this.blurPass.kernelSize},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D.LARGE;this.blurPass.kernelSize=t}},{key:"intensity",get:function(){return this.combineMaterial.uniforms.opacity2.value},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.combineMaterial.uniforms.opacity2.value=t}},{key:"distinction",get:function(){return this.luminosityMaterial.uniforms.distinction.value},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.luminosityMaterial.uniforms.distinction.value=t}},{key:"dithering",get:function(){return this.blurPass.dithering},set:function(t){this.blurPass.dithering=t}}])}(),function(t){a(e,ut);function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.name="BokehPass",r.needsSwap=!0,r.bokehMaterial=new f(t,n),r.quad.material=r.bokehMaterial,r}r(e,[{key:"render",value:function(t,e,n){this.bokehMaterial.uniforms.tDiffuse.value=e.texture,this.bokehMaterial.uniforms.tDepth.value=e.depthTexture,t.render(this.scene,this.camera,this.renderToScreen?null:n)}},{key:"setSize",value:function(t,e){this.bokehMaterial.uniforms.aspect.value=t/e}}])}(),function(t){a(e,ut);function e(){i(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,null,null,null));return t.name="ClearMaskPass",t}return r(e,[{key:"render",value:function(t){t.state.buffers.stencil.setTest(!1)}}]),e}()),ct=new t.Color,dt=function(t){a(e,ut);function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,null,null,null));return n.name="ClearPass",n.clearColor=void 0!==t.clearColor?t.clearColor:null,n.clearAlpha=void 0!==t.clearAlpha?t.clearAlpha:0,n}return r(e,[{key:"render",value:function(t,e){var n=this.clearColor,i=void 0;null!==n&&(ct.copy(t.getClearColor()),i=t.getClearAlpha(),t.setClearColor(n,this.clearAlpha)),t.setRenderTarget(this.renderToScreen?null:e),t.clear(),null!==n&&t.setClearColor(ct,i)}}]),e}();(function(t){a(e,ut);function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.name="DotScreenPass",n.needsSwap=!0,n.material=new B(t),n.quad.material=n.material,n}r(e,[{key:"render",value:function(t,e,n){this.material.uniforms.tDiffuse.value=e.texture,t.render(this.scene,this.camera,this.renderToScreen?null:n)}},{key:"setSize",value:function(t,e){t=Math.max(1,t),e=Math.max(1,e),this.material.uniforms.offsetRepeat.value.z=t,this.material.uniforms.offsetRepeat.value.w=e}}])})(),function(t){a(e,ut);function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.name="FilmPass",n.needsSwap=!0,n.material=new O(t),n.quad.material=n.material,n.scanlineDensity=void 0===t.scanlineDensity?1.25:t.scanlineDensity,n}r(e,[{key:"render",value:function(t,e,n,i){this.material.uniforms.tDiffuse.value=e.texture,this.material.uniforms.time.value+=i,t.render(this.scene,this.camera,this.renderToScreen?null:n)}},{key:"setSize",value:function(t,e){this.material.uniforms.scanlineCount.value=Math.round(e*this.scanlineDensity)}}])}();function vt(t,e){return t+Math.floor(Math.random()*(e-t+1))}function ft(t,e){return t+Math.random()*(e-t)}!function(e){a(n,ut);function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,n);var e=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.name="GlitchPass",e.needsSwap=!0,e.material=new L,e.quad.material=e.material,e.texture=null,e.perturbMap=void 0!==t.perturbMap?t.perturbMap:e.generatePerturbMap(t.dtSize),e.perturbMap.name="Glitch.Perturbation",e.perturbMap.generateMipmaps=!1,e.mode=yt.SPORADIC,e.counter=0,e.breakPoint=vt(120,240),e}r(n,[{key:"generatePerturbMap",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,n=e*e,i=new Float32Array(3*n),r=this.perturbMap,s=void 0,a=void 0;for(s=0;s<n;++s)a=Math.random(),i[3*s]=a,i[3*s+1]=a,i[3*s+2]=a;return null!==r&&r.dispose(),(r=new t.DataTexture(i,e,e,t.RGBFormat,t.FloatType)).needsUpdate=!0,this.perturbMap=r,r}},{key:"render",value:function(t,e,n){var i=this.mode,r=this.counter,s=this.breakPoint,a=this.material.uniforms;a.tDiffuse.value=e.texture,a.seed.value=Math.random(),a.active.value=!0,r%s==0||i===yt.CONSTANT_WILD?(a.amount.value=Math.random()/30,a.angle.value=ft(-Math.PI,Math.PI),a.seedX.value=ft(-1,1),a.seedY.value=ft(-1,1),a.distortionX.value=ft(0,1),a.distortionY.value=ft(0,1),this.breakPoint=vt(120,240),this.counter=0):r%s<s/5||i===yt.CONSTANT_MILD?(a.amount.value=Math.random()/90,a.angle.value=ft(-Math.PI,Math.PI),a.distortionX.value=ft(0,1),a.distortionY.value=ft(0,1),a.seedX.value=ft(-.3,.3),a.seedY.value=ft(-.3,.3)):a.active.value=!1,++this.counter,t.render(this.scene,this.camera,this.renderToScreen?null:n)}},{key:"perturbMap",get:function(){return this.texture},set:function(t){this.texture=t,this.material.uniforms.tPerturb.value=t}}])}();var yt={SPORADIC:0,CONSTANT_MILD:1,CONSTANT_WILD:2},mt=function(t){a(e,ut);function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,null));return s.name="RenderPass",s.clearPass=new dt(r),s.overrideMaterial=void 0!==r.overrideMaterial?r.overrideMaterial:null,s.clearDepth=void 0!==r.clearDepth&&r.clearDepth,s.clear=void 0===r.clear||r.clear,s}return r(e,[{key:"render",value:function(t,e){var n=this.scene,i=this.renderToScreen?null:e;this.clear?this.clearPass.render(t,i):this.clearDepth&&(t.setRenderTarget(i),t.clearDepth()),n.overrideMaterial=this.overrideMaterial,t.render(n,this.camera,i),n.overrideMaterial=null}}]),e}();function gt(t,e,n){return Math.max(e,Math.min(n,t))}!function(e){a(n,ut);function n(e,r,s){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};i(this,n);var u=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return u.name="GodRaysPass",u.needsSwap=!0,u.lightScene=new t.Scene,u.mainScene=e,u.mainCamera=r,u.renderPassLight=new mt(u.lightScene,u.mainCamera),u.renderPassMask=new mt(u.mainScene,u.mainCamera,{overrideMaterial:new t.MeshBasicMaterial({color:0}),clearColor:new t.Color(0)}),u.renderPassMask.clear=!1,u.blurPass=new ht(a),u.renderTargetX=new t.WebGLRenderTarget(1,1,{minFilter:t.LinearFilter,magFilter:t.LinearFilter,stencilBuffer:!1,depthBuffer:!1}),u.renderTargetX.texture.name="GodRays.TargetX",u.renderTargetX.texture.generateMipmaps=!1,u.renderTargetY=u.renderTargetX.clone(),u.renderTargetY.texture.name="GodRays.TargetY",u.renderTargetMask=new t.WebGLRenderTarget(1,1,{minFilter:t.LinearFilter,magFilter:t.LinearFilter}),u.renderTargetMask.texture.name="GodRays.Mask",u.renderTargetMask.texture.generateMipmaps=!1,u.lightSource=s,u.screenPosition=new t.Vector3,u.godRaysMaterial=new G(a),u.godRaysMaterial.uniforms.lightPosition.value=u.screenPosition,u.samples=a.samples,u.combineMaterial=new A(void 0===a.screenMode||a.screenMode),u.intensity=a.intensity,u}r(n,[{key:"render",value:function(t,e,n){var i=this.quad,r=this.scene,s=this.camera,a=this.mainScene,o=this.lightSource,u=this.screenPosition,h=this.godRaysMaterial,l=this.combineMaterial,c=this.renderTargetMask,d=this.renderTargetX,v=this.renderTargetY,f=void 0,y=void 0;u.copy(o.position).project(this.mainCamera),u.x=gt(.5*(u.x+1),0,1),u.y=gt(.5*(u.y+1),0,1),y=o.parent,f=a.background,a.background=null,this.lightScene.add(o),this.renderPassLight.render(t,c),this.renderPassMask.render(t,c),null!==y&&y.add(o),a.background=f,this.blurPass.render(t,c,d),i.material=h,h.uniforms.tDiffuse.value=d.texture,t.render(r,s,v),i.material=l,l.uniforms.texture1.value=e.texture,l.uniforms.texture2.value=v.texture,t.render(r,s,this.renderToScreen?null:n)}},{key:"initialize",value:function(e,n){this.renderPassLight.initialize(e,n),this.renderPassMask.initialize(e,n),this.blurPass.initialize(e,n),n||(this.renderTargetMask.texture.format=t.RGBFormat,this.renderTargetX.texture.format=t.RGBFormat,this.renderTargetY.texture.format=t.RGBFormat)}},{key:"setSize",value:function(t,e){this.renderPassLight.setSize(t,e),this.renderPassMask.setSize(t,e),this.blurPass.setSize(t,e),t=this.blurPass.width,e=this.blurPass.height,this.renderTargetMask.setSize(t,e),this.renderTargetX.setSize(t,e),this.renderTargetY.setSize(t,e)}},{key:"resolutionScale",get:function(){return this.blurPass.resolutionScale},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;this.blurPass.resolutionScale=t}},{key:"kernelSize",get:function(){return this.blurPass.kernelSize},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D.LARGE;this.blurPass.kernelSize=t}},{key:"intensity",get:function(){return this.combineMaterial.uniforms.opacity2.value},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.combineMaterial.uniforms.opacity2.value=t}},{key:"samples",get:function(){return Number.parseInt(this.godRaysMaterial.defines.NUM_SAMPLES_INT)},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60;t=Math.floor(t),this.godRaysMaterial.defines.NUM_SAMPLES_FLOAT=t.toFixed(1),this.godRaysMaterial.defines.NUM_SAMPLES_INT=t.toFixed(0),this.godRaysMaterial.needsUpdate=!0}},{key:"dithering",get:function(){return this.godRaysMaterial.dithering},set:function(t){this.dithering!==t&&(this.godRaysMaterial.dithering=t,this.godRaysMaterial.needsUpdate=!0)}}])}();var pt=function(t){a(e,ut);function e(t,n){i(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,null));return r.name="MaskPass",r.inverse=!1,r.clearStencil=!0,r}return r(e,[{key:"render",value:function(t,e,n){var i=t.context,r=t.state,s=this.scene,a=this.camera,o=this.inverse?0:1,u=1-o;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),r.buffers.stencil.setFunc(i.ALWAYS,o,4294967295),r.buffers.stencil.setClear(u),this.clearStencil&&(t.setRenderTarget(e),t.clearStencil(),t.setRenderTarget(n),t.clearStencil()),t.render(s,a,e),t.render(s,a,n),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.stencil.setFunc(i.EQUAL,1,4294967295),r.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP)}}]),e}(),xt=(function(t){a(e,ut);function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.name="PixelationPass",n.needsSwap=!0,n.pixelationMaterial=new j,n.granularity=t,n.quad.material=n.pixelationMaterial,n}r(e,[{key:"render",value:function(t,e,n){this.pixelationMaterial.uniforms.tDiffuse.value=e.texture,t.render(this.scene,this.camera,this.renderToScreen?null:n)}},{key:"setSize",value:function(t,e){this.pixelationMaterial.setResolution(t,e)}},{key:"granularity",get:function(){return this.pixelationMaterial.granularity},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;(t=Math.floor(t))%2>0&&(t+=1),this.pixelationMaterial.granularity=t}}])}(),function(t){a(e,ut);function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.name="RealisticBokehPass",r.needsSwap=!0,r.bokehMaterial=new K(t,n),r.quad.material=r.bokehMaterial,r}r(e,[{key:"render",value:function(t,e,n){this.bokehMaterial.uniforms.tDiffuse.value=e.texture,this.bokehMaterial.uniforms.tDepth.value=e.depthTexture,t.render(this.scene,this.camera,this.renderToScreen?null:n)}},{key:"setSize",value:function(t,e){this.bokehMaterial.setTexelSize(1/t,1/e)}}])}(),function(e){a(n,ut);function n(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];i(this,n);var s=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return s.name="SavePass",s.material=new b,s.quad.material=s.material,s.renderTarget=void 0!==e?e:new t.WebGLRenderTarget(1,1,{minFilter:t.LinearFilter,magFilter:t.LinearFilter,stencilBuffer:!1,depthBuffer:!1}),s.renderTarget.texture.name="Save.Target",s.renderTarget.texture.generateMipmaps=!1,s.resize=r,s}r(n,[{key:"render",value:function(t,e){this.material.uniforms.tDiffuse.value=e.texture,t.render(this.scene,this.camera,this.renderTarget)}},{key:"initialize",value:function(e,n){n||(this.renderTarget.texture.format=t.RGBFormat)}},{key:"setSize",value:function(t,e){this.resize&&(t=Math.max(1,t),e=Math.max(1,e),this.renderTarget.setSize(t,e))}}])}(),function(t){a(e,ut);function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"tDiffuse";i(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.name="ShaderPass",r.needsSwap=!0,r.material=t,r.quad.material=r.material,r.textureID=n,r}return r(e,[{key:"render",value:function(t,e,n){void 0!==this.material.uniforms[this.textureID]&&(this.material.uniforms[this.textureID].value=e.texture),t.render(this.scene,this.camera,this.renderToScreen?null:n)}}]),e}()),At=.5*Math.PI,wt=new t.Vector3,kt=new t.Vector3,Mt=(function(e){a(n,ut);function n(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t.Vector3,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i(this,n);var a=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return a.name="ShockWavePass",a.needsSwap=!0,a.mainCamera=e,a.epicenter=r,a.screenPosition=new t.Vector3,a.speed=void 0!==s.speed?s.speed:2,a.time=0,a.active=!1,a.shockWaveMaterial=new _(s),a.shockWaveMaterial.uniforms.center.value=a.screenPosition,a.copyMaterial=new b,a}r(n,[{key:"explode",value:function(){this.time=0,this.active=!0}},{key:"render",value:function(t,e,n,i){var r=this.epicenter,s=this.mainCamera,a=this.screenPosition,o=this.shockWaveMaterial,u=o.uniforms,h=u.center,l=u.radius,c=u.maxRadius,d=u.waveSize;this.copyMaterial.uniforms.tDiffuse.value=e.texture,this.quad.material=this.copyMaterial,this.active&&(s.getWorldDirection(wt),kt.copy(s.position).sub(r),wt.angleTo(kt)>At&&(u.cameraDistance.value=s.position.distanceTo(r),a.copy(r).project(s),h.value.x=.5*(a.x+1),h.value.y=.5*(a.y+1),u.tDiffuse.value=e.texture,this.quad.material=o),this.time+=i*this.speed,l.value=this.time-d.value,l.value>=2*(c.value+d.value)&&(this.active=!1)),t.render(this.scene,this.camera,this.renderToScreen?null:n)}},{key:"setSize",value:function(t,e){this.shockWaveMaterial.uniforms.aspect.value=t/e}}])}(),function(e){a(n,ut);function n(e,r){i(this,n);var s=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return s.name="SMAAPass",s.needsSwap=!0,s.renderTargetColorEdges=new t.WebGLRenderTarget(1,1,{minFilter:t.LinearFilter,format:t.RGBFormat,stencilBuffer:!1,depthBuffer:!1}),s.renderTargetColorEdges.texture.name="SMAA.ColorEdges",s.renderTargetColorEdges.texture.generateMipmaps=!1,s.renderTargetWeights=s.renderTargetColorEdges.clone(),s.renderTargetWeights.texture.name="SMAA.Weights",s.renderTargetWeights.texture.format=t.RGBAFormat,s.colorEdgesMaterial=new g,s.weightsMaterial=new rt,s.weightsMaterial.uniforms.tDiffuse.value=s.renderTargetColorEdges.texture,s.searchTexture=new t.Texture(e),s.searchTexture.name="SMAA.Search",s.searchTexture.magFilter=t.NearestFilter,s.searchTexture.minFilter=t.NearestFilter,s.searchTexture.format=t.RGBAFormat,s.searchTexture.generateMipmaps=!1,s.searchTexture.needsUpdate=!0,s.searchTexture.flipY=!1,s.weightsMaterial.uniforms.tSearch.value=s.searchTexture,s.areaTexture=new t.Texture(r),s.areaTexture.name="SMAA.Area",s.areaTexture.minFilter=t.LinearFilter,s.areaTexture.format=t.RGBAFormat,s.areaTexture.generateMipmaps=!1,s.areaTexture.needsUpdate=!0,s.areaTexture.flipY=!1,s.weightsMaterial.uniforms.tArea.value=s.areaTexture,s.blendMaterial=new et,s.blendMaterial.uniforms.tWeights.value=s.renderTargetWeights.texture,s.quad.material=s.blendMaterial,s}r(n,[{key:"render",value:function(t,e,n){this.quad.material=this.colorEdgesMaterial,this.colorEdgesMaterial.uniforms.tDiffuse.value=e.texture,t.render(this.scene,this.camera,this.renderTargetColorEdges,!0),this.quad.material=this.weightsMaterial,t.render(this.scene,this.camera,this.renderTargetWeights,!1),this.quad.material=this.blendMaterial,this.blendMaterial.uniforms.tDiffuse.value=e.texture,t.render(this.scene,this.camera,this.renderToScreen?null:n)}},{key:"setSize",value:function(t,e){this.renderTargetColorEdges.setSize(t,e),this.renderTargetWeights.setSize(t,e),this.colorEdgesMaterial.uniforms.texelSize.value.copy(this.weightsMaterial.uniforms.texelSize.value.copy(this.blendMaterial.uniforms.texelSize.value.set(1/t,1/e)))}}],[{key:"searchImageDataURL",get:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII"}},{key:"areaImageDataURL",get:function(){return"data:image/png;base64,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"}}])}(),function(e){a(n,ut);function n(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;i(this,n);var s=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return s.name="TexturePass",s.copyMaterial=new b,s.copyMaterial.blending=t.AdditiveBlending,s.copyMaterial.transparent=!0,s.texture=e,s.opacity=r,s.quad.material=s.copyMaterial,s}r(n,[{key:"render",value:function(t,e){t.render(this.scene,this.camera,this.renderToScreen?null:e)}},{key:"texture",get:function(){return this.copyMaterial.uniforms.tDiffuse.value},set:function(t){this.copyMaterial.uniforms.tDiffuse.value=t}},{key:"opacity",get:function(){return this.copyMaterial.uniforms.opacity.value},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.copyMaterial.uniforms.opacity.value=t}}])}(),function(e){a(n,ut);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,n);var r=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r.name="ToneMappingPass",r.needsSwap=!0,r.renderTargetLuminosity=new t.WebGLRenderTarget(1,1,{minFilter:t.LinearMipMapLinearFilter,magFilter:t.LinearFilter,format:t.RGBFormat,stencilBuffer:!1,depthBuffer:!1}),r.renderTargetLuminosity.texture.name="ToneMapping.Luminosity",r.renderTargetAdapted=r.renderTargetLuminosity.clone(),r.renderTargetAdapted.texture.name="ToneMapping.AdaptedLuminosity",r.renderTargetAdapted.texture.generateMipmaps=!1,r.renderTargetAdapted.texture.minFilter=t.LinearFilter,r.renderTargetPrevious=r.renderTargetAdapted.clone(),r.renderTargetPrevious.texture.name="ToneMapping.PreviousLuminosity",r.copyMaterial=new b,r.luminosityMaterial=new Y,r.luminosityMaterial.uniforms.distinction.value=void 0!==e.distinction?e.distinction:1,r.adaptiveLuminosityMaterial=new c,r.resolution=e.resolution,r.toneMappingMaterial=new ot,r.adaptive=e.adaptive,r}r(n,[{key:"render",value:function(t,e,n,i){var r=this.quad,s=this.scene,a=this.camera,o=this.adaptiveLuminosityMaterial,u=this.luminosityMaterial,h=this.toneMappingMaterial,l=this.copyMaterial,c=this.renderTargetPrevious,d=this.renderTargetLuminosity,v=this.renderTargetAdapted;this.adaptive&&(r.material=u,u.uniforms.tDiffuse.value=e.texture,t.render(s,a,d),r.material=o,o.uniforms.delta.value=i,o.uniforms.tPreviousLum.value=c.texture,o.uniforms.tCurrentLum.value=d.texture,t.render(s,a,v),r.material=l,l.uniforms.tDiffuse.value=v.texture,t.render(s,a,c)),r.material=h,h.uniforms.tDiffuse.value=e.texture,t.render(this.scene,this.camera,this.renderToScreen?null:n)}},{key:"initialize",value:function(e){this.quad.material=new t.MeshBasicMaterial({color:8388607}),e.render(this.scene,this.camera,this.renderTargetPrevious),this.quad.material.dispose()}},{key:"resolution",get:function(){return this.renderTargetLuminosity.width},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256,e=Math.max(0,Math.ceil(Math.log2(t)));t=Math.pow(2,e),this.renderTargetLuminosity.setSize(t,t),this.renderTargetPrevious.setSize(t,t),this.renderTargetAdapted.setSize(t,t),this.adaptiveLuminosityMaterial.defines.MIP_LEVEL_1X1=e.toFixed(1),this.adaptiveLuminosityMaterial.needsUpdate=!0}},{key:"adaptive",get:function(){return void 0!==this.toneMappingMaterial.defines.ADAPTED_LUMINANCE},set:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?(this.toneMappingMaterial.defines.ADAPTED_LUMINANCE="1",this.toneMappingMaterial.uniforms.luminanceMap.value=this.renderTargetAdapted.texture):(delete this.toneMappingMaterial.defines.ADAPTED_LUMINANCE,this.toneMappingMaterial.uniforms.luminanceMap.value=null),this.toneMappingMaterial.needsUpdate=!0}},{key:"dithering",get:function(){return this.toneMappingMaterial.dithering},set:function(t){this.dithering!==t&&(this.toneMappingMaterial.dithering=t,this.toneMappingMaterial.needsUpdate=!0)}}])}(),function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,e),this.renderer=t,this.readBuffer=null,this.writeBuffer=null,null!==this.renderer&&(this.renderer.autoClear=!1,this.readBuffer=this.createBuffer(void 0===n.depthBuffer||n.depthBuffer,void 0!==n.stencilBuffer&&n.stencilBuffer,void 0!==n.depthTexture&&n.depthTexture),this.writeBuffer=this.readBuffer.clone()),this.copyPass=new xt(new b),this.passes=[]}return r(e,[{key:"replaceRenderer",value:function(t){var e=this.renderer,n=void 0,i=void 0,r=void 0;return null!==e&&e!==t&&(this.renderer=t,this.renderer.autoClear=!1,n=e.domElement.parentNode,i=e.getSize(),r=t.getSize(),null!==n&&(n.removeChild(e.domElement),n.appendChild(t.domElement)),i.width===r.width&&i.height===r.height||this.setSize()),e}},{key:"createBuffer",value:function(e,n,i){var r=this.renderer.getDrawingBufferSize(),s=this.renderer.context.getContextAttributes().alpha,a=new t.WebGLRenderTarget(r.width,r.height,{minFilter:t.LinearFilter,magFilter:t.LinearFilter,format:s?t.RGBAFormat:t.RGBFormat,depthBuffer:e,stencilBuffer:n,depthTexture:i?new t.DepthTexture:null});return i&&n&&(a.depthTexture.format=t.DepthStencilFormat,a.depthTexture.type=t.UnsignedInt248Type),a.texture.name="EffectComposer.Buffer",a.texture.generateMipmaps=!1,a}},{key:"addPass",value:function(t,e){var n=this.renderer,i=n.getDrawingBufferSize();t.setSize(i.width,i.height),t.initialize(n,n.context.getContextAttributes().alpha),void 0!==e?this.passes.splice(e,0,t):this.passes.push(t)}},{key:"removePass",value:function(t){this.passes.splice(this.passes.indexOf(t),1)}},{key:"render",value:function(t){var e=this.passes,n=this.renderer,i=this.copyPass,r=this.readBuffer,s=this.writeBuffer,a=!1,o=void 0,u=void 0,h=void 0,l=void 0,c=void 0;for(l=0,c=e.length;l<c;++l)(o=e[l]).enabled&&(o.render(n,r,s,t,a),o.needsSwap&&(a&&((u=n.context).stencilFunc(u.NOTEQUAL,1,4294967295),i.render(n,r,s),u.stencilFunc(u.EQUAL,1,4294967295)),h=r,r=s,s=h),o instanceof pt?a=!0:o instanceof lt&&(a=!1))}},{key:"setSize",value:function(t,e){var n=this.passes,i=this.renderer,r=void 0,s=void 0,a=void 0,o=void 0;for(void 0!==t&&void 0!==e||(t=(r=i.getSize()).width,e=r.height),i.setSize(t,e),s=i.getDrawingBufferSize(),this.readBuffer.setSize(s.width,s.height),this.writeBuffer.setSize(s.width,s.height),a=0,o=n.length;a<o;++a)n[a].setSize(s.width,s.height)}},{key:"reset",value:function(t){var e=this.readBuffer.depthBuffer,n=this.readBuffer.stencilBuffer,i=null!==this.readBuffer.depthTexture;this.dispose(void 0===t?this.createBuffer(e,n,i):t)}},{key:"dispose",value:function(t){var e=this.passes;for(null!==this.readBuffer&&null!==this.writeBuffer&&(this.readBuffer.dispose(),this.writeBuffer.dispose(),this.readBuffer=null,this.writeBuffer=null);e.length>0;)e.pop().dispose();void 0!==t?(this.readBuffer=t,this.writeBuffer=this.readBuffer.clone()):this.copyPass.dispose()}},{key:"depthTexture",get:function(){return this.readBuffer.depthTexture},set:function(t){this.readBuffer.depthTexture=t,this.writeBuffer.depthTexture=t}}]),e}());var zt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;i(this,t),this.width=e,this.height=n,this.data=r,this.channels=s}return r(t,[{key:"toCanvas",value:function(){return"undefined"==typeof document?null:function(t,e,n,i){var r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),s=r.getContext("2d"),a=s.createImageData(t,e),o=a.data,u=void 0,h=void 0,l=void 0,c=void 0;for(h=0;h<e;++h)for(u=0;u<t;++u)c=(h*t+u)*i,o[l=4*(h*t+u)]=i>0?n[c]:0,o[l+1]=i>1?n[c+1]:0,o[l+2]=i>2?n[c+2]:0,o[l+3]=i>3?n[c+3]:255;return r.width=t,r.height=e,s.putImageData(a,0,0),r}(this.width,this.height,this.data,this.channels)}}]),t}(),Dt=new t.Box2,Ct=new t.Box2,St=30,bt=32,Et=new Float32Array([0,-.25,.25,-.125,.125,-.375,.375]),Pt=[new Float32Array([0,0]),new Float32Array([.25,-.25]),new Float32Array([-.25,.25]),new Float32Array([.125,-.125]),new Float32Array([-.125,.125])],Bt=[new Uint8Array([0,0]),new Uint8Array([3,0]),new Uint8Array([0,3]),new Uint8Array([3,3]),new Uint8Array([1,0]),new Uint8Array([4,0]),new Uint8Array([1,3]),new Uint8Array([4,3]),new Uint8Array([0,1]),new Uint8Array([3,1]),new Uint8Array([0,4]),new Uint8Array([3,4]),new Uint8Array([1,1]),new Uint8Array([4,1]),new Uint8Array([1,4]),new Uint8Array([4,4])],It=[new Uint8Array([0,0]),new Uint8Array([1,0]),new Uint8Array([0,2]),new Uint8Array([1,2]),new Uint8Array([2,0]),new Uint8Array([3,0]),new Uint8Array([2,2]),new Uint8Array([3,2]),new Uint8Array([0,1]),new Uint8Array([1,1]),new Uint8Array([0,3]),new Uint8Array([1,3]),new Uint8Array([2,1]),new Uint8Array([3,1]),new Uint8Array([2,3]),new Uint8Array([3,3])];function Tt(t,e,n){return t+(e-t)*n}function Ot(t,e){var n,i=e.min,r=e.max,s=.5*Math.sqrt(2*i.x),a=.5*Math.sqrt(2*i.y),o=.5*Math.sqrt(2*r.x),u=.5*Math.sqrt(2*r.y),h=(n=t/bt,Math.min(Math.max(n,0),1));return i.set(Tt(s,i.x,h),Tt(a,i.y,h)),r.set(Tt(o,r.x,h),Tt(u,r.y,h)),e}function Ut(t,e,n,i){var r=e.x-t.x,s=e.y-t.y,a=n,o=n+1,u=t.y+s*(a-t.x)/r,h=t.y+s*(o-t.x)/r,l=void 0,c=void 0,d=void 0,v=void 0;return a>=t.x&&a<e.x||o>t.x&&o<=e.x?Math.sign(u)===Math.sign(h)||Math.abs(u)<1e-4||Math.abs(h)<1e-4?(l=(u+h)/2)<0?i.set(Math.abs(l),0):i.set(0,Math.abs(l)):(c=(v=-t.y*r/s+t.x)>t.x?u*(v-Math.trunc(v))/2:0,d=v<e.x?h*(1-(v-Math.trunc(v)))/2:0,(l=Math.abs(c)>Math.abs(d)?c:-d)<0?i.set(Math.abs(c),Math.abs(d)):i.set(Math.abs(d),Math.abs(c))):i.set(0,0),i}function Ft(t,e,n,i,r){var s=Dt.min,a=Dt.max,o=Ct.min,u=Ct.max,h=Ct,l=.5+i,c=.5+i-1,d=e+n+1;switch(t){case 0:r.set(0,0);break;case 1:e<=n?Ut(s.set(0,c),a.set(d/2,0),e,r):r.set(0,0);break;case 2:e>=n?Ut(s.set(d/2,0),a.set(d,c),e,r):r.set(0,0);break;case 3:Ut(s.set(0,c),a.set(d/2,0),e,o),Ut(s.set(d/2,0),a.set(d,c),e,u),Ot(d,h),r.addVectors(o,u);break;case 4:e<=n?Ut(s.set(0,l),a.set(d/2,0),e,r):r.set(0,0);break;case 5:r.set(0,0);break;case 6:Math.abs(i)>0?(Ut(s.set(0,l),a.set(d,c),e,o),Ut(s.set(0,l),a.set(d/2,0),e,u),u.add(Ut(s.set(d/2,0),a.set(d,c),e,r)),r.addVectors(o,u).divideScalar(2)):Ut(s.set(0,l),a.set(d,c),e,r);break;case 7:Ut(s.set(0,l),a.set(d,c),e,r);break;case 8:e>=n?Ut(s.set(d/2,0),a.set(d,l),e,r):r.set(0,0);break;case 9:Math.abs(i)>0?(Ut(s.set(0,c),a.set(d,l),e,o),Ut(s.set(0,c),a.set(d/2,0),e,u),u.add(Ut(s.set(d/2,0),a.set(d,l),e,r)),r.addVectors(o,u).divideScalar(2)):Ut(s.set(0,c),a.set(d,l),e,r);break;case 10:r.set(0,0);break;case 11:Ut(s.set(0,c),a.set(d,l),e,r);break;case 12:Ut(s.set(0,l),a.set(d/2,0),e,o),Ut(s.set(d/2,0),a.set(d,l),e,u),Ot(d,h),r.addVectors(o,u);break;case 13:Ut(s.set(0,c),a.set(d,l),e,r);break;case 14:Ut(s.set(0,l),a.set(d,c),e,r);break;case 15:r.set(0,0)}return r}function Lt(t,e,n,i){var r=t.equals(e),s=void 0,a=void 0;return r||(s=(t.x+e.x)/2,a=(t.y+e.y)/2,r=(e.y-t.y)*(n-s)+(t.x-e.x)*(i-a)>0),r}function Rt(t,e,n,i){var r=void 0,s=void 0,a=void 0;for(r=0,a=0;a<St;++a)for(s=0;s<St;++s)Lt(t,e,n+s/(St-1),i+a/(St-1))&&++r;return r/(St*St)}function Vt(t,e,n,i,r,s){var a=It[t],o=a[0],u=a[1];return o>0&&(e.x+=r[0],e.y+=r[1]),u>0&&(n.x+=r[0],n.y+=r[1]),s.set(1-Rt(e,n,1+i,0+i),Rt(e,n,1+i,1+i))}function Gt(t,e,n,i,r){var s=Dt.min,a=Dt.max,o=Ct.min,u=Ct.max,h=e+n+1;switch(t){case 0:Vt(t,s.set(1,1),a.set(1+h,1+h),e,i,o),Vt(t,s.set(1,0),a.set(1+h,0+h),e,i,u),r.addVectors(o,u).divideScalar(2);break;case 1:Vt(t,s.set(1,0),a.set(0+h,0+h),e,i,o),Vt(t,s.set(1,0),a.set(1+h,0+h),e,i,u),r.addVectors(o,u).divideScalar(2);break;case 2:Vt(t,s.set(0,0),a.set(1+h,0+h),e,i,o),Vt(t,s.set(1,0),a.set(1+h,0+h),e,i,u),r.addVectors(o,u).divideScalar(2);break;case 3:Vt(t,s.set(1,0),a.set(1+h,0+h),e,i,r);break;case 4:Vt(t,s.set(1,1),a.set(0+h,0+h),e,i,o),Vt(t,s.set(1,1),a.set(1+h,0+h),e,i,u),r.addVectors(o,u).divideScalar(2);break;case 5:Vt(t,s.set(1,1),a.set(0+h,0+h),e,i,o),Vt(t,s.set(1,0),a.set(1+h,0+h),e,i,u),r.addVectors(o,u).divideScalar(2);break;case 6:Vt(t,s.set(1,1),a.set(1+h,0+h),e,i,r);break;case 7:Vt(t,s.set(1,1),a.set(1+h,0+h),e,i,o),Vt(t,s.set(1,0),a.set(1+h,0+h),e,i,u),r.addVectors(o,u).divideScalar(2);break;case 8:Vt(t,s.set(0,0),a.set(1+h,1+h),e,i,o),Vt(t,s.set(1,0),a.set(1+h,1+h),e,i,u),r.addVectors(o,u).divideScalar(2);break;case 9:Vt(t,s.set(1,0),a.set(1+h,1+h),e,i,r);break;case 10:Vt(t,s.set(0,0),a.set(1+h,1+h),e,i,o),Vt(t,s.set(1,0),a.set(1+h,0+h),e,i,u),r.addVectors(o,u).divideScalar(2);break;case 11:Vt(t,s.set(1,0),a.set(1+h,1+h),e,i,o),Vt(t,s.set(1,0),a.set(1+h,0+h),e,i,u),r.addVectors(o,u).divideScalar(2);break;case 12:Vt(t,s.set(1,1),a.set(1+h,1+h),e,i,r);break;case 13:Vt(t,s.set(1,1),a.set(1+h,1+h),e,i,o),Vt(t,s.set(1,0),a.set(1+h,1+h),e,i,u),r.addVectors(o,u).divideScalar(2);break;case 14:Vt(t,s.set(1,1),a.set(1+h,1+h),e,i,o),Vt(t,s.set(1,1),a.set(1+h,0+h),e,i,u),r.addVectors(o,u).divideScalar(2);break;case 15:Vt(t,s.set(1,1),a.set(1+h,1+h),e,i,o),Vt(t,s.set(1,0),a.set(1+h,0+h),e,i,u),r.addVectors(o,u).divideScalar(2)}return r}function Qt(e,n,i){var r=new t.Vector2,s=void 0,a=void 0,o=void 0,u=void 0,h=void 0,l=void 0,c=void 0,d=void 0;for(s=0,a=e.length;s<a;++s)for(c=(l=e[s]).data,d=l.width,u=0;u<d;++u)for(o=0;o<d;++o)i?Ft(s,o,u,n,r):Gt(s,o,u,n,r),c[h=2*(u*d+o)]=255*r.x,c[h+1]=255*r.y}function Nt(e,n,i,r,s,a){var o=new t.Vector2,u=a.data,h=a.width,l=void 0,c=void 0,d=void 0,v=void 0,f=void 0,y=void 0,m=void 0,g=void 0,p=void 0,x=void 0;for(l=0,c=n.length;l<c;++l)for(m=i[l],p=(g=n[l]).data,x=g.width,v=0;v<r;++v)for(d=0;d<r;++d)o.fromArray(m).multiplyScalar(r),o.add(e),o.x+=d,o.y+=v,f=2*(o.y*h+o.x),y=s?2*(v*v*x+d*d):2*(v*x+d),u[f]=p[y],u[f+1]=p[y+1]}!function(){function e(){i(this,e)}r(e,null,[{key:"generate",value:function(){var e=5*Et.length*16,n=new Uint8ClampedArray(160*e*2),i=new zt(160,e,n,2),r=Math.pow(15,2)+1,s=[],a=[],o=new t.Vector2,u=void 0,h=void 0;for(u=0;u<16;++u)s.push(new zt(r,r,new Uint8ClampedArray(r*r*2),2)),a.push(new zt(20,20,new Uint8ClampedArray(800),2));for(u=0,h=Et.length;u<h;++u)Qt(s,Et[u],!0),o.set(0,80*u),Nt(o,s,Bt,16,!0,i);for(u=0,h=Pt.length;u<h;++u)Qt(a,Pt[u],!1),o.set(80,80*u),Nt(o,a,It,20,!1,i);return i}}])}();var Yt=new Map([[qt([0,0,0,0]),[0,0,0,0]],[qt([0,0,0,1]),[0,0,0,1]],[qt([0,0,1,0]),[0,0,1,0]],[qt([0,0,1,1]),[0,0,1,1]],[qt([0,1,0,0]),[0,1,0,0]],[qt([0,1,0,1]),[0,1,0,1]],[qt([0,1,1,0]),[0,1,1,0]],[qt([0,1,1,1]),[0,1,1,1]],[qt([1,0,0,0]),[1,0,0,0]],[qt([1,0,0,1]),[1,0,0,1]],[qt([1,0,1,0]),[1,0,1,0]],[qt([1,0,1,1]),[1,0,1,1]],[qt([1,1,0,0]),[1,1,0,0]],[qt([1,1,0,1]),[1,1,0,1]],[qt([1,1,1,0]),[1,1,1,0]],[qt([1,1,1,1]),[1,1,1,1]]]);function Ht(t,e,n){return t+(e-t)*n}function qt(t){return Ht(Ht(t[0],t[1],.75),Ht(t[2],t[3],.75),.875)}function jt(t,e){var n=0;return 1===e[3]&&(n+=1),1===n&&1===e[2]&&1!==t[1]&&1!==t[3]&&(n+=1),n}function Xt(t,e){var n=0;return 1===e[3]&&1!==t[1]&&1!==t[3]&&(n+=1),1===n&&1===e[2]&&1!==t[0]&&1!==t[2]&&(n+=1),n}!function(){function t(){i(this,t)}r(t,null,[{key:"generate",value:function(){var t=new Uint8ClampedArray(2178),e=new Uint8ClampedArray(1024),n=void 0,i=void 0,r=void 0,s=void 0,a=void 0,o=void 0,u=void 0;for(i=0;i<33;++i)for(n=0;n<66;++n)r=.03125*n,s=.03125*i,Yt.has(r)&&Yt.has(s)&&(o=Yt.get(r),u=Yt.get(s),t[66*i+n]=127*jt(o,u),t[66*i+n+33]=127*Xt(o,u));for(a=0,i=17;i<33;++i)for(n=0;n<64;++n,++a)e[a]=t[66*i+n];return new zt(64,16,e,1)}}])}();var Wt=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"demo";i(this,e),this.id=n,this.composer=null,this.loadingManager=new t.LoadingManager,this.assets=new Map,this.renderPass=new mt(new t.Scene,null),this.renderPass.renderToScreen=!0,this.controls=null,this.ready=!1}return r(e,[{key:"setComposer",value:function(t){return this.composer=t,this}},{key:"load",value:function(){return Promise.resolve()}},{key:"initialize",value:function(){}},{key:"update",value:function(t){}},{key:"registerOptions",value:function(t){}},{key:"reset",value:function(){var e=this.scene.fog,n=new mt(new t.Scene,null);return n.enabled=this.renderPass.enabled,n.renderToScreen=!0,this.renderPass=n,this.scene.fog=e,null!==this.controls&&(this.controls.dispose(),this.controls=null),this.ready=!1,this}},{key:"scene",get:function(){return this.renderPass.scene},set:function(t){this.renderPass.scene=t}},{key:"camera",get:function(){return this.renderPass.camera},set:function(t){this.renderPass.camera=t}}]),e}(),Kt=function t(e){i(this,t),this.type=e,this.target=null},Jt=function(){function t(){i(this,t),this.listenerFunctions=new Map,this.listenerObjects=new Map}return r(t,[{key:"addEventListener",value:function(t,e){var n="function"==typeof e?this.listenerFunctions:this.listenerObjects;n.has(t)?n.get(t).add(e):n.set(t,new Set([e]))}},{key:"removeEventListener",value:function(t,e){var n="function"==typeof e?this.listenerFunctions:this.listenerObjects,i=void 0;n.has(t)&&((i=n.get(t)).delete(e),0===i.size&&n.delete(t))}},{key:"dispatchEvent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,n=e.listenerFunctions,i=e.listenerObjects,r=void 0;if(t.target=e,n.has(t.type)){r=n.get(t.type);var s=!0,a=!1,o=void 0;try{for(var u,h=r[Symbol.iterator]();!(s=(u=h.next()).done);s=!0)u.value.call(e,t)}catch(t){a=!0,o=t}finally{try{!s&&h.return&&h.return()}finally{if(a)throw o}}}if(i.has(t.type)){r=i.get(t.type);var l=!0,c=!1,d=void 0;try{for(var v,f=r[Symbol.iterator]();!(l=(v=f.next()).done);l=!0)v.value.handleEvent(t)}catch(t){c=!0,d=t}finally{try{!l&&f.return&&f.return()}finally{if(c)throw d}}}}}]),t}(),Zt=new Kt("change"),_t=new Kt("load"),$t=window.location.hash.slice(1),te=function(s){a(u,Jt);function u(r){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,u);var a=void 0!==s.aside?s.aside:r,h=o(this,(u.__proto__||Object.getPrototypeOf(u)).call(this));return h.composer=void 0!==s.composer?s.composer:function(){var e=new t.WebGLRenderer;return e.setSize(r.clientWidth,r.clientHeight),e.setPixelRatio(window.devicePixelRatio),new Mt(e)}(),h.renderer=h.composer.renderer,r.appendChild(h.renderer.domElement),h.clock=new t.Clock,h.menu=new e.GUI({autoPlace:!1}),a.appendChild(h.menu.domElement),h.statistics=new n,h.statistics.dom.id="statistics",a.appendChild(h.statistics.domElement),h.demos=new Map,h.demo=null,h.currentDemo=null,h}return r(u,[{key:"resetMenu",value:function(){var t=this,n=this.menu.domElement.parentNode,i=new e.GUI({autoPlace:!1});if(this.demos.size>1){i.add(this,"demo",Array.from(this.demos.keys())).onChange(function(){return t.loadDemo()})}return n.removeChild(this.menu.domElement),n.appendChild(i.domElement),this.menu.destroy(),this.menu=i,i}},{key:"startDemo",value:function(t){t.id===this.demo&&(t.initialize(),t.registerOptions(this.resetMenu()),t.ready=!0,this.dispatchEvent(_t))}},{key:"loadDemo",value:function(){var t=this,e=this.demo,n=this.demos.get(e),i=this.currentDemo,r=this.composer,s=this.renderer,a=void 0;window.location.hash=e,null!==i&&(i.reset(),a=r.renderer.getSize(),s.setSize(a.width,a.height),r.replaceRenderer(s)),this.menu.domElement.style.display="none",s.clear(),r.reset(),r.addPass(n.renderPass),this.currentDemo=n,this.dispatchEvent(Zt),n.load().then(function(){return t.startDemo(n)}).catch(function(t){return console.error(t)})}},{key:"addDemo",value:function(t){var e=this.currentDemo;return this.demos.set(t.id,t.setComposer(this.composer)),null!==this.demo&&t.id!==$t||(this.demo=t.id,this.loadDemo()),this.resetMenu(),null!==e&&e.ready&&e.registerOptions(this.menu),this}},{key:"removeDemo",value:function(t){var e=this.demos,n=void 0;return e.has(t)&&(e.delete(t),this.demo===t&&e.size>0?(n=e.entries().next().value,this.demo=n[0],this.currentDemo=n[1],this.loadDemo()):(this.demo=null,this.currentDemo=null,this.renderer.clear(),this.composer.reset())),this}},{key:"setSize",value:function(t,e){var n=this.currentDemo;this.composer.setSize(t,e),null!==n&&null!==n.camera&&(n.camera.aspect=t/e,n.camera.updateProjectionMatrix())}},{key:"render",value:function(t){var e=this.currentDemo,n=this.clock.getDelta();null!==e&&e.ready&&(this.statistics.begin(),e.update(n),this.composer.render(n),this.statistics.end())}}]),u}(),ee={MOVE_FORWARD:0,MOVE_LEFT:1,MOVE_BACKWARD:2,MOVE_RIGHT:3,MOVE_DOWN:4,MOVE_UP:5,ZOOM_OUT:6,ZOOM_IN:7},ne=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;i(this,t),this.x=e,this.y=n,this.z=r}return r(t,[{key:"set",value:function(t,e,n){return this.x=t,this.y=e,this.z=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}},{key:"setFromSpherical",value:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this}},{key:"setFromCylindrical",value:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this}},{key:"setFromMatrixColumn",value:function(t,e){return this.fromArray(t.elements,4*e)}},{key:"setFromMatrixPosition",value:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}},{key:"setFromMatrixScale",value:function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this.z/=t,this}},{key:"crossVectors",value:function(t,e){var n=t.x,i=t.y,r=t.z,s=e.x,a=e.y,o=e.z;return this.x=i*o-r*a,this.y=r*s-n*o,this.z=n*a-i*s,this}},{key:"cross",value:function(t){return this.crossVectors(this,t)}},{key:"transformDirection",value:function(t){var e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()}},{key:"applyMatrix3",value:function(t){var e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this}},{key:"applyMatrix4",value:function(t){var e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i+r[12],this.y=r[1]*e+r[5]*n+r[9]*i+r[13],this.z=r[2]*e+r[6]*n+r[10]*i+r[14],this}},{key:"applyQuaternion",value:function(t){var e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,a=t.z,o=t.w,u=o*e+s*i-a*n,h=o*n+a*e-r*i,l=o*i+r*n-s*e,c=-r*e-s*n-a*i;return this.x=u*o+c*-r+h*-a-l*-s,this.y=h*o+c*-s+l*-r-u*-a,this.z=l*o+c*-a+u*-s-h*-r,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"reflect",value:function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t;var n=e.x,i=e.y,r=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(n,i,r),this}},{key:"angleTo",value:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSquared()*t.lengthSquared());return Math.acos(Math.min(Math.max(e,-1),1))}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}},{key:"lerpVectors",value:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}}]),t}(),ie=new ne,re=[new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne],se=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne(1/0,1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ne(-1/0,-1/0,-1/0);i(this,t),this.min=e,this.max=n}return r(t,[{key:"set",value:function(t,e){return this.min.copy(t),this.max.copy(e),this}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new oe;return this.getCenter(t.center),t.radius=.5*this.getSize(ie).length(),t}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"setFromPoints",value:function(t){var e=void 0,n=void 0;for(this.min.set(0,0,0),this.max.set(0,0,0),e=0,n=t.length;e<n;++e)this.expandByPoint(t[e]);return this}},{key:"setFromCenterAndSize",value:function(t,e){var n=ie.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}},{key:"clampPoint",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ne).copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return ie.copy(t).clamp(this.min,this.max).sub(t).length()}},{key:"applyMatrix4",value:function(t){var e=this.min,n=this.max;return this.isEmpty()||(re[0].set(e.x,e.y,e.z).applyMatrix4(t),re[1].set(e.x,e.y,n.z).applyMatrix4(t),re[2].set(e.x,n.y,e.z).applyMatrix4(t),re[3].set(e.x,n.y,n.z).applyMatrix4(t),re[4].set(n.x,e.y,e.z).applyMatrix4(t),re[5].set(n.x,e.y,n.z).applyMatrix4(t),re[6].set(n.x,n.y,e.z).applyMatrix4(t),re[7].set(n.x,n.y,n.z).applyMatrix4(t),this.setFromPoints(re)),this}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"containsPoint",value:function(t){var e=this.min,n=this.max;return t.x>=e.x&&t.y>=e.y&&t.z>=e.z&&t.x<=n.x&&t.y<=n.y&&t.z<=n.z}},{key:"containsBox",value:function(t){var e=this.min,n=this.max,i=t.min,r=t.max;return e.x<=i.x&&r.x<=n.x&&e.y<=i.y&&r.y<=n.y&&e.z<=i.z&&r.z<=n.z}},{key:"intersectsBox",value:function(t){var e=this.min,n=this.max,i=t.min,r=t.max;return r.x>=e.x&&r.y>=e.y&&r.z>=e.z&&i.x<=n.x&&i.y<=n.y&&i.z<=n.z}},{key:"intersectsSphere",value:function(t){return this.clampPoint(t.center,ie).distanceToSquared(t.center)<=t.radius*t.radius}},{key:"intersectsPlane",value:function(t){var e=void 0,n=void 0;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=t.constant&&n>=t.constant}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}]),t}(),ae=new se,oe=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;i(this,t),this.center=e,this.radius=n}return r(t,[{key:"set",value:function(t,e){return this.center.copy(t),this.radius=e,this}},{key:"copy",value:function(t){return this.center.copy(t.center),this.radius=t.radius,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromPoints",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ae.setFromPoints(t).getCenter(this.center),n=0,i=void 0,r=void 0;for(i=0,r=t.length;i<r;++i)n=Math.max(n,e.distanceToSquared(t[i]));return this.radius=Math.sqrt(n),this}},{key:"getBoundingBox",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new se;return t.set(this.center,this.center),t.expandByScalar(this.radius),t}},{key:"isEmpty",value:function(){return this.radius<=0}},{key:"translate",value:function(t){return this.center.add(t),this}},{key:"clampPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ne,n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}},{key:"distanceToPoint",value:function(t){return t.distanceTo(this.center)-this.radius}},{key:"containsPoint",value:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"intersectsSphere",value:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}},{key:"intersectsBox",value:function(t){return t.intersectsSphere(this)}},{key:"intersectsPlane",value:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}},{key:"equals",value:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}]),t}(),ue=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;i(this,t),this.x=e,this.y=n}return r(t,[{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this}},{key:"applyMatrix3",value:function(t){var e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"angle",value:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}},{key:"lerpVectors",value:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)}},{key:"rotateAround",value:function(t,e){var n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*n-s*i+t.x,this.y=r*i+s*n+t.y,this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y}},{key:"width",get:function(){return this.x},set:function(t){return this.x=t}},{key:"height",get:function(){return this.y},set:function(t){return this.y=t}}]),t}(),he=new ue,le=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ue(1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ue(-1/0,-1/0);i(this,t),this.min=e,this.max=n}r(t,[{key:"set",value:function(t,e){return this.min.copy(t),this.max.copy(e),this}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ue;return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ue;return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new oe;return this.getCenter(t.center),t.radius=.5*this.getSize(he).length(),t}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"setFromPoints",value:function(t){var e=void 0,n=void 0;for(this.min.set(0,0),this.max.set(0,0),e=0,n=t.length;e<n;++e)this.expandByPoint(t[e]);return this}},{key:"setFromCenterAndSize",value:function(t,e){var n=he.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}},{key:"clampPoint",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ue).copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return he.copy(t).clamp(this.min,this.max).sub(t).length()}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"containsPoint",value:function(t){var e=this.min,n=this.max;return t.x>=e.x&&t.y>=e.y&&t.x<=n.x&&t.y<=n.y}},{key:"containsBox",value:function(t){var e=this.min,n=this.max,i=t.min,r=t.max;return e.x<=i.x&&r.x<=n.x&&e.y<=i.y&&r.y<=n.y}},{key:"intersectsBox",value:function(t){var e=this.min,n=this.max,i=t.min,r=t.max;return r.x>=e.x&&r.y>=e.y&&i.x<=n.x&&i.y<=n.y}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}])}(),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;i(this,t),this.radius=e,this.theta=n,this.y=r}r(t,[{key:"set",value:function(t,e,n){return this.radius=t,this.theta=e,this.y=n,this}},{key:"copy",value:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromVector3",value:function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this}}])}(),function(){function t(){i(this,t),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return r(t,[{key:"set",value:function(t,e,n,i,r,s,a,o,u){var h=this.elements;return h[0]=t,h[3]=e,h[6]=n,h[1]=i,h[4]=r,h[7]=s,h[2]=a,h[5]=o,h[8]=u,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(t){var e=t.elements,n=this.elements;return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,i=void 0;for(i=0;i<9;++i)n[i]=t[i+e];return this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,i=void 0;for(i=0;i<9;++i)t[i+e]=n[i];return t}},{key:"multiplyMatrices",value:function(t,e){var n=t.elements,i=e.elements,r=this.elements,s=n[0],a=n[3],o=n[6],u=n[1],h=n[4],l=n[7],c=n[2],d=n[5],v=n[8],f=i[0],y=i[3],m=i[6],g=i[1],p=i[4],x=i[7],A=i[2],w=i[5],k=i[8];return r[0]=s*f+a*g+o*A,r[3]=s*y+a*p+o*w,r[6]=s*m+a*x+o*k,r[1]=u*f+h*g+l*A,r[4]=u*y+h*p+l*w,r[7]=u*m+h*x+l*k,r[2]=c*f+d*g+v*A,r[5]=c*y+d*p+v*w,r[8]=c*m+d*x+v*k,this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyScalar",value:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],u=t[7],h=t[8];return e*s*h-e*a*u-n*r*h+n*a*o+i*r*u-i*s*o}},{key:"getInverse",value:function(t){var e=t.elements,n=this.elements,i=e[0],r=e[1],s=e[2],a=e[3],o=e[4],u=e[5],h=e[6],l=e[7],c=e[8],d=c*o-u*l,v=u*h-c*a,f=l*a-o*h,y=i*d+r*v+s*f,m=void 0;return 0!==y?(m=1/y,n[0]=d*m,n[1]=(s*l-c*r)*m,n[2]=(u*r-s*o)*m,n[3]=v*m,n[4]=(c*i-s*h)*m,n[5]=(s*a-u*i)*m,n[6]=f*m,n[7]=(r*h-l*i)*m,n[8]=(o*i-r*a)*m):(console.error("Can't invert matrix, determinant is zero",t),this.identity()),this}},{key:"transpose",value:function(){var t=this.elements,e=void 0;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"scale",value:function(t,e){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}},{key:"rotate",value:function(t){var e=Math.cos(t),n=Math.sin(t),i=this.elements,r=i[0],s=i[3],a=i[6],o=i[1],u=i[4],h=i[7];return i[0]=e*r+n*o,i[3]=e*s+n*u,i[6]=e*a+n*h,i[1]=-n*r+e*o,i[4]=-n*s+e*u,i[7]=-n*a+e*h,this}},{key:"translate",value:function(t,e){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}},{key:"equals",value:function(t){var e=this.elements,n=t.elements,i=!0,r=void 0;for(r=0;i&&r<9;++r)e[r]!==n[r]&&(i=!1);return i}}]),t}()),ce=0,de=1,ve=2,fe=3,ye=4,me=5,ge=new ne,pe=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;i(this,t),this.x=e,this.y=n,this.z=r,this.w=s}return r(t,[{key:"set",value:function(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}},{key:"setFromEuler",value:function(t){var e=t.x,n=t.y,i=t.z,r=Math.cos,s=Math.sin,a=r(e/2),o=r(n/2),u=r(i/2),h=s(e/2),l=s(n/2),c=s(i/2);switch(t.order){case ce:this.x=h*o*u+a*l*c,this.y=a*l*u-h*o*c,this.z=a*o*c+h*l*u,this.w=a*o*u-h*l*c;break;case ye:this.x=h*o*u+a*l*c,this.y=a*l*u-h*o*c,this.z=a*o*c-h*l*u,this.w=a*o*u+h*l*c;break;case ve:this.x=h*o*u-a*l*c,this.y=a*l*u+h*o*c,this.z=a*o*c+h*l*u,this.w=a*o*u-h*l*c;break;case me:this.x=h*o*u-a*l*c,this.y=a*l*u+h*o*c,this.z=a*o*c-h*l*u,this.w=a*o*u+h*l*c;break;case de:this.x=h*o*u+a*l*c,this.y=a*l*u+h*o*c,this.z=a*o*c-h*l*u,this.w=a*o*u-h*l*c;break;case fe:this.x=h*o*u-a*l*c,this.y=a*l*u-h*o*c,this.z=a*o*c+h*l*u,this.w=a*o*u+h*l*c}return this}},{key:"setFromAxisAngle",value:function(t,e){var n=e/2,i=Math.sin(n);return this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this.w=Math.cos(n),this}},{key:"setFromRotationMatrix",value:function(t){var e=t.elements,n=e[0],i=e[4],r=e[8],s=e[1],a=e[5],o=e[9],u=e[2],h=e[6],l=e[10],c=n+a+l,d=void 0;return c>0?(d=.5/Math.sqrt(c+1),this.w=.25/d,this.x=(h-o)*d,this.y=(r-u)*d,this.z=(s-i)*d):n>a&&n>l?(d=2*Math.sqrt(1+n-a-l),this.w=(h-o)/d,this.x=.25*d,this.y=(i+s)/d,this.z=(r+u)/d):a>l?(d=2*Math.sqrt(1+a-n-l),this.w=(r-u)/d,this.x=(i+s)/d,this.y=.25*d,this.z=(o+h)/d):(d=2*Math.sqrt(1+l-n-a),this.w=(s-i)/d,this.x=(r+u)/d,this.y=(o+h)/d,this.z=.25*d),this}},{key:"setFromUnitVectors",value:function(t,e){var n=t.dot(e)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?ge.set(-t.y,t.x,0):ge.set(0,-t.z,t.y)):ge.crossVectors(t,e),this.x=ge.x,this.y=ge.y,this.z=ge.z,this.w=n,this.normalize()}},{key:"invert",value:function(){return this.conjugate().normalize()}},{key:"conjugate",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"normalize",value:function(){var t=this.length(),e=void 0;return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/t,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"multiplyQuaternions",value:function(t,e){var n=t.x,i=t.y,r=t.z,s=t.w,a=e.x,o=e.y,u=e.z,h=e.w;return this.x=n*h+s*a+i*u-r*o,this.y=i*h+s*o+r*a-n*u,this.z=r*h+s*u+n*o-i*a,this.w=s*h-n*a-i*o-r*u,this}},{key:"multiply",value:function(t){return this.multiplyQuaternions(this,t)}},{key:"premultiply",value:function(t){return this.multiplyQuaternions(t,this)}},{key:"slerp",value:function(t,e){var n=this.x,i=this.y,r=this.z,s=this.w,a=void 0,o=void 0,u=void 0,h=void 0,l=void 0;if(1===e)this.copy(t);else if(e>0){if((a=s*t.w+n*t.x+i*t.y+r*t.z)<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,a=-a):this.copy(t),a>=1)return this.w=s,this.x=n,this.y=i,this.z=r,this;if(o=Math.sqrt(1-a*a),Math.abs(o)<.001)return this.w=.5*(s+this.w),this.x=.5*(n+this.x),this.y=.5*(i+this.y),this.z=.5*(r+this.z),this;u=Math.atan2(o,a),h=Math.sin((1-e)*u)/o,l=Math.sin(e*u)/o,this.w=s*h+this.w*l,this.x=n*h+this.x*l,this.y=i*h+this.y*l,this.z=r*h+this.z*l}return this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}}],[{key:"slerp",value:function(t,e,n,i){return n.copy(t).slerp(e,i)}},{key:"slerpFlat",value:function(t,e,n,i,r,s,a){var o=r[s],u=r[s+1],h=r[s+2],l=r[s+3],c=n[i],d=n[i+1],v=n[i+2],f=n[i+3],y=void 0,m=void 0,g=void 0,p=void 0,x=void 0,A=void 0,w=void 0,k=void 0;f===l&&c===o&&d===u&&v===h||(y=1-a,A=(p=c*o+d*u+v*h+f*l)>=0?1:-1,(x=1-p*p)>Number.EPSILON&&(g=Math.sqrt(x),w=Math.atan2(g,p*A),y=Math.sin(y*w)/g,a=Math.sin(a*w)/g),c=c*y+o*(k=a*A),d=d*y+u*k,v=v*y+h*k,f=f*y+l*k,y===1-a&&(c*=m=1/Math.sqrt(c*c+d*d+v*v+f*f),d*=m,v*=m,f*=m)),t[e]=c,t[e+1]=d,t[e+2]=v,t[e+3]=f}}]),t}();function xe(t,e,n){return Math.max(Math.min(t,n),e)}var Ae=new le,we=new pe,ke=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;i(this,t),this.x=e,this.y=n,this.z=r,this.order=t.defaultOrder}return r(t,[{key:"set",value:function(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.order=i,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.order=t[e+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.order,t}},{key:"toVector3",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne).set(this.x,this.y,this.z)}},{key:"setFromRotationMatrix",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.order,n=t.elements,i=n[0],r=n[4],s=n[8],a=n[1],o=n[5],u=n[9],h=n[2],l=n[6],c=n[10];switch(e){case ce:this.y=Math.asin(xe(s,-1,1)),Math.abs(s)<.99999?(this.x=Math.atan2(-u,c),this.z=Math.atan2(-r,i)):(this.x=Math.atan2(l,o),this.z=0);break;case ye:this.x=Math.asin(-xe(u,-1,1)),Math.abs(u)<.99999?(this.y=Math.atan2(s,c),this.z=Math.atan2(a,o)):(this.y=Math.atan2(-h,i),this.z=0);break;case ve:this.x=Math.asin(xe(l,-1,1)),Math.abs(l)<.99999?(this.y=Math.atan2(-h,c),this.z=Math.atan2(-r,o)):(this.y=0,this.z=Math.atan2(a,i));break;case me:this.y=Math.asin(-xe(h,-1,1)),Math.abs(h)<.99999?(this.x=Math.atan2(l,c),this.z=Math.atan2(a,i)):(this.x=0,this.z=Math.atan2(-r,o));break;case de:this.z=Math.asin(xe(a,-1,1)),Math.abs(a)<.99999?(this.x=Math.atan2(-u,o),this.y=Math.atan2(-h,i)):(this.x=0,this.y=Math.atan2(s,c));break;case fe:this.z=Math.asin(-xe(r,-1,1)),Math.abs(r)<.99999?(this.x=Math.atan2(l,o),this.y=Math.atan2(s,i)):(this.x=Math.atan2(-u,c),this.y=0)}return this.order=e,this}},{key:"setFromQuaternion",value:function(t,e){return Ae.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ae,e)}},{key:"setFromVector3",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(t.x,t.y,t.z,e)}},{key:"reorder",value:function(t){return we.setFromEuler(this),this.setFromQuaternion(we,t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order}}],[{key:"defaultOrder",get:function(){return ce}}]),t}(),Me=new ne,ze=new ne,De=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne(1,0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;i(this,t),this.normal=e,this.constant=n}return r(t,[{key:"set",value:function(t,e){return this.normal.copy(t),this.constant=e,this}},{key:"setComponents",value:function(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}},{key:"copy",value:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromNormalAndCoplanarPoint",value:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(t,e,n){var i=Me.subVectors(n,e).cross(ze.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,Me),this}},{key:"normalize",value:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}},{key:"negate",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:"distanceToPoint",value:function(t){return this.normal.dot(t)+this.constant}},{key:"distanceToSphere",value:function(t){return this.distanceToPoint(t.center)-t.radius}},{key:"projectPoint",value:function(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}},{key:"coplanarPoint",value:function(t){return t.copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(t){return this.constant-=t.dot(this.normal),this}},{key:"intersectLine",value:function(t,e){var n=t.delta(Me),i=this.normal.dot(n);if(0===i)0===this.distanceToPoint(t.start)&&e.copy(t.start);else{var r=-(t.start.dot(this.normal)+this.constant)/i;r>=0&&r<=1&&e.copy(n).multiplyScalar(r).add(t.start)}return e}},{key:"intersectsLine",value:function(t){var e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}},{key:"intersectsBox",value:function(t){return t.intersectsPlane(this)}},{key:"intersectsSphere",value:function(t){return t.intersectsPlane(this)}},{key:"equals",value:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}]),t}(),Ce=new ne,Se=new ne,be=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new De,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new De,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new De,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new De,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new De,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new De;i(this,t),this.planes=[e,n,r,s,a,o]}return r(t,[{key:"set",value:function(t,e,n,i,r,s){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(s),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){var e=this.planes,n=void 0;for(n=0;n<6;++n)e[n].copy(t.planes[n]);return this}},{key:"setFromMatrix",value:function(t){var e=this.planes,n=t.elements,i=n[0],r=n[1],s=n[2],a=n[3],o=n[4],u=n[5],h=n[6],l=n[7],c=n[8],d=n[9],v=n[10],f=n[11],y=n[12],m=n[13],g=n[14],p=n[15];return e[0].setComponents(a-i,l-o,f-c,p-y).normalize(),e[1].setComponents(a+i,l+o,f+c,p+y).normalize(),e[2].setComponents(a+r,l+u,f+d,p+m).normalize(),e[3].setComponents(a-r,l-u,f-d,p-m).normalize(),e[4].setComponents(a-s,l-h,f-v,p-g).normalize(),e[5].setComponents(a+s,l+h,f+v,p+g).normalize(),this}},{key:"intersectsSphere",value:function(t){var e=this.planes,n=t.center,i=-t.radius,r=!0,s=void 0;for(s=0;s<6;++s)if(e[s].distanceToPoint(n)<i){r=!1;break}return r}},{key:"intersectsBox",value:function(t){var e=this.planes,n=t.min,i=t.max,r=!0,s=void 0,a=void 0,o=void 0,u=void 0;for(s=0;s<6;++s)if(u=e[s],Ce.x=u.normal.x>0?n.x:i.x,Se.x=u.normal.x>0?i.x:n.x,Ce.y=u.normal.y>0?n.y:i.y,Se.y=u.normal.y>0?i.y:n.y,Ce.z=u.normal.z>0?n.z:i.z,Se.z=u.normal.z>0?i.z:n.z,a=u.distanceToPoint(Ce),o=u.distanceToPoint(Se),a<0&&o<0){r=!1;break}return r}},{key:"containsPoint",value:function(t){var e=this.planes,n=!0,i=void 0;for(i=0;i<6;++i)if(e[i].distanceToPoint(t)<0){n=!1;break}return n}}]),t}(),Ee=new ne,Pe=new ne,Be=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ne;i(this,t),this.start=e,this.end=n}return r(t,[{key:"set",value:function(t,e){return this.start.copy(t),this.end.copy(e),this}},{key:"copy",value:function(t){return this.start.copy(t.start),this.end.copy(t.end),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne).addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne).subVectors(this.end,this.start)}},{key:"lengthSquared",value:function(){return this.start.distanceToSquared(this.end)}},{key:"length",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}},{key:"closestPointToPointParameter",value:function(t,e){Ee.subVectors(t,this.start),Pe.subVectors(this.end,this.start);var n=Pe.dot(Pe),i=Pe.dot(Ee);return e?Math.min(Math.max(i/n,0),1):i/n}},{key:"closestPointToPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ne,i=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(i).add(this.start)}},{key:"equals",value:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}]),t}(),Ie=new ne,Te=new ne,Oe=new ne,Ue=function(){function t(){i(this,t),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return r(t,[{key:"set",value:function(t,e,n,i,r,s,a,o,u,h,l,c,d,v,f,y){var m=this.elements;return m[0]=t,m[4]=e,m[8]=n,m[12]=i,m[1]=r,m[5]=s,m[9]=a,m[13]=o,m[2]=u,m[6]=h,m[10]=l,m[14]=c,m[3]=d,m[7]=v,m[11]=f,m[15]=y,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"copy",value:function(t){var e=t.elements,n=this.elements;return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,i=void 0;for(i=0;i<16;++i)n[i]=t[i+e];return this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,i=void 0;for(i=0;i<16;++i)t[i+e]=n[i];return t}},{key:"getMaxScaleOnAxis",value:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}},{key:"copyPosition",value:function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}},{key:"setPosition",value:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this}},{key:"extractBasis",value:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(t){var e=this.elements,n=t.elements,i=1/Ie.setFromMatrixColumn(t,0).length(),r=1/Ie.setFromMatrixColumn(t,1).length(),s=1/Ie.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,this}},{key:"makeRotationFromEuler",value:function(t){var e=this.elements,n=t.x,i=t.y,r=t.z,s=Math.cos(n),a=Math.sin(n),o=Math.cos(i),u=Math.sin(i),h=Math.cos(r),l=Math.sin(r),c=void 0,d=void 0,v=void 0,f=void 0,y=void 0,m=void 0,g=void 0,p=void 0,x=void 0,A=void 0,w=void 0,k=void 0;switch(t.order){case ce:c=s*h,d=s*l,v=a*h,f=a*l,e[0]=o*h,e[4]=-o*l,e[8]=u,e[1]=d+v*u,e[5]=c-f*u,e[9]=-a*o,e[2]=f-c*u,e[6]=v+d*u,e[10]=s*o;break;case ye:y=o*h,m=o*l,g=u*h,p=u*l,e[0]=y+p*a,e[4]=g*a-m,e[8]=s*u,e[1]=s*l,e[5]=s*h,e[9]=-a,e[2]=m*a-g,e[6]=p+y*a,e[10]=s*o;break;case ve:y=o*h,m=o*l,g=u*h,p=u*l,e[0]=y-p*a,e[4]=-s*l,e[8]=g+m*a,e[1]=m+g*a,e[5]=s*h,e[9]=p-y*a,e[2]=-s*u,e[6]=a,e[10]=s*o;break;case me:c=s*h,d=s*l,v=a*h,f=a*l,e[0]=o*h,e[4]=v*u-d,e[8]=c*u+f,e[1]=o*l,e[5]=f*u+c,e[9]=d*u-v,e[2]=-u,e[6]=a*o,e[10]=s*o;break;case de:x=s*o,A=s*u,w=a*o,k=a*u,e[0]=o*h,e[4]=k-x*l,e[8]=w*l+A,e[1]=l,e[5]=s*h,e[9]=-a*h,e[2]=-u*h,e[6]=A*l+w,e[10]=x-k*l;break;case fe:x=s*o,A=s*u,w=a*o,k=a*u,e[0]=o*h,e[4]=-l,e[8]=u*h,e[1]=x*l+k,e[5]=s*h,e[9]=A*l-w,e[2]=w*l-A,e[6]=a*h,e[10]=k*l+x}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(t){var e=this.elements,n=t.x,i=t.y,r=t.z,s=t.w,a=n+n,o=i+i,u=r+r,h=n*a,l=n*o,c=n*u,d=i*o,v=i*u,f=r*u,y=s*a,m=s*o,g=s*u;return e[0]=1-(d+f),e[4]=l-g,e[8]=c+m,e[1]=l+g,e[5]=1-(h+f),e[9]=v-y,e[2]=c-m,e[6]=v+y,e[10]=1-(h+d),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"lookAt",value:function(t,e,n){var i=this.elements,r=Ie,s=Te,a=Oe;return a.subVectors(t,e),0===a.lengthSquared()&&(a.z=1),a.normalize(),r.crossVectors(n,a),0===r.lengthSquared()&&(1===Math.abs(n.z)?a.x+=1e-4:a.z+=1e-4,a.normalize(),r.crossVectors(n,a)),r.normalize(),s.crossVectors(a,r),i[0]=r.x,i[4]=s.x,i[8]=a.x,i[1]=r.y,i[5]=s.y,i[9]=a.y,i[2]=r.z,i[6]=s.z,i[10]=a.z,this}},{key:"multiplyMatrices",value:function(t,e){var n=this.elements,i=t.elements,r=e.elements,s=i[0],a=i[4],o=i[8],u=i[12],h=i[1],l=i[5],c=i[9],d=i[13],v=i[2],f=i[6],y=i[10],m=i[14],g=i[3],p=i[7],x=i[11],A=i[15],w=r[0],k=r[4],M=r[8],z=r[12],D=r[1],C=r[5],S=r[9],b=r[13],E=r[2],P=r[6],B=r[10],I=r[14],T=r[3],O=r[7],U=r[11],F=r[15];return n[0]=s*w+a*D+o*E+u*T,n[4]=s*k+a*C+o*P+u*O,n[8]=s*M+a*S+o*B+u*U,n[12]=s*z+a*b+o*I+u*F,n[1]=h*w+l*D+c*E+d*T,n[5]=h*k+l*C+c*P+d*O,n[9]=h*M+l*S+c*B+d*U,n[13]=h*z+l*b+c*I+d*F,n[2]=v*w+f*D+y*E+m*T,n[6]=v*k+f*C+y*P+m*O,n[10]=v*M+f*S+y*B+m*U,n[14]=v*z+f*b+y*I+m*F,n[3]=g*w+p*D+x*E+A*T,n[7]=g*k+p*C+x*P+A*O,n[11]=g*M+p*S+x*B+A*U,n[15]=g*z+p*b+x*I+A*F,this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyScalar",value:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],s=t[1],a=t[5],o=t[9],u=t[13],h=t[2],l=t[6],c=t[10],d=t[14],v=e*a,f=e*o,y=e*u,m=n*s,g=n*o,p=n*u,x=i*s,A=i*a,w=i*u,k=r*s,M=r*a,z=r*o;return t[3]*(z*l-w*l-M*c+p*c+A*d-g*d)+t[7]*(f*d-y*c+k*c-x*d+w*h-z*h)+t[11]*(y*l-v*d-k*l+m*d+M*h-p*h)+t[15]*(-A*h-f*l+v*c+x*l-m*c+g*h)}},{key:"getInverse",value:function(t){var e=this.elements,n=t.elements,i=n[0],r=n[1],s=n[2],a=n[3],o=n[4],u=n[5],h=n[6],l=n[7],c=n[8],d=n[9],v=n[10],f=n[11],y=n[12],m=n[13],g=n[14],p=n[15],x=d*g*l-m*v*l+m*h*f-u*g*f-d*h*p+u*v*p,A=y*v*l-c*g*l-y*h*f+o*g*f+c*h*p-o*v*p,w=c*m*l-y*d*l+y*u*f-o*m*f-c*u*p+o*d*p,k=y*d*h-c*m*h-y*u*v+o*m*v+c*u*g-o*d*g,M=i*x+r*A+s*w+a*k,z=void 0;return 0!==M?(z=1/M,e[0]=x*z,e[1]=(m*v*a-d*g*a-m*s*f+r*g*f+d*s*p-r*v*p)*z,e[2]=(u*g*a-m*h*a+m*s*l-r*g*l-u*s*p+r*h*p)*z,e[3]=(d*h*a-u*v*a-d*s*l+r*v*l+u*s*f-r*h*f)*z,e[4]=A*z,e[5]=(c*g*a-y*v*a+y*s*f-i*g*f-c*s*p+i*v*p)*z,e[6]=(y*h*a-o*g*a-y*s*l+i*g*l+o*s*p-i*h*p)*z,e[7]=(o*v*a-c*h*a+c*s*l-i*v*l-o*s*f+i*h*f)*z,e[8]=w*z,e[9]=(y*d*a-c*m*a-y*r*f+i*m*f+c*r*p-i*d*p)*z,e[10]=(o*m*a-y*u*a+y*r*l-i*m*l-o*r*p+i*u*p)*z,e[11]=(c*u*a-o*d*a-c*r*l+i*d*l+o*r*f-i*u*f)*z,e[12]=k*z,e[13]=(c*m*s-y*d*s+y*r*v-i*m*v-c*r*g+i*d*g)*z,e[14]=(y*u*s-o*m*s-y*r*h+i*m*h+o*r*g-i*u*g)*z,e[15]=(o*d*s-c*u*s+c*r*h-i*d*h-o*r*v+i*u*v)*z):(console.error("Can't invert matrix, determinant is zero",t),this.identity()),this}},{key:"transpose",value:function(){var t=this.elements,e=void 0;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"scale",value:function(t,e,n){var i=this.elements;return i[0]*=t,i[4]*=e,i[8]*=n,i[1]*=t,i[5]*=e,i[9]*=n,i[2]*=t,i[6]*=e,i[10]*=n,i[3]*=t,i[7]*=e,i[11]*=n,this}},{key:"makeScale",value:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeTranslation",value:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}},{key:"makeRotationY",value:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(t,e){var n=Math.cos(e),i=Math.sin(e),r=1-n,s=t.x,a=t.y,o=t.z,u=r*s,h=r*a;return this.set(u*s+n,u*a-i*o,u*o+i*a,0,u*a+i*o,h*a+n,h*o-i*s,0,u*o-i*a,h*o+i*s,r*o*o+n,0,0,0,0,1),this}},{key:"makeShear",value:function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this}},{key:"compose",value:function(t,e,n){return this.makeRotationFromQuaternion(e),this.scale(n.x,n.y,n.z),this.setPosition(t),this}},{key:"decompose",value:function(t,e,n){var i=this.elements,r=i[0],s=i[1],a=i[2],o=i[4],u=i[5],h=i[6],l=i[8],c=i[9],d=i[10],v=this.determinant(),f=Ie.set(r,s,a).length()*(v<0?-1:1),y=Ie.set(o,u,h).length(),m=Ie.set(l,c,d).length(),g=1/f,p=1/y,x=1/m;return t.x=i[12],t.y=i[13],t.z=i[14],i[0]*=g,i[1]*=g,i[2]*=g,i[4]*=p,i[5]*=p,i[6]*=p,i[8]*=x,i[9]*=x,i[10]*=x,e.setFromRotationMatrix(this),i[0]=r,i[1]=s,i[2]=a,i[4]=o,i[5]=u,i[6]=h,i[8]=l,i[9]=c,i[10]=d,n.x=f,n.y=y,n.z=m,this}},{key:"makePerspective",value:function(t,e,n,i,r,s){var a=this.elements,o=2*r/(e-t),u=2*r/(n-i),h=(e+t)/(e-t),l=(n+i)/(n-i),c=-(s+r)/(s-r),d=-2*s*r/(s-r);return a[0]=o,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=u,a[9]=l,a[13]=0,a[2]=0,a[6]=0,a[10]=c,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}},{key:"makeOrthographic",value:function(t,e,n,i,r,s){var a=this.elements,o=1/(e-t),u=1/(n-i),h=1/(s-r),l=(e+t)*o,c=(n+i)*u,d=(s+r)*h;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-l,a[1]=0,a[5]=2*u,a[9]=0,a[13]=-c,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}},{key:"equals",value:function(t){var e=this.elements,n=t.elements,i=!0,r=void 0;for(r=0;i&&r<16;++r)e[r]!==n[r]&&(i=!1);return i}}]),t}(),Fe=[new ne,new ne,new ne,new ne],Le=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ne;i(this,t),this.origin=e,this.direction=n}return r(t,[{key:"set",value:function(t,e){return this.origin.copy(t),this.direction.copy(e),this}},{key:"copy",value:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"at",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ne).copy(this.direction).multiplyScalar(t).add(this.origin)}},{key:"lookAt",value:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this}},{key:"recast",value:function(t){return this.origin.copy(this.at(t,Fe[0])),this}},{key:"closestPointToPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ne,n=e.subVectors(t,this.origin).dot(this.direction);return n>=0?e.copy(this.direction).multiplyScalar(n).add(this.origin):e.copy(this.origin)}},{key:"distanceSquaredToPoint",value:function(t){var e=Fe[0].subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):Fe[0].copy(this.direction).multiplyScalar(e).add(this.origin).distanceToSquared(t)}},{key:"distanceToPoint",value:function(t){return Math.sqrt(this.distanceSquaredToPoint(t))}},{key:"distanceToPlane",value:function(t){var e=t.normal.dot(this.direction),n=0!==e?-(this.origin.dot(t.normal)+t.constant)/e:0===t.distanceToPoint(this.origin)?0:-1;return n>=0?n:null}},{key:"distanceSquaredToSegment",value:function(t,e,n,i){var r=Fe[0].copy(t).add(e).multiplyScalar(.5),s=Fe[1].copy(e).sub(t).normalize(),a=Fe[2].copy(this.origin).sub(r),o=.5*t.distanceTo(e),u=-this.direction.dot(s),h=a.dot(this.direction),l=-a.dot(s),c=a.lengthSq(),d=Math.abs(1-u*u),v=void 0,f=void 0,y=void 0,m=void 0,g=void 0;return d>0?(f=u*h-l,y=o*d,(v=u*l-h)>=0?f>=-y?f<=y?g=(v*=m=1/d)*(v+u*(f*=m)+2*h)+f*(u*v+f+2*l)+c:(f=o,g=-(v=Math.max(0,-(u*f+h)))*v+f*(f+2*l)+c):(f=-o,g=-(v=Math.max(0,-(u*f+h)))*v+f*(f+2*l)+c):f<=-y?g=-(v=Math.max(0,-(-u*o+h)))*v+(f=v>0?-o:Math.min(Math.max(-o,-l),o))*(f+2*l)+c:f<=y?(v=0,g=(f=Math.min(Math.max(-o,-l),o))*(f+2*l)+c):g=-(v=Math.max(0,-(u*o+h)))*v+(f=v>0?o:Math.min(Math.max(-o,-l),o))*(f+2*l)+c):(f=u>0?-o:o,g=-(v=Math.max(0,-(u*f+h)))*v+f*(f+2*l)+c),void 0!==n&&n.copy(this.direction).multiplyScalar(v).add(this.origin),void 0!==i&&i.copy(s).multiplyScalar(f).add(r),g}},{key:"intersectSphere",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ne,n=Fe[0].subVectors(t.center,this.origin),i=n.dot(this.direction),r=n.dot(n)-i*i,s=t.radius*t.radius,a=null,o=void 0,u=void 0,h=void 0;return r<=s&&(h=i+(o=Math.sqrt(s-r)),((u=i-o)>=0||h>=0)&&(a=u<0?this.at(h,e):this.at(u,e))),a}},{key:"intersectsSphere",value:function(t){return this.distanceToPoint(t.center)<=t.radius}},{key:"intersectPlane",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ne,n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}},{key:"intersectsPlane",value:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}},{key:"intersectBox",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ne,n=this.origin,i=this.direction,r=t.min,s=t.max,a=1/i.x,o=1/i.y,u=1/i.z,h=null,l=void 0,c=void 0,d=void 0,v=void 0,f=void 0,y=void 0;return a>=0?(l=(r.x-n.x)*a,c=(s.x-n.x)*a):(l=(s.x-n.x)*a,c=(r.x-n.x)*a),o>=0?(d=(r.y-n.y)*o,v=(s.y-n.y)*o):(d=(s.y-n.y)*o,v=(r.y-n.y)*o),l<=v&&d<=c&&((d>l||l!=l)&&(l=d),(v<c||c!=c)&&(c=v),u>=0?(f=(r.z-n.z)*u,y=(s.z-n.z)*u):(f=(s.z-n.z)*u,y=(r.z-n.z)*u),l<=y&&f<=c&&((f>l||l!=l)&&(l=f),(y<c||c!=c)&&(c=y),c>=0&&(h=this.at(l>=0?l:c,e)))),h}},{key:"intersectsBox",value:function(t){return null!==this.intersectBox(t,Fe[0])}},{key:"intersectTriangle",value:function(t,e,n,i,r){var s=this.direction,a=Fe[0],o=Fe[1],u=Fe[2],h=Fe[3],l=null,c=void 0,d=void 0,v=void 0,f=void 0,y=void 0;return o.subVectors(e,t),u.subVectors(n,t),h.crossVectors(o,u),0===(c=s.dot(h))||i&&c>0||(c>0?d=1:(d=-1,c=-c),a.subVectors(this.origin,t),(v=d*s.dot(u.crossVectors(a,u)))>=0&&(f=d*s.dot(o.cross(a)))>=0&&v+f<=c&&(y=-d*a.dot(h))>=0&&(l=this.at(y/c,r))),l}},{key:"applyMatrix4",value:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}},{key:"equals",value:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}]),t}(),Re=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;i(this,t),this.radius=e,this.phi=n,this.theta=r}return r(t,[{key:"set",value:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}},{key:"copy",value:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromVector3",value:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(Math.min(Math.max(t.y/this.radius,-1),1))),this.makeSafe()}},{key:"makeSafe",value:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}}]),t}(),Ve=function(){function t(){i(this,t),this.elements=new Float32Array([1,0,0,1,0,1])}return r(t,[{key:"set",value:function(t,e,n,i,r,s){var a=this.elements;return a[0]=t,a[1]=e,a[3]=i,a[2]=n,a[4]=r,a[5]=s,this}},{key:"identity",value:function(){return this.set(1,0,0,1,0,1),this}},{key:"copy",value:function(t){var e=t.elements;return this.set(e[0],e[1],e[2],e[3],e[4],e[5]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toMatrix3",value:function(t){var e=t.elements;t.set(e[0],e[1],e[2],e[1],e[3],e[4],e[2],e[4],e[5])}},{key:"add",value:function(t){var e=this.elements,n=t.elements;return e[0]+=n[0],e[1]+=n[1],e[3]+=n[3],e[2]+=n[2],e[4]+=n[4],e[5]+=n[5],this}},{key:"norm",value:function(){var t=this.elements,e=t[1]*t[1],n=t[2]*t[2],i=t[4]*t[4];return Math.sqrt(t[0]*t[0]+e+n+e+t[3]*t[3]+i+n+i+t[5]*t[5])}},{key:"off",value:function(){var t=this.elements;return Math.sqrt(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:"applyToVector3",value:function(t){var e=t.x,n=t.y,i=t.z,r=this.elements;return t.x=r[0]*e+r[1]*n+r[2]*i,t.y=r[1]*e+r[3]*n+r[4]*i,t.z=r[2]*e+r[4]*n+r[5]*i,t}},{key:"equals",value:function(t){var e=this.elements,n=t.elements,i=!0,r=void 0;for(r=0;i&&r<6;++r)e[r]!==n[r]&&(i=!1);return i}}],[{key:"calculateIndex",value:function(t,e){return 3-(3-t)*(2-t)/2+e}}]),t}(),Ge=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;i(this,t),this.x=e,this.y=n,this.z=r,this.w=s}return r(t,[{key:"set",value:function(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}},{key:"setAxisAngleFromQuaternion",value:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}},{key:"setAxisAngleFromRotationMatrix",value:function(t){var e=t.elements,n=e[0],i=e[4],r=e[8],s=e[1],a=e[5],o=e[9],u=e[2],h=e[6],l=e[10],c=void 0,d=void 0,v=void 0,f=void 0,y=void 0,m=void 0,g=void 0,p=void 0,x=void 0,A=void 0,w=void 0;return Math.abs(i-s)<.01&&Math.abs(r-u)<.01&&Math.abs(o-h)<.01?Math.abs(i+s)<.1&&Math.abs(r+u)<.1&&Math.abs(o+h)<.1&&Math.abs(n+a+l-3)<.1?this.set(1,0,0,0):(c=Math.PI,g=(l+1)/2,p=(i+s)/4,x=(r+u)/4,A=(o+h)/4,(y=(n+1)/2)>(m=(a+1)/2)&&y>g?y<.01?(d=0,v=.707106781,f=.707106781):(v=p/(d=Math.sqrt(y)),f=x/d):m>g?m<.01?(d=.707106781,v=0,f=.707106781):(d=p/(v=Math.sqrt(m)),f=A/v):g<.01?(d=.707106781,v=.707106781,f=0):(d=x/(f=Math.sqrt(g)),v=A/f),this.set(d,v,f,c)):(w=Math.sqrt((h-o)*(h-o)+(r-u)*(r-u)+(s-i)*(s-i)),Math.abs(w)<.001&&(w=1),this.x=(h-o)/w,this.y=(r-u)/w,this.z=(s-i)/w,this.w=Math.acos((n+a+l-1)/2)),this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this.w=t.w*e.w,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this}},{key:"applyMatrix4",value:function(t){var e=this.x,n=this.y,i=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*e+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*e+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*e+s[7]*n+s[11]*i+s[15]*r,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)+Math.abs(this.w-t.w)}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,n=this.y-t.y,i=this.z-t.z,r=this.w-t.w;return e*e+n*n+i*i+r*r}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}},{key:"lerpVectors",value:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}}]),t}(),Qe=0,Ne=1,Ye=2,He=2*Math.PI,qe=new ne,je=new Ue,Xe=function(){function t(e,n,r,s){i(this,t),this.position=e,this.quaternion=n,this.target=r,this.settings=s,this.spherical=new Re}return r(t,[{key:"setPosition",value:function(t){return this.position=t,this}},{key:"setQuaternion",value:function(t){return this.quaternion=t,this}},{key:"setTarget",value:function(t){return this.target=t,this}},{key:"updateQuaternion",value:function(){var t=this.settings,e=t.rotation;return t.general.orbit?je.lookAt(qe.subVectors(this.position,this.target),e.pivotOffset,e.up):je.lookAt(qe.set(0,0,0),this.target.setFromSpherical(this.spherical),e.up),this.quaternion.setFromRotationMatrix(je),this}},{key:"adjustSpherical",value:function(t,e){var n=this.settings,i=n.general.orbit,r=n.rotation,s=this.spherical;return s.theta=r.invertX?s.theta+t:s.theta-t,s.phi=!i&&!r.invertY||i&&r.invertY?s.phi+e:s.phi-e,s.theta=Math.min(Math.max(s.theta,r.minAzimuthalAngle),r.maxAzimuthalAngle),s.phi=Math.min(Math.max(s.phi,r.minPolarAngle),r.maxPolarAngle),s.theta%=He,s.makeSafe(),i&&this.position.setFromSpherical(s).add(this.target),this}},{key:"zoom",value:function(t){var e=this.settings,n=e.general,i=e.sensitivity,r=e.zoom,s=this.spherical,a=void 0,o=void 0,u=void 0;return n.orbit&&r.enabled&&(a=t*i.zoom,r.invert&&(a=-a),o=Math.max(r.minDistance,1e-6),u=Math.min(r.maxDistance,1/0),s.radius=Math.min(Math.max(s.radius+a,o),u),this.position.setFromSpherical(s).add(this.target)),this}},{key:"update",value:function(t){}},{key:"lookAt",value:function(t){var e=this.spherical,n=this.position,i=this.target;return i.copy(t),this.settings.general.orbit?qe.subVectors(n,i):qe.subVectors(i,n).normalize(),e.setFromVector3(qe),e.radius=Math.max(e.radius,1e-6),this.updateQuaternion(),this}},{key:"getViewDirection",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne;return t.setFromSpherical(this.spherical).normalize(),this.settings.general.orbit&&t.negate(),t}}]),t}(),We=function(){function t(){i(this,t),this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.up=!1,this.down=!1}return r(t,[{key:"reset",value:function(){return this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.up=!1,this.down=!1,this}}]),t}(),Ke=new ne(1,0,0),Je=new ne(0,1,0),Ze=new ne(0,0,1),_e=new ne,$e=function(){function t(e,n,r,s){i(this,t),this.position=e,this.quaternion=n,this.target=r,this.settings=s,this.movementState=new We}return r(t,[{key:"setPosition",value:function(t){return this.position=t,this}},{key:"setQuaternion",value:function(t){return this.quaternion=t,this}},{key:"setTarget",value:function(t){return this.target=t,this}},{key:"translateOnAxis",value:function(t,e){_e.copy(t).applyQuaternion(this.quaternion).multiplyScalar(e),this.position.add(_e),this.settings.general.orbit&&this.target.add(_e)}},{key:"translate",value:function(t){var e=this.settings.sensitivity,n=this.movementState,i=t*e.translation;n.backward?this.translateOnAxis(Ze,i):n.forward&&this.translateOnAxis(Ze,-i),n.right?this.translateOnAxis(Ke,i):n.left&&this.translateOnAxis(Ke,-i),n.up?this.translateOnAxis(Je,i):n.down&&this.translateOnAxis(Je,-i)}},{key:"update",value:function(t){this.settings.translation.enabled&&this.translate(t)}},{key:"moveTo",value:function(t){return this.settings.general.orbit?this.target.copy(t):this.position.copy(t),this}}]),t}(),tn=new Proxy({BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,META_LEFT:91,META_RIGHT:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222},{get:function(t,e){return e in t?t[e]:1===e.length?e.toUpperCase().charCodeAt(0):void 0}}),en=function(){function t(){i(this,t),this.orbit=!0}return r(t,[{key:"copy",value:function(t){return this.orbit=t.orbit,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),nn=function(){function t(){i(this,t),this.defaultActions=new Map,this.actions=new Map}return r(t,[{key:"reset",value:function(){return this.actions=new Map(this.defaultActions),this}},{key:"setDefault",value:function(t){return this.defaultActions=t,this.reset()}},{key:"copy",value:function(t){return this.defaultActions=new Map(t.defaultActions),this.actions=new Map(t.actions),this}},{key:"clearDefault",value:function(){return this.defaultActions.clear(),this}},{key:"clear",value:function(){return this.actions.clear(),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"has",value:function(t){return this.actions.has(t)}},{key:"get",value:function(t){return this.actions.get(t)}},{key:"set",value:function(t,e){return this.actions.set(t,e),this}},{key:"delete",value:function(t){return this.actions.delete(t)}},{key:"toJSON",value:function(){return{defaultActions:[].concat(u(this.defaultActions)),actions:[].concat(u(this.actions))}}}]),t}(),rn=function(){function t(){i(this,t),this.hold=!1,this.lock=!0}return r(t,[{key:"copy",value:function(t){return this.hold=t.hold,this.lock=t.lock,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),sn=function(){function t(){i(this,t),this.up=new ne,this.up.copy(Je),this.pivotOffset=new ne,this.minAzimuthalAngle=-1/0,this.maxAzimuthalAngle=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.invertX=!1,this.invertY=!1}return r(t,[{key:"copy",value:function(t){return this.up.copy(t.up),this.pivotOffset.copy(t.pivotOffset),this.minAzimuthalAngle=null!==t.minAzimuthalAngle?t.minAzimuthalAngle:-1/0,this.maxAzimuthalAngle=null!==t.maxAzimuthalAngle?t.maxAzimuthalAngle:1/0,this.minPolarAngle=t.minPolarAngle,this.maxPolarAngle=t.maxPolarAngle,this.invertX=t.invertX,this.invertY=t.invertY,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),an=function(){function t(){i(this,t),this.rotation=.0025,this.translation=1,this.zoom=.1}return r(t,[{key:"copy",value:function(t){return this.rotation=t.rotation,this.translation=t.translation,this.zoom=t.zoom,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),on=function(){function t(){i(this,t),this.enabled=!0}return r(t,[{key:"copy",value:function(t){return this.enabled=t.enabled,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),un=function(){function t(){i(this,t),this.enabled=!0,this.invert=!1,this.minDistance=1e-6,this.maxDistance=1/0}return r(t,[{key:"copy",value:function(t){return this.enabled=t.enabled,this.invert=t.invert,this.minDistance=t.minDistance,this.maxDistance=t.maxDistance,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),hn=function(){function t(){i(this,t),this.general=new en,this.keyBindings=new nn,this.keyBindings.setDefault(new Map([[tn.W,ee.MOVE_FORWARD],[tn.UP,ee.MOVE_FORWARD],[tn.A,ee.MOVE_LEFT],[tn.LEFT,ee.MOVE_LEFT],[tn.S,ee.MOVE_BACKWARD],[tn.DOWN,ee.MOVE_BACKWARD],[tn.D,ee.MOVE_RIGHT],[tn.RIGHT,ee.MOVE_RIGHT],[tn.X,ee.MOVE_DOWN],[tn.SPACE,ee.MOVE_UP],[tn.PAGE_DOWN,ee.ZOOM_OUT],[tn.PAGE_UP,ee.ZOOM_IN]])),this.pointer=new rn,this.rotation=new sn,this.sensitivity=new an,this.translation=new on,this.zoom=new un}return r(t,[{key:"copy",value:function(t){return this.general.copy(t.general),this.keyBindings.copy(t.keyBindings),this.pointer.copy(t.pointer),this.rotation.copy(t.rotation),this.sensitivity.copy(t.sensitivity),this.translation.copy(t.translation),this.zoom.copy(t.zoom),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toDataURL",value:function(){return URL.createObjectURL(new Blob([JSON.stringify(this)],{type:"text/json"}))}}]),t}(),ln=function(){function t(){i(this,t)}return r(t,[{key:"execute",value:function(t){throw new Error("Strategy#execute method not implemented!")}}]),t}(),cn=function(t){a(e,ln);function e(t,n){i(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.movementState=t,r.direction=n,r}return r(e,[{key:"execute",value:function(t){var e=this.movementState;switch(this.direction){case dn.FORWARD:e.forward=t;break;case dn.LEFT:e.left=t;break;case dn.BACKWARD:e.backward=t;break;case dn.RIGHT:e.right=t;break;case dn.DOWN:e.down=t;break;case dn.UP:e.up=t}}}]),e}(),dn={FORWARD:0,LEFT:1,BACKWARD:2,RIGHT:3,DOWN:4,UP:5},vn=function(t){a(e,ln);function e(t,n){i(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.rotationManager=t,r.zoomIn=n,r}return r(e,[{key:"execute",value:function(t){t&&this.rotationManager.zoom(this.zoomIn?-1:1)}}]),e}(),fn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document.body;i(this,t),this.dom=r,this.position=e,this.quaternion=n,this.target=new ne,this.settings=new hn,this.rotationManager=new Xe(e,n,this.target,this.settings),this.translationManager=new $e(e,n,this.target,this.settings),this.strategies=function(t,e){var n=e.movementState;return new Map([[ee.MOVE_FORWARD,new cn(n,dn.FORWARD)],[ee.MOVE_LEFT,new cn(n,dn.LEFT)],[ee.MOVE_BACKWARD,new cn(n,dn.BACKWARD)],[ee.MOVE_RIGHT,new cn(n,dn.RIGHT)],[ee.MOVE_DOWN,new cn(n,dn.DOWN)],[ee.MOVE_UP,new cn(n,dn.UP)],[ee.ZOOM_OUT,new vn(t,!1)],[ee.ZOOM_IN,new vn(t,!0)]])}(this.rotationManager,this.translationManager),this.lastScreenPosition=new ue,this.dragging=!1,this.enabled=!1,null!==e&&null!==n&&(this.lookAt(this.target),null!==r&&this.setEnabled())}return r(t,[{key:"getDom",value:function(){return this.dom}},{key:"getPosition",value:function(){return this.position}},{key:"getQuaternion",value:function(){return this.quaternion}},{key:"getTarget",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne;return t.copy(this.target),this.settings.general.orbit||t.add(this.position),t}},{key:"getViewDirection",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne;return this.rotationManager.getViewDirection(t)}},{key:"setDom",value:function(t){var e=this.enabled;return null!==t&&(e&&this.setEnabled(!1),this.dom=t,this.setEnabled(e)),this}},{key:"setPosition",value:function(t){return this.position=t,this.rotationManager.setPosition(t),this.translationManager.setPosition(t),this.lookAt(this.target)}},{key:"setQuaternion",value:function(t){return this.quaternion=t,this.rotationManager.setQuaternion(t),this.translationManager.setQuaternion(t),this.lookAt(this.target)}},{key:"setTarget",value:function(t){return this.target=t,this.rotationManager.setTarget(t),this.translationManager.setTarget(t),this.lookAt(this.target)}},{key:"setOrbitEnabled",value:function(t){var e=this.settings.general;return e.orbit!==t&&(this.getTarget(this.target),e.orbit=t,this.lookAt(this.target)),this}},{key:"copy",value:function(t){return this.dom=t.getDom(),this.position=t.getPosition(),this.quaternion=t.getQuaternion(),this.target=t.getTarget(),this.settings.copy(t.settings),this.rotationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.translationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.lookAt(this.target)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"handlePointerMoveEvent",value:function(t){var e=this.settings,n=e.pointer,i=e.sensitivity,r=this.rotationManager,s=this.lastScreenPosition,a=void 0,o=void 0;document.pointerLockElement===this.dom?n.hold&&!this.dragging||r.adjustSpherical(t.movementX*i.rotation,t.movementY*i.rotation).updateQuaternion():(a=t.screenX-s.x,o=t.screenY-s.y,s.set(t.screenX,t.screenY),r.adjustSpherical(a*i.rotation,o*i.rotation).updateQuaternion())}},{key:"handleTouchMoveEvent",value:function(t){var e=this.settings.sensitivity,n=this.rotationManager,i=this.lastScreenPosition,r=t.touches[0],s=r.screenX-i.x,a=r.screenY-i.y;i.set(r.screenX,r.screenY),t.preventDefault(),n.adjustSpherical(s*e.rotation,a*e.rotation).updateQuaternion()}},{key:"handleMainPointerButton",value:function(t,e){this.dragging=e,this.settings.pointer.lock?this.setPointerLocked():e?(this.lastScreenPosition.set(t.screenX,t.screenY),this.dom.addEventListener("mousemove",this)):this.dom.removeEventListener("mousemove",this)}},{key:"handleAuxiliaryPointerButton",value:function(t,e){}},{key:"handleSecondaryPointerButton",value:function(t,e){}},{key:"handlePointerButtonEvent",value:function(t,e){switch(t.preventDefault(),t.button){case Qe:this.handleMainPointerButton(t,e);break;case Ne:this.handleAuxiliaryPointerButton(t,e);break;case Ye:this.handleSecondaryPointerButton(t,e)}}},{key:"handleTouchEvent",value:function(t,e){var n=t.touches[0];t.preventDefault(),e?(this.lastScreenPosition.set(n.screenX,n.screenY),this.dom.addEventListener("touchmove",this)):this.dom.removeEventListener("touchmove",this)}},{key:"handleKeyboardEvent",value:function(t,e){var n=this.settings.keyBindings;n.has(t.keyCode)&&(t.preventDefault(),this.strategies.get(n.get(t.keyCode)).execute(e))}},{key:"handleWheelEvent",value:function(t){this.rotationManager.zoom(Math.sign(t.deltaY))}},{key:"handlePointerLockEvent",value:function(){document.pointerLockElement===this.dom?this.dom.addEventListener("mousemove",this):this.dom.removeEventListener("mousemove",this)}},{key:"handleEvent",value:function(t){switch(t.type){case"mousemove":this.handlePointerMoveEvent(t);break;case"touchmove":this.handleTouchMoveEvent(t);break;case"mousedown":this.handlePointerButtonEvent(t,!0);break;case"mouseup":this.handlePointerButtonEvent(t,!1);break;case"touchstart":this.handleTouchEvent(t,!0);break;case"touchend":this.handleTouchEvent(t,!1);break;case"keydown":this.handleKeyboardEvent(t,!0);break;case"keyup":this.handleKeyboardEvent(t,!1);break;case"wheel":this.handleWheelEvent(t);break;case"pointerlockchange":this.handlePointerLockEvent()}}},{key:"update",value:function(t){this.rotationManager.update(t),this.translationManager.update(t)}},{key:"moveTo",value:function(t){return this.rotationManager.moveTo(t),this}},{key:"lookAt",value:function(t){return this.rotationManager.lookAt(t),this}},{key:"setPointerLocked",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?document.pointerLockElement!==this.dom&&void 0!==this.dom.requestPointerLock&&this.dom.requestPointerLock():void 0!==document.exitPointerLock&&document.exitPointerLock()}},{key:"setEnabled",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.dom;return this.translationManager.movementState.reset(),t&&!this.enabled?(document.addEventListener("pointerlockchange",this),document.body.addEventListener("keyup",this),document.body.addEventListener("keydown",this),e.addEventListener("mousedown",this),e.addEventListener("mouseup",this),e.addEventListener("touchstart",this),e.addEventListener("touchend",this),e.addEventListener("wheel",this)):!t&&this.enabled&&(document.removeEventListener("pointerlockchange",this),document.body.removeEventListener("keyup",this),document.body.removeEventListener("keydown",this),e.removeEventListener("mousedown",this),e.removeEventListener("mouseup",this),e.removeEventListener("touchstart",this),e.removeEventListener("touchend",this),e.removeEventListener("wheel",this),e.removeEventListener("mousemove",this),e.removeEventListener("touchmove",this)),this.setPointerLocked(!1),this.enabled=t,this}},{key:"dispose",value:function(){this.setEnabled(!1)}}]),t}(),yn=0,mn=function(e){a(n,e);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];i(this,n);var h=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));h.name="HermiteDataHelper",h.cellPosition=e,h.cellSize=r,h.data=s,h.pointsMaterial=new t.PointsMaterial({vertexColors:t.VertexColors,sizeAttenuation:!0,size:.05}),h.add(new t.Group),h.add(new t.Group),h.add(new t.Group),h.gridPoints.name="GridPoints",h.edges.name="Edges",h.normals.name="Normals";try{h.update(a,u)}catch(t){}return h}return r(n,[{key:"validate",value:function(){var t=null;return null===this.cellPosition?t=new Error("The cell position is not defined"):this.cellSize<=0?t=new Error("Invalid cell size: "+this.cellSize):null===this.data?t=new Error("No data"):(this.data.empty&&(t=new Error("The provided data is empty")),this.data.compressed&&(t=new Error("The provided data must be uncompressed"))),t}},{key:"set",value:function(t,e,n){return this.cellPosition=t,this.cellSize=e,this.data=n,this}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.data,i=this.validate();if(this.dispose(),null!==i)throw i;return t&&this.createPoints(n),e&&null!==n.edgeData&&this.createEdges(n),this}},{key:"createPoints",value:function(e){var n=e.materialIndices,i=Math.cbrt(n.length)-1,r=this.cellSize,s=this.cellPosition,a=new t.Vector3,o=new t.Vector3,u=new Float32Array([0,0,0]),h=new t.BufferGeometry,l=e.materials,c=new Float32Array(3*l),d=new Float32Array(3*l),v=void 0,f=void 0,y=void 0,m=void 0,g=void 0;for(m=0,g=0,y=0;y<=i;++y)for(a.z=y*r/i,f=0;f<=i;++f)for(a.y=f*r/i,v=0;v<=i;++v)a.x=v*r/i,n[m++]!==yn&&(o.addVectors(s,a),c[g]=o.x,d[g++]=u[0],c[g]=o.y,d[g++]=u[1],c[g]=o.z,d[g++]=u[2]);h.addAttribute("position",new t.BufferAttribute(c,3)),h.addAttribute("color",new t.BufferAttribute(d,3)),this.gridPoints.add(new t.Points(h,this.pointsMaterial))}},{key:"createEdges",value:function(e){var n=e.edgeData,i=Math.cbrt(e.materialIndices.length)-1,r=this.cellSize,s=new t.Vector3,a=new t.Vector3,o=[n.edgesX(this.cellPosition,this.cellSize),n.edgesY(this.cellPosition,this.cellSize),n.edgesZ(this.cellPosition,this.cellSize)],u=[new Float32Array([.6,0,0]),new Float32Array([0,.6,0]),new Float32Array([0,0,.6])],h=new Float32Array([0,1,1]),l=new t.LineBasicMaterial({vertexColors:t.VertexColors}),c=void 0,d=void 0,v=void 0,f=void 0,y=void 0,m=void 0,g=void 0,p=void 0,x=void 0,A=void 0,w=void 0,k=void 0;for(w=0,k=0,A=0;A<3;++A,w=0,k=0)if(m=u[A],(p=o[A]).lengths.length>0){y=2*p.lengths[0],c=new Float32Array(3*y),d=new Float32Array(3*y),v=new Float32Array(3*y),f=new Float32Array(3*y);var M=!0,z=!1,D=void 0;try{for(var C,S=p[Symbol.iterator]();!(M=(C=S.next()).done);M=!0)x=C.value,c[w]=x.a.x,d[w++]=m[0],c[w]=x.a.y,d[w++]=m[1],c[w]=x.a.z,d[w++]=m[2],c[w]=x.b.x,d[w++]=m[0],c[w]=x.b.y,d[w++]=m[1],c[w]=x.b.z,d[w++]=m[2],x.computeZeroCrossingPosition(s),a.copy(s).addScaledVector(x.n,.25*r/i),v[k]=s.x,f[k++]=h[0],v[k]=s.y,f[k++]=h[1],v[k]=s.z,f[k++]=h[2],v[k]=a.x,f[k++]=h[0],v[k]=a.y,f[k++]=h[1],v[k]=a.z,f[k++]=h[2]}catch(t){z=!0,D=t}finally{try{!M&&S.return&&S.return()}finally{if(z)throw D}}(g=new t.BufferGeometry).addAttribute("position",new t.BufferAttribute(c,3)),g.addAttribute("color",new t.BufferAttribute(d,3)),this.edges.add(new t.LineSegments(g,l)),(g=new t.BufferGeometry).addAttribute("position",new t.BufferAttribute(v,3)),g.addAttribute("color",new t.BufferAttribute(f,3)),this.normals.add(new t.LineSegments(g,l))}}},{key:"dispose",value:function(){var t=void 0,e=void 0,n=void 0,i=void 0;for(n=0,i=this.children.length;n<i;++n)for(e=(t=this.children[n]).children;e.length>0;)e[0].geometry.dispose(),e[0].material.dispose(),t.remove(e[0])}},{key:"gridPoints",get:function(){return this.children[0]}},{key:"edges",get:function(){return this.children[1]}},{key:"normals",get:function(){return this.children[2]}}],[{key:"air",set:function(t){yn=t}}]),n}(t.Group),gn=function(e){a(n,e);function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;i(this,n);var e=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.name="OctreeHelper",e.octree=t,e.update(),e}return r(n,[{key:"createLineSegments",value:function(e,n){var i=Math.pow(2,16)/8-1,r=new t.Group,s=new t.LineBasicMaterial({color:16777215*Math.random()}),a=void 0,o=void 0,u=void 0,h=void 0,l=void 0,c=void 0,d=void 0,v=void 0,f=void 0,y=void 0,m=void 0,g=void 0,p=void 0,x=void 0,A=void 0,w=void 0;for(y=0,u=0,x=Math.ceil(n/i);x>0;--x){for(u+=n<i?n:i,n-=i,o=8*u,h=new Uint16Array(3*o),l=new Float32Array(3*o),g=0,p=0,a=e.next();!a.done&&y<u;){for(d=(c=a.value).min,v=c.max,m=0;m<12;++m)w=xn[m],h[p++]=g+w[0],h[p++]=g+w[1];for(m=0;m<8;++m,++g)A=pn[m],l[3*g]=0===A[0]?d.x:v.x,l[3*g+1]=0===A[1]?d.y:v.y,l[3*g+2]=0===A[2]?d.z:v.z;++y<u&&(a=e.next())}(f=new t.BufferGeometry).setIndex(new t.BufferAttribute(h,1)),f.addAttribute("position",new t.BufferAttribute(l,3)),r.add(new t.LineSegments(f,s))}this.add(r)}},{key:"update",value:function(){var t=null!==this.octree?this.octree.getDepth():-1,e=0,n=void 0;for(this.dispose();e<=t;)n=this.octree.findOctantsByLevel(e),this.createLineSegments(n[Symbol.iterator](),"number"==typeof n.size?n.size:n.length),++e}},{key:"dispose",value:function(){var t=this.children,e=void 0,n=void 0,i=void 0,r=void 0,s=void 0,a=void 0;for(i=0,s=t.length;i<s;++i){for(r=0,a=(n=(e=t[i]).children).length;r<a;++r)n[r].geometry.dispose(),n[r].material.dispose();for(;n.length>0;)e.remove(n[0])}for(;t.length>0;)this.remove(t[0])}}]),n}(t.Group),pn=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],xn=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],An=(function(){function t(){i(this,t)}r(t,[{key:"serialize",value:function(){throw new Error("Serializable#serialise method not implemented!")}}])}(),function(){function t(){i(this,t)}r(t,[{key:"deserialize",value:function(t){throw new Error("Deserializable#deserialise method not implemented!")}}])}(),function(){function t(){i(this,t)}r(t,[{key:"dispose",value:function(){throw new Error("Disposable#dispose method not implemented!")}}])}(),function(){function t(){i(this,t)}r(t,[{key:"createTransferList",value:function(){throw new Error("TransferableContainer#createTransferList method not implemented!")}}])}(),function(){function t(){i(this,t),this.elements=[],this.head=0}return r(t,[{key:"add",value:function(t){this.elements.push(t)}},{key:"peek",value:function(){return this.elements.length>0?this.elements[this.head]:void 0}},{key:"poll",value:function(){var t=this.elements,e=t.length,n=void 0;return e>0&&(n=t[this.head++],2*this.head>=e&&(this.elements=t.slice(this.head),this.head=0)),n}},{key:"clear",value:function(){this.elements=[],this.head=0}},{key:"size",get:function(){return this.elements.length-this.head}},{key:"empty",get:function(){return 0===this.elements.length}}]),t}()),wn={UNION:"csg.union",DIFFERENCE:"csg.difference",INTERSECTION:"csg.intersection",DENSITY_FUNCTION:"csg.densityfunction"},kn={AIR:0,SOLID:1},Mn=function(){function t(e){i(this,t),this.type=e;for(var n=arguments.length,r=Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];this.children=r,this.boundingBox=null}return r(t,[{key:"getBoundingBox",value:function(){return null===this.boundingBox&&(this.boundingBox=this.computeBoundingBox()),this.boundingBox}},{key:"computeBoundingBox",value:function(){var t=this.children,e=new se,n=void 0,i=void 0;for(n=0,i=t.length;n<i;++n)e.union(t[n].getBoundingBox());return e}}]),t}(),zn=function(t){a(e,Mn);function e(){var t;i(this,e);for(var n=arguments.length,r=Array(n),s=0;s<n;s++)r[s]=arguments[s];return o(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this,wn.UNION].concat(r)))}return r(e,[{key:"updateMaterialIndex",value:function(t,e,n){var i=n.materialIndices[t];i!==kn.AIR&&e.setMaterialIndex(t,i)}},{key:"selectEdge",value:function(t,e,n){return n?t.t>e.t?t:e:t.t<e.t?t:e}}]),e}(),Dn=function(t){a(e,Mn);function e(){var t;i(this,e);for(var n=arguments.length,r=Array(n),s=0;s<n;s++)r[s]=arguments[s];return o(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this,wn.DIFFERENCE].concat(r)))}return r(e,[{key:"updateMaterialIndex",value:function(t,e,n){n.materialIndices[t]!==kn.AIR&&e.setMaterialIndex(t,kn.AIR)}},{key:"selectEdge",value:function(t,e,n){return n?t.t<e.t?t:e:t.t>e.t?t:e}}]),e}(),Cn=function(t){a(e,Mn);function e(){var t;i(this,e);for(var n=arguments.length,r=Array(n),s=0;s<n;s++)r[s]=arguments[s];return o(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this,wn.INTERSECTION].concat(r)))}return r(e,[{key:"updateMaterialIndex",value:function(t,e,n){var i=n.materialIndices[t];e.setMaterialIndex(t,e.materialIndices[t]!==kn.AIR&&i!==kn.AIR?i:kn.AIR)}},{key:"selectEdge",value:function(t,e,n){return n?t.t<e.t?t:e:t.t>e.t?t:e}}]),e}(),Sn=function(t){a(e,Mn);function e(t){i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,wn.DENSITY_FUNCTION));return n.sdf=t,n}return r(e,[{key:"computeBoundingBox",value:function(){return this.sdf.getBoundingBox(!0)}},{key:"generateMaterialIndex",value:function(t){return this.sdf.sample(t)<=0?this.sdf.material:kn.AIR}},{key:"generateEdge",value:function(t){t.approximateZeroCrossing(this.sdf),t.computeSurfaceNormal(this.sdf)}}]),e}(),bn=new Ue,En=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kn.SOLID;i(this,t),this.type=e,this.operation=null,this.material=Math.min(255,Math.max(kn.SOLID,Math.trunc(n))),this.boundingBox=null,this.position=new ne,this.quaternion=new pe,this.scale=new ne(1,1,1),this.inverseTransformation=new Ue,this.updateInverseTransformation(),this.children=[]}return r(t,[{key:"getTransformation",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ue).compose(this.position,this.quaternion,this.scale)}},{key:"getBoundingBox",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.children,n=this.boundingBox,i=void 0,r=void 0;if(null===n&&(n=this.computeBoundingBox(),this.boundingBox=n),t)for(n=n.clone(),i=0,r=e.length;i<r;++i)n.union(e[i].getBoundingBox(t));return n}},{key:"setMaterial",value:function(t){return this.material=Math.min(255,Math.max(kn.SOLID,Math.trunc(t))),this}},{key:"setOperationType",value:function(t){return this.operation=t,this}},{key:"updateInverseTransformation",value:function(){return this.inverseTransformation.getInverse(this.getTransformation(bn)),this.boundingBox=null,this}},{key:"union",value:function(t){return this.children.push(t.setOperationType(wn.UNION)),this}},{key:"subtract",value:function(t){return this.children.push(t.setOperationType(wn.DIFFERENCE)),this}},{key:"intersect",value:function(t){return this.children.push(t.setOperationType(wn.INTERSECTION)),this}},{key:"toCSG",value:function(){var t=this.children,e=new Sn(this),n=void 0,i=void 0,r=void 0,s=void 0;for(r=0,s=t.length;r<s;++r){if(n!==(i=t[r]).operation)switch(n=i.operation){case wn.UNION:e=new zn(e);break;case wn.DIFFERENCE:e=new Dn(e);break;case wn.INTERSECTION:e=new Cn(e)}e.children.push(i.toCSG())}return e}},{key:"serialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e={type:this.type,operation:this.operation,material:this.material,position:this.position.toArray(),quaternion:this.quaternion.toArray(),scale:this.scale.toArray(),parameters:null,children:[]},n=void 0,i=void 0;for(n=0,i=this.children.length;n<i;++n)e.children.push(this.children[n].serialize(t));return e}},{key:"createTransferList",value:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}},{key:"toJSON",value:function(){return this.serialize(!0)}},{key:"computeBoundingBox",value:function(){throw new Error("SignedDistanceFunction#computeBoundingBox method not implemented!")}},{key:"sample",value:function(t){throw new Error("SignedDistanceFunction#sample method not implemented!")}}]),t}(),Pn={HEIGHTFIELD:"sdf.heightfield",FRACTAL_NOISE:"sdf.fractalnoise",SUPER_PRIMITIVE:"sdf.superprimitive"},Bn=function(t){a(e,En);function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];i(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Pn.PERLIN_NOISE,n));return r.min=new(Function.prototype.bind.apply(ne,[null].concat(u(t.min)))),r.max=new(Function.prototype.bind.apply(ne,[null].concat(u(t.max)))),r}return r(e,[{key:"computeBoundingBox",value:function(){return this.bbox=new se(this.min,this.max),this.bbox}},{key:"sample",value:function(t){}},{key:"serialize",value:function(){var t=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"serialize",this).call(this);return t.parameters={min:this.min.toArray(),max:this.max.toArray()},t}}]),e}();var In=function(t){a(e,En);function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];i(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Pn.HEIGHTFIELD,n));return r.width=void 0!==t.width?t.width:1,r.height=void 0!==t.height?t.height:1,r.data=void 0!==t.data?t.data:null,r.heightmap=null,void 0!==t.image&&r.fromImage(t.image),r}return r(e,[{key:"fromImage",value:function(t){var e="undefined"==typeof document?null:function(t){var e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=e.getContext("2d");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height)}(t),n=null,i=void 0,r=void 0,s=void 0,a=void 0;if(null!==e){for(i=e.data,r=0,s=0,a=(n=new Uint8ClampedArray(i.length/4)).length;r<a;++r,s+=4)n[r]=i[s];this.heightmap=t,this.width=e.width,this.height=e.height,this.data=n}return this}},{key:"computeBoundingBox",value:function(){var t=new se,e=Math.min(this.width/this.height,1),n=Math.min(this.height/this.width,1);return t.min.set(0,0,0),t.max.set(e,1,n),t.applyMatrix4(this.getTransformation()),t}},{key:"sample",value:function(t){var e=this.boundingBox,n=void 0;if(e.containsPoint(t)){t.applyMatrix4(this.inverseTransformation);var i=this.width,r=this.height,s=Math.max(Math.min(Math.trunc(t.x*i),i),0),a=Math.max(Math.min(Math.trunc(t.z*r),r),0),o=this.data[a*i+s]/255;n=t.y-o}else n=e.distanceToPoint(t);return n}},{key:"serialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"serialize",this).call(this);return n.parameters={width:this.width,height:this.height,data:t?null:this.data,dataUrl:t&&null!==this.heightmap?this.heightmap.toDataUrl():null,image:null},n}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.push(this.data.buffer),t}}]),e}(),Tn=function(t){a(e,En);function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];i(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Pn.SUPER_PRIMITIVE,n));return r.s0=new(Function.prototype.bind.apply(Ge,[null].concat(u(t.s)))),r.r0=new(Function.prototype.bind.apply(ne,[null].concat(u(t.r)))),r.s=new Ge,r.r=new ne,r.ba=new ue,r.offset=0,r.precompute(),r}return r(e,[{key:"setSize",value:function(t,e,n,i){return this.s0.set(t,e,n,i),this.precompute()}},{key:"setRadii",value:function(t,e,n){return this.r0.set(t,e,n),this.precompute()}},{key:"precompute",value:function(){var t=this.s.copy(this.s0),e=this.r.copy(this.r0),n=this.ba;t.x-=e.x,t.y-=e.x,e.x-=t.w,t.w-=e.y,t.z-=e.y,this.offset=-2*t.z,n.set(e.z,this.offset);var i=n.dot(n);return 0===i?n.set(0,-1):n.divideScalar(i),this}},{key:"computeBoundingBox",value:function(){var t=this.s0,e=new se;return e.min.x=Math.min(-t.x,-1),e.min.y=Math.min(-t.y,-1),e.min.z=Math.min(-t.z,-1),e.max.x=Math.max(t.x,1),e.max.y=Math.max(t.y,1),e.max.z=Math.max(t.z,1),e.applyMatrix4(this.getTransformation()),e}},{key:"sample",value:function(t){t.applyMatrix4(this.inverseTransformation);var e=this.s,n=this.r,i=this.ba,r=Math.abs(t.x)-e.x,s=Math.abs(t.y)-e.y,a=Math.abs(t.z)-e.z,o=Math.max(r,0),u=Math.max(s,0),h=Math.sqrt(o*o+u*u),l=t.z-e.z,c=Math.abs(h+Math.min(0,Math.max(r,s))-n.x)-e.w,d=Math.min(Math.max(c*i.x+l*i.y,0),1),v=c-n.z*d,f=l-this.offset*d,y=Math.max(c-n.z,0),m=t.z+e.z,g=Math.max(c,0),p=v*v+f*f,x=y*y+m*m,A=g*g+l*l,w=c*-i.y+l*i.x;return Math.sqrt(Math.min(p,Math.min(x,A)))*Math.sign(Math.max(w,a))-n.y}},{key:"serialize",value:function(){var t=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"serialize",this).call(this);return t.parameters={s:this.s0.toArray(),r:this.r0.toArray()},t}}],[{key:"create",value:function(t){var n=On[t];return new e({s:n[0],r:n[1]})}}]),e}(),On=[[new Float32Array([1,1,1,1]),new Float32Array([0,0,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,0,0])],[new Float32Array([0,0,1,1]),new Float32Array([0,0,1])],[new Float32Array([1,1,2,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,.25,1]),new Float32Array([1,.25,0])],[new Float32Array([1,1,.25,.25]),new Float32Array([1,.25,0])],[new Float32Array([1,1,1,.25]),new Float32Array([1,.1,0])],[new Float32Array([1,1,1,.25]),new Float32Array([.1,.1,0])]],Un={CUBE:0,CYLINDER:1,CONE:2,PILL:3,SPHERE:4,PELLET:5,TORUS:6,PIPE:7,CORRIDOR:8},Fn=function(){function t(){i(this,t)}return r(t,[{key:"revive",value:function(t){var e=void 0,n=void 0,i=void 0;switch(t.type){case Pn.FRACTAL_NOISE:e=new Bn(t.parameters,t.material);break;case Pn.HEIGHTFIELD:e=new In(t.parameters,t.material);break;case Pn.SUPER_PRIMITIVE:e=new Tn(t.parameters,t.material)}for(e.operation=t.operation,e.position.fromArray(t.position),e.quaternion.fromArray(t.quaternion),e.scale.fromArray(t.scale),e.updateInverseTransformation(),n=0,i=t.children.length;n<i;++n)e.children.push(this.revive(t.children[n]));return e}}]),t}(),Ln=new(function(t){a(e,Kt);function e(t){i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.descriptions=null,n}return e}())("load"),Rn=function(t){a(e,Jt);function e(){i(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.items=0,t.descriptions=null,t.imageMap=new WeakMap,t}return r(e,[{key:"clear",value:function(){this.imageMap=new WeakMap}},{key:"handleEvent",value:function(t){switch(t.type){case"load":this.progress(t)}}},{key:"progress",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=null!==t?t.target:null,n=this.imageMap;null!==e&&(n.has(e)&&(n.get(e).image=e),--this.items),0===this.items&&(this.clear(),Ln.descriptions=this.descriptions,this.dispatchEvent(Ln))}},{key:"loadImage",value:function(t){var e=new Image;this.imageMap.set(e,t),++this.items,e.addEventListener("load",this),e.src=t.dataUrl}},{key:"inflate",value:function(t){var e=void 0;null!==t.dataUrl&&this.loadImage(t);var n=!0,i=!1,r=void 0;try{for(var s,a=t.children[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)e=s.value,this.inflate(e)}catch(t){i=!0,r=t}finally{try{!n&&a.return&&a.return()}finally{if(i)throw r}}this.progress()}},{key:"load",value:function(t){var e=void 0;this.items=0,this.descriptions=t;var n=!0,i=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)e=s.value,this.inflate(e)}catch(t){i=!0,r=t}finally{try{!n&&a.return&&a.return()}finally{if(i)throw r}}}}]),e}(),Vn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i(this,t),this.runLengths=e,this.data=n}return r(t,null,[{key:"encode",value:function(e){var n=[],i=[],r=e[0],s=1,a=void 0,o=void 0;for(a=1,o=e.length;a<o;++a)r!==e[a]?(n.push(s),i.push(r),r=e[a],s=1):++s;return n.push(s),i.push(r),new t(n,i)}},{key:"decode",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=void 0,r=void 0,s=void 0,a=void 0,o=void 0,u=0;for(r=0,a=e.length;r<a;++r)for(i=e[r],s=0,o=t[r];s<o;++s)n[u++]=i;return n}}]),t}(),Gn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];i(this,t),this.value=e,this.done=n}return r(t,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),t}(),Qn=new ne,Nn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ne;i(this,t),this.min=e,this.max=n,this.children=null}return r(t,[{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne).addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne).subVectors(this.max,this.min)}},{key:"split",value:function(){var t=this.min,e=this.max,n=this.getCenter(Qn),i=this.children=[null,null,null,null,null,null,null,null],r=void 0,s=void 0;for(r=0;r<8;++r)s=Yn[r],i[r]=new this.constructor(new ne(0===s[0]?t.x:n.x,0===s[1]?t.y:n.y,0===s[2]?t.z:n.z),new ne(0===s[0]?n.x:e.x,0===s[1]?n.y:e.y,0===s[2]?n.z:e.z))}}]),t}(),Yn=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],Hn=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],qn=new ne,jn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;i(this,t),this.min=e,this.size=n,this.children=null}return r(t,[{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne).copy(this.min).addScalar(.5*this.size)}},{key:"getDimensions",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne).set(this.size,this.size,this.size)}},{key:"split",value:function(){var t=this.min,e=this.getCenter(qn),n=.5*this.size,i=this.children=[null,null,null,null,null,null,null,null],r=void 0,s=void 0;for(r=0;r<8;++r)s=Yn[r],i[r]=new this.constructor(new ne(0===s[0]?t.x:e.x,0===s[1]?t.y:e.y,0===s[2]?t.z:e.z),n)}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}]),t}(),Xn=new se,Wn=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i(this,t),this.octree=e,this.region=n,this.cull=null!==n,this.result=new Gn,this.trace=null,this.indices=null,this.reset()}return r(t,[{key:"reset",value:function(){var t=this.octree.root;return this.trace=[],this.indices=[],null!==t&&(Xn.min=t.min,Xn.max=t.max,this.cull&&!this.region.intersectsBox(Xn)||(this.trace.push(t),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var t=this.cull,e=this.region,n=this.indices,i=this.trace,r=null,s=i.length-1,a=void 0,o=void 0,u=void 0;null===r&&s>=0;)if(a=n[s],o=i[s].children,++n[s],a<8)if(null!==o){if(u=o[a],t&&(Xn.min=u.min,Xn.max=u.max,!e.intersectsBox(Xn)))continue;i.push(u),n.push(0),++s}else r=i.pop(),n.pop();else i.pop(),n.pop(),--s;return this.result.value=r,this.result.done=null===r,this.result}},{key:"return",value:function(t){return this.result.value=t,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),Kn=[new ne,new ne,new ne],Jn=new se,Zn=new Le,_n=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],$n=0;function ti(t,e,n,i){var r=void 0,s=0;return e<n?(r=e,s=0):(r=n,s=1),i<r&&(s=2),_n[t][s]}var ei=function(){function t(){i(this,t)}return r(t,null,[{key:"intersectOctree",value:function(t,e,n){var i=Jn.min.set(0,0,0),r=Jn.max.subVectors(t.max,t.min),s=t.getDimensions(Kn[0]),a=Kn[1].copy(s).multiplyScalar(.5),o=Zn.origin.copy(e.ray.origin),u=Zn.direction.copy(e.ray.direction),h=void 0,l=void 0,c=void 0,d=void 0,v=void 0,f=void 0,y=void 0,m=void 0,g=void 0;o.sub(t.getCenter(Kn[2])).add(a),$n=0,u.x<0&&(o.x=s.x-o.x,u.x=-u.x,$n|=4),u.y<0&&(o.y=s.y-o.y,u.y=-u.y,$n|=2),u.z<0&&(o.z=s.z-o.z,u.z=-u.z,$n|=1),h=1/u.x,l=1/u.y,c=1/u.z,d=(i.x-o.x)*h,v=(r.x-o.x)*h,f=(i.y-o.y)*l,y=(r.y-o.y)*l,m=(i.z-o.z)*c,g=(r.z-o.z)*c,Math.max(Math.max(d,f),m)<Math.min(Math.min(v,y),g)&&function t(e,n,i,r,s,a,o,u,h){var l=e.children,c=void 0,d=void 0,v=void 0,f=void 0;if(s>=0&&a>=0&&o>=0)if(null===l)h.push(e);else{c=function(t,e,n,i,r,s){var a=0;return t>e&&t>n?(r<t&&(a|=2),s<t&&(a|=1)):e>n?(i<e&&(a|=4),s<e&&(a|=1)):(i<n&&(a|=4),r<n&&(a|=2)),a}(n,i,r,d=.5*(n+s),v=.5*(i+a),f=.5*(r+o));do{switch(c){case 0:t(l[$n],n,i,r,d,v,f,u,h),c=ti(c,d,v,f);break;case 1:t(l[1^$n],n,i,f,d,v,o,u,h),c=ti(c,d,v,o);break;case 2:t(l[2^$n],n,v,r,d,a,f,u,h),c=ti(c,d,a,f);break;case 3:t(l[3^$n],n,v,f,d,a,o,u,h),c=ti(c,d,a,o);break;case 4:t(l[4^$n],d,i,r,s,v,f,u,h),c=ti(c,s,v,f);break;case 5:t(l[5^$n],d,i,f,s,v,o,u,h),c=ti(c,s,v,o);break;case 6:t(l[6^$n],d,v,r,s,a,f,u,h),c=ti(c,s,a,f);break;case 7:t(l[7^$n],d,v,f,s,a,o,u,h),c=8}}while(c<8)}}(t.root,d,f,m,v,y,g,e,n)}}]),t}(),ni=new se;var ii=function(){function t(e,n){i(this,t),this.root=void 0!==e&&void 0!==n?new Nn(e,n):null}return r(t,[{key:"getCenter",value:function(t){return this.root.getCenter(t)}},{key:"getDimensions",value:function(t){return this.root.getDimensions(t)}},{key:"getDepth",value:function(){return function t(e){var n=e.children,i=0,r=void 0,s=void 0,a=void 0;if(null!==n)for(r=0,s=n.length;r<s;++r)(a=1+t(n[r]))>i&&(i=a);return i}(this.root)}},{key:"cull",value:function(t){var e=[];return function t(e,n,i){var r=e.children,s=void 0,a=void 0;if(ni.min=e.min,ni.max=e.max,n.intersectsBox(ni))if(null!==r)for(s=0,a=r.length;s<a;++s)t(r[s],n,i);else i.push(e)}(this.root,t,e),e}},{key:"findOctantsByLevel",value:function(t){var e=[];return function t(e,n,i,r){var s=e.children,a=void 0,o=void 0;if(i===n)r.push(e);else if(null!==s)for(++i,a=0,o=s.length;a<o;++a)t(s[a],n,i,r)}(this.root,t,0,e),e}},{key:"raycast",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return ei.intersectOctree(this,t,e),e}},{key:"leaves",value:function(t){return new Wn(this,t)}},{key:Symbol.iterator,value:function(){return new Wn(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),t}(),ri=new ne,si=function(t){a(e,Nn);function e(t,n){i(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return r.points=null,r.data=null,r}return r(e,[{key:"distanceToSquared",value:function(t){return ri.copy(t).clamp(this.min,this.max).sub(t).lengthSquared()}},{key:"distanceToCenterSquared",value:function(t){var e=this.getCenter(ri),n=t.x-e.x,i=t.y-e.x,r=t.z-e.z;return n*n+i*i+r*r}},{key:"contains",value:function(t,e){var n=this.min,i=this.max;return t.x>=n.x-e&&t.y>=n.y-e&&t.z>=n.z-e&&t.x<=i.x+e&&t.y<=i.y+e&&t.z<=i.z+e}},{key:"redistribute",value:function(t){var e=this.children,n=this.points,i=this.data,r=void 0,s=void 0,a=void 0,o=void 0,u=void 0,h=void 0,l=void 0;if(null!==e)for(r=0,a=n.length;r<a;++r)for(h=n[r],l=i[r],s=0,o=e.length;s<o;++s)if((u=e[s]).contains(h,t)){null===u.points&&(u.points=[],u.data=[]),u.points.push(h),u.data.push(l);break}this.points=null,this.data=null}},{key:"merge",value:function(){var t=this.children,e=void 0,n=void 0,i=void 0;if(null!==t){for(this.points=[],this.data=[],e=0,n=t.length;e<n;++e)if(null!==(i=t[e]).points){var r,s;(r=this.points).push.apply(r,u(i.points)),(s=this.data).push.apply(s,u(i.data))}this.children=null}}}]),e}(),ai=function t(e,n,r){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;i(this,t),this.distance=e,this.distanceToRay=n,this.point=r,this.object=s},oi=1e-6;function ui(t){var e=t.children,n=0,i=void 0,r=void 0;if(null!==e)for(i=0,r=e.length;i<r;++i)n+=ui(e[i]);else null!==t.points&&(n=t.points.length);return n}function hi(t,e,n,i,r){var s=i.children,a=!1,o=!1,u=void 0,h=void 0;if(i.contains(t,n.bias)){if(null===s){if(null===i.points)i.points=[],i.data=[];else for(u=0,h=i.points.length;!a&&u<h;++u)a=i.points[u].equals(t);a?(i.data[u-1]=e,o=!0):i.points.length<n.maxPoints||r===n.maxDepth?(i.points.push(t.clone()),i.data.push(e),++n.pointCount,o=!0):(i.split(),i.redistribute(n.bias),s=i.children)}if(null!==s)for(++r,u=0,h=s.length;!o&&u<h;++u)o=hi(t,e,n,s[u],r)}return o}function li(t,e,n,i){var r=n.children,s=null,a=void 0,o=void 0,u=void 0,h=void 0,l=void 0;if(n.contains(t,e.bias))if(null!==r)for(a=0,o=r.length;null===s&&a<o;++a)s=li(t,e,r[a],n);else if(null!==n.points)for(u=n.points,h=n.data,a=0,o=u.length;a<o;++a)if(u[a].equals(t)){l=o-1,s=h[a],a<l&&(u[a]=u[l],h[a]=h[l]),u.pop(),h.pop(),--e.pointCount,null!==i&&ui(i)<=e.maxPoints&&i.merge();break}return s}!function(t){a(e,ii);function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;i(this,e);var u=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return u.root=new si(t,n),u.bias=Math.max(0,r),u.maxPoints=Math.max(1,Math.round(s)),u.maxDepth=Math.max(0,Math.round(a)),u.pointCount=0,u}r(e,[{key:"countPoints",value:function(t){return ui(t)}},{key:"put",value:function(t,e){return hi(t,e,this,this.root,0)}},{key:"remove",value:function(t){return li(t,this,this.root,null)}},{key:"fetch",value:function(t){return function t(e,n,i){var r=i.children,s=null,a=void 0,o=void 0,u=void 0;if(i.contains(e,n.bias))if(null!==r)for(a=0,o=r.length;null===s&&a<o;++a)s=t(e,n,r[a]);else for(a=0,o=(u=i.points).length;null===s&&a<o;++a)e.distanceToSquared(u[a])<=oi&&(s=i.data[a]);return s}(t,this,this.root)}},{key:"move",value:function(t,e){return function t(e,n,i,r,s,a){var o=r.children,u=null,h=void 0,l=void 0,c=void 0;if(r.contains(e,i.bias))if(r.contains(n,i.bias)){if(null!==o)for(++a,h=0,l=o.length;null===u&&h<l;++h)u=t(e,n,i,o[h],r,a);else for(h=0,l=(c=r.points).length;h<l;++h)if(e.distanceToSquared(c[h])<=oi){c[h].copy(n),u=r.data[h];break}}else hi(n,u=li(e,i,r,s),i,s,a-1);return u}(t,e,this,this.root,null,0)}},{key:"findNearestPoint",value:function(t){return function t(e,n,i,r){var s=r.points,a=r.children,o=null,u=n,h=void 0,l=void 0,c=void 0,d=void 0,v=void 0,f=void 0,y=void 0;if(null!==a)for(h=0,l=(v=a.map(function(t){return{octant:t,distance:t.distanceToCenterSquared(e)}}).sort(function(t,e){return t.distance-e.distance})).length;h<l;++h)(f=v[h].octant).contains(e,u)&&null!==(y=t(e,u,i,f))&&(d=y.point.distanceToSquared(e),(!i||d>0)&&d<u&&(u=d,o=y));else if(null!==s)for(h=0,l=s.length;h<l;++h)c=s[h],d=e.distanceToSquared(c),(!i||d>0)&&d<u&&(u=d,o={point:c.clone(),data:r.data[h]});return o}(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,arguments.length>2&&void 0!==arguments[2]&&arguments[2],this.root)}},{key:"findPoints",value:function(t,e){var n=[];return function t(e,n,i,r,s){var a=r.points,o=r.children,u=n*n,h=void 0,l=void 0,c=void 0,d=void 0,v=void 0;if(null!==o)for(h=0,l=o.length;h<l;++h)(v=o[h]).contains(e,n)&&t(e,n,i,v,s);else if(null!==a)for(h=0,l=a.length;h<l;++h)c=a[h],d=e.distanceToSquared(c),(!i||d>0)&&d<=u&&s.push({point:c.clone(),data:r.data[h]})}(t,e,arguments.length>2&&void 0!==arguments[2]&&arguments[2],this.root,n),n}},{key:"raycast",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"raycast",this).call(this,t);return i.length>0&&this.testPoints(i,t,n),n}},{key:"testPoints",value:function(t,e,n){var i=e.params.Points.threshold,r=i*i,s=void 0,a=void 0,o=void 0,u=void 0,h=void 0,l=void 0,c=void 0,d=void 0,v=void 0,f=void 0,y=void 0;for(h=0,c=t.length;h<c;++h)if(null!==(f=(v=t[h]).points))for(l=0,d=f.length;l<d;++l)y=f[l],(u=e.ray.distanceSqToPoint(y))<r&&(s=e.ray.closestPointToPoint(y),(a=e.ray.origin.distanceTo(s))>=e.near&&a<=e.far&&(o=Math.sqrt(u),n.push(new ai(a,o,s,v.data[l]))))}}])}();var ci=new se,di=new ne,vi=new ne,fi=new ne,yi=(function(){function t(){i(this,t)}r(t,null,[{key:"recycleOctants",value:function(t,e){var n=t.min,i=t.getCenter(vi),r=t.getDimensions(fi).multiplyScalar(.5),s=t.children,a=e.length,o=void 0,u=void 0,h=void 0,l=void 0;for(o=0;o<8;++o)for(h=Yn[o],ci.min.addVectors(n,di.fromArray(h).multiply(r)),ci.max.addVectors(i,di.fromArray(h).multiply(r)),u=0;u<a;++u)if(null!==(l=e[u])&&ci.min.equals(l.min)&&ci.max.equals(l.max)){s[o]=l,e[u]=null;break}}}])}(),new ne),mi=new ne,gi=new ne,pi=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ne;i(this,t),this.a=e,this.b=n,this.index=-1,this.coordinates=new ne,this.t=0,this.n=new ne}return r(t,[{key:"approximateZeroCrossing",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=Math.max(1,e-1),i=0,r=1,s=0,a=0,o=void 0,u=void 0;for(yi.subVectors(this.b,this.a);a<=n&&(s=(i+r)/2,mi.addVectors(this.a,gi.copy(yi).multiplyScalar(s)),u=t.sample(mi),!(Math.abs(u)<=1e-4||(r-i)/2<=1e-6));)mi.addVectors(this.a,gi.copy(yi).multiplyScalar(i)),o=t.sample(mi),Math.sign(u)===Math.sign(o)?i=s:r=s,++a;this.t=s}},{key:"computeZeroCrossingPosition",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne).subVectors(this.b,this.a).multiplyScalar(this.t).add(this.a)}},{key:"computeSurfaceNormal",value:function(t){var e=this.computeZeroCrossingPosition(yi),n=t.sample(mi.addVectors(e,gi.set(.001,0,0)))-t.sample(mi.subVectors(e,gi.set(.001,0,0))),i=t.sample(mi.addVectors(e,gi.set(0,.001,0)))-t.sample(mi.subVectors(e,gi.set(0,.001,0))),r=t.sample(mi.addVectors(e,gi.set(0,0,.001)))-t.sample(mi.subVectors(e,gi.set(0,0,.001)));this.n.set(n,i,r).normalize()}}]),t}(),xi=new pi,Ai=new ne,wi=new ne,ki=function(){function t(e,n,r){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3;i(this,t),this.edgeData=e,this.cellPosition=n,this.cellSize=r,this.indices=null,this.zeroCrossings=null,this.normals=null,this.axes=null,this.lengths=null,this.result=new Gn,this.initialC=s,this.c=s,this.initialD=a,this.d=a,this.i=0,this.l=0,this.reset()}return r(t,[{key:"reset",value:function(){var t=this.edgeData,e=[],n=[],i=[],r=[],s=[],a=void 0,o=void 0,u=void 0,h=void 0;for(this.i=0,this.c=0,this.d=0,a=4>>(o=this.initialC),u=this.initialD;o<u;++o,a>>=1)(h=t.indices[o].length)>0&&(e.push(t.indices[o]),n.push(t.zeroCrossings[o]),i.push(t.normals[o]),r.push(Yn[a]),s.push(h),++this.d);return this.l=s.length>0?s[0]:0,this.indices=e,this.zeroCrossings=n,this.normals=i,this.axes=r,this.lengths=s,this.result.reset(),this}},{key:"next",value:function(){var t=this.cellSize,e=Ci.resolution,n=e+1,i=n*n,r=this.result,s=this.cellPosition,a=void 0,o=void 0,u=void 0,h=void 0,l=void 0,c=void 0,d=void 0;return this.i===this.l&&(this.l=++this.c<this.d?this.lengths[this.c]:0,this.i=0),this.i<this.l?(c=this.c,d=this.i,a=this.axes[c],o=this.indices[c][d],xi.index=o,u=o%n,h=Math.trunc(o%i/n),l=Math.trunc(o/i),xi.coordinates.set(u,h,l),Ai.set(u*t/e,h*t/e,l*t/e),wi.set((u+a[0])*t/e,(h+a[1])*t/e,(l+a[2])*t/e),xi.a.addVectors(s,Ai),xi.b.addVectors(s,wi),xi.t=this.zeroCrossings[c][d],xi.n.fromArray(this.normals[c],3*d),r.value=xi,++this.i):(r.value=null,r.done=!0),r}},{key:"return",value:function(t){return this.result.value=t,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),Mi=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;i(this,t),this.indices=e<=0?null:[new Uint32Array(e),new Uint32Array(n),new Uint32Array(r)],this.zeroCrossings=e<=0?null:[new Float32Array(e),new Float32Array(n),new Float32Array(r)],this.normals=e<=0?null:[new Float32Array(3*e),new Float32Array(3*n),new Float32Array(3*r)]}return r(t,[{key:"serialize",value:function(){return{edges:this.edges,zeroCrossings:this.zeroCrossings,normals:this.normals}}},{key:"deserialize",value:function(t){var e=this;return null!==t?(this.edges=t.edges,this.zeroCrossings=t.zeroCrossings,this.normals=t.normals):e=null,e}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=[this.edges[0],this.edges[1],this.edges[2],this.zeroCrossings[0],this.zeroCrossings[1],this.zeroCrossings[2],this.normals[0],this.normals[1],this.normals[2]],n=void 0,i=void 0,r=void 0;for(i=0,r=e.length;i<r;++i)null!==(n=e[i])&&t.push(n.buffer);return t}},{key:"edges",value:function(t,e){return new ki(this,t,e)}},{key:"edgesX",value:function(t,e){return new ki(this,t,e,0,1)}},{key:"edgesY",value:function(t,e){return new ki(this,t,e,1,2)}},{key:"edgesZ",value:function(t,e){return new ki(this,t,e,2,3)}}],[{key:"calculate1DEdgeCount",value:function(t){return Math.pow(t+1,2)*t}}]),t}(),zi=0,Di=0;var Ci=function(){function t(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];i(this,t),this.materials=0,this.materialIndices=e?new Uint8Array(Di):null,this.runLengths=null,this.edgeData=null}return r(t,[{key:"set",value:function(t){return this.materials=t.materials,this.materialIndices=t.materialIndices,this.runLengths=t.runLengths,this.edgeData=t.edgeData,this}},{key:"clear",value:function(){return this.materials=0,this.materialIndices=null,this.runLengths=null,this.edgeData=null,this}},{key:"setMaterialIndex",value:function(t,e){this.materialIndices[t]===kn.AIR?e!==kn.AIR&&++this.materials:e===kn.AIR&&--this.materials,this.materialIndices[t]=e}},{key:"compress",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,e=void 0;return this.compressed?(t.materialIndices=this.materialIndices,t.runLengths=this.runLengths):(e=this.full?new Vn([this.materialIndices.length],[kn.SOLID]):Vn.encode(this.materialIndices),t.materialIndices=new Uint8Array(e.data),t.runLengths=new Uint32Array(e.runLengths)),t.materials=this.materials,t}},{key:"decompress",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return t.materialIndices=this.compressed?Vn.decode(this.runLengths,this.materialIndices,new Uint8Array(Di)):this.materialIndices,t.runLengths=null,t.materials=this.materials,t}},{key:"serialize",value:function(){return{materials:this.materials,materialIndices:this.materialIndices,runLengths:this.runLengths,edgeData:null!==this.edgeData?this.edgeData.serialize():null}}},{key:"deserialize",value:function(t){var e=this;return null!==t?(this.materials=t.materials,this.materialIndices=t.materialIndices,this.runLengths=t.runLengths,null!==t.edgeData?(null===this.edgeData&&(this.edgeData=new Mi),this.edgeData.deserialize(t.edgeData)):this.edgeData=null):e=null,e}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return null!==this.edgeData&&this.edgeData.createTransferList(t),null!==this.materialIndices&&t.push(this.materialIndices.buffer),null!==this.runLengths&&t.push(this.runLengths.buffer),t}},{key:"empty",get:function(){return 0===this.materials}},{key:"full",get:function(){return this.materials===Di}},{key:"compressed",get:function(){return null!==this.runLengths}},{key:"neutered",get:function(){return!this.empty&&null===this.materialIndices}}],[{key:"resolution",get:function(){return zi},set:function(t){zi=Math.max(1,Math.min(256,(e=t,Math.pow(2,Math.max(0,Math.ceil(Math.log2(e)))))));var e;Di=Math.pow(zi+1,3)}}]),t}(),Si=function(){function t(){i(this,t)}return r(t,null,[{key:"parseBin",value:function(t){return parseInt(t,2)}},{key:"createBinaryString",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=t<0?"-":"",i=Math.abs(t).toString(2);i.length<e;)i="0"+i;return n+i}}]),t}(),bi=function(){function t(e,n,r){i(this,t),this.keyDesign=e,this.min=n,this.max=r,this.keyBase=new ne,this.key=new ne,this.limit=new ne,this.result=new Gn,this.reset()}return r(t,[{key:"reset",value:function(){var t=this.keyDesign,e=this.min,n=this.max;return e.x<=n.x&&e.y<=n.y&&e.z<=n.z?(this.keyBase.set(e.x,e.y*t.rangeX,e.z*t.rangeXY),this.limit.set(n.x,n.y*t.rangeX,n.z*t.rangeXY),this.key.copy(this.keyBase)):(this.keyBase.set(1,1,1),this.limit.set(0,0,0),this.key.copy(this.keyBase),console.error("Invalid key range",e,n)),this.result.reset(),this}},{key:"next",value:function(){var t=this.result,e=this.keyDesign,n=this.keyBase,i=this.limit,r=this.key;return r.z<=i.z?(t.value=r.z+r.y+r.x,++r.x,r.x>i.x&&(r.x=n.x,r.y+=e.rangeX,r.y>i.y&&(r.y=n.y,r.z+=e.rangeXY))):(t.value=null,t.done=!0),t}},{key:"return",value:function(t){return this.result.value=t,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),Ei=Math.pow(2,32),Pi=53,Bi=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.round(.4*Pi),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.round(.2*Pi),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;i(this,t),this.x=0,this.y=0,this.z=0,this.rangeX=0,this.rangeY=0,this.rangeZ=0,this.rangeXY=0,this.halfRange=null,this.maskX=[0,0],this.maskY=[0,0],this.maskZ=[0,0],this.set(e,n,r)}return r(t,[{key:"set",value:function(t,e,n){(t+e+n>Pi||t>32||e>32||n>32)&&(console.warn("Invalid bit allotment"),t=Math.round(.4*Pi),e=Math.round(.2*Pi),n=t),this.x=t,this.y=e,this.z=n,this.rangeX=Math.pow(2,t),this.rangeY=Math.pow(2,e),this.rangeZ=Math.pow(2,n),this.rangeXY=Math.pow(2,t+e),this.halfRange=new ne(this.rangeX/2,this.rangeY/2,this.rangeZ/2),this.updateBitMasks()}},{key:"updateBitMasks",value:function(){var t=this.x,e=this.y,n=this.z,i=this.maskX,r=this.maskY,s=this.maskZ,a=32-Math.max(0,t-32),o=32-Math.max(0,e+t-32),u=32-Math.max(0,n+e+t-32);i[1]=a<32?-1>>>a:0,i[0]=-1>>>Math.max(0,32-t),r[1]=((o<32?-1>>>o:0)&~i[1])>>>0,r[0]=(-1>>>Math.max(0,32-(t+e))&~i[0])>>>0,s[1]=((u<32?-1>>>u:0)&~r[1]&~i[1])>>>0,s[0]=(-1>>>Math.max(0,32-(t+e+n))&~r[0]&~i[0])>>>0}},{key:"unpackKey",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ne,n=this.maskX,i=this.maskY,r=this.maskZ,s=Math.trunc(t/Ei),a=t%Ei;return e.set((s&n[1])*Ei+((a&n[0])>>>0),((s&i[1])*Ei+((a&i[0])>>>0))/this.rangeX,((s&r[1])*Ei+((a&r[0])>>>0))/this.rangeXY)}},{key:"packKey",value:function(t){return t.z*this.rangeXY+t.y*this.rangeX+t.x}},{key:"keyRange",value:function(t,e){return new bi(this,t,e)}},{key:"toString",value:function(){var t=this.maskX,e=this.maskY,n=this.maskZ;return"Key Design\n\nX-Bits: "+this.x+"\nY-Bits: "+this.y+"\nZ-Bits: "+this.z+"\n\n"+Si.createBinaryString(t[1],32)+" "+t[1]+" (HI-Mask X)\n"+Si.createBinaryString(t[0],32)+" "+t[0]+" (LO-Mask X)\n\n"+Si.createBinaryString(e[1],32)+" "+e[1]+" (HI-Mask Y)\n"+Si.createBinaryString(e[0],32)+" "+e[0]+" (LO-Mask Y)\n\n"+Si.createBinaryString(n[1],32)+" "+n[1]+" (HI-Mask Z)\n"+Si.createBinaryString(n[0],32)+" "+n[0]+" (LO-Mask Z)\n"}}],[{key:"BITS",get:function(){return Pi}},{key:"HI_BITS",get:function(){return 21}},{key:"LO_BITS",get:function(){return 32}}]),t}(),Ii=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;i(this,t),this.octant=e,this.min=new ne,this.max=new ne}return r(t,[{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne).addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ne).subVectors(this.max,this.min)}},{key:"containsPoint",value:function(t){var e=this.min,n=this.max;return t.x>=e.x&&t.y>=e.y&&t.z>=e.z&&t.x<=n.x&&t.y<=n.y&&t.z<=n.z}}]),t}(),Ti=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;i(this,t),this.world=e,this.lod=n,this.cellSize=0,this.iterator=null,this.octantWrapper=new Ii,this.result=new Gn,this.reset()}return r(t,[{key:"reset",value:function(){var t=this.lod,e=this.world,n=e.getGrid(t);return void 0!==n?(this.cellSize=e.getCellSize(t),this.iterator=n.entries(),this.result.reset()):console.error("Invalid LOD",t),this}},{key:"next",value:function(){var t=this.result,e=this.octantWrapper,n=this.iterator.next(),i=n.value;return n.done?(t.value=null,t.done=!0):(this.keyDesign.unpackKey(i[0],e.min),e.min.multiplyScalar(this.cellSize),e.min.add(this.world.min),e.max.copy(e.min).addScalar(this.cellSize),e.octant=i[1],t.value=e),t}},{key:"return",value:function(t){return this.result.value=t,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),Oi=function t(){i(this,t),this.data=null,this.csg=new An,this.mesh=null},Ui=function(t){a(e,Oi);function e(){i(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.children=0,t}return e}(),Fi=new ne,Li=new ne,Ri=new se,Vi=new se,Gi=[];function Qi(t,e,n,i,r,s,a){var o=void 0,u=void 0,h=void 0,l=void 0,c=void 0,d=void 0;if(n.csg.add(e),a>0)for(--a,o=t.getGrid(a),u=t.getKeyDesign(),h=n.children,l=Gi[a],i<<=1,r<<=1,s<<=1,d=0;d<8;++d)0!=(h&1<<d)&&(c=Yn[d],Fi.set(i+c[0],r+c[1],s+c[2]),l.containsPoint(Fi)&&Qi(t,e,o.get(u.packKey(Fi)),Fi.x,Fi.y,Fi.z,a))}var Ni=function(){function t(){i(this,t)}return r(t,null,[{key:"applyUnion",value:function(t,e,n){var i=t.getKeyDesign(),r=t.lodZero,s=Ri.min,a=Ri.max,o=Vi.min,u=Vi.max,h=Vi,l=void 0,c=void 0,d=void 0,v=void 0,f=void 0,y=void 0;for(f=t.getDepth();f>0;--f){d=t.getGrid(f),t.calculateKeyCoordinates(e.min,f,s),t.calculateKeyCoordinates(e.max,f,a),t.calculateKeyCoordinates(e.min,f-1,o),t.calculateKeyCoordinates(e.max,f-1,u);var m=!0,g=!1,p=void 0;try{for(var x,A=i.keyRange(s,a)[Symbol.iterator]();!(m=(x=A.next()).done);m=!0)if(l=x.value,!d.has(l))for((v=new Ui).csg.add(n),d.set(l,v),i.unpackKey(l,Li),Li.x<<=1,Li.y<<=1,Li.z<<=1,y=0;y<8;++y)c=Yn[y],Fi.set(Li.x+c[0],Li.y+c[1],Li.z+c[2]),h.containsPoint(Fi)&&(v.children|=1<<y)}catch(t){g=!0,p=t}finally{try{!m&&A.return&&A.return()}finally{if(g)throw p}}}t.calculateKeyCoordinates(e.min,0,s),t.calculateKeyCoordinates(e.max,0,a);var w=!0,k=!1,M=void 0;try{for(var z,D=i.keyRange(s,a)[Symbol.iterator]();!(w=(z=D.next()).done);w=!0)l=z.value,r.has(l)?v=r.get(l):(v=new Oi,r.set(l,v)),v.csg.add(n)}catch(t){k=!0,M=t}finally{try{!w&&D.return&&D.return()}finally{if(k)throw M}}}},{key:"applyDifference",value:function(t,e,n){var i=t.getDepth(),r=t.getKeyDesign(),s=t.getGrid(i),a=t.calculateKeyCoordinates(e.min,i,Ri.min),o=t.calculateKeyCoordinates(e.max,i,Ri.max),u=void 0,h=void 0,l=void 0,c=void 0;for(u=0,h=i-1;u<h;++u)u<Gi.length?(l=Gi[u],t.calculateKeyCoordinates(e.min,u,l.min),t.calculateKeyCoordinates(e.max,u,l.max)):Gi.push(new se(t.calculateKeyCoordinates(e.min,u),t.calculateKeyCoordinates(e.max,u)));var d=!0,v=!1,f=void 0;try{for(var y,m=r.keyRange(a,o)[Symbol.iterator]();!(d=(y=m.next()).done);d=!0)c=y.value,s.has(c)&&(r.unpackKey(c,Li),Qi(t,n,s.get(c),Li.x,Li.y,Li.z,i))}catch(t){v=!0,f=t}finally{try{!d&&m.return&&m.return()}finally{if(v)throw f}}}},{key:"applyIntersection",value:function(t,e){var n=void 0;for(n=t.getDepth();n>=0;--n){var i=!0,r=!1,s=void 0;try{for(var a,o=t.getGrid(n).values()[Symbol.iterator]();!(i=(a=o.next()).done);i=!0)a.value.csg.add(e)}catch(t){r=!0,s=t}finally{try{!i&&o.return&&o.return()}finally{if(r)throw s}}}}},{key:"applyCSG",value:function(t,e){var n=e.getBoundingBox(!0);switch(n.min.max(t.min),n.max.min(t.max),e.operation){case wn.UNION:this.applyUnion(t,n,e);break;case wn.DIFFERENCE:this.applyDifference(t,n,e);break;case wn.INTERSECTION:this.applyIntersection(t,e);break;default:console.error("No CSG operation type specified",e)}}}]),t}(),Yi=new ne,Hi=new Be,qi=new se,ji=new se,Xi=new Le,Wi=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],Ki=0;function Ji(t,e,n,i){var r=void 0,s=0;return e<n?(r=e,s=0):(r=n,s=1),i<r&&(s=2),Wi[t][s]}function Zi(t,e,n,i,r){var s=qi.min.set(0,0,0),a=qi.max.subVectors(e.max,e.min),o=e.getDimensions(ji.min),u=ji.max.copy(o).multiplyScalar(.5),h=Xi.origin.copy(i.origin),l=Xi.direction.copy(i.direction),c=void 0,d=void 0,v=void 0,f=void 0,y=void 0,m=void 0,g=void 0,p=void 0,x=void 0;h.sub(e.getCenter(Yi)).add(u),Ki=0,l.x<0&&(h.x=o.x-h.x,l.x=-l.x,Ki|=4),l.y<0&&(h.y=o.y-h.y,l.y=-l.y,Ki|=2),l.z<0&&(h.z=o.z-h.z,l.z=-l.z,Ki|=1),c=1/l.x,d=1/l.y,v=1/l.z,f=(s.x-h.x)*c,y=(a.x-h.x)*c,m=(s.y-h.y)*d,g=(a.y-h.y)*d,p=(s.z-h.z)*v,x=(a.z-h.z)*v,function t(e,n,i,r,s,a,o,u,h,l,c,d,v){var f=void 0,y=void 0,m=void 0,g=void 0,p=void 0,x=void 0,A=void 0,w=void 0,k=void 0;if(l>=0&&c>=0&&d>=0)if(0===a||null!==n.mesh)v.push(n);else if(n.children>0){f=e.getGrid(--a),y=e.getKeyDesign(),m=n.children,i<<=1,r<<=1,s<<=1,p=function(t,e,n,i,r,s){var a=0;return t>e&&t>n?(r<t&&(a|=2),s<t&&(a|=1)):e>n?(i<e&&(a|=4),s<e&&(a|=1)):(i<n&&(a|=4),r<n&&(a|=2)),a}(o,u,h,x=.5*(o+l),A=.5*(u+c),w=.5*(h+d));do{switch(k=Ki^p,p){case 0:0!=(m&1<<k)&&(g=Yn[k],Yi.set(i+g[0],r+g[1],s+g[2]),t(e,f.get(y.packKey(Yi)),Yi.x,Yi.y,Yi.z,a,o,u,h,x,A,w,v)),p=Ji(p,x,A,w);break;case 1:0!=(m&1<<k)&&(g=Yn[k],Yi.set(i+g[0],r+g[1],s+g[2]),t(e,f.get(y.packKey(Yi)),Yi.x,Yi.y,Yi.z,a,o,u,w,x,A,d,v)),p=Ji(p,x,A,d);break;case 2:0!=(m&1<<k)&&(g=Yn[k],Yi.set(i+g[0],r+g[1],s+g[2]),t(e,f.get(y.packKey(Yi)),Yi.x,Yi.y,Yi.z,a,o,A,h,x,c,w,v)),p=Ji(p,x,c,w);break;case 3:0!=(m&1<<k)&&(g=Yn[k],Yi.set(i+g[0],r+g[1],s+g[2]),t(e,f.get(y.packKey(Yi)),Yi.x,Yi.y,Yi.z,a,o,A,w,x,c,d,v)),p=Ji(p,x,c,d);break;case 4:0!=(m&1<<k)&&(g=Yn[k],Yi.set(i+g[0],r+g[1],s+g[2]),t(e,f.get(y.packKey(Yi)),Yi.x,Yi.y,Yi.z,a,x,u,h,l,A,w,v)),p=Ji(p,l,A,w);break;case 5:0!=(m&1<<k)&&(g=Yn[k],Yi.set(i+g[0],r+g[1],s+g[2]),t(e,f.get(y.packKey(Yi)),Yi.x,Yi.y,Yi.z,a,x,u,w,l,A,d,v)),p=Ji(p,l,A,d);break;case 6:0!=(m&1<<k)&&(g=Yn[k],Yi.set(i+g[0],r+g[1],s+g[2]),t(e,f.get(y.packKey(Yi)),Yi.x,Yi.y,Yi.z,a,x,A,h,l,c,w,v)),p=Ji(p,l,c,w);break;case 7:0!=(m&1<<k)&&(g=Yn[k],Yi.set(i+g[0],r+g[1],s+g[2]),t(e,f.get(y.packKey(Yi)),Yi.x,Yi.y,Yi.z,a,x,A,w,l,c,d,v)),p=8}}while(p<8)}}(t,e.octant,n.x,n.y,n.z,t.getDepth(),f,m,p,y,g,x,r)}var _i=function(){function t(){i(this,t)}return r(t,null,[{key:"intersectWorldOctree",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=t.getDepth(),r=t.getGrid(i),s=t.getCellSize(i),a=t.getKeyDesign(),o=new Ii,u=Hi.start,h=Hi.end,l=t.containsPoint(Xi.copy(e).origin)?Xi.origin:Xi.intersectBox(t,Xi.origin),c=void 0,d=void 0,v=void 0,f=void 0,y=void 0,m=void 0,g=void 0,p=void 0,x=void 0,A=void 0,w=void 0,k=void 0,M=void 0,z=void 0,D=void 0,C=void 0,S=void 0,b=void 0,E=void 0,P=void 0;if(null!==l)for(v=s<<1,f=Xi.at(v,Yi),t.calculateKeyCoordinates(l,i,u),t.calculateKeyCoordinates(f,i,h),m=h.x-u.x,g=h.y-u.y,p=h.z-u.z,D=Math.sign(m),C=Math.sign(g),S=Math.sign(p),k=2*(x=Math.abs(m)),M=2*(A=Math.abs(g)),z=2*(w=Math.abs(p)),b=A-x,E=w-x,P=A-w,y=x+A+w;y>0;--y)c=a.packKey(u),r.has(c)&&(null===(d=r.get(c)).mesh?(o.octant=d,o.min.copy(u),o.min.multiplyScalar(s),o.min.add(t.min),o.max.copy(o.min).addScalar(s),Zi(t,o,u,e,n)):n.push(d)),b<0?E<0?(u.x+=D,b+=M,E+=z):(u.z+=S,E-=k,P+=M):P<0?(u.z+=S,E-=k,P+=M):(u.y+=C,b-=k,P-=z);return n}}]),t}(),$i=new ne;var tr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Bi;for(i(this,t),n=Math.max(Math.min(Math.trunc(n),32),1),this.cellSize=Math.max(Math.min(Math.trunc(e),Math.pow(2,33-n)-1),1),this.keyDesign=r,this.grids=[];this.grids.length<n;)this.grids.push(new Map);this.bounds=new Ii,this.bounds.min.copy(this.keyDesign.halfRange).multiplyScalar(-this.cellSize),this.bounds.max.copy(this.keyDesign.halfRange).multiplyScalar(this.cellSize)}return r(t,[{key:"getKeyDesign",value:function(){return this.keyDesign}},{key:"getCellSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.cellSize<<t>>>0}},{key:"getCenter",value:function(t){return this.bounds.getCenter(t)}},{key:"setCenter",value:function(t){this.min.copy(this.keyDesign.halfRange).multiplyScalar(-this.cellSize).add(t),this.max.copy(this.keyDesign.halfRange).multiplyScalar(this.cellSize).add(t)}},{key:"getDimensions",value:function(t){return this.bounds.getDimensions(t)}},{key:"getDepth",value:function(){return this.grids.length-1}},{key:"getGrid",value:function(t){return t>=0&&t<this.grids.length?this.grids[t]:void 0}},{key:"clear",value:function(){var t=void 0,e=void 0;for(t=0,e=this.grids.length;t<e;++t)this.grids[t].clear()}},{key:"containsPoint",value:function(t){return this.bounds.containsPoint(t)}},{key:"findOctantsByLevel",value:function(t){return this.octants(t)}},{key:"calculateKeyCoordinates",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ne,i=this.cellSize<<e;return $i.subVectors(t,this.min),n.set(Math.trunc($i.x/i),Math.trunc($i.y/i),Math.trunc($i.z/i)),n}},{key:"getOctantByPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.keyDesign,i=this.getGrid(e),r=void 0;return void 0!==i?this.containsPoint(t)?(this.calculateKeyCoordinates(t,e,$i),r=i.get(n.packKey($i))):console.error("Position out of range",t):console.error("Invalid LOD",e),r}},{key:"removeOctant",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.keyDesign,i=this.getGrid(e),r=void 0,s=void 0,a=void 0;void 0!==i?i.has(t)?(n.unpackKey(t,$i),r=$i.x,s=$i.y,a=$i.z,function t(e,n,i,r,s,a){var o=void 0,u=void 0,h=void 0,l=void 0,c=void 0,d=void 0,v=void 0;if(a>0){for(--a,o=e.getGrid(a),u=e.getKeyDesign(),h=n.children,i<<=1,r<<=1,s<<=1,v=0;v<8;++v)0!=(h&1<<v)&&(c=Yn[v],$i.set(i+c[0],r+c[1],s+c[2]),d=u.packKey($i),l=o.get(d),o.delete(d),t(e,l,$i.x,$i.y,$i.z,a));n.children=0}}(this,i.get(t),r,s,a,e),i.delete(t),function t(e,n,i,r,s){var a=void 0,o=void 0,u=void 0,h=void 0;++s<e.levels&&(a=e.getGrid(s),o=tr.calculateOffsetIndex(n,i,r),$i.set(n>>>1,i>>>1,r>>>1),u=e.getKeyDesign().packKey($i),(h=a.get(u)).children&=~(1<<o),0===h.children&&(a.delete(u),t(e,$i.x,$i.y,$i.z,s)))}(this,r,s,a,e)):console.error("No octant found",t):console.error("Invalid LOD",e)}},{key:"applyCSG",value:function(t){Ni.applyCSG(this,t)}},{key:"raycast",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return _i.intersectWorldOctree(this,t,e)}},{key:"octants",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Ti(this,t)}},{key:"min",get:function(){return this.bounds.min}},{key:"max",get:function(){return this.bounds.max}},{key:"levels",get:function(){return this.grids.length}},{key:"lodZero",get:function(){return this.grids[0]}}],[{key:"calculateOffsetIndex",value:function(t,e,n){return((1&t)<<2)+((1&e)<<1)+(1&n)}}]),t}(),er=function(){function t(e){i(this,t)}return r(t,[{key:"clone",value:function(){return new this.constructor(this.levels)}},{key:"levels",get:function(){return this.something.length}}]),t}(),nr=function(t){a(e,Kt);function e(t){i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.lod=-1,n.left=null,n.entered=null,n.error=null,n}return e}(),ir=(new nr("update"),new nr("error"),new se,new be),rr=new Ue,sr=function(t){a(e,Jt);function e(t){i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.world=t,n.position=new ne(1/0,1/0,1/0),n.currentScene=new er(n.world.levels),n.previousScene=n.currentScene.clone(),n.nextScene=n.currentScene.clone(),n}return r(e,[{key:"update",value:function(t){this.position.copy(t.position),ir.setFromMatrix(rr.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse))}},{key:"process",value:function(){}},{key:"clear",value:function(){this.previousScene.clear(),this.currentScene.clear(),this.nextScene.clear()}}]),e}(),ar={EXTRACT:"worker.extract",MODIFY:"worker.modify",CONFIGURE:"worker.config",CLOSE:"worker.close"},or=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;i(this,t),this.action=e,this.error=null},ur=function(t){a(e,or);function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.data=null,n}return e}(),hr=(function(t){a(e,ur);function e(){return i(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,ar.EXTRACT))}}(),function(t){a(e,ur);function e(){i(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,ar.MODIFY));return t.sdf=null,t.cellSize=0,t.cellPosition=null,t}}(),function(t){a(e,or);function e(){i(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,ar.CONFIGURE));return t.resolution=Ci.resolution,t.errorThreshold=.01,t}return e}()),lr=function(t){a(e,ur);function e(){i(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,ar.EXTRACT));return t.isosurface=null,t}return e}(),cr=function(t){a(e,ur);function e(){i(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,ar.MODIFY));return t.sdf=null,t}return e}(),dr=new(function(t){a(e,Kt);function e(t){i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.worker=null,n.response=null,n}return e}())("message"),vr='!function(){"use strict";var t=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},i=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}(),e=function t(i,e,n){null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,e);if(void 0===s){var r=Object.getPrototypeOf(i);return null===r?void 0:t(r,e,n)}if("value"in s)return s.value;var a=s.get;if(void 0!==a)return a.call(n)},n=function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)},s=function(t,i){if(!t)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i},r=function(t){if(Array.isArray(t)){for(var i=0,e=Array(t.length);i<t.length;i++)e[i]=t[i];return e}return Array.from(t)},a=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t(this,e),this.runLengths=i,this.data=n}return i(e,null,[{key:"encode",value:function(t){var i=[],n=[],s=t[0],r=1,a=void 0,o=void 0;for(a=1,o=t.length;a<o;++a)s!==t[a]?(i.push(r),n.push(s),s=t[a],r=1):++r;return i.push(r),n.push(s),new e(i,n)}},{key:"decode",value:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=void 0,s=void 0,r=void 0,a=void 0,o=void 0,h=0;for(s=0,a=i.length;s<a;++s)for(n=i[s],r=0,o=t[s];r<o;++r)e[h++]=n;return e}}]),e}(),o=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.x=i,this.y=n,this.z=s}return i(e,[{key:"set",value:function(t,i,e){return this.x=t,this.y=i,this.z=e,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}},{key:"setFromSpherical",value:function(t){var i=Math.sin(t.phi)*t.radius;return this.x=i*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=i*Math.cos(t.theta),this}},{key:"setFromCylindrical",value:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this}},{key:"setFromMatrixColumn",value:function(t,i){return this.fromArray(t.elements,4*i)}},{key:"setFromMatrixPosition",value:function(t){var i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}},{key:"setFromMatrixScale",value:function(t){var i=this.setFromMatrixColumn(t,0).length(),e=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=e,this.z=n,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}},{key:"addScaledVector",value:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"multiplyVectors",value:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this.z/=t,this}},{key:"crossVectors",value:function(t,i){var e=t.x,n=t.y,s=t.z,r=i.x,a=i.y,o=i.z;return this.x=n*o-s*a,this.y=s*r-e*o,this.z=e*a-n*r,this}},{key:"cross",value:function(t){return this.crossVectors(this,t)}},{key:"transformDirection",value:function(t){var i=this.x,e=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[4]*e+s[8]*n,this.y=s[1]*i+s[5]*e+s[9]*n,this.z=s[2]*i+s[6]*e+s[10]*n,this.normalize()}},{key:"applyMatrix3",value:function(t){var i=this.x,e=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[3]*e+s[6]*n,this.y=s[1]*i+s[4]*e+s[7]*n,this.z=s[2]*i+s[5]*e+s[8]*n,this}},{key:"applyMatrix4",value:function(t){var i=this.x,e=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[4]*e+s[8]*n+s[12],this.y=s[1]*i+s[5]*e+s[9]*n+s[13],this.z=s[2]*i+s[6]*e+s[10]*n+s[14],this}},{key:"applyQuaternion",value:function(t){var i=this.x,e=this.y,n=this.z,s=t.x,r=t.y,a=t.z,o=t.w,h=o*i+r*n-a*e,u=o*e+a*i-s*n,l=o*n+s*e-r*i,c=-s*i-r*e-a*n;return this.x=h*o+c*-s+u*-a-l*-r,this.y=u*o+c*-r+l*-s-h*-a,this.z=l*o+c*-a+h*-r-u*-s,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"reflect",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e;var i=t.x,n=t.y,s=t.z;return this.sub(t.multiplyScalar(2*this.dot(t))),t.set(i,n,s),this}},{key:"angleTo",value:function(t){var i=this.dot(t)/Math.sqrt(this.lengthSquared()*t.lengthSquared());return Math.acos(Math.min(Math.max(i,-1),1))}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}},{key:"distanceToSquared",value:function(t){var i=this.x-t.x,e=this.y-t.y,n=this.z-t.z;return i*i+e*e+n*n}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clamp",value:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"lerp",value:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}},{key:"lerpVectors",value:function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}}]),e}(),h=new o,u=[new o,new o,new o,new o,new o,new o,new o,new o],l=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o(1/0,1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o(-1/0,-1/0,-1/0);t(this,e),this.min=i,this.max=n}return i(e,[{key:"set",value:function(t,i){return this.min.copy(t),this.max.copy(i),this}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new y;return this.getCenter(t.center),t.radius=.5*this.getSize(h).length(),t}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"setFromPoints",value:function(t){var i=void 0,e=void 0;for(this.min.set(0,0,0),this.max.set(0,0,0),i=0,e=t.length;i<e;++i)this.expandByPoint(t[i]);return this}},{key:"setFromCenterAndSize",value:function(t,i){var e=h.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(e),this.max.copy(t).add(e),this}},{key:"clampPoint",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o).copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return h.copy(t).clamp(this.min,this.max).sub(t).length()}},{key:"applyMatrix4",value:function(t){var i=this.min,e=this.max;return this.isEmpty()||(u[0].set(i.x,i.y,i.z).applyMatrix4(t),u[1].set(i.x,i.y,e.z).applyMatrix4(t),u[2].set(i.x,e.y,i.z).applyMatrix4(t),u[3].set(i.x,e.y,e.z).applyMatrix4(t),u[4].set(e.x,i.y,i.z).applyMatrix4(t),u[5].set(e.x,i.y,e.z).applyMatrix4(t),u[6].set(e.x,e.y,i.z).applyMatrix4(t),u[7].set(e.x,e.y,e.z).applyMatrix4(t),this.setFromPoints(u)),this}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"containsPoint",value:function(t){var i=this.min,e=this.max;return t.x>=i.x&&t.y>=i.y&&t.z>=i.z&&t.x<=e.x&&t.y<=e.y&&t.z<=e.z}},{key:"containsBox",value:function(t){var i=this.min,e=this.max,n=t.min,s=t.max;return i.x<=n.x&&s.x<=e.x&&i.y<=n.y&&s.y<=e.y&&i.z<=n.z&&s.z<=e.z}},{key:"intersectsBox",value:function(t){var i=this.min,e=this.max,n=t.min,s=t.max;return s.x>=i.x&&s.y>=i.y&&s.z>=i.z&&n.x<=e.x&&n.y<=e.y&&n.z<=e.z}},{key:"intersectsSphere",value:function(t){return this.clampPoint(t.center,h).distanceToSquared(t.center)<=t.radius*t.radius}},{key:"intersectsPlane",value:function(t){var i=void 0,e=void 0;return t.normal.x>0?(i=t.normal.x*this.min.x,e=t.normal.x*this.max.x):(i=t.normal.x*this.max.x,e=t.normal.x*this.min.x),t.normal.y>0?(i+=t.normal.y*this.min.y,e+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,e+=t.normal.y*this.min.y),t.normal.z>0?(i+=t.normal.z*this.min.z,e+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,e+=t.normal.z*this.min.z),i<=t.constant&&e>=t.constant}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}]),e}(),c=new l,y=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.center=i,this.radius=n}return i(e,[{key:"set",value:function(t,i){return this.center.copy(t),this.radius=i,this}},{key:"copy",value:function(t){return this.center.copy(t.center),this.radius=t.radius,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromPoints",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.setFromPoints(t).getCenter(this.center),e=0,n=void 0,s=void 0;for(n=0,s=t.length;n<s;++n)e=Math.max(e,i.distanceToSquared(t[n]));return this.radius=Math.sqrt(e),this}},{key:"getBoundingBox",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new l;return t.set(this.center,this.center),t.expandByScalar(this.radius),t}},{key:"isEmpty",value:function(){return this.radius<=0}},{key:"translate",value:function(t){return this.center.add(t),this}},{key:"clampPoint",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o,e=this.center.distanceToSquared(t);return i.copy(t),e>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}},{key:"distanceToPoint",value:function(t){return t.distanceTo(this.center)-this.radius}},{key:"containsPoint",value:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"intersectsSphere",value:function(t){var i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i}},{key:"intersectsBox",value:function(t){return t.intersectsSphere(this)}},{key:"intersectsPlane",value:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}},{key:"equals",value:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}]),e}(),v=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.x=i,this.y=n}return i(e,[{key:"set",value:function(t,i){return this.x=t,this.y=i,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[i],this.y=t[i+1],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.x,t[i+1]=this.y,t}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this}},{key:"addVectors",value:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}},{key:"addScaledVector",value:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this}},{key:"subVectors",value:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this}},{key:"applyMatrix3",value:function(t){var i=this.x,e=this.y,n=t.elements;return this.x=n[0]*i+n[3]*e+n[6],this.y=n[1]*i+n[4]*e+n[7],this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}},{key:"distanceToSquared",value:function(t){var i=this.x-t.x,e=this.y-t.y;return i*i+e*e}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}},{key:"clamp",value:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"angle",value:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t}},{key:"lerp",value:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}},{key:"lerpVectors",value:function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t)}},{key:"rotateAround",value:function(t,i){var e=Math.cos(i),n=Math.sin(i),s=this.x-t.x,r=this.y-t.y;return this.x=s*e-r*n+t.x,this.y=s*n+r*e+t.y,this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y}},{key:"width",get:function(){return this.x},set:function(t){return this.x=t}},{key:"height",get:function(){return this.y},set:function(t){return this.y=t}}]),e}(),d=new v,f=(function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new v(1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new v(-1/0,-1/0);t(this,e),this.min=i,this.max=n}i(e,[{key:"set",value:function(t,i){return this.min.copy(t),this.max.copy(i),this}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new v;return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new v;return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new y;return this.getCenter(t.center),t.radius=.5*this.getSize(d).length(),t}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"setFromPoints",value:function(t){var i=void 0,e=void 0;for(this.min.set(0,0),this.max.set(0,0),i=0,e=t.length;i<e;++i)this.expandByPoint(t[i]);return this}},{key:"setFromCenterAndSize",value:function(t,i){var e=d.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(e),this.max.copy(t).add(e),this}},{key:"clampPoint",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new v).copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return d.copy(t).clamp(this.min,this.max).sub(t).length()}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"containsPoint",value:function(t){var i=this.min,e=this.max;return t.x>=i.x&&t.y>=i.y&&t.x<=e.x&&t.y<=e.y}},{key:"containsBox",value:function(t){var i=this.min,e=this.max,n=t.min,s=t.max;return i.x<=n.x&&s.x<=e.x&&i.y<=n.y&&s.y<=e.y}},{key:"intersectsBox",value:function(t){var i=this.min,e=this.max,n=t.min,s=t.max;return s.x>=i.x&&s.y>=i.y&&n.x<=e.x&&n.y<=e.y}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}])}(),function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.radius=i,this.theta=n,this.y=s}i(e,[{key:"set",value:function(t,i,e){return this.radius=t,this.theta=i,this.y=e,this}},{key:"copy",value:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromVector3",value:function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this}}])}(),function(){function e(){t(this,e),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return i(e,[{key:"set",value:function(t,i,e,n,s,r,a,o,h){var u=this.elements;return u[0]=t,u[3]=i,u[6]=e,u[1]=n,u[4]=s,u[7]=r,u[2]=a,u[5]=o,u[8]=h,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(t){var i=t.elements,e=this.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=this.elements,n=void 0;for(n=0;n<9;++n)e[n]=t[n+i];return this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=this.elements,n=void 0;for(n=0;n<9;++n)t[n+i]=e[n];return t}},{key:"multiplyMatrices",value:function(t,i){var e=t.elements,n=i.elements,s=this.elements,r=e[0],a=e[3],o=e[6],h=e[1],u=e[4],l=e[7],c=e[2],y=e[5],v=e[8],d=n[0],f=n[3],m=n[6],x=n[1],p=n[4],k=n[7],g=n[2],w=n[5],z=n[8];return s[0]=r*d+a*x+o*g,s[3]=r*f+a*p+o*w,s[6]=r*m+a*k+o*z,s[1]=h*d+u*x+l*g,s[4]=h*f+u*p+l*w,s[7]=h*m+u*k+l*z,s[2]=c*d+y*x+v*g,s[5]=c*f+y*p+v*w,s[8]=c*m+y*k+v*z,this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyScalar",value:function(t){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this}},{key:"determinant",value:function(){var t=this.elements,i=t[0],e=t[1],n=t[2],s=t[3],r=t[4],a=t[5],o=t[6],h=t[7],u=t[8];return i*r*u-i*a*h-e*s*u+e*a*o+n*s*h-n*r*o}},{key:"getInverse",value:function(t){var i=t.elements,e=this.elements,n=i[0],s=i[1],r=i[2],a=i[3],o=i[4],h=i[5],u=i[6],l=i[7],c=i[8],y=c*o-h*l,v=h*u-c*a,d=l*a-o*u,f=n*y+s*v+r*d,m=void 0;return 0!==f?(m=1/f,e[0]=y*m,e[1]=(r*l-c*s)*m,e[2]=(h*s-r*o)*m,e[3]=v*m,e[4]=(c*n-r*u)*m,e[5]=(r*a-h*n)*m,e[6]=d*m,e[7]=(s*u-l*n)*m,e[8]=(o*n-s*a)*m):(console.error("Can\'t invert matrix, determinant is zero",t),this.identity()),this}},{key:"transpose",value:function(){var t=this.elements,i=void 0;return i=t[1],t[1]=t[3],t[3]=i,i=t[2],t[2]=t[6],t[6]=i,i=t[5],t[5]=t[7],t[7]=i,this}},{key:"scale",value:function(t,i){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=i,e[4]*=i,e[7]*=i,this}},{key:"rotate",value:function(t){var i=Math.cos(t),e=Math.sin(t),n=this.elements,s=n[0],r=n[3],a=n[6],o=n[1],h=n[4],u=n[7];return n[0]=i*s+e*o,n[3]=i*r+e*h,n[6]=i*a+e*u,n[1]=-e*s+i*o,n[4]=-e*r+i*h,n[7]=-e*a+i*u,this}},{key:"translate",value:function(t,i){var e=this.elements;return e[0]+=t*e[2],e[3]+=t*e[5],e[6]+=t*e[8],e[1]+=i*e[2],e[4]+=i*e[5],e[7]+=i*e[8],this}},{key:"equals",value:function(t){var i=this.elements,e=t.elements,n=!0,s=void 0;for(s=0;n&&s<9;++s)i[s]!==e[s]&&(n=!1);return n}}]),e}()),m=0,x=1,p=2,k=3,g=4,w=5,z=new o,M=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t(this,e),this.x=i,this.y=n,this.z=s,this.w=r}return i(e,[{key:"set",value:function(t,i,e,n){return this.x=t,this.y=i,this.z=e,this.w=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}},{key:"setFromEuler",value:function(t){var i=t.x,e=t.y,n=t.z,s=Math.cos,r=Math.sin,a=s(i/2),o=s(e/2),h=s(n/2),u=r(i/2),l=r(e/2),c=r(n/2);switch(t.order){case m:this.x=u*o*h+a*l*c,this.y=a*l*h-u*o*c,this.z=a*o*c+u*l*h,this.w=a*o*h-u*l*c;break;case g:this.x=u*o*h+a*l*c,this.y=a*l*h-u*o*c,this.z=a*o*c-u*l*h,this.w=a*o*h+u*l*c;break;case p:this.x=u*o*h-a*l*c,this.y=a*l*h+u*o*c,this.z=a*o*c+u*l*h,this.w=a*o*h-u*l*c;break;case w:this.x=u*o*h-a*l*c,this.y=a*l*h+u*o*c,this.z=a*o*c-u*l*h,this.w=a*o*h+u*l*c;break;case x:this.x=u*o*h+a*l*c,this.y=a*l*h+u*o*c,this.z=a*o*c-u*l*h,this.w=a*o*h-u*l*c;break;case k:this.x=u*o*h-a*l*c,this.y=a*l*h-u*o*c,this.z=a*o*c+u*l*h,this.w=a*o*h+u*l*c}return this}},{key:"setFromAxisAngle",value:function(t,i){var e=i/2,n=Math.sin(e);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(e),this}},{key:"setFromRotationMatrix",value:function(t){var i=t.elements,e=i[0],n=i[4],s=i[8],r=i[1],a=i[5],o=i[9],h=i[2],u=i[6],l=i[10],c=e+a+l,y=void 0;return c>0?(y=.5/Math.sqrt(c+1),this.w=.25/y,this.x=(u-o)*y,this.y=(s-h)*y,this.z=(r-n)*y):e>a&&e>l?(y=2*Math.sqrt(1+e-a-l),this.w=(u-o)/y,this.x=.25*y,this.y=(n+r)/y,this.z=(s+h)/y):a>l?(y=2*Math.sqrt(1+a-e-l),this.w=(s-h)/y,this.x=(n+r)/y,this.y=.25*y,this.z=(o+u)/y):(y=2*Math.sqrt(1+l-e-a),this.w=(r-n)/y,this.x=(s+h)/y,this.y=(o+u)/y,this.z=.25*y),this}},{key:"setFromUnitVectors",value:function(t,i){var e=t.dot(i)+1;return e<1e-6?(e=0,Math.abs(t.x)>Math.abs(t.z)?z.set(-t.y,t.x,0):z.set(0,-t.z,t.y)):z.crossVectors(t,i),this.x=z.x,this.y=z.y,this.z=z.z,this.w=e,this.normalize()}},{key:"invert",value:function(){return this.conjugate().normalize()}},{key:"conjugate",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"normalize",value:function(){var t=this.length(),i=void 0;return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(i=1/t,this.x=this.x*i,this.y=this.y*i,this.z=this.z*i,this.w=this.w*i),this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"multiplyQuaternions",value:function(t,i){var e=t.x,n=t.y,s=t.z,r=t.w,a=i.x,o=i.y,h=i.z,u=i.w;return this.x=e*u+r*a+n*h-s*o,this.y=n*u+r*o+s*a-e*h,this.z=s*u+r*h+e*o-n*a,this.w=r*u-e*a-n*o-s*h,this}},{key:"multiply",value:function(t){return this.multiplyQuaternions(this,t)}},{key:"premultiply",value:function(t){return this.multiplyQuaternions(t,this)}},{key:"slerp",value:function(t,i){var e=this.x,n=this.y,s=this.z,r=this.w,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0;if(1===i)this.copy(t);else if(i>0){if((a=r*t.w+e*t.x+n*t.y+s*t.z)<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,a=-a):this.copy(t),a>=1)return this.w=r,this.x=e,this.y=n,this.z=s,this;if(o=Math.sqrt(1-a*a),Math.abs(o)<.001)return this.w=.5*(r+this.w),this.x=.5*(e+this.x),this.y=.5*(n+this.y),this.z=.5*(s+this.z),this;h=Math.atan2(o,a),u=Math.sin((1-i)*h)/o,l=Math.sin(i*h)/o,this.w=r*u+this.w*l,this.x=e*u+this.x*l,this.y=n*u+this.y*l,this.z=s*u+this.z*l}return this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}}],[{key:"slerp",value:function(t,i,e,n){return e.copy(t).slerp(i,n)}},{key:"slerpFlat",value:function(t,i,e,n,s,r,a){var o=s[r],h=s[r+1],u=s[r+2],l=s[r+3],c=e[n],y=e[n+1],v=e[n+2],d=e[n+3],f=void 0,m=void 0,x=void 0,p=void 0,k=void 0,g=void 0,w=void 0,z=void 0;d===l&&c===o&&y===h&&v===u||(f=1-a,g=(p=c*o+y*h+v*u+d*l)>=0?1:-1,(k=1-p*p)>Number.EPSILON&&(x=Math.sqrt(k),w=Math.atan2(x,p*g),f=Math.sin(f*w)/x,a=Math.sin(a*w)/x),c=c*f+o*(z=a*g),y=y*f+h*z,v=v*f+u*z,d=d*f+l*z,f===1-a&&(c*=m=1/Math.sqrt(c*c+y*y+v*v+d*d),y*=m,v*=m,d*=m)),t[i]=c,t[i+1]=y,t[i+2]=v,t[i+3]=d}}]),e}();function b(t,i,e){return Math.max(Math.min(t,e),i)}var A=new f,S=new M,P=(function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.x=i,this.y=n,this.z=s,this.order=e.defaultOrder}i(e,[{key:"set",value:function(t,i,e,n){return this.x=t,this.y=i,this.z=e,this.order=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.order=t[i+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.order,t}},{key:"toVector3",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o).set(this.x,this.y,this.z)}},{key:"setFromRotationMatrix",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.order,e=t.elements,n=e[0],s=e[4],r=e[8],a=e[1],o=e[5],h=e[9],u=e[2],l=e[6],c=e[10];switch(i){case m:this.y=Math.asin(b(r,-1,1)),Math.abs(r)<.99999?(this.x=Math.atan2(-h,c),this.z=Math.atan2(-s,n)):(this.x=Math.atan2(l,o),this.z=0);break;case g:this.x=Math.asin(-b(h,-1,1)),Math.abs(h)<.99999?(this.y=Math.atan2(r,c),this.z=Math.atan2(a,o)):(this.y=Math.atan2(-u,n),this.z=0);break;case p:this.x=Math.asin(b(l,-1,1)),Math.abs(l)<.99999?(this.y=Math.atan2(-u,c),this.z=Math.atan2(-s,o)):(this.y=0,this.z=Math.atan2(a,n));break;case w:this.y=Math.asin(-b(u,-1,1)),Math.abs(u)<.99999?(this.x=Math.atan2(l,c),this.z=Math.atan2(a,n)):(this.x=0,this.z=Math.atan2(-s,o));break;case x:this.z=Math.asin(b(a,-1,1)),Math.abs(a)<.99999?(this.x=Math.atan2(-h,o),this.y=Math.atan2(-u,n)):(this.x=0,this.y=Math.atan2(r,c));break;case k:this.z=Math.asin(-b(s,-1,1)),Math.abs(s)<.99999?(this.x=Math.atan2(l,o),this.y=Math.atan2(r,n)):(this.x=Math.atan2(-h,c),this.y=0)}return this.order=i,this}},{key:"setFromQuaternion",value:function(t,i){return A.makeRotationFromQuaternion(t),this.setFromRotationMatrix(A,i)}},{key:"setFromVector3",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(t.x,t.y,t.z,i)}},{key:"reorder",value:function(t){return S.setFromEuler(this),this.setFromQuaternion(S,t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order}}],[{key:"defaultOrder",get:function(){return m}}])}(),new o),T=new o,I=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o(1,0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.normal=i,this.constant=n}return i(e,[{key:"set",value:function(t,i){return this.normal.copy(t),this.constant=i,this}},{key:"setComponents",value:function(t,i,e,n){return this.normal.set(t,i,e),this.constant=n,this}},{key:"copy",value:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromNormalAndCoplanarPoint",value:function(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(t,i,e){var n=P.subVectors(e,i).cross(T.subVectors(t,i)).normalize();return this.setFromNormalAndCoplanarPoint(n,P),this}},{key:"normalize",value:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}},{key:"negate",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:"distanceToPoint",value:function(t){return this.normal.dot(t)+this.constant}},{key:"distanceToSphere",value:function(t){return this.distanceToPoint(t.center)-t.radius}},{key:"projectPoint",value:function(t,i){return i.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}},{key:"coplanarPoint",value:function(t){return t.copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(t){return this.constant-=t.dot(this.normal),this}},{key:"intersectLine",value:function(t,i){var e=t.delta(P),n=this.normal.dot(e);if(0===n)0===this.distanceToPoint(t.start)&&i.copy(t.start);else{var s=-(t.start.dot(this.normal)+this.constant)/n;s>=0&&s<=1&&i.copy(e).multiplyScalar(s).add(t.start)}return i}},{key:"intersectsLine",value:function(t){var i=this.distanceToPoint(t.start),e=this.distanceToPoint(t.end);return i<0&&e>0||e<0&&i>0}},{key:"intersectsBox",value:function(t){return t.intersectsPlane(this)}},{key:"intersectsSphere",value:function(t){return t.intersectsPlane(this)}},{key:"equals",value:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}]),e}(),O=new o,_=new o,C=(function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new I,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new I,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new I,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new I,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new I,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new I;t(this,e),this.planes=[i,n,s,r,a,o]}i(e,[{key:"set",value:function(t,i,e,n,s,r){var a=this.planes;return a[0].copy(t),a[1].copy(i),a[2].copy(e),a[3].copy(n),a[4].copy(s),a[5].copy(r),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){var i=this.planes,e=void 0;for(e=0;e<6;++e)i[e].copy(t.planes[e]);return this}},{key:"setFromMatrix",value:function(t){var i=this.planes,e=t.elements,n=e[0],s=e[1],r=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],y=e[9],v=e[10],d=e[11],f=e[12],m=e[13],x=e[14],p=e[15];return i[0].setComponents(a-n,l-o,d-c,p-f).normalize(),i[1].setComponents(a+n,l+o,d+c,p+f).normalize(),i[2].setComponents(a+s,l+h,d+y,p+m).normalize(),i[3].setComponents(a-s,l-h,d-y,p-m).normalize(),i[4].setComponents(a-r,l-u,d-v,p-x).normalize(),i[5].setComponents(a+r,l+u,d+v,p+x).normalize(),this}},{key:"intersectsSphere",value:function(t){var i=this.planes,e=t.center,n=-t.radius,s=!0,r=void 0;for(r=0;r<6;++r)if(i[r].distanceToPoint(e)<n){s=!1;break}return s}},{key:"intersectsBox",value:function(t){var i=this.planes,e=t.min,n=t.max,s=!0,r=void 0,a=void 0,o=void 0,h=void 0;for(r=0;r<6;++r)if(h=i[r],O.x=h.normal.x>0?e.x:n.x,_.x=h.normal.x>0?n.x:e.x,O.y=h.normal.y>0?e.y:n.y,_.y=h.normal.y>0?n.y:e.y,O.z=h.normal.z>0?e.z:n.z,_.z=h.normal.z>0?n.z:e.z,a=h.distanceToPoint(O),o=h.distanceToPoint(_),a<0&&o<0){s=!1;break}return s}},{key:"containsPoint",value:function(t){var i=this.planes,e=!0,n=void 0;for(n=0;n<6;++n)if(i[n].distanceToPoint(t)<0){e=!1;break}return e}}])}(),new o),U=new o,q=(function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o;t(this,e),this.start=i,this.end=n}i(e,[{key:"set",value:function(t,i){return this.start.copy(t),this.end.copy(i),this}},{key:"copy",value:function(t){return this.start.copy(t.start),this.end.copy(t.end),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o).addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o).subVectors(this.end,this.start)}},{key:"lengthSquared",value:function(){return this.start.distanceToSquared(this.end)}},{key:"length",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(t,i){return this.delta(i).multiplyScalar(t).add(this.start)}},{key:"closestPointToPointParameter",value:function(t,i){C.subVectors(t,this.start),U.subVectors(this.end,this.start);var e=U.dot(U),n=U.dot(C);return i?Math.min(Math.max(n/e,0),1):n/e}},{key:"closestPointToPoint",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o,n=this.closestPointToPointParameter(t,i);return this.delta(e).multiplyScalar(n).add(this.start)}},{key:"equals",value:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}])}(),new o),F=new o,E=new o,D=function(){function e(){t(this,e),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return i(e,[{key:"set",value:function(t,i,e,n,s,r,a,o,h,u,l,c,y,v,d,f){var m=this.elements;return m[0]=t,m[4]=i,m[8]=e,m[12]=n,m[1]=s,m[5]=r,m[9]=a,m[13]=o,m[2]=h,m[6]=u,m[10]=l,m[14]=c,m[3]=y,m[7]=v,m[11]=d,m[15]=f,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"copy",value:function(t){var i=t.elements,e=this.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=this.elements,n=void 0;for(n=0;n<16;++n)e[n]=t[n+i];return this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=this.elements,n=void 0;for(n=0;n<16;++n)t[n+i]=e[n];return t}},{key:"getMaxScaleOnAxis",value:function(){var t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],e=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,e,n))}},{key:"copyPosition",value:function(t){var i=this.elements,e=t.elements;return i[12]=e[12],i[13]=e[13],i[14]=e[14],this}},{key:"setPosition",value:function(t){var i=this.elements;return i[12]=t.x,i[13]=t.y,i[14]=t.z,this}},{key:"extractBasis",value:function(t,i,e){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),e.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(t,i,e){return this.set(t.x,i.x,e.x,0,t.y,i.y,e.y,0,t.z,i.z,e.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(t){var i=this.elements,e=t.elements,n=1/q.setFromMatrixColumn(t,0).length(),s=1/q.setFromMatrixColumn(t,1).length(),r=1/q.setFromMatrixColumn(t,2).length();return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[4]=e[4]*s,i[5]=e[5]*s,i[6]=e[6]*s,i[8]=e[8]*r,i[9]=e[9]*r,i[10]=e[10]*r,this}},{key:"makeRotationFromEuler",value:function(t){var i=this.elements,e=t.x,n=t.y,s=t.z,r=Math.cos(e),a=Math.sin(e),o=Math.cos(n),h=Math.sin(n),u=Math.cos(s),l=Math.sin(s),c=void 0,y=void 0,v=void 0,d=void 0,f=void 0,z=void 0,M=void 0,b=void 0,A=void 0,S=void 0,P=void 0,T=void 0;switch(t.order){case m:c=r*u,y=r*l,v=a*u,d=a*l,i[0]=o*u,i[4]=-o*l,i[8]=h,i[1]=y+v*h,i[5]=c-d*h,i[9]=-a*o,i[2]=d-c*h,i[6]=v+y*h,i[10]=r*o;break;case g:f=o*u,z=o*l,M=h*u,b=h*l,i[0]=f+b*a,i[4]=M*a-z,i[8]=r*h,i[1]=r*l,i[5]=r*u,i[9]=-a,i[2]=z*a-M,i[6]=b+f*a,i[10]=r*o;break;case p:f=o*u,z=o*l,M=h*u,b=h*l,i[0]=f-b*a,i[4]=-r*l,i[8]=M+z*a,i[1]=z+M*a,i[5]=r*u,i[9]=b-f*a,i[2]=-r*h,i[6]=a,i[10]=r*o;break;case w:c=r*u,y=r*l,v=a*u,d=a*l,i[0]=o*u,i[4]=v*h-y,i[8]=c*h+d,i[1]=o*l,i[5]=d*h+c,i[9]=y*h-v,i[2]=-h,i[6]=a*o,i[10]=r*o;break;case x:A=r*o,S=r*h,P=a*o,T=a*h,i[0]=o*u,i[4]=T-A*l,i[8]=P*l+S,i[1]=l,i[5]=r*u,i[9]=-a*u,i[2]=-h*u,i[6]=S*l+P,i[10]=A-T*l;break;case k:A=r*o,S=r*h,P=a*o,T=a*h,i[0]=o*u,i[4]=-l,i[8]=h*u,i[1]=A*l+T,i[5]=r*u,i[9]=S*l-P,i[2]=P*l-S,i[6]=a*u,i[10]=T*l+A}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(t){var i=this.elements,e=t.x,n=t.y,s=t.z,r=t.w,a=e+e,o=n+n,h=s+s,u=e*a,l=e*o,c=e*h,y=n*o,v=n*h,d=s*h,f=r*a,m=r*o,x=r*h;return i[0]=1-(y+d),i[4]=l-x,i[8]=c+m,i[1]=l+x,i[5]=1-(u+d),i[9]=v-f,i[2]=c-m,i[6]=v+f,i[10]=1-(u+y),i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}},{key:"lookAt",value:function(t,i,e){var n=this.elements,s=q,r=F,a=E;return a.subVectors(t,i),0===a.lengthSquared()&&(a.z=1),a.normalize(),s.crossVectors(e,a),0===s.lengthSquared()&&(1===Math.abs(e.z)?a.x+=1e-4:a.z+=1e-4,a.normalize(),s.crossVectors(e,a)),s.normalize(),r.crossVectors(a,s),n[0]=s.x,n[4]=r.x,n[8]=a.x,n[1]=s.y,n[5]=r.y,n[9]=a.y,n[2]=s.z,n[6]=r.z,n[10]=a.z,this}},{key:"multiplyMatrices",value:function(t,i){var e=this.elements,n=t.elements,s=i.elements,r=n[0],a=n[4],o=n[8],h=n[12],u=n[1],l=n[5],c=n[9],y=n[13],v=n[2],d=n[6],f=n[10],m=n[14],x=n[3],p=n[7],k=n[11],g=n[15],w=s[0],z=s[4],M=s[8],b=s[12],A=s[1],S=s[5],P=s[9],T=s[13],I=s[2],O=s[6],_=s[10],C=s[14],U=s[3],q=s[7],F=s[11],E=s[15];return e[0]=r*w+a*A+o*I+h*U,e[4]=r*z+a*S+o*O+h*q,e[8]=r*M+a*P+o*_+h*F,e[12]=r*b+a*T+o*C+h*E,e[1]=u*w+l*A+c*I+y*U,e[5]=u*z+l*S+c*O+y*q,e[9]=u*M+l*P+c*_+y*F,e[13]=u*b+l*T+c*C+y*E,e[2]=v*w+d*A+f*I+m*U,e[6]=v*z+d*S+f*O+m*q,e[10]=v*M+d*P+f*_+m*F,e[14]=v*b+d*T+f*C+m*E,e[3]=x*w+p*A+k*I+g*U,e[7]=x*z+p*S+k*O+g*q,e[11]=x*M+p*P+k*_+g*F,e[15]=x*b+p*T+k*C+g*E,this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyScalar",value:function(t){var i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this}},{key:"determinant",value:function(){var t=this.elements,i=t[0],e=t[4],n=t[8],s=t[12],r=t[1],a=t[5],o=t[9],h=t[13],u=t[2],l=t[6],c=t[10],y=t[14],v=i*a,d=i*o,f=i*h,m=e*r,x=e*o,p=e*h,k=n*r,g=n*a,w=n*h,z=s*r,M=s*a,b=s*o;return t[3]*(b*l-w*l-M*c+p*c+g*y-x*y)+t[7]*(d*y-f*c+z*c-k*y+w*u-b*u)+t[11]*(f*l-v*y-z*l+m*y+M*u-p*u)+t[15]*(-g*u-d*l+v*c+k*l-m*c+x*u)}},{key:"getInverse",value:function(t){var i=this.elements,e=t.elements,n=e[0],s=e[1],r=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],y=e[9],v=e[10],d=e[11],f=e[12],m=e[13],x=e[14],p=e[15],k=y*x*l-m*v*l+m*u*d-h*x*d-y*u*p+h*v*p,g=f*v*l-c*x*l-f*u*d+o*x*d+c*u*p-o*v*p,w=c*m*l-f*y*l+f*h*d-o*m*d-c*h*p+o*y*p,z=f*y*u-c*m*u-f*h*v+o*m*v+c*h*x-o*y*x,M=n*k+s*g+r*w+a*z,b=void 0;return 0!==M?(b=1/M,i[0]=k*b,i[1]=(m*v*a-y*x*a-m*r*d+s*x*d+y*r*p-s*v*p)*b,i[2]=(h*x*a-m*u*a+m*r*l-s*x*l-h*r*p+s*u*p)*b,i[3]=(y*u*a-h*v*a-y*r*l+s*v*l+h*r*d-s*u*d)*b,i[4]=g*b,i[5]=(c*x*a-f*v*a+f*r*d-n*x*d-c*r*p+n*v*p)*b,i[6]=(f*u*a-o*x*a-f*r*l+n*x*l+o*r*p-n*u*p)*b,i[7]=(o*v*a-c*u*a+c*r*l-n*v*l-o*r*d+n*u*d)*b,i[8]=w*b,i[9]=(f*y*a-c*m*a-f*s*d+n*m*d+c*s*p-n*y*p)*b,i[10]=(o*m*a-f*h*a+f*s*l-n*m*l-o*s*p+n*h*p)*b,i[11]=(c*h*a-o*y*a-c*s*l+n*y*l+o*s*d-n*h*d)*b,i[12]=z*b,i[13]=(c*m*r-f*y*r+f*s*v-n*m*v-c*s*x+n*y*x)*b,i[14]=(f*h*r-o*m*r-f*s*u+n*m*u+o*s*x-n*h*x)*b,i[15]=(o*y*r-c*h*r+c*s*u-n*y*u-o*s*v+n*h*v)*b):(console.error("Can\'t invert matrix, determinant is zero",t),this.identity()),this}},{key:"transpose",value:function(){var t=this.elements,i=void 0;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this}},{key:"scale",value:function(t,i,e){var n=this.elements;return n[0]*=t,n[4]*=i,n[8]*=e,n[1]*=t,n[5]*=i,n[9]*=e,n[2]*=t,n[6]*=i,n[10]*=e,n[3]*=t,n[7]*=i,n[11]*=e,this}},{key:"makeScale",value:function(t,i,e){return this.set(t,0,0,0,0,i,0,0,0,0,e,0,0,0,0,1),this}},{key:"makeTranslation",value:function(t,i,e){return this.set(1,0,0,t,0,1,0,i,0,0,1,e,0,0,0,1),this}},{key:"makeRotationX",value:function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(1,0,0,0,0,i,-e,0,0,e,i,0,0,0,0,1),this}},{key:"makeRotationY",value:function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(i,0,e,0,0,1,0,0,-e,0,i,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(i,-e,0,0,e,i,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(t,i){var e=Math.cos(i),n=Math.sin(i),s=1-e,r=t.x,a=t.y,o=t.z,h=s*r,u=s*a;return this.set(h*r+e,h*a-n*o,h*o+n*a,0,h*a+n*o,u*a+e,u*o-n*r,0,h*o-n*a,u*o+n*r,s*o*o+e,0,0,0,0,1),this}},{key:"makeShear",value:function(t,i,e){return this.set(1,i,e,0,t,1,e,0,t,i,1,0,0,0,0,1),this}},{key:"compose",value:function(t,i,e){return this.makeRotationFromQuaternion(i),this.scale(e.x,e.y,e.z),this.setPosition(t),this}},{key:"decompose",value:function(t,i,e){var n=this.elements,s=n[0],r=n[1],a=n[2],o=n[4],h=n[5],u=n[6],l=n[8],c=n[9],y=n[10],v=this.determinant(),d=q.set(s,r,a).length()*(v<0?-1:1),f=q.set(o,h,u).length(),m=q.set(l,c,y).length(),x=1/d,p=1/f,k=1/m;return t.x=n[12],t.y=n[13],t.z=n[14],n[0]*=x,n[1]*=x,n[2]*=x,n[4]*=p,n[5]*=p,n[6]*=p,n[8]*=k,n[9]*=k,n[10]*=k,i.setFromRotationMatrix(this),n[0]=s,n[1]=r,n[2]=a,n[4]=o,n[5]=h,n[6]=u,n[8]=l,n[9]=c,n[10]=y,e.x=d,e.y=f,e.z=m,this}},{key:"makePerspective",value:function(t,i,e,n,s,r){var a=this.elements,o=2*s/(i-t),h=2*s/(e-n),u=(i+t)/(i-t),l=(e+n)/(e-n),c=-(r+s)/(r-s),y=-2*r*s/(r-s);return a[0]=o,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=h,a[9]=l,a[13]=0,a[2]=0,a[6]=0,a[10]=c,a[14]=y,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}},{key:"makeOrthographic",value:function(t,i,e,n,s,r){var a=this.elements,o=1/(i-t),h=1/(e-n),u=1/(r-s),l=(i+t)*o,c=(e+n)*h,y=(r+s)*u;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-l,a[1]=0,a[5]=2*h,a[9]=0,a[13]=-c,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-y,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}},{key:"equals",value:function(t){var i=this.elements,e=t.elements,n=!0,s=void 0;for(s=0;n&&s<16;++s)i[s]!==e[s]&&(n=!1);return n}}]),e}(),V=[new o,new o,new o,new o],N=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o;t(this,e),this.origin=i,this.direction=n}return i(e,[{key:"set",value:function(t,i){return this.origin.copy(t),this.direction.copy(i),this}},{key:"copy",value:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"at",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o).copy(this.direction).multiplyScalar(t).add(this.origin)}},{key:"lookAt",value:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this}},{key:"recast",value:function(t){return this.origin.copy(this.at(t,V[0])),this}},{key:"closestPointToPoint",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o,e=i.subVectors(t,this.origin).dot(this.direction);return e>=0?i.copy(this.direction).multiplyScalar(e).add(this.origin):i.copy(this.origin)}},{key:"distanceSquaredToPoint",value:function(t){var i=V[0].subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):V[0].copy(this.direction).multiplyScalar(i).add(this.origin).distanceToSquared(t)}},{key:"distanceToPoint",value:function(t){return Math.sqrt(this.distanceSquaredToPoint(t))}},{key:"distanceToPlane",value:function(t){var i=t.normal.dot(this.direction),e=0!==i?-(this.origin.dot(t.normal)+t.constant)/i:0===t.distanceToPoint(this.origin)?0:-1;return e>=0?e:null}},{key:"distanceSquaredToSegment",value:function(t,i,e,n){var s=V[0].copy(t).add(i).multiplyScalar(.5),r=V[1].copy(i).sub(t).normalize(),a=V[2].copy(this.origin).sub(s),o=.5*t.distanceTo(i),h=-this.direction.dot(r),u=a.dot(this.direction),l=-a.dot(r),c=a.lengthSq(),y=Math.abs(1-h*h),v=void 0,d=void 0,f=void 0,m=void 0,x=void 0;return y>0?(d=h*u-l,f=o*y,(v=h*l-u)>=0?d>=-f?d<=f?x=(v*=m=1/y)*(v+h*(d*=m)+2*u)+d*(h*v+d+2*l)+c:(d=o,x=-(v=Math.max(0,-(h*d+u)))*v+d*(d+2*l)+c):(d=-o,x=-(v=Math.max(0,-(h*d+u)))*v+d*(d+2*l)+c):d<=-f?x=-(v=Math.max(0,-(-h*o+u)))*v+(d=v>0?-o:Math.min(Math.max(-o,-l),o))*(d+2*l)+c:d<=f?(v=0,x=(d=Math.min(Math.max(-o,-l),o))*(d+2*l)+c):x=-(v=Math.max(0,-(h*o+u)))*v+(d=v>0?o:Math.min(Math.max(-o,-l),o))*(d+2*l)+c):(d=h>0?-o:o,x=-(v=Math.max(0,-(h*d+u)))*v+d*(d+2*l)+c),void 0!==e&&e.copy(this.direction).multiplyScalar(v).add(this.origin),void 0!==n&&n.copy(r).multiplyScalar(d).add(s),x}},{key:"intersectSphere",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o,e=V[0].subVectors(t.center,this.origin),n=e.dot(this.direction),s=e.dot(e)-n*n,r=t.radius*t.radius,a=null,h=void 0,u=void 0,l=void 0;return s<=r&&(l=n+(h=Math.sqrt(r-s)),((u=n-h)>=0||l>=0)&&(a=u<0?this.at(l,i):this.at(u,i))),a}},{key:"intersectsSphere",value:function(t){return this.distanceToPoint(t.center)<=t.radius}},{key:"intersectPlane",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o,e=this.distanceToPlane(t);return null===e?null:this.at(e,i)}},{key:"intersectsPlane",value:function(t){var i=t.distanceToPoint(this.origin);return 0===i||t.normal.dot(this.direction)*i<0}},{key:"intersectBox",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o,e=this.origin,n=this.direction,s=t.min,r=t.max,a=1/n.x,h=1/n.y,u=1/n.z,l=null,c=void 0,y=void 0,v=void 0,d=void 0,f=void 0,m=void 0;return a>=0?(c=(s.x-e.x)*a,y=(r.x-e.x)*a):(c=(r.x-e.x)*a,y=(s.x-e.x)*a),h>=0?(v=(s.y-e.y)*h,d=(r.y-e.y)*h):(v=(r.y-e.y)*h,d=(s.y-e.y)*h),c<=d&&v<=y&&((v>c||c!=c)&&(c=v),(d<y||y!=y)&&(y=d),u>=0?(f=(s.z-e.z)*u,m=(r.z-e.z)*u):(f=(r.z-e.z)*u,m=(s.z-e.z)*u),c<=m&&f<=y&&((f>c||c!=c)&&(c=f),(m<y||y!=y)&&(y=m),y>=0&&(l=this.at(c>=0?c:y,i)))),l}},{key:"intersectsBox",value:function(t){return null!==this.intersectBox(t,V[0])}},{key:"intersectTriangle",value:function(t,i,e,n,s){var r=this.direction,a=V[0],o=V[1],h=V[2],u=V[3],l=null,c=void 0,y=void 0,v=void 0,d=void 0,f=void 0;return o.subVectors(i,t),h.subVectors(e,t),u.crossVectors(o,h),0===(c=r.dot(u))||n&&c>0||(c>0?y=1:(y=-1,c=-c),a.subVectors(this.origin,t),(v=y*r.dot(h.crossVectors(a,h)))>=0&&(d=y*r.dot(o.cross(a)))>=0&&v+d<=c&&(f=-y*a.dot(u))>=0&&(l=this.at(f/c,s))),l}},{key:"applyMatrix4",value:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}},{key:"equals",value:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}]),e}(),B=(function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.radius=i,this.phi=n,this.theta=s}i(e,[{key:"set",value:function(t,i,e){return this.radius=t,this.phi=i,this.theta=e,this}},{key:"copy",value:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromVector3",value:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(Math.min(Math.max(t.y/this.radius,-1),1))),this.makeSafe()}},{key:"makeSafe",value:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}}])}(),function(){function e(){t(this,e),this.elements=new Float32Array([1,0,0,1,0,1])}return i(e,[{key:"set",value:function(t,i,e,n,s,r){var a=this.elements;return a[0]=t,a[1]=i,a[3]=n,a[2]=e,a[4]=s,a[5]=r,this}},{key:"identity",value:function(){return this.set(1,0,0,1,0,1),this}},{key:"copy",value:function(t){var i=t.elements;return this.set(i[0],i[1],i[2],i[3],i[4],i[5]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toMatrix3",value:function(t){var i=t.elements;t.set(i[0],i[1],i[2],i[1],i[3],i[4],i[2],i[4],i[5])}},{key:"add",value:function(t){var i=this.elements,e=t.elements;return i[0]+=e[0],i[1]+=e[1],i[3]+=e[3],i[2]+=e[2],i[4]+=e[4],i[5]+=e[5],this}},{key:"norm",value:function(){var t=this.elements,i=t[1]*t[1],e=t[2]*t[2],n=t[4]*t[4];return Math.sqrt(t[0]*t[0]+i+e+i+t[3]*t[3]+n+e+n+t[5]*t[5])}},{key:"off",value:function(){var t=this.elements;return Math.sqrt(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:"applyToVector3",value:function(t){var i=t.x,e=t.y,n=t.z,s=this.elements;return t.x=s[0]*i+s[1]*e+s[2]*n,t.y=s[1]*i+s[3]*e+s[4]*n,t.z=s[2]*i+s[4]*e+s[5]*n,t}},{key:"equals",value:function(t){var i=this.elements,e=t.elements,n=!0,s=void 0;for(s=0;n&&s<6;++s)i[s]!==e[s]&&(n=!1);return n}}],[{key:"calculateIndex",value:function(t,i){return 3-(3-t)*(2-t)/2+i}}]),e}()),L=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t(this,e),this.x=i,this.y=n,this.z=s,this.w=r}return i(e,[{key:"set",value:function(t,i,e,n){return this.x=t,this.y=i,this.z=e,this.w=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}},{key:"setAxisAngleFromQuaternion",value:function(t){this.w=2*Math.acos(t.w);var i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this}},{key:"setAxisAngleFromRotationMatrix",value:function(t){var i=t.elements,e=i[0],n=i[4],s=i[8],r=i[1],a=i[5],o=i[9],h=i[2],u=i[6],l=i[10],c=void 0,y=void 0,v=void 0,d=void 0,f=void 0,m=void 0,x=void 0,p=void 0,k=void 0,g=void 0,w=void 0;return Math.abs(n-r)<.01&&Math.abs(s-h)<.01&&Math.abs(o-u)<.01?Math.abs(n+r)<.1&&Math.abs(s+h)<.1&&Math.abs(o+u)<.1&&Math.abs(e+a+l-3)<.1?this.set(1,0,0,0):(c=Math.PI,x=(l+1)/2,p=(n+r)/4,k=(s+h)/4,g=(o+u)/4,(f=(e+1)/2)>(m=(a+1)/2)&&f>x?f<.01?(y=0,v=.707106781,d=.707106781):(v=p/(y=Math.sqrt(f)),d=k/y):m>x?m<.01?(y=.707106781,v=0,d=.707106781):(y=p/(v=Math.sqrt(m)),d=g/v):x<.01?(y=.707106781,v=.707106781,d=0):(y=k/(d=Math.sqrt(x)),v=g/d),this.set(y,v,d,c)):(w=Math.sqrt((u-o)*(u-o)+(s-h)*(s-h)+(r-n)*(r-n)),Math.abs(w)<.001&&(w=1),this.x=(u-o)/w,this.y=(s-h)/w,this.z=(r-n)/w,this.w=Math.acos((e+a+l-1)/2)),this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}},{key:"addVectors",value:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this}},{key:"addScaledVector",value:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}},{key:"subVectors",value:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}},{key:"multiplyVectors",value:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this.w=t.w*i.w,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this}},{key:"applyMatrix4",value:function(t){var i=this.x,e=this.y,n=this.z,s=this.w,r=t.elements;return this.x=r[0]*i+r[4]*e+r[8]*n+r[12]*s,this.y=r[1]*i+r[5]*e+r[9]*n+r[13]*s,this.z=r[2]*i+r[6]*e+r[10]*n+r[14]*s,this.w=r[3]*i+r[7]*e+r[11]*n+r[15]*s,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)+Math.abs(this.w-t.w)}},{key:"distanceToSquared",value:function(t){var i=this.x-t.x,e=this.y-t.y,n=this.z-t.z,s=this.w-t.w;return i*i+e*e+n*n+s*s}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}},{key:"clamp",value:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"lerp",value:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this}},{key:"lerpVectors",value:function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}}]),e}(),R=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t(this,e),this.value=i,this.done=n}return i(e,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),e}(),j=new o,Y=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o;t(this,e),this.min=i,this.max=n,this.children=null}return i(e,[{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o).addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o).subVectors(this.max,this.min)}},{key:"split",value:function(){var t=this.min,i=this.max,e=this.getCenter(j),n=this.children=[null,null,null,null,null,null,null,null],s=void 0,r=void 0;for(s=0;s<8;++s)r=X[s],n[s]=new this.constructor(new o(0===r[0]?t.x:e.x,0===r[1]?t.y:e.y,0===r[2]?t.z:e.z),new o(0===r[0]?e.x:i.x,0===r[1]?e.y:i.y,0===r[2]?e.z:i.z))}}]),e}(),X=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],Q=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],G=new o,Z=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.min=i,this.size=n,this.children=null}return i(e,[{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o).copy(this.min).addScalar(.5*this.size)}},{key:"getDimensions",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o).set(this.size,this.size,this.size)}},{key:"split",value:function(){var t=this.min,i=this.getCenter(G),e=.5*this.size,n=this.children=[null,null,null,null,null,null,null,null],s=void 0,r=void 0;for(s=0;s<8;++s)r=X[s],n[s]=new this.constructor(new o(0===r[0]?t.x:i.x,0===r[1]?t.y:i.y,0===r[2]?t.z:i.z),e)}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}]),e}(),H=new l,J=function(){function e(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t(this,e),this.octree=i,this.region=n,this.cull=null!==n,this.result=new R,this.trace=null,this.indices=null,this.reset()}return i(e,[{key:"reset",value:function(){var t=this.octree.root;return this.trace=[],this.indices=[],null!==t&&(H.min=t.min,H.max=t.max,this.cull&&!this.region.intersectsBox(H)||(this.trace.push(t),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var t=this.cull,i=this.region,e=this.indices,n=this.trace,s=null,r=n.length-1,a=void 0,o=void 0,h=void 0;null===s&&r>=0;)if(a=e[r],o=n[r].children,++e[r],a<8)if(null!==o){if(h=o[a],t&&(H.min=h.min,H.max=h.max,!i.intersectsBox(H)))continue;n.push(h),e.push(0),++r}else s=n.pop(),e.pop();else n.pop(),e.pop(),--r;return this.result.value=s,this.result.done=null===s,this.result}},{key:"return",value:function(t){return this.result.value=t,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),K=[new o,new o,new o],W=new l,$=new N,tt=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],it=0;function et(t,i,e,n){var s=void 0,r=0;return i<e?(s=i,r=0):(s=e,r=1),n<s&&(r=2),tt[t][r]}var nt=function(){function e(){t(this,e)}return i(e,null,[{key:"intersectOctree",value:function(t,i,e){var n=W.min.set(0,0,0),s=W.max.subVectors(t.max,t.min),r=t.getDimensions(K[0]),a=K[1].copy(r).multiplyScalar(.5),o=$.origin.copy(i.ray.origin),h=$.direction.copy(i.ray.direction),u=void 0,l=void 0,c=void 0,y=void 0,v=void 0,d=void 0,f=void 0,m=void 0,x=void 0;o.sub(t.getCenter(K[2])).add(a),it=0,h.x<0&&(o.x=r.x-o.x,h.x=-h.x,it|=4),h.y<0&&(o.y=r.y-o.y,h.y=-h.y,it|=2),h.z<0&&(o.z=r.z-o.z,h.z=-h.z,it|=1),u=1/h.x,l=1/h.y,c=1/h.z,y=(n.x-o.x)*u,v=(s.x-o.x)*u,d=(n.y-o.y)*l,f=(s.y-o.y)*l,m=(n.z-o.z)*c,x=(s.z-o.z)*c,Math.max(Math.max(y,d),m)<Math.min(Math.min(v,f),x)&&function t(i,e,n,s,r,a,o,h,u){var l=i.children,c=void 0,y=void 0,v=void 0,d=void 0;if(r>=0&&a>=0&&o>=0)if(null===l)u.push(i);else{c=function(t,i,e,n,s,r){var a=0;return t>i&&t>e?(s<t&&(a|=2),r<t&&(a|=1)):i>e?(n<i&&(a|=4),r<i&&(a|=1)):(n<e&&(a|=4),s<e&&(a|=2)),a}(e,n,s,y=.5*(e+r),v=.5*(n+a),d=.5*(s+o));do{switch(c){case 0:t(l[it],e,n,s,y,v,d,h,u),c=et(c,y,v,d);break;case 1:t(l[1^it],e,n,d,y,v,o,h,u),c=et(c,y,v,o);break;case 2:t(l[2^it],e,v,s,y,a,d,h,u),c=et(c,y,a,d);break;case 3:t(l[3^it],e,v,d,y,a,o,h,u),c=et(c,y,a,o);break;case 4:t(l[4^it],y,n,s,r,v,d,h,u),c=et(c,r,v,d);break;case 5:t(l[5^it],y,n,d,r,v,o,h,u),c=et(c,r,v,o);break;case 6:t(l[6^it],y,v,s,r,a,d,h,u),c=et(c,r,a,d);break;case 7:t(l[7^it],y,v,d,r,a,o,h,u),c=8}}while(c<8)}}(t.root,y,d,m,v,f,x,i,e)}}]),e}(),st=new l;var rt=function(){function e(i,n){t(this,e),this.root=void 0!==i&&void 0!==n?new Y(i,n):null}return i(e,[{key:"getCenter",value:function(t){return this.root.getCenter(t)}},{key:"getDimensions",value:function(t){return this.root.getDimensions(t)}},{key:"getDepth",value:function(){return function t(i){var e=i.children,n=0,s=void 0,r=void 0,a=void 0;if(null!==e)for(s=0,r=e.length;s<r;++s)(a=1+t(e[s]))>n&&(n=a);return n}(this.root)}},{key:"cull",value:function(t){var i=[];return function t(i,e,n){var s=i.children,r=void 0,a=void 0;if(st.min=i.min,st.max=i.max,e.intersectsBox(st))if(null!==s)for(r=0,a=s.length;r<a;++r)t(s[r],e,n);else n.push(i)}(this.root,t,i),i}},{key:"findOctantsByLevel",value:function(t){var i=[];return function t(i,e,n,s){var r=i.children,a=void 0,o=void 0;if(n===e)s.push(i);else if(null!==r)for(++n,a=0,o=r.length;a<o;++a)t(r[a],e,n,s)}(this.root,t,0,i),i}},{key:"raycast",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return nt.intersectOctree(this,t,i),i}},{key:"leaves",value:function(t){return new J(this,t)}},{key:Symbol.iterator,value:function(){return new J(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),e}(),at=new o,ot=function(e){n(a,Y);function a(i,e){t(this,a);var n=s(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,i,e));return n.points=null,n.data=null,n}return i(a,[{key:"distanceToSquared",value:function(t){return at.copy(t).clamp(this.min,this.max).sub(t).lengthSquared()}},{key:"distanceToCenterSquared",value:function(t){var i=this.getCenter(at),e=t.x-i.x,n=t.y-i.x,s=t.z-i.z;return e*e+n*n+s*s}},{key:"contains",value:function(t,i){var e=this.min,n=this.max;return t.x>=e.x-i&&t.y>=e.y-i&&t.z>=e.z-i&&t.x<=n.x+i&&t.y<=n.y+i&&t.z<=n.z+i}},{key:"redistribute",value:function(t){var i=this.children,e=this.points,n=this.data,s=void 0,r=void 0,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0;if(null!==i)for(s=0,a=e.length;s<a;++s)for(u=e[s],l=n[s],r=0,o=i.length;r<o;++r)if((h=i[r]).contains(u,t)){null===h.points&&(h.points=[],h.data=[]),h.points.push(u),h.data.push(l);break}this.points=null,this.data=null}},{key:"merge",value:function(){var t=this.children,i=void 0,e=void 0,n=void 0;if(null!==t){for(this.points=[],this.data=[],i=0,e=t.length;i<e;++i)if(null!==(n=t[i]).points){var s,a;(s=this.points).push.apply(s,r(n.points)),(a=this.data).push.apply(a,r(n.data))}this.children=null}}}]),a}(),ht=function i(e,n,s){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;t(this,i),this.distance=e,this.distanceToRay=n,this.point=s,this.object=r},ut=1e-6;function lt(t){var i=t.children,e=0,n=void 0,s=void 0;if(null!==i)for(n=0,s=i.length;n<s;++n)e+=lt(i[n]);else null!==t.points&&(e=t.points.length);return e}function ct(t,i,e,n,s){var r=n.children,a=!1,o=!1,h=void 0,u=void 0;if(n.contains(t,e.bias)){if(null===r){if(null===n.points)n.points=[],n.data=[];else for(h=0,u=n.points.length;!a&&h<u;++h)a=n.points[h].equals(t);a?(n.data[h-1]=i,o=!0):n.points.length<e.maxPoints||s===e.maxDepth?(n.points.push(t.clone()),n.data.push(i),++e.pointCount,o=!0):(n.split(),n.redistribute(e.bias),r=n.children)}if(null!==r)for(++s,h=0,u=r.length;!o&&h<u;++h)o=ct(t,i,e,r[h],s)}return o}function yt(t,i,e,n){var s=e.children,r=null,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0;if(e.contains(t,i.bias))if(null!==s)for(a=0,o=s.length;null===r&&a<o;++a)r=yt(t,i,s[a],e);else if(null!==e.points)for(h=e.points,u=e.data,a=0,o=h.length;a<o;++a)if(h[a].equals(t)){l=o-1,r=u[a],a<l&&(h[a]=h[l],u[a]=u[l]),h.pop(),u.pop(),--i.pointCount,null!==n&&lt(n)<=i.maxPoints&&n.merge();break}return r}!function(r){n(a,rt);function a(i,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;t(this,a);var h=s(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return h.root=new ot(i,e),h.bias=Math.max(0,n),h.maxPoints=Math.max(1,Math.round(r)),h.maxDepth=Math.max(0,Math.round(o)),h.pointCount=0,h}i(a,[{key:"countPoints",value:function(t){return lt(t)}},{key:"put",value:function(t,i){return ct(t,i,this,this.root,0)}},{key:"remove",value:function(t){return yt(t,this,this.root,null)}},{key:"fetch",value:function(t){return function t(i,e,n){var s=n.children,r=null,a=void 0,o=void 0,h=void 0;if(n.contains(i,e.bias))if(null!==s)for(a=0,o=s.length;null===r&&a<o;++a)r=t(i,e,s[a]);else for(a=0,o=(h=n.points).length;null===r&&a<o;++a)i.distanceToSquared(h[a])<=ut&&(r=n.data[a]);return r}(t,this,this.root)}},{key:"move",value:function(t,i){return function t(i,e,n,s,r,a){var o=s.children,h=null,u=void 0,l=void 0,c=void 0;if(s.contains(i,n.bias))if(s.contains(e,n.bias)){if(null!==o)for(++a,u=0,l=o.length;null===h&&u<l;++u)h=t(i,e,n,o[u],s,a);else for(u=0,l=(c=s.points).length;u<l;++u)if(i.distanceToSquared(c[u])<=ut){c[u].copy(e),h=s.data[u];break}}else ct(e,h=yt(i,n,s,r),n,r,a-1);return h}(t,i,this,this.root,null,0)}},{key:"findNearestPoint",value:function(t){return function t(i,e,n,s){var r=s.points,a=s.children,o=null,h=e,u=void 0,l=void 0,c=void 0,y=void 0,v=void 0,d=void 0,f=void 0;if(null!==a)for(u=0,l=(v=a.map(function(t){return{octant:t,distance:t.distanceToCenterSquared(i)}}).sort(function(t,i){return t.distance-i.distance})).length;u<l;++u)(d=v[u].octant).contains(i,h)&&null!==(f=t(i,h,n,d))&&(y=f.point.distanceToSquared(i),(!n||y>0)&&y<h&&(h=y,o=f));else if(null!==r)for(u=0,l=r.length;u<l;++u)c=r[u],y=i.distanceToSquared(c),(!n||y>0)&&y<h&&(h=y,o={point:c.clone(),data:s.data[u]});return o}(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,arguments.length>2&&void 0!==arguments[2]&&arguments[2],this.root)}},{key:"findPoints",value:function(t,i){var e=[];return function t(i,e,n,s,r){var a=s.points,o=s.children,h=e*e,u=void 0,l=void 0,c=void 0,y=void 0,v=void 0;if(null!==o)for(u=0,l=o.length;u<l;++u)(v=o[u]).contains(i,e)&&t(i,e,n,v,r);else if(null!==a)for(u=0,l=a.length;u<l;++u)c=a[u],y=i.distanceToSquared(c),(!n||y>0)&&y<=h&&r.push({point:c.clone(),data:s.data[u]})}(t,i,arguments.length>2&&void 0!==arguments[2]&&arguments[2],this.root,e),e}},{key:"raycast",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"raycast",this).call(this,t);return n.length>0&&this.testPoints(n,t,i),i}},{key:"testPoints",value:function(t,i,e){var n=i.params.Points.threshold,s=n*n,r=void 0,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0,c=void 0,y=void 0,v=void 0,d=void 0,f=void 0;for(u=0,c=t.length;u<c;++u)if(null!==(d=(v=t[u]).points))for(l=0,y=d.length;l<y;++l)f=d[l],(h=i.ray.distanceSqToPoint(f))<s&&(r=i.ray.closestPointToPoint(f),(a=i.ray.origin.distanceTo(r))>=i.near&&a<=i.far&&(o=Math.sqrt(h),e.push(new ht(a,o,r,v.data[l]))))}}])}();var vt=new l,dt=new o,ft=new o,mt=new o,xt=(function(){function e(){t(this,e)}i(e,null,[{key:"recycleOctants",value:function(t,i){var e=t.min,n=t.getCenter(ft),s=t.getDimensions(mt).multiplyScalar(.5),r=t.children,a=i.length,o=void 0,h=void 0,u=void 0,l=void 0;for(o=0;o<8;++o)for(u=X[o],vt.min.addVectors(e,dt.fromArray(u).multiply(s)),vt.max.addVectors(n,dt.fromArray(u).multiply(s)),h=0;h<a;++h)if(null!==(l=i[h])&&vt.min.equals(l.min)&&vt.max.equals(l.max)){r[o]=l,i[h]=null;break}}}])}(),new o),pt=new o,kt=new o,gt=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o;t(this,e),this.a=i,this.b=n,this.index=-1,this.coordinates=new o,this.t=0,this.n=new o}return i(e,[{key:"approximateZeroCrossing",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,e=Math.max(1,i-1),n=0,s=1,r=0,a=0,o=void 0,h=void 0;for(xt.subVectors(this.b,this.a);a<=e&&(r=(n+s)/2,pt.addVectors(this.a,kt.copy(xt).multiplyScalar(r)),h=t.sample(pt),!(Math.abs(h)<=1e-4||(s-n)/2<=1e-6));)pt.addVectors(this.a,kt.copy(xt).multiplyScalar(n)),o=t.sample(pt),Math.sign(h)===Math.sign(o)?n=r:s=r,++a;this.t=r}},{key:"computeZeroCrossingPosition",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o).subVectors(this.b,this.a).multiplyScalar(this.t).add(this.a)}},{key:"computeSurfaceNormal",value:function(t){var i=this.computeZeroCrossingPosition(xt),e=t.sample(pt.addVectors(i,kt.set(.001,0,0)))-t.sample(pt.subVectors(i,kt.set(.001,0,0))),n=t.sample(pt.addVectors(i,kt.set(0,.001,0)))-t.sample(pt.subVectors(i,kt.set(0,.001,0))),s=t.sample(pt.addVectors(i,kt.set(0,0,.001)))-t.sample(pt.subVectors(i,kt.set(0,0,.001)));this.n.set(e,n,s).normalize()}}]),e}(),wt=new gt,zt=new o,Mt=new o,bt=function(){function e(i,n,s){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3;t(this,e),this.edgeData=i,this.cellPosition=n,this.cellSize=s,this.indices=null,this.zeroCrossings=null,this.normals=null,this.axes=null,this.lengths=null,this.result=new R,this.initialC=r,this.c=r,this.initialD=a,this.d=a,this.i=0,this.l=0,this.reset()}return i(e,[{key:"reset",value:function(){var t=this.edgeData,i=[],e=[],n=[],s=[],r=[],a=void 0,o=void 0,h=void 0,u=void 0;for(this.i=0,this.c=0,this.d=0,a=4>>(o=this.initialC),h=this.initialD;o<h;++o,a>>=1)(u=t.indices[o].length)>0&&(i.push(t.indices[o]),e.push(t.zeroCrossings[o]),n.push(t.normals[o]),s.push(X[a]),r.push(u),++this.d);return this.l=r.length>0?r[0]:0,this.indices=i,this.zeroCrossings=e,this.normals=n,this.axes=s,this.lengths=r,this.result.reset(),this}},{key:"next",value:function(){var t=this.cellSize,i=It.resolution,e=i+1,n=e*e,s=this.result,r=this.cellPosition,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0,c=void 0,y=void 0;return this.i===this.l&&(this.l=++this.c<this.d?this.lengths[this.c]:0,this.i=0),this.i<this.l?(c=this.c,y=this.i,a=this.axes[c],o=this.indices[c][y],wt.index=o,h=o%e,u=Math.trunc(o%n/e),l=Math.trunc(o/n),wt.coordinates.set(h,u,l),zt.set(h*t/i,u*t/i,l*t/i),Mt.set((h+a[0])*t/i,(u+a[1])*t/i,(l+a[2])*t/i),wt.a.addVectors(r,zt),wt.b.addVectors(r,Mt),wt.t=this.zeroCrossings[c][y],wt.n.fromArray(this.normals[c],3*y),s.value=wt,++this.i):(s.value=null,s.done=!0),s}},{key:"return",value:function(t){return this.result.value=t,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),At=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i;t(this,e),this.indices=i<=0?null:[new Uint32Array(i),new Uint32Array(n),new Uint32Array(s)],this.zeroCrossings=i<=0?null:[new Float32Array(i),new Float32Array(n),new Float32Array(s)],this.normals=i<=0?null:[new Float32Array(3*i),new Float32Array(3*n),new Float32Array(3*s)]}return i(e,[{key:"serialize",value:function(){return{edges:this.edges,zeroCrossings:this.zeroCrossings,normals:this.normals}}},{key:"deserialize",value:function(t){var i=this;return null!==t?(this.edges=t.edges,this.zeroCrossings=t.zeroCrossings,this.normals=t.normals):i=null,i}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=[this.edges[0],this.edges[1],this.edges[2],this.zeroCrossings[0],this.zeroCrossings[1],this.zeroCrossings[2],this.normals[0],this.normals[1],this.normals[2]],e=void 0,n=void 0,s=void 0;for(n=0,s=i.length;n<s;++n)null!==(e=i[n])&&t.push(e.buffer);return t}},{key:"edges",value:function(t,i){return new bt(this,t,i)}},{key:"edgesX",value:function(t,i){return new bt(this,t,i,0,1)}},{key:"edgesY",value:function(t,i){return new bt(this,t,i,1,2)}},{key:"edgesZ",value:function(t,i){return new bt(this,t,i,2,3)}}],[{key:"calculate1DEdgeCount",value:function(t){return Math.pow(t+1,2)*t}}]),e}(),St={AIR:0,SOLID:1},Pt=0,Tt=0;var It=function(){function e(){var i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t(this,e),this.materials=0,this.materialIndices=i?new Uint8Array(Tt):null,this.runLengths=null,this.edgeData=null}return i(e,[{key:"set",value:function(t){return this.materials=t.materials,this.materialIndices=t.materialIndices,this.runLengths=t.runLengths,this.edgeData=t.edgeData,this}},{key:"clear",value:function(){return this.materials=0,this.materialIndices=null,this.runLengths=null,this.edgeData=null,this}},{key:"setMaterialIndex",value:function(t,i){this.materialIndices[t]===St.AIR?i!==St.AIR&&++this.materials:i===St.AIR&&--this.materials,this.materialIndices[t]=i}},{key:"compress",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,i=void 0;return this.compressed?(t.materialIndices=this.materialIndices,t.runLengths=this.runLengths):(i=this.full?new a([this.materialIndices.length],[St.SOLID]):a.encode(this.materialIndices),t.materialIndices=new Uint8Array(i.data),t.runLengths=new Uint32Array(i.runLengths)),t.materials=this.materials,t}},{key:"decompress",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return t.materialIndices=this.compressed?a.decode(this.runLengths,this.materialIndices,new Uint8Array(Tt)):this.materialIndices,t.runLengths=null,t.materials=this.materials,t}},{key:"serialize",value:function(){return{materials:this.materials,materialIndices:this.materialIndices,runLengths:this.runLengths,edgeData:null!==this.edgeData?this.edgeData.serialize():null}}},{key:"deserialize",value:function(t){var i=this;return null!==t?(this.materials=t.materials,this.materialIndices=t.materialIndices,this.runLengths=t.runLengths,null!==t.edgeData?(null===this.edgeData&&(this.edgeData=new At),this.edgeData.deserialize(t.edgeData)):this.edgeData=null):i=null,i}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return null!==this.edgeData&&this.edgeData.createTransferList(t),null!==this.materialIndices&&t.push(this.materialIndices.buffer),null!==this.runLengths&&t.push(this.runLengths.buffer),t}},{key:"empty",get:function(){return 0===this.materials}},{key:"full",get:function(){return this.materials===Tt}},{key:"compressed",get:function(){return null!==this.runLengths}},{key:"neutered",get:function(){return!this.empty&&null===this.materialIndices}}],[{key:"resolution",get:function(){return Pt},set:function(t){Pt=Math.max(1,Math.min(256,(i=t,Math.pow(2,Math.max(0,Math.ceil(Math.log2(i)))))));var i;Tt=Math.pow(Pt+1,3)}}]),e}(),Ot=function(){function e(){t(this,e),this.ata=new B,this.ata.set(0,0,0,0,0,0),this.atb=new o,this.massPointSum=new o,this.numPoints=0}return i(e,[{key:"set",value:function(t,i,e,n){return this.ata.copy(t),this.atb.copy(i),this.massPointSum.copy(e),this.numPoints=n,this}},{key:"copy",value:function(t){return this.set(t.ata,t.atb,t.massPointSum,t.numPoints)}},{key:"add",value:function(t,i){var e=i.x,n=i.y,s=i.z,r=t.dot(i),a=this.ata.elements,o=this.atb;a[0]+=e*e,a[1]+=e*n,a[3]+=n*n,a[2]+=e*s,a[4]+=n*s,a[5]+=s*s,o.x+=r*e,o.y+=r*n,o.z+=r*s,this.massPointSum.add(t),++this.numPoints}},{key:"addData",value:function(t){this.ata.add(t.ata),this.atb.add(t.atb),this.massPointSum.add(t.massPointSum),this.numPoints+=t.numPoints}},{key:"clear",value:function(){this.ata.set(0,0,0,0,0,0),this.atb.set(0,0,0),this.massPointSum.set(0,0,0),this.numPoints=0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),_t=new v,Ct=function(){function e(){t(this,e)}return i(e,null,[{key:"calculateCoefficients",value:function(t,i,e){var n=void 0,s=void 0,r=void 0;return 0===i?(_t.x=1,_t.y=0):(n=(e-t)/(2*i),s=Math.sqrt(1+n*n),r=1/(n>=0?n+s:n-s),_t.x=1/Math.sqrt(1+r*r),_t.y=r*_t.x),_t}}]),e}(),Ut=function(){function e(){t(this,e)}return i(e,null,[{key:"rotateXY",value:function(t,i){var e=i.x,n=i.y,s=t.x,r=t.y;t.set(e*s-n*r,n*s+e*r)}},{key:"rotateQXY",value:function(t,i,e){var n=e.x,s=e.y,r=n*n,a=s*s,o=2*n*s*i,h=t.x,u=t.y;t.set(r*h-o+a*u,a*h+o+r*u)}}]),e}(),qt=.1,Ft=5,Et=new B,Dt=new f,Vt=new v,Nt=new o;function Bt(t,i){var e=t.elements,n=i.elements,s=void 0;0!==e[1]&&(s=Ct.calculateCoefficients(e[0],e[1],e[3]),Ut.rotateQXY(Vt.set(e[0],e[3]),e[1],s),e[0]=Vt.x,e[3]=Vt.y,Ut.rotateXY(Vt.set(e[2],e[4]),s),e[2]=Vt.x,e[4]=Vt.y,e[1]=0,Ut.rotateXY(Vt.set(n[0],n[3]),s),n[0]=Vt.x,n[3]=Vt.y,Ut.rotateXY(Vt.set(n[1],n[4]),s),n[1]=Vt.x,n[4]=Vt.y,Ut.rotateXY(Vt.set(n[2],n[5]),s),n[2]=Vt.x,n[5]=Vt.y)}function Lt(t,i){var e=t.elements,n=i.elements,s=void 0;0!==e[2]&&(s=Ct.calculateCoefficients(e[0],e[2],e[5]),Ut.rotateQXY(Vt.set(e[0],e[5]),e[2],s),e[0]=Vt.x,e[5]=Vt.y,Ut.rotateXY(Vt.set(e[1],e[4]),s),e[1]=Vt.x,e[4]=Vt.y,e[2]=0,Ut.rotateXY(Vt.set(n[0],n[6]),s),n[0]=Vt.x,n[6]=Vt.y,Ut.rotateXY(Vt.set(n[1],n[7]),s),n[1]=Vt.x,n[7]=Vt.y,Ut.rotateXY(Vt.set(n[2],n[8]),s),n[2]=Vt.x,n[8]=Vt.y)}function Rt(t,i){var e=t.elements,n=i.elements,s=void 0;0!==e[4]&&(s=Ct.calculateCoefficients(e[3],e[4],e[5]),Ut.rotateQXY(Vt.set(e[3],e[5]),e[4],s),e[3]=Vt.x,e[5]=Vt.y,Ut.rotateXY(Vt.set(e[1],e[2]),s),e[1]=Vt.x,e[2]=Vt.y,e[4]=0,Ut.rotateXY(Vt.set(n[3],n[6]),s),n[3]=Vt.x,n[6]=Vt.y,Ut.rotateXY(Vt.set(n[4],n[7]),s),n[4]=Vt.x,n[7]=Vt.y,Ut.rotateXY(Vt.set(n[5],n[8]),s),n[5]=Vt.x,n[8]=Vt.y)}function jt(t){var i=Math.abs(t)<qt?0:1/t;return Math.abs(i)<qt?0:i}var Yt=function(){function e(){t(this,e)}return i(e,null,[{key:"solve",value:function(t,i,e){var n=function(t,i){var e=t.elements,n=void 0;for(n=0;n<Ft;++n)Bt(t,i),Lt(t,i),Rt(t,i);return Nt.set(e[0],e[3],e[5])}(Et.copy(t),Dt.identity()),s=function(t,i){var e=t.elements,n=e[0],s=e[3],r=e[6],a=e[1],o=e[4],h=e[7],u=e[2],l=e[5],c=e[8],y=jt(i.x),v=jt(i.y),d=jt(i.z);return t.set(n*y*n+s*v*s+r*d*r,n*y*a+s*v*o+r*d*h,n*y*u+s*v*l+r*d*c,a*y*n+o*v*s+h*d*r,a*y*a+o*v*o+h*d*h,a*y*u+o*v*l+h*d*c,u*y*n+l*v*s+c*d*r,u*y*a+l*v*o+c*d*h,u*y*u+l*v*l+c*d*c)}(Dt,n);e.copy(i).applyMatrix3(s)}}]),e}(),Xt=new o;var Qt=function(){function e(){t(this,e),this.data=null,this.ata=new B,this.atb=new o,this.massPoint=new o,this.hasSolution=!1}return i(e,[{key:"setData",value:function(t){return this.data=t,this.hasSolution=!1,this}},{key:"solve",value:function(t){var i=this.data,e=this.massPoint,n=this.ata.copy(i.ata),s=this.atb.copy(i.atb),r=1/0;!this.hasSolution&&null!==i&&i.numPoints>0&&(Xt.copy(i.massPointSum).divideScalar(i.numPoints),e.copy(Xt),n.applyToVector3(Xt),s.sub(Xt),Yt.solve(n,s,t),a=s,o=t,n.applyToVector3(Xt.copy(o)),Xt.subVectors(a,Xt),r=Xt.dot(Xt),t.add(e),this.hasSolution=!0);var a,o;return r}}]),e}(),Gt=function i(){t(this,i),this.materials=0,this.edgeCount=0,this.index=-1,this.position=new o,this.normal=new o,this.qefData=null},Zt=new Qt,Ht=-1,Jt=function(e){n(r,Z);function r(i,e){t(this,r);var n=s(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,i,e));return n.voxel=null,n}return i(r,[{key:"contains",value:function(t){var i=this.min,e=this.size;return t.x>=i.x-.1&&t.y>=i.y-.1&&t.z>=i.z-.1&&t.x<=i.x+e+.1&&t.y<=i.y+e+.1&&t.z<=i.z+e+.1}},{key:"collapse",value:function(){var t=this.children,i=[-1,-1,-1,-1,-1,-1,-1,-1],e=new o,n=-1,s=null!==t,r=0,a=void 0,h=void 0,u=void 0,l=void 0,c=void 0,y=void 0;if(s){for(l=new Ot,c=0,y=0;y<8;++y)r+=(a=t[y]).collapse(),u=a.voxel,null!==a.children?s=!1:null!==u&&(l.addData(u.qefData),n=u.materials>>7-y&1,i[y]=u.materials>>y&1,++c);if(s&&Zt.setData(l).solve(e)<=Ht){for((u=new Gt).position.copy(this.contains(e)?e:Zt.massPoint),y=0;y<8;++y)h=i[y],a=t[y],-1===h?u.materials|=n<<y:(u.materials|=h<<y,u.normal.add(a.voxel.normal));u.normal.normalize(),u.qefData=l,this.voxel=u,this.children=null,r+=c-1}}return r}}],[{key:"errorThreshold",get:function(){return Ht},set:function(t){Ht=t}}]),r}(),Kt=function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t(this,i),this.action=e,this.error=null},Wt=function(){function e(i,n,s,r,a){t(this,e),this.indices=i,this.positions=n,this.normals=s,this.uvs=r,this.materials=a}return i(e,[{key:"serialize",value:function(){return{indices:this.indices,positions:this.positions,normals:this.normals,uvs:this.uvs,materials:this.materials}}},{key:"deserialize",value:function(t){var i=this;return null!==t?(this.indices=t.indices,this.positions=t.positions,this.normals=t.normals,this.uvs=t.uvs,this.materials=t.materials):i=null,i}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.push(this.indices.buffer),t.push(this.positions.buffer),t.push(this.normals.buffer),t.push(this.uvs.buffer),t.push(this.materials.buffer),t}}]),e}(),$t=[new Uint8Array([0,4,0]),new Uint8Array([1,5,0]),new Uint8Array([2,6,0]),new Uint8Array([3,7,0]),new Uint8Array([0,2,1]),new Uint8Array([4,6,1]),new Uint8Array([1,3,1]),new Uint8Array([5,7,1]),new Uint8Array([0,1,2]),new Uint8Array([2,3,2]),new Uint8Array([4,5,2]),new Uint8Array([6,7,2])],ti=[new Uint8Array([0,1,2,3,0]),new Uint8Array([4,5,6,7,0]),new Uint8Array([0,4,1,5,1]),new Uint8Array([2,6,3,7,1]),new Uint8Array([0,2,4,6,2]),new Uint8Array([1,3,5,7,2])],ii=[[new Uint8Array([4,0,0]),new Uint8Array([5,1,0]),new Uint8Array([6,2,0]),new Uint8Array([7,3,0])],[new Uint8Array([2,0,1]),new Uint8Array([6,4,1]),new Uint8Array([3,1,1]),new Uint8Array([7,5,1])],[new Uint8Array([1,0,2]),new Uint8Array([3,2,2]),new Uint8Array([5,4,2]),new Uint8Array([7,6,2])]],ei=[[new Uint8Array([1,4,0,5,1,1]),new Uint8Array([1,6,2,7,3,1]),new Uint8Array([0,4,6,0,2,2]),new Uint8Array([0,5,7,1,3,2])],[new Uint8Array([0,2,3,0,1,0]),new Uint8Array([0,6,7,4,5,0]),new Uint8Array([1,2,0,6,4,2]),new Uint8Array([1,3,1,7,5,2])],[new Uint8Array([1,1,0,3,2,0]),new Uint8Array([1,5,4,7,6,0]),new Uint8Array([0,1,5,0,4,1]),new Uint8Array([0,3,7,2,6,1])]],ni=[[new Uint8Array([3,2,1,0,0]),new Uint8Array([7,6,5,4,0])],[new Uint8Array([5,1,4,0,1]),new Uint8Array([7,3,6,2,1])],[new Uint8Array([6,4,2,0,2]),new Uint8Array([7,5,3,1,2])]],si=[new Uint8Array([3,2,1,0]),new Uint8Array([7,5,6,4]),new Uint8Array([11,10,9,8])],ri=Math.pow(2,16)-1;function ai(t,i,e){var n=[0,0,0,0],s=void 0,r=void 0,a=void 0,o=void 0;if(null!==t[0].voxel&&null!==t[1].voxel&&null!==t[2].voxel&&null!==t[3].voxel)!function(t,i,e){var n=[-1,-1,-1,-1],s=[!1,!1,!1,!1],r=1/0,a=0,o=!1,h=void 0,u=void 0,l=void 0,c=void 0,y=void 0,v=void 0,d=void 0;for(d=0;d<4;++d)y=t[d],v=si[i][d],h=Q[v][0],u=Q[v][1],l=y.voxel.materials>>h&1,c=y.voxel.materials>>u&1,y.size<r&&(r=y.size,a=d,o=l!==St.AIR),n[d]=y.voxel.index,s[d]=l!==c;s[a]&&(o?(e.push(n[0]),e.push(n[3]),e.push(n[1]),e.push(n[0]),e.push(n[2]),e.push(n[3])):(e.push(n[0]),e.push(n[1]),e.push(n[3]),e.push(n[0]),e.push(n[3]),e.push(n[2])))}(t,i,e);else for(a=0;a<2;++a){for(n[0]=ni[i][a][0],n[1]=ni[i][a][1],n[2]=ni[i][a][2],n[3]=ni[i][a][3],s=[],o=0;o<4;++o)if(null!==(r=t[o]).voxel)s[o]=r;else{if(null===r.children)break;s[o]=r.children[n[o]]}4===o&&ai(s,ni[i][a][4],e)}}function oi(t,i,e){var n=[0,0,0,0],s=[[0,0,1,1],[0,1,0,1]],r=void 0,a=void 0,o=void 0,h=void 0,u=void 0;if(null!==t[0].children||null!==t[1].children){for(h=0;h<4;++h)n[0]=ii[i][h][0],n[1]=ii[i][h][1],oi([null===t[0].children?t[0]:t[0].children[n[0]],null===t[1].children?t[1]:t[1].children[n[1]]],ii[i][h][2],e);for(h=0;h<4;++h){for(n[0]=ei[i][h][1],n[1]=ei[i][h][2],n[2]=ei[i][h][3],n[3]=ei[i][h][4],a=s[ei[i][h][0]],r=[],u=0;u<4;++u)if(null!==(o=t[a[u]]).voxel)r[u]=o;else{if(null===o.children)break;r[u]=o.children[n[u]]}4===u&&ai(r,ei[i][h][5],e)}}}var hi=function(){function e(){t(this,e)}return i(e,null,[{key:"run",value:function(t){var i=[],e=t.voxelCount,n=null,s=null,r=null,a=null,o=null;return e>ri?console.warn("Could not create geometry for cell at position",t.min,"(vertex count of",e,"exceeds limit of ",ri,")"):e>0&&(s=new Float32Array(3*e),r=new Float32Array(3*e),a=new Float32Array(2*e),o=new Uint8Array(e),function t(i,e,n,s){var r=void 0,a=void 0;if(null!==i.children)for(r=0;r<8;++r)s=t(i.children[r],e,n,s);else null!==i.voxel&&((a=i.voxel).index=s,e[3*s]=a.position.x,e[3*s+1]=a.position.y,e[3*s+2]=a.position.z,n[3*s]=a.normal.x,n[3*s+1]=a.normal.y,n[3*s+2]=a.normal.z,++s);return s}(t.root,s,r,0),function t(i,e){var n=i.children,s=[0,0,0,0],r=void 0;if(null!==n){for(r=0;r<8;++r)t(n[r],e);for(r=0;r<12;++r)s[0]=$t[r][0],s[1]=$t[r][1],oi([n[s[0]],n[s[1]]],$t[r][2],e);for(r=0;r<6;++r)s[0]=ti[r][0],s[1]=ti[r][1],s[2]=ti[r][2],s[3]=ti[r][3],ai([n[s[0]],n[s[1]],n[s[2]],n[s[3]]],ti[r][4],e)}}(t.root,i),n=new Wt(new Uint16Array(i),s,r,a,o)),n}}]),e}();function ui(t,i,e,n,s){var r=0;for(i>>=1;i>0;i>>=1,r=0)e>=i&&(r+=4,e-=i),n>=i&&(r+=2,n-=i),s>=i&&(r+=1,s-=i),null===t.children&&t.split(),t=t.children[r];return t}function li(t,i,e,n,s){var r=t+1,a=r*r,o=new Gt,h=void 0,u=void 0,l=void 0,c=void 0,y=void 0;for(h=0,y=0;y<8;++y)c=(n+(l=X[y])[2])*a+(e+l[1])*r+(i+l[0]),h|=Math.min(s[c],St.SOLID)<<y;for(u=0,y=0;y<12;++y)(h>>Q[y][0]&1)!==(h>>Q[y][1]&1)&&++u;return o.materials=h,o.edgeCount=u,o.qefData=new Ot,o}var ci=function(e){n(r,rt);function r(i){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;t(this,r);var a=s(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return a.root=new Jt(e,n),a.voxelCount=0,null!==i&&null!==i.edgeData&&a.construct(i),Jt.errorThreshold>=0&&a.simplify(),a}return i(r,[{key:"simplify",value:function(){this.voxelCount-=this.root.collapse()}},{key:"construct",value:function(t){var i=It.resolution,e=t.edgeData,n=t.materialIndices,s=new Qt,r=new o,a=[e.edgesX(this.min,this.root.size),e.edgesY(this.min,this.root.size),e.edgesZ(this.min,this.root.size)],h=[new Uint8Array([0,1,2,3]),new Uint8Array([0,1,4,5]),new Uint8Array([0,2,4,6])],u=0,l=void 0,c=void 0,y=void 0,v=void 0,d=void 0,f=void 0,m=void 0,x=void 0,p=void 0,k=void 0,g=void 0;for(k=0;k<3;++k){y=h[k],l=a[k];var w=!0,z=!1,M=void 0;try{for(var b,A=l[Symbol.iterator]();!(w=(b=A.next()).done);w=!0)for((c=b.value).computeZeroCrossingPosition(r),g=0;g<4;++g)v=X[y[g]],m=c.coordinates.x-v[0],x=c.coordinates.y-v[1],p=c.coordinates.z-v[2],m>=0&&x>=0&&p>=0&&m<i&&x<i&&p<i&&(null===(d=ui(this.root,i,m,x,p)).voxel&&(d.voxel=li(i,m,x,p,n),++u),(f=d.voxel).normal.add(c.n),f.qefData.add(r,c.n),f.qefData.numPoints===f.edgeCount&&(s.setData(f.qefData).solve(f.position),d.contains(f.position)||f.position.copy(s.massPoint),f.normal.normalize()))}catch(t){z=!0,M=t}finally{try{!w&&A.return&&A.return()}finally{if(z)throw M}}}this.voxelCount=u}}]),r}(),yi={EXTRACT:"worker.extract",MODIFY:"worker.modify",CONFIGURE:"worker.config",CLOSE:"worker.close"},vi=function(i){n(e,Kt);function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t(this,e);var n=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i));return n.data=null,n}return e}(),di=function(i){n(e,vi);function e(){t(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,yi.EXTRACT));return i.isosurface=null,i}return e}(),fi=new It(!1),mi=function(){function e(){t(this,e),this.data=null,this.response=null}return i(e,[{key:"getData",value:function(){return this.data}},{key:"respond",value:function(){return this.response.data=this.data.serialize(),this.response}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return null!==this.data&&this.data.createTransferList(t),t}},{key:"process",value:function(t){return this.data=fi.deserialize(t.data),this}}]),e}(),xi=function(r){n(a,mi);function a(){t(this,a);var i=s(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return i.response=new di,i.decompressionTarget=new It(!1),i.isosurface=null,i}return i(a,[{key:"respond",value:function(){var t=e(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"respond",this).call(this);return t.isosurface=null!==this.isosurface?this.isosurface.serialise():null,t}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"createTransferList",this).call(this,t),null!==this.isosurface?this.isosurface.createTransferList(t):t}},{key:"process",value:function(t){var i=e(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"process",this).call(this,t).getData(),n=new ci(i.decompress(this.decompressionTarget));return this.isosurface=hi.run(n),this.decompressionTarget.clear(),this}}]),a}(),pi={UNION:"csg.union",DIFFERENCE:"csg.difference",INTERSECTION:"csg.intersection",DENSITY_FUNCTION:"csg.densityfunction"},ki=function(){function e(i){t(this,e),this.type=i;for(var n=arguments.length,s=Array(n>1?n-1:0),r=1;r<n;r++)s[r-1]=arguments[r];this.children=s,this.boundingBox=null}return i(e,[{key:"getBoundingBox",value:function(){return null===this.boundingBox&&(this.boundingBox=this.computeBoundingBox()),this.boundingBox}},{key:"computeBoundingBox",value:function(){var t=this.children,i=new l,e=void 0,n=void 0;for(e=0,n=t.length;e<n;++e)i.union(t[e].getBoundingBox());return i}}]),e}(),gi=function(e){n(r,ki);function r(){var i;t(this,r);for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];return s(this,(i=r.__proto__||Object.getPrototypeOf(r)).call.apply(i,[this,pi.UNION].concat(n)))}return i(r,[{key:"updateMaterialIndex",value:function(t,i,e){var n=e.materialIndices[t];n!==St.AIR&&i.setMaterialIndex(t,n)}},{key:"selectEdge",value:function(t,i,e){return e?t.t>i.t?t:i:t.t<i.t?t:i}}]),r}(),wi=function(e){n(r,ki);function r(){var i;t(this,r);for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];return s(this,(i=r.__proto__||Object.getPrototypeOf(r)).call.apply(i,[this,pi.DIFFERENCE].concat(n)))}return i(r,[{key:"updateMaterialIndex",value:function(t,i,e){e.materialIndices[t]!==St.AIR&&i.setMaterialIndex(t,St.AIR)}},{key:"selectEdge",value:function(t,i,e){return e?t.t<i.t?t:i:t.t>i.t?t:i}}]),r}(),zi=function(e){n(r,ki);function r(){var i;t(this,r);for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];return s(this,(i=r.__proto__||Object.getPrototypeOf(r)).call.apply(i,[this,pi.INTERSECTION].concat(n)))}return i(r,[{key:"updateMaterialIndex",value:function(t,i,e){var n=e.materialIndices[t];i.setMaterialIndex(t,i.materialIndices[t]!==St.AIR&&n!==St.AIR?n:St.AIR)}},{key:"selectEdge",value:function(t,i,e){return e?t.t<i.t?t:i:t.t>i.t?t:i}}]),r}(),Mi=0,bi=new o;function Ai(t,i,e){var n=function(t){var i=Mi,e=It.resolution,n=new o(0,0,0),s=new o(e,e,e),r=new l(bi,bi.clone().addScalar(Mi)),a=t.getBoundingBox();return t.type!==pi.INTERSECTION&&(a.intersectsBox(r)?(n.copy(a.min).max(r.min).sub(r.min),n.x=Math.ceil(n.x*e/i),n.y=Math.ceil(n.y*e/i),n.z=Math.ceil(n.z*e/i),s.copy(a.max).min(r.max).sub(r.min),s.x=Math.floor(s.x*e/i),s.y=Math.floor(s.y*e/i),s.z=Math.floor(s.z*e/i)):(n.set(e,e,e),s.set(0,0,0))),new l(n,s)}(t),s=void 0,r=void 0,a=void 0,h=void 0,u=!1;if(t.type===pi.DENSITY_FUNCTION?function(t,i,e){var n=Mi,s=It.resolution,r=s+1,a=r*r,h=i.materialIndices,u=bi,l=new o,c=new o,y=e.max.x,v=e.max.y,d=e.max.z,f=void 0,m=0,x=void 0,p=void 0,k=void 0;for(k=e.min.z;k<=d;++k)for(l.z=k*n/s,p=e.min.y;p<=v;++p)for(l.y=p*n/s,x=e.min.x;x<=y;++x)l.x=x*n/s,(f=t.generateMaterialIndex(c.addVectors(u,l)))!==St.AIR&&(h[k*a+p*r+x]=f,++m);i.materials=m}(t,i,n):i.empty?t.type===pi.UNION&&(i.set(e),u=!0):i.full&&t.type===pi.UNION||function(t,i,e,n){var s=It.resolution+1,r=s*s,a=n.max.x,o=n.max.y,h=n.max.z,u=void 0,l=void 0,c=void 0;for(c=n.min.z;c<=h;++c)for(l=n.min.y;l<=o;++l)for(u=n.min.x;u<=a;++u)t.updateMaterialIndex(c*r+l*s+u,i,e)}(t,i,e,n),!u&&!i.empty&&!i.full){for(r=(s=t.type===pi.DENSITY_FUNCTION?function(t,i,e){var n=Mi,s=It.resolution,r=s+1,a=r*r,h=new Uint32Array([1,r,a]),u=i.materialIndices,l=bi,c=new o,y=new o,v=new gt,d=new Uint32Array(3),f=new At(At.calculate1DEdgeCount(s)),m=void 0,x=void 0,p=void 0,k=void 0,g=void 0,w=void 0,z=void 0,M=void 0,b=void 0,A=void 0,S=void 0,P=void 0,T=void 0,I=void 0,O=void 0,_=void 0,C=void 0,U=void 0,q=void 0;for(O=4,T=0,I=0;I<3;O>>=1,T=0,++I){switch(_=X[O],m=f.indices[I],x=f.zeroCrossings[I],p=f.normals[I],k=h[I],z=e.min.x,A=e.max.x,M=e.min.y,S=e.max.y,b=e.min.z,P=e.max.z,I){case 0:z=Math.max(z-1,0),A=Math.min(A,s-1);break;case 1:M=Math.max(M-1,0),S=Math.min(S,s-1);break;case 2:b=Math.max(b-1,0),P=Math.min(P,s-1)}for(q=b;q<=P;++q)for(U=M;U<=S;++U)for(C=z;C<=A;++C)w=(g=q*a+U*r+C)+k,u[g]!==u[w]&&(c.set(C*n/s,U*n/s,q*n/s),y.set((C+_[0])*n/s,(U+_[1])*n/s,(q+_[2])*n/s),v.a.addVectors(l,c),v.b.addVectors(l,y),t.generateEdge(v),m[T]=g,x[T]=v.t,p[3*T]=v.n.x,p[3*T+1]=v.n.y,p[3*T+2]=v.n.z,++T);d[I]=T}return{edgeData:f,lengths:d}}(t,i,n):function(t,i,e){var n=It.resolution,s=n+1,r=new Uint32Array([1,s,s*s]),a=i.materialIndices,o=new gt,h=new gt,u=e.edgeData,l=i.edgeData,c=new Uint32Array(3),y=At.calculate1DEdgeCount(n),v=new At(Math.min(y,l.indices[0].length+u.indices[0].length),Math.min(y,l.indices[1].length+u.indices[1].length),Math.min(y,l.indices[2].length+u.indices[2].length)),d=void 0,f=void 0,m=void 0,x=void 0,p=void 0,k=void 0,g=void 0,w=void 0,z=void 0,M=void 0,b=void 0,A=void 0,S=void 0,P=void 0,T=void 0,I=void 0,O=void 0,_=void 0,C=void 0,U=void 0,q=void 0,F=void 0,E=void 0;for(_=0,C=0;C<3;_=0,++C){for(d=u.indices[C],x=l.indices[C],g=v.indices[C],f=u.zeroCrossings[C],p=l.zeroCrossings[C],w=v.zeroCrossings[C],m=u.normals[C],k=l.normals[C],z=v.normals[C],M=r[C],F=d.length,E=x.length,U=0,q=0;U<F;++U)if(A=(b=d[U])+M,(T=a[b])!==(I=a[A])&&(T===St.AIR||I===St.AIR)){for(o.t=f[U],o.n.x=m[3*U],o.n.y=m[3*U+1],o.n.z=m[3*U+2],t.type===pi.DIFFERENCE&&o.n.negate(),O=o;q<E&&x[q]<=b;)P=(S=x[q])+M,h.t=p[q],h.n.x=k[3*q],h.n.y=k[3*q+1],h.n.z=k[3*q+2],T=a[S],S<b?T===(I=a[P])||T!==St.AIR&&I!==St.AIR||(g[_]=S,w[_]=h.t,z[3*_]=h.n.x,z[3*_+1]=h.n.y,z[3*_+2]=h.n.z,++_):O=t.selectEdge(h,o,T===St.SOLID),++q;g[_]=b,w[_]=O.t,z[3*_]=O.n.x,z[3*_+1]=O.n.y,z[3*_+2]=O.n.z,++_}for(;q<E;)P=(S=x[q])+M,(T=a[S])===(I=a[P])||T!==St.AIR&&I!==St.AIR||(g[_]=S,w[_]=p[q],z[3*_]=k[3*q],z[3*_+1]=k[3*q+1],z[3*_+2]=k[3*q+2],++_),++q;c[C]=_}return{edgeData:v,lengths:c}}(t,i,e)).edgeData,a=s.lengths,h=0;h<3;++h)r.indices[h]=r.indices[h].slice(0,a[h]),r.zeroCrossings[h]=r.zeroCrossings[h].slice(0,a[h]),r.normals[h]=r.normals[h].slice(0,3*a[h]);i.edgeData=r}}var Si=function(){function e(){t(this,e)}return i(e,null,[{key:"run",value:function(t,i,e,n){bi.fromArray(t),Mi=i,null===e?n.operation===pi.UNION&&(e=new It(!1)):e.decompress();var s=n.toCSG(),r=null!==e?function t(i){var e=i.children,n=void 0,s=void 0,r=void 0,a=void 0;for(i.type===pi.DENSITY_FUNCTION&&Ai(i,n=new It),r=0,a=e.length;r<a&&(s=t(e[r]),void 0===n?n=s:null!==s?null===n?i.type===pi.UNION&&(n=s):Ai(i,n,s):i.type===pi.INTERSECTION&&(n=null),null!==n||i.type===pi.UNION);++r);return null!==n&&n.empty?null:n}(s):null;if(null!==r){switch(n.operation){case pi.UNION:s=new gi(s);break;case pi.DIFFERENCE:s=new wi(s);break;case pi.INTERSECTION:s=new zi(s)}Ai(s,e,r),e.contoured=!1}return null!==e&&e.empty?null:e}}]),e}(),Pi=function(e){n(r,ki);function r(i){t(this,r);var e=s(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,pi.DENSITY_FUNCTION));return e.sdf=i,e}return i(r,[{key:"computeBoundingBox",value:function(){return this.sdf.getBoundingBox(!0)}},{key:"generateMaterialIndex",value:function(t){return this.sdf.sample(t)<=0?this.sdf.material:St.AIR}},{key:"generateEdge",value:function(t){t.approximateZeroCrossing(this.sdf),t.computeSurfaceNormal(this.sdf)}}]),r}(),Ti=new D,Ii=function(){function e(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:St.SOLID;t(this,e),this.type=i,this.operation=null,this.material=Math.min(255,Math.max(St.SOLID,Math.trunc(n))),this.boundingBox=null,this.position=new o,this.quaternion=new M,this.scale=new o(1,1,1),this.inverseTransformation=new D,this.updateInverseTransformation(),this.children=[]}return i(e,[{key:"getTransformation",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D).compose(this.position,this.quaternion,this.scale)}},{key:"getBoundingBox",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=this.children,e=this.boundingBox,n=void 0,s=void 0;if(null===e&&(e=this.computeBoundingBox(),this.boundingBox=e),t)for(e=e.clone(),n=0,s=i.length;n<s;++n)e.union(i[n].getBoundingBox(t));return e}},{key:"setMaterial",value:function(t){return this.material=Math.min(255,Math.max(St.SOLID,Math.trunc(t))),this}},{key:"setOperationType",value:function(t){return this.operation=t,this}},{key:"updateInverseTransformation",value:function(){return this.inverseTransformation.getInverse(this.getTransformation(Ti)),this.boundingBox=null,this}},{key:"union",value:function(t){return this.children.push(t.setOperationType(pi.UNION)),this}},{key:"subtract",value:function(t){return this.children.push(t.setOperationType(pi.DIFFERENCE)),this}},{key:"intersect",value:function(t){return this.children.push(t.setOperationType(pi.INTERSECTION)),this}},{key:"toCSG",value:function(){var t=this.children,i=new Pi(this),e=void 0,n=void 0,s=void 0,r=void 0;for(s=0,r=t.length;s<r;++s){if(e!==(n=t[s]).operation)switch(e=n.operation){case pi.UNION:i=new gi(i);break;case pi.DIFFERENCE:i=new wi(i);break;case pi.INTERSECTION:i=new zi(i)}i.children.push(n.toCSG())}return i}},{key:"serialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i={type:this.type,operation:this.operation,material:this.material,position:this.position.toArray(),quaternion:this.quaternion.toArray(),scale:this.scale.toArray(),parameters:null,children:[]},e=void 0,n=void 0;for(e=0,n=this.children.length;e<n;++e)i.children.push(this.children[e].serialize(t));return i}},{key:"createTransferList",value:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}},{key:"toJSON",value:function(){return this.serialize(!0)}},{key:"computeBoundingBox",value:function(){throw new Error("SignedDistanceFunction#computeBoundingBox method not implemented!")}},{key:"sample",value:function(t){throw new Error("SignedDistanceFunction#sample method not implemented!")}}]),e}(),Oi={HEIGHTFIELD:"sdf.heightfield",FRACTAL_NOISE:"sdf.fractalnoise",SUPER_PRIMITIVE:"sdf.superprimitive"},_i=function(a){n(h,Ii);function h(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1];t(this,h);var n=s(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,Oi.PERLIN_NOISE,e));return n.min=new(Function.prototype.bind.apply(o,[null].concat(r(i.min)))),n.max=new(Function.prototype.bind.apply(o,[null].concat(r(i.max)))),n}return i(h,[{key:"computeBoundingBox",value:function(){return this.bbox=new l(this.min,this.max),this.bbox}},{key:"sample",value:function(t){}},{key:"serialize",value:function(){var t=e(h.prototype.__proto__||Object.getPrototypeOf(h.prototype),"serialize",this).call(this);return t.parameters={min:this.min.toArray(),max:this.max.toArray()},t}}]),h}();var Ci=function(r){n(a,Ii);function a(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1];t(this,a);var n=s(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,Oi.HEIGHTFIELD,e));return n.width=void 0!==i.width?i.width:1,n.height=void 0!==i.height?i.height:1,n.data=void 0!==i.data?i.data:null,n.heightmap=null,void 0!==i.image&&n.fromImage(i.image),n}return i(a,[{key:"fromImage",value:function(t){var i="undefined"==typeof document?null:function(t){var i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),e=i.getContext("2d");return i.width=t.width,i.height=t.height,e.drawImage(t,0,0),e.getImageData(0,0,t.width,t.height)}(t),e=null,n=void 0,s=void 0,r=void 0,a=void 0;if(null!==i){for(n=i.data,s=0,r=0,a=(e=new Uint8ClampedArray(n.length/4)).length;s<a;++s,r+=4)e[s]=n[r];this.heightmap=t,this.width=i.width,this.height=i.height,this.data=e}return this}},{key:"computeBoundingBox",value:function(){var t=new l,i=Math.min(this.width/this.height,1),e=Math.min(this.height/this.width,1);return t.min.set(0,0,0),t.max.set(i,1,e),t.applyMatrix4(this.getTransformation()),t}},{key:"sample",value:function(t){var i=this.boundingBox,e=void 0;if(i.containsPoint(t)){t.applyMatrix4(this.inverseTransformation);var n=this.width,s=this.height,r=Math.max(Math.min(Math.trunc(t.x*n),n),0),a=Math.max(Math.min(Math.trunc(t.z*s),s),0),o=this.data[a*n+r]/255;e=t.y-o}else e=i.distanceToPoint(t);return e}},{key:"serialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=e(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"serialize",this).call(this);return i.parameters={width:this.width,height:this.height,data:t?null:this.data,dataUrl:t&&null!==this.heightmap?this.heightmap.toDataUrl():null,image:null},i}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.push(this.data.buffer),t}}]),a}(),Ui=function(a){n(h,Ii);function h(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1];t(this,h);var n=s(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,Oi.SUPER_PRIMITIVE,e));return n.s0=new(Function.prototype.bind.apply(L,[null].concat(r(i.s)))),n.r0=new(Function.prototype.bind.apply(o,[null].concat(r(i.r)))),n.s=new L,n.r=new o,n.ba=new v,n.offset=0,n.precompute(),n}return i(h,[{key:"setSize",value:function(t,i,e,n){return this.s0.set(t,i,e,n),this.precompute()}},{key:"setRadii",value:function(t,i,e){return this.r0.set(t,i,e),this.precompute()}},{key:"precompute",value:function(){var t=this.s.copy(this.s0),i=this.r.copy(this.r0),e=this.ba;t.x-=i.x,t.y-=i.x,i.x-=t.w,t.w-=i.y,t.z-=i.y,this.offset=-2*t.z,e.set(i.z,this.offset);var n=e.dot(e);return 0===n?e.set(0,-1):e.divideScalar(n),this}},{key:"computeBoundingBox",value:function(){var t=this.s0,i=new l;return i.min.x=Math.min(-t.x,-1),i.min.y=Math.min(-t.y,-1),i.min.z=Math.min(-t.z,-1),i.max.x=Math.max(t.x,1),i.max.y=Math.max(t.y,1),i.max.z=Math.max(t.z,1),i.applyMatrix4(this.getTransformation()),i}},{key:"sample",value:function(t){t.applyMatrix4(this.inverseTransformation);var i=this.s,e=this.r,n=this.ba,s=Math.abs(t.x)-i.x,r=Math.abs(t.y)-i.y,a=Math.abs(t.z)-i.z,o=Math.max(s,0),h=Math.max(r,0),u=Math.sqrt(o*o+h*h),l=t.z-i.z,c=Math.abs(u+Math.min(0,Math.max(s,r))-e.x)-i.w,y=Math.min(Math.max(c*n.x+l*n.y,0),1),v=c-e.z*y,d=l-this.offset*y,f=Math.max(c-e.z,0),m=t.z+i.z,x=Math.max(c,0),p=v*v+d*d,k=f*f+m*m,g=x*x+l*l,w=c*-n.y+l*n.x;return Math.sqrt(Math.min(p,Math.min(k,g)))*Math.sign(Math.max(w,a))-e.y}},{key:"serialize",value:function(){var t=e(h.prototype.__proto__||Object.getPrototypeOf(h.prototype),"serialize",this).call(this);return t.parameters={s:this.s0.toArray(),r:this.r0.toArray()},t}}],[{key:"create",value:function(t){var i=qi[t];return new h({s:i[0],r:i[1]})}}]),h}(),qi=[[new Float32Array([1,1,1,1]),new Float32Array([0,0,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,0,0])],[new Float32Array([0,0,1,1]),new Float32Array([0,0,1])],[new Float32Array([1,1,2,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,.25,1]),new Float32Array([1,.25,0])],[new Float32Array([1,1,.25,.25]),new Float32Array([1,.25,0])],[new Float32Array([1,1,1,.25]),new Float32Array([1,.1,0])],[new Float32Array([1,1,1,.25]),new Float32Array([.1,.1,0])]],Fi=function(){function e(){t(this,e)}return i(e,[{key:"revive",value:function(t){var i=void 0,e=void 0,n=void 0;switch(t.type){case Oi.FRACTAL_NOISE:i=new _i(t.parameters,t.material);break;case Oi.HEIGHTFIELD:i=new Ci(t.parameters,t.material);break;case Oi.SUPER_PRIMITIVE:i=new Ui(t.parameters,t.material)}for(i.operation=t.operation,i.position.fromArray(t.position),i.quaternion.fromArray(t.quaternion),i.scale.fromArray(t.scale),i.updateInverseTransformation(),e=0,n=t.children.length;e<n;++e)i.children.push(this.revive(t.children[e]));return i}}]),e}(),Ei=function(i){n(e,vi);function e(){t(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,yi.MODIFY));return i.sdf=null,i}return e}(),Di=new(function(r){n(a,mi);function a(){t(this,a);var i=s(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return i.response=new Ei,i.sdf=null,i}return i(a,[{key:"respond",value:function(){var t=e(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"respond",this).call(this);return t.sdf=null!==this.sdf?this.sdf.serialize():null,t}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"createTransferList",this).call(this,t),null!==this.sdf?this.sdf.createTransferList(t):t}},{key:"process",value:function(t){var i=e(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"process",this).call(this,t).getData(),n=this.sdf=Fi.revive(t.sdf),s=Si.run(t.cellPosition,t.cellSize,i,n);return function t(i,e,n,s){var r=Object.getOwnPropertyDescriptor(i,e);if(void 0===r){var a=Object.getPrototypeOf(i);null!==a&&t(a,e,n,s)}else if("value"in r&&r.writable)r.value=n;else{var o=r.set;void 0!==o&&o.call(s,n)}return n}(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"data",null!==s?s.compress():null,this),this}}]),a}()),Vi=new xi,Ni=null;self.addEventListener("message",function(t){var i=t.data;switch(Ni=i.action){case yi.MODIFY:postMessage(Di.process(i).respond(),Di.createTransferList());break;case yi.EXTRACT:postMessage(Vi.process(i).respond(),Vi.createTransferList());break;case yi.CONFIGURE:It.resolution=i.resolution,Jt.errorThreshold=i.errorThreshold;break;case yi.CLOSE:default:close()}}),self.addEventListener("error",function(t){var i=Ni===yi.MODIFY?Di:Ni===yi.EXTRACT?Vi:null,e=void 0;null!==i?((e=i.respond()).action=yi.CLOSE,e.error=t,postMessage(e,i.createTransferList())):((e=new Kt(yi.CLOSE)).error=t,postMessage(e)),close()})}();',fr=function(t){a(e,Jt);function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:navigator.hardwareConcurrency;i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.workerURL=URL.createObjectURL(new Blob([vr],{type:"text/javascript"})),n.maxWorkers=Math.min(navigator.hardwareConcurrency,Math.max(t,1)),n.workers=[],n.busyWorkers=new WeakSet,n.configurationMessage=new hr,n}return r(e,[{key:"handleEvent",value:function(t){switch(t.type){case"message":this.busyWorkers.delete(t.target),dr.worker=t.target,dr.response=t.data,this.dispatchEvent(dr),this.workers.length>this.maxWorkers&&this.closeWorker(t.target);break;case"error":console.error("Encountered an unexpected error",t)}}},{key:"closeWorker",value:function(t){var e=this.workers.indexOf(t);this.busyWorkers.has(t)?(this.busyWorkers.delete(t),t.terminate()):t.postMessage(new or(ar.CLOSE)),t.removeEventListener("message",this),t.removeEventListener("error",this),e>=0&&this.workers.splice(e,1)}},{key:"createWorker",value:function(){var t=new Worker(this.workerURL);return this.workers.push(t),t.addEventListener("message",this),t.addEventListener("error",this),t.postMessage(this.configurationMessage),t}},{key:"getWorker",value:function(){var t=null,e=void 0,n=void 0;for(e=0,n=this.workers.length;e<n;++e)if(!this.busyWorkers.has(this.workers[e])){t=this.workers[e],this.busyWorkers.add(t);break}return null===t&&this.workers.length<this.maxWorkers&&null!==this.workerURL&&(t=this.createWorker(),this.busyWorkers.add(t)),t}},{key:"clear",value:function(){for(;this.workers.length>0;)this.closeWorker(this.workers.pop())}},{key:"dispose",value:function(){this.clear(),URL.revokeObjectURL(this.workerURL),this.workerURL=null}}]),e}(),yr=function(t){a(e,Kt);function e(t){i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.octant=null,n.octantId=null,n.error=null,n}return e}(),mr=(new yr("modificationstart"),new yr("modificationend"),new yr("extractionstart"),new yr("extractionend"),new yr("load")),gr=(new yr("error"),function(t){a(e,Jt);function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var n=void 0!==t.world?t.world:{};Ci.resolution=void 0!==t.resolution?t.resolution:32;var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.object=null,r.world=new tr(n.cellSize,n.levels,n.keyDesign),r.clipmap=new sr(r.world),r.clipmap.addEventListener("shellupdate",r),r.threadPool=new fr(t.workers),r.threadPool.addEventListener("message",r),r.tasks=new WeakMap,r.sdfLoader=new Rn,r.sdfLoader.addEventListener("load",r),r.history=[],r.dtSq=r.world.getCellSize(),r}r(e,[{key:"handleEvent",value:function(t){switch(t.type){case"shellupdate":case"message":break;case"load":this.revive(t.descriptions),this.dispatchEvent(mr)}}},{key:"applyCSG",value:function(t){this.world.applyCSG(t),this.history.push(t)}},{key:"union",value:function(t){this.applyCSG(t.setOperationType(wn.UNION))}},{key:"subtract",value:function(t){this.applyCSG(t.setOperationType(wn.DIFFERENCE))}},{key:"intersect",value:function(t){this.applyCSG(t.setOperationType(wn.INTERSECTION))}},{key:"update",value:function(t){this.clipmap.position.distanceToSquared(t)>=this.dtSq&&this.clipmap.update(t)}},{key:"raycast",value:function(t){return this.world.raycast(t)}},{key:"clear",value:function(){this.world.clear(),this.clipmap.clear(),this.threadPool.clear(),this.sdfLoader.clear(),this.tasks=new WeakMap,this.history=[]}},{key:"dispose",value:function(){this.threadPool.dispose()}},{key:"revive",value:function(t){var e=void 0,n=void 0;for(e=0,n=t.length;e<n;++e)this.applyCSG(Fn.revive(t[e]))}},{key:"save",value:function(){return 0===this.history.length?null:URL.createObjectURL(new Blob([JSON.stringify(this.history)],{type:"text/json"}))}},{key:"load",value:function(t){var e=JSON.parse(t);this.clear(),this.sdfLoader.load(e)}}])}(),function(){function t(e,n,r,s,a){i(this,t),this.indices=e,this.positions=n,this.normals=r,this.uvs=s,this.materials=a}return r(t,[{key:"serialize",value:function(){return{indices:this.indices,positions:this.positions,normals:this.normals,uvs:this.uvs,materials:this.materials}}},{key:"deserialize",value:function(t){var e=this;return null!==t?(this.indices=t.indices,this.positions=t.positions,this.normals=t.normals,this.uvs=t.uvs,this.materials=t.materials):e=null,e}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.push(this.indices.buffer),t.push(this.positions.buffer),t.push(this.normals.buffer),t.push(this.uvs.buffer),t.push(this.materials.buffer),t}}]),t}()),pr=[new Uint8Array([0,4,0]),new Uint8Array([1,5,0]),new Uint8Array([2,6,0]),new Uint8Array([3,7,0]),new Uint8Array([0,2,1]),new Uint8Array([4,6,1]),new Uint8Array([1,3,1]),new Uint8Array([5,7,1]),new Uint8Array([0,1,2]),new Uint8Array([2,3,2]),new Uint8Array([4,5,2]),new Uint8Array([6,7,2])],xr=[new Uint8Array([0,1,2,3,0]),new Uint8Array([4,5,6,7,0]),new Uint8Array([0,4,1,5,1]),new Uint8Array([2,6,3,7,1]),new Uint8Array([0,2,4,6,2]),new Uint8Array([1,3,5,7,2])],Ar=[[new Uint8Array([4,0,0]),new Uint8Array([5,1,0]),new Uint8Array([6,2,0]),new Uint8Array([7,3,0])],[new Uint8Array([2,0,1]),new Uint8Array([6,4,1]),new Uint8Array([3,1,1]),new Uint8Array([7,5,1])],[new Uint8Array([1,0,2]),new Uint8Array([3,2,2]),new Uint8Array([5,4,2]),new Uint8Array([7,6,2])]],wr=[[new Uint8Array([1,4,0,5,1,1]),new Uint8Array([1,6,2,7,3,1]),new Uint8Array([0,4,6,0,2,2]),new Uint8Array([0,5,7,1,3,2])],[new Uint8Array([0,2,3,0,1,0]),new Uint8Array([0,6,7,4,5,0]),new Uint8Array([1,2,0,6,4,2]),new Uint8Array([1,3,1,7,5,2])],[new Uint8Array([1,1,0,3,2,0]),new Uint8Array([1,5,4,7,6,0]),new Uint8Array([0,1,5,0,4,1]),new Uint8Array([0,3,7,2,6,1])]],kr=[[new Uint8Array([3,2,1,0,0]),new Uint8Array([7,6,5,4,0])],[new Uint8Array([5,1,4,0,1]),new Uint8Array([7,3,6,2,1])],[new Uint8Array([6,4,2,0,2]),new Uint8Array([7,5,3,1,2])]],Mr=[new Uint8Array([3,2,1,0]),new Uint8Array([7,5,6,4]),new Uint8Array([11,10,9,8])],zr=Math.pow(2,16)-1;function Dr(t,e,n){var i=[0,0,0,0],r=void 0,s=void 0,a=void 0,o=void 0;if(null!==t[0].voxel&&null!==t[1].voxel&&null!==t[2].voxel&&null!==t[3].voxel)!function(t,e,n){var i=[-1,-1,-1,-1],r=[!1,!1,!1,!1],s=1/0,a=0,o=!1,u=void 0,h=void 0,l=void 0,c=void 0,d=void 0,v=void 0,f=void 0;for(f=0;f<4;++f)d=t[f],v=Mr[e][f],u=Hn[v][0],h=Hn[v][1],l=d.voxel.materials>>u&1,c=d.voxel.materials>>h&1,d.size<s&&(s=d.size,a=f,o=l!==kn.AIR),i[f]=d.voxel.index,r[f]=l!==c;r[a]&&(o?(n.push(i[0]),n.push(i[3]),n.push(i[1]),n.push(i[0]),n.push(i[2]),n.push(i[3])):(n.push(i[0]),n.push(i[1]),n.push(i[3]),n.push(i[0]),n.push(i[3]),n.push(i[2])))}(t,e,n);else for(a=0;a<2;++a){for(i[0]=kr[e][a][0],i[1]=kr[e][a][1],i[2]=kr[e][a][2],i[3]=kr[e][a][3],r=[],o=0;o<4;++o)if(null!==(s=t[o]).voxel)r[o]=s;else{if(null===s.children)break;r[o]=s.children[i[o]]}4===o&&Dr(r,kr[e][a][4],n)}}function Cr(t,e,n){var i=[0,0,0,0],r=[[0,0,1,1],[0,1,0,1]],s=void 0,a=void 0,o=void 0,u=void 0,h=void 0;if(null!==t[0].children||null!==t[1].children){for(u=0;u<4;++u)i[0]=Ar[e][u][0],i[1]=Ar[e][u][1],Cr([null===t[0].children?t[0]:t[0].children[i[0]],null===t[1].children?t[1]:t[1].children[i[1]]],Ar[e][u][2],n);for(u=0;u<4;++u){for(i[0]=wr[e][u][1],i[1]=wr[e][u][2],i[2]=wr[e][u][3],i[3]=wr[e][u][4],a=r[wr[e][u][0]],s=[],h=0;h<4;++h)if(null!==(o=t[a[h]]).voxel)s[h]=o;else{if(null===o.children)break;s[h]=o.children[i[h]]}4===h&&Dr(s,wr[e][u][5],n)}}}var Sr=function(){function t(){i(this,t)}return r(t,null,[{key:"run",value:function(t){var e=[],n=t.voxelCount,i=null,r=null,s=null,a=null,o=null;return n>zr?console.warn("Could not create geometry for cell at position",t.min,"(vertex count of",n,"exceeds limit of ",zr,")"):n>0&&(r=new Float32Array(3*n),s=new Float32Array(3*n),a=new Float32Array(2*n),o=new Uint8Array(n),function t(e,n,i,r){var s=void 0,a=void 0;if(null!==e.children)for(s=0;s<8;++s)r=t(e.children[s],n,i,r);else null!==e.voxel&&((a=e.voxel).index=r,n[3*r]=a.position.x,n[3*r+1]=a.position.y,n[3*r+2]=a.position.z,i[3*r]=a.normal.x,i[3*r+1]=a.normal.y,i[3*r+2]=a.normal.z,++r);return r}(t.root,r,s,0),function t(e,n){var i=e.children,r=[0,0,0,0],s=void 0;if(null!==i){for(s=0;s<8;++s)t(i[s],n);for(s=0;s<12;++s)r[0]=pr[s][0],r[1]=pr[s][1],Cr([i[r[0]],i[r[1]]],pr[s][2],n);for(s=0;s<6;++s)r[0]=xr[s][0],r[1]=xr[s][1],r[2]=xr[s][2],r[3]=xr[s][3],Dr([i[r[0]],i[r[1]],i[r[2]],i[r[3]]],xr[s][4],n)}}(t.root,e),i=new gr(new Uint16Array(e),r,s,a,o)),i}}]),t}(),br=new ue,Er=function(){function t(){i(this,t)}return r(t,null,[{key:"calculateCoefficients",value:function(t,e,n){var i=void 0,r=void 0,s=void 0;return 0===e?(br.x=1,br.y=0):(i=(n-t)/(2*e),r=Math.sqrt(1+i*i),s=1/(i>=0?i+r:i-r),br.x=1/Math.sqrt(1+s*s),br.y=s*br.x),br}}]),t}(),Pr=function(){function t(){i(this,t)}return r(t,null,[{key:"rotateXY",value:function(t,e){var n=e.x,i=e.y,r=t.x,s=t.y;t.set(n*r-i*s,i*r+n*s)}},{key:"rotateQXY",value:function(t,e,n){var i=n.x,r=n.y,s=i*i,a=r*r,o=2*i*r*e,u=t.x,h=t.y;t.set(s*u-o+a*h,a*u+o+s*h)}}]),t}(),Br=.1,Ir=5,Tr=new Ve,Or=new le,Ur=new ue,Fr=new ne;function Lr(t,e){var n=t.elements,i=e.elements,r=void 0;0!==n[1]&&(r=Er.calculateCoefficients(n[0],n[1],n[3]),Pr.rotateQXY(Ur.set(n[0],n[3]),n[1],r),n[0]=Ur.x,n[3]=Ur.y,Pr.rotateXY(Ur.set(n[2],n[4]),r),n[2]=Ur.x,n[4]=Ur.y,n[1]=0,Pr.rotateXY(Ur.set(i[0],i[3]),r),i[0]=Ur.x,i[3]=Ur.y,Pr.rotateXY(Ur.set(i[1],i[4]),r),i[1]=Ur.x,i[4]=Ur.y,Pr.rotateXY(Ur.set(i[2],i[5]),r),i[2]=Ur.x,i[5]=Ur.y)}function Rr(t,e){var n=t.elements,i=e.elements,r=void 0;0!==n[2]&&(r=Er.calculateCoefficients(n[0],n[2],n[5]),Pr.rotateQXY(Ur.set(n[0],n[5]),n[2],r),n[0]=Ur.x,n[5]=Ur.y,Pr.rotateXY(Ur.set(n[1],n[4]),r),n[1]=Ur.x,n[4]=Ur.y,n[2]=0,Pr.rotateXY(Ur.set(i[0],i[6]),r),i[0]=Ur.x,i[6]=Ur.y,Pr.rotateXY(Ur.set(i[1],i[7]),r),i[1]=Ur.x,i[7]=Ur.y,Pr.rotateXY(Ur.set(i[2],i[8]),r),i[2]=Ur.x,i[8]=Ur.y)}function Vr(t,e){var n=t.elements,i=e.elements,r=void 0;0!==n[4]&&(r=Er.calculateCoefficients(n[3],n[4],n[5]),Pr.rotateQXY(Ur.set(n[3],n[5]),n[4],r),n[3]=Ur.x,n[5]=Ur.y,Pr.rotateXY(Ur.set(n[1],n[2]),r),n[1]=Ur.x,n[2]=Ur.y,n[4]=0,Pr.rotateXY(Ur.set(i[3],i[6]),r),i[3]=Ur.x,i[6]=Ur.y,Pr.rotateXY(Ur.set(i[4],i[7]),r),i[4]=Ur.x,i[7]=Ur.y,Pr.rotateXY(Ur.set(i[5],i[8]),r),i[5]=Ur.x,i[8]=Ur.y)}function Gr(t){var e=Math.abs(t)<Br?0:1/t;return Math.abs(e)<Br?0:e}var Qr=function(){function t(){i(this,t)}return r(t,null,[{key:"solve",value:function(t,e,n){var i=function(t,e){var n=t.elements,i=void 0;for(i=0;i<Ir;++i)Lr(t,e),Rr(t,e),Vr(t,e);return Fr.set(n[0],n[3],n[5])}(Tr.copy(t),Or.identity()),r=function(t,e){var n=t.elements,i=n[0],r=n[3],s=n[6],a=n[1],o=n[4],u=n[7],h=n[2],l=n[5],c=n[8],d=Gr(e.x),v=Gr(e.y),f=Gr(e.z);return t.set(i*d*i+r*v*r+s*f*s,i*d*a+r*v*o+s*f*u,i*d*h+r*v*l+s*f*c,a*d*i+o*v*r+u*f*s,a*d*a+o*v*o+u*f*u,a*d*h+o*v*l+u*f*c,h*d*i+l*v*r+c*f*s,h*d*a+l*v*o+c*f*u,h*d*h+l*v*l+c*f*c)}(Or,i);n.copy(e).applyMatrix3(r)}}]),t}(),Nr=new ne;var Yr=function(){function t(){i(this,t),this.data=null,this.ata=new Ve,this.atb=new ne,this.massPoint=new ne,this.hasSolution=!1}return r(t,[{key:"setData",value:function(t){return this.data=t,this.hasSolution=!1,this}},{key:"solve",value:function(t){var e=this.data,n=this.massPoint,i=this.ata.copy(e.ata),r=this.atb.copy(e.atb),s=1/0;!this.hasSolution&&null!==e&&e.numPoints>0&&(Nr.copy(e.massPointSum).divideScalar(e.numPoints),n.copy(Nr),i.applyToVector3(Nr),r.sub(Nr),Qr.solve(i,r,t),a=r,o=t,i.applyToVector3(Nr.copy(o)),Nr.subVectors(a,Nr),s=Nr.dot(Nr),t.add(n),this.hasSolution=!0);var a,o;return s}}]),t}(),Hr=function(){function t(){i(this,t),this.ata=new Ve,this.ata.set(0,0,0,0,0,0),this.atb=new ne,this.massPointSum=new ne,this.numPoints=0}return r(t,[{key:"set",value:function(t,e,n,i){return this.ata.copy(t),this.atb.copy(e),this.massPointSum.copy(n),this.numPoints=i,this}},{key:"copy",value:function(t){return this.set(t.ata,t.atb,t.massPointSum,t.numPoints)}},{key:"add",value:function(t,e){var n=e.x,i=e.y,r=e.z,s=t.dot(e),a=this.ata.elements,o=this.atb;a[0]+=n*n,a[1]+=n*i,a[3]+=i*i,a[2]+=n*r,a[4]+=i*r,a[5]+=r*r,o.x+=s*n,o.y+=s*i,o.z+=s*r,this.massPointSum.add(t),++this.numPoints}},{key:"addData",value:function(t){this.ata.add(t.ata),this.atb.add(t.atb),this.massPointSum.add(t.massPointSum),this.numPoints+=t.numPoints}},{key:"clear",value:function(){this.ata.set(0,0,0,0,0,0),this.atb.set(0,0,0),this.massPointSum.set(0,0,0),this.numPoints=0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),qr=function t(){i(this,t),this.materials=0,this.edgeCount=0,this.index=-1,this.position=new ne,this.normal=new ne,this.qefData=null},jr=new Yr,Xr=-1,Wr=function(t){a(e,jn);function e(t,n){i(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return r.voxel=null,r}return r(e,[{key:"contains",value:function(t){var e=this.min,n=this.size;return t.x>=e.x-.1&&t.y>=e.y-.1&&t.z>=e.z-.1&&t.x<=e.x+n+.1&&t.y<=e.y+n+.1&&t.z<=e.z+n+.1}},{key:"collapse",value:function(){var t=this.children,e=[-1,-1,-1,-1,-1,-1,-1,-1],n=new ne,i=-1,r=null!==t,s=0,a=void 0,o=void 0,u=void 0,h=void 0,l=void 0,c=void 0;if(r){for(h=new Hr,l=0,c=0;c<8;++c)s+=(a=t[c]).collapse(),u=a.voxel,null!==a.children?r=!1:null!==u&&(h.addData(u.qefData),i=u.materials>>7-c&1,e[c]=u.materials>>c&1,++l);if(r&&jr.setData(h).solve(n)<=Xr){for((u=new qr).position.copy(this.contains(n)?n:jr.massPoint),c=0;c<8;++c)o=e[c],a=t[c],-1===o?u.materials|=i<<c:(u.materials|=o<<c,u.normal.add(a.voxel.normal));u.normal.normalize(),u.qefData=h,this.voxel=u,this.children=null,s+=l-1}}return s}}],[{key:"errorThreshold",get:function(){return Xr},set:function(t){Xr=t}}]),e}();function Kr(t,e,n,i,r){var s=0;for(e>>=1;e>0;e>>=1,s=0)n>=e&&(s+=4,n-=e),i>=e&&(s+=2,i-=e),r>=e&&(s+=1,r-=e),null===t.children&&t.split(),t=t.children[s];return t}function Jr(t,e,n,i,r){var s=t+1,a=s*s,o=new qr,u=void 0,h=void 0,l=void 0,c=void 0,d=void 0;for(u=0,d=0;d<8;++d)c=(i+(l=Yn[d])[2])*a+(n+l[1])*s+(e+l[0]),u|=Math.min(r[c],kn.SOLID)<<d;for(h=0,d=0;d<12;++d)(u>>Hn[d][0]&1)!==(u>>Hn[d][1]&1)&&++h;return o.materials=u,o.edgeCount=h,o.qefData=new Hr,o}var Zr=function(t){a(e,ii);function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ne,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;i(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return s.root=new Wr(n,r),s.voxelCount=0,null!==t&&null!==t.edgeData&&s.construct(t),Wr.errorThreshold>=0&&s.simplify(),s}return r(e,[{key:"simplify",value:function(){this.voxelCount-=this.root.collapse()}},{key:"construct",value:function(t){var e=Ci.resolution,n=t.edgeData,i=t.materialIndices,r=new Yr,s=new ne,a=[n.edgesX(this.min,this.root.size),n.edgesY(this.min,this.root.size),n.edgesZ(this.min,this.root.size)],o=[new Uint8Array([0,1,2,3]),new Uint8Array([0,1,4,5]),new Uint8Array([0,2,4,6])],u=0,h=void 0,l=void 0,c=void 0,d=void 0,v=void 0,f=void 0,y=void 0,m=void 0,g=void 0,p=void 0,x=void 0;for(p=0;p<3;++p){c=o[p],h=a[p];var A=!0,w=!1,k=void 0;try{for(var M,z=h[Symbol.iterator]();!(A=(M=z.next()).done);A=!0)for((l=M.value).computeZeroCrossingPosition(s),x=0;x<4;++x)d=Yn[c[x]],y=l.coordinates.x-d[0],m=l.coordinates.y-d[1],g=l.coordinates.z-d[2],y>=0&&m>=0&&g>=0&&y<e&&m<e&&g<e&&(null===(v=Kr(this.root,e,y,m,g)).voxel&&(v.voxel=Jr(e,y,m,g,i),++u),(f=v.voxel).normal.add(l.n),f.qefData.add(s,l.n),f.qefData.numPoints===f.edgeCount&&(r.setData(f.qefData).solve(f.position),v.contains(f.position)||f.position.copy(r.massPoint),f.normal.normalize()))}catch(t){w=!0,k=t}finally{try{!A&&z.return&&z.return()}finally{if(w)throw k}}}this.voxelCount=u}}]),e}(),_r=0,$r=new ne;function ts(t,e,n){var i=function(t){var e=_r,n=Ci.resolution,i=new ne(0,0,0),r=new ne(n,n,n),s=new se($r,$r.clone().addScalar(_r)),a=t.getBoundingBox();return t.type!==wn.INTERSECTION&&(a.intersectsBox(s)?(i.copy(a.min).max(s.min).sub(s.min),i.x=Math.ceil(i.x*n/e),i.y=Math.ceil(i.y*n/e),i.z=Math.ceil(i.z*n/e),r.copy(a.max).min(s.max).sub(s.min),r.x=Math.floor(r.x*n/e),r.y=Math.floor(r.y*n/e),r.z=Math.floor(r.z*n/e)):(i.set(n,n,n),r.set(0,0,0))),new se(i,r)}(t),r=void 0,s=void 0,a=void 0,o=void 0,u=!1;if(t.type===wn.DENSITY_FUNCTION?function(t,e,n){var i=_r,r=Ci.resolution,s=r+1,a=s*s,o=e.materialIndices,u=$r,h=new ne,l=new ne,c=n.max.x,d=n.max.y,v=n.max.z,f=void 0,y=0,m=void 0,g=void 0,p=void 0;for(p=n.min.z;p<=v;++p)for(h.z=p*i/r,g=n.min.y;g<=d;++g)for(h.y=g*i/r,m=n.min.x;m<=c;++m)h.x=m*i/r,(f=t.generateMaterialIndex(l.addVectors(u,h)))!==kn.AIR&&(o[p*a+g*s+m]=f,++y);e.materials=y}(t,e,i):e.empty?t.type===wn.UNION&&(e.set(n),u=!0):e.full&&t.type===wn.UNION||function(t,e,n,i){var r=Ci.resolution+1,s=r*r,a=i.max.x,o=i.max.y,u=i.max.z,h=void 0,l=void 0,c=void 0;for(c=i.min.z;c<=u;++c)for(l=i.min.y;l<=o;++l)for(h=i.min.x;h<=a;++h)t.updateMaterialIndex(c*s+l*r+h,e,n)}(t,e,n,i),!u&&!e.empty&&!e.full){for(s=(r=t.type===wn.DENSITY_FUNCTION?function(t,e,n){var i=_r,r=Ci.resolution,s=r+1,a=s*s,o=new Uint32Array([1,s,a]),u=e.materialIndices,h=$r,l=new ne,c=new ne,d=new pi,v=new Uint32Array(3),f=new Mi(Mi.calculate1DEdgeCount(r)),y=void 0,m=void 0,g=void 0,p=void 0,x=void 0,A=void 0,w=void 0,k=void 0,M=void 0,z=void 0,D=void 0,C=void 0,S=void 0,b=void 0,E=void 0,P=void 0,B=void 0,I=void 0,T=void 0;for(E=4,S=0,b=0;b<3;E>>=1,S=0,++b){switch(P=Yn[E],y=f.indices[b],m=f.zeroCrossings[b],g=f.normals[b],p=o[b],w=n.min.x,z=n.max.x,k=n.min.y,D=n.max.y,M=n.min.z,C=n.max.z,b){case 0:w=Math.max(w-1,0),z=Math.min(z,r-1);break;case 1:k=Math.max(k-1,0),D=Math.min(D,r-1);break;case 2:M=Math.max(M-1,0),C=Math.min(C,r-1)}for(T=M;T<=C;++T)for(I=k;I<=D;++I)for(B=w;B<=z;++B)A=(x=T*a+I*s+B)+p,u[x]!==u[A]&&(l.set(B*i/r,I*i/r,T*i/r),c.set((B+P[0])*i/r,(I+P[1])*i/r,(T+P[2])*i/r),d.a.addVectors(h,l),d.b.addVectors(h,c),t.generateEdge(d),y[S]=x,m[S]=d.t,g[3*S]=d.n.x,g[3*S+1]=d.n.y,g[3*S+2]=d.n.z,++S);v[b]=S}return{edgeData:f,lengths:v}}(t,e,i):function(t,e,n){var i=Ci.resolution,r=i+1,s=new Uint32Array([1,r,r*r]),a=e.materialIndices,o=new pi,u=new pi,h=n.edgeData,l=e.edgeData,c=new Uint32Array(3),d=Mi.calculate1DEdgeCount(i),v=new Mi(Math.min(d,l.indices[0].length+h.indices[0].length),Math.min(d,l.indices[1].length+h.indices[1].length),Math.min(d,l.indices[2].length+h.indices[2].length)),f=void 0,y=void 0,m=void 0,g=void 0,p=void 0,x=void 0,A=void 0,w=void 0,k=void 0,M=void 0,z=void 0,D=void 0,C=void 0,S=void 0,b=void 0,E=void 0,P=void 0,B=void 0,I=void 0,T=void 0,O=void 0,U=void 0,F=void 0;for(B=0,I=0;I<3;B=0,++I){for(f=h.indices[I],g=l.indices[I],A=v.indices[I],y=h.zeroCrossings[I],p=l.zeroCrossings[I],w=v.zeroCrossings[I],m=h.normals[I],x=l.normals[I],k=v.normals[I],M=s[I],U=f.length,F=g.length,T=0,O=0;T<U;++T)if(D=(z=f[T])+M,(b=a[z])!==(E=a[D])&&(b===kn.AIR||E===kn.AIR)){for(o.t=y[T],o.n.x=m[3*T],o.n.y=m[3*T+1],o.n.z=m[3*T+2],t.type===wn.DIFFERENCE&&o.n.negate(),P=o;O<F&&g[O]<=z;)S=(C=g[O])+M,u.t=p[O],u.n.x=x[3*O],u.n.y=x[3*O+1],u.n.z=x[3*O+2],b=a[C],C<z?b===(E=a[S])||b!==kn.AIR&&E!==kn.AIR||(A[B]=C,w[B]=u.t,k[3*B]=u.n.x,k[3*B+1]=u.n.y,k[3*B+2]=u.n.z,++B):P=t.selectEdge(u,o,b===kn.SOLID),++O;A[B]=z,w[B]=P.t,k[3*B]=P.n.x,k[3*B+1]=P.n.y,k[3*B+2]=P.n.z,++B}for(;O<F;)S=(C=g[O])+M,(b=a[C])===(E=a[S])||b!==kn.AIR&&E!==kn.AIR||(A[B]=C,w[B]=p[O],k[3*B]=x[3*O],k[3*B+1]=x[3*O+1],k[3*B+2]=x[3*O+2],++B),++O;c[I]=B}return{edgeData:v,lengths:c}}(t,e,n)).edgeData,a=r.lengths,o=0;o<3;++o)s.indices[o]=s.indices[o].slice(0,a[o]),s.zeroCrossings[o]=s.zeroCrossings[o].slice(0,a[o]),s.normals[o]=s.normals[o].slice(0,3*a[o]);e.edgeData=s}}var es=function(){function t(){i(this,t)}return r(t,null,[{key:"run",value:function(t,e,n,i){$r.fromArray(t),_r=e,null===n?i.operation===wn.UNION&&(n=new Ci(!1)):n.decompress();var r=i.toCSG(),s=null!==n?function t(e){var n=e.children,i=void 0,r=void 0,s=void 0,a=void 0;for(e.type===wn.DENSITY_FUNCTION&&ts(e,i=new Ci),s=0,a=n.length;s<a&&(r=t(n[s]),void 0===i?i=r:null!==r?null===i?e.type===wn.UNION&&(i=r):ts(e,i,r):e.type===wn.INTERSECTION&&(i=null),null!==i||e.type===wn.UNION);++s);return null!==i&&i.empty?null:i}(r):null;if(null!==s){switch(i.operation){case wn.UNION:r=new zn(r);break;case wn.DIFFERENCE:r=new Dn(r);break;case wn.INTERSECTION:r=new Cn(r)}ts(r,n,s),n.contoured=!1}return null!==n&&n.empty?null:n}}]),t}(),ns=new Ci(!1),is=function(){function t(){i(this,t),this.data=null,this.response=null}return r(t,[{key:"getData",value:function(){return this.data}},{key:"respond",value:function(){return this.response.data=this.data.serialize(),this.response}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return null!==this.data&&this.data.createTransferList(t),t}},{key:"process",value:function(t){return this.data=ns.deserialize(t.data),this}}]),t}(),rs=(function(t){a(e,is);function e(){i(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.response=new lr,t.decompressionTarget=new Ci(!1),t.isosurface=null,t}r(e,[{key:"respond",value:function(){var t=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"respond",this).call(this);return t.isosurface=null!==this.isosurface?this.isosurface.serialise():null,t}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"createTransferList",this).call(this,t),null!==this.isosurface?this.isosurface.createTransferList(t):t}},{key:"process",value:function(t){var n=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"process",this).call(this,t).getData(),i=new Zr(n.decompress(this.decompressionTarget));return this.isosurface=Sr.run(i),this.decompressionTarget.clear(),this}}])}(),function(t){a(e,is);function e(){i(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.response=new cr,t.sdf=null,t}r(e,[{key:"respond",value:function(){var t=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"respond",this).call(this);return t.sdf=null!==this.sdf?this.sdf.serialize():null,t}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"createTransferList",this).call(this,t),null!==this.sdf?this.sdf.createTransferList(t):t}},{key:"process",value:function(t){var n=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"process",this).call(this,t).getData(),i=this.sdf=Fn.revive(t.sdf),r=es.run(t.cellPosition,t.cellSize,n,i);return function t(e,n,i,r){var s=Object.getOwnPropertyDescriptor(e,n);if(void 0===s){var a=Object.getPrototypeOf(e);null!==a&&t(a,n,i,r)}else if("value"in s&&s.writable)s.value=i;else{var o=s.set;void 0!==o&&o.call(r,i)}return i}(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"data",null!==r?r.compress():null,this),this}}])}(),function(e){a(n,Wt);function n(){i(this,n);var e=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"contouring"));return e.cellSize=1,e.cellPosition=new t.Vector3,e.cellPosition.subScalar(e.cellSize/2),e.sdfType=Pn.SUPER_PRIMITIVE,e.euler=new ke,e.scale=new t.Vector3,e.superPrimitivePreset=Un.TORUS,e.heightfield=new In,e.hermiteData=null,e.octreeHelper=new gn,e.hermiteDataHelper=new mn,e.box3Helper=new t.Box3Helper,e.material=new t.MeshPhysicalMaterial({color:37256,metalness:.23,roughness:.31,clearCoat:.94,clearCoatRoughness:.15,dithering:!0}),e.mesh=null,e}return r(n,[{key:"createSVO",value:function(){var t=this.octreeHelper;t.octree=new Zr(this.hermiteData,this.cellPosition,this.cellSize),t.update(),function(e){var n=t.children,i=void 0,r=void 0,s=void 0,a=void 0,o=void 0,u=void 0;for(s=0,o=n.length;s<o;++s)for(i=n[s].children,r=s+1<o?3158064:12267568,a=0,u=i.length;a<u;++a)i[a].material.color.setHex(r)}()}},{key:"createHermiteData",value:function(){var t=void 0;switch(this.sdfType){case Pn.SUPER_PRIMITIVE:(t=Tn.create(this.superPrimitivePreset)).quaternion.setFromEuler(this.euler),t.scale.copy(this.scale);break;case Pn.HEIGHTFIELD:(t=this.heightfield).position.set(-.4999,-.25,-.4999),t.quaternion.set(0,0,0,1),t.scale.set(.9999,.5,.9999)}return t.updateInverseTransformation(),this.box3Helper.box=t.getBoundingBox(),this.hermiteData=es.run(this.cellPosition.toArray(),this.cellSize,null,t.setOperationType(wn.UNION)),this.hermiteData}},{key:"contour",value:function(){var e=Sr.run(this.octreeHelper.octree),n=void 0,i=void 0;null!==e&&(null!==this.mesh&&(this.mesh.geometry.dispose(),this.scene.remove(this.mesh)),(i=new t.BufferGeometry).setIndex(new t.BufferAttribute(e.indices,1)),i.addAttribute("position",new t.BufferAttribute(e.positions,3)),i.addAttribute("normal",new t.BufferAttribute(e.normals,3)),n=new t.Mesh(i,this.material),this.mesh=n,this.scene.add(n))}},{key:"load",value:function(){var e=this.assets,n=this.loadingManager,i=new t.CubeTextureLoader(n),r=new t.TextureLoader(n),s="textures/skies/interstellar/",a=[s+"px.jpg",s+"nx.jpg",s+"py.jpg",s+"ny.jpg",s+"pz.jpg",s+"nz.jpg"];return new Promise(function(t,s){0===e.size?(n.onError=s,n.onProgress=function(e,n,i){n===i&&t()},i.load(a,function(t){e.set("sky",t)}),r.load("textures/height/02.png",function(t){e.set("heightmap",t)})):t()})}},{key:"initialize",value:function(){var e=this.scene,n=this.assets,i=this.composer.renderer;this.sdfType=Pn.SUPER_PRIMITIVE,this.euler.set(4.11,3.56,4.74,ce),this.scale.set(.34,.47,.25),this.superPrimitivePreset=Un.TORUS;var r=new t.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,25);r.position.set(0,0,-2),this.camera=r;var s=new fn(r.position,r.quaternion,i.domElement);s.settings.pointer.lock=!1,s.settings.sensitivity.rotation=.0025,s.settings.sensitivity.zoom=.25,s.settings.zoom.maxDistance=20,s.lookAt(e.position),this.controls=s,e.fog=new t.FogExp2(16053492,.075),i.setClearColor(e.fog.color),e.background=n.get("sky"),this.material.envMap=n.get("sky");var a=new t.AmbientLight(4210752),o=new t.DirectionalLight(16759722);o.position.set(-.5,1.5,1),o.target.position.copy(e.position),e.add(o),e.add(a),this.heightfield.fromImage(n.get("heightmap").image),Ci.resolution=64,mn.air=kn.AIR,Wr.errorThreshold=.005,this.createHermiteData(),this.octreeHelper.visible=!0,e.add(this.octreeHelper),e.add(this.hermiteDataHelper),e.add(this.box3Helper),this.createSVO();var u=new t.Box3,h=this.cellSize/2;u.min.set(-h,-h,-h),u.max.set(h,h,h);var l=new t.Box3Helper(u,3158064);l.material.transparent=!0,l.material.opacity=.25,e.add(l)}},{key:"update",value:function(t){this.controls.update(t)}},{key:"registerOptions",value:function(t){var e=this,n=this.composer.renderer,i=this.octreeHelper,r=this.hermiteDataHelper,s=this.box3Helper,a=Object.keys(Un).concat(["HEIGHTFIELD"]),o={SDF:a[this.superPrimitivePreset],color:this.material.color.getHex(),"level mask":i.children.length,"show SVO":function(){"HEIGHTFIELD"!==o.SDF?(e.superPrimitivePreset=Un[o.SDF],e.sdfType=Pn.SUPER_PRIMITIVE):e.sdfType=Pn.HEIGHTFIELD,e.createHermiteData(),e.createSVO(),null!==e.mesh&&e.scene.remove(e.mesh),r.dispose(),i.visible=!0,s.visible=!0,o["level mask"]=i.children.length},"show Hermite data":function(){r.set(e.cellPosition,e.cellSize,e.hermiteData);try{r.update(),r.visible=!0,i.visible=!1,s.visible=!1}catch(t){console.error(t)}},contour:function(){e.createHermiteData(),e.createSVO(),e.contour(),i.visible=!1,r.visible=!1,s.visible=!1}};t.add(o,"SDF",a).onChange(o["show SVO"]);var u=t.addFolder("Octree Helper");u.add(o,"level mask").min(0).max(1+Math.log2(Ci.resolution)).step(1).onChange(function(){var t=void 0,e=void 0;for(t=0,e=i.children.length;t<e;++t)i.children[t].visible=o["level mask"]>=i.children.length||t===o["level mask"]}).listen();var h=(u=t.addFolder("Transformation")).addFolder("Rotation");h.add(this.euler,"x").min(0).max(2*Math.PI).step(1e-4),h.add(this.euler,"y").min(0).max(2*Math.PI).step(1e-4),h.add(this.euler,"z").min(0).max(2*Math.PI).step(1e-4),(h=u.addFolder("Scale")).add(this.scale,"x").min(0).max(.5).step(1e-4),h.add(this.scale,"y").min(0).max(.5).step(1e-4),h.add(this.scale,"z").min(0).max(.5).step(1e-4),(u=t.addFolder("Material")).add(this.material,"metalness").min(0).max(1).step(1e-4),u.add(this.material,"roughness").min(0).max(1).step(1e-4),u.add(this.material,"clearCoat").min(0).max(1).step(1e-4),u.add(this.material,"clearCoatRoughness").min(0).max(1).step(1e-4),u.add(this.material,"reflectivity").min(0).max(1).step(1e-4),u.addColor(o,"color").onChange(function(){return e.material.color.setHex(o.color)}),u.add(this.material,"wireframe"),u.add(this.material,"flatShading").onChange(function(){e.material.needsUpdate=!0}),t.add(Wr,"errorThreshold").min(0).max(.1).step(.001),t.add(o,"show SVO"),t.add(o,"show Hermite data"),t.add(o,"contour"),(u=t.addFolder("Render Info")).add(n.info.render,"vertices").listen(),u.add(n.info.render,"faces").listen()}}]),n}()),ss=function(t){a(e,Kt);function e(t){i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.qefData=null,n}return e}(),as=new t.Vector2,os=new Kt("update"),us=function(e){a(n,Jt);function n(e,r,s,a){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:document.body;i(this,n);var h=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return h.hermiteData=s,h.cellPosition=e,h.cellSize=r,h.camera=a,h.dom=u,h.raycaster=new t.Raycaster,h.gridPointMaterials=[new t.MeshBasicMaterial({color:10066329,depthWrite:!1,transparent:!0,opacity:.75}),new t.MeshBasicMaterial({color:13395558,depthWrite:!1,transparent:!0,opacity:.9})],h.selectedGridPoint=null,h.gridPoints=new t.Group,h.createGridPoints(),h}return r(n,[{key:"createGridPoints",value:function(){var e=this.gridPoints,n=this.cellSize,i=Ci.resolution,r=this.cellPosition,s=new t.Vector3,a=new t.SphereBufferGeometry(.05,8,8),o=this.gridPointMaterials[0],u=void 0,h=void 0,l=void 0,c=void 0;for(c=0;c<=i;++c)for(s.z=c*n/i,l=0;l<=i;++l)for(s.y=l*n/i,h=0;h<=i;++h)s.x=h*n/i,(u=new t.Mesh(a,o)).position.copy(r).add(s),e.add(u)}},{key:"toggleMaterialIndex",value:function(t){var e=this.hermiteData,n=e.materialIndices[t]===kn.AIR?kn.SOLID:kn.AIR;e.setMaterialIndex(t,n)}},{key:"handleClick",value:function(t){var e=this.selectedGridPoint;t.preventDefault(),null!==e&&(this.toggleMaterialIndex(this.gridPoints.children.indexOf(e)),this.dispatchEvent(os))}},{key:"raycast",value:function(t){var e=this.raycaster;as.x=t.clientX/window.innerWidth*2-1,as.y=-t.clientY/window.innerHeight*2+1,e.setFromCamera(as,this.camera);var n=e.intersectObjects(this.gridPoints.children);null!==this.selectedGridPoint&&(this.selectedGridPoint.material=this.gridPointMaterials[0],this.selectedGridPoint=null),n.length>0&&(this.selectedGridPoint=n[0].object,this.selectedGridPoint.material=this.gridPointMaterials[1])}},{key:"handleEvent",value:function(t){switch(t.type){case"mousemove":this.raycast(t);break;case"click":this.handleClick(t)}}},{key:"setEnabled",value:function(t){var e=this.dom;t?(e.addEventListener("mousemove",this),e.addEventListener("click",this)):(e.removeEventListener("mousemove",this),e.removeEventListener("click",this))}},{key:"dispose",value:function(){this.setEnabled(!1)}},{key:"registerOptions",value:function(t){}}]),n}(),hs=new t.Vector2,ls=new Kt("update"),cs=function(e){a(n,Jt);function n(e,r,s,a){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:document.body;i(this,n);var h=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return h.hermiteData=s,h.cellPosition=e,h.cellSize=r,h.camera=a,h.dom=u,h.raycaster=new t.Raycaster,h.raycaster.linePrecision=.05,h.t=0,h.edgeMaterials=[new t.LineBasicMaterial({color:10066329}),new t.LineBasicMaterial({color:13395558})],h.planeMaterials=[new t.MeshBasicMaterial({color:11149824,side:t.DoubleSide,depthWrite:!1,transparent:!0,opacity:.2}),new t.MeshBasicMaterial({color:16776960,side:t.DoubleSide,depthWrite:!1,transparent:!0,opacity:.4})],h.selectedEdge=null,h.activeEdge=null,h.activePlane=null,h.edgeId=new t.Vector2,h.edges=new t.Group,h.planes=new t.Group,h.t=0,h.s=new t.Spherical,h}return r(n,[{key:"calculateEdgeId",value:function(t){var e=this.hermiteData.edgeData.indices,n=void 0,i=void 0;for(n=0;n<3&&!(t<(i=e[n].length));++n)t-=i;this.edgeId.set(n,t)}},{key:"clearEdges",value:function(){for(var t=this.edges,e=this.planes,n=void 0,i=void 0;t.children.length>0;)(n=t.children[0]).geometry.dispose(),t.remove(n);for(;e.children.length>0;)(i=e.children[0]).geometry.dispose(),e.remove(i);this.activeEdge=null,this.activePlane=null}},{key:"createEdges",value:function(){var e=this.edges,n=this.planes,i=this.edgeMaterials[0],r=this.planeMaterials[0],s=this.hermiteData.edgeData.edges(this.cellPosition,this.cellSize),a=new t.Vector3,o=void 0,u=void 0,h=void 0,l=void 0,c=void 0;this.clearEdges();var d=!0,v=!1,f=void 0;try{for(var y,m=s[Symbol.iterator]();!(d=(y=m.next()).done);d=!0)o=y.value,l=new t.BufferGeometry,c=new Float32Array(6),o.a.toArray(c),o.b.toArray(c,3),l.addAttribute("position",new t.BufferAttribute(c,3)),u=new t.Line(l,i),e.add(u),(h=new t.Mesh(new t.PlaneBufferGeometry(2,2),r)).position.copy(o.computeZeroCrossingPosition(a)),h.lookAt(a.add(o.n)),h.visible=!1,n.add(h)}catch(t){v=!0,f=t}finally{try{!d&&m.return&&m.return()}finally{if(v)throw f}}}},{key:"adoptEdgeData",value:function(){var e=this.hermiteData.edgeData,n=e.zeroCrossings,i=e.normals,r=this.edgeId.x,s=this.edgeId.y,a=new t.Vector3;this.t=n[r][s],this.s.setFromVector3(a.fromArray(i[r],3*s))}},{key:"updateEdgeData",value:function(){var e=this.activeEdge,n=this.activePlane,i=new t.Vector3,r=new t.Vector3,s=new t.Vector3,a=new t.Vector3,o=this.hermiteData.edgeData,u=o.zeroCrossings,h=o.normals,l=this.edgeId.x,c=this.edgeId.y;null!==e&&(i.fromArray(e.geometry.getAttribute("position").array),r.fromArray(e.geometry.getAttribute("position").array,3),s.copy(i).add(r.sub(i).multiplyScalar(this.t)),a.setFromSpherical(this.s).normalize(),n.position.copy(s),n.lookAt(s.add(a)),u[l][c]=this.t,a.toArray(h[l],3*c),this.dispatchEvent(ls))}},{key:"handleClick",value:function(t){var e=this.selectedEdge;t.preventDefault();var n=void 0,i=void 0;null!==e&&(null!==this.activeEdge&&(this.activeEdge!==e&&(this.activeEdge.material=this.edgeMaterials[0]),this.activePlane.material=this.planeMaterials[0],this.activePlane.visible=!1),this.activeEdge!==e?(n=this.edges.children.indexOf(e),i=this.planes.children[n],e.material=this.edgeMaterials[1],i.material=this.planeMaterials[1],i.visible=!0,this.activeEdge=e,this.activePlane=i,this.calculateEdgeId(n),this.adoptEdgeData()):(this.t=0,this.s.phi=0,this.s.theta=0,this.activeEdge=null,this.activePlane=null))}},{key:"raycast",value:function(t){var e=this.raycaster;hs.x=t.clientX/window.innerWidth*2-1,hs.y=-t.clientY/window.innerHeight*2+1,e.setFromCamera(hs,this.camera);var n=e.intersectObjects(this.edges.children);null!==this.selectedEdge&&(this.selectedEdge!==this.activeEdge&&(this.selectedEdge.material=this.edgeMaterials[0]),this.selectedEdge=null),n.length>0&&(this.selectedEdge=n[0].object,this.selectedEdge.material=this.edgeMaterials[1])}},{key:"handleEvent",value:function(t){switch(t.type){case"mousemove":this.raycast(t);break;case"click":this.handleClick(t)}}},{key:"setEnabled",value:function(t){var e=this.dom;t?(e.addEventListener("mousemove",this),e.addEventListener("click",this)):(e.removeEventListener("mousemove",this),e.removeEventListener("click",this))}},{key:"dispose",value:function(){this.setEnabled(!1)}},{key:"registerOptions",value:function(t){var e=this,n=this.planes,i={"show planes":!1};t.add(i,"show planes").onChange(function(){var t=e.activePlane;n.traverse(function(e){e!==n&&e!==t&&(e.visible=i["show planes"])})});var r=t.addFolder("Edge Adjustment");r.add(this,"t").min(0).max(1).listen().step(1e-6).onChange(function(){e.updateEdgeData()}),r.add(this.s,"phi").min(1e-6).max(Math.PI-1e-6).step(1e-6).listen().onChange(function(){e.updateEdgeData()}),r.add(this.s,"theta").min(1e-6).max(Math.PI-1e-6).step(1e-6).listen().onChange(function(){e.updateEdgeData()}),r.open()}}]),n}(),ds=new ss("update"),vs=function(e){a(n,Jt);function n(t,e,r,s){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:document.body;i(this,n);var u=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return u.hermiteData=r,u.cellPosition=t,u.cellSize=e,u.gridPointEditor=new us(t,e,r,s,a),u.gridPointEditor.addEventListener("update",u),u.gridPointEditor.setEnabled(!0),u.edgeEditor=new cs(t,e,r,s,a),u.edgeEditor.addEventListener("update",u),u.qefData=new Hr,u}return r(n,[{key:"createEdgeData",value:function(){var t=Ci.resolution,e=t+1,n=e*e,i=new Uint32Array([1,e,n]),r=this.hermiteData.materialIndices,s=new Mi(Mi.calculate1DEdgeCount(t)),a=void 0,o=void 0,u=void 0,h=void 0,l=void 0,c=void 0,d=void 0,v=void 0,f=void 0,y=void 0,m=void 0,g=void 0,p=void 0,x=void 0,A=void 0;for(v=4,c=0,d=0;d<3;v>>=1,c=0,++d){switch(f=Yn[v],a=s.indices[d],o=s.zeroCrossings[d],u=s.normals[d],p=x=A=t,d){case 0:p=Math.min(p,t-1);break;case 1:x=Math.min(x,t-1);break;case 2:A=Math.min(A,t-1)}for(g=0;g<=A;++g)for(m=0;m<=x;++m)for(y=0;y<=p;++y)l=(h=g*n+m*e+y)+i[d],r[h]!==r[l]&&(a[c]=h,o[c]=.5,u[3*c]=f[0],u[3*c+1]=f[1],u[3*c+2]=f[2],++c);s.indices[d]=s.indices[d].slice(0,c),s.zeroCrossings[d]=s.zeroCrossings[d].slice(0,c),s.normals[d]=s.normals[d].slice(0,3*c)}this.hermiteData.edgeData=s}},{key:"updateQEFData",value:function(){var e=this.qefData,n=new t.Vector3,i=this.hermiteData.edgeData.edges(this.cellPosition,this.cellSize),r=void 0;e.clear();var s=!0,a=!1,o=void 0;try{for(var u,h=i[Symbol.iterator]();!(s=(u=h.next()).done);s=!0)(r=u.value).computeZeroCrossingPosition(n),e.add(n,r.n)}catch(t){a=!0,o=t}finally{try{!s&&h.return&&h.return()}finally{if(a)throw o}}}},{key:"handleEvent",value:function(t){switch(t.type){case"update":t.target===this.gridPointEditor&&(this.createEdgeData(),this.edgeEditor.createEdges()),1===Ci.resolution&&this.updateQEFData(),ds.qefData=this.qefData,this.dispatchEvent(ds)}}},{key:"setEnabled",value:function(t){this.gridPointEditor.setEnabled(t),this.edgeEditor.setEnabled(t)}},{key:"dispose",value:function(){this.setEnabled(!1)}},{key:"registerOptions",value:function(t){var e=this,n={"edit mode":0};t.add(n,"edit mode",{materials:0,edges:1}).onChange(function(){var t=0===Number.parseInt(n["edit mode"]);e.gridPointEditor.setEnabled(t),e.edgeEditor.setEnabled(!t)}),this.edgeEditor.registerOptions(t)}},{key:"gridPoints",get:function(){return this.gridPointEditor.gridPoints}},{key:"edges",get:function(){return this.edgeEditor.edges}},{key:"planes",get:function(){return this.edgeEditor.planes}}]),n}(),fs=function(e){a(n,Wt);function n(){i(this,n);var e=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"voxel"));return e.hermiteData=null,e.hermiteDataHelper=null,e.hermiteDataEditor=null,e.qefSolver=new Yr,e.error="0.0000",e.result={x:"",y:"",z:""},e.vertex=new t.Mesh(new t.SphereBufferGeometry(.05,8,8),new t.MeshBasicMaterial({color:16746530})),e.vertex.visible=!1,e}return r(n,[{key:"solveQEF",value:function(t){var e=this.hermiteData,n=this.qefSolver,i=this.vertex,r=this.result;e.empty||e.full?i.visible&&(r.x="",r.y="",r.z="",i.visible=!1):(this.error=n.setData(t).solve(i.position).toFixed(4),i.visible=!0,r.x=i.position.x.toFixed(2),r.y=i.position.y.toFixed(2),r.z=i.position.z.toFixed(2))}},{key:"handleEvent",value:function(t){switch(t.type){case"update":try{this.hermiteDataHelper.update(!0,!1)}catch(t){}this.solveQEF(t.qefData)}}},{key:"initialize",value:function(){var e=this.scene,n=this.composer.renderer,i=new t.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,50);i.position.set(-2,1,2),this.camera=i;var r=new fn(i.position,i.quaternion,n.domElement);r.settings.pointer.lock=!1,r.settings.sensitivity.zoom=.1,r.settings.translation.enabled=!1,r.settings.zoom.maxDistance=40,r.lookAt(e.position),this.controls=r,e.fog=new t.FogExp2(16053492,.025),n.setClearColor(e.fog.color),Ci.resolution=1,mn.air=kn.AIR;var s=new t.Vector3(-.5,-.5,-.5);s.multiplyScalar(1);var a=new Ci,o=new mn(s,1,a,!0,!1);this.hermiteData=a,this.hermiteDataHelper=o,e.add(o);var u=new vs(s,1,a,i,n.domElement);u.addEventListener("update",this),this.hermiteDataEditor=u,e.add(u.gridPoints),e.add(u.edges),e.add(u.planes);e.add(new t.Mesh(new t.BoxBufferGeometry(.95,.95,.95),new t.MeshBasicMaterial({color:13421772,depthWrite:!1,transparent:!0,opacity:.35}))),e.add(this.vertex)}},{key:"update",value:function(t){this.controls.update(t)}},{key:"registerOptions",value:function(t){var e=t.addFolder("Vertex Position");e.add(this.result,"x").listen(),e.add(this.result,"y").listen(),e.add(this.result,"z").listen(),e.add(this,"error").listen(),e.open(),this.hermiteDataEditor.registerOptions(t)}}]),n}(),ys=void 0;function ms(t){requestAnimationFrame(ms),ys.render(t)}function gs(t){document.getElementById("viewport").children[0].style.display="initial"}function ps(t){document.getElementById("viewport").children[0].style.display="none"}window.addEventListener("load",function e(n){this.removeEventListener("load",e);var i=document.getElementById("viewport"),r=new t.WebGLRenderer({logarithmicDepthBuffer:!0,antialias:!0});r.setSize(i.clientWidth,i.clientHeight),r.setPixelRatio(window.devicePixelRatio),r.setClearColor(0),(ys=new te(i,{aside:document.getElementById("aside"),composer:new Mt(r,{stencilBuffer:!0,depthTexture:!0})})).addEventListener("change",gs),ys.addEventListener("load",ps),ys.addDemo(new rs),ys.addDemo(new fs),ms()}),window.addEventListener("resize",function(){var t=0;function e(e){var n=e.target.innerWidth,i=e.target.innerHeight;ys.setSize(n,i),t=0}return function(n){0===t&&(t=setTimeout(e,66,n))}}()),document.addEventListener("keydown",function(t){var e=this.getElementById("aside");t.altKey&&null!==e&&(t.preventDefault(),e.style.visibility="hidden"===e.style.visibility?"visible":"hidden")})}(THREE,dat,Stats);