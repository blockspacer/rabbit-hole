(function(e){"use strict";function t(e,t){var n=e.__state.conversionName.toString(),i=je(e.r),r=je(e.g),o=je(e.b),l=e.a,a=je(e.h),u=e.s.toFixed(1),s=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var d=e.hex.toString(16);6>d.length;)d="0"+d;return"#"+d}return"CSS_RGB"===n?"rgb("+i+","+r+","+o+")":"CSS_RGBA"===n?"rgba("+i+","+r+","+o+","+l+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+i+","+r+","+o+"]":"RGBA_ARRAY"===n?"["+i+","+r+","+o+","+l+"]":"RGB_OBJ"===n?"{r:"+i+",g:"+r+",b:"+o+"}":"RGBA_OBJ"===n?"{r:"+i+",g:"+r+",b:"+o+",a:"+l+"}":"HSV_OBJ"===n?"{h:"+a+",s:"+u+",v:"+s+"}":"HSVA_OBJ"===n?"{h:"+a+",s:"+u+",v:"+s+",a:"+l+"}":"unknown format"}function n(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(xt.recalculateRGB(this,t,n),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(xt.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function i(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(xt.recalculateHSV(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(xt.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}function o(e){if("0"===e||ot.isUndefined(e))return 0;var t=e.match(zt);return ot.isNull(t)?0:parseFloat(t[1])}function s(e){var t=e.toString();return-1<t.indexOf(".")?t.length-t.indexOf(".")-1:0}function h(e,t){var n=qe(10,t);return je(e*n)/n}function g(e,t,n,i,a){return i+(a-i)*((e-t)/(n-t))}function k(e,t,n,i){e.style.background="",ot.each(It,function(a){e.style.cssText+="background: "+a+"linear-gradient("+t+", "+n+" 0%, "+i+" 100%); "})}function _(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}function w(e,t,n){var i=document.createElement("li");return t&&i.appendChild(t),n?e.__ul.insertBefore(i,n):e.__ul.appendChild(i),e.onResize(),i}function S(e){bt.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&bt.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function E(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function A(e,t,n){if(n.__li=t,n.__gui=e,ot.extend(n,{options:function(t){if(1<arguments.length){var i=n.__li.nextElementSibling;return n.remove(),C(e,n.object,n.property,{before:i,factoryArgs:[ot.toArray(arguments)]})}if(ot.isArray(t)||ot.isObject(t)){var a=n.__li.nextElementSibling;return n.remove(),C(e,n.object,n.property,{before:a,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof Ct){var i=new Pt(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});ot.each(["updateDisplay","onChange","onFinishChange","step"],function(e){var t=n[e],a=i[e];n[e]=i[e]=function(){var e=Array.prototype.slice.call(arguments);return a.apply(i,e),t.apply(n,e)}}),bt.addClass(t,"has-slider"),n.domElement.insertBefore(i.domElement,n.domElement.firstElementChild)}else if(n instanceof Pt){var a=function(t){if(ot.isNumber(n.__min)&&ot.isNumber(n.__max)){var i=n.__li.firstElementChild.firstElementChild.innerHTML,a=-1<n.__gui.__listening.indexOf(n);n.remove();var r=C(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return r.name(i),a&&r.listen(),r}return t};n.min=ot.compose(a,n.min),n.max=ot.compose(a,n.max)}else n instanceof wt?(bt.bind(t,"click",function(){bt.fakeEvent(n.__checkbox,"click")}),bt.bind(n.__checkbox,"click",function(t){t.stopPropagation()})):n instanceof Tt?(bt.bind(t,"click",function(){bt.fakeEvent(n.__button,"click")}),bt.bind(t,"mouseover",function(){bt.addClass(n.__button,"hover")}),bt.bind(t,"mouseout",function(){bt.removeClass(n.__button,"hover")})):n instanceof Ot&&(bt.addClass(t,"color"),n.updateDisplay=ot.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=ot.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&E(e.getRoot(),!0),t},n.setValue)}function P(e,t){var n=e.getRoot(),i=n.__rememberedObjects.indexOf(t.object);if(-1!==i){var a=n.__rememberedObjectIndecesToControllers[i];if(void 0===a&&(a={},n.__rememberedObjectIndecesToControllers[i]=a),a[t.property]=t,n.load&&n.load.remembered){var r=n.load.remembered,o=void 0;if(r[e.preset])o=r[e.preset];else if(r.Default)o=r.Default;else return;if(o[i]&&void 0!==o[i][t.property]){var s=o[i][t.property];t.initialValue=s,t.setValue(s)}}}}function C(e,t,n,i){if(void 0===t[n])throw new Error("Object \""+t+"\" has no property \""+n+"\"");var a;if(i.color)a=new Ot(t,n);else{var r=[t,n].concat(i.factoryArgs);a=Dt.apply(e,r)}i.before instanceof kt&&(i.before=i.before.__li),P(e,a),bt.addClass(a.domElement,"c");var o=document.createElement("span");bt.addClass(o,"property-name"),o.innerHTML=a.property;var s=document.createElement("div");s.appendChild(o),s.appendChild(a.domElement);var l=w(e,s,i.before);return bt.addClass(l,Ht.CLASS_CONTROLLER_ROW),a instanceof Ot?bt.addClass(l,"color"):bt.addClass(l,ht(a.getValue())),A(e,l,a),e.__controllers.push(a),a}function T(e,t){return document.location.href+"."+t}function O(e,t,n){var i=document.createElement("option");i.innerHTML=t,i.value=t,e.__preset_select.appendChild(i),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function I(e,t){t.style.display=e.useLocalStorage?"block":"none"}function D(e){var t=e.__save_row=document.createElement("li");bt.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),bt.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",bt.addClass(n,"button gears");var i=document.createElement("span");i.innerHTML="Save",bt.addClass(i,"button"),bt.addClass(i,"save");var a=document.createElement("span");a.innerHTML="New",bt.addClass(a,"button"),bt.addClass(a,"save-as");var r=document.createElement("span");r.innerHTML="Revert",bt.addClass(r,"button"),bt.addClass(r,"revert");var o=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?ot.each(e.load.remembered,function(t,n){O(e,n,n===e.preset)}):O(e,"Default",!1),bt.bind(o,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(o),t.appendChild(n),t.appendChild(i),t.appendChild(a),t.appendChild(r),Rt){var s=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage"),u=document.getElementById("dg-save-locally");u.style.display="block","true"===localStorage.getItem(T(e,"isLocal"))&&l.setAttribute("checked","checked"),I(e,s),bt.bind(l,"change",function(){e.useLocalStorage=!e.useLocalStorage,I(e,s)})}var d=document.getElementById("dg-new-constructor");bt.bind(d,"keydown",function(t){t.metaKey&&(67===t.which||67===t.keyCode)&&Mt.hide()}),bt.bind(n,"click",function(){d.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),Mt.show(),d.focus(),d.select()}),bt.bind(i,"click",function(){e.save()}),bt.bind(a,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),bt.bind(r,"click",function(){e.revert()})}function L(t){function n(n){return n.preventDefault(),t.width+=a-n.clientX,t.onResize(),a=n.clientX,!1}function i(){bt.removeClass(t.__closeButton,Ht.CLASS_DRAG),bt.unbind(window,"mousemove",n),bt.unbind(window,"mouseup",i)}function e(r){return r.preventDefault(),a=r.clientX,bt.addClass(t.__closeButton,Ht.CLASS_DRAG),bt.bind(window,"mousemove",n),bt.bind(window,"mouseup",i),!1}var a;t.__resize_handle=document.createElement("div"),ot.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),bt.bind(t.__resize_handle,"mousedown",e),bt.bind(t.__closeButton,"mousedown",e),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function B(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function F(e,t){var n={};return ot.each(e.__rememberedObjects,function(i,a){var r={},o=e.__rememberedObjectIndecesToControllers[a];ot.each(o,function(e,n){r[n]=t?e.initialValue:e.getValue()}),n[a]=r}),n}function R(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}function M(e){0!==e.length&&Lt.call(window,function(){M(e)}),ot.each(e,function(e){e.updateDisplay()})}function V(e,t,n){return He(Ye(e,n),t)}function N(e,t,n,i,a,r){var o=0;return e>t&&e>n?(a<e&&(o|=2),r<e&&(o|=1)):t>n?(i<t&&(o|=4),r<t&&(o|=1)):(i<n&&(o|=4),a<n&&(o|=2)),o}function U(e,t,n,i){var a=void 0,o=0;return t<n?(a=t,o=0):(a=n,o=1),i<a&&(o=2),r[e][o]}function H(e,t,n,i,a,r,o,s,l){var u=e.children,d=void 0,c=void 0,y=void 0,h=void 0;if(0<=a&&0<=r&&0<=o)if(null===u)l.push(e);else{c=.5*(t+a),y=.5*(n+r),h=.5*(i+o),d=N(t,n,i,c,y,h);do 0===d?(H(u[zi],t,n,i,c,y,h,s,l),d=U(d,c,y,h)):1===d?(H(u[1^zi],t,n,h,c,y,o,s,l),d=U(d,c,y,o)):2===d?(H(u[2^zi],t,y,i,c,r,h,s,l),d=U(d,c,r,h)):3===d?(H(u[3^zi],t,y,h,c,r,o,s,l),d=U(d,c,r,o)):4===d?(H(u[4^zi],c,n,i,a,y,h,s,l),d=U(d,a,y,h)):5===d?(H(u[5^zi],c,n,h,a,y,o,s,l),d=U(d,a,y,o)):6===d?(H(u[6^zi],c,y,i,a,r,h,s,l),d=U(d,a,r,h)):7===d?(H(u[7^zi],c,y,h,a,r,o,s,l),d=8):void 0;while(8>d)}}function Y(e){var t=e.children,n=0,a=void 0,r=void 0,o=void 0;if(null!==t)for(a=0,r=t.length;a<r;++a)o=1+Y(t[a]),o>n&&(n=o);return n}function X(e,t,n){var a=e.children,r=void 0,o=void 0;if(wi.min=e.min,wi.max=e.max,t.intersectsBox(wi))if(null!==a)for(r=0,o=a.length;r<o;++r)X(a[r],t,n);else n.push(e)}function j(e,t,n,a){var r=e.children,o=void 0,s=void 0;if(n===t)a.push(e);else if(null!==r)for(++n,o=0,s=r.length;o<s;++o)j(r[o],t,n,a)}function G(e){var t=e.children,n=0,a=void 0,r=void 0;if(null!==t)for(a=0,r=t.length;a<r;++a)n+=G(t[a]);else null!==e.points&&(n=e.points.length);return n}function Z(e,t,n,a,r){var o=a.children,s=!1,u=!1,d=void 0,c=void 0;if(a.contains(e,n.bias)){if(null===o){if(null===a.points)a.points=[],a.data=[];else for(d=0,c=a.points.length;!s&&d<c;++d)s=a.points[d].equals(e);s?(a.data[d-1]=t,u=!0):a.points.length<n.maxPoints||r===n.maxDepth?(a.points.push(e.clone()),a.data.push(t),++n.pointCount,u=!0):(a.split(),a.redistribute(n.bias),o=a.children)}if(null!==o)for(++r,d=0,c=o.length;!u&&d<c;++d)u=Z(e,t,n,o[d],r)}return u}function K(e,t,n,a){var r=n.children,o=null,s=void 0,u=void 0,d=void 0,c=void 0,y=void 0;if(n.contains(e,t.bias))if(null!==r)for(s=0,u=r.length;null===o&&s<u;++s)o=K(e,t,r[s],n);else if(null!==n.points)for(d=n.points,c=n.data,(s=0,u=d.length);s<u;++s)if(d[s].equals(e)){y=u-1,o=c[s],s<y&&(d[s]=d[y],c[s]=c[y]),d.pop(),c.pop(),--t.pointCount,null!==a&&G(a)<=t.maxPoints&&a.merge();break}return o}function W(e,t,n){var a=n.children,r=null,o=void 0,s=void 0,u=void 0;if(n.contains(e,t.bias))if(null!==a)for(o=0,s=a.length;null===r&&o<s;++o)r=W(e,t,a[o]);else if(null!==n.points)for(u=n.points,o=0,s=u.length;null===r&&o<s;++o)e.distanceToSquared(u[o])<=Pi&&(r=n.data[o]);return r}function Q(e,t,n,a,r,o){var s=a.children,u=null,d=void 0,c=void 0,y=void 0;if(a.contains(e,n.bias))if(!a.contains(t,n.bias))u=K(e,n,a,r),Z(t,u,n,r,o-1);else if(null!==s)for(++o,d=0,c=s.length;null===u&&d<c;++d)u=Q(e,t,n,s[d],a,o);else if(null!==a.points)for(y=a.points,d=0,c=y.length;d<c;++d)if(e.distanceToSquared(y[d])<=Pi){y[d].copy(t),u=a.data[d];break}return u}function $(e,t,n,a){var r=a.points,o=a.children,s=null,u=t,d=void 0,c=void 0,y=void 0,h=void 0,m=void 0,g=void 0,v=void 0;if(null!==o)for(m=o.map(function(t){return{octant:t,distance:t.distanceToCenterSquared(e)}}).sort(function(e,t){return e.distance-t.distance}),d=0,c=m.length;d<c;++d)g=m[d].octant,g.contains(e,u)&&(v=$(e,u,n,g),null!==v&&(h=v.point.distanceToSquared(e),(!n||0<h)&&h<u&&(u=h,s=v)));else if(null!==r)for(d=0,c=r.length;d<c;++d)y=r[d],h=e.distanceToSquared(y),(!n||0<h)&&h<u&&(u=h,s={point:y.clone(),data:a.data[d]});return s}function J(e,t,n,a,r){var o=a.points,s=a.children,u=void 0,d=void 0,c=void 0,y=void 0,h=void 0;if(null!==s)for(u=0,d=s.length;u<d;++u)h=s[u],h.contains(e,t)&&J(e,t,n,h,r);else if(null!==o)for(u=0,d=o.length;u<d;++u)c=o[u],y=e.distanceToSquared(c),(!n||0<y)&&y<=t*t&&r.push({point:c.clone(),data:a.data[u]})}function ee(e){var t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=t.getContext("2d");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height)}function te(e,t,n,a,r,o,s){var l=void 0,u=void 0,d=void 0,c=void 0,y=void 0,h=void 0;if(n.csg.add(t),0<s)for(--s,l=e.getGrid(s),u=e.getKeyDesign(),d=n.children,c=xa[s],a<<=1,r<<=1,o<<=1,h=0;8>h;++h)0!=(d&1<<h)&&(y=hi[h],ma.set(a+y[0],r+y[1],o+y[2]),c.containsPoint(ma)&&te(e,t,l.get(u.packKey(ma)),ma.x,ma.y,ma.z,s))}function ne(e,t,n,i,a,r){var o=0;return e>t&&e>n?(a<e&&(o|=2),r<e&&(o|=1)):t>n?(i<t&&(o|=4),r<t&&(o|=1)):(i<n&&(o|=4),a<n&&(o|=2)),o}function ie(e,t,n,i){var a=void 0,r=0;return t<n?(a=t,r=0):(a=n,r=1),i<a&&(r=2),wa[e][r]}function ae(e,t,n,a,r,o,s,l,u,d,c,y,h){var m=void 0,p=void 0,g=void 0,v=void 0,f=void 0,x=void 0,k=void 0,_=void 0,z=void 0,b=void 0,w=void 0;if(0<=d&&0<=c&&0<=y)if(m=e.getKeyDesign(),0===o||null!==t.isosurface)p=e.getCellSize(o),g=new da(t),g.id.set(o,m.packKey(_a.set(n,a,r))),g.min.copy(_a).multiplyScalar(p).add(e.min),g.max.copy(g.min).addScalar(p),h.push(g);else if(0<t.children){v=e.getGrid(--o),f=t.children,n<<=1,a<<=1,r<<=1,_=.5*(s+d),z=.5*(l+c),b=.5*(u+y),k=ne(s,l,u,_,z,b);do switch(w=Sa^k,k){case 0:{0!=(f&1<<w)&&(x=hi[w],_a.set(n+x[0],a+x[1],r+x[2]),ae(e,v.get(m.packKey(_a)),_a.x,_a.y,_a.z,o,s,l,u,_,z,b,h)),k=ie(k,_,z,b);break}case 1:{0!=(f&1<<w)&&(x=hi[w],_a.set(n+x[0],a+x[1],r+x[2]),ae(e,v.get(m.packKey(_a)),_a.x,_a.y,_a.z,o,s,l,b,_,z,y,h)),k=ie(k,_,z,y);break}case 2:{0!=(f&1<<w)&&(x=hi[w],_a.set(n+x[0],a+x[1],r+x[2]),ae(e,v.get(m.packKey(_a)),_a.x,_a.y,_a.z,o,s,z,u,_,c,b,h)),k=ie(k,_,c,b);break}case 3:{0!=(f&1<<w)&&(x=hi[w],_a.set(n+x[0],a+x[1],r+x[2]),ae(e,v.get(m.packKey(_a)),_a.x,_a.y,_a.z,o,s,z,b,_,c,y,h)),k=ie(k,_,c,y);break}case 4:{0!=(f&1<<w)&&(x=hi[w],_a.set(n+x[0],a+x[1],r+x[2]),ae(e,v.get(m.packKey(_a)),_a.x,_a.y,_a.z,o,_,l,u,d,z,b,h)),k=ie(k,d,z,b);break}case 5:{0!=(f&1<<w)&&(x=hi[w],_a.set(n+x[0],a+x[1],r+x[2]),ae(e,v.get(m.packKey(_a)),_a.x,_a.y,_a.z,o,_,l,b,d,z,y,h)),k=ie(k,d,z,y);break}case 6:{0!=(f&1<<w)&&(x=hi[w],_a.set(n+x[0],a+x[1],r+x[2]),ae(e,v.get(m.packKey(_a)),_a.x,_a.y,_a.z,o,_,z,u,d,c,b,h)),k=ie(k,d,c,b);break}case 7:{0!=(f&1<<w)&&(x=hi[w],_a.set(n+x[0],a+x[1],r+x[2]),ae(e,v.get(m.packKey(_a)),_a.x,_a.y,_a.z,o,_,z,b,d,c,y,h)),k=8;break}}while(8>k)}}function re(e,t,n,i,a){var r=l.min.set(0,0,0),o=l.max.subVectors(t.max,t.min),s=t.getDimensions(ba.min),u=ba.max.copy(s).multiplyScalar(.5),c=d.origin.copy(i.origin),y=d.direction.copy(i.direction),h=void 0,m=void 0,p=void 0,g=void 0,v=void 0,f=void 0,x=void 0,k=void 0,_=void 0;c.sub(t.getCenter(_a)).add(u),Sa=0,0>y.x&&(c.x=s.x-c.x,y.x=-y.x,Sa|=4),0>y.y&&(c.y=s.y-c.y,y.y=-y.y,Sa|=2),0>y.z&&(c.z=s.z-c.z,y.z=-y.z,Sa|=1),h=1/y.x,m=1/y.y,p=1/y.z,g=(r.x-c.x)*h,v=(o.x-c.x)*h,f=(r.y-c.y)*m,x=(o.y-c.y)*m,k=(r.z-c.z)*p,_=(o.z-c.z)*p,ae(e,t.octant,n.x,n.y,n.z,e.getDepth(),g,f,k,v,x,_,a)}function oe(e,t,n,a,r,o){var s=void 0,l=void 0,u=void 0,d=void 0,c=void 0,y=void 0,h=void 0;if(0<o){for(--o,s=e.getGrid(o),l=e.getKeyDesign(),u=t.children,n<<=1,a<<=1,r<<=1,h=0;8>h;++h)0!=(u&1<<h)&&(c=hi[h],Aa.set(n+c[0],a+c[1],r+c[2]),y=l.packKey(Aa),d=s.get(y),s.delete(y),oe(e,d,Aa.x,Aa.y,Aa.z,o));t.children=0}}function se(e,t,n,a,r){var o,s,l,u;++r<e.levels&&(o=e.getGrid(r),s=Pa.calculateOffsetIndex(t,n,a),Aa.set(t>>>1,n>>>1,a>>>1),l=e.getKeyDesign().packKey(Aa),u=o.get(l),u.children&=~(1<<s),0===u.children&&(o.delete(l),se(e,Aa.x,Aa.y,Aa.z,r)))}function le(e,t,n){var a=[-1,-1,-1,-1],r=[!1,!1,!1,!1],o=1/0,s=0,l=!1,u=void 0,d=void 0,c=void 0,y=void 0,h=void 0,m=void 0,p=void 0;for(p=0;4>p;++p)h=e[p],m=sr[t][p],u=mi[m][0],d=mi[m][1],c=1&h.voxel.materials>>u,y=1&h.voxel.materials>>d,h.size<o&&(o=h.size,s=p,l=c!==ai.AIR),a[p]=h.voxel.index,r[p]=c!=y;r[s]&&(l?(n.push(a[0]),n.push(a[3]),n.push(a[1]),n.push(a[0]),n.push(a[2]),n.push(a[3])):(n.push(a[0]),n.push(a[1]),n.push(a[3]),n.push(a[0]),n.push(a[3]),n.push(a[2])))}function ue(e,t,n){var a=[0,0,0,0],r=void 0,o=void 0,s=void 0,l=void 0;if(null!==e[0].voxel&&null!==e[1].voxel&&null!==e[2].voxel&&null!==e[3].voxel)le(e,t,n);else for(s=0;2>s;++s){for(a[0]=or[t][s][0],a[1]=or[t][s][1],a[2]=or[t][s][2],a[3]=or[t][s][3],r=[],l=0;4>l;++l)if(o=e[l],null!==o.voxel)r[l]=o;else if(null!==o.children)r[l]=o.children[a[l]];else break;4===l&&ue(r,or[t][s][4],n)}}function de(e,t,n){var a=[0,0,0,0],r=[[0,0,1,1],[0,1,0,1]],o=void 0,s=void 0,l=void 0,u=void 0,d=void 0,c=void 0;if(null!==e[0].children||null!==e[1].children){for(d=0;4>d;++d)a[0]=ar[t][d][0],a[1]=ar[t][d][1],o=[null===e[0].children?e[0]:e[0].children[a[0]],null===e[1].children?e[1]:e[1].children[a[1]]],de(o,ar[t][d][2],n);for(d=0;4>d;++d){for(a[0]=rr[t][d][1],a[1]=rr[t][d][2],a[2]=rr[t][d][3],a[3]=rr[t][d][4],l=r[rr[t][d][0]],s=[],c=0;4>c;++c)if(u=e[l[c]],null!==u.voxel)s[c]=u;else if(null!==u.children)s[c]=u.children[a[c]];else break;4===c&&ue(s,rr[t][d][5],n)}}}function ce(e,t){var n=e.children,a=[0,0,0,0],r=void 0,o=void 0,s=void 0;if(null!==n){for(s=0;8>s;++s)ce(n[s],t);for(s=0;12>s;++s)a[0]=nr[s][0],a[1]=nr[s][1],r=[n[a[0]],n[a[1]]],de(r,nr[s][2],t);for(s=0;6>s;++s)a[0]=ir[s][0],a[1]=ir[s][1],a[2]=ir[s][2],a[3]=ir[s][3],o=[n[a[0]],n[a[1]],n[a[2]],n[a[3]]],ue(o,ir[s][4],t)}}function ye(e,t,n,a){var r,o;if(null!==e.children)for(r=0;8>r;++r)a=ye(e.children[r],t,n,a);else null!==e.voxel&&(o=e.voxel,o.index=a,t[3*a]=o.position.x,t[3*a+1]=o.position.y,t[3*a+2]=o.position.z,n[3*a]=o.normal.x,n[3*a+1]=o.normal.y,n[3*a+2]=o.normal.z,++a);return a}function he(e,t){var n=e.elements,i=t.elements,a=void 0;0!==n[1]&&(a=dr.calculateCoefficients(n[0],n[1],n[3]),cr.rotateQXY(pr.set(n[0],n[3]),n[1],a),n[0]=pr.x,n[3]=pr.y,cr.rotateXY(pr.set(n[2],n[4]),a),n[2]=pr.x,n[4]=pr.y,n[1]=0,cr.rotateXY(pr.set(i[0],i[3]),a),i[0]=pr.x,i[3]=pr.y,cr.rotateXY(pr.set(i[1],i[4]),a),i[1]=pr.x,i[4]=pr.y,cr.rotateXY(pr.set(i[2],i[5]),a),i[2]=pr.x,i[5]=pr.y)}function me(e,t){var n=e.elements,i=t.elements,a=void 0;0!==n[2]&&(a=dr.calculateCoefficients(n[0],n[2],n[5]),cr.rotateQXY(pr.set(n[0],n[5]),n[2],a),n[0]=pr.x,n[5]=pr.y,cr.rotateXY(pr.set(n[1],n[4]),a),n[1]=pr.x,n[4]=pr.y,n[2]=0,cr.rotateXY(pr.set(i[0],i[6]),a),i[0]=pr.x,i[6]=pr.y,cr.rotateXY(pr.set(i[1],i[7]),a),i[1]=pr.x,i[7]=pr.y,cr.rotateXY(pr.set(i[2],i[8]),a),i[2]=pr.x,i[8]=pr.y)}function pe(e,t){var n=e.elements,i=t.elements,a=void 0;0!==n[4]&&(a=dr.calculateCoefficients(n[3],n[4],n[5]),cr.rotateQXY(pr.set(n[3],n[5]),n[4],a),n[3]=pr.x,n[5]=pr.y,cr.rotateXY(pr.set(n[1],n[2]),a),n[1]=pr.x,n[2]=pr.y,n[4]=0,cr.rotateXY(pr.set(i[3],i[6]),a),i[3]=pr.x,i[6]=pr.y,cr.rotateXY(pr.set(i[4],i[7]),a),i[4]=pr.x,i[7]=pr.y,cr.rotateXY(pr.set(i[5],i[8]),a),i[5]=pr.x,i[8]=pr.y)}function ge(t,n){var a=t.elements,e=void 0;for(e=0;e<5;++e)he(t,n),me(t,n),pe(t,n);return gr.set(a[0],a[3],a[5])}function fe(e){var t=Ue(e)<yr?0:1/e;return Ue(t)<yr?0:t}function ve(e,t){var n=e.elements,i=n[0],a=n[3],r=n[6],o=n[1],s=n[4],l=n[7],u=n[2],d=n[5],c=n[8],y=fe(t.x),h=fe(t.y),m=fe(t.z);return e.set(i*y*i+a*h*a+r*m*r,i*y*o+a*h*s+r*m*l,i*y*u+a*h*d+r*m*c,o*y*i+s*h*a+l*m*r,o*y*o+s*h*s+l*m*l,o*y*u+s*h*d+l*m*c,u*y*i+d*h*a+c*m*r,u*y*o+d*h*s+c*m*l,u*y*u+d*h*d+c*m*c)}function xe(e,t,n){return e.applyToVector3(fr.copy(n)),fr.subVectors(t,fr),fr.dot(fr)}function ke(e,t,a,r,o){var s=0;for(t>>=1;0<t;t>>=1,s=0)a>=t&&(s+=4,a-=t),r>=t&&(s+=2,r-=t),o>=t&&(s+=1,o-=t),null===e.children&&e.split(),e=e.children[s];return e}function _e(e,t,n,a,r){var o=e+1,s=new _r,l=void 0,u=void 0,d=void 0,c=void 0,y=void 0,h=void 0,m=void 0,p=void 0,g=void 0,v=void 0;for(l=0,v=0;8>v;++v)c=hi[v],y=(a+c[2])*(o*o)+(n+c[1])*o+(t+c[0]),d=Ye(r[y],ai.SOLID),l|=d<<v;for(u=0,v=0;12>v;++v)h=mi[v][0],m=mi[v][1],p=1&l>>h,g=1&l>>m,p!=g&&++u;return s.materials=l,s.edgeCount=u,s.qefData=new kr,s}function ze(e){var t=Ar,i=ji.resolution,n=new Qt(0,0,0),a=new Qt(i,i,i),r=new v(Pr,Pr.clone().addScalar(Ar)),o=e.getBoundingBox();return e.type!==ii.INTERSECTION&&(o.intersectsBox(r)?(n.copy(o.min).max(r.min).sub(r.min),n.x=Fe(n.x*i/t),n.y=Fe(n.y*i/t),n.z=Fe(n.z*i/t),a.copy(o.max).min(r.max).sub(r.min),a.x=Xe(a.x*i/t),a.y=Xe(a.y*i/t),a.z=Xe(a.z*i/t)):(n.set(i,i,i),a.set(0,0,0))),new v(n,a)}function be(e,t,i,a){var r=ji.resolution,n=r+1,o=a.max.x,s=a.max.y,l=a.max.z,u=void 0,d=void 0,c=void 0;for(c=a.min.z;c<=l;++c)for(d=a.min.y;d<=s;++d)for(u=a.min.x;u<=o;++u)e.updateMaterialIndex(c*(n*n)+d*n+u,t,i)}function we(e,t,i){var a=Ar,r=ji.resolution,n=r+1,o=t.materialIndices,s=new Qt,l=new Qt,u=i.max.x,d=i.max.y,c=i.max.z,h=void 0,m=0,p=void 0,g=void 0,v=void 0;for(v=i.min.z;v<=c;++v)for(s.z=v*a/r,g=i.min.y;g<=d;++g)for(s.y=g*a/r,p=i.min.x;p<=u;++p)s.x=p*a/r,h=e.generateMaterialIndex(l.addVectors(Pr,s)),h!==ai.AIR&&(o[v*(n*n)+g*n+p]=h,++m);t.materials=m}function Se(e,t,a){var r=ji.resolution,n=r+1,o=new Uint32Array([1,n,n*n]),s=t.materialIndices,l=new Ri,u=new Ri,y=a.edgeData,h=t.edgeData,m=new Uint32Array(3),p=Ui.calculate1DEdgeCount(r),g=new Ui(r,Ye(p,h.indices[0].length+y.indices[0].length),Ye(p,h.indices[1].length+y.indices[1].length),Ye(p,h.indices[2].length+y.indices[2].length)),v=void 0,f=void 0,x=void 0,k=void 0,_=void 0,z=void 0,b=void 0,w=void 0,S=void 0,E=void 0,A=void 0,P=void 0,C=void 0,T=void 0,O=void 0,I=void 0,D=void 0,L=void 0,B=void 0,F=void 0,R=void 0,M=void 0,V=void 0;for(L=0,B=0;3>B;L=0,++B){for(v=y.indices[B],k=h.indices[B],b=g.indices[B],f=y.zeroCrossings[B],_=h.zeroCrossings[B],w=g.zeroCrossings[B],x=y.normals[B],z=h.normals[B],S=g.normals[B],E=o[B],M=v.length,V=k.length,(F=0,R=0);F<M;++F)if(A=v[F],P=A+E,O=s[A],I=s[P],O!==I&&(O===ai.AIR||I===ai.AIR)){for(l.t=f[F],l.n.x=x[3*F],l.n.y=x[3*F+1],l.n.z=x[3*F+2],e.type===ii.DIFFERENCE&&l.n.negate(),D=l;R<V&&k[R]<=A;)C=k[R],T=C+E,u.t=_[R],u.n.x=z[3*R],u.n.y=z[3*R+1],u.n.z=z[3*R+2],O=s[C],C<A?(I=s[T],O!==I&&(O===ai.AIR||I===ai.AIR)&&(b[L]=C,w[L]=u.t,S[3*L]=u.n.x,S[3*L+1]=u.n.y,S[3*L+2]=u.n.z,++L)):D=e.selectEdge(u,l,O===ai.SOLID),++R;b[L]=A,w[L]=D.t,S[3*L]=D.n.x,S[3*L+1]=D.n.y,S[3*L+2]=D.n.z,++L}for(;R<V;)C=k[R],T=C+E,O=s[C],I=s[T],O!==I&&(O===ai.AIR||I===ai.AIR)&&(b[L]=C,w[L]=_[R],S[3*L]=z[3*R],S[3*L+1]=z[3*R+1],S[3*L+2]=z[3*R+2],++L),++R;m[B]=L}return{edgeData:g,lengths:m}}function Ee(e,t,i){var r=Ar,o=ji.resolution,n=o+1,s=n*n,l=new Uint32Array([1,n,s]),u=t.materialIndices,h=Pr,m=new Qt,p=new Qt,g=new Ri,v=new Uint32Array(3),f=new Ui(o,Ui.calculate1DEdgeCount(o)),k=void 0,_=void 0,b=void 0,w=void 0,S=void 0,E=void 0,A=void 0,P=void 0,C=void 0,T=void 0,O=void 0,I=void 0,D=void 0,L=void 0,B=void 0,F=void 0,R=void 0,M=void 0,V=void 0;for(B=4,D=0,L=0;3>L;B>>=1,D=0,++L){F=hi[B],k=f.indices[L],_=f.zeroCrossings[L],b=f.normals[L],w=l[L],A=i.min.x,T=i.max.x,P=i.min.y,O=i.max.y,C=i.min.z,I=i.max.z;for(0===L?(A=He(A-1,0),T=Ye(T,o-1)):1===L?(P=He(P-1,0),O=Ye(O,o-1)):2===L?(C=He(C-1,0),I=Ye(I,o-1)):void 0,V=C;V<=I;++V)for(M=P;M<=O;++M)for(R=A;R<=T;++R)S=V*s+M*n+R,E=S+w,u[S]!==u[E]&&(m.set(R*r/o,M*r/o,V*r/o),p.set((R+F[0])*r/o,(M+F[1])*r/o,(V+F[2])*r/o),g.a.addVectors(h,m),g.b.addVectors(h,p),e.generateEdge(g),k[D]=S,_[D]=g.t,b[3*D]=g.n.x,b[3*D+1]=g.n.y,b[3*D+2]=g.n.z,++D);v[L]=D}return{edgeData:f,lengths:v}}function Ae(e,t,n){var i=ze(e),a=void 0,r=void 0,o=void 0,s=void 0,l=!1;if(e.type===ii.DENSITY_FUNCTION?we(e,t,i):t.empty?e.type===ii.UNION&&(t.set(n),l=!0):!(t.full&&e.type===ii.UNION)&&be(e,t,n,i),!l&&!t.empty&&!t.full){for(a=e.type===ii.DENSITY_FUNCTION?Ee(e,t,i):Se(e,t,n),r=a.edgeData,o=a.lengths,s=0;3>s;++s)r.indices[s]=r.indices[s].slice(0,o[s]),r.zeroCrossings[s]=r.zeroCrossings[s].slice(0,o[s]),r.normals[s]=r.normals[s].slice(0,3*o[s]);t.edgeData=r}}function Pe(e){var t=e.children,n=void 0,a=void 0,r=void 0,o=void 0;for(e.type===ii.DENSITY_FUNCTION&&(n=new ji,Ae(e,n)),r=0,o=t.length;r<o&&(a=Pe(t[r]),void 0===n?n=a:null===a?e.type===ii.INTERSECTION&&(n=null):null===n?e.type===ii.UNION&&(n=a):Ae(e,n,a),null!==n||e.type===ii.UNION);++r);return null!==n&&n.empty?null:n}function Ce(e){requestAnimationFrame(Ce),Xr.render(e)}function Te(){document.getElementById("viewport").children[0].style.display="initial"}function Oe(){document.getElementById("viewport").children[0].style.display="none"}var Ie=Math.trunc,De=Math.sign,Le=Math.PI,Be=Math.atan2,Fe=Math.ceil,Re=Math.acos,Me=Math.sqrt,Ve=Math.cos,Ne=Math.sin,qe=Math.pow,Ue=Math.abs,He=Math.max,Ye=Math.min,Xe=Math.floor,je=Math.round,Ge=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Ze=function(){function e(e,t){for(var n=0,a;n<t.length;n++)a=t[n],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Ke=function e(t,n,i){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,i)}if("value"in a)return a.value;var o=a.get;return void 0===o?void 0:o.call(i)},We=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Qe=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e},$e=function e(t,n,i,a){var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);null!==o&&e(o,n,i,a)}else if("value"in r&&r.writable)r.value=i;else{var s=r.set;void 0!==s&&s.call(a,i)}return i},Je=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},et=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"demo";Ge(this,t),this.id=n,this.renderer=null,this.loadingManager=new e.LoadingManager,this.assets=new Map,this.scene=new e.Scene,this.camera=null,this.controls=null,this.ready=!1}return Ze(t,[{key:"setRenderer",value:function(e){return this.renderer=e,this}},{key:"load",value:function(){return Promise.resolve()}},{key:"initialize",value:function(){}},{key:"render",value:function(){this.renderer.render(this.scene,this.camera)}},{key:"registerOptions",value:function(){}},{key:"reset",value:function(){var t=this.scene.fog;return this.scene=new e.Scene,this.scene.fog=t,this.camera=null,null!==this.controls&&(this.controls.dispose(),this.controls=null),this.ready=!1,this}}]),t}(),tt=function e(t){Ge(this,e),this.type=t,this.target=null},nt=function(){function e(){Ge(this,e),this.listenerFunctions=new Map,this.listenerObjects=new Map}return Ze(e,[{key:"addEventListener",value:function(e,t){var n="function"==typeof t?this.listenerFunctions:this.listenerObjects;n.has(e)?n.get(e).add(t):n.set(e,new Set([t]))}},{key:"removeEventListener",value:function(e,t){var n="function"==typeof t?this.listenerFunctions:this.listenerObjects,i=void 0;n.has(e)&&(i=n.get(e),i.delete(t),0===i.size&&n.delete(e))}},{key:"dispatchEvent",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this,n=t.listenerFunctions,i=t.listenerObjects,a=void 0,r=void 0;if(e.target=t,n.has(e.type)){a=n.get(e.type);var o=!0,s=!1,l=void 0;try{for(var u=a[Symbol.iterator](),d;!(o=(d=u.next()).done);o=!0)r=d.value,r.call(t,e)}catch(e){s=!0,l=e}finally{try{!o&&u.return&&u.return()}finally{if(s)throw l}}}if(i.has(e.type)){a=i.get(e.type);var c=!0,y=!1,h=void 0;try{for(var m=a[Symbol.iterator](),p;!(c=(p=m.next()).done);c=!0)r=p.value,r.handleEvent(e)}catch(e){y=!0,h=e}finally{try{!c&&m.return&&m.return()}finally{if(y)throw h}}}}}]),e}(),it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},at=Array.prototype.forEach,rt=Array.prototype.slice,ot={BREAK:{},extend:function(e){return this.each(rt.call(arguments,1),function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))},this),e},defaults:function(e){return this.each(rt.call(arguments,1),function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))},this),e},compose:function(){var e=rt.call(arguments);return function(){for(var t=rt.call(arguments),n=e.length-1;0<=n;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,n){if(e)if(at&&e.forEach&&e.forEach===at)e.forEach(t,n);else if(e.length===e.length+0){var i=void 0,a=void 0;for(i=0,a=e.length;i<a;i++)if(i in e&&t.call(n,e[i],i)===this.BREAK)return}else for(var r in e)if(t.call(n,e[r],r)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var i;return function(){var a=this,r=arguments,o=n||!i;clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(a,r)},t),o&&e.apply(a,r)}},toArray:function(e){return e.toArray?e.toArray():rt.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return isNaN(e)}),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},st=[{litmus:ot.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:t},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:t},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:t},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:t}}},{litmus:ot.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:ot.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:ot.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(ot.isNumber(e.r)&&ot.isNumber(e.g)&&ot.isNumber(e.b)&&ot.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(ot.isNumber(e.r)&&ot.isNumber(e.g)&&ot.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(ot.isNumber(e.h)&&ot.isNumber(e.s)&&ot.isNumber(e.v)&&ot.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(ot.isNumber(e.h)&&ot.isNumber(e.s)&&ot.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],lt=void 0,ut=void 0,dt=function(){ut=!1;var e=1<arguments.length?ot.toArray(arguments):arguments[0];return ot.each(st,function(t){if(t.litmus(e))return ot.each(t.conversions,function(t,n){if(lt=t.read(e),!1===ut&&!1!==lt)return ut=lt,lt.conversionName=n,lt.conversion=t,ot.BREAK}),ot.BREAK}),ut},ct=void 0,yt={hsv_to_rgb:function(e,n,i){var a=Xe(e/60)%6,r=e/60-Xe(e/60),o=i*(1-n),s=i*(1-r*n),l=i*(1-(1-r)*n),t=[[i,l,o],[s,i,o],[o,i,l],[o,s,i],[l,o,i],[i,o,s]][a];return{r:255*t[0],g:255*t[1],b:255*t[2]}},rgb_to_hsv:function(e,t,n){var i=Ye(e,t,n),a=He(e,t,n),r=a-i,o=void 0,l=void 0;if(0!==a)l=r/a;else return{h:NaN,s:0,v:0};return o=e===a?(t-n)/r:t===a?2+(n-e)/r:4+(e-t)/r,o/=6,0>o&&(o+=1),{h:360*o,s:l,v:a/255}},rgb_to_hex:function(e,t,n){var i=this.hex_with_component(0,2,e);return i=this.hex_with_component(i,1,t),i=this.hex_with_component(i,0,n),i},component_from_hex:function(e,t){return 255&e>>8*t},hex_with_component:function(e,t,n){return n<<(ct=8*t)|e&~(255<<ct)}},ht="function"==typeof Symbol&&"symbol"===it(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":it(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":"undefined"==typeof e?"undefined":it(e)},mt=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},pt=function(){function e(e,t){for(var n=0,a;n<t.length;n++)a=t[n],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),gt=function e(t,n,i){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,i)}if("value"in a)return a.value;var o=a.get;return void 0===o?void 0:o.call(i)},vt=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":it(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},ft=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"===("undefined"==typeof t?"undefined":it(t))||"function"==typeof t)?t:e},xt=function(){function e(){if(mt(this,e),this.__state=dt.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return pt(e,[{key:"toString",value:function(){return t(this)}},{key:"toHexString",value:function(){return t(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();xt.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=yt.component_from_hex(e.__state.hex,n);else if("HSV"===e.__state.space)ot.extend(e.__state,yt.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v));else throw new Error("Corrupted color state")},xt.recalculateHSV=function(e){var t=yt.rgb_to_hsv(e.r,e.g,e.b);ot.extend(e.__state,{s:t.s,v:t.v}),ot.isNaN(t.h)?ot.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},xt.COMPONENTS=["r","g","b","h","s","v","hex","a"],n(xt.prototype,"r",2),n(xt.prototype,"g",1),n(xt.prototype,"b",0),i(xt.prototype,"h"),i(xt.prototype,"s"),i(xt.prototype,"v"),Object.defineProperty(xt.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(xt.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=yt.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var kt=function(){function e(t,n){mt(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return pt(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),_t={};ot.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){ot.each(e,function(n){_t[n]=t})});var zt=/(\d+(\.\d+)?)px/,bt={makeSelectable:function(e,t){void 0===e||void 0===e.style||(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var i=n,a=t;ot.isUndefined(a)&&(a=!0),ot.isUndefined(i)&&(i=!0),e.style.position="absolute",a&&(e.style.left=0,e.style.right=0),i&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,i){var a=n||{},r=_t[t];if(!r)throw new Error("Event type "+t+" not supported.");var o=document.createEvent(r);switch(r){case"MouseEvents":{var s=a.x||a.clientX||0,l=a.y||a.clientY||0;o.initMouseEvent(t,a.bubbles||!1,a.cancelable||!0,window,a.clickCount||1,0,0,s,l,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var u=o.initKeyboardEvent||o.initKeyEvent;ot.defaults(a,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),u(t,a.bubbles||!1,a.cancelable,window,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.keyCode,a.charCode);break}default:{o.initEvent(t,a.bubbles||!1,a.cancelable||!0);break}}ot.defaults(o,i),e.dispatchEvent(o)},bind:function(e,t,n,i){return e.addEventListener?e.addEventListener(t,n,i||!1):e.attachEvent&&e.attachEvent("on"+t,n),bt},unbind:function(e,t,n,i){return e.removeEventListener?e.removeEventListener(t,n,i||!1):e.detachEvent&&e.detachEvent("on"+t,n),bt},addClass:function(e,t){if(e.className===void 0)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return bt},removeClass:function(e,t){if(!t)e.className=void 0;else if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),i=n.indexOf(t);-1!==i&&(n.splice(i,1),e.className=n.join(" "))}return bt},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return o(t["border-left-width"])+o(t["border-right-width"])+o(t["padding-left"])+o(t["padding-right"])+o(t.width)},getHeight:function(e){var t=getComputedStyle(e);return o(t["border-top-width"])+o(t["border-bottom-width"])+o(t["padding-top"])+o(t["padding-bottom"])+o(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent;while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},wt=function(e){function t(e,n){mt(this,t);var i=ft(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),a=i;return i.__prev=i.getValue(),i.__checkbox=document.createElement("input"),i.__checkbox.setAttribute("type","checkbox"),bt.bind(i.__checkbox,"change",function(){a.setValue(!a.__prev)},!1),i.domElement.appendChild(i.__checkbox),i.updateDisplay(),i}return vt(t,e),pt(t,[{key:"setValue",value:function(e){var n=gt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),gt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(kt),St=function(e){function t(e,n,i){mt(this,t);var a=ft(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),r=i,o=a;if(a.__select=document.createElement("select"),ot.isArray(r)){var s={};ot.each(r,function(e){s[e]=e}),r=s}return ot.each(r,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),o.__select.appendChild(n)}),a.updateDisplay(),bt.bind(a.__select,"change",function(){var e=this.options[this.selectedIndex].value;o.setValue(e)}),a.domElement.appendChild(a.__select),a}return vt(t,e),pt(t,[{key:"setValue",value:function(e){var n=gt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return bt.isActive(this.__select)?this:(this.__select.value=this.getValue(),gt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(kt),Et=function(e){function t(e,n){function i(){r.setValue(r.__input.value)}mt(this,t);var a=ft(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),r=a;return a.__input=document.createElement("input"),a.__input.setAttribute("type","text"),bt.bind(a.__input,"keyup",i),bt.bind(a.__input,"change",i),bt.bind(a.__input,"blur",function(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}),bt.bind(a.__input,"keydown",function(t){13===t.keyCode&&this.blur()}),a.updateDisplay(),a.domElement.appendChild(a.__input),a}return vt(t,e),pt(t,[{key:"updateDisplay",value:function(){return bt.isActive(this.__input)||(this.__input.value=this.getValue()),gt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(kt),At=function(e){function t(e,n,i){mt(this,t);var a=ft(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),r=i||{};return a.__min=r.min,a.__max=r.max,a.__step=r.step,a.__impliedStep=ot.isUndefined(a.__step)?0===a.initialValue?1:qe(10,Xe(Math.log(Ue(a.initialValue))/Math.LN10))/10:a.__step,a.__precision=s(a.__impliedStep),a}return vt(t,e),pt(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&0!=n%this.__step&&(n=je(n/this.__step)*this.__step),gt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=s(e),this}}]),t}(kt),Pt=function(e){function t(e,n,i){function a(){l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}function r(t){var e=u-t.clientY;l.setValue(l.getValue()+e*l.__impliedStep),u=t.clientY}function o(){bt.unbind(window,"mousemove",r),bt.unbind(window,"mouseup",o),a()}mt(this,t);var s=ft(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i));s.__truncationSuspended=!1;var l=s,u=void 0;return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),bt.bind(s.__input,"change",function(){var e=parseFloat(l.__input.value);ot.isNaN(e)||l.setValue(e)}),bt.bind(s.__input,"blur",function(){a()}),bt.bind(s.__input,"mousedown",function(t){bt.bind(window,"mousemove",r),bt.bind(window,"mouseup",o),u=t.clientY}),bt.bind(s.__input,"keydown",function(t){13===t.keyCode&&(l.__truncationSuspended=!0,this.blur(),l.__truncationSuspended=!1,a())}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return vt(t,e),pt(t,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():h(this.getValue(),this.__precision),gt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(At),Ct=function(e){function t(e,n,i,a,r){function o(t){t.preventDefault();var e=c.__background.getBoundingClientRect();return c.setValue(g(t.clientX,e.left,e.right,c.__min,c.__max)),!1}function s(){bt.unbind(window,"mousemove",o),bt.unbind(window,"mouseup",s),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}function l(t){var e=t.touches[0].clientX,n=c.__background.getBoundingClientRect();c.setValue(g(e,n.left,n.right,c.__min,c.__max))}function u(){bt.unbind(window,"touchmove",l),bt.unbind(window,"touchend",u),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}mt(this,t);var d=ft(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:i,max:a,step:r})),c=d;return d.__background=document.createElement("div"),d.__foreground=document.createElement("div"),bt.bind(d.__background,"mousedown",function(t){document.activeElement.blur(),bt.bind(window,"mousemove",o),bt.bind(window,"mouseup",s),o(t)}),bt.bind(d.__background,"touchstart",function(t){1!==t.touches.length||(bt.bind(window,"touchmove",l),bt.bind(window,"touchend",u),l(t))}),bt.addClass(d.__background,"slider"),bt.addClass(d.__foreground,"slider-fg"),d.updateDisplay(),d.__background.appendChild(d.__foreground),d.domElement.appendChild(d.__background),d}return vt(t,e),pt(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",gt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(At),Tt=function(e){function t(e,n,i){mt(this,t);var a=ft(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return a.__button=document.createElement("div"),a.__button.innerHTML=void 0===i?"Fire":i,bt.bind(a.__button,"click",function(t){return t.preventDefault(),a.fire(),!1}),bt.addClass(a.__button,"button"),a.domElement.appendChild(a.__button),a}return vt(t,e),pt(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(kt),Ot=function(e){function t(e,n){function i(t){u(t),bt.bind(window,"mousemove",u),bt.bind(window,"touchmove",u),bt.bind(window,"mouseup",r),bt.bind(window,"touchend",r)}function a(t){d(t),bt.bind(window,"mousemove",d),bt.bind(window,"touchmove",d),bt.bind(window,"mouseup",o),bt.bind(window,"touchend",o)}function r(){bt.unbind(window,"mousemove",u),bt.unbind(window,"touchmove",u),bt.unbind(window,"mouseup",r),bt.unbind(window,"touchend",r),l()}function o(){bt.unbind(window,"mousemove",d),bt.unbind(window,"touchmove",d),bt.unbind(window,"mouseup",o),bt.unbind(window,"touchend",o),l()}function s(){var e=dt(this.value);!1===e?this.value=y.__color.toString():(y.__color.__state=e,y.setValue(y.__color.toOriginal()))}function l(){y.__onFinishChange&&y.__onFinishChange.call(y,y.__color.toOriginal())}function u(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=y.__saturation_field.getBoundingClientRect(),n=t.touches&&t.touches[0]||t,i=n.clientX,a=n.clientY,r=(i-e.left)/(e.right-e.left),o=1-(a-e.top)/(e.bottom-e.top);return 1<o?o=1:0>o&&(o=0),1<r?r=1:0>r&&(r=0),y.__color.v=o,y.__color.s=r,y.setValue(y.__color.toOriginal()),!1}function d(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=y.__hue_field.getBoundingClientRect(),n=t.touches&&t.touches[0]||t,i=n.clientY,a=1-(i-e.top)/(e.bottom-e.top);return 1<a?a=1:0>a&&(a=0),y.__color.h=360*a,y.setValue(y.__color.toOriginal()),!1}mt(this,t);var c=ft(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));c.__color=new xt(c.getValue()),c.__temp=new xt(0);var y=c;c.domElement=document.createElement("div"),bt.makeSelectable(c.domElement,!1),c.__selector=document.createElement("div"),c.__selector.className="selector",c.__saturation_field=document.createElement("div"),c.__saturation_field.className="saturation-field",c.__field_knob=document.createElement("div"),c.__field_knob.className="field-knob",c.__field_knob_border="2px solid ",c.__hue_knob=document.createElement("div"),c.__hue_knob.className="hue-knob",c.__hue_field=document.createElement("div"),c.__hue_field.className="hue-field",c.__input=document.createElement("input"),c.__input.type="text",c.__input_textShadow="0 1px 1px ",bt.bind(c.__input,"keydown",function(t){13===t.keyCode&&s.call(this)}),bt.bind(c.__input,"blur",s),bt.bind(c.__selector,"mousedown",function(){bt.addClass(this,"drag").bind(window,"mouseup",function(){bt.removeClass(y.__selector,"drag")})}),bt.bind(c.__selector,"touchstart",function(){bt.addClass(this,"drag").bind(window,"touchend",function(){bt.removeClass(y.__selector,"drag")})});var h=document.createElement("div");return ot.extend(c.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),ot.extend(c.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:c.__field_knob_border+(.5>c.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),ot.extend(c.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),ot.extend(c.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),ot.extend(h.style,{width:"100%",height:"100%",background:"none"}),k(h,"top","rgba(0,0,0,0)","#000"),ot.extend(c.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),_(c.__hue_field),ot.extend(c.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:c.__input_textShadow+"rgba(0,0,0,0.7)"}),bt.bind(c.__saturation_field,"mousedown",i),bt.bind(c.__saturation_field,"touchstart",i),bt.bind(c.__field_knob,"mousedown",i),bt.bind(c.__field_knob,"touchstart",i),bt.bind(c.__hue_field,"mousedown",a),bt.bind(c.__hue_field,"touchstart",a),c.__saturation_field.appendChild(h),c.__selector.appendChild(c.__field_knob),c.__selector.appendChild(c.__saturation_field),c.__selector.appendChild(c.__hue_field),c.__hue_field.appendChild(c.__hue_knob),c.domElement.appendChild(c.__input),c.domElement.appendChild(c.__selector),c.updateDisplay(),c}return vt(t,e),pt(t,[{key:"updateDisplay",value:function(){var e=dt(this.getValue());if(!1!==e){var t=!1;ot.each(xt.COMPONENTS,function(n){if(!ot.isUndefined(e[n])&&!ot.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}},this),t&&ot.extend(this.__color.__state,e)}ot.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=.5>this.__color.v||.5<this.__color.s?255:0,i=255-n;ot.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,k(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),ot.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+i+","+i+","+i+",.7)"})}}]),t}(kt),It=["-moz-","-o-","-webkit-","-ms-",""],Dt=function(e,t){var n=e[t];return ot.isArray(arguments[2])||ot.isObject(arguments[2])?new St(e,t,arguments[2]):ot.isNumber(n)?ot.isNumber(arguments[2])&&ot.isNumber(arguments[3])?ot.isNumber(arguments[4])?new Ct(e,t,arguments[2],arguments[3],arguments[4]):new Ct(e,t,arguments[2],arguments[3]):ot.isNumber(arguments[4])?new Pt(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new Pt(e,t,{min:arguments[2],max:arguments[3]}):ot.isString(n)?new Et(e,t):ot.isFunction(n)?new Tt(e,t,""):ot.isBoolean(n)?new wt(e,t):null},Lt=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},Bt=function(){function e(){mt(this,e),this.backgroundElement=document.createElement("div"),ot.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),bt.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),ot.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;bt.bind(this.backgroundElement,"click",function(){t.hide()})}return pt(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),ot.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",bt.unbind(e.domElement,"webkitTransitionEnd",t),bt.unbind(e.domElement,"transitionend",t),bt.unbind(e.domElement,"oTransitionEnd",t)};bt.bind(this.domElement,"webkitTransitionEnd",t),bt.bind(this.domElement,"transitionend",t),bt.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-bt.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-bt.getHeight(this.domElement)/2+"px"}}]),e}(),Ft=function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");({load:function(e,t){var n=t||document,i=n.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=e,n.getElementsByTagName("head")[0].appendChild(i)},inject:function(e,t){var n=t||document,i=document.createElement("style");i.type="text/css",i.innerHTML=e;var a=n.getElementsByTagName("head")[0];try{a.appendChild(i)}catch(t){}}}).inject(Ft);var Rt=function(){try{return!!window.localStorage}catch(t){return!1}}(),Mt=void 0,Vt=!0,Nt=void 0,qt=!1,Ut=[],Ht=function e(t){var n=this,i=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),bt.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=ot.defaults(i,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),i=ot.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),ot.isUndefined(i.load)?i.load={preset:"Default"}:i.preset&&(i.load.preset=i.preset),ot.isUndefined(i.parent)&&i.hideable&&Ut.push(this),i.resizable=ot.isUndefined(i.parent)&&i.resizable,i.autoPlace&&ot.isUndefined(i.scrollable)&&(i.scrollable=!0);var a=Rt&&"true"===localStorage.getItem(T(this,"isLocal")),r=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:i.load.preset},set:function(e){n.parent?n.getRoot().preset=e:i.load.preset=e,R(this),n.revert()}},width:{get:function(){return i.width},set:function(e){i.width=e,B(n,e)}},name:{get:function(){return i.name},set:function(e){i.name=e,titleRowName&&(titleRowName.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(t){i.closed=t,i.closed?bt.addClass(n.__ul,e.CLASS_CLOSED):bt.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return a},set:function(e){Rt&&(a=e,e?bt.bind(window,"unload",r):bt.unbind(window,"unload",r),localStorage.setItem(T(n,"isLocal"),e))}}}),ot.isUndefined(i.parent)){if(i.closed=!1,bt.addClass(this.domElement,e.CLASS_MAIN),bt.makeSelectable(this.domElement,!1),Rt&&a){n.useLocalStorage=!0;var o=localStorage.getItem(T(this,"gui"));o&&(i.load=JSON.parse(o))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,bt.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),i.closeOnTop?(bt.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(bt.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),bt.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{void 0===i.closed&&(i.closed=!0);var s=document.createTextNode(i.name);bt.addClass(s,"controller-name");var l=w(n,s),u=function(t){return t.preventDefault(),n.closed=!n.closed,!1};bt.addClass(this.__ul,e.CLASS_CLOSED),bt.addClass(l,"title"),bt.bind(l,"click",u),i.closed||(this.closed=!1)}i.autoPlace&&(ot.isUndefined(i.parent)&&(Vt&&(Nt=document.createElement("div"),bt.addClass(Nt,"dg"),bt.addClass(Nt,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Nt),Vt=!1),Nt.appendChild(this.domElement),bt.addClass(this.domElement,e.CLASS_AUTO_PLACE)),!this.parent&&B(n,i.width)),this.__resizeHandler=function(){n.onResizeDebounced()},bt.bind(window,"resize",this.__resizeHandler),bt.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),bt.bind(this.__ul,"transitionend",this.__resizeHandler),bt.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&L(this),r=function(){Rt&&"true"===localStorage.getItem(T(n,"isLocal"))&&localStorage.setItem(T(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=r,i.parent||function(){var e=n.getRoot();e.width+=1,ot.defer(function(){e.width-=1})}()};Ht.toggleHide=function(){qt=!qt,ot.each(Ut,function(e){e.domElement.style.display=qt?"none":""})},Ht.CLASS_AUTO_PLACE="a",Ht.CLASS_AUTO_PLACE_CONTAINER="ac",Ht.CLASS_MAIN="main",Ht.CLASS_CONTROLLER_ROW="cr",Ht.CLASS_TOO_TALL="taller-than-window",Ht.CLASS_CLOSED="closed",Ht.CLASS_CLOSE_BUTTON="close-button",Ht.CLASS_CLOSE_TOP="close-top",Ht.CLASS_CLOSE_BOTTOM="close-bottom",Ht.CLASS_DRAG="drag",Ht.DEFAULT_WIDTH=245,Ht.TEXT_CLOSED="Close Controls",Ht.TEXT_OPEN="Open Controls",Ht._keydownHandler=function(t){"text"!==document.activeElement.type&&(t.which===72||t.keyCode===72)&&Ht.toggleHide()},bt.bind(window,"keydown",Ht._keydownHandler,!1),ot.extend(Ht.prototype,{add:function(e,t){return C(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return C(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;ot.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Nt.removeChild(this.domElement);var e=this;ot.each(this.__folders,function(t){e.removeFolder(t)}),bt.unbind(window,"keydown",Ht._keydownHandler,!1),S(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error("You already have a folder in this GUI by the name \""+e+"\"");var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new Ht(t);this.__folders[e]=n;var i=w(this,n.domElement);return bt.addClass(i,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],S(e);var t=this;ot.each(e.__folders,function(t){e.removeFolder(t)}),ot.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=bt.getOffset(e.__ul).top,n=0;ot.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=bt.getHeight(t))}),window.innerHeight-t-20<n?(bt.addClass(e.domElement,Ht.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(bt.removeClass(e.domElement,Ht.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&ot.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:ot.debounce(function(){this.onResize()},50),remember:function(){if(ot.isUndefined(Mt)&&(Mt=new Bt,Mt.domElement.innerHTML="<div id=\"dg-save\" class=\"dg dialogue\">\n\n  Here's the new load parameter for your <code>GUI</code>'s constructor:\n\n  <textarea id=\"dg-new-constructor\"></textarea>\n\n  <div id=\"dg-save-locally\">\n\n    <input id=\"dg-local-storage\" type=\"checkbox\"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id=\"dg-local-explain\">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>"),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;ot.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&D(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&B(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,0<this.__rememberedObjects.length&&(e.preset=this.preset,!e.remembered&&(e.remembered={}),e.remembered[this.preset]=F(this)),e.folders={},ot.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=F(this),E(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=F(this,!0)),this.load.remembered[e]=F(this),this.preset=e,O(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){ot.each(this.__controllers,function(t){this.getRoot().load.remembered?P(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),ot.each(this.__folders,function(e){e.revert(e)}),e||E(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&M(this.__listening)},updateDisplay:function(){ot.each(this.__controllers,function(e){e.updateDisplay()}),ot.each(this.__folders,function(e){e.updateDisplay()})}});var Yt=Ht,Xt=function(e){function t(e){Ge(this,t);var n=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.previousDemo=null,n.demo=null,n}return We(t,e),t}(tt),jt=new Xt("change"),Gt=new Xt("load"),Zt=window.location.hash.slice(1),Kt=function(t){function n(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};Ge(this,n);var a=void 0===i.aside?t:i.aside,r=Qe(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r.renderer=void 0===i.renderer?function(){var n=new e.WebGLRenderer;return n.setSize(t.clientWidth,t.clientHeight),n.setPixelRatio(window.devicePixelRatio),n}():i.renderer,t.appendChild(r.renderer.domElement),r.clock=new e.Clock,r.menu=new Yt({autoPlace:!1}),a.appendChild(r.menu.domElement),r.demos=new Map,r.demo=null,r.currentDemo=null,r}return We(n,t),Ze(n,[{key:"resetMenu",value:function(){var e=this,t=this.menu.domElement.parentNode,n=new Yt({autoPlace:!1});if(1<this.demos.size){var i=n.add(this,"demo",Array.from(this.demos.keys()));i.onChange(function(){return e.loadDemo()})}return t.removeChild(this.menu.domElement),t.appendChild(n.domElement),this.menu.destroy(),this.menu=n,n}},{key:"startDemo",value:function(e){e.id===this.demo&&(e.initialize(),e.registerOptions(this.resetMenu()),e.ready=!0,Gt.demo=e,this.dispatchEvent(Gt))}},{key:"loadDemo",value:function(){var e=this,t=this.demo,n=this.demos,i=n.get(t),a=this.currentDemo,r=this.renderer;window.location.hash=t,null!==a&&a.reset(),this.menu.domElement.style.display="none",r.clear(),jt.previousDemo=a,jt.demo=i,this.currentDemo=i,this.dispatchEvent(jt),i.load().then(function(){return e.startDemo(i)}).catch(function(t){return console.error(t)})}},{key:"addDemo",value:function(e){var t=this.currentDemo;return this.demos.set(e.id,e.setRenderer(this.renderer)),(null===this.demo||e.id===Zt)&&(this.demo=e.id,this.loadDemo()),this.resetMenu(),null!==t&&t.ready&&t.registerOptions(this.menu),this}},{key:"removeDemo",value:function(e){var t=this.demos,n=void 0;return t.has(e)&&(t.delete(e),this.demo===e&&0<t.size?(n=t.entries().next().value,this.demo=n[0],this.currentDemo=n[1],this.loadDemo()):(this.demo=null,this.currentDemo=null,this.renderer.clear())),this}},{key:"setSize",value:function(e,t){var n=this.currentDemo;this.renderer.setSize(e,t),null!==n&&null!==n.camera&&(n.camera.aspect=e/t,n.camera.updateProjectionMatrix())}},{key:"render",value:function(){var e=this.currentDemo,t=this.clock.getDelta();null!==e&&e.ready&&e.render(t)}}]),n}(nt),Wt={MOVE_FORWARD:0,MOVE_LEFT:1,MOVE_BACKWARD:2,MOVE_RIGHT:3,MOVE_DOWN:4,MOVE_UP:5,ZOOM_OUT:6,ZOOM_IN:7},Qt=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;Ge(this,e),this.x=t,this.y=n,this.z=i}return Ze(e,[{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"setFromSpherical",value:function(e){var t=Ne(e.phi)*e.radius;return this.x=t*Ne(e.theta),this.y=Ve(e.phi)*e.radius,this.z=t*Ve(e.theta),this}},{key:"setFromCylindrical",value:function(e){return this.x=e.radius*Ne(e.theta),this.y=e.y,this.z=e.radius*Ve(e.theta),this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this}},{key:"crossVectors",value:function(e,t){var n=e.x,i=e.y,a=e.z,r=t.x,o=t.y,s=t.z;return this.x=i*s-a*o,this.y=a*r-n*s,this.z=n*o-i*r,this}},{key:"cross",value:function(e){return this.crossVectors(this,e)}},{key:"transformDirection",value:function(t){var n=this.x,i=this.y,a=this.z,r=t.elements;return this.x=r[0]*n+r[4]*i+r[8]*a,this.y=r[1]*n+r[5]*i+r[9]*a,this.z=r[2]*n+r[6]*i+r[10]*a,this.normalize()}},{key:"applyMatrix3",value:function(t){var n=this.x,i=this.y,a=this.z,r=t.elements;return this.x=r[0]*n+r[3]*i+r[6]*a,this.y=r[1]*n+r[4]*i+r[7]*a,this.z=r[2]*n+r[5]*i+r[8]*a,this}},{key:"applyMatrix4",value:function(t){var n=this.x,i=this.y,a=this.z,r=t.elements;return this.x=r[0]*n+r[4]*i+r[8]*a+r[12],this.y=r[1]*n+r[5]*i+r[9]*a+r[13],this.z=r[2]*n+r[6]*i+r[10]*a+r[14],this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,i=this.z,a=e.x,r=e.y,o=e.z,s=e.w,l=s*t+r*i-o*n,u=s*n+o*t-a*i,d=s*i+a*n-r*t,c=-a*t-r*n-o*i;return this.x=l*s+c*-a+u*-o-d*-r,this.y=u*s+c*-r+d*-a-l*-o,this.z=d*s+c*-o+l*-r-u*-a,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"reflect",value:function(e){var t=e.x,n=e.y,i=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(t,n,i),this}},{key:"angleTo",value:function(e){var t=this.dot(e)/Me(this.lengthSquared()*e.lengthSquared());return Re(Ye(He(t,-1),1))}},{key:"manhattanLength",value:function(){return Ue(this.x)+Ue(this.y)+Ue(this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Me(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanDistanceTo",value:function(e){return Ue(this.x-e.x)+Ue(this.y-e.y)+Ue(this.z-e.z)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}},{key:"distanceTo",value:function(e){return Me(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=Ye(this.x,e.x),this.y=Ye(this.y,e.y),this.z=Ye(this.z,e.z),this}},{key:"max",value:function(e){return this.x=He(this.x,e.x),this.y=He(this.y,e.y),this.z=He(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=He(e.x,Ye(t.x,this.x)),this.y=He(e.y,Ye(t.y,this.y)),this.z=He(e.z,Ye(t.z,this.z)),this}},{key:"floor",value:function(){return this.x=Xe(this.x),this.y=Xe(this.y),this.z=Xe(this.z),this}},{key:"ceil",value:function(){return this.x=Fe(this.x),this.y=Fe(this.y),this.z=Fe(this.z),this}},{key:"round",value:function(){return this.x=je(this.x),this.y=je(this.y),this.z=je(this.z),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}]),e}(),$t=new Qt,v=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt(1/0,1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Qt(-Infinity,-Infinity,-Infinity);Ge(this,e),this.min=t,this.max=n}return Ze(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-Infinity,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"setFromSphere",value:function(e){return this.set(e.center,e.center),this.expandByScalar(e.radius),this}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"setFromPoints",value:function(e){var t,n;for(this.min.set(0,0,0),this.max.set(0,0,0),(t=0,n=e.length);t<n;++t)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=$t.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Qt;return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){var t=$t.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:"applyMatrix4",value:function(e){var t=this.min,n=this.max;if(!this.isEmpty()){var i=e.elements,a=i[0]*t.x,r=i[1]*t.x,o=i[2]*t.x,s=i[0]*n.x,l=i[1]*n.x,u=i[2]*n.x,d=i[4]*t.y,c=i[5]*t.y,y=i[6]*t.y,h=i[4]*n.y,m=i[5]*n.y,p=i[6]*n.y,g=i[8]*t.z,v=i[9]*t.z,f=i[10]*t.z,x=i[8]*n.z,k=i[9]*n.z,_=i[10]*n.z;t.x=Ye(a,s)+Ye(d,h)+Ye(g,x)+i[12],t.y=Ye(r,l)+Ye(c,m)+Ye(v,k)+i[13],t.z=Ye(o,u)+Ye(y,p)+Ye(f,_)+i[14],n.x=He(a,s)+He(d,h)+He(g,x)+i[12],n.y=He(r,l)+He(c,m)+He(v,k)+i[13],n.z=He(o,u)+He(y,p)+He(f,_)+i[14]}return this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"containsPoint",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=n.x&&e.y<=n.y&&e.z<=n.z}},{key:"containsBox",value:function(e){var t=this.min,n=this.max,i=e.min,a=e.max;return t.x<=i.x&&a.x<=n.x&&t.y<=i.y&&a.y<=n.y&&t.z<=i.z&&a.z<=n.z}},{key:"intersectsBox",value:function(e){var t=this.min,n=this.max,i=e.min,a=e.max;return a.x>=t.x&&a.y>=t.y&&a.z>=t.z&&i.x<=n.x&&i.y<=n.y&&i.z<=n.z}},{key:"intersectsSphere",value:function(e){var t=this.clampPoint(e.center,$t);return t.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return 0<e.normal.x?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=e.constant&&n>=e.constant}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),Jt=new v,en=new Qt,tn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;Ge(this,e),this.center=t,this.radius=n}return Ze(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"setFromPoints",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Jt.setFromPoints(e).getCenter(this.center),n=0,a=void 0,r=void 0;for(a=0,r=e.length;a<r;++a)n=He(n,t.distanceToSquared(e[a]));return this.radius=Me(n),this}},{key:"setFromBox",value:function(e){return e.getCenter(this.center),this.radius=.5*e.getSize(en).length(),this}},{key:"isEmpty",value:function(){return 0>=this.radius}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Qt,n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Ue(e.distanceToPoint(this.center))<=this.radius}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}]),e}(),nn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;Ge(this,e),this.x=t,this.y=n}return Ze(e,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this}},{key:"applyMatrix3",value:function(t){var n=this.x,i=this.y,a=t.elements;return this.x=a[0]*n+a[3]*i+a[6],this.y=a[1]*n+a[4]*i+a[7],this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"manhattanLength",value:function(){return Ue(this.x)+Ue(this.y)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Me(this.x*this.x+this.y*this.y)}},{key:"manhattanDistanceTo",value:function(e){return Ue(this.x-e.x)+Ue(this.y-e.y)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"distanceTo",value:function(e){return Me(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=Ye(this.x,e.x),this.y=Ye(this.y,e.y),this}},{key:"max",value:function(e){return this.x=He(this.x,e.x),this.y=He(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=He(e.x,Ye(t.x,this.x)),this.y=He(e.y,Ye(t.y,this.y)),this}},{key:"floor",value:function(){return this.x=Xe(this.x),this.y=Xe(this.y),this}},{key:"ceil",value:function(){return this.x=Fe(this.x),this.y=Fe(this.y),this}},{key:"round",value:function(){return this.x=je(this.x),this.y=je(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"angle",value:function(){var e=Be(this.y,this.x);return 0>e&&(e+=2*Le),e}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:"rotateAround",value:function(e,t){var n=Ve(t),i=Ne(t),a=this.x-e.x,r=this.y-e.y;return this.x=a*n-r*i+e.x,this.y=a*i+r*n+e.y,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"width",get:function(){return this.x},set:function(e){return this.x=e}},{key:"height",get:function(){return this.y},set:function(e){return this.y=e}}]),e}(),an=new nn,rn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new nn(1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new nn(-Infinity,-Infinity);Ge(this,e),this.min=t,this.max=n}return Ze(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-Infinity,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new nn;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new nn;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new tn;return this.getCenter(e.center),e.radius=.5*this.getSize(an).length(),e}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"setFromPoints",value:function(e){var t,n;for(this.min.set(0,0),this.max.set(0,0),(t=0,n=e.length);t<n;++t)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=an.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new nn;return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){var t=an.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"containsPoint",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.x<=n.x&&e.y<=n.y}},{key:"containsBox",value:function(e){var t=this.min,n=this.max,i=e.min,a=e.max;return t.x<=i.x&&a.x<=n.x&&t.y<=i.y&&a.y<=n.y}},{key:"intersectsBox",value:function(e){var t=this.min,n=this.max,i=e.min,a=e.max;return a.x>=t.x&&a.y>=t.y&&i.x<=n.x&&i.y<=n.y}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),on=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;Ge(this,e),this.radius=t,this.theta=n,this.y=i}return Ze(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"setFromVector3",value:function(e){return this.radius=Me(e.x*e.x+e.z*e.z),this.theta=Be(e.x,e.z),this.y=e.y,this}}]),e}(),sn=function(){function e(){Ge(this,e),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return Ze(e,[{key:"set",value:function(e,t,n,i,a,r,o,s,l){var u=this.elements;return u[0]=e,u[3]=t,u[6]=n,u[1]=i,u[4]=a,u[7]=r,u[2]=o,u[5]=s,u[8]=l,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=e.elements,n=this.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],this}},{key:"clone",value:function(){return new this.constructor().fromArray(this.elements)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a=void 0;for(a=0;9>a;++a)n[a]=e[a+t];return this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a=void 0;for(a=0;9>a;++a)e[a+t]=n[a];return e}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,i=t.elements,a=this.elements,r=n[0],o=n[3],s=n[6],l=n[1],u=n[4],d=n[7],c=n[2],y=n[5],h=n[8],m=i[0],p=i[3],g=i[6],v=i[1],f=i[4],x=i[7],k=i[2],_=i[5],z=i[8];return a[0]=r*m+o*v+s*k,a[3]=r*p+o*f+s*_,a[6]=r*g+o*x+s*z,a[1]=l*m+u*v+d*k,a[4]=l*p+u*f+d*_,a[7]=l*g+u*x+d*z,a[2]=c*m+y*v+h*k,a[5]=c*p+y*f+h*_,a[8]=c*g+y*x+h*z,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var t=this.elements,n=t[0],a=t[1],r=t[2],o=t[3],s=t[4],e=t[5],l=t[6],u=t[7],d=t[8];return n*s*d-n*e*u-a*o*d+a*e*l+r*o*u-r*s*l}},{key:"getInverse",value:function(e){var t=e.elements,n=this.elements,i=t[0],a=t[1],r=t[2],o=t[3],s=t[4],l=t[5],u=t[6],d=t[7],c=t[8],y=c*s-l*d,h=l*u-c*o,m=d*o-s*u,p=i*y+a*h+r*m,g=void 0;return 0==p?(console.error("Can't invert matrix, determinant is zero",e),this.identity()):(g=1/p,n[0]=y*g,n[1]=(r*d-c*a)*g,n[2]=(l*a-r*s)*g,n[3]=h*g,n[4]=(c*i-r*u)*g,n[5]=(r*o-l*i)*g,n[6]=m*g,n[7]=(a*u-d*i)*g,n[8]=(s*i-a*o)*g),this}},{key:"transpose",value:function(){var e=this.elements,n=void 0;return n=e[1],e[1]=e[3],e[3]=n,n=e[2],e[2]=e[6],e[6]=n,n=e[5],e[5]=e[7],e[7]=n,this}},{key:"scale",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:"rotate",value:function(e){var t=Ve(e),n=Ne(e),i=this.elements,a=i[0],r=i[3],o=i[6],s=i[1],l=i[4],u=i[7];return i[0]=t*a+n*s,i[3]=t*r+n*l,i[6]=t*o+n*u,i[1]=-n*a+t*s,i[4]=-n*r+t*l,i[7]=-n*o+t*u,this}},{key:"translate",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:"equals",value:function(e){var t=this.elements,n=e.elements,a=!0,r=void 0;for(r=0;a&&9>r;++r)t[r]!==n[r]&&(a=!1);return a}}]),e}(),ln={XYZ:"XYZ",YZX:"YZX",ZXY:"ZXY",XZY:"XZY",YXZ:"YXZ",ZYX:"ZYX"},un=new Qt,dn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;Ge(this,e),this.x=t,this.y=n,this.z=i,this.w=a}var n=Number.EPSILON;return Ze(e,[{key:"set",value:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"setFromEuler",value:function(e){var t=e.x,n=e.y,i=e.z,a=Ve,r=Ne,o=a(t/2),s=a(n/2),l=a(i/2),u=r(t/2),d=r(n/2),c=r(i/2);switch(e.order){case ln.XYZ:this.x=u*s*l+o*d*c,this.y=o*d*l-u*s*c,this.z=o*s*c+u*d*l,this.w=o*s*l-u*d*c;break;case ln.YXZ:this.x=u*s*l+o*d*c,this.y=o*d*l-u*s*c,this.z=o*s*c-u*d*l,this.w=o*s*l+u*d*c;break;case ln.ZXY:this.x=u*s*l-o*d*c,this.y=o*d*l+u*s*c,this.z=o*s*c+u*d*l,this.w=o*s*l-u*d*c;break;case ln.ZYX:this.x=u*s*l-o*d*c,this.y=o*d*l+u*s*c,this.z=o*s*c-u*d*l,this.w=o*s*l+u*d*c;break;case ln.YZX:this.x=u*s*l+o*d*c,this.y=o*d*l+u*s*c,this.z=o*s*c-u*d*l,this.w=o*s*l-u*d*c;break;case ln.XZY:this.x=u*s*l-o*d*c,this.y=o*d*l-u*s*c,this.z=o*s*c+u*d*l,this.w=o*s*l+u*d*c;}return this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,i=Ne(n);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Ve(n),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],i=t[4],a=t[8],r=t[1],o=t[5],l=t[9],u=t[2],d=t[6],c=t[10],y=n+o+c,h=void 0;return 0<y?(h=.5/Me(y+1),this.w=.25/h,this.x=(d-l)*h,this.y=(a-u)*h,this.z=(r-i)*h):n>o&&n>c?(h=2*Me(1+n-o-c),this.w=(d-l)/h,this.x=.25*h,this.y=(i+r)/h,this.z=(a+u)/h):o>c?(h=2*Me(1+o-n-c),this.w=(a-u)/h,this.x=(i+r)/h,this.y=.25*h,this.z=(l+d)/h):(h=2*Me(1+c-n-o),this.w=(r-i)/h,this.x=(a+u)/h,this.y=(l+d)/h,this.z=.25*h),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return 1e-6>n?(n=0,Ue(e.x)>Ue(e.z)?un.set(-e.y,e.x,0):un.set(0,-e.z,e.y)):un.crossVectors(e,t),this.x=un.x,this.y=un.y,this.z=un.z,this.w=n,this.normalize()}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Me(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"normalize",value:function(){var e=this.length(),t=void 0;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/e,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"multiplyQuaternions",value:function(e,t){var n=e.x,i=e.y,a=e.z,r=e.w,o=t.x,s=t.y,l=t.z,u=t.w;return this.x=n*u+r*o+i*l-a*s,this.y=i*u+r*s+a*o-n*l,this.z=a*u+r*l+n*s-i*o,this.w=r*u-n*o-i*s-a*l,this}},{key:"multiply",value:function(e){return this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"slerp",value:function(e,i){var t=this.x,a=this.y,r=this.z,o=this.w,l=void 0,u=void 0,d=void 0,c=void 0,y=void 0,h=void 0,m=void 0;return 1===i?this.copy(e):0<i&&(l=o*e.w+t*e.x+a*e.y+r*e.z,0>l?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,l=-l):this.copy(e),1<=l?(this.w=o,this.x=t,this.y=a,this.z=r):(u=1-l*l,y=1-i,u<=n?(this.w=y*o+i*this.w,this.x=y*t+i*this.x,this.y=y*a+i*this.y,this.z=y*r+i*this.z,this.normalize()):(d=Me(u),c=Be(d,l),h=Ne(y*c)/d,m=Ne(i*c)/d,this.w=o*h+this.w*m,this.x=t*h+this.x*m,this.y=a*h+this.y*m,this.z=r*h+this.z*m))),this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}],[{key:"slerp",value:function(e,n,i,a){return i.copy(e).slerp(n,a)}},{key:"slerpFlat",value:function(e,i,a,r,o,l,u){var d=o[l],c=o[l+1],y=o[l+2],h=o[l+3],m=a[r],p=a[r+1],g=a[r+2],v=a[r+3],x=void 0,k=void 0,_=void 0,z=void 0,b=void 0,w=void 0,S=void 0,E=void 0;(v!==h||m!==d||p!==c||g!==y)&&(x=1-u,z=m*d+p*c+g*y+v*h,w=0<=z?1:-1,b=1-z*z,b>n&&(_=Me(b),S=Be(_,z*w),x=Ne(x*S)/_,u=Ne(u*S)/_),E=u*w,m=m*x+d*E,p=p*x+c*E,g=g*x+y*E,v=v*x+h*E,x===1-u&&(k=1/Me(m*m+p*p+g*g+v*v),m*=k,p*=k,g*=k,v*=k)),e[i]=m,e[i+1]=p,e[i+2]=g,e[i+3]=v}}]),e}(),cn=new sn,m=new dn,q=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;Ge(this,e),this.x=t,this.y=n,this.z=i,this.order=e.defaultOrder}return Ze(e,[{key:"set",value:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.order=i,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.order=e[t+3],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.order,e}},{key:"toVector3",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt;return e.set(this.x,this.y,this.z)}},{key:"setFromRotationMatrix",value:function(e){var t=Math.asin,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order,i=e.elements,a=i[0],r=i[4],o=i[8],s=i[1],l=i[5],u=i[9],d=i[2],c=i[6],y=i[10],h=1-1e-5;switch(n){case ln.XYZ:{this.y=t(V(o,-1,1)),Ue(o)<h?(this.x=Be(-u,y),this.z=Be(-r,a)):(this.x=Be(c,l),this.z=0);break}case ln.YXZ:{this.x=t(-V(u,-1,1)),Ue(u)<h?(this.y=Be(o,y),this.z=Be(s,l)):(this.y=Be(-d,a),this.z=0);break}case ln.ZXY:{this.x=t(V(c,-1,1)),Ue(c)<h?(this.y=Be(-d,y),this.z=Be(-r,l)):(this.y=0,this.z=Be(s,a));break}case ln.ZYX:{this.y=t(-V(d,-1,1)),Ue(d)<h?(this.x=Be(c,y),this.z=Be(s,a)):(this.x=0,this.z=Be(-r,l));break}case ln.YZX:{this.z=t(V(s,-1,1)),Ue(s)<h?(this.x=Be(-u,l),this.y=Be(-d,a)):(this.x=0,this.y=Be(o,y));break}case ln.XZY:{this.z=t(-V(r,-1,1)),Ue(r)<h?(this.x=Be(c,l),this.y=Be(o,a)):(this.x=Be(-u,y),this.y=0);break}}return this.order=n,this}},{key:"setFromQuaternion",value:function(e,t){return cn.makeRotationFromQuaternion(e),this.setFromRotationMatrix(cn,t)}},{key:"setFromVector3",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return m.setFromEuler(this),this.setFromQuaternion(m,e)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order}}],[{key:"defaultOrder",get:function(){return ln.XYZ}}]),e}(),yn=new Qt,a=new Qt,b=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt(1,0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;Ge(this,e),this.normal=t,this.constant=n}return Ze(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var i=yn.subVectors(n,t).cross(a.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,yn),this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"intersectLine",value:function(e,n){var i=e.delta(yn),a=this.normal.dot(i);if(0===a)0===this.distanceToPoint(e.start)&&n.copy(e.start);else{var r=-(e.start.dot(this.normal)+this.constant)/a;0<=r&&1>=r&&n.copy(i).multiplyScalar(r).add(e.start)}return n}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return 0>t&&0<n||0>n&&0<t}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}]),e}(),hn=new Qt,mn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new b,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new b,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new b,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new b,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new b,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new b;Ge(this,e),this.planes=[t,n,i,a,r,o]}return Ze(e,[{key:"set",value:function(e,t,n,i,a,r){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(a),o[5].copy(r),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"copy",value:function(e){var t=this.planes,n=void 0;for(n=0;6>n;++n)t[n].copy(e.planes[n]);return this}},{key:"setFromMatrix",value:function(e){var t=this.planes,n=e.elements,i=n[0],a=n[1],r=n[2],o=n[3],s=n[4],l=n[5],u=n[6],d=n[7],c=n[8],y=n[9],h=n[10],m=n[11],p=n[12],g=n[13],v=n[14],f=n[15];return t[0].setComponents(o-i,d-s,m-c,f-p).normalize(),t[1].setComponents(o+i,d+s,m+c,f+p).normalize(),t[2].setComponents(o+a,d+l,m+y,f+g).normalize(),t[3].setComponents(o-a,d-l,m-y,f-g).normalize(),t[4].setComponents(o-r,d-u,m-h,f-v).normalize(),t[5].setComponents(o+r,d+u,m+h,f+v).normalize(),this}},{key:"intersectsSphere",value:function(e){var t=this.planes,n=e.center,a=-e.radius,r=!0,o=void 0,s=void 0;for(o=0;6>o;++o)if(s=t[o].distanceToPoint(n),s<a){r=!1;break}return r}},{key:"intersectsBox",value:function(e){var t=this.planes,n=e.min,a=e.max,r=void 0,o=void 0;for(r=0;6>r;++r)if(o=t[r],hn.x=0<o.normal.x?a.x:n.x,hn.y=0<o.normal.y?a.y:n.y,hn.z=0<o.normal.z?a.z:n.z,0>o.distanceToPoint(hn))return!1;return!0}},{key:"containsPoint",value:function(e){var t=this.planes,n=!0,a=void 0;for(a=0;6>a;++a)if(0>t[a].distanceToPoint(e)){n=!1;break}return n}}]),e}(),pn=new Qt,gn=new Qt,vn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Qt;Ge(this,e),this.start=t,this.end=n}return Ze(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt;return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt;return e.subVectors(this.end,this.start)}},{key:"lengthSquared",value:function(){return this.start.distanceToSquared(this.end)}},{key:"length",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,n){pn.subVectors(e,this.start),gn.subVectors(this.end,this.start);var i=gn.dot(gn),a=gn.dot(pn),r=n?Ye(He(a/i,0),1):a/i;return r}},{key:"closestPointToPoint",value:function(e){var n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Qt,a=this.closestPointToPointParameter(e,n);return this.delta(i).multiplyScalar(a).add(this.start)}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}]),e}(),fn=new Qt,xn=new Qt,kn=new Qt,c=function(){function e(){Ge(this,e),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return Ze(e,[{key:"set",value:function(e,t,n,i,a,r,o,s,l,u,d,c,y,h,m,p){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=a,g[5]=r,g[9]=o,g[13]=s,g[2]=l,g[6]=u,g[10]=d,g[14]=c,g[3]=y,g[7]=h,g[11]=m,g[15]=p,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"copy",value:function(e){var t=e.elements,n=this.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],this}},{key:"clone",value:function(){return new this.constructor().fromArray(this.elements)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a=void 0;for(a=0;16>a;++a)n[a]=e[a+t];return this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a=void 0;for(a=0;16>a;++a)e[a+t]=n[a];return e}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Me(He(t,n,i))}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setPosition",value:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,i=1/fn.setFromMatrixColumn(e,0).length(),a=1/fn.setFromMatrixColumn(e,1).length(),r=1/fn.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=0,t[8]=n[8]*r,t[9]=n[9]*r,t[10]=n[10]*r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(t){var n=this.elements,i=t.x,r=t.y,o=t.z,s=Ve(i),a=Ne(i),l=Ve(r),u=Ne(r),d=Ve(o),e=Ne(o),c=void 0,y=void 0,h=void 0,m=void 0,p=void 0,g=void 0,v=void 0,f=void 0,x=void 0,k=void 0,_=void 0,z=void 0;switch(t.order){case ln.XYZ:{c=s*d,y=s*e,h=a*d,m=a*e,n[0]=l*d,n[4]=-l*e,n[8]=u,n[1]=y+h*u,n[5]=c-m*u,n[9]=-a*l,n[2]=m-c*u,n[6]=h+y*u,n[10]=s*l;break}case ln.YXZ:{p=l*d,g=l*e,v=u*d,f=u*e,n[0]=p+f*a,n[4]=v*a-g,n[8]=s*u,n[1]=s*e,n[5]=s*d,n[9]=-a,n[2]=g*a-v,n[6]=f+p*a,n[10]=s*l;break}case ln.ZXY:{p=l*d,g=l*e,v=u*d,f=u*e,n[0]=p-f*a,n[4]=-s*e,n[8]=v+g*a,n[1]=g+v*a,n[5]=s*d,n[9]=f-p*a,n[2]=-s*u,n[6]=a,n[10]=s*l;break}case ln.ZYX:{c=s*d,y=s*e,h=a*d,m=a*e,n[0]=l*d,n[4]=h*u-y,n[8]=c*u+m,n[1]=l*e,n[5]=m*u+c,n[9]=y*u-h,n[2]=-u,n[6]=a*l,n[10]=s*l;break}case ln.YZX:{x=s*l,k=s*u,_=a*l,z=a*u,n[0]=l*d,n[4]=z-x*e,n[8]=_*e+k,n[1]=e,n[5]=s*d,n[9]=-a*d,n[2]=-u*d,n[6]=k*e+_,n[10]=x-z*e;break}case ln.XZY:{x=s*l,k=s*u,_=a*l,z=a*u,n[0]=l*d,n[4]=-e,n[8]=u*d,n[1]=x*e+z,n[5]=s*d,n[9]=k*e-_,n[2]=_*e-k,n[6]=a*d,n[10]=z*e+x;break}}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(fn.set(0,0,0),e,xn.set(1,1,1))}},{key:"lookAt",value:function(e,t,n){var i=this.elements,a=fn,r=xn,o=kn;return o.subVectors(e,t),0===o.lengthSquared()&&(o.z=1),o.normalize(),a.crossVectors(n,o),0===a.lengthSquared()&&(1===Ue(n.z)?o.x+=1e-4:o.z+=1e-4,o.normalize(),a.crossVectors(n,o)),a.normalize(),r.crossVectors(o,a),i[0]=a.x,i[4]=r.x,i[8]=o.x,i[1]=a.y,i[5]=r.y,i[9]=o.y,i[2]=a.z,i[6]=r.z,i[10]=o.z,this}},{key:"multiplyMatrices",value:function(e,t){var n=this.elements,i=e.elements,a=t.elements,r=i[0],o=i[4],s=i[8],l=i[12],u=i[1],d=i[5],c=i[9],y=i[13],h=i[2],m=i[6],p=i[10],g=i[14],v=i[3],f=i[7],x=i[11],k=i[15],_=a[0],z=a[4],b=a[8],w=a[12],S=a[1],E=a[5],A=a[9],P=a[13],C=a[2],T=a[6],O=a[10],I=a[14],D=a[3],L=a[7],B=a[11],F=a[15];return n[0]=r*_+o*S+s*C+l*D,n[4]=r*z+o*E+s*T+l*L,n[8]=r*b+o*A+s*O+l*B,n[12]=r*w+o*P+s*I+l*F,n[1]=u*_+d*S+c*C+y*D,n[5]=u*z+d*E+c*T+y*L,n[9]=u*b+d*A+c*O+y*B,n[13]=u*w+d*P+c*I+y*F,n[2]=h*_+m*S+p*C+g*D,n[6]=h*z+m*E+p*T+g*L,n[10]=h*b+m*A+p*O+g*B,n[14]=h*w+m*P+p*I+g*F,n[3]=v*_+f*S+x*C+k*D,n[7]=v*z+f*E+x*T+k*L,n[11]=v*b+f*A+x*O+k*B,n[15]=v*w+f*P+x*I+k*F,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],a=e[12],r=e[1],o=e[5],s=e[9],l=e[13],u=e[2],d=e[6],c=e[10],y=e[14],h=e[3],m=e[7],p=e[11],g=e[15],v=t*o,f=t*s,x=t*l,k=n*r,_=n*s,z=n*l,b=i*r,w=i*o,S=i*l,E=a*r,A=a*o,P=a*s;return h*(P*d-S*d-A*c+z*c+w*y-_*y)+m*(f*y-x*c+E*c-b*y+S*u-P*u)+p*(x*d-v*y-E*d+k*y+A*u-z*u)+g*(-w*u-f*d+v*c+b*d-k*c+_*u)}},{key:"getInverse",value:function(e){var t=this.elements,n=e.elements,i=n[0],a=n[1],r=n[2],o=n[3],s=n[4],l=n[5],u=n[6],d=n[7],c=n[8],y=n[9],h=n[10],m=n[11],p=n[12],g=n[13],v=n[14],f=n[15],x=y*v*d-g*h*d+g*u*m-l*v*m-y*u*f+l*h*f,k=p*h*d-c*v*d-p*u*m+s*v*m+c*u*f-s*h*f,_=c*g*d-p*y*d+p*l*m-s*g*m-c*l*f+s*y*f,z=p*y*u-c*g*u-p*l*h+s*g*h+c*l*v-s*y*v,b=i*x+a*k+r*_+o*z,w=void 0;return 0==b?(console.error("Can't invert matrix, determinant is zero",e),this.identity()):(w=1/b,t[0]=x*w,t[1]=(g*h*o-y*v*o-g*r*m+a*v*m+y*r*f-a*h*f)*w,t[2]=(l*v*o-g*u*o+g*r*d-a*v*d-l*r*f+a*u*f)*w,t[3]=(y*u*o-l*h*o-y*r*d+a*h*d+l*r*m-a*u*m)*w,t[4]=k*w,t[5]=(c*v*o-p*h*o+p*r*m-i*v*m-c*r*f+i*h*f)*w,t[6]=(p*u*o-s*v*o-p*r*d+i*v*d+s*r*f-i*u*f)*w,t[7]=(s*h*o-c*u*o+c*r*d-i*h*d-s*r*m+i*u*m)*w,t[8]=_*w,t[9]=(p*y*o-c*g*o-p*a*m+i*g*m+c*a*f-i*y*f)*w,t[10]=(s*g*o-p*l*o+p*a*d-i*g*d-s*a*f+i*l*f)*w,t[11]=(c*l*o-s*y*o-c*a*d+i*y*d+s*a*m-i*l*m)*w,t[12]=z*w,t[13]=(c*g*r-p*y*r+p*a*h-i*g*h-c*a*v+i*y*v)*w,t[14]=(p*l*r-s*g*r-p*a*u+i*g*u+s*a*v-i*l*v)*w,t[15]=(s*y*r-c*l*r+c*a*u-i*y*u-s*a*h+i*l*h)*w),this}},{key:"transpose",value:function(){var e=this.elements,n=void 0;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}},{key:"scale",value:function(e,t,n){var i=this.elements;return i[0]*=e,i[4]*=t,i[8]*=n,i[1]*=e,i[5]*=t,i[9]*=n,i[2]*=e,i[6]*=t,i[10]*=n,i[3]*=e,i[7]*=t,i[11]*=n,this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Ve(e),n=Ne(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Ve(e),n=Ne(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Ve(e),n=Ne(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,n){var i=Ve(n),a=Ne(n),r=1-i,t=e.x,o=e.y,s=e.z,l=r*t,u=r*o;return this.set(l*t+i,l*o-a*s,l*s+a*o,0,l*o+a*s,u*o+i,u*s-a*t,0,l*s-a*o,u*s+a*t,r*s*s+i,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var i=this.elements,a=t.x,r=t.y,o=t.z,s=t.w,l=a+a,u=r+r,d=o+o,c=a*l,y=a*u,h=a*d,m=r*u,p=r*d,g=o*d,v=s*l,f=s*u,x=s*d,k=n.x,_=n.y,z=n.z;return i[0]=(1-(m+g))*k,i[1]=(y+x)*k,i[2]=(h-f)*k,i[3]=0,i[4]=(y-x)*_,i[5]=(1-(c+g))*_,i[6]=(p+v)*_,i[7]=0,i[8]=(h+f)*z,i[9]=(p-v)*z,i[10]=(1-(c+m))*z,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}},{key:"decompose",value:function(e,t,n){var i=this.elements,a=i[0],r=i[1],o=i[2],s=i[4],l=i[5],u=i[6],d=i[8],c=i[9],y=i[10],h=this.determinant(),m=fn.set(a,r,o).length()*(0>h?-1:1),p=fn.set(s,l,u).length(),g=fn.set(d,c,y).length(),v=1/m,f=1/p,x=1/g;return e.x=i[12],e.y=i[13],e.z=i[14],i[0]*=v,i[1]*=v,i[2]*=v,i[4]*=f,i[5]*=f,i[6]*=f,i[8]*=x,i[9]*=x,i[10]*=x,t.setFromRotationMatrix(this),i[0]=a,i[1]=r,i[2]=o,i[4]=s,i[5]=l,i[6]=u,i[8]=d,i[9]=c,i[10]=y,n.x=m,n.y=p,n.z=g,this}},{key:"makePerspective",value:function(e,t,n,i,a,r){var o=this.elements;return o[0]=2*a/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*a/(n-i),o[9]=(n+i)/(n-i),o[13]=0,o[2]=0,o[6]=0,o[10]=-(r+a)/(r-a),o[14]=-2*r*a/(r-a),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,i,a,r){var o=this.elements,s=1/(t-e),l=1/(n-i),u=1/(r-a);return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-((t+e)*s),o[1]=0,o[5]=2*l,o[9]=0,o[13]=-((n+i)*l),o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-((r+a)*u),o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){var t=this.elements,n=e.elements,a=!0,r=void 0;for(r=0;a&&16>r;++r)t[r]!==n[r]&&(a=!1);return a}}]),e}(),_n=[new Qt,new Qt,new Qt,new Qt],zn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Qt;Ge(this,e),this.origin=t,this.direction=n}return Ze(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"at",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Qt;return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,_n[0])),this}},{key:"closestPointToPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Qt,n=t.subVectors(e,this.origin).dot(this.direction);return 0<=n?t.copy(this.direction).multiplyScalar(n).add(this.origin):t.copy(this.origin)}},{key:"distanceSquaredToPoint",value:function(e){var t=_n[0].subVectors(e,this.origin).dot(this.direction);return 0>t?this.origin.distanceToSquared(e):_n[0].copy(this.direction).multiplyScalar(t).add(this.origin).distanceToSquared(e)}},{key:"distanceToPoint",value:function(e){return Me(this.distanceSquaredToPoint(e))}},{key:"distanceToPlane",value:function(e){var n=e.normal.dot(this.direction),i=0===n?0===e.distanceToPoint(this.origin)?0:-1:-(this.origin.dot(e.normal)+e.constant)/n;return 0<=i?i:null}},{key:"distanceSquaredToSegment",value:function(e,t,n,i){var a=_n[0].copy(e).add(t).multiplyScalar(.5),r=_n[1].copy(t).sub(e).normalize(),o=_n[2].copy(this.origin).sub(a),s=.5*e.distanceTo(t),l=-this.direction.dot(r),u=o.dot(this.direction),d=-o.dot(r),y=o.lengthSq(),c=Ue(1-l*l),h=void 0,m=void 0,p=void 0,g=void 0,v=void 0;return 0<c?(h=l*d-u,m=l*u-d,p=s*c,0<=h?m>=-p?m<=p?(g=1/c,h*=g,m*=g,v=h*(h+l*m+2*u)+m*(l*h+m+2*d)+y):(m=s,h=He(0,-(l*m+u)),v=-h*h+m*(m+2*d)+y):(m=-s,h=He(0,-(l*m+u)),v=-h*h+m*(m+2*d)+y):m<=-p?(h=He(0,-(-l*s+u)),m=0<h?-s:Ye(He(-s,-d),s),v=-h*h+m*(m+2*d)+y):m<=p?(h=0,m=Ye(He(-s,-d),s),v=m*(m+2*d)+y):(h=He(0,-(l*s+u)),m=0<h?s:Ye(He(-s,-d),s),v=-h*h+m*(m+2*d)+y)):(m=0<l?-s:s,h=He(0,-(l*m+u)),v=-h*h+m*(m+2*d)+y),void 0!==n&&n.copy(this.direction).multiplyScalar(h).add(this.origin),void 0!==i&&i.copy(r).multiplyScalar(m).add(a),v}},{key:"intersectSphere",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Qt,n=_n[0].subVectors(e.center,this.origin),i=n.dot(this.direction),a=n.dot(n)-i*i,r=e.radius*e.radius,o=null,s=void 0,l=void 0,u=void 0;return a<=r&&(s=Me(r-a),l=i-s,u=i+s,(0<=l||0<=u)&&(o=0>l?this.at(u,t):this.at(l,t))),o}},{key:"intersectsSphere",value:function(e){return this.distanceToPoint(e.center)<=e.radius}},{key:"intersectPlane",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Qt,i=this.distanceToPlane(e);return null===i?null:this.at(i,n)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t}},{key:"intersectBox",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Qt,n=this.origin,i=this.direction,a=e.min,r=e.max,o=1/i.x,s=1/i.y,l=1/i.z,u=null,d=void 0,c=void 0,y=void 0,h=void 0,m=void 0,p=void 0;return 0<=o?(d=(a.x-n.x)*o,c=(r.x-n.x)*o):(d=(r.x-n.x)*o,c=(a.x-n.x)*o),0<=s?(y=(a.y-n.y)*s,h=(r.y-n.y)*s):(y=(r.y-n.y)*s,h=(a.y-n.y)*s),d<=h&&y<=c&&((y>d||d!=d)&&(d=y),(h<c||c!=c)&&(c=h),0<=l?(m=(a.z-n.z)*l,p=(r.z-n.z)*l):(m=(r.z-n.z)*l,p=(a.z-n.z)*l),d<=p&&m<=c&&((m>d||d!=d)&&(d=m),(p<c||c!=c)&&(c=p),0<=c&&(u=this.at(0<=d?d:c,t)))),u}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,_n[0])}},{key:"intersectTriangle",value:function(e,t,n,i,a){var r=this.direction,o=_n[0],s=_n[1],l=_n[2],u=_n[3],d=null,c=void 0,y=void 0,h=void 0,m=void 0,p=void 0;return s.subVectors(t,e),l.subVectors(n,e),u.crossVectors(s,l),c=r.dot(u),0===c||i&&0<c||(0<c?y=1:(y=-1,c=-c),o.subVectors(this.origin,e),h=y*r.dot(l.crossVectors(o,l)),0<=h&&(m=y*r.dot(s.cross(o)),0<=m&&h+m<=c&&(p=-y*o.dot(u),0<=p&&(d=this.at(p/c,a))))),d}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),e}(),bn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;Ge(this,e),this.radius=t,this.phi=n,this.theta=i}return Ze(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"setFromVector3",value:function(e){return this.radius=e.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Be(e.x,e.z),this.phi=Re(Ye(He(e.y/this.radius,-1),1))),this.makeSafe()}},{key:"makeSafe",value:function(){return this.phi=He(1e-6,Ye(Le-1e-6,this.phi)),this}}]),e}(),wn=function(){function e(){Ge(this,e),this.elements=new Float32Array([1,0,0,1,0,1])}return Ze(e,[{key:"set",value:function(t,n,i,a,r,o){var s=this.elements;return s[0]=t,s[1]=n,s[3]=a,s[2]=i,s[4]=r,s[5]=o,this}},{key:"identity",value:function(){return this.set(1,0,0,1,0,1),this}},{key:"copy",value:function(e){var t=e.elements;return this.set(t[0],t[1],t[2],t[3],t[4],t[5]),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"toMatrix3",value:function(e){var t=e.elements;e.set(t[0],t[1],t[2],t[1],t[3],t[4],t[2],t[4],t[5])}},{key:"add",value:function(e){var t=this.elements,n=e.elements;return t[0]+=n[0],t[1]+=n[1],t[3]+=n[3],t[2]+=n[2],t[4]+=n[4],t[5]+=n[5],this}},{key:"norm",value:function(){var t=this.elements,e=t[1]*t[1],n=t[2]*t[2],i=t[4]*t[4];return Me(t[0]*t[0]+e+n+e+t[3]*t[3]+i+n+i+t[5]*t[5])}},{key:"off",value:function(){var t=this.elements;return Me(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:"applyToVector3",value:function(t){var n=t.x,i=t.y,a=t.z,r=this.elements;return t.x=r[0]*n+r[1]*i+r[2]*a,t.y=r[1]*n+r[3]*i+r[4]*a,t.z=r[2]*n+r[4]*i+r[5]*a,t}},{key:"equals",value:function(e){var t=this.elements,n=e.elements,a=!0,r=void 0;for(r=0;a&&6>r;++r)t[r]!==n[r]&&(a=!1);return a}}],[{key:"calculateIndex",value:function(e,t){return 3-(3-e)*(2-e)/2+t}}]),e}(),Sn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;Ge(this,e),this.x=t,this.y=n,this.z=i,this.w=a}return Ze(e,[{key:"set",value:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Re(e.w);var t=Me(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t=.01,n=.1,i=e.elements,a=i[0],r=i[4],o=i[8],l=i[1],u=i[5],d=i[9],c=i[2],h=i[6],m=i[10],p=void 0,g=void 0,v=void 0,f=void 0,k=void 0,_=void 0,b=void 0,w=void 0,S=void 0,E=void 0,A=void 0;return Ue(r-l)<t&&Ue(o-c)<t&&Ue(d-h)<t?Ue(r+l)<n&&Ue(o+c)<n&&Ue(d+h)<n&&Ue(a+u+m-3)<n?this.set(1,0,0,0):(p=Le,k=(a+1)/2,_=(u+1)/2,b=(m+1)/2,w=(r+l)/4,S=(o+c)/4,E=(d+h)/4,k>_&&k>b?k<t?(g=0,v=.707106781,f=.707106781):(g=Me(k),v=w/g,f=S/g):_>b?_<t?(g=.707106781,v=0,f=.707106781):(v=Me(_),g=w/v,f=E/v):b<t?(g=.707106781,v=.707106781,f=0):(f=Me(b),g=S/f,v=E/f),this.set(g,v,f,p)):(A=Me((h-d)*(h-d)+(o-c)*(o-c)+(l-r)*(l-r)),.001>Ue(A)&&(A=1),this.x=(h-d)/A,this.y=(o-c)/A,this.z=(l-r)/A,this.w=Re((a+u+m-1)/2)),this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this.w=e.w*t.w,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this}},{key:"applyMatrix4",value:function(t){var n=this.x,i=this.y,a=this.z,r=this.w,o=t.elements;return this.x=o[0]*n+o[4]*i+o[8]*a+o[12]*r,this.y=o[1]*n+o[5]*i+o[9]*a+o[13]*r,this.z=o[2]*n+o[6]*i+o[10]*a+o[14]*r,this.w=o[3]*n+o[7]*i+o[11]*a+o[15]*r,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"manhattanLength",value:function(){return Ue(this.x)+Ue(this.y)+Ue(this.z)+Ue(this.w)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Me(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanDistanceTo",value:function(e){return Ue(this.x-e.x)+Ue(this.y-e.y)+Ue(this.z-e.z)+Ue(this.w-e.w)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z,a=this.w-e.w;return t*t+n*n+i*i+a*a}},{key:"distanceTo",value:function(e){return Me(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=Ye(this.x,e.x),this.y=Ye(this.y,e.y),this.z=Ye(this.z,e.z),this.w=Ye(this.w,e.w),this}},{key:"max",value:function(e){return this.x=He(this.x,e.x),this.y=He(this.y,e.y),this.z=He(this.z,e.z),this.w=He(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=He(e.x,Ye(t.x,this.x)),this.y=He(e.y,Ye(t.y,this.y)),this.z=He(e.z,Ye(t.z,this.z)),this.w=He(e.w,Ye(t.w,this.w)),this}},{key:"floor",value:function(){return this.x=Xe(this.x),this.y=Xe(this.y),this.z=Xe(this.z),this.w=Xe(this.w),this}},{key:"ceil",value:function(){return this.x=Fe(this.x),this.y=Fe(this.y),this.z=Fe(this.z),this.w=Fe(this.w),this}},{key:"round",value:function(){return this.x=je(this.x),this.y=je(this.y),this.z=je(this.z),this.w=je(this.w),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}]),e}(),En={MAIN:0,AUXILIARY:1,SECONDARY:2},An=new Qt,Pn=new c,Cn=function(){function e(t,n,i,a){Ge(this,e),this.position=t,this.quaternion=n,this.target=i,this.settings=a,this.spherical=new bn}return Ze(e,[{key:"setPosition",value:function(e){return this.position=e,this}},{key:"setQuaternion",value:function(e){return this.quaternion=e,this}},{key:"setTarget",value:function(e){return this.target=e,this}},{key:"updateQuaternion",value:function(){var e=this.settings,t=e.rotation;return e.general.orbit?Pn.lookAt(An.subVectors(this.position,this.target),t.pivotOffset,t.up):Pn.lookAt(An.set(0,0,0),this.target.setFromSpherical(this.spherical),t.up),this.quaternion.setFromRotationMatrix(Pn),this}},{key:"adjustSpherical",value:function(e,t){var n=this.settings,i=n.general.orbit,a=n.rotation,r=this.spherical;return r.theta=a.invertX?r.theta+e:r.theta-e,r.phi=(i||a.invertY)&&!(i&&a.invertY)?r.phi-t:r.phi+t,r.theta=Ye(He(r.theta,a.minAzimuthalAngle),a.maxAzimuthalAngle),r.phi=Ye(He(r.phi,a.minPolarAngle),a.maxPolarAngle),r.theta%=2*Le,r.makeSafe(),i&&this.position.setFromSpherical(r).add(this.target),this}},{key:"zoom",value:function(e){var t=this.settings,n=t.general,i=t.sensitivity,a=t.zoom,r=this.spherical,o=void 0,s=void 0,l=void 0;return n.orbit&&a.enabled&&(o=e*i.zoom,a.invert&&(o=-o),s=He(a.minDistance,1e-6),l=Ye(a.maxDistance,1/0),r.radius=Ye(He(r.radius+o,s),l),this.position.setFromSpherical(r).add(this.target)),this}},{key:"update",value:function(){}},{key:"lookAt",value:function(e){var t=this.spherical,n=this.position,i=this.target;return i.copy(e),this.settings.general.orbit?An.subVectors(n,i):An.subVectors(i,n).normalize(),t.setFromVector3(An),t.radius=He(t.radius,1e-6),this.updateQuaternion(),this}},{key:"getViewDirection",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt;return e.setFromSpherical(this.spherical).normalize(),this.settings.general.orbit&&e.negate(),e}}]),e}(),Tn=function(){function e(){Ge(this,e),this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.up=!1,this.down=!1}return Ze(e,[{key:"reset",value:function(){return this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.up=!1,this.down=!1,this}}]),e}(),On=new Qt(1,0,0),x=new Qt(0,1,0),y=new Qt(0,0,1),z=new Qt,In=function(){function e(t,n,i,a){Ge(this,e),this.position=t,this.quaternion=n,this.target=i,this.settings=a,this.movementState=new Tn}return Ze(e,[{key:"setPosition",value:function(e){return this.position=e,this}},{key:"setQuaternion",value:function(e){return this.quaternion=e,this}},{key:"setTarget",value:function(e){return this.target=e,this}},{key:"translateOnAxis",value:function(e,t){z.copy(e).applyQuaternion(this.quaternion).multiplyScalar(t),this.position.add(z),this.settings.general.orbit&&this.target.add(z)}},{key:"translate",value:function(e){var t=this.settings.sensitivity,n=this.movementState,i=e*t.translation;n.backward?this.translateOnAxis(y,i):n.forward&&this.translateOnAxis(y,-i),n.right?this.translateOnAxis(On,i):n.left&&this.translateOnAxis(On,-i),n.up?this.translateOnAxis(x,i):n.down&&this.translateOnAxis(x,-i)}},{key:"update",value:function(e){this.settings.translation.enabled&&this.translate(e)}},{key:"moveTo",value:function(e){return this.settings.general.orbit?this.target.copy(e):this.position.copy(e),this}}]),e}(),Dn=new Proxy({BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,META_LEFT:91,META_RIGHT:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222},{get:function(e,t){return t in e?e[t]:1===t.length?t.toUpperCase().charCodeAt(0):void 0}}),Ln=function(){function e(){Ge(this,e),this.orbit=!0}return Ze(e,[{key:"copy",value:function(e){return this.orbit=e.orbit,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),Bn=function(){function e(){Ge(this,e),this.defaultActions=new Map,this.actions=new Map}return Ze(e,[{key:"reset",value:function(){return this.actions=new Map(this.defaultActions),this}},{key:"setDefault",value:function(e){return this.defaultActions=e,this.reset()}},{key:"copy",value:function(e){return this.defaultActions=new Map(e.defaultActions),this.actions=new Map(e.actions),this}},{key:"clearDefault",value:function(){return this.defaultActions.clear(),this}},{key:"clear",value:function(){return this.actions.clear(),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"has",value:function(e){return this.actions.has(e)}},{key:"get",value:function(e){return this.actions.get(e)}},{key:"set",value:function(e,t){return this.actions.set(e,t),this}},{key:"delete",value:function(e){return this.actions.delete(e)}},{key:"toJSON",value:function(){return{defaultActions:[].concat(Je(this.defaultActions)),actions:[].concat(Je(this.actions))}}}]),e}(),Fn=function(){function e(){Ge(this,e),this.hold=!1,this.lock=!0}return Ze(e,[{key:"copy",value:function(e){return this.hold=e.hold,this.lock=e.lock,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),Rn=function(){function e(){Ge(this,e),this.up=new Qt,this.up.copy(x),this.pivotOffset=new Qt,this.minAzimuthalAngle=-Infinity,this.maxAzimuthalAngle=1/0,this.minPolarAngle=0,this.maxPolarAngle=Le,this.invertX=!1,this.invertY=!1}return Ze(e,[{key:"copy",value:function(e){return this.up.copy(e.up),this.pivotOffset.copy(e.pivotOffset),this.minAzimuthalAngle=null===e.minAzimuthalAngle?-Infinity:e.minAzimuthalAngle,this.maxAzimuthalAngle=null===e.maxAzimuthalAngle?1/0:e.maxAzimuthalAngle,this.minPolarAngle=e.minPolarAngle,this.maxPolarAngle=e.maxPolarAngle,this.invertX=e.invertX,this.invertY=e.invertY,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),Mn=function(){function e(){Ge(this,e),this.rotation=.0025,this.translation=1,this.zoom=.1}return Ze(e,[{key:"copy",value:function(e){return this.rotation=e.rotation,this.translation=e.translation,this.zoom=e.zoom,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),Vn=function(){function e(){Ge(this,e),this.enabled=!0}return Ze(e,[{key:"copy",value:function(e){return this.enabled=e.enabled,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),Nn=function(){function e(){Ge(this,e),this.enabled=!0,this.invert=!1,this.minDistance=1e-6,this.maxDistance=1/0}return Ze(e,[{key:"copy",value:function(e){return this.enabled=e.enabled,this.invert=e.invert,this.minDistance=e.minDistance,this.maxDistance=e.maxDistance,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),qn=function(){function e(){Ge(this,e),this.general=new Ln,this.keyBindings=new Bn,this.keyBindings.setDefault(new Map([[Dn.W,Wt.MOVE_FORWARD],[Dn.UP,Wt.MOVE_FORWARD],[Dn.A,Wt.MOVE_LEFT],[Dn.LEFT,Wt.MOVE_LEFT],[Dn.S,Wt.MOVE_BACKWARD],[Dn.DOWN,Wt.MOVE_BACKWARD],[Dn.D,Wt.MOVE_RIGHT],[Dn.RIGHT,Wt.MOVE_RIGHT],[Dn.X,Wt.MOVE_DOWN],[Dn.SPACE,Wt.MOVE_UP],[Dn.PAGE_DOWN,Wt.ZOOM_OUT],[Dn.PAGE_UP,Wt.ZOOM_IN]])),this.pointer=new Fn,this.rotation=new Rn,this.sensitivity=new Mn,this.translation=new Vn,this.zoom=new Nn}return Ze(e,[{key:"copy",value:function(e){return this.general.copy(e.general),this.keyBindings.copy(e.keyBindings),this.pointer.copy(e.pointer),this.rotation.copy(e.rotation),this.sensitivity.copy(e.sensitivity),this.translation.copy(e.translation),this.zoom.copy(e.zoom),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"toDataURL",value:function(){return URL.createObjectURL(new Blob([JSON.stringify(this)],{type:"text/json"}))}}]),e}(),Un=function(){function e(){Ge(this,e)}return Ze(e,[{key:"execute",value:function(){throw new Error("Strategy#execute method not implemented!")}}]),e}(),Hn=function(e){function t(e,n){Ge(this,t);var i=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.movementState=e,i.direction=n,i}return We(t,e),Ze(t,[{key:"execute",value:function(e){var t=this.movementState;switch(this.direction){case Yn.FORWARD:t.forward=e;break;case Yn.LEFT:t.left=e;break;case Yn.BACKWARD:t.backward=e;break;case Yn.RIGHT:t.right=e;break;case Yn.DOWN:t.down=e;break;case Yn.UP:t.up=e;}}}]),t}(Un),Yn={FORWARD:0,LEFT:1,BACKWARD:2,RIGHT:3,DOWN:4,UP:5},Xn=function(e){function t(e,n){Ge(this,t);var i=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.rotationManager=e,i.zoomIn=n,i}return We(t,e),Ze(t,[{key:"execute",value:function(e){e&&this.rotationManager.zoom(this.zoomIn?-1:1)}}]),t}(Un),jn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:document.body;Ge(this,e),this.dom=i,this.position=t,this.quaternion=n,this.target=new Qt,this.settings=new qn,this.rotationManager=new Cn(t,n,this.target,this.settings),this.translationManager=new In(t,n,this.target,this.settings),this.strategies=function(e,t){var n=t.movementState;return new Map([[Wt.MOVE_FORWARD,new Hn(n,Yn.FORWARD)],[Wt.MOVE_LEFT,new Hn(n,Yn.LEFT)],[Wt.MOVE_BACKWARD,new Hn(n,Yn.BACKWARD)],[Wt.MOVE_RIGHT,new Hn(n,Yn.RIGHT)],[Wt.MOVE_DOWN,new Hn(n,Yn.DOWN)],[Wt.MOVE_UP,new Hn(n,Yn.UP)],[Wt.ZOOM_OUT,new Xn(e,!1)],[Wt.ZOOM_IN,new Xn(e,!0)]])}(this.rotationManager,this.translationManager),this.lastScreenPosition=new nn,this.dragging=!1,this.enabled=!1,null!==t&&null!==n&&(this.lookAt(this.target),null!==i&&this.setEnabled())}return Ze(e,[{key:"getDom",value:function(){return this.dom}},{key:"getPosition",value:function(){return this.position}},{key:"getQuaternion",value:function(){return this.quaternion}},{key:"getTarget",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt;return e.copy(this.target),this.settings.general.orbit||e.add(this.position),e}},{key:"getViewDirection",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt;return this.rotationManager.getViewDirection(e)}},{key:"setDom",value:function(e){var t=this.enabled;return null!==e&&(t&&this.setEnabled(!1),this.dom=e,this.setEnabled(t)),this}},{key:"setPosition",value:function(e){return this.position=e,this.rotationManager.setPosition(e),this.translationManager.setPosition(e),this.lookAt(this.target)}},{key:"setQuaternion",value:function(e){return this.quaternion=e,this.rotationManager.setQuaternion(e),this.translationManager.setQuaternion(e),this.lookAt(this.target)}},{key:"setTarget",value:function(e){return this.target=e,this.rotationManager.setTarget(e),this.translationManager.setTarget(e),this.lookAt(this.target)}},{key:"setOrbitEnabled",value:function(e){var t=this.settings.general;return t.orbit!==e&&(this.getTarget(this.target),t.orbit=e,this.lookAt(this.target)),this}},{key:"copy",value:function(e){return this.dom=e.getDom(),this.position=e.getPosition(),this.quaternion=e.getQuaternion(),this.target=e.getTarget(),this.settings.copy(e.settings),this.rotationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.translationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.lookAt(this.target)}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"handlePointerMoveEvent",value:function(e){var t=this.settings,n=t.pointer,i=t.sensitivity,a=this.rotationManager,r=this.lastScreenPosition,o=void 0,s=void 0;document.pointerLockElement===this.dom?(!n.hold||this.dragging)&&a.adjustSpherical(e.movementX*i.rotation,e.movementY*i.rotation).updateQuaternion():(o=e.screenX-r.x,s=e.screenY-r.y,r.set(e.screenX,e.screenY),a.adjustSpherical(o*i.rotation,s*i.rotation).updateQuaternion())}},{key:"handleTouchMoveEvent",value:function(e){var t=this.settings.sensitivity,n=this.rotationManager,i=this.lastScreenPosition,a=e.touches[0],r=a.screenX-i.x,o=a.screenY-i.y;i.set(a.screenX,a.screenY),e.preventDefault(),n.adjustSpherical(r*t.rotation,o*t.rotation).updateQuaternion()}},{key:"handleMainPointerButton",value:function(e,t){this.dragging=t,this.settings.pointer.lock?this.setPointerLocked():t?(this.lastScreenPosition.set(e.screenX,e.screenY),this.dom.addEventListener("mousemove",this)):this.dom.removeEventListener("mousemove",this)}},{key:"handleAuxiliaryPointerButton",value:function(){}},{key:"handleSecondaryPointerButton",value:function(){}},{key:"handlePointerButtonEvent",value:function(e,t){switch(e.preventDefault(),e.button){case En.MAIN:this.handleMainPointerButton(e,t);break;case En.AUXILIARY:this.handleAuxiliaryPointerButton(e,t);break;case En.SECONDARY:this.handleSecondaryPointerButton(e,t);}}},{key:"handleTouchEvent",value:function(e,t){var n=e.touches[0];e.preventDefault(),t?(this.lastScreenPosition.set(n.screenX,n.screenY),this.dom.addEventListener("touchmove",this)):this.dom.removeEventListener("touchmove",this)}},{key:"handleKeyboardEvent",value:function(e,t){var n=this.settings.keyBindings;n.has(e.keyCode)&&(e.preventDefault(),this.strategies.get(n.get(e.keyCode)).execute(t))}},{key:"handleWheelEvent",value:function(e){this.rotationManager.zoom(De(e.deltaY))}},{key:"handlePointerLockEvent",value:function(){document.pointerLockElement===this.dom?this.dom.addEventListener("mousemove",this):this.dom.removeEventListener("mousemove",this)}},{key:"handleEvent",value:function(e){switch(e.type){case"mousemove":this.handlePointerMoveEvent(e);break;case"touchmove":this.handleTouchMoveEvent(e);break;case"mousedown":this.handlePointerButtonEvent(e,!0);break;case"mouseup":this.handlePointerButtonEvent(e,!1);break;case"touchstart":this.handleTouchEvent(e,!0);break;case"touchend":this.handleTouchEvent(e,!1);break;case"keydown":this.handleKeyboardEvent(e,!0);break;case"keyup":this.handleKeyboardEvent(e,!1);break;case"wheel":this.handleWheelEvent(e);break;case"pointerlockchange":this.handlePointerLockEvent();}}},{key:"update",value:function(e){this.rotationManager.update(e),this.translationManager.update(e)}},{key:"moveTo",value:function(e){return this.rotationManager.moveTo(e),this}},{key:"lookAt",value:function(e){return this.rotationManager.lookAt(e),this}},{key:"setPointerLocked",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];e?document.pointerLockElement!==this.dom&&void 0!==this.dom.requestPointerLock&&this.dom.requestPointerLock():void 0!==document.exitPointerLock&&document.exitPointerLock()}},{key:"setEnabled",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=this.dom;return this.translationManager.movementState.reset(),e&&!this.enabled?(document.addEventListener("pointerlockchange",this),document.body.addEventListener("keyup",this),document.body.addEventListener("keydown",this),t.addEventListener("mousedown",this),t.addEventListener("mouseup",this),t.addEventListener("touchstart",this),t.addEventListener("touchend",this),t.addEventListener("wheel",this)):!e&&this.enabled&&(document.removeEventListener("pointerlockchange",this),document.body.removeEventListener("keyup",this),document.body.removeEventListener("keydown",this),t.removeEventListener("mousedown",this),t.removeEventListener("mouseup",this),t.removeEventListener("touchstart",this),t.removeEventListener("touchend",this),t.removeEventListener("wheel",this),t.removeEventListener("mousemove",this),t.removeEventListener("touchmove",this)),this.setPointerLocked(!1),this.enabled=e,this}},{key:"dispose",value:function(){this.setEnabled(!1)}}]),e}(),Gn=0,Zn=function(t){function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3],o=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];Ge(this,n);var s=Qe(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));s.name="HermiteDataHelper",s.cellPosition=t,s.cellSize=i,s.data=a,s.pointsMaterial=new e.PointsMaterial({vertexColors:e.VertexColors,sizeAttenuation:!0,size:.05}),s.add(new e.Group),s.add(new e.Group),s.add(new e.Group),s.gridPoints.name="GridPoints",s.edges.name="Edges",s.normals.name="Normals";try{s.update(r,o)}catch(t){}return s}var a=Math.cbrt;return We(n,t),Ze(n,[{key:"validate",value:function(){var e=null;return null===this.cellPosition?e=new Error("The cell position is not defined"):0>=this.cellSize?e=new Error("Invalid cell size: "+this.cellSize):null===this.data?e=new Error("No data"):(this.data.empty&&(e=new Error("The provided data is empty")),this.data.compressed&&(e=new Error("The provided data must be uncompressed"))),e}},{key:"set",value:function(e,t,n){return this.cellPosition=e,this.cellSize=t,this.data=n,this}},{key:"update",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=this.data,i=this.validate();if(this.dispose(),null!==i)throw i;else e&&this.createPoints(n),t&&null!==n.edgeData&&this.createEdges(n);return this}},{key:"createPoints",value:function(t){var r=t.materialIndices,o=a(r.length)-1,n=this.cellSize,s=this.cellPosition,l=new e.Vector3,u=new e.Vector3,d=new Float32Array([0,0,0]),c=new e.BufferGeometry,h=t.materials,m=new Float32Array(3*h),p=new Float32Array(3*h),g=void 0,v=void 0,f=void 0,k=void 0,_=void 0;for(k=0,_=0,f=0;f<=o;++f)for(l.z=f*n/o,v=0;v<=o;++v)for(l.y=v*n/o,g=0;g<=o;++g)l.x=g*n/o,r[k++]!==Gn&&(u.addVectors(s,l),m[_]=u.x,p[_++]=d[0],m[_]=u.y,p[_++]=d[1],m[_]=u.z,p[_++]=d[2]);c.addAttribute("position",new e.BufferAttribute(m,3)),c.addAttribute("color",new e.BufferAttribute(p,3)),this.gridPoints.add(new e.Points(c,this.pointsMaterial))}},{key:"createEdges",value:function(t){var r=t.edgeData,o=a(t.materialIndices.length)-1,n=this.cellSize,s=new e.Vector3,l=new e.Vector3,u=[r.edgesX(this.cellPosition,this.cellSize),r.edgesY(this.cellPosition,this.cellSize),r.edgesZ(this.cellPosition,this.cellSize)],c=[new Float32Array([.6,0,0]),new Float32Array([0,.6,0]),new Float32Array([0,0,.6])],y=new Float32Array([0,1,1]),h=new e.LineBasicMaterial({vertexColors:e.VertexColors}),m=void 0,p=void 0,g=void 0,v=void 0,f=void 0,x=void 0,k=void 0,_=void 0,z=void 0,b=void 0,w=void 0,S=void 0;for(w=0,S=0,b=0;3>b;++b,w=0,S=0)if(x=c[b],_=u[b],0<_.lengths.length){f=2*_.lengths[0],m=new Float32Array(3*f),p=new Float32Array(3*f),g=new Float32Array(3*f),v=new Float32Array(3*f);var E=!0,A=!1,P=void 0;try{for(var C=_[Symbol.iterator](),T;!(E=(T=C.next()).done);E=!0)z=T.value,m[w]=z.a.x,p[w++]=x[0],m[w]=z.a.y,p[w++]=x[1],m[w]=z.a.z,p[w++]=x[2],m[w]=z.b.x,p[w++]=x[0],m[w]=z.b.y,p[w++]=x[1],m[w]=z.b.z,p[w++]=x[2],z.computeZeroCrossingPosition(s),l.copy(s).addScaledVector(z.n,.25*n/o),g[S]=s.x,v[S++]=y[0],g[S]=s.y,v[S++]=y[1],g[S]=s.z,v[S++]=y[2],g[S]=l.x,v[S++]=y[0],g[S]=l.y,v[S++]=y[1],g[S]=l.z,v[S++]=y[2]}catch(e){A=!0,P=e}finally{try{!E&&C.return&&C.return()}finally{if(A)throw P}}k=new e.BufferGeometry,k.addAttribute("position",new e.BufferAttribute(m,3)),k.addAttribute("color",new e.BufferAttribute(p,3)),this.edges.add(new e.LineSegments(k,h)),k=new e.BufferGeometry,k.addAttribute("position",new e.BufferAttribute(g,3)),k.addAttribute("color",new e.BufferAttribute(v,3)),this.normals.add(new e.LineSegments(k,h))}}},{key:"dispose",value:function(){var e=void 0,t=void 0,n=void 0,a=void 0;for(n=0,a=this.children.length;n<a;++n)for(e=this.children[n],t=e.children;0<t.length;)t[0].geometry.dispose(),t[0].material.dispose(),e.remove(t[0])}},{key:"gridPoints",get:function(){return this.children[0]}},{key:"edges",get:function(){return this.children[1]}},{key:"normals",get:function(){return this.children[2]}}],[{key:"air",set:function(e){Gn=e}}]),n}(e.Group),Kn=function(t){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;Ge(this,n);var t=Qe(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t.name="OctreeHelper",t.octree=e,t.update(),t}return We(n,t),Ze(n,[{key:"createLineSegments",value:function(t,a){var r=new e.Group,o=new e.LineBasicMaterial({color:16777215*Math.random()}),s=void 0,l=void 0,u=void 0,y=void 0,h=void 0,m=void 0,p=void 0,g=void 0,v=void 0,f=void 0,x=void 0,k=void 0,_=void 0,z=void 0,b=void 0,w=void 0;for(f=0,u=0,z=Fe(a/8191);0<z;--z){for(u+=8191>a?a:8191,a-=8191,l=8*u,y=new Uint16Array(3*l),h=new Float32Array(3*l),(k=0,_=0,s=t.next());!s.done&&f<u;){for(m=s.value,p=m.min,g=m.max,x=0;12>x;++x)w=Qn[x],y[_++]=k+w[0],y[_++]=k+w[1];for(x=0;8>x;++x,++k)b=Wn[x],h[3*k]=0===b[0]?p.x:g.x,h[3*k+1]=0===b[1]?p.y:g.y,h[3*k+2]=0===b[2]?p.z:g.z;++f<u&&(s=t.next())}v=new e.BufferGeometry,v.setIndex(new e.BufferAttribute(y,1)),v.addAttribute("position",new e.BufferAttribute(h,3)),r.add(new e.LineSegments(v,o))}this.add(r)}},{key:"update",value:function(){var e=null===this.octree?-1:this.octree.getDepth(),t=0,n=void 0;for(this.dispose();t<=e;)n=this.octree.findOctantsByLevel(t),this.createLineSegments(n[Symbol.iterator](),"number"==typeof n.size?n.size:n.length),++t}},{key:"dispose",value:function(){var e=this.children,t=void 0,n=void 0,a=void 0,r=void 0,o=void 0,s=void 0;for(a=0,o=e.length;a<o;++a){for(t=e[a],n=t.children,(r=0,s=n.length);r<s;++r)n[r].geometry.dispose(),n[r].material.dispose();for(;0<n.length;)t.remove(n[0])}for(;0<e.length;)this.remove(e[0])}}]),n}(e.Group),Wn=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],Qn=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],$n=function(){function e(){Ge(this,e)}return Ze(e,[{key:"serialize",value:function(){}}]),e}(),Jn=function(){function e(){Ge(this,e)}return Ze(e,[{key:"deserialize",value:function(){}}]),e}(),ei=function(){function e(){Ge(this,e)}return Ze(e,[{key:"dispose",value:function(){}}]),e}(),ti=function(){function e(){Ge(this,e)}return Ze(e,[{key:"createTransferList",value:function(){}}]),e}(),ni=function(){function e(){Ge(this,e),this.elements=[],this.head=0}return Ze(e,[{key:"copy",value:function(e){return this.elements=Array.from(e.elements),this.head=e.head,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"add",value:function(e){this.elements.push(e)}},{key:"peek",value:function(){return 0<this.elements.length?this.elements[this.head]:void 0}},{key:"poll",value:function(){var e=this.elements,t=e.length,n=void 0;return 0<t&&(n=e[this.head++],2*this.head>=t&&(this.elements=e.slice(this.head),this.head=0)),n}},{key:"clear",value:function(){this.elements=[],this.head=0}},{key:"size",get:function(){return this.elements.length-this.head}},{key:"empty",get:function(){return 0===this.elements.length}}]),e}(),ii={UNION:"csg.union",DIFFERENCE:"csg.difference",INTERSECTION:"csg.intersection",DENSITY_FUNCTION:"csg.densityfunction"},ai={AIR:0,SOLID:1},ri=function(){function e(t){Ge(this,e),this.type=t;for(var n=arguments.length,i=Array(1<n?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];this.children=i,this.boundingBox=null}return Ze(e,[{key:"getBoundingBox",value:function(){return null===this.boundingBox&&(this.boundingBox=this.computeBoundingBox()),this.boundingBox}},{key:"computeBoundingBox",value:function(){var e=this.children,t=new v,n=void 0,a=void 0;for(n=0,a=e.length;n<a;++n)t.union(e[n].getBoundingBox());return t}}]),e}(),oi=function(e){function t(){var e;Ge(this,t);for(var n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];return Qe(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this,ii.UNION].concat(i)))}return We(t,e),Ze(t,[{key:"updateMaterialIndex",value:function(e,t,n){var i=n.materialIndices[e];i!==ai.AIR&&t.setMaterialIndex(e,i)}},{key:"selectEdge",value:function(e,t,n){return n?e.t>t.t?e:t:e.t<t.t?e:t}}]),t}(ri),si=function(e){function t(){var e;Ge(this,t);for(var n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];return Qe(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this,ii.DIFFERENCE].concat(i)))}return We(t,e),Ze(t,[{key:"updateMaterialIndex",value:function(e,t,n){n.materialIndices[e]!==ai.AIR&&t.setMaterialIndex(e,ai.AIR)}},{key:"selectEdge",value:function(e,t,n){return n?e.t<t.t?e:t:e.t>t.t?e:t}}]),t}(ri),li=function(e){function t(){var e;Ge(this,t);for(var n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];return Qe(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this,ii.INTERSECTION].concat(i)))}return We(t,e),Ze(t,[{key:"updateMaterialIndex",value:function(e,t,n){var i=n.materialIndices[e];t.setMaterialIndex(e,t.materialIndices[e]!==ai.AIR&&i!==ai.AIR?i:ai.AIR)}},{key:"selectEdge",value:function(e,t,n){return n?e.t<t.t?e:t:e.t>t.t?e:t}}]),t}(ri),ui=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;Ge(this,e),this.runLengths=t,this.data=n}return Ze(e,null,[{key:"encode",value:function(t){var n=[],a=[],r=t[0],o=1,s=void 0,u=void 0;for(s=1,u=t.length;s<u;++s)r===t[s]?++o:(n.push(o),a.push(r),r=t[s],o=1);return n.push(o),a.push(r),new e(n,a)}},{key:"decode",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],a=void 0,r=void 0,o=void 0,s=void 0,l=void 0,u=0;for(r=0,s=t.length;r<s;++r)for(a=t[r],o=0,l=e[r];o<l;++o)n[u++]=a;return n}}]),e}(),di=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];Ge(this,e),this.value=t,this.done=n}return Ze(e,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),e}(),ci=new Qt,yi=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Qt;Ge(this,e),this.min=t,this.max=n,this.children=null}return Ze(e,[{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt;return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt;return e.subVectors(this.max,this.min)}},{key:"split",value:function(){var e=this.min,t=this.max,n=this.getCenter(ci),a=this.children=[null,null,null,null,null,null,null,null],r=void 0,o=void 0;for(r=0;8>r;++r)o=hi[r],a[r]=new this.constructor(new Qt(0===o[0]?e.x:n.x,0===o[1]?e.y:n.y,0===o[2]?e.z:n.z),new Qt(0===o[0]?n.x:t.x,0===o[1]?n.y:t.y,0===o[2]?n.z:t.z))}}]),e}(),hi=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],mi=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],pi=new Qt,gi=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;Ge(this,e),this.min=t,this.size=n,this.children=null}return Ze(e,[{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt;return e.copy(this.min).addScalar(.5*this.size)}},{key:"getDimensions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt;return e.set(this.size,this.size,this.size)}},{key:"split",value:function(){var e=this.min,t=this.getCenter(pi),n=.5*this.size,a=this.children=[null,null,null,null,null,null,null,null],r=void 0,o=void 0;for(r=0;8>r;++r)o=hi[r],a[r]=new this.constructor(new Qt(0===o[0]?e.x:t.x,0===o[1]?e.y:t.y,0===o[2]?e.z:t.z),n)}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}]),e}(),vi=new v,fi=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;Ge(this,e),this.octree=t,this.region=n,this.cull=null!==n,this.result=new di,this.trace=null,this.indices=null,this.reset()}return Ze(e,[{key:"reset",value:function(){var e=this.octree.root;return this.trace=[],this.indices=[],null!==e&&(vi.min=e.min,vi.max=e.max,(!this.cull||this.region.intersectsBox(vi))&&(this.trace.push(e),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var e=this.cull,t=this.region,n=this.indices,i=this.trace,a=null,r=i.length-1,o=void 0,s=void 0,l=void 0;null===a&&0<=r;)if(o=n[r]++,s=i[r].children,!(8>o))i.pop(),n.pop(),--r;else if(null!==s){if(l=s[o],e&&(vi.min=l.min,vi.max=l.max,!t.intersectsBox(vi)))continue;i.push(l),n.push(0),++r}else a=i.pop(),n.pop();return this.result.value=a,this.result.done=null===a,this.result}},{key:"return",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),xi=[new Qt,new Qt,new Qt],ki=new v,_i=new zn,r=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],zi=0,bi=function(){function e(){Ge(this,e)}return Ze(e,null,[{key:"intersectOctree",value:function(e,t,n){var i=ki.min.set(0,0,0),a=ki.max.subVectors(e.max,e.min),r=e.getDimensions(xi[0]),o=xi[1].copy(r).multiplyScalar(.5),s=_i.origin.copy(t.ray.origin),l=_i.direction.copy(t.ray.direction),u=void 0,d=void 0,c=void 0,y=void 0,h=void 0,m=void 0,p=void 0,g=void 0,v=void 0;s.sub(e.getCenter(xi[2])).add(o),zi=0,0>l.x&&(s.x=r.x-s.x,l.x=-l.x,zi|=4),0>l.y&&(s.y=r.y-s.y,l.y=-l.y,zi|=2),0>l.z&&(s.z=r.z-s.z,l.z=-l.z,zi|=1),u=1/l.x,d=1/l.y,c=1/l.z,y=(i.x-s.x)*u,h=(a.x-s.x)*u,m=(i.y-s.y)*d,p=(a.y-s.y)*d,g=(i.z-s.z)*c,v=(a.z-s.z)*c,He(He(y,m),g)<Ye(Ye(h,p),v)&&H(e.root,y,m,g,h,p,v,t,n)}}]),e}(),wi=new v,Si=function(){function e(t,n){Ge(this,e),this.root=void 0!==t&&void 0!==n?new yi(t,n):null}return Ze(e,[{key:"getCenter",value:function(e){return this.root.getCenter(e)}},{key:"getDimensions",value:function(e){return this.root.getDimensions(e)}},{key:"getDepth",value:function(){return Y(this.root)}},{key:"cull",value:function(e){var t=[];return X(this.root,e,t),t}},{key:"findOctantsByLevel",value:function(e){var t=[];return j(this.root,e,0,t),t}},{key:"raycast",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return bi.intersectOctree(this,e,t),t}},{key:"leaves",value:function(e){return new fi(this,e)}},{key:Symbol.iterator,value:function(){return new fi(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),e}(),Ei=new Qt,p=function(e){function t(e,n){Ge(this,t);var i=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.points=null,i.data=null,i}return We(t,e),Ze(t,[{key:"distanceToSquared",value:function(e){var t=Ei.copy(e).clamp(this.min,this.max);return t.sub(e).lengthSquared()}},{key:"distanceToCenterSquared",value:function(e){var t=this.getCenter(Ei),n=e.x-t.x,i=e.y-t.x,a=e.z-t.z;return n*n+i*i+a*a}},{key:"contains",value:function(e,t){var n=this.min,i=this.max;return e.x>=n.x-t&&e.y>=n.y-t&&e.z>=n.z-t&&e.x<=i.x+t&&e.y<=i.y+t&&e.z<=i.z+t}},{key:"redistribute",value:function(e){var t=this.children,n=this.points,a=this.data,r=void 0,o=void 0,s=void 0,l=void 0,u=void 0,d=void 0,c=void 0;if(null!==t&&null!==n)for(r=0,s=n.length;r<s;++r)for(d=n[r],c=a[r],(o=0,l=t.length);o<l;++o)if(u=t[o],u.contains(d,e)){null===u.points&&(u.points=[],u.data=[]),u.points.push(d),u.data.push(c);break}this.points=null,this.data=null}},{key:"merge",value:function(){var e=this.children,t=void 0,n=void 0,a=void 0;if(null!==e){for(this.points=[],this.data=[],(t=0,n=e.length);t<n;++t)if(a=e[t],null!==a.points){var r,o;(r=this.points).push.apply(r,Je(a.points)),(o=this.data).push.apply(o,Je(a.data))}this.children=null}}}]),t}(yi),Ai=function e(t,n,i){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;Ge(this,e),this.distance=t,this.distanceToRay=n,this.point=i,this.object=a},Pi=1e-6,Ci=function(e){function t(e,n){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:8;Ge(this,t);var o=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.root=new p(e,n),o.bias=He(0,i),o.maxPoints=He(1,je(a)),o.maxDepth=He(0,je(r)),o.pointCount=0,o}return We(t,e),Ze(t,[{key:"countPoints",value:function(e){return G(e)}},{key:"put",value:function(e,t){return Z(e,t,this,this.root,0)}},{key:"remove",value:function(e){return K(e,this,this.root,null)}},{key:"fetch",value:function(e){return W(e,this,this.root)}},{key:"move",value:function(e,t){return Q(e,t,this,this.root,null,0)}},{key:"findNearestPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0,n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];return $(e,t,n,this.root)}},{key:"findPoints",value:function(e,t){var n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],i=[];return J(e,t,n,this.root,i),i}},{key:"raycast",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],i=Ke(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"raycast",this).call(this,e);return 0<i.length&&this.testPoints(i,e,n),n}},{key:"testPoints",value:function(e,t,n){var a=t.params.Points.threshold,r=void 0,o=void 0,s=void 0,l=void 0,u=void 0,d=void 0,c=void 0,y=void 0,h=void 0,m=void 0,p=void 0;for(u=0,c=e.length;u<c;++u)if(h=e[u],m=h.points,null!==m)for(d=0,y=m.length;d<y;++d)p=m[d],l=t.ray.distanceSqToPoint(p),l<a*a&&(r=t.ray.closestPointToPoint(p,new Qt),o=t.ray.origin.distanceTo(r),o>=t.near&&o<=t.far&&(s=Me(l),n.push(new Ai(o,s,r,h.data[d]))))}}]),t}(Si),Ti=new v,Oi=new Qt,Ii=new Qt,u=new Qt,Di=function(){function e(){Ge(this,e)}return Ze(e,null,[{key:"recycleOctants",value:function(e,t){var n=e.min,a=e.getCenter(Ii),r=e.getDimensions(u).multiplyScalar(.5),o=e.children,s=t.length,l=void 0,d=void 0,c=void 0,y=void 0;for(l=0;8>l;++l)for(c=hi[l],Ti.min.addVectors(n,Oi.fromArray(c).multiply(r)),Ti.max.addVectors(a,Oi.fromArray(c).multiply(r)),d=0;d<s;++d)if(y=t[d],null!==y&&Ti.min.equals(y.min)&&Ti.max.equals(y.max)){o[l]=y,t[d]=null;break}}}]),e}(),Li=new Qt,Bi=new Qt,Fi=new Qt,Ri=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Qt;Ge(this,e),this.a=t,this.b=n,this.index=-1,this.coordinates=new Qt,this.t=0,this.n=new Qt}return Ze(e,[{key:"approximateZeroCrossing",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,n=He(1,t-1),r=0,o=1,s=0,l=0,u=void 0,d=void 0;for(Li.subVectors(this.b,this.a);l<=n&&(s=(r+o)/2,Bi.addVectors(this.a,Fi.copy(Li).multiplyScalar(s)),d=e.sample(Bi),!(Ue(d)<=1e-4||(o-r)/2<=1e-6));)Bi.addVectors(this.a,Fi.copy(Li).multiplyScalar(r)),u=e.sample(Bi),De(d)===De(u)?r=s:o=s,++l;this.t=s}},{key:"computeZeroCrossingPosition",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt;return e.subVectors(this.b,this.a).multiplyScalar(this.t).add(this.a)}},{key:"computeSurfaceNormal",value:function(e){var t=this.computeZeroCrossingPosition(Li),n=1e-3,i=e.sample(Bi.addVectors(t,Fi.set(n,0,0)))-e.sample(Bi.subVectors(t,Fi.set(n,0,0))),a=e.sample(Bi.addVectors(t,Fi.set(0,n,0)))-e.sample(Bi.subVectors(t,Fi.set(0,n,0))),r=e.sample(Bi.addVectors(t,Fi.set(0,0,n)))-e.sample(Bi.subVectors(t,Fi.set(0,0,n)));this.n.set(i,a,r).normalize()}}]),e}(),Mi=new Ri,Vi=new Qt,Ni=new Qt,qi=function(){function e(t,n,i){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:3;Ge(this,e),this.edgeData=t,this.cellPosition=n,this.cellSize=i,this.indices=null,this.zeroCrossings=null,this.normals=null,this.axes=null,this.lengths=null,this.result=new di,this.initialC=a,this.c=a,this.initialD=r,this.d=r,this.i=0,this.l=0,this.reset()}return Ze(e,[{key:"reset",value:function(){var e=this.edgeData,t=[],n=[],i=[],r=[],o=[],s=void 0,u=void 0,y=void 0,h=void 0;for(this.i=0,this.c=0,this.d=0,(u=this.initialC,s=4>>u,y=this.initialD);u<y;++u,s>>=1)h=e.indices[u].length,0<h&&(t.push(e.indices[u]),n.push(e.zeroCrossings[u]),i.push(e.normals[u]),r.push(hi[s]),o.push(h),++this.d);return this.l=0<o.length?o[0]:0,this.indices=t,this.zeroCrossings=n,this.normals=i,this.axes=r,this.lengths=o,this.result.reset(),this}},{key:"next",value:function(){var e=this.cellSize,t=this.edgeData.resolution,n=t+1,a=n*n,r=this.result,o=this.cellPosition,s=void 0,l=void 0,u=void 0,d=void 0,h=void 0,m=void 0,p=void 0;return this.i===this.l&&(this.l=++this.c<this.d?this.lengths[this.c]:0,this.i=0),this.i<this.l?(m=this.c,p=this.i,s=this.axes[m],l=this.indices[m][p],Mi.index=l,u=l%n,d=Ie(l%a/n),h=Ie(l/a),Mi.coordinates.set(u,d,h),Vi.set(u*e/t,d*e/t,h*e/t),Ni.set((u+s[0])*e/t,(d+s[1])*e/t,(h+s[2])*e/t),Mi.a.addVectors(o,Vi),Mi.b.addVectors(o,Ni),Mi.t=this.zeroCrossings[m][p],Mi.n.fromArray(this.normals[m],3*p),r.value=Mi,++this.i):(r.value=null,r.done=!0),r}},{key:"return",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),Ui=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:n;Ge(this,e),this.resolution=t,this.indices=0>=n?null:[new Uint32Array(n),new Uint32Array(i),new Uint32Array(a)],this.zeroCrossings=0>=n?null:[new Float32Array(n),new Float32Array(i),new Float32Array(a)],this.normals=0>=n?null:[new Float32Array(3*n),new Float32Array(3*i),new Float32Array(3*a)]}return Ze(e,[{key:"serialize",value:function(){return{resolution:this.resolution,edges:this.edges,zeroCrossings:this.zeroCrossings,normals:this.normals}}},{key:"deserialize",value:function(e){var t=this;return null===e?t=null:(this.resolution=e.resolution,this.edges=e.edges,this.zeroCrossings=e.zeroCrossings,this.normals=e.normals),t}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=[this.edges[0],this.edges[1],this.edges[2],this.zeroCrossings[0],this.zeroCrossings[1],this.zeroCrossings[2],this.normals[0],this.normals[1],this.normals[2]],n=void 0,a=void 0,r=void 0;for(a=0,r=t.length;a<r;++a)n=t[a],null!==n&&e.push(n.buffer);return e}},{key:"edges",value:function(e,t){return new qi(this,e,t)}},{key:"edgesX",value:function(e,t){return new qi(this,e,t,0,1)}},{key:"edgesY",value:function(e,t){return new qi(this,e,t,1,2)}},{key:"edgesZ",value:function(e,t){return new qi(this,e,t,2,3)}}],[{key:"calculate1DEdgeCount",value:function(e){return qe(e+1,2)*e}}]),e}(),Hi=0,Yi=0,Xi=0,ji=function(){function e(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];Ge(this,e),this.materials=0,this.materialIndices=t?new Uint8Array(Xi):null,this.runLengths=null,this.edgeData=null}return Ze(e,[{key:"set",value:function(e){return this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,this.edgeData=e.edgeData,this}},{key:"clear",value:function(){return this.materials=0,this.materialIndices=null,this.runLengths=null,this.edgeData=null,this}},{key:"setMaterialIndex",value:function(e,t){this.materialIndices[e]===ai.AIR?t!==ai.AIR&&++this.materials:t===ai.AIR&&--this.materials,this.materialIndices[e]=t}},{key:"compress",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this,t=void 0;return this.compressed?(e.materialIndices=this.materialIndices,e.runLengths=this.runLengths):(t=this.full?new ui([this.materialIndices.length],[ai.SOLID]):ui.encode(this.materialIndices),e.materialIndices=new Uint8Array(t.data),e.runLengths=new Uint32Array(t.runLengths)),e.materials=this.materials,e}},{key:"decompress",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this;return e.materialIndices=this.compressed?ui.decode(this.runLengths,this.materialIndices,new Uint8Array(Xi)):this.materialIndices,e.runLengths=null,e.materials=this.materials,e}},{key:"serialize",value:function(){return{materials:this.materials,materialIndices:this.materialIndices,runLengths:this.runLengths,edgeData:null===this.edgeData?null:this.edgeData.serialize()}}},{key:"deserialize",value:function(e){var t=this;return null===e?t=null:(this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,null===e.edgeData?this.edgeData=null:(null===this.edgeData&&(this.edgeData=new Ui(Yi)),this.edgeData.deserialize(e.edgeData))),t}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.edgeData&&this.edgeData.createTransferList(e),null!==this.materialIndices&&e.push(this.materialIndices.buffer),null!==this.runLengths&&e.push(this.runLengths.buffer),e}},{key:"empty",get:function(){return 0===this.materials}},{key:"full",get:function(){return this.materials===Xi}},{key:"compressed",get:function(){return null!==this.runLengths}},{key:"neutered",get:function(){return!this.empty&&null===this.materialIndices}}],[{key:"isovalue",get:function(){return Hi},set:function(e){Hi=e}},{key:"resolution",get:function(){return Yi},set:function(e){e=qe(2,He(0,Fe(Math.log2(e)))),Yi=He(1,Ye(256,e)),Xi=qe(Yi+1,3)}}]),e}(),Gi=function(e){function t(e){Ge(this,t);var n=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,ii.DENSITY_FUNCTION));return n.sdf=e,n}return We(t,e),Ze(t,[{key:"computeBoundingBox",value:function(){return this.sdf.getBoundingBox(!0)}},{key:"generateMaterialIndex",value:function(e){return this.sdf.sample(e)<=ji.isovalue?this.sdf.material:ai.AIR}},{key:"generateEdge",value:function(e){e.approximateZeroCrossing(this.sdf),e.computeSurfaceNormal(this.sdf)}}]),t}(ri),Zi=new c,Ki=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:ai.SOLID;Ge(this,e),this.type=t,this.operation=null,this.material=Ye(255,He(ai.SOLID,Ie(n))),this.boundingBox=null,this.position=new Qt,this.quaternion=new dn,this.scale=new Qt(1,1,1),this.inverseTransformation=new c,this.updateInverseTransformation(),this.children=[]}return Ze(e,[{key:"getTransformation",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new c;return e.compose(this.position,this.quaternion,this.scale)}},{key:"getBoundingBox",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t=this.children,n=this.boundingBox,a=void 0,r=void 0;if(null===n&&(n=this.computeBoundingBox(),this.boundingBox=n),e)for(n=n.clone(),a=0,r=t.length;a<r;++a)n.union(t[a].getBoundingBox(e));return n}},{key:"setMaterial",value:function(e){return this.material=Ye(255,He(ai.SOLID,Ie(e))),this}},{key:"setOperationType",value:function(e){return this.operation=e,this}},{key:"updateInverseTransformation",value:function(){return this.inverseTransformation.getInverse(this.getTransformation(Zi)),this.boundingBox=null,this}},{key:"union",value:function(e){return this.children.push(e.setOperationType(ii.UNION)),this}},{key:"subtract",value:function(e){return this.children.push(e.setOperationType(ii.DIFFERENCE)),this}},{key:"intersect",value:function(e){return this.children.push(e.setOperationType(ii.INTERSECTION)),this}},{key:"toCSG",value:function(){var e=this.children,t=new Gi(this),n=void 0,a=void 0,r=void 0,o=void 0;for(r=0,o=e.length;r<o;++r)a=e[r],n!==a.operation&&(n=a.operation,n===ii.UNION?t=new oi(t):n===ii.DIFFERENCE?t=new si(t):n===ii.INTERSECTION?t=new li(t):void 0),t.children.push(a.toCSG());return t}},{key:"serialize",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t={type:this.type,operation:this.operation,material:this.material,position:this.position.toArray(),quaternion:this.quaternion.toArray(),scale:this.scale.toArray(),parameters:null,children:[]},n=void 0,a=void 0;for(n=0,a=this.children.length;n<a;++n)t.children.push(this.children[n].serialize(e));return t}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e}},{key:"toJSON",value:function(){return this.serialize(!0)}},{key:"computeBoundingBox",value:function(){throw new Error("SignedDistanceFunction#computeBoundingBox method not implemented!")}},{key:"sample",value:function(){throw new Error("SignedDistanceFunction#sample method not implemented!")}}]),e}(),Wi={HEIGHTFIELD:"sdf.heightfield",FRACTAL_NOISE:"sdf.fractalnoise",SUPER_PRIMITIVE:"sdf.superprimitive"},Qi=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];Ge(this,t);var i=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Wi.PERLIN_NOISE,n));return i.min=new(Function.prototype.bind.apply(Qt,[null].concat(Je(e.min)))),i.max=new(Function.prototype.bind.apply(Qt,[null].concat(Je(e.max)))),i}return We(t,e),Ze(t,[{key:"computeBoundingBox",value:function(){return this.bbox=new v(this.min,this.max),this.bbox}},{key:"sample",value:function(){}},{key:"serialize",value:function(){var e=Ke(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"serialize",this).call(this);return e.parameters={min:this.min.toArray(),max:this.max.toArray()},e}}]),t}(Ki),$i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];Ge(this,t);var i=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Wi.HEIGHTFIELD,n));return i.width=void 0===e.width?1:e.width,i.height=void 0===e.height?1:e.height,i.smooth=void 0===e.smooth||e.smooth,i.data=void 0===e.data?null:e.data,i.heightmap=null,void 0!==e.image&&i.fromImage(e.image),i}return We(t,e),Ze(t,[{key:"fromImage",value:function(e){var t="undefined"==typeof document?null:ee(e),n=null,a=void 0,r=void 0,o=void 0,s=void 0;if(null!==t){for(a=t.data,n=new Uint8ClampedArray(a.length/4),(r=0,o=0,s=n.length);r<s;++r,o+=4)n[r]=a[o];this.heightmap=e,this.width=t.width,this.height=t.height,this.data=n}return this}},{key:"getHeight",value:function(e,t){var n=this.width,i=this.height,r=this.data,o=void 0;if(e=je(e*n),t=je(t*i),this.smooth){e=He(Ye(e,n-1),1),t=He(Ye(t,i-1),1);var s=e+1,l=e-1,u=t*n,a=u+n,d=u-n;o=(r[d+l]+r[d+e]+r[d+s]+r[u+l]+r[u+e]+r[u+s]+r[a+l]+r[a+e]+r[a+s])/9}else o=r[t*n+e];return o}},{key:"computeBoundingBox",value:function(){var e=new v,t=Ye(this.width/this.height,1),n=Ye(this.height/this.width,1);return e.min.set(0,0,0),e.max.set(t,1,n),e.applyMatrix4(this.getTransformation()),e}},{key:"sample",value:function(e){var t=this.boundingBox,n=void 0;return t.containsPoint(e)?(e.applyMatrix4(this.inverseTransformation),n=e.y-this.getHeight(e.x,e.z)/255):n=t.distanceToPoint(e),n}},{key:"serialize",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],n=Ke(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"serialize",this).call(this);return n.parameters={width:this.width,height:this.height,smooth:this.smooth,data:e?null:this.data,dataURL:e&&null!==this.heightmap?this.heightmap.toDataURL():null,image:null},n}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.data.buffer),e}}]),t}(Ki),Ji=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];Ge(this,t);var i=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Wi.SUPER_PRIMITIVE,n));return i.s0=new(Function.prototype.bind.apply(Sn,[null].concat(Je(e.s)))),i.r0=new(Function.prototype.bind.apply(Qt,[null].concat(Je(e.r)))),i.s=new Sn,i.r=new Qt,i.ba=new nn,i.offset=0,i.precompute(),i}return We(t,e),Ze(t,[{key:"setSize",value:function(e,t,n,i){return this.s0.set(e,t,n,i),this.precompute()}},{key:"setRadii",value:function(e,t,n){return this.r0.set(e,t,n),this.precompute()}},{key:"precompute",value:function(){var e=this.s.copy(this.s0),t=this.r.copy(this.r0),n=this.ba;e.x-=t.x,e.y-=t.x,t.x-=e.w,e.w-=t.y,e.z-=t.y,this.offset=-2*e.z,n.set(t.z,this.offset);var i=n.dot(n);return 0===i?n.set(0,-1):n.divideScalar(i),this}},{key:"computeBoundingBox",value:function(){var e=this.s0,t=new v;return t.min.x=Ye(-e.x,-1),t.min.y=Ye(-e.y,-1),t.min.z=Ye(-e.z,-1),t.max.x=He(e.x,1),t.max.y=He(e.y,1),t.max.z=He(e.z,1),t.applyMatrix4(this.getTransformation()),t}},{key:"sample",value:function(e){e.applyMatrix4(this.inverseTransformation);var t=this.s,n=this.r,i=this.ba,a=Ue(e.x)-t.x,r=Ue(e.y)-t.y,o=Ue(e.z)-t.z,s=He(a,0),l=He(r,0),u=Me(s*s+l*l),d=e.z-t.z,y=Ue(u+Ye(0,He(a,r))-n.x)-t.w,h=Ye(He(y*i.x+d*i.y,0),1),c=y-n.z*h,m=d-this.offset*h,p=He(y-n.z,0),g=e.z+t.z,v=He(y,0),f=y*-i.y+d*i.x,x=Me(Ye(c*c+m*m,Ye(p*p+g*g,v*v+d*d)));return x*De(He(f,o))-n.y}},{key:"serialize",value:function(){var e=Ke(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"serialize",this).call(this);return e.parameters={s:this.s0.toArray(),r:this.r0.toArray()},e}}],[{key:"create",value:function(e){var n=ea[e];return new t({s:n[0],r:n[1]})}}]),t}(Ki),ea=[[new Float32Array([1,1,1,1]),new Float32Array([0,0,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,0,0])],[new Float32Array([0,0,1,1]),new Float32Array([0,0,1])],[new Float32Array([1,1,2,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,.25,1]),new Float32Array([1,.25,0])],[new Float32Array([1,1,.25,.25]),new Float32Array([1,.25,0])],[new Float32Array([1,1,1,.25]),new Float32Array([1,.1,0])],[new Float32Array([1,1,1,.25]),new Float32Array([.1,.1,0])]],ta={CUBE:0,CYLINDER:1,CONE:2,PILL:3,SPHERE:4,PELLET:5,TORUS:6,PIPE:7,CORRIDOR:8},na=function(){function e(){Ge(this,e)}return Ze(e,[{key:"revive",value:function(e){var t,n,a;switch(e.type){case Wi.FRACTAL_NOISE:t=new Qi(e.parameters,e.material);break;case Wi.HEIGHTFIELD:t=new $i(e.parameters,e.material);break;case Wi.SUPER_PRIMITIVE:t=new Ji(e.parameters,e.material);}for(t.operation=e.operation,t.position.fromArray(e.position),t.quaternion.fromArray(e.quaternion),t.scale.fromArray(e.scale),t.updateInverseTransformation(),(n=0,a=e.children.length);n<a;++n)t.children.push(this.revive(e.children[n]));return t}}]),e}(),ia=function(e){function t(e){Ge(this,t);var n=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.descriptions=null,n}return We(t,e),t}(tt),aa=new ia("load"),ra=function(e){function t(){Ge(this,t);var e=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.items=0,e.descriptions=null,e.imageMap=new WeakMap,e}return We(t,e),Ze(t,[{key:"clear",value:function(){this.imageMap=new WeakMap}},{key:"handleEvent",value:function(e){switch(e.type){case"load":this.progress(e);}}},{key:"progress",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=null===e?null:e.target,n=this.imageMap,i=void 0;null!==t&&(n.has(t)&&(i=n.get(t),i.image=t),--this.items),0===this.items&&(this.clear(),aa.descriptions=this.descriptions,this.dispatchEvent(aa))}},{key:"loadImage",value:function(e){var t=new Image;this.imageMap.set(t,e),++this.items,t.addEventListener("load",this),t.src=e.dataURL}},{key:"inflate",value:function(e){var t;null!==e.dataURL&&this.loadImage(e);var n=!0,i=!1,a=void 0;try{for(var r=e.children[Symbol.iterator](),o;!(n=(o=r.next()).done);n=!0)t=o.value,this.inflate(t)}catch(e){i=!0,a=e}finally{try{!n&&r.return&&r.return()}finally{if(i)throw a}}this.progress()}},{key:"load",value:function(e){var t;this.items=0,this.descriptions=e;var n=!0,i=!1,a=void 0;try{for(var r=e[Symbol.iterator](),o;!(n=(o=r.next()).done);n=!0)t=o.value,this.inflate(t)}catch(e){i=!0,a=e}finally{try{!n&&r.return&&r.return()}finally{if(i)throw a}}}}]),t}(nt),oa=function(){function e(){Ge(this,e)}return Ze(e,null,[{key:"parseBin",value:function(e){return parseInt(e,2)}},{key:"createBinaryString",value:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:64,n=0>e?"-":"",i=Ue(e).toString(2);i.length<t;)i="0"+i;return n+i}}]),e}(),sa=function(){function e(t,n,i){Ge(this,e),this.keyDesign=t,this.min=n,this.max=i,this.keyBase=new Qt,this.key=new Qt,this.limit=new Qt,this.result=new di,this.reset()}return Ze(e,[{key:"reset",value:function(){var e=this.keyDesign,t=this.min,n=this.max;return t.x<=n.x&&t.y<=n.y&&t.z<=n.z?(this.keyBase.set(t.x,t.y*e.rangeX,t.z*e.rangeXY),this.limit.set(n.x,n.y*e.rangeX,n.z*e.rangeXY),this.key.copy(this.keyBase)):(this.keyBase.set(1,1,1),this.limit.set(0,0,0),this.key.copy(this.keyBase),console.error("Invalid key range",t,n)),this.result.reset(),this}},{key:"next",value:function(){var e=this.result,t=this.keyDesign,n=this.keyBase,i=this.limit,a=this.key;return a.z<=i.z?(e.value=a.z+a.y+a.x,++a.x,a.x>i.x&&(a.x=n.x,a.y+=t.rangeX,a.y>i.y&&(a.y=n.y,a.z+=t.rangeXY))):(e.value=null,e.done=!0),e}},{key:"return",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),la=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:21,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:11,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t;Ge(this,e),this.x=0,this.y=0,this.z=0,this.rangeX=0,this.rangeY=0,this.rangeZ=0,this.rangeXY=0,this.halfRange=null,this.maskX=[0,0],this.maskY=[0,0],this.maskZ=[0,0],this.set(t,n,i)}return Ze(e,[{key:"set",value:function(e,t,n){(53<e+t+n||32<e||32<t||32<n)&&(console.warn("Invalid bit allotment"),e=21,t=11,n=e),this.x=e,this.y=t,this.z=n,this.rangeX=qe(2,e),this.rangeY=qe(2,t),this.rangeZ=qe(2,n),this.rangeXY=qe(2,e+t),this.halfRange=new Qt(this.rangeX/2,this.rangeY/2,this.rangeZ/2),this.updateBitMasks()}},{key:"updateBitMasks",value:function(){var e=this.x,t=this.y,n=this.z,i=this.maskX,a=this.maskY,r=this.maskZ,o=32-He(0,e-32),s=32-He(0,t+e-32),l=32-He(0,n+t+e-32);i[1]=32>o?-1>>>o:0,i[0]=-1>>>He(0,32-e),a[1]=((32>s?-1>>>s:0)&~i[1])>>>0,a[0]=(-1>>>He(0,32-(e+t))&~i[0])>>>0,r[1]=((32>l?-1>>>l:0)&~a[1]&~i[1])>>>0,r[0]=(-1>>>He(0,32-(e+t+n))&~a[0]&~i[0])>>>0}},{key:"unpackKey",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Qt,n=this.maskX,i=this.maskY,a=this.maskZ,r=Ie(e/4294967296),o=e%4294967296;return t.set(4294967296*(r&n[1])+((o&n[0])>>>0),(4294967296*(r&i[1])+((o&i[0])>>>0))/this.rangeX,(4294967296*(r&a[1])+((o&a[0])>>>0))/this.rangeXY)}},{key:"packKey",value:function(e){return e.z*this.rangeXY+e.y*this.rangeX+e.x}},{key:"keyRange",value:function(e,t){return new sa(this,e,t)}},{key:"toString",value:function(){var e=this.maskX,t=this.maskY,n=this.maskZ;return"Key Design\n\nX-Bits: "+this.x+"\nY-Bits: "+this.y+"\nZ-Bits: "+this.z+"\n\n"+oa.createBinaryString(e[1],32)+" "+e[1]+" (HI-Mask X)\n"+oa.createBinaryString(e[0],32)+" "+e[0]+" (LO-Mask X)\n\n"+oa.createBinaryString(t[1],32)+" "+t[1]+" (HI-Mask Y)\n"+oa.createBinaryString(t[0],32)+" "+t[0]+" (LO-Mask Y)\n\n"+oa.createBinaryString(n[1],32)+" "+n[1]+" (HI-Mask Z)\n"+oa.createBinaryString(n[0],32)+" "+n[0]+" (LO-Mask Z)\n"}}],[{key:"BITS",get:function(){return 53}},{key:"HI_BITS",get:function(){return 21}},{key:"LO_BITS",get:function(){return 32}}]),e}(),ua=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;Ge(this,e),this.lod=t,this.key=n}return Ze(e,[{key:"set",value:function(e,t){this.lod=e,this.key=t}},{key:"copy",value:function(e){return this.lod=e.lod,this.key=e.key,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),da=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new ua;Ge(this,e),this.octant=t,this.id=n,this.min=new Qt,this.max=new Qt}return Ze(e,[{key:"copy",value:function(e){return this.octant=e.octant,this.id.copy(e.id),this.min.copy(e.min),this.max.copy(e.max),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt;return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Qt;return e.subVectors(this.max,this.min)}},{key:"containsPoint",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=n.x&&e.y<=n.y&&e.z<=n.z}}]),e}(),ca=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;Ge(this,e),this.world=t,this.cellSize=0,this.iterator=null,this.octantWrapper=new da,this.octantWrapper.id.lod=n,this.result=new di,this.reset()}return Ze(e,[{key:"reset",value:function(){var e=this.octantWrapper.id.lod,t=this.world,n=t.getGrid(e);return void 0===n?console.error("Invalid LOD",e):(this.cellSize=t.getCellSize(e),this.iterator=n.entries(),this.result.reset()),this}},{key:"next",value:function(){var e=this.result,t=this.octantWrapper,n=this.iterator.next(),i=n.value;return n.done?(e.value=null,e.done=!0):(this.keyDesign.unpackKey(i[0],t.min),t.min.multiplyScalar(this.cellSize).add(this.world.min),t.max.copy(t.min).addScalar(this.cellSize),t.id.key=i[0],t.octant=i[1],e.value=t),e}},{key:"return",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),ya=function e(){Ge(this,e),this.data=null,this.csg=new ni,this.isosurface=null},ha=function(e){function t(){Ge(this,t);var e=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.children=0,e}return We(t,e),t}(ya),ma=new Qt,pa=new Qt,ga=new v,va=new v,fa=new v,xa=[],ka=function(){function e(){Ge(this,e)}return Ze(e,null,[{key:"applyUnion",value:function(e,t,n){var r=e.getKeyDesign(),o=e.lodZero,s=va.min,a=va.max,l=fa.min,u=fa.max,d=void 0,c=void 0,y=void 0,h=void 0,m=void 0,p=void 0;for(m=e.getDepth();0<m;--m){y=e.getGrid(m),e.calculateKeyCoordinates(t.min,m,s),e.calculateKeyCoordinates(t.max,m,a),e.calculateKeyCoordinates(t.min,m-1,l),e.calculateKeyCoordinates(t.max,m-1,u);var g=!0,v=!1,f=void 0;try{for(var x=r.keyRange(s,a)[Symbol.iterator](),k;!(g=(k=x.next()).done);g=!0)if(d=k.value,!y.has(d))for(h=new ha,h.csg.add(n),y.set(d,h),r.unpackKey(d,pa),pa.x<<=1,pa.y<<=1,pa.z<<=1,p=0;8>p;++p)c=hi[p],ma.set(pa.x+c[0],pa.y+c[1],pa.z+c[2]),fa.containsPoint(ma)&&(h.children|=1<<p)}catch(e){v=!0,f=e}finally{try{!g&&x.return&&x.return()}finally{if(v)throw f}}}e.calculateKeyCoordinates(t.min,0,s),e.calculateKeyCoordinates(t.max,0,a);var _=!0,z=!1,b=void 0;try{for(var w=r.keyRange(s,a)[Symbol.iterator](),S;!(_=(S=w.next()).done);_=!0)d=S.value,o.has(d)?h=o.get(d):(h=new ya,o.set(d,h)),h.csg.add(n)}catch(e){z=!0,b=e}finally{try{!_&&w.return&&w.return()}finally{if(z)throw b}}}},{key:"applyDifference",value:function(e,t,n){var r=e.getDepth(),o=e.getKeyDesign(),s=e.getGrid(r),u=e.calculateKeyCoordinates(t.min,r,va.min),a=e.calculateKeyCoordinates(t.max,r,va.max),d=void 0,c=void 0,y=void 0,h=void 0;for(d=0,c=r-1;d<c;++d)d<xa.length?(y=xa[d],e.calculateKeyCoordinates(t.min,d,y.min),e.calculateKeyCoordinates(t.max,d,y.max)):xa.push(new v(e.calculateKeyCoordinates(t.min,d),e.calculateKeyCoordinates(t.max,d)));var m=!0,p=!1,g=void 0;try{for(var f=o.keyRange(u,a)[Symbol.iterator](),x;!(m=(x=f.next()).done);m=!0)h=x.value,s.has(h)&&(o.unpackKey(h,pa),te(e,n,s.get(h),pa.x,pa.y,pa.z,r))}catch(e){p=!0,g=e}finally{try{!m&&f.return&&f.return()}finally{if(p)throw g}}}},{key:"applyIntersection",value:function(e,t){var n,i;for(n=e.getDepth();0<=n;--n){var a=!0,r=!1,o=void 0;try{for(var s=e.getGrid(n).values()[Symbol.iterator](),l;!(a=(l=s.next()).done);a=!0)i=l.value,i.csg.add(t)}catch(e){r=!0,o=e}finally{try{!a&&s.return&&s.return()}finally{if(r)throw o}}}}},{key:"applyCSG",value:function(e,t){var n=ga.copy(t.getBoundingBox(!0));switch(n.min.max(e.min),n.max.min(e.max),t.operation){case ii.UNION:this.applyUnion(e,n,t);break;case ii.DIFFERENCE:this.applyDifference(e,n,t);break;case ii.INTERSECTION:this.applyIntersection(e,t);break;default:console.error("No CSG operation type specified",t);}}}]),e}(),_a=new Qt,za=new vn,l=new v,ba=new v,d=new zn,wa=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],Sa=0,Ea=function(){function e(){Ge(this,e)}return Ze(e,null,[{key:"intersectWorldOctree",value:function(e,i){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],o=e.getDepth(),s=e.getGrid(o),l=e.getCellSize(o),u=e.getKeyDesign(),c=new da,y=za.start,h=za.end,m=e.containsPoint(d.copy(i).origin)?d.origin:d.intersectBox(e,d.origin),a=void 0,p=void 0,g=void 0,v=void 0,f=void 0,x=void 0,k=void 0,_=void 0,z=void 0,w=void 0,S=void 0,E=void 0,A=void 0,P=void 0,C=void 0,T=void 0,O=void 0,I=void 0,D=void 0,L=void 0;if(c.id.lod=o,null!==m)for(g=l<<1,v=d.at(g,_a),e.calculateKeyCoordinates(m,o,y),e.calculateKeyCoordinates(v,o,h),x=h.x-y.x,k=h.y-y.y,_=h.z-y.z,C=De(x),T=De(k),O=De(_),z=Ue(x),w=Ue(k),S=Ue(_),E=2*z,A=2*w,P=2*S,I=w-z,D=S-z,L=w-S,f=z+w+S;0<f;--f)a=u.packKey(y),s.has(a)&&(p=s.get(a),c.id.key=a,c.octant=p,c.min.copy(y),c.min.multiplyScalar(l),c.min.add(e.min),c.max.copy(c.min).addScalar(l),null===p.isosurface?re(e,c,y,i,r):r.push(c.clone())),0>I?0>D?(y.x+=C,I+=A,D+=P):(y.z+=O,D-=E,L+=A):0>L?(y.z+=O,D-=E,L+=A):(y.y+=T,I-=E,L-=P);return r}}]),e}(),Aa=new Qt,Pa=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:20,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new la;for(Ge(this,e),n=He(Ye(Ie(n),32),1),this.cellSize=He(Ye(Ie(t),qe(2,33-n)-1),1),this.keyDesign=i,this.grids=[];this.grids.length<n;)this.grids.push(new Map);this.bounds=new da,this.bounds.min.copy(this.keyDesign.halfRange).multiplyScalar(-this.cellSize),this.bounds.max.copy(this.keyDesign.halfRange).multiplyScalar(this.cellSize)}return Ze(e,[{key:"getKeyDesign",value:function(){return this.keyDesign}},{key:"getCellSize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return this.cellSize<<e>>>0}},{key:"getCenter",value:function(e){return this.bounds.getCenter(e)}},{key:"setCenter",value:function(e){this.min.copy(this.keyDesign.halfRange).multiplyScalar(-this.cellSize).add(e),this.max.copy(this.keyDesign.halfRange).multiplyScalar(this.cellSize).add(e)}},{key:"getDimensions",value:function(e){return this.bounds.getDimensions(e)}},{key:"getDepth",value:function(){return this.grids.length-1}},{key:"getGrid",value:function(e){return 0<=e&&e<this.grids.length?this.grids[e]:void 0}},{key:"clear",value:function(){var e,t;for(e=0,t=this.grids.length;e<t;++e)this.grids[e].clear()}},{key:"containsPoint",value:function(e){return this.bounds.containsPoint(e)}},{key:"findOctantsByLevel",value:function(e){return this.octants(e)}},{key:"calculateKeyCoordinates",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Qt,i=this.cellSize<<t;return Aa.subVectors(e,this.min),n.set(Ie(Aa.x/i),Ie(Aa.y/i),Ie(Aa.z/i)),n}},{key:"getOctantByPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.keyDesign,i=this.getGrid(t),a=void 0;return void 0===i?console.error("Invalid LOD",t):this.containsPoint(e)?(this.calculateKeyCoordinates(e,t,Aa),a=i.get(n.packKey(Aa))):console.error("Position out of range",e),a}},{key:"removeOctant",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.keyDesign,i=this.getGrid(t),a=void 0,r=void 0,o=void 0;void 0===i?console.error("Invalid LOD",t):i.has(e)?(n.unpackKey(e,Aa),a=Aa.x,r=Aa.y,o=Aa.z,oe(this,i.get(e),a,r,o,t),i.delete(e),se(this,a,r,o,t)):console.error("No octant found",e)}},{key:"applyCSG",value:function(e){ka.applyCSG(this,e)}},{key:"raycast",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return Ea.intersectWorldOctree(this,e,t)}},{key:"octants",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return new ca(this,e)}},{key:"min",get:function(){return this.bounds.min}},{key:"max",get:function(){return this.bounds.max}},{key:"levels",get:function(){return this.grids.length}},{key:"lodZero",get:function(){return this.grids[0]}}],[{key:"calculateOffsetIndex",value:function(e,t,n){return((1&e)<<2)+((1&t)<<1)+(1&n)}}]),e}(),Ca=function(){function e(){Ge(this,e)}return Ze(e,[{key:"clone",value:function(){return new this.constructor(this.levels)}},{key:"levels",get:function(){return this.something.length}}]),e}(),Ta=function(e){function t(e){Ge(this,t);var n=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.lod=-1,n.left=null,n.entered=null,n.error=null,n}return We(t,e),t}(tt),Oa=new Ta("update"),Ia=new Ta("error"),Da=new v,La=new mn,f=new c,Ba=function(e){function t(e){Ge(this,t);var n=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.world=e,n.position=new Qt(1/0,1/0,1/0),n.currentScene=new Ca(n.world.levels),n.previousScene=n.currentScene.clone(),n.nextScene=n.currentScene.clone(),n}return We(t,e),Ze(t,[{key:"update",value:function(e){var t=this.position;t.copy(e.position),La.setFromMatrix(f.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse))}},{key:"process",value:function(){}},{key:"clear",value:function(){this.previousScene.clear(),this.currentScene.clear(),this.nextScene.clear()}}]),t}(nt),Fa={EXTRACT:"worker.extract",MODIFY:"worker.modify",CONFIGURE:"worker.config",CLOSE:"worker.close"},Ra=function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null;Ge(this,e),this.action=t,this.error=null},Ma=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;Ge(this,t);var n=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.data=null,n}return We(t,e),t}(Ra),Va=function(e){function t(){return Ge(this,t),Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Fa.EXTRACT))}return We(t,e),t}(Ma),Na=function(e){function t(){Ge(this,t);var e=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Fa.MODIFY));return e.sdf=null,e.cellSize=0,e.cellPosition=null,e}return We(t,e),t}(Ma),qa=function(e){function t(){Ge(this,t);var e=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Fa.CONFIGURE));return e.resolution=ji.resolution,e.errorThreshold=.01,e}return We(t,e),t}(Ra),Ua=function(e){function t(){Ge(this,t);var e=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Fa.EXTRACT));return e.isosurface=null,e}return We(t,e),t}(Ma),Ha=function(e){function t(){Ge(this,t);var e=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Fa.MODIFY));return e.sdf=null,e}return We(t,e),t}(Ma),Ya=function(e){function t(e){Ge(this,t);var n=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.worker=null,n.response=null,n}return We(t,e),t}(tt),Xa=new Ya("message"),ja=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:navigator.hardwareConcurrency;Ge(this,t);var n=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.workerURL=URL.createObjectURL(new Blob(["(function(){\"use strict\";function e(e,t,n){return ne(te(e,n),t)}function t(e,t,n,a,i,l){var o=0;return e>t&&e>n?(i<e&&(o|=2),l<e&&(o|=1)):t>n?(a<t&&(o|=4),l<t&&(o|=1)):(a<n&&(o|=4),i<n&&(o|=2)),o}function n(e,t,n,a){var i=void 0,l=0;return t<n?(i=t,l=0):(i=n,l=1),a<i&&(l=2),r[e][l]}function i(e,a,l,o,r,s,y,d,u){var c=e.children,m=void 0,x=void 0,p=void 0,v=void 0;if(0<=r&&0<=s&&0<=y)if(null===c)u.push(e);else{x=.5*(a+r),p=.5*(l+s),v=.5*(o+y),m=t(a,l,o,x,p,v);do 0===m?(i(c[et],a,l,o,x,p,v,d,u),m=n(m,x,p,v)):1===m?(i(c[1^et],a,l,v,x,p,y,d,u),m=n(m,x,p,y)):2===m?(i(c[2^et],a,p,o,x,s,v,d,u),m=n(m,x,s,v)):3===m?(i(c[3^et],a,p,v,x,s,y,d,u),m=n(m,x,s,y)):4===m?(i(c[4^et],x,l,o,r,p,v,d,u),m=n(m,r,p,v)):5===m?(i(c[5^et],x,l,v,r,p,y,d,u),m=n(m,r,p,y)):6===m?(i(c[6^et],x,p,o,r,s,v,d,u),m=n(m,r,s,v)):7===m?(i(c[7^et],x,p,v,r,s,y,d,u),m=8):void 0;while(8>m)}}function o(e){var t=e.children,n=0,a=void 0,r=void 0,s=void 0;if(null!==t)for(a=0,r=t.length;a<r;++a)s=1+o(t[a]),s>n&&(n=s);return n}function s(e,t,n){var a=e.children,o=void 0,r=void 0;if(nt.min=e.min,nt.max=e.max,t.intersectsBox(nt))if(null!==a)for(o=0,r=a.length;o<r;++o)s(a[o],t,n);else n.push(e)}function y(e,t,n,a){var o=e.children,r=void 0,s=void 0;if(n===t)a.push(e);else if(null!==o)for(++n,r=0,s=o.length;r<s;++r)y(o[r],t,n,a)}function d(e){var t=e.children,n=0,a=void 0,o=void 0;if(null!==t)for(a=0,o=t.length;a<o;++a)n+=d(t[a]);else null!==e.points&&(n=e.points.length);return n}function x(e,t,n,a,o){var r=a.children,s=!1,y=!1,d=void 0,u=void 0;if(a.contains(e,n.bias)){if(null===r){if(null===a.points)a.points=[],a.data=[];else for(d=0,u=a.points.length;!s&&d<u;++d)s=a.points[d].equals(e);s?(a.data[d-1]=t,y=!0):a.points.length<n.maxPoints||o===n.maxDepth?(a.points.push(e.clone()),a.data.push(t),++n.pointCount,y=!0):(a.split(),a.redistribute(n.bias),r=a.children)}if(null!==r)for(++o,d=0,u=r.length;!y&&d<u;++d)y=x(e,t,n,r[d],o)}return y}function g(e,t,n,a){var o=n.children,r=null,s=void 0,y=void 0,u=void 0,c=void 0,m=void 0;if(n.contains(e,t.bias))if(null!==o)for(s=0,y=o.length;null===r&&s<y;++s)r=g(e,t,o[s],n);else if(null!==n.points)for(u=n.points,c=n.data,(s=0,y=u.length);s<y;++s)if(u[s].equals(e)){m=y-1,r=c[s],s<m&&(u[s]=u[m],c[s]=c[m]),u.pop(),c.pop(),--t.pointCount,null!==a&&d(a)<=t.maxPoints&&a.merge();break}return r}function k(e,t,n){var a=n.children,o=null,r=void 0,s=void 0,y=void 0;if(n.contains(e,t.bias))if(null!==a)for(r=0,s=a.length;null===o&&r<s;++r)o=k(e,t,a[r]);else if(null!==n.points)for(y=n.points,r=0,s=y.length;null===o&&r<s;++r)e.distanceToSquared(y[r])<=ot&&(o=n.data[r]);return o}function h(e,t,n,a,o,r){var s=a.children,y=null,d=void 0,u=void 0,c=void 0;if(a.contains(e,n.bias))if(!a.contains(t,n.bias))y=g(e,n,a,o),x(t,y,n,o,r-1);else if(null!==s)for(++r,d=0,u=s.length;null===y&&d<u;++d)y=h(e,t,n,s[d],a,r);else if(null!==a.points)for(c=a.points,d=0,u=c.length;d<u;++d)if(e.distanceToSquared(c[d])<=ot){c[d].copy(t),y=a.data[d];break}return y}function z(e,t,n,a){var o=a.points,r=a.children,s=null,y=t,d=void 0,u=void 0,c=void 0,m=void 0,x=void 0,v=void 0,g=void 0;if(null!==r)for(x=r.map(function(t){return{octant:t,distance:t.distanceToCenterSquared(e)}}).sort(function(e,t){return e.distance-t.distance}),d=0,u=x.length;d<u;++d)v=x[d].octant,v.contains(e,y)&&(g=z(e,y,n,v),null!==g&&(m=g.point.distanceToSquared(e),(!n||0<m)&&m<y&&(y=m,s=g)));else if(null!==o)for(d=0,u=o.length;d<u;++d)c=o[d],m=e.distanceToSquared(c),(!n||0<m)&&m<y&&(y=m,s={point:c.clone(),data:a.data[d]});return s}function f(e,t,n,a,o){var r=a.points,s=a.children,y=void 0,d=void 0,u=void 0,c=void 0,m=void 0;if(null!==s)for(y=0,d=s.length;y<d;++y)m=s[y],m.contains(e,t)&&f(e,t,n,m,o);else if(null!==r)for(y=0,d=r.length;y<d;++y)u=r[y],c=e.distanceToSquared(u),(!n||0<c)&&c<=t*t&&o.push({point:u.clone(),data:a.data[y]})}function l(e,t){var n=e.elements,a=t.elements,i=void 0;0!==n[1]&&(i=Ct.calculateCoefficients(n[0],n[1],n[3]),bt.rotateQXY(qt.set(n[0],n[3]),n[1],i),n[0]=qt.x,n[3]=qt.y,bt.rotateXY(qt.set(n[2],n[4]),i),n[2]=qt.x,n[4]=qt.y,n[1]=0,bt.rotateXY(qt.set(a[0],a[3]),i),a[0]=qt.x,a[3]=qt.y,bt.rotateXY(qt.set(a[1],a[4]),i),a[1]=qt.x,a[4]=qt.y,bt.rotateXY(qt.set(a[2],a[5]),i),a[2]=qt.x,a[5]=qt.y)}function S(e,t){var n=e.elements,a=t.elements,i=void 0;0!==n[2]&&(i=Ct.calculateCoefficients(n[0],n[2],n[5]),bt.rotateQXY(qt.set(n[0],n[5]),n[2],i),n[0]=qt.x,n[5]=qt.y,bt.rotateXY(qt.set(n[1],n[4]),i),n[1]=qt.x,n[4]=qt.y,n[2]=0,bt.rotateXY(qt.set(a[0],a[6]),i),a[0]=qt.x,a[6]=qt.y,bt.rotateXY(qt.set(a[1],a[7]),i),a[1]=qt.x,a[7]=qt.y,bt.rotateXY(qt.set(a[2],a[8]),i),a[2]=qt.x,a[8]=qt.y)}function T(e,t){var n=e.elements,a=t.elements,i=void 0;0!==n[4]&&(i=Ct.calculateCoefficients(n[3],n[4],n[5]),bt.rotateQXY(qt.set(n[3],n[5]),n[4],i),n[3]=qt.x,n[5]=qt.y,bt.rotateXY(qt.set(n[1],n[2]),i),n[1]=qt.x,n[2]=qt.y,n[4]=0,bt.rotateXY(qt.set(a[3],a[6]),i),a[3]=qt.x,a[6]=qt.y,bt.rotateXY(qt.set(a[4],a[7]),i),a[4]=qt.x,a[7]=qt.y,bt.rotateXY(qt.set(a[5],a[8]),i),a[5]=qt.x,a[8]=qt.y)}function w(t,n){var a=t.elements,e=void 0;for(e=0;e<5;++e)l(t,n),S(t,n),T(t,n);return At.set(a[0],a[3],a[5])}function P(e){var t=$(e)<Et?0:1/e;return $(t)<Et?0:t}function I(e,t){var n=e.elements,a=n[0],i=n[3],l=n[6],o=n[1],r=n[4],s=n[7],y=n[2],d=n[5],u=n[8],c=P(t.x),m=P(t.y),x=P(t.z);return e.set(a*c*a+i*m*i+l*x*l,a*c*o+i*m*r+l*x*s,a*c*y+i*m*d+l*x*u,o*c*a+r*m*i+s*x*l,o*c*o+r*m*r+s*x*s,o*c*y+r*m*d+s*x*u,y*c*a+d*m*i+u*x*l,y*c*o+d*m*r+u*x*s,y*c*y+d*m*d+u*x*u)}function _(e,t,n){return e.applyToVector3(Ft.copy(n)),Ft.subVectors(t,Ft),Ft.dot(Ft)}function C(e,t,n){var a=[-1,-1,-1,-1],l=[!1,!1,!1,!1],o=1/0,r=0,s=!1,y=void 0,d=void 0,u=void 0,c=void 0,m=void 0,x=void 0,p=void 0;for(p=0;4>p;++p)m=e[p],x=Jt[t][p],y=Ue[x][0],d=Ue[x][1],u=1&m.voxel.materials>>y,c=1&m.voxel.materials>>d,m.size<o&&(o=m.size,r=p,s=u!==ft.AIR),a[p]=m.voxel.index,l[p]=u!=c;l[r]&&(s?(n.push(a[0]),n.push(a[3]),n.push(a[1]),n.push(a[0]),n.push(a[2]),n.push(a[3])):(n.push(a[0]),n.push(a[1]),n.push(a[3]),n.push(a[0]),n.push(a[3]),n.push(a[2])))}function E(e,t,n){var a=[0,0,0,0],l=void 0,o=void 0,r=void 0,s=void 0;if(null!==e[0].voxel&&null!==e[1].voxel&&null!==e[2].voxel&&null!==e[3].voxel)C(e,t,n);else for(r=0;2>r;++r){for(a[0]=Ht[t][r][0],a[1]=Ht[t][r][1],a[2]=Ht[t][r][2],a[3]=Ht[t][r][3],l=[],s=0;4>s;++s)if(o=e[s],null!==o.voxel)l[s]=o;else if(null!==o.children)l[s]=o.children[a[s]];else break;4===s&&E(l,Ht[t][r][4],n)}}function O(e,t,n){var a=[0,0,0,0],l=[[0,0,1,1],[0,1,0,1]],o=void 0,r=void 0,s=void 0,y=void 0,d=void 0,u=void 0;if(null!==e[0].children||null!==e[1].children){for(d=0;4>d;++d)a[0]=Qt[t][d][0],a[1]=Qt[t][d][1],o=[null===e[0].children?e[0]:e[0].children[a[0]],null===e[1].children?e[1]:e[1].children[a[1]]],O(o,Qt[t][d][2],n);for(d=0;4>d;++d){for(a[0]=Gt[t][d][1],a[1]=Gt[t][d][2],a[2]=Gt[t][d][3],a[3]=Gt[t][d][4],s=l[Gt[t][d][0]],r=[],u=0;4>u;++u)if(y=e[s[u]],null!==y.voxel)r[u]=y;else if(null!==y.children)r[u]=y.children[a[u]];else break;4===u&&E(r,Gt[t][d][5],n)}}}function D(e,t){var n=e.children,a=[0,0,0,0],l=void 0,o=void 0,r=void 0;if(null!==n){for(r=0;8>r;++r)D(n[r],t);for(r=0;12>r;++r)a[0]=jt[r][0],a[1]=jt[r][1],l=[n[a[0]],n[a[1]]],O(l,jt[r][2],t);for(r=0;6>r;++r)a[0]=Ut[r][0],a[1]=Ut[r][1],a[2]=Ut[r][2],a[3]=Ut[r][3],o=[n[a[0]],n[a[1]],n[a[2]],n[a[3]]],E(o,Ut[r][4],t)}}function A(e,t,n,a){var l,o;if(null!==e.children)for(l=0;8>l;++l)a=A(e.children[l],t,n,a);else null!==e.voxel&&(o=e.voxel,o.index=a,t[3*a]=o.position.x,t[3*a+1]=o.position.y,t[3*a+2]=o.position.z,n[3*a]=o.normal.x,n[3*a+1]=o.normal.y,n[3*a+2]=o.normal.z,++a);return a}function V(e,t,a,l,o){var r=0;for(t>>=1;0<t;t>>=1,r=0)a>=t&&(r+=4,a-=t),l>=t&&(r+=2,l-=t),o>=t&&(r+=1,o-=t),null===e.children&&e.split(),e=e.children[r];return e}function F(e,t,n,a,l){var o=e+1,r=new Nt,s=void 0,y=void 0,d=void 0,u=void 0,c=void 0,m=void 0,x=void 0,p=void 0,v=void 0,g=void 0;for(s=0,g=0;8>g;++g)u=je[g],c=(a+u[2])*(o*o)+(n+u[1])*o+(t+u[0]),d=te(l[c],ft.SOLID),s|=d<<g;for(y=0,g=0;12>g;++g)m=Ue[g][0],x=Ue[g][1],p=1&s>>m,v=1&s>>x,p!=v&&++y;return r.materials=s,r.edgeCount=y,r.qefData=new It,r}function B(e){var t=un,a=Pt.resolution,n=new xe(0,0,0),i=new xe(a,a,a),l=new v(cn,cn.clone().addScalar(un)),o=e.getBoundingBox();return e.type!==on.INTERSECTION&&(o.intersectsBox(l)?(n.copy(o.min).max(l.min).sub(l.min),n.x=K(n.x*a/t),n.y=K(n.y*a/t),n.z=K(n.z*a/t),i.copy(o.max).min(l.max).sub(l.min),i.x=W(i.x*a/t),i.y=W(i.y*a/t),i.z=W(i.z*a/t)):(n.set(a,a,a),i.set(0,0,0))),new v(n,i)}function N(e,t,a,i){var l=Pt.resolution,n=l+1,o=i.max.x,r=i.max.y,s=i.max.z,d=void 0,u=void 0,c=void 0;for(c=i.min.z;c<=s;++c)for(u=i.min.y;u<=r;++u)for(d=i.min.x;d<=o;++d)e.updateMaterialIndex(c*(n*n)+u*n+d,t,a)}function L(e,t,a){var i=un,l=Pt.resolution,n=l+1,o=t.materialIndices,r=new xe,s=new xe,d=a.max.x,u=a.max.y,c=a.max.z,m=void 0,p=0,v=void 0,g=void 0,k=void 0;for(k=a.min.z;k<=c;++k)for(r.z=k*i/l,g=a.min.y;g<=u;++g)for(r.y=g*i/l,v=a.min.x;v<=d;++v)r.x=v*i/l,m=e.generateMaterialIndex(s.addVectors(cn,r)),m!==ft.AIR&&(o[k*(n*n)+g*n+v]=m,++p);t.materials=p}function R(e,t,a){var l=Pt.resolution,n=l+1,o=new Uint32Array([1,n,n*n]),r=t.materialIndices,s=new pt,y=new pt,u=a.edgeData,m=t.edgeData,x=new Uint32Array(3),p=zt.calculate1DEdgeCount(l),v=new zt(l,te(p,m.indices[0].length+u.indices[0].length),te(p,m.indices[1].length+u.indices[1].length),te(p,m.indices[2].length+u.indices[2].length)),g=void 0,k=void 0,h=void 0,z=void 0,f=void 0,S=void 0,T=void 0,w=void 0,P=void 0,I=void 0,_=void 0,C=void 0,b=void 0,E=void 0,O=void 0,D=void 0,q=void 0,A=void 0,V=void 0,F=void 0,B=void 0,N=void 0,L=void 0;for(A=0,V=0;3>V;A=0,++V){for(g=u.indices[V],z=m.indices[V],T=v.indices[V],k=u.zeroCrossings[V],f=m.zeroCrossings[V],w=v.zeroCrossings[V],h=u.normals[V],S=m.normals[V],P=v.normals[V],I=o[V],N=g.length,L=z.length,(F=0,B=0);F<N;++F)if(_=g[F],C=_+I,O=r[_],D=r[C],O!==D&&(O===ft.AIR||D===ft.AIR)){for(s.t=k[F],s.n.x=h[3*F],s.n.y=h[3*F+1],s.n.z=h[3*F+2],e.type===on.DIFFERENCE&&s.n.negate(),q=s;B<L&&z[B]<=_;)b=z[B],E=b+I,y.t=f[B],y.n.x=S[3*B],y.n.y=S[3*B+1],y.n.z=S[3*B+2],O=r[b],b<_?(D=r[E],O!==D&&(O===ft.AIR||D===ft.AIR)&&(T[A]=b,w[A]=y.t,P[3*A]=y.n.x,P[3*A+1]=y.n.y,P[3*A+2]=y.n.z,++A)):q=e.selectEdge(y,s,O===ft.SOLID),++B;T[A]=_,w[A]=q.t,P[3*A]=q.n.x,P[3*A+1]=q.n.y,P[3*A+2]=q.n.z,++A}for(;B<L;)b=z[B],E=b+I,O=r[b],D=r[E],O!==D&&(O===ft.AIR||D===ft.AIR)&&(T[A]=b,w[A]=f[B],P[3*A]=S[3*B],P[3*A+1]=S[3*B+1],P[3*A+2]=S[3*B+2],++A),++B;x[V]=A}return{edgeData:v,lengths:x}}function Y(e,t,i){var l=un,o=Pt.resolution,n=o+1,r=n*n,s=new Uint32Array([1,n,r]),u=t.materialIndices,m=cn,p=new xe,v=new xe,g=new pt,k=new Uint32Array(3),h=new zt(o,zt.calculate1DEdgeCount(o)),f=void 0,S=void 0,T=void 0,w=void 0,P=void 0,I=void 0,_=void 0,C=void 0,b=void 0,E=void 0,O=void 0,D=void 0,q=void 0,A=void 0,V=void 0,F=void 0,B=void 0,N=void 0,L=void 0;for(V=4,q=0,A=0;3>A;V>>=1,q=0,++A){F=je[V],f=h.indices[A],S=h.zeroCrossings[A],T=h.normals[A],w=s[A],_=i.min.x,E=i.max.x,C=i.min.y,O=i.max.y,b=i.min.z,D=i.max.z;for(0===A?(_=ne(_-1,0),E=te(E,o-1)):1===A?(C=ne(C-1,0),O=te(O,o-1)):2===A?(b=ne(b-1,0),D=te(D,o-1)):void 0,L=b;L<=D;++L)for(N=C;N<=O;++N)for(B=_;B<=E;++B)P=L*r+N*n+B,I=P+w,u[P]!==u[I]&&(p.set(B*l/o,N*l/o,L*l/o),v.set((B+F[0])*l/o,(N+F[1])*l/o,(L+F[2])*l/o),g.a.addVectors(m,p),g.b.addVectors(m,v),e.generateEdge(g),f[q]=P,S[q]=g.t,T[3*q]=g.n.x,T[3*q+1]=g.n.y,T[3*q+2]=g.n.z,++q);k[A]=q}return{edgeData:h,lengths:k}}function M(e,t,n){var a=B(e),i=void 0,l=void 0,o=void 0,r=void 0,s=!1;if(e.type===on.DENSITY_FUNCTION?L(e,t,a):t.empty?e.type===on.UNION&&(t.set(n),s=!0):!(t.full&&e.type===on.UNION)&&N(e,t,n,a),!s&&!t.empty&&!t.full){for(i=e.type===on.DENSITY_FUNCTION?Y(e,t,a):R(e,t,n),l=i.edgeData,o=i.lengths,r=0;3>r;++r)l.indices[r]=l.indices[r].slice(0,o[r]),l.zeroCrossings[r]=l.zeroCrossings[r].slice(0,o[r]),l.normals[r]=l.normals[r].slice(0,3*o[r]);t.edgeData=l}}function X(e){var t=e.children,n=void 0,a=void 0,o=void 0,r=void 0;for(e.type===on.DENSITY_FUNCTION&&(n=new Pt,M(e,n)),o=0,r=t.length;o<r&&(a=X(t[o]),void 0===n?n=a:null===a?e.type===on.INTERSECTION&&(n=null):null===n?e.type===on.UNION&&(n=a):M(e,n,a),null!==n||e.type===on.UNION);++o);return null!==n&&n.empty?null:n}function Z(e){var t=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\"),n=t.getContext(\"2d\");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height)}var j=Math.pow,U=Math.trunc,Q=Math.sign,G=Math.PI,H=Math.atan2,J=Math.round,K=Math.ceil,W=Math.floor,$=Math.abs,ee=Math.acos,te=Math.min,ne=Math.max,ae=Math.sqrt,ie=Math.cos,le=Math.sin,oe=function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")},re=function(){function e(e,t){for(var n,a=0;a<t.length;a++)n=t[a],n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),se=function e(t,n,a){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var l=Object.getPrototypeOf(t);return null===l?void 0:e(l,n,a)}if(\"value\"in i)return i.value;var o=i.get;return void 0===o?void 0:o.call(a)},ye=function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},de=function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return t&&(\"object\"==typeof t||\"function\"==typeof t)?t:e},ue=function e(t,n,a,i){var l=Object.getOwnPropertyDescriptor(t,n);if(void 0===l){var o=Object.getPrototypeOf(t);null!==o&&e(o,n,a,i)}else if(\"value\"in l&&l.writable)l.value=a;else{var r=l.set;void 0!==r&&r.call(i,a)}return a},ce=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},me=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;oe(this,e),this.runLengths=t,this.data=n}return re(e,null,[{key:\"encode\",value:function(t){var n=[],a=[],o=t[0],r=1,s=void 0,y=void 0;for(s=1,y=t.length;s<y;++s)o===t[s]?++r:(n.push(r),a.push(o),o=t[s],r=1);return n.push(r),a.push(o),new e(n,a)}},{key:\"decode\",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],a=void 0,l=void 0,o=void 0,r=void 0,s=void 0,y=0;for(l=0,r=t.length;l<r;++l)for(a=t[l],o=0,s=e[l];o<s;++o)n[y++]=a;return n}}]),e}(),xe=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;oe(this,e),this.x=t,this.y=n,this.z=a}return re(e,[{key:\"set\",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:\"setFromSpherical\",value:function(e){var t=le(e.phi)*e.radius;return this.x=t*le(e.theta),this.y=ie(e.phi)*e.radius,this.z=t*ie(e.theta),this}},{key:\"setFromCylindrical\",value:function(e){return this.x=e.radius*le(e.theta),this.y=e.y,this.z=e.radius*ie(e.theta),this}},{key:\"setFromMatrixColumn\",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:\"setFromMatrixPosition\",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:\"setFromMatrixScale\",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),a=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=a,this}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:\"addVectors\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:\"addScaledVector\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:\"subVectors\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:\"multiplyVectors\",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this}},{key:\"crossVectors\",value:function(e,t){var n=e.x,a=e.y,i=e.z,l=t.x,o=t.y,r=t.z;return this.x=a*r-i*o,this.y=i*l-n*r,this.z=n*o-a*l,this}},{key:\"cross\",value:function(e){return this.crossVectors(this,e)}},{key:\"transformDirection\",value:function(t){var n=this.x,a=this.y,i=this.z,l=t.elements;return this.x=l[0]*n+l[4]*a+l[8]*i,this.y=l[1]*n+l[5]*a+l[9]*i,this.z=l[2]*n+l[6]*a+l[10]*i,this.normalize()}},{key:\"applyMatrix3\",value:function(t){var n=this.x,a=this.y,i=this.z,l=t.elements;return this.x=l[0]*n+l[3]*a+l[6]*i,this.y=l[1]*n+l[4]*a+l[7]*i,this.z=l[2]*n+l[5]*a+l[8]*i,this}},{key:\"applyMatrix4\",value:function(t){var n=this.x,a=this.y,i=this.z,l=t.elements;return this.x=l[0]*n+l[4]*a+l[8]*i+l[12],this.y=l[1]*n+l[5]*a+l[9]*i+l[13],this.z=l[2]*n+l[6]*a+l[10]*i+l[14],this}},{key:\"applyQuaternion\",value:function(e){var t=this.x,n=this.y,a=this.z,i=e.x,l=e.y,o=e.z,r=e.w,s=r*t+l*a-o*n,y=r*n+o*t-i*a,d=r*a+i*n-l*t,u=-i*t-l*n-o*a;return this.x=s*r+u*-i+y*-o-d*-l,this.y=y*r+u*-l+d*-i-s*-o,this.z=d*r+u*-o+s*-l-y*-i,this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:\"reflect\",value:function(e){var t=e.x,n=e.y,a=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(t,n,a),this}},{key:\"angleTo\",value:function(e){var t=this.dot(e)/ae(this.lengthSquared()*e.lengthSquared());return ee(te(ne(t,-1),1))}},{key:\"manhattanLength\",value:function(){return $(this.x)+$(this.y)+$(this.z)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:\"length\",value:function(){return ae(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:\"manhattanDistanceTo\",value:function(e){return $(this.x-e.x)+$(this.y-e.y)+$(this.z-e.z)}},{key:\"distanceToSquared\",value:function(e){var t=this.x-e.x,n=this.y-e.y,a=this.z-e.z;return t*t+n*n+a*a}},{key:\"distanceTo\",value:function(e){return ae(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=te(this.x,e.x),this.y=te(this.y,e.y),this.z=te(this.z,e.z),this}},{key:\"max\",value:function(e){return this.x=ne(this.x,e.x),this.y=ne(this.y,e.y),this.z=ne(this.z,e.z),this}},{key:\"clamp\",value:function(e,t){return this.x=ne(e.x,te(t.x,this.x)),this.y=ne(e.y,te(t.y,this.y)),this.z=ne(e.z,te(t.z,this.z)),this}},{key:\"floor\",value:function(){return this.x=W(this.x),this.y=W(this.y),this.z=W(this.z),this}},{key:\"ceil\",value:function(){return this.x=K(this.x),this.y=K(this.y),this.z=K(this.z),this}},{key:\"round\",value:function(){return this.x=J(this.x),this.y=J(this.y),this.z=J(this.z),this}},{key:\"lerp\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:\"lerpVectors\",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}]),e}(),pe=new xe,v=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe(1/0,1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe(-Infinity,-Infinity,-Infinity);oe(this,e),this.min=t,this.max=n}return re(e,[{key:\"set\",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:\"copy\",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"makeEmpty\",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-Infinity,this}},{key:\"isEmpty\",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getSize\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:\"setFromSphere\",value:function(e){return this.set(e.center,e.center),this.expandByScalar(e.radius),this}},{key:\"expandByPoint\",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:\"expandByVector\",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:\"expandByScalar\",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:\"setFromPoints\",value:function(e){var t,n;for(this.min.set(0,0,0),this.max.set(0,0,0),(t=0,n=e.length);t<n;++t)this.expandByPoint(e[t]);return this}},{key:\"setFromCenterAndSize\",value:function(e,t){var n=pe.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:\"clampPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe;return t.copy(e).clamp(this.min,this.max)}},{key:\"distanceToPoint\",value:function(e){var t=pe.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:\"applyMatrix4\",value:function(e){var t=this.min,n=this.max;if(!this.isEmpty()){var a=e.elements,i=a[0]*t.x,l=a[1]*t.x,o=a[2]*t.x,r=a[0]*n.x,s=a[1]*n.x,y=a[2]*n.x,d=a[4]*t.y,u=a[5]*t.y,c=a[6]*t.y,m=a[4]*n.y,x=a[5]*n.y,p=a[6]*n.y,v=a[8]*t.z,g=a[9]*t.z,k=a[10]*t.z,h=a[8]*n.z,z=a[9]*n.z,f=a[10]*n.z;t.x=te(i,r)+te(d,m)+te(v,h)+a[12],t.y=te(l,s)+te(u,x)+te(g,z)+a[13],t.z=te(o,y)+te(c,p)+te(k,f)+a[14],n.x=ne(i,r)+ne(d,m)+ne(v,h)+a[12],n.y=ne(l,s)+ne(u,x)+ne(g,z)+a[13],n.z=ne(o,y)+ne(c,p)+ne(k,f)+a[14]}return this}},{key:\"translate\",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:\"intersect\",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:\"union\",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:\"containsPoint\",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=n.x&&e.y<=n.y&&e.z<=n.z}},{key:\"containsBox\",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return t.x<=a.x&&i.x<=n.x&&t.y<=a.y&&i.y<=n.y&&t.z<=a.z&&i.z<=n.z}},{key:\"intersectsBox\",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&i.z>=t.z&&a.x<=n.x&&a.y<=n.y&&a.z<=n.z}},{key:\"intersectsSphere\",value:function(e){var t=this.clampPoint(e.center,pe);return t.distanceToSquared(e.center)<=e.radius*e.radius}},{key:\"intersectsPlane\",value:function(e){var t,n;return 0<e.normal.x?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=e.constant&&n>=e.constant}},{key:\"equals\",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),ve=new v,ge=new xe,ke=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;oe(this,e),this.center=t,this.radius=n}return re(e,[{key:\"set\",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:\"copy\",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromPoints\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:ve.setFromPoints(e).getCenter(this.center),n=0,a=void 0,o=void 0;for(a=0,o=e.length;a<o;++a)n=ne(n,t.distanceToSquared(e[a]));return this.radius=ae(n),this}},{key:\"setFromBox\",value:function(e){return e.getCenter(this.center),this.radius=.5*e.getSize(ge).length(),this}},{key:\"isEmpty\",value:function(){return 0>=this.radius}},{key:\"translate\",value:function(e){return this.center.add(e),this}},{key:\"clampPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe,n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:\"distanceToPoint\",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:\"containsPoint\",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:\"intersectsSphere\",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:\"intersectsBox\",value:function(e){return e.intersectsSphere(this)}},{key:\"intersectsPlane\",value:function(e){return $(e.distanceToPoint(this.center))<=this.radius}},{key:\"equals\",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}]),e}(),he=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;oe(this,e),this.x=t,this.y=n}return re(e,[{key:\"set\",value:function(e,t){return this.x=e,this.y=t,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this}},{key:\"addVectors\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:\"addScaledVector\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this}},{key:\"subVectors\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this}},{key:\"applyMatrix3\",value:function(t){var n=this.x,a=this.y,i=t.elements;return this.x=i[0]*n+i[3]*a+i[6],this.y=i[1]*n+i[4]*a+i[7],this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y}},{key:\"manhattanLength\",value:function(){return $(this.x)+$(this.y)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y}},{key:\"length\",value:function(){return ae(this.x*this.x+this.y*this.y)}},{key:\"manhattanDistanceTo\",value:function(e){return $(this.x-e.x)+$(this.y-e.y)}},{key:\"distanceToSquared\",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:\"distanceTo\",value:function(e){return ae(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=te(this.x,e.x),this.y=te(this.y,e.y),this}},{key:\"max\",value:function(e){return this.x=ne(this.x,e.x),this.y=ne(this.y,e.y),this}},{key:\"clamp\",value:function(e,t){return this.x=ne(e.x,te(t.x,this.x)),this.y=ne(e.y,te(t.y,this.y)),this}},{key:\"floor\",value:function(){return this.x=W(this.x),this.y=W(this.y),this}},{key:\"ceil\",value:function(){return this.x=K(this.x),this.y=K(this.y),this}},{key:\"round\",value:function(){return this.x=J(this.x),this.y=J(this.y),this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:\"angle\",value:function(){var e=H(this.y,this.x);return 0>e&&(e+=2*G),e}},{key:\"lerp\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:\"lerpVectors\",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:\"rotateAround\",value:function(e,t){var n=ie(t),a=le(t),i=this.x-e.x,l=this.y-e.y;return this.x=i*n-l*a+e.x,this.y=i*a+l*n+e.y,this}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y}},{key:\"width\",get:function(){return this.x},set:function(e){return this.x=e}},{key:\"height\",get:function(){return this.y},set:function(e){return this.y=e}}]),e}(),ze=new he,fe=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new he(1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new he(-Infinity,-Infinity);oe(this,e),this.min=t,this.max=n}return re(e,[{key:\"set\",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:\"copy\",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"makeEmpty\",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-Infinity,this}},{key:\"isEmpty\",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new he;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getSize\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new he;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:\"getBoundingSphere\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new ke;return this.getCenter(e.center),e.radius=.5*this.getSize(ze).length(),e}},{key:\"expandByPoint\",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:\"expandByVector\",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:\"expandByScalar\",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:\"setFromPoints\",value:function(e){var t,n;for(this.min.set(0,0),this.max.set(0,0),(t=0,n=e.length);t<n;++t)this.expandByPoint(e[t]);return this}},{key:\"setFromCenterAndSize\",value:function(e,t){var n=ze.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:\"clampPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new he;return t.copy(e).clamp(this.min,this.max)}},{key:\"distanceToPoint\",value:function(e){var t=ze.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:\"translate\",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:\"intersect\",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:\"union\",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:\"containsPoint\",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.x<=n.x&&e.y<=n.y}},{key:\"containsBox\",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return t.x<=a.x&&i.x<=n.x&&t.y<=a.y&&i.y<=n.y}},{key:\"intersectsBox\",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&a.x<=n.x&&a.y<=n.y}},{key:\"equals\",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),Se=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;oe(this,e),this.radius=t,this.theta=n,this.y=a}return re(e,[{key:\"set\",value:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}},{key:\"copy\",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromVector3\",value:function(e){return this.radius=ae(e.x*e.x+e.z*e.z),this.theta=H(e.x,e.z),this.y=e.y,this}}]),e}(),Te=function(){function e(){oe(this,e),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return re(e,[{key:\"set\",value:function(e,t,n,a,i,l,o,r,s){var y=this.elements;return y[0]=e,y[3]=t,y[6]=n,y[1]=a,y[4]=i,y[7]=l,y[2]=o,y[5]=r,y[8]=s,this}},{key:\"identity\",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:\"copy\",value:function(e){var t=e.elements,n=this.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],this}},{key:\"clone\",value:function(){return new this.constructor().fromArray(this.elements)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a=void 0;for(a=0;9>a;++a)n[a]=e[a+t];return this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a=void 0;for(a=0;9>a;++a)e[a+t]=n[a];return e}},{key:\"multiplyMatrices\",value:function(e,t){var n=e.elements,a=t.elements,i=this.elements,l=n[0],o=n[3],r=n[6],s=n[1],y=n[4],d=n[7],u=n[2],c=n[5],m=n[8],x=a[0],p=a[3],v=a[6],g=a[1],k=a[4],h=a[7],z=a[2],f=a[5],S=a[8];return i[0]=l*x+o*g+r*z,i[3]=l*p+o*k+r*f,i[6]=l*v+o*h+r*S,i[1]=s*x+y*g+d*z,i[4]=s*p+y*k+d*f,i[7]=s*v+y*h+d*S,i[2]=u*x+c*g+m*z,i[5]=u*p+c*k+m*f,i[8]=u*v+c*h+m*S,this}},{key:\"multiply\",value:function(e){return this.multiplyMatrices(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyMatrices(e,this)}},{key:\"multiplyScalar\",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:\"determinant\",value:function(){var t=this.elements,n=t[0],a=t[1],l=t[2],o=t[3],r=t[4],e=t[5],s=t[6],y=t[7],d=t[8];return n*r*d-n*e*y-a*o*d+a*e*s+l*o*y-l*r*s}},{key:\"getInverse\",value:function(e){var t=e.elements,n=this.elements,a=t[0],i=t[1],l=t[2],o=t[3],r=t[4],s=t[5],y=t[6],d=t[7],u=t[8],c=u*r-s*d,m=s*y-u*o,x=d*o-r*y,p=a*c+i*m+l*x,v=void 0;return 0==p?(console.error(\"Can't invert matrix, determinant is zero\",e),this.identity()):(v=1/p,n[0]=c*v,n[1]=(l*d-u*i)*v,n[2]=(s*i-l*r)*v,n[3]=m*v,n[4]=(u*a-l*y)*v,n[5]=(l*o-s*a)*v,n[6]=x*v,n[7]=(i*y-d*a)*v,n[8]=(r*a-i*o)*v),this}},{key:\"transpose\",value:function(){var e=this.elements,n=void 0;return n=e[1],e[1]=e[3],e[3]=n,n=e[2],e[2]=e[6],e[6]=n,n=e[5],e[5]=e[7],e[7]=n,this}},{key:\"scale\",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:\"rotate\",value:function(e){var t=ie(e),n=le(e),a=this.elements,i=a[0],l=a[3],o=a[6],r=a[1],s=a[4],y=a[7];return a[0]=t*i+n*r,a[3]=t*l+n*s,a[6]=t*o+n*y,a[1]=-n*i+t*r,a[4]=-n*l+t*s,a[7]=-n*o+t*y,this}},{key:\"translate\",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:\"equals\",value:function(e){var t=this.elements,n=e.elements,a=!0,l=void 0;for(l=0;a&&9>l;++l)t[l]!==n[l]&&(a=!1);return a}}]),e}(),we={XYZ:\"XYZ\",YZX:\"YZX\",ZXY:\"ZXY\",XZY:\"XZY\",YXZ:\"YXZ\",ZYX:\"ZYX\"},Pe=new xe,Ie=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;oe(this,e),this.x=t,this.y=n,this.z=a,this.w=i}var n=Number.EPSILON;return re(e,[{key:\"set\",value:function(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.w=a,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:\"setFromEuler\",value:function(e){var t=e.x,n=e.y,a=e.z,i=ie,l=le,o=i(t/2),r=i(n/2),s=i(a/2),y=l(t/2),d=l(n/2),u=l(a/2);switch(e.order){case we.XYZ:this.x=y*r*s+o*d*u,this.y=o*d*s-y*r*u,this.z=o*r*u+y*d*s,this.w=o*r*s-y*d*u;break;case we.YXZ:this.x=y*r*s+o*d*u,this.y=o*d*s-y*r*u,this.z=o*r*u-y*d*s,this.w=o*r*s+y*d*u;break;case we.ZXY:this.x=y*r*s-o*d*u,this.y=o*d*s+y*r*u,this.z=o*r*u+y*d*s,this.w=o*r*s-y*d*u;break;case we.ZYX:this.x=y*r*s-o*d*u,this.y=o*d*s+y*r*u,this.z=o*r*u-y*d*s,this.w=o*r*s+y*d*u;break;case we.YZX:this.x=y*r*s+o*d*u,this.y=o*d*s+y*r*u,this.z=o*r*u-y*d*s,this.w=o*r*s-y*d*u;break;case we.XZY:this.x=y*r*s-o*d*u,this.y=o*d*s-y*r*u,this.z=o*r*u+y*d*s,this.w=o*r*s+y*d*u;}return this}},{key:\"setFromAxisAngle\",value:function(e,t){var n=t/2,a=le(n);return this.x=e.x*a,this.y=e.y*a,this.z=e.z*a,this.w=ie(n),this}},{key:\"setFromRotationMatrix\",value:function(e){var t=e.elements,n=t[0],a=t[4],i=t[8],l=t[1],o=t[5],r=t[9],y=t[2],d=t[6],u=t[10],c=n+o+u,m=void 0;return 0<c?(m=.5/ae(c+1),this.w=.25/m,this.x=(d-r)*m,this.y=(i-y)*m,this.z=(l-a)*m):n>o&&n>u?(m=2*ae(1+n-o-u),this.w=(d-r)/m,this.x=.25*m,this.y=(a+l)/m,this.z=(i+y)/m):o>u?(m=2*ae(1+o-n-u),this.w=(i-y)/m,this.x=(a+l)/m,this.y=.25*m,this.z=(r+d)/m):(m=2*ae(1+u-n-o),this.w=(l-a)/m,this.x=(i+y)/m,this.y=(r+d)/m,this.z=.25*m),this}},{key:\"setFromUnitVectors\",value:function(e,t){var n=e.dot(t)+1;return 1e-6>n?(n=0,$(e.x)>$(e.z)?Pe.set(-e.y,e.x,0):Pe.set(0,-e.z,e.y)):Pe.crossVectors(e,t),this.x=Pe.x,this.y=Pe.y,this.z=Pe.z,this.w=n,this.normalize()}},{key:\"invert\",value:function(){return this.conjugate()}},{key:\"conjugate\",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:\"length\",value:function(){return ae(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:\"normalize\",value:function(){var e=this.length(),t=void 0;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/e,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:\"multiplyQuaternions\",value:function(e,t){var n=e.x,a=e.y,i=e.z,l=e.w,o=t.x,r=t.y,s=t.z,y=t.w;return this.x=n*y+l*o+a*s-i*r,this.y=a*y+l*r+i*o-n*s,this.z=i*y+l*s+n*r-a*o,this.w=l*y-n*o-a*r-i*s,this}},{key:\"multiply\",value:function(e){return this.multiplyQuaternions(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyQuaternions(e,this)}},{key:\"slerp\",value:function(e,a){var t=this.x,i=this.y,l=this.z,o=this.w,r=void 0,y=void 0,d=void 0,u=void 0,c=void 0,m=void 0,x=void 0;return 1===a?this.copy(e):0<a&&(r=o*e.w+t*e.x+i*e.y+l*e.z,0>r?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,r=-r):this.copy(e),1<=r?(this.w=o,this.x=t,this.y=i,this.z=l):(y=1-r*r,c=1-a,y<=n?(this.w=c*o+a*this.w,this.x=c*t+a*this.x,this.y=c*i+a*this.y,this.z=c*l+a*this.z,this.normalize()):(d=ae(y),u=H(d,r),m=le(c*u)/d,x=le(a*u)/d,this.w=o*m+this.w*x,this.x=t*m+this.x*x,this.y=i*m+this.y*x,this.z=l*m+this.z*x))),this}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}],[{key:\"slerp\",value:function(e,n,a,i){return a.copy(e).slerp(n,i)}},{key:\"slerpFlat\",value:function(e,a,i,l,o,r,y){var d=o[r],u=o[r+1],c=o[r+2],m=o[r+3],x=i[l],p=i[l+1],v=i[l+2],g=i[l+3],k=void 0,h=void 0,z=void 0,S=void 0,T=void 0,w=void 0,P=void 0,I=void 0;(g!==m||x!==d||p!==u||v!==c)&&(k=1-y,S=x*d+p*u+v*c+g*m,w=0<=S?1:-1,T=1-S*S,T>n&&(z=ae(T),P=H(z,S*w),k=le(k*P)/z,y=le(y*P)/z),I=y*w,x=x*k+d*I,p=p*k+u*I,v=v*k+c*I,g=g*k+m*I,k===1-y&&(h=1/ae(x*x+p*p+v*v+g*g),x*=h,p*=h,v*=h,g*=h)),e[a]=x,e[a+1]=p,e[a+2]=v,e[a+3]=g}}]),e}(),_e=new Te,m=new Ie,q=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;oe(this,t),this.x=e,this.y=n,this.z=a,this.order=t.defaultOrder}return re(t,[{key:\"set\",value:function(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.order=a,this}},{key:\"copy\",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.order=e[t+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.order,e}},{key:\"toVector3\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return e.set(this.x,this.y,this.z)}},{key:\"setFromRotationMatrix\",value:function(t){var n=Math.asin,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order,i=t.elements,l=i[0],o=i[4],r=i[8],s=i[1],y=i[5],d=i[9],u=i[2],c=i[6],m=i[10],x=1-1e-5;switch(a){case we.XYZ:{this.y=n(e(r,-1,1)),$(r)<x?(this.x=H(-d,m),this.z=H(-o,l)):(this.x=H(c,y),this.z=0);break}case we.YXZ:{this.x=n(-e(d,-1,1)),$(d)<x?(this.y=H(r,m),this.z=H(s,y)):(this.y=H(-u,l),this.z=0);break}case we.ZXY:{this.x=n(e(c,-1,1)),$(c)<x?(this.y=H(-u,m),this.z=H(-o,y)):(this.y=0,this.z=H(s,l));break}case we.ZYX:{this.y=n(-e(u,-1,1)),$(u)<x?(this.x=H(c,m),this.z=H(s,l)):(this.x=0,this.z=H(-o,y));break}case we.YZX:{this.z=n(e(s,-1,1)),$(s)<x?(this.x=H(-d,y),this.y=H(-u,l)):(this.x=0,this.y=H(r,m));break}case we.XZY:{this.z=n(-e(o,-1,1)),$(o)<x?(this.x=H(c,y),this.y=H(r,l)):(this.x=H(-d,m),this.y=0);break}}return this.order=a,this}},{key:\"setFromQuaternion\",value:function(e,t){return _e.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_e,t)}},{key:\"setFromVector3\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(e.x,e.y,e.z,t)}},{key:\"reorder\",value:function(e){return m.setFromEuler(this),this.setFromQuaternion(m,e)}},{key:\"equals\",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order}}],[{key:\"defaultOrder\",get:function(){return we.XYZ}}]),t}(),Ce=new xe,a=new xe,b=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe(1,0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;oe(this,e),this.normal=t,this.constant=n}return re(e,[{key:\"set\",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:\"setComponents\",value:function(e,t,n,a){return this.normal.set(e,t,n),this.constant=a,this}},{key:\"copy\",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromNormalAndCoplanarPoint\",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:\"setFromCoplanarPoints\",value:function(e,t,n){var i=Ce.subVectors(n,t).cross(a.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,Ce),this}},{key:\"normalize\",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:\"negate\",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:\"distanceToPoint\",value:function(e){return this.normal.dot(e)+this.constant}},{key:\"distanceToSphere\",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:\"projectPoint\",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:\"coplanarPoint\",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:\"translate\",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:\"intersectLine\",value:function(e,n){var a=e.delta(Ce),i=this.normal.dot(a);if(0===i)0===this.distanceToPoint(e.start)&&n.copy(e.start);else{var l=-(e.start.dot(this.normal)+this.constant)/i;0<=l&&1>=l&&n.copy(a).multiplyScalar(l).add(e.start)}return n}},{key:\"intersectsLine\",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return 0>t&&0<n||0>n&&0<t}},{key:\"intersectsBox\",value:function(e){return e.intersectsPlane(this)}},{key:\"intersectsSphere\",value:function(e){return e.intersectsPlane(this)}},{key:\"equals\",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}]),e}(),be=new xe,Ee=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new b,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new b,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new b,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new b,l=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new b,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new b;oe(this,e),this.planes=[t,n,a,i,l,o]}return re(e,[{key:\"set\",value:function(e,t,n,a,i,l){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(a),o[4].copy(i),o[5].copy(l),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"copy\",value:function(e){var t=this.planes,n=void 0;for(n=0;6>n;++n)t[n].copy(e.planes[n]);return this}},{key:\"setFromMatrix\",value:function(e){var t=this.planes,n=e.elements,a=n[0],i=n[1],l=n[2],o=n[3],r=n[4],s=n[5],y=n[6],d=n[7],u=n[8],c=n[9],m=n[10],x=n[11],p=n[12],v=n[13],g=n[14],k=n[15];return t[0].setComponents(o-a,d-r,x-u,k-p).normalize(),t[1].setComponents(o+a,d+r,x+u,k+p).normalize(),t[2].setComponents(o+i,d+s,x+c,k+v).normalize(),t[3].setComponents(o-i,d-s,x-c,k-v).normalize(),t[4].setComponents(o-l,d-y,x-m,k-g).normalize(),t[5].setComponents(o+l,d+y,x+m,k+g).normalize(),this}},{key:\"intersectsSphere\",value:function(e){var t=this.planes,n=e.center,a=-e.radius,l=!0,o=void 0,r=void 0;for(o=0;6>o;++o)if(r=t[o].distanceToPoint(n),r<a){l=!1;break}return l}},{key:\"intersectsBox\",value:function(e){var t=this.planes,n=e.min,a=e.max,l=void 0,o=void 0;for(l=0;6>l;++l)if(o=t[l],be.x=0<o.normal.x?a.x:n.x,be.y=0<o.normal.y?a.y:n.y,be.z=0<o.normal.z?a.z:n.z,0>o.distanceToPoint(be))return!1;return!0}},{key:\"containsPoint\",value:function(e){var t=this.planes,n=!0,a=void 0;for(a=0;6>a;++a)if(0>t[a].distanceToPoint(e)){n=!1;break}return n}}]),e}(),Oe=new xe,De=new xe,qe=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe;oe(this,e),this.start=t,this.end=n}return re(e,[{key:\"set\",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:\"copy\",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:\"delta\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return e.subVectors(this.end,this.start)}},{key:\"lengthSquared\",value:function(){return this.start.distanceToSquared(this.end)}},{key:\"length\",value:function(){return this.start.distanceTo(this.end)}},{key:\"at\",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:\"closestPointToPointParameter\",value:function(e,n){Oe.subVectors(e,this.start),De.subVectors(this.end,this.start);var a=De.dot(De),i=De.dot(Oe),l=n?te(ne(i/a,0),1):i/a;return l}},{key:\"closestPointToPoint\",value:function(e){var n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new xe,i=this.closestPointToPointParameter(e,n);return this.delta(a).multiplyScalar(i).add(this.start)}},{key:\"equals\",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}]),e}(),Ae=new xe,Ve=new xe,Fe=new xe,c=function(){function e(){oe(this,e),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return re(e,[{key:\"set\",value:function(e,t,n,a,i,l,o,r,s,y,d,u,c,m,x,p){var v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=a,v[1]=i,v[5]=l,v[9]=o,v[13]=r,v[2]=s,v[6]=y,v[10]=d,v[14]=u,v[3]=c,v[7]=m,v[11]=x,v[15]=p,this}},{key:\"identity\",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:\"copy\",value:function(e){var t=e.elements,n=this.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],this}},{key:\"clone\",value:function(){return new this.constructor().fromArray(this.elements)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a=void 0;for(a=0;16>a;++a)n[a]=e[a+t];return this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a=void 0;for(a=0;16>a;++a)e[a+t]=n[a];return e}},{key:\"getMaxScaleOnAxis\",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],a=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return ae(ne(t,n,a))}},{key:\"copyPosition\",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:\"setPosition\",value:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}},{key:\"extractBasis\",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:\"makeBasis\",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:\"extractRotation\",value:function(e){var t=this.elements,n=e.elements,a=1/Ae.setFromMatrixColumn(e,0).length(),i=1/Ae.setFromMatrixColumn(e,1).length(),l=1/Ae.setFromMatrixColumn(e,2).length();return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*l,t[9]=n[9]*l,t[10]=n[10]*l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:\"makeRotationFromEuler\",value:function(t){var n=this.elements,i=t.x,l=t.y,o=t.z,r=ie(i),a=le(i),s=ie(l),y=le(l),d=ie(o),e=le(o),u=void 0,c=void 0,m=void 0,x=void 0,p=void 0,v=void 0,g=void 0,k=void 0,h=void 0,z=void 0,f=void 0,S=void 0;switch(t.order){case we.XYZ:{u=r*d,c=r*e,m=a*d,x=a*e,n[0]=s*d,n[4]=-s*e,n[8]=y,n[1]=c+m*y,n[5]=u-x*y,n[9]=-a*s,n[2]=x-u*y,n[6]=m+c*y,n[10]=r*s;break}case we.YXZ:{p=s*d,v=s*e,g=y*d,k=y*e,n[0]=p+k*a,n[4]=g*a-v,n[8]=r*y,n[1]=r*e,n[5]=r*d,n[9]=-a,n[2]=v*a-g,n[6]=k+p*a,n[10]=r*s;break}case we.ZXY:{p=s*d,v=s*e,g=y*d,k=y*e,n[0]=p-k*a,n[4]=-r*e,n[8]=g+v*a,n[1]=v+g*a,n[5]=r*d,n[9]=k-p*a,n[2]=-r*y,n[6]=a,n[10]=r*s;break}case we.ZYX:{u=r*d,c=r*e,m=a*d,x=a*e,n[0]=s*d,n[4]=m*y-c,n[8]=u*y+x,n[1]=s*e,n[5]=x*y+u,n[9]=c*y-m,n[2]=-y,n[6]=a*s,n[10]=r*s;break}case we.YZX:{h=r*s,z=r*y,f=a*s,S=a*y,n[0]=s*d,n[4]=S-h*e,n[8]=f*e+z,n[1]=e,n[5]=r*d,n[9]=-a*d,n[2]=-y*d,n[6]=z*e+f,n[10]=h-S*e;break}case we.XZY:{h=r*s,z=r*y,f=a*s,S=a*y,n[0]=s*d,n[4]=-e,n[8]=y*d,n[1]=h*e+S,n[5]=r*d,n[9]=z*e-f,n[2]=f*e-z,n[6]=a*d,n[10]=S*e+h;break}}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}},{key:\"makeRotationFromQuaternion\",value:function(e){return this.compose(Ae.set(0,0,0),e,Ve.set(1,1,1))}},{key:\"lookAt\",value:function(e,t,n){var a=this.elements,i=Ae,l=Ve,o=Fe;return o.subVectors(e,t),0===o.lengthSquared()&&(o.z=1),o.normalize(),i.crossVectors(n,o),0===i.lengthSquared()&&(1===$(n.z)?o.x+=1e-4:o.z+=1e-4,o.normalize(),i.crossVectors(n,o)),i.normalize(),l.crossVectors(o,i),a[0]=i.x,a[4]=l.x,a[8]=o.x,a[1]=i.y,a[5]=l.y,a[9]=o.y,a[2]=i.z,a[6]=l.z,a[10]=o.z,this}},{key:\"multiplyMatrices\",value:function(e,t){var n=this.elements,a=e.elements,i=t.elements,l=a[0],o=a[4],r=a[8],s=a[12],y=a[1],d=a[5],u=a[9],c=a[13],m=a[2],x=a[6],p=a[10],v=a[14],g=a[3],k=a[7],h=a[11],z=a[15],f=i[0],S=i[4],T=i[8],w=i[12],P=i[1],I=i[5],_=i[9],C=i[13],b=i[2],E=i[6],O=i[10],D=i[14],q=i[3],A=i[7],V=i[11],F=i[15];return n[0]=l*f+o*P+r*b+s*q,n[4]=l*S+o*I+r*E+s*A,n[8]=l*T+o*_+r*O+s*V,n[12]=l*w+o*C+r*D+s*F,n[1]=y*f+d*P+u*b+c*q,n[5]=y*S+d*I+u*E+c*A,n[9]=y*T+d*_+u*O+c*V,n[13]=y*w+d*C+u*D+c*F,n[2]=m*f+x*P+p*b+v*q,n[6]=m*S+x*I+p*E+v*A,n[10]=m*T+x*_+p*O+v*V,n[14]=m*w+x*C+p*D+v*F,n[3]=g*f+k*P+h*b+z*q,n[7]=g*S+k*I+h*E+z*A,n[11]=g*T+k*_+h*O+z*V,n[15]=g*w+k*C+h*D+z*F,this}},{key:\"multiply\",value:function(e){return this.multiplyMatrices(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyMatrices(e,this)}},{key:\"multiplyScalar\",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:\"determinant\",value:function(){var e=this.elements,t=e[0],n=e[4],a=e[8],i=e[12],l=e[1],o=e[5],r=e[9],s=e[13],y=e[2],d=e[6],u=e[10],c=e[14],m=e[3],x=e[7],p=e[11],v=e[15],g=t*o,k=t*r,h=t*s,z=n*l,f=n*r,S=n*s,T=a*l,w=a*o,P=a*s,I=i*l,_=i*o,C=i*r;return m*(C*d-P*d-_*u+S*u+w*c-f*c)+x*(k*c-h*u+I*u-T*c+P*y-C*y)+p*(h*d-g*c-I*d+z*c+_*y-S*y)+v*(-w*y-k*d+g*u+T*d-z*u+f*y)}},{key:\"getInverse\",value:function(e){var t=this.elements,n=e.elements,a=n[0],i=n[1],l=n[2],o=n[3],r=n[4],s=n[5],y=n[6],d=n[7],u=n[8],c=n[9],m=n[10],x=n[11],p=n[12],v=n[13],g=n[14],k=n[15],h=c*g*d-v*m*d+v*y*x-s*g*x-c*y*k+s*m*k,z=p*m*d-u*g*d-p*y*x+r*g*x+u*y*k-r*m*k,f=u*v*d-p*c*d+p*s*x-r*v*x-u*s*k+r*c*k,S=p*c*y-u*v*y-p*s*m+r*v*m+u*s*g-r*c*g,T=a*h+i*z+l*f+o*S,w=void 0;return 0==T?(console.error(\"Can't invert matrix, determinant is zero\",e),this.identity()):(w=1/T,t[0]=h*w,t[1]=(v*m*o-c*g*o-v*l*x+i*g*x+c*l*k-i*m*k)*w,t[2]=(s*g*o-v*y*o+v*l*d-i*g*d-s*l*k+i*y*k)*w,t[3]=(c*y*o-s*m*o-c*l*d+i*m*d+s*l*x-i*y*x)*w,t[4]=z*w,t[5]=(u*g*o-p*m*o+p*l*x-a*g*x-u*l*k+a*m*k)*w,t[6]=(p*y*o-r*g*o-p*l*d+a*g*d+r*l*k-a*y*k)*w,t[7]=(r*m*o-u*y*o+u*l*d-a*m*d-r*l*x+a*y*x)*w,t[8]=f*w,t[9]=(p*c*o-u*v*o-p*i*x+a*v*x+u*i*k-a*c*k)*w,t[10]=(r*v*o-p*s*o+p*i*d-a*v*d-r*i*k+a*s*k)*w,t[11]=(u*s*o-r*c*o-u*i*d+a*c*d+r*i*x-a*s*x)*w,t[12]=S*w,t[13]=(u*v*l-p*c*l+p*i*m-a*v*m-u*i*g+a*c*g)*w,t[14]=(p*s*l-r*v*l-p*i*y+a*v*y+r*i*g-a*s*g)*w,t[15]=(r*c*l-u*s*l+u*i*y-a*c*y-r*i*m+a*s*m)*w),this}},{key:\"transpose\",value:function(){var e=this.elements,n=void 0;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}},{key:\"scale\",value:function(e,t,n){var a=this.elements;return a[0]*=e,a[4]*=t,a[8]*=n,a[1]*=e,a[5]*=t,a[9]*=n,a[2]*=e,a[6]*=t,a[10]*=n,a[3]*=e,a[7]*=t,a[11]*=n,this}},{key:\"makeScale\",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:\"makeTranslation\",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:\"makeRotationX\",value:function(e){var t=ie(e),n=le(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:\"makeRotationY\",value:function(e){var t=ie(e),n=le(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:\"makeRotationZ\",value:function(e){var t=ie(e),n=le(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:\"makeRotationAxis\",value:function(e,n){var a=ie(n),i=le(n),l=1-a,t=e.x,o=e.y,r=e.z,s=l*t,y=l*o;return this.set(s*t+a,s*o-i*r,s*r+i*o,0,s*o+i*r,y*o+a,y*r-i*t,0,s*r-i*o,y*r+i*t,l*r*r+a,0,0,0,0,1),this}},{key:\"makeShear\",value:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}},{key:\"compose\",value:function(e,t,n){var a=this.elements,i=t.x,l=t.y,o=t.z,r=t.w,s=i+i,y=l+l,d=o+o,u=i*s,c=i*y,m=i*d,x=l*y,p=l*d,v=o*d,g=r*s,k=r*y,h=r*d,z=n.x,f=n.y,S=n.z;return a[0]=(1-(x+v))*z,a[1]=(c+h)*z,a[2]=(m-k)*z,a[3]=0,a[4]=(c-h)*f,a[5]=(1-(u+v))*f,a[6]=(p+g)*f,a[7]=0,a[8]=(m+k)*S,a[9]=(p-g)*S,a[10]=(1-(u+x))*S,a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1,this}},{key:\"decompose\",value:function(e,t,n){var a=this.elements,i=a[0],l=a[1],o=a[2],r=a[4],s=a[5],y=a[6],d=a[8],u=a[9],c=a[10],m=this.determinant(),x=Ae.set(i,l,o).length()*(0>m?-1:1),p=Ae.set(r,s,y).length(),v=Ae.set(d,u,c).length(),g=1/x,k=1/p,h=1/v;return e.x=a[12],e.y=a[13],e.z=a[14],a[0]*=g,a[1]*=g,a[2]*=g,a[4]*=k,a[5]*=k,a[6]*=k,a[8]*=h,a[9]*=h,a[10]*=h,t.setFromRotationMatrix(this),a[0]=i,a[1]=l,a[2]=o,a[4]=r,a[5]=s,a[6]=y,a[8]=d,a[9]=u,a[10]=c,n.x=x,n.y=p,n.z=v,this}},{key:\"makePerspective\",value:function(e,t,n,a,i,l){var o=this.elements;return o[0]=2*i/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*i/(n-a),o[9]=(n+a)/(n-a),o[13]=0,o[2]=0,o[6]=0,o[10]=-(l+i)/(l-i),o[14]=-2*l*i/(l-i),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:\"makeOrthographic\",value:function(e,t,n,a,i,l){var o=this.elements,r=1/(t-e),s=1/(n-a),y=1/(l-i);return o[0]=2*r,o[4]=0,o[8]=0,o[12]=-((t+e)*r),o[1]=0,o[5]=2*s,o[9]=0,o[13]=-((n+a)*s),o[2]=0,o[6]=0,o[10]=-2*y,o[14]=-((l+i)*y),o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:\"equals\",value:function(e){var t=this.elements,n=e.elements,a=!0,l=void 0;for(l=0;a&&16>l;++l)t[l]!==n[l]&&(a=!1);return a}}]),e}(),Be=[new xe,new xe,new xe,new xe],Ne=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe;oe(this,e),this.origin=t,this.direction=n}return re(e,[{key:\"set\",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:\"copy\",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"at\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe;return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:\"lookAt\",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:\"recast\",value:function(e){return this.origin.copy(this.at(e,Be[0])),this}},{key:\"closestPointToPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe,n=t.subVectors(e,this.origin).dot(this.direction);return 0<=n?t.copy(this.direction).multiplyScalar(n).add(this.origin):t.copy(this.origin)}},{key:\"distanceSquaredToPoint\",value:function(e){var t=Be[0].subVectors(e,this.origin).dot(this.direction);return 0>t?this.origin.distanceToSquared(e):Be[0].copy(this.direction).multiplyScalar(t).add(this.origin).distanceToSquared(e)}},{key:\"distanceToPoint\",value:function(e){return ae(this.distanceSquaredToPoint(e))}},{key:\"distanceToPlane\",value:function(e){var n=e.normal.dot(this.direction),a=0===n?0===e.distanceToPoint(this.origin)?0:-1:-(this.origin.dot(e.normal)+e.constant)/n;return 0<=a?a:null}},{key:\"distanceSquaredToSegment\",value:function(e,t,n,a){var i=Be[0].copy(e).add(t).multiplyScalar(.5),l=Be[1].copy(t).sub(e).normalize(),o=Be[2].copy(this.origin).sub(i),r=.5*e.distanceTo(t),s=-this.direction.dot(l),y=o.dot(this.direction),d=-o.dot(l),u=o.lengthSq(),c=$(1-s*s),m=void 0,x=void 0,p=void 0,v=void 0,g=void 0;return 0<c?(m=s*d-y,x=s*y-d,p=r*c,0<=m?x>=-p?x<=p?(v=1/c,m*=v,x*=v,g=m*(m+s*x+2*y)+x*(s*m+x+2*d)+u):(x=r,m=ne(0,-(s*x+y)),g=-m*m+x*(x+2*d)+u):(x=-r,m=ne(0,-(s*x+y)),g=-m*m+x*(x+2*d)+u):x<=-p?(m=ne(0,-(-s*r+y)),x=0<m?-r:te(ne(-r,-d),r),g=-m*m+x*(x+2*d)+u):x<=p?(m=0,x=te(ne(-r,-d),r),g=x*(x+2*d)+u):(m=ne(0,-(s*r+y)),x=0<m?r:te(ne(-r,-d),r),g=-m*m+x*(x+2*d)+u)):(x=0<s?-r:r,m=ne(0,-(s*x+y)),g=-m*m+x*(x+2*d)+u),void 0!==n&&n.copy(this.direction).multiplyScalar(m).add(this.origin),void 0!==a&&a.copy(l).multiplyScalar(x).add(i),g}},{key:\"intersectSphere\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe,n=Be[0].subVectors(e.center,this.origin),a=n.dot(this.direction),i=n.dot(n)-a*a,l=e.radius*e.radius,o=null,r=void 0,s=void 0,y=void 0;return i<=l&&(r=ae(l-i),s=a-r,y=a+r,(0<=s||0<=y)&&(o=0>s?this.at(y,t):this.at(s,t))),o}},{key:\"intersectsSphere\",value:function(e){return this.distanceToPoint(e.center)<=e.radius}},{key:\"intersectPlane\",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe,a=this.distanceToPlane(e);return null===a?null:this.at(a,n)}},{key:\"intersectsPlane\",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t}},{key:\"intersectBox\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe,n=this.origin,a=this.direction,i=e.min,l=e.max,o=1/a.x,r=1/a.y,s=1/a.z,y=null,d=void 0,u=void 0,c=void 0,m=void 0,x=void 0,p=void 0;return 0<=o?(d=(i.x-n.x)*o,u=(l.x-n.x)*o):(d=(l.x-n.x)*o,u=(i.x-n.x)*o),0<=r?(c=(i.y-n.y)*r,m=(l.y-n.y)*r):(c=(l.y-n.y)*r,m=(i.y-n.y)*r),d<=m&&c<=u&&((c>d||d!=d)&&(d=c),(m<u||u!=u)&&(u=m),0<=s?(x=(i.z-n.z)*s,p=(l.z-n.z)*s):(x=(l.z-n.z)*s,p=(i.z-n.z)*s),d<=p&&x<=u&&((x>d||d!=d)&&(d=x),(p<u||u!=u)&&(u=p),0<=u&&(y=this.at(0<=d?d:u,t)))),y}},{key:\"intersectsBox\",value:function(e){return null!==this.intersectBox(e,Be[0])}},{key:\"intersectTriangle\",value:function(e,t,n,a,i){var l=this.direction,o=Be[0],r=Be[1],s=Be[2],y=Be[3],d=null,u=void 0,c=void 0,m=void 0,x=void 0,p=void 0;return r.subVectors(t,e),s.subVectors(n,e),y.crossVectors(r,s),u=l.dot(y),0===u||a&&0<u||(0<u?c=1:(c=-1,u=-u),o.subVectors(this.origin,e),m=c*l.dot(s.crossVectors(o,s)),0<=m&&(x=c*l.dot(r.cross(o)),0<=x&&m+x<=u&&(p=-c*o.dot(y),0<=p&&(d=this.at(p/u,i))))),d}},{key:\"applyMatrix4\",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:\"equals\",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),e}(),Le=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;oe(this,e),this.radius=t,this.phi=n,this.theta=a}return re(e,[{key:\"set\",value:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}},{key:\"copy\",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromVector3\",value:function(e){return this.radius=e.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=H(e.x,e.z),this.phi=ee(te(ne(e.y/this.radius,-1),1))),this.makeSafe()}},{key:\"makeSafe\",value:function(){return this.phi=ne(1e-6,te(G-1e-6,this.phi)),this}}]),e}(),Re=function(){function e(){oe(this,e),this.elements=new Float32Array([1,0,0,1,0,1])}return re(e,[{key:\"set\",value:function(t,n,a,i,l,o){var r=this.elements;return r[0]=t,r[1]=n,r[3]=i,r[2]=a,r[4]=l,r[5]=o,this}},{key:\"identity\",value:function(){return this.set(1,0,0,1,0,1),this}},{key:\"copy\",value:function(e){var t=e.elements;return this.set(t[0],t[1],t[2],t[3],t[4],t[5]),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"toMatrix3\",value:function(e){var t=e.elements;e.set(t[0],t[1],t[2],t[1],t[3],t[4],t[2],t[4],t[5])}},{key:\"add\",value:function(e){var t=this.elements,n=e.elements;return t[0]+=n[0],t[1]+=n[1],t[3]+=n[3],t[2]+=n[2],t[4]+=n[4],t[5]+=n[5],this}},{key:\"norm\",value:function(){var t=this.elements,e=t[1]*t[1],n=t[2]*t[2],a=t[4]*t[4];return ae(t[0]*t[0]+e+n+e+t[3]*t[3]+a+n+a+t[5]*t[5])}},{key:\"off\",value:function(){var t=this.elements;return ae(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:\"applyToVector3\",value:function(t){var n=t.x,a=t.y,i=t.z,l=this.elements;return t.x=l[0]*n+l[1]*a+l[2]*i,t.y=l[1]*n+l[3]*a+l[4]*i,t.z=l[2]*n+l[4]*a+l[5]*i,t}},{key:\"equals\",value:function(e){var t=this.elements,n=e.elements,a=!0,l=void 0;for(l=0;a&&6>l;++l)t[l]!==n[l]&&(a=!1);return a}}],[{key:\"calculateIndex\",value:function(e,t){return 3-(3-e)*(2-e)/2+t}}]),e}(),Ye=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;oe(this,e),this.x=t,this.y=n,this.z=a,this.w=i}return re(e,[{key:\"set\",value:function(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.w=a,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:\"setAxisAngleFromQuaternion\",value:function(e){this.w=2*ee(e.w);var t=ae(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:\"setAxisAngleFromRotationMatrix\",value:function(e){var t=.01,n=.1,a=e.elements,i=a[0],l=a[4],o=a[8],r=a[1],d=a[5],u=a[9],c=a[2],m=a[6],p=a[10],v=void 0,g=void 0,k=void 0,h=void 0,f=void 0,S=void 0,T=void 0,w=void 0,P=void 0,I=void 0,_=void 0;return $(l-r)<t&&$(o-c)<t&&$(u-m)<t?$(l+r)<n&&$(o+c)<n&&$(u+m)<n&&$(i+d+p-3)<n?this.set(1,0,0,0):(v=G,f=(i+1)/2,S=(d+1)/2,T=(p+1)/2,w=(l+r)/4,P=(o+c)/4,I=(u+m)/4,f>S&&f>T?f<t?(g=0,k=.707106781,h=.707106781):(g=ae(f),k=w/g,h=P/g):S>T?S<t?(g=.707106781,k=0,h=.707106781):(k=ae(S),g=w/k,h=I/k):T<t?(g=.707106781,k=.707106781,h=0):(h=ae(T),g=P/h,k=I/h),this.set(g,k,h,v)):(_=ae((m-u)*(m-u)+(o-c)*(o-c)+(r-l)*(r-l)),.001>$(_)&&(_=1),this.x=(m-u)/_,this.y=(o-c)/_,this.z=(r-l)/_,this.w=ee((i+d+p-1)/2)),this}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:\"addVectors\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:\"addScaledVector\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:\"subVectors\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:\"multiplyVectors\",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this.w=e.w*t.w,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this}},{key:\"applyMatrix4\",value:function(t){var n=this.x,a=this.y,i=this.z,l=this.w,o=t.elements;return this.x=o[0]*n+o[4]*a+o[8]*i+o[12]*l,this.y=o[1]*n+o[5]*a+o[9]*i+o[13]*l,this.z=o[2]*n+o[6]*a+o[10]*i+o[14]*l,this.w=o[3]*n+o[7]*a+o[11]*i+o[15]*l,this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:\"manhattanLength\",value:function(){return $(this.x)+$(this.y)+$(this.z)+$(this.w)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:\"length\",value:function(){return ae(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:\"manhattanDistanceTo\",value:function(e){return $(this.x-e.x)+$(this.y-e.y)+$(this.z-e.z)+$(this.w-e.w)}},{key:\"distanceToSquared\",value:function(e){var t=this.x-e.x,n=this.y-e.y,a=this.z-e.z,i=this.w-e.w;return t*t+n*n+a*a+i*i}},{key:\"distanceTo\",value:function(e){return ae(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=te(this.x,e.x),this.y=te(this.y,e.y),this.z=te(this.z,e.z),this.w=te(this.w,e.w),this}},{key:\"max\",value:function(e){return this.x=ne(this.x,e.x),this.y=ne(this.y,e.y),this.z=ne(this.z,e.z),this.w=ne(this.w,e.w),this}},{key:\"clamp\",value:function(e,t){return this.x=ne(e.x,te(t.x,this.x)),this.y=ne(e.y,te(t.y,this.y)),this.z=ne(e.z,te(t.z,this.z)),this.w=ne(e.w,te(t.w,this.w)),this}},{key:\"floor\",value:function(){return this.x=W(this.x),this.y=W(this.y),this.z=W(this.z),this.w=W(this.w),this}},{key:\"ceil\",value:function(){return this.x=K(this.x),this.y=K(this.y),this.z=K(this.z),this.w=K(this.w),this}},{key:\"round\",value:function(){return this.x=J(this.x),this.y=J(this.y),this.z=J(this.z),this.w=J(this.w),this}},{key:\"lerp\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:\"lerpVectors\",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}]),e}(),Me=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];oe(this,e),this.value=t,this.done=n}return re(e,[{key:\"reset\",value:function(){this.value=null,this.done=!1}}]),e}(),Xe=new xe,Ze=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe;oe(this,e),this.min=t,this.max=n,this.children=null}return re(e,[{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getDimensions\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return e.subVectors(this.max,this.min)}},{key:\"split\",value:function(){var e=this.min,t=this.max,n=this.getCenter(Xe),a=this.children=[null,null,null,null,null,null,null,null],l=void 0,o=void 0;for(l=0;8>l;++l)o=je[l],a[l]=new this.constructor(new xe(0===o[0]?e.x:n.x,0===o[1]?e.y:n.y,0===o[2]?e.z:n.z),new xe(0===o[0]?n.x:t.x,0===o[1]?n.y:t.y,0===o[2]?n.z:t.z))}}]),e}(),je=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],Ue=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],Qe=new xe,Ge=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;oe(this,e),this.min=t,this.size=n,this.children=null}return re(e,[{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return e.copy(this.min).addScalar(.5*this.size)}},{key:\"getDimensions\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return e.set(this.size,this.size,this.size)}},{key:\"split\",value:function(){var e=this.min,t=this.getCenter(Qe),n=.5*this.size,a=this.children=[null,null,null,null,null,null,null,null],l=void 0,o=void 0;for(l=0;8>l;++l)o=je[l],a[l]=new this.constructor(new xe(0===o[0]?e.x:t.x,0===o[1]?e.y:t.y,0===o[2]?e.z:t.z),n)}},{key:\"max\",get:function(){return this.min.clone().addScalar(this.size)}}]),e}(),He=new v,Je=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;oe(this,e),this.octree=t,this.region=n,this.cull=null!==n,this.result=new Me,this.trace=null,this.indices=null,this.reset()}return re(e,[{key:\"reset\",value:function(){var e=this.octree.root;return this.trace=[],this.indices=[],null!==e&&(He.min=e.min,He.max=e.max,(!this.cull||this.region.intersectsBox(He))&&(this.trace.push(e),this.indices.push(0))),this.result.reset(),this}},{key:\"next\",value:function(){for(var e=this.cull,t=this.region,n=this.indices,a=this.trace,i=null,l=a.length-1,o=void 0,r=void 0,s=void 0;null===i&&0<=l;)if(o=n[l]++,r=a[l].children,!(8>o))a.pop(),n.pop(),--l;else if(null!==r){if(s=r[o],e&&(He.min=s.min,He.max=s.max,!t.intersectsBox(He)))continue;a.push(s),n.push(0),++l}else i=a.pop(),n.pop();return this.result.value=i,this.result.done=null===i,this.result}},{key:\"return\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),Ke=[new xe,new xe,new xe],We=new v,$e=new Ne,r=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],et=0,tt=function(){function e(){oe(this,e)}return re(e,null,[{key:\"intersectOctree\",value:function(e,t,n){var a=We.min.set(0,0,0),l=We.max.subVectors(e.max,e.min),o=e.getDimensions(Ke[0]),r=Ke[1].copy(o).multiplyScalar(.5),s=$e.origin.copy(t.ray.origin),y=$e.direction.copy(t.ray.direction),d=void 0,u=void 0,c=void 0,m=void 0,x=void 0,p=void 0,v=void 0,g=void 0,k=void 0;s.sub(e.getCenter(Ke[2])).add(r),et=0,0>y.x&&(s.x=o.x-s.x,y.x=-y.x,et|=4),0>y.y&&(s.y=o.y-s.y,y.y=-y.y,et|=2),0>y.z&&(s.z=o.z-s.z,y.z=-y.z,et|=1),d=1/y.x,u=1/y.y,c=1/y.z,m=(a.x-s.x)*d,x=(l.x-s.x)*d,p=(a.y-s.y)*u,v=(l.y-s.y)*u,g=(a.z-s.z)*c,k=(l.z-s.z)*c,ne(ne(m,p),g)<te(te(x,v),k)&&i(e.root,m,p,g,x,v,k,t,n)}}]),e}(),nt=new v,at=function(){function e(t,n){oe(this,e),this.root=void 0!==t&&void 0!==n?new Ze(t,n):null}return re(e,[{key:\"getCenter\",value:function(e){return this.root.getCenter(e)}},{key:\"getDimensions\",value:function(e){return this.root.getDimensions(e)}},{key:\"getDepth\",value:function(){return o(this.root)}},{key:\"cull\",value:function(e){var t=[];return s(this.root,e,t),t}},{key:\"findOctantsByLevel\",value:function(e){var t=[];return y(this.root,e,0,t),t}},{key:\"raycast\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return tt.intersectOctree(this,e,t),t}},{key:\"leaves\",value:function(e){return new Je(this,e)}},{key:Symbol.iterator,value:function(){return new Je(this)}},{key:\"min\",get:function(){return this.root.min}},{key:\"max\",get:function(){return this.root.max}},{key:\"children\",get:function(){return this.root.children}}]),e}(),it=new xe,p=function(e){function t(e,n){oe(this,t);var a=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return a.points=null,a.data=null,a}return ye(t,e),re(t,[{key:\"distanceToSquared\",value:function(e){var t=it.copy(e).clamp(this.min,this.max);return t.sub(e).lengthSquared()}},{key:\"distanceToCenterSquared\",value:function(e){var t=this.getCenter(it),n=e.x-t.x,a=e.y-t.x,i=e.z-t.z;return n*n+a*a+i*i}},{key:\"contains\",value:function(e,t){var n=this.min,a=this.max;return e.x>=n.x-t&&e.y>=n.y-t&&e.z>=n.z-t&&e.x<=a.x+t&&e.y<=a.y+t&&e.z<=a.z+t}},{key:\"redistribute\",value:function(e){var t=this.children,n=this.points,a=this.data,l=void 0,o=void 0,r=void 0,s=void 0,y=void 0,d=void 0,u=void 0;if(null!==t&&null!==n)for(l=0,r=n.length;l<r;++l)for(d=n[l],u=a[l],(o=0,s=t.length);o<s;++o)if(y=t[o],y.contains(d,e)){null===y.points&&(y.points=[],y.data=[]),y.points.push(d),y.data.push(u);break}this.points=null,this.data=null}},{key:\"merge\",value:function(){var e=this.children,t=void 0,n=void 0,a=void 0;if(null!==e){for(this.points=[],this.data=[],(t=0,n=e.length);t<n;++t)if(a=e[t],null!==a.points){var o,r;(o=this.points).push.apply(o,ce(a.points)),(r=this.data).push.apply(r,ce(a.data))}this.children=null}}}]),t}(Ze),lt=function e(t,n,a){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;oe(this,e),this.distance=t,this.distanceToRay=n,this.point=a,this.object=i},ot=1e-6,rt=function(e){function t(e,n){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,l=4<arguments.length&&void 0!==arguments[4]?arguments[4]:8;oe(this,t);var o=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.root=new p(e,n),o.bias=ne(0,a),o.maxPoints=ne(1,J(i)),o.maxDepth=ne(0,J(l)),o.pointCount=0,o}return ye(t,e),re(t,[{key:\"countPoints\",value:function(e){return d(e)}},{key:\"put\",value:function(e,t){return x(e,t,this,this.root,0)}},{key:\"remove\",value:function(e){return g(e,this,this.root,null)}},{key:\"fetch\",value:function(e){return k(e,this,this.root)}},{key:\"move\",value:function(e,t){return h(e,t,this,this.root,null,0)}},{key:\"findNearestPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0,n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];return z(e,t,n,this.root)}},{key:\"findPoints\",value:function(e,t){var n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],a=[];return f(e,t,n,this.root,a),a}},{key:\"raycast\",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],a=se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"raycast\",this).call(this,e);return 0<a.length&&this.testPoints(a,e,n),n}},{key:\"testPoints\",value:function(e,t,n){var a=t.params.Points.threshold,l=void 0,o=void 0,r=void 0,s=void 0,y=void 0,d=void 0,u=void 0,c=void 0,m=void 0,x=void 0,p=void 0;for(y=0,u=e.length;y<u;++y)if(m=e[y],x=m.points,null!==x)for(d=0,c=x.length;d<c;++d)p=x[d],s=t.ray.distanceSqToPoint(p),s<a*a&&(l=t.ray.closestPointToPoint(p,new xe),o=t.ray.origin.distanceTo(l),o>=t.near&&o<=t.far&&(r=ae(s),n.push(new lt(o,r,l,m.data[d]))))}}]),t}(at),st=new v,yt=new xe,dt=new xe,u=new xe,ut=function(){function e(){oe(this,e)}return re(e,null,[{key:\"recycleOctants\",value:function(e,t){var n=e.min,a=e.getCenter(dt),o=e.getDimensions(u).multiplyScalar(.5),r=e.children,s=t.length,l=void 0,y=void 0,d=void 0,c=void 0;for(l=0;8>l;++l)for(d=je[l],st.min.addVectors(n,yt.fromArray(d).multiply(o)),st.max.addVectors(a,yt.fromArray(d).multiply(o)),y=0;y<s;++y)if(c=t[y],null!==c&&st.min.equals(c.min)&&st.max.equals(c.max)){r[l]=c,t[y]=null;break}}}]),e}(),ct=new xe,mt=new xe,xt=new xe,pt=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe;oe(this,e),this.a=t,this.b=n,this.index=-1,this.coordinates=new xe,this.t=0,this.n=new xe}return re(e,[{key:\"approximateZeroCrossing\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,n=ne(1,t-1),l=0,o=1,r=0,s=0,y=void 0,d=void 0;for(ct.subVectors(this.b,this.a);s<=n&&(r=(l+o)/2,mt.addVectors(this.a,xt.copy(ct).multiplyScalar(r)),d=e.sample(mt),!(1e-4>=$(d)||1e-6>=(o-l)/2));)mt.addVectors(this.a,xt.copy(ct).multiplyScalar(l)),y=e.sample(mt),Q(d)===Q(y)?l=r:o=r,++s;this.t=r}},{key:\"computeZeroCrossingPosition\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xe;return e.subVectors(this.b,this.a).multiplyScalar(this.t).add(this.a)}},{key:\"computeSurfaceNormal\",value:function(e){var t=this.computeZeroCrossingPosition(ct),n=1e-3,a=e.sample(mt.addVectors(t,xt.set(n,0,0)))-e.sample(mt.subVectors(t,xt.set(n,0,0))),i=e.sample(mt.addVectors(t,xt.set(0,n,0)))-e.sample(mt.subVectors(t,xt.set(0,n,0))),l=e.sample(mt.addVectors(t,xt.set(0,0,n)))-e.sample(mt.subVectors(t,xt.set(0,0,n)));this.n.set(a,i,l).normalize()}}]),e}(),vt=new pt,gt=new xe,kt=new xe,ht=function(){function e(t,n,a){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,l=4<arguments.length&&void 0!==arguments[4]?arguments[4]:3;oe(this,e),this.edgeData=t,this.cellPosition=n,this.cellSize=a,this.indices=null,this.zeroCrossings=null,this.normals=null,this.axes=null,this.lengths=null,this.result=new Me,this.initialC=i,this.c=i,this.initialD=l,this.d=l,this.i=0,this.l=0,this.reset()}return re(e,[{key:\"reset\",value:function(){var e=this.edgeData,t=[],n=[],i=[],o=[],r=[],s=void 0,y=void 0,u=void 0,m=void 0;for(this.i=0,this.c=0,this.d=0,(y=this.initialC,s=4>>y,u=this.initialD);y<u;++y,s>>=1)m=e.indices[y].length,0<m&&(t.push(e.indices[y]),n.push(e.zeroCrossings[y]),i.push(e.normals[y]),o.push(je[s]),r.push(m),++this.d);return this.l=0<r.length?r[0]:0,this.indices=t,this.zeroCrossings=n,this.normals=i,this.axes=o,this.lengths=r,this.result.reset(),this}},{key:\"next\",value:function(){var e=this.cellSize,t=this.edgeData.resolution,n=t+1,a=n*n,l=this.result,o=this.cellPosition,r=void 0,s=void 0,d=void 0,u=void 0,m=void 0,p=void 0,v=void 0;return this.i===this.l&&(this.l=++this.c<this.d?this.lengths[this.c]:0,this.i=0),this.i<this.l?(p=this.c,v=this.i,r=this.axes[p],s=this.indices[p][v],vt.index=s,d=s%n,u=U(s%a/n),m=U(s/a),vt.coordinates.set(d,u,m),gt.set(d*e/t,u*e/t,m*e/t),kt.set((d+r[0])*e/t,(u+r[1])*e/t,(m+r[2])*e/t),vt.a.addVectors(o,gt),vt.b.addVectors(o,kt),vt.t=this.zeroCrossings[p][v],vt.n.fromArray(this.normals[p],3*v),l.value=vt,++this.i):(l.value=null,l.done=!0),l}},{key:\"return\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),zt=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:n;oe(this,e),this.resolution=t,this.indices=0>=n?null:[new Uint32Array(n),new Uint32Array(a),new Uint32Array(i)],this.zeroCrossings=0>=n?null:[new Float32Array(n),new Float32Array(a),new Float32Array(i)],this.normals=0>=n?null:[new Float32Array(3*n),new Float32Array(3*a),new Float32Array(3*i)]}return re(e,[{key:\"serialize\",value:function(){return{resolution:this.resolution,edges:this.edges,zeroCrossings:this.zeroCrossings,normals:this.normals}}},{key:\"deserialize\",value:function(e){var t=this;return null===e?t=null:(this.resolution=e.resolution,this.edges=e.edges,this.zeroCrossings=e.zeroCrossings,this.normals=e.normals),t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=[this.edges[0],this.edges[1],this.edges[2],this.zeroCrossings[0],this.zeroCrossings[1],this.zeroCrossings[2],this.normals[0],this.normals[1],this.normals[2]],n=void 0,a=void 0,o=void 0;for(a=0,o=t.length;a<o;++a)n=t[a],null!==n&&e.push(n.buffer);return e}},{key:\"edges\",value:function(e,t){return new ht(this,e,t)}},{key:\"edgesX\",value:function(e,t){return new ht(this,e,t,0,1)}},{key:\"edgesY\",value:function(e,t){return new ht(this,e,t,1,2)}},{key:\"edgesZ\",value:function(e,t){return new ht(this,e,t,2,3)}}],[{key:\"calculate1DEdgeCount\",value:function(e){return j(e+1,2)*e}}]),e}(),ft={AIR:0,SOLID:1},St=0,Tt=0,wt=0,Pt=function(){function e(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];oe(this,e),this.materials=0,this.materialIndices=t?new Uint8Array(wt):null,this.runLengths=null,this.edgeData=null}return re(e,[{key:\"set\",value:function(e){return this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,this.edgeData=e.edgeData,this}},{key:\"clear\",value:function(){return this.materials=0,this.materialIndices=null,this.runLengths=null,this.edgeData=null,this}},{key:\"setMaterialIndex\",value:function(e,t){this.materialIndices[e]===ft.AIR?t!==ft.AIR&&++this.materials:t===ft.AIR&&--this.materials,this.materialIndices[e]=t}},{key:\"compress\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this,t=void 0;return this.compressed?(e.materialIndices=this.materialIndices,e.runLengths=this.runLengths):(t=this.full?new me([this.materialIndices.length],[ft.SOLID]):me.encode(this.materialIndices),e.materialIndices=new Uint8Array(t.data),e.runLengths=new Uint32Array(t.runLengths)),e.materials=this.materials,e}},{key:\"decompress\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this;return e.materialIndices=this.compressed?me.decode(this.runLengths,this.materialIndices,new Uint8Array(wt)):this.materialIndices,e.runLengths=null,e.materials=this.materials,e}},{key:\"serialize\",value:function(){return{materials:this.materials,materialIndices:this.materialIndices,runLengths:this.runLengths,edgeData:null===this.edgeData?null:this.edgeData.serialize()}}},{key:\"deserialize\",value:function(e){var t=this;return null===e?t=null:(this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,null===e.edgeData?this.edgeData=null:(null===this.edgeData&&(this.edgeData=new zt(Tt)),this.edgeData.deserialize(e.edgeData))),t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.edgeData&&this.edgeData.createTransferList(e),null!==this.materialIndices&&e.push(this.materialIndices.buffer),null!==this.runLengths&&e.push(this.runLengths.buffer),e}},{key:\"empty\",get:function(){return 0===this.materials}},{key:\"full\",get:function(){return this.materials===wt}},{key:\"compressed\",get:function(){return null!==this.runLengths}},{key:\"neutered\",get:function(){return!this.empty&&null===this.materialIndices}}],[{key:\"isovalue\",get:function(){return St},set:function(e){St=e}},{key:\"resolution\",get:function(){return Tt},set:function(e){e=j(2,ne(0,K(Math.log2(e)))),Tt=ne(1,te(256,e)),wt=j(Tt+1,3)}}]),e}(),It=function(){function e(){oe(this,e),this.ata=new Re,this.ata.set(0,0,0,0,0,0),this.atb=new xe,this.massPointSum=new xe,this.numPoints=0}return re(e,[{key:\"set\",value:function(e,t,n,a){return this.ata.copy(e),this.atb.copy(t),this.massPointSum.copy(n),this.numPoints=a,this}},{key:\"copy\",value:function(e){return this.set(e.ata,e.atb,e.massPointSum,e.numPoints)}},{key:\"add\",value:function(e,t){var n=t.x,a=t.y,i=t.z,l=e.dot(t),o=this.ata.elements,r=this.atb;o[0]+=n*n,o[1]+=n*a,o[3]+=a*a,o[2]+=n*i,o[4]+=a*i,o[5]+=i*i,r.x+=l*n,r.y+=l*a,r.z+=l*i,this.massPointSum.add(e),++this.numPoints}},{key:\"addData\",value:function(e){this.ata.add(e.ata),this.atb.add(e.atb),this.massPointSum.add(e.massPointSum),this.numPoints+=e.numPoints}},{key:\"clear\",value:function(){this.ata.set(0,0,0,0,0,0),this.atb.set(0,0,0),this.massPointSum.set(0,0,0),this.numPoints=0}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}}]),e}(),_t=new he,Ct=function(){function e(){oe(this,e)}return re(e,null,[{key:\"calculateCoefficients\",value:function(e,t,n){var a,i,l;return 0===t?(_t.x=1,_t.y=0):(a=(n-e)/(2*t),i=ae(1+a*a),l=1/(0<=a?a+i:a-i),_t.x=1/ae(1+l*l),_t.y=l*_t.x),_t}}]),e}(),bt=function(){function e(){oe(this,e)}return re(e,null,[{key:\"rotateXY\",value:function(e,t){var n=t.x,a=t.y,i=e.x,l=e.y;e.set(n*i-a*l,a*i+n*l)}},{key:\"rotateQXY\",value:function(e,t,n){var a=n.x,i=n.y,l=a*a,o=i*i,r=2*a*i*t,s=e.x,y=e.y;e.set(l*s-r+o*y,o*s+r+l*y)}}]),e}(),Et=.1,Ot=new Re,Dt=new Te,qt=new he,At=new xe,Vt=function(){function e(){oe(this,e)}return re(e,null,[{key:\"solve\",value:function(e,t,n){var a=w(Ot.copy(e),Dt.identity()),i=I(Dt,a);n.copy(t).applyMatrix3(i)}}]),e}(),Ft=new xe,Bt=function(){function e(){oe(this,e),this.data=null,this.ata=new Re,this.atb=new xe,this.massPoint=new xe,this.hasSolution=!1}return re(e,[{key:\"setData\",value:function(e){return this.data=e,this.hasSolution=!1,this}},{key:\"solve\",value:function(e){var t=this.data,n=this.massPoint,a=this.ata.copy(t.ata),i=this.atb.copy(t.atb),l=1/0;return!this.hasSolution&&null!==t&&0<t.numPoints&&(Ft.copy(t.massPointSum).divideScalar(t.numPoints),n.copy(Ft),a.applyToVector3(Ft),i.sub(Ft),Vt.solve(a,i,e),l=_(a,i,e),e.add(n),this.hasSolution=!0),l}}]),e}(),Nt=function e(){oe(this,e),this.materials=0,this.edgeCount=0,this.index=-1,this.position=new xe,this.normal=new xe,this.qefData=null},Lt=new Bt,Rt=.1,Yt=-1,Mt=function(e){function t(e,n){oe(this,t);var a=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return a.voxel=null,a}return ye(t,e),re(t,[{key:\"contains\",value:function(e){var t=this.min,n=this.size;return e.x>=t.x-Rt&&e.y>=t.y-Rt&&e.z>=t.z-Rt&&e.x<=t.x+n+Rt&&e.y<=t.y+n+Rt&&e.z<=t.z+n+Rt}},{key:\"collapse\",value:function(){var e=this.children,t=[-1,-1,-1,-1,-1,-1,-1,-1],n=new xe,a=-1,l=null!==e,o=0,r=void 0,s=void 0,y=void 0,d=void 0,u=void 0,c=void 0,m=void 0;if(l){for(d=new It,c=0,m=0;8>m;++m)r=e[m],o+=r.collapse(),y=r.voxel,null===r.children?null!==y&&(d.addData(y.qefData),a=1&y.materials>>7-m,t[m]=1&y.materials>>m,++c):l=!1;if(l&&(u=Lt.setData(d).solve(n),u<=Yt)){for(y=new Nt,y.position.copy(this.contains(n)?n:Lt.massPoint),m=0;8>m;++m)s=t[m],r=e[m],-1===s?y.materials|=a<<m:(y.materials|=s<<m,y.normal.add(r.voxel.normal));y.normal.normalize(),y.qefData=d,this.voxel=y,this.children=null,o+=c-1}}return o}}],[{key:\"errorThreshold\",get:function(){return Yt},set:function(e){Yt=e}}]),t}(Ge),Xt=function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;oe(this,e),this.action=t,this.error=null},Zt=function(){function e(t,n,a,i,l){oe(this,e),this.indices=t,this.positions=n,this.normals=a,this.uvs=i,this.materials=l}return re(e,[{key:\"serialize\",value:function(){return{indices:this.indices,positions:this.positions,normals:this.normals,uvs:this.uvs,materials:this.materials}}},{key:\"deserialize\",value:function(e){var t=this;return null===e?t=null:(this.indices=e.indices,this.positions=e.positions,this.normals=e.normals,this.uvs=e.uvs,this.materials=e.materials),t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.indices.buffer),e.push(this.positions.buffer),e.push(this.normals.buffer),e.push(this.uvs.buffer),e.push(this.materials.buffer),e}}]),e}(),jt=[new Uint8Array([0,4,0]),new Uint8Array([1,5,0]),new Uint8Array([2,6,0]),new Uint8Array([3,7,0]),new Uint8Array([0,2,1]),new Uint8Array([4,6,1]),new Uint8Array([1,3,1]),new Uint8Array([5,7,1]),new Uint8Array([0,1,2]),new Uint8Array([2,3,2]),new Uint8Array([4,5,2]),new Uint8Array([6,7,2])],Ut=[new Uint8Array([0,1,2,3,0]),new Uint8Array([4,5,6,7,0]),new Uint8Array([0,4,1,5,1]),new Uint8Array([2,6,3,7,1]),new Uint8Array([0,2,4,6,2]),new Uint8Array([1,3,5,7,2])],Qt=[[new Uint8Array([4,0,0]),new Uint8Array([5,1,0]),new Uint8Array([6,2,0]),new Uint8Array([7,3,0])],[new Uint8Array([2,0,1]),new Uint8Array([6,4,1]),new Uint8Array([3,1,1]),new Uint8Array([7,5,1])],[new Uint8Array([1,0,2]),new Uint8Array([3,2,2]),new Uint8Array([5,4,2]),new Uint8Array([7,6,2])]],Gt=[[new Uint8Array([1,4,0,5,1,1]),new Uint8Array([1,6,2,7,3,1]),new Uint8Array([0,4,6,0,2,2]),new Uint8Array([0,5,7,1,3,2])],[new Uint8Array([0,2,3,0,1,0]),new Uint8Array([0,6,7,4,5,0]),new Uint8Array([1,2,0,6,4,2]),new Uint8Array([1,3,1,7,5,2])],[new Uint8Array([1,1,0,3,2,0]),new Uint8Array([1,5,4,7,6,0]),new Uint8Array([0,1,5,0,4,1]),new Uint8Array([0,3,7,2,6,1])]],Ht=[[new Uint8Array([3,2,1,0,0]),new Uint8Array([7,6,5,4,0])],[new Uint8Array([5,1,4,0,1]),new Uint8Array([7,3,6,2,1])],[new Uint8Array([6,4,2,0,2]),new Uint8Array([7,5,3,1,2])]],Jt=[new Uint8Array([3,2,1,0]),new Uint8Array([7,5,6,4]),new Uint8Array([11,10,9,8])],Kt=function(){function e(){oe(this,e)}return re(e,null,[{key:\"run\",value:function(e){var t=[],n=e.voxelCount,a=null,i=null,l=null,o=null,r=null;return 65535<n?console.warn(\"Could not create geometry for cell at position\",e.min,\"(vertex count of\",n,\"exceeds limit of \",65535,\")\"):0<n&&(i=new Float32Array(3*n),l=new Float32Array(3*n),o=new Float32Array(2*n),r=new Uint8Array(n),A(e.root,i,l,0),D(e.root,t),a=new Zt(new Uint16Array(t),i,l,o,r)),a}}]),e}(),Wt=function(e){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xe,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;oe(this,t);var i=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.root=new Mt(n,a),i.voxelCount=0,null!==e&&null!==e.edgeData&&i.construct(e),0<=Mt.errorThreshold&&i.simplify(),i}return ye(t,e),re(t,[{key:\"simplify\",value:function(){this.voxelCount-=this.root.collapse()}},{key:\"construct\",value:function(e){var t=Pt.resolution,n=e.edgeData,a=e.materialIndices,l=new Bt,o=new xe,r=[n.edgesX(this.min,this.root.size),n.edgesY(this.min,this.root.size),n.edgesZ(this.min,this.root.size)],s=[new Uint8Array([0,1,2,3]),new Uint8Array([0,1,4,5]),new Uint8Array([0,2,4,6])],u=0,c=void 0,m=void 0,p=void 0,v=void 0,g=void 0,k=void 0,h=void 0,f=void 0,S=void 0,T=void 0,w=void 0;for(T=0;3>T;++T){p=s[T],c=r[T];var P=!0,I=!1,_=void 0;try{for(var C,b=c[Symbol.iterator]();!(P=(C=b.next()).done);P=!0)for(m=C.value,m.computeZeroCrossingPosition(o),w=0;4>w;++w)v=je[p[w]],h=m.coordinates.x-v[0],f=m.coordinates.y-v[1],S=m.coordinates.z-v[2],0<=h&&0<=f&&0<=S&&h<t&&f<t&&S<t&&(g=V(this.root,t,h,f,S),null===g.voxel&&(g.voxel=F(t,h,f,S,a),++u),k=g.voxel,k.normal.add(m.n),k.qefData.add(o,m.n),k.qefData.numPoints===k.edgeCount&&(l.setData(k.qefData).solve(k.position),!g.contains(k.position)&&k.position.copy(l.massPoint),k.normal.normalize()))}catch(e){I=!0,_=e}finally{try{!P&&b.return&&b.return()}finally{if(I)throw _}}}this.voxelCount=u}}]),t}(at),$t={EXTRACT:\"worker.extract\",MODIFY:\"worker.modify\",CONFIGURE:\"worker.config\",CLOSE:\"worker.close\"},en=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;oe(this,t);var n=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.data=null,n}return ye(t,e),t}(Xt),tn=function(e){function t(){oe(this,t);var e=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,$t.EXTRACT));return e.isosurface=null,e}return ye(t,e),t}(en),nn=new Pt(!1),an=function(){function e(){oe(this,e),this.data=null,this.response=null}return re(e,[{key:\"getData\",value:function(){return this.data}},{key:\"respond\",value:function(){return this.response.data=this.data.serialize(),this.response}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.data&&this.data.createTransferList(e),e}},{key:\"process\",value:function(e){return this.data=nn.deserialize(e.data),this}}]),e}(),ln=function(e){function t(){oe(this,t);var e=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.response=new tn,e.decompressionTarget=new Pt(!1),e.isosurface=null,e}return ye(t,e),re(t,[{key:\"respond\",value:function(){var e=se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"respond\",this).call(this);return e.isosurface=null===this.isosurface?null:this.isosurface.serialise(),e}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"createTransferList\",this).call(this,e),null===this.isosurface?e:this.isosurface.createTransferList(e)}},{key:\"process\",value:function(e){var n=se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"process\",this).call(this,e).getData(),a=new Wt(n.decompress(this.decompressionTarget));return this.isosurface=Kt.run(a),this.decompressionTarget.clear(),this}}]),t}(an),on={UNION:\"csg.union\",DIFFERENCE:\"csg.difference\",INTERSECTION:\"csg.intersection\",DENSITY_FUNCTION:\"csg.densityfunction\"},rn=function(){function e(t){oe(this,e),this.type=t;for(var n=arguments.length,a=Array(1<n?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];this.children=a,this.boundingBox=null}return re(e,[{key:\"getBoundingBox\",value:function(){return null===this.boundingBox&&(this.boundingBox=this.computeBoundingBox()),this.boundingBox}},{key:\"computeBoundingBox\",value:function(){var e=this.children,t=new v,n=void 0,a=void 0;for(n=0,a=e.length;n<a;++n)t.union(e[n].getBoundingBox());return t}}]),e}(),sn=function(e){function t(){var e;oe(this,t);for(var n=arguments.length,a=Array(n),i=0;i<n;i++)a[i]=arguments[i];return de(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this,on.UNION].concat(a)))}return ye(t,e),re(t,[{key:\"updateMaterialIndex\",value:function(e,t,n){var a=n.materialIndices[e];a!==ft.AIR&&t.setMaterialIndex(e,a)}},{key:\"selectEdge\",value:function(e,t,n){return n?e.t>t.t?e:t:e.t<t.t?e:t}}]),t}(rn),yn=function(e){function t(){var e;oe(this,t);for(var n=arguments.length,a=Array(n),i=0;i<n;i++)a[i]=arguments[i];return de(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this,on.DIFFERENCE].concat(a)))}return ye(t,e),re(t,[{key:\"updateMaterialIndex\",value:function(e,t,n){n.materialIndices[e]!==ft.AIR&&t.setMaterialIndex(e,ft.AIR)}},{key:\"selectEdge\",value:function(e,t,n){return n?e.t<t.t?e:t:e.t>t.t?e:t}}]),t}(rn),dn=function(e){function t(){var e;oe(this,t);for(var n=arguments.length,a=Array(n),i=0;i<n;i++)a[i]=arguments[i];return de(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this,on.INTERSECTION].concat(a)))}return ye(t,e),re(t,[{key:\"updateMaterialIndex\",value:function(e,t,n){var a=n.materialIndices[e];t.setMaterialIndex(e,t.materialIndices[e]!==ft.AIR&&a!==ft.AIR?a:ft.AIR)}},{key:\"selectEdge\",value:function(e,t,n){return n?e.t<t.t?e:t:e.t>t.t?e:t}}]),t}(rn),un=0,cn=new xe,mn=function(){function e(){oe(this,e)}return re(e,null,[{key:\"run\",value:function(e,t,n,a){cn.fromArray(e),un=t,null===n?a.operation===on.UNION&&(n=new Pt(!1)):n.decompress();var i=a.toCSG(),l=null===n?null:X(i);if(null!==l){switch(a.operation){case on.UNION:i=new sn(i);break;case on.DIFFERENCE:i=new yn(i);break;case on.INTERSECTION:i=new dn(i);}M(i,n,l),n.contoured=!1}return null!==n&&n.empty?null:n}}]),e}(),xn=function(e){function t(e){oe(this,t);var n=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,on.DENSITY_FUNCTION));return n.sdf=e,n}return ye(t,e),re(t,[{key:\"computeBoundingBox\",value:function(){return this.sdf.getBoundingBox(!0)}},{key:\"generateMaterialIndex\",value:function(e){return this.sdf.sample(e)<=Pt.isovalue?this.sdf.material:ft.AIR}},{key:\"generateEdge\",value:function(e){e.approximateZeroCrossing(this.sdf),e.computeSurfaceNormal(this.sdf)}}]),t}(rn),pn=new c,vn=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:ft.SOLID;oe(this,e),this.type=t,this.operation=null,this.material=te(255,ne(ft.SOLID,U(n))),this.boundingBox=null,this.position=new xe,this.quaternion=new Ie,this.scale=new xe(1,1,1),this.inverseTransformation=new c,this.updateInverseTransformation(),this.children=[]}return re(e,[{key:\"getTransformation\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new c;return e.compose(this.position,this.quaternion,this.scale)}},{key:\"getBoundingBox\",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t=this.children,n=this.boundingBox,a=void 0,o=void 0;if(null===n&&(n=this.computeBoundingBox(),this.boundingBox=n),e)for(n=n.clone(),a=0,o=t.length;a<o;++a)n.union(t[a].getBoundingBox(e));return n}},{key:\"setMaterial\",value:function(e){return this.material=te(255,ne(ft.SOLID,U(e))),this}},{key:\"setOperationType\",value:function(e){return this.operation=e,this}},{key:\"updateInverseTransformation\",value:function(){return this.inverseTransformation.getInverse(this.getTransformation(pn)),this.boundingBox=null,this}},{key:\"union\",value:function(e){return this.children.push(e.setOperationType(on.UNION)),this}},{key:\"subtract\",value:function(e){return this.children.push(e.setOperationType(on.DIFFERENCE)),this}},{key:\"intersect\",value:function(e){return this.children.push(e.setOperationType(on.INTERSECTION)),this}},{key:\"toCSG\",value:function(){var e=this.children,t=new xn(this),n=void 0,a=void 0,o=void 0,r=void 0;for(o=0,r=e.length;o<r;++o)a=e[o],n!==a.operation&&(n=a.operation,n===on.UNION?t=new sn(t):n===on.DIFFERENCE?t=new yn(t):n===on.INTERSECTION?t=new dn(t):void 0),t.children.push(a.toCSG());return t}},{key:\"serialize\",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t={type:this.type,operation:this.operation,material:this.material,position:this.position.toArray(),quaternion:this.quaternion.toArray(),scale:this.scale.toArray(),parameters:null,children:[]},n=void 0,a=void 0;for(n=0,a=this.children.length;n<a;++n)t.children.push(this.children[n].serialize(e));return t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e}},{key:\"toJSON\",value:function(){return this.serialize(!0)}},{key:\"computeBoundingBox\",value:function(){throw new Error(\"SignedDistanceFunction#computeBoundingBox method not implemented!\")}},{key:\"sample\",value:function(){throw new Error(\"SignedDistanceFunction#sample method not implemented!\")}}]),e}(),gn={HEIGHTFIELD:\"sdf.heightfield\",FRACTAL_NOISE:\"sdf.fractalnoise\",SUPER_PRIMITIVE:\"sdf.superprimitive\"},kn=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];oe(this,t);var a=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,gn.PERLIN_NOISE,n));return a.min=new(Function.prototype.bind.apply(xe,[null].concat(ce(e.min)))),a.max=new(Function.prototype.bind.apply(xe,[null].concat(ce(e.max)))),a}return ye(t,e),re(t,[{key:\"computeBoundingBox\",value:function(){return this.bbox=new v(this.min,this.max),this.bbox}},{key:\"sample\",value:function(){}},{key:\"serialize\",value:function(){var e=se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"serialize\",this).call(this);return e.parameters={min:this.min.toArray(),max:this.max.toArray()},e}}]),t}(vn),hn=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];oe(this,t);var a=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,gn.HEIGHTFIELD,n));return a.width=void 0===e.width?1:e.width,a.height=void 0===e.height?1:e.height,a.smooth=void 0===e.smooth||e.smooth,a.data=void 0===e.data?null:e.data,a.heightmap=null,void 0!==e.image&&a.fromImage(e.image),a}return ye(t,e),re(t,[{key:\"fromImage\",value:function(e){var t=\"undefined\"==typeof document?null:Z(e),n=null,a=void 0,o=void 0,r=void 0,s=void 0;if(null!==t){for(a=t.data,n=new Uint8ClampedArray(a.length/4),(o=0,r=0,s=n.length);o<s;++o,r+=4)n[o]=a[r];this.heightmap=e,this.width=t.width,this.height=t.height,this.data=n}return this}},{key:\"getHeight\",value:function(e,t){var n=this.width,i=this.height,l=this.data,o=void 0;if(e=J(e*n),t=J(t*i),this.smooth){e=ne(te(e,n-1),1),t=ne(te(t,i-1),1);var r=e+1,s=e-1,y=t*n,a=y+n,d=y-n;o=(l[d+s]+l[d+e]+l[d+r]+l[y+s]+l[y+e]+l[y+r]+l[a+s]+l[a+e]+l[a+r])/9}else o=l[t*n+e];return o}},{key:\"computeBoundingBox\",value:function(){var e=new v,t=te(this.width/this.height,1),n=te(this.height/this.width,1);return e.min.set(0,0,0),e.max.set(t,1,n),e.applyMatrix4(this.getTransformation()),e}},{key:\"sample\",value:function(e){var t=this.boundingBox,n=void 0;return t.containsPoint(e)?(e.applyMatrix4(this.inverseTransformation),n=e.y-this.getHeight(e.x,e.z)/255):n=t.distanceToPoint(e),n}},{key:\"serialize\",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],n=se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"serialize\",this).call(this);return n.parameters={width:this.width,height:this.height,smooth:this.smooth,data:e?null:this.data,dataURL:e&&null!==this.heightmap?this.heightmap.toDataURL():null,image:null},n}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.data.buffer),e}}]),t}(vn),zn=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];oe(this,t);var a=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,gn.SUPER_PRIMITIVE,n));return a.s0=new(Function.prototype.bind.apply(Ye,[null].concat(ce(e.s)))),a.r0=new(Function.prototype.bind.apply(xe,[null].concat(ce(e.r)))),a.s=new Ye,a.r=new xe,a.ba=new he,a.offset=0,a.precompute(),a}return ye(t,e),re(t,[{key:\"setSize\",value:function(e,t,n,a){return this.s0.set(e,t,n,a),this.precompute()}},{key:\"setRadii\",value:function(e,t,n){return this.r0.set(e,t,n),this.precompute()}},{key:\"precompute\",value:function(){var e=this.s.copy(this.s0),t=this.r.copy(this.r0),n=this.ba;e.x-=t.x,e.y-=t.x,t.x-=e.w,e.w-=t.y,e.z-=t.y,this.offset=-2*e.z,n.set(t.z,this.offset);var a=n.dot(n);return 0===a?n.set(0,-1):n.divideScalar(a),this}},{key:\"computeBoundingBox\",value:function(){var e=this.s0,t=new v;return t.min.x=te(-e.x,-1),t.min.y=te(-e.y,-1),t.min.z=te(-e.z,-1),t.max.x=ne(e.x,1),t.max.y=ne(e.y,1),t.max.z=ne(e.z,1),t.applyMatrix4(this.getTransformation()),t}},{key:\"sample\",value:function(e){e.applyMatrix4(this.inverseTransformation);var t=this.s,n=this.r,a=this.ba,i=$(e.x)-t.x,l=$(e.y)-t.y,o=$(e.z)-t.z,r=ne(i,0),s=ne(l,0),y=ae(r*r+s*s),d=e.z-t.z,u=$(y+te(0,ne(i,l))-n.x)-t.w,m=te(ne(u*a.x+d*a.y,0),1),c=u-n.z*m,x=d-this.offset*m,p=ne(u-n.z,0),v=e.z+t.z,g=ne(u,0),k=u*-a.y+d*a.x,h=ae(te(c*c+x*x,te(p*p+v*v,g*g+d*d)));return h*Q(ne(k,o))-n.y}},{key:\"serialize\",value:function(){var e=se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"serialize\",this).call(this);return e.parameters={s:this.s0.toArray(),r:this.r0.toArray()},e}}],[{key:\"create\",value:function(e){var n=fn[e];return new t({s:n[0],r:n[1]})}}]),t}(vn),fn=[[new Float32Array([1,1,1,1]),new Float32Array([0,0,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,0,0])],[new Float32Array([0,0,1,1]),new Float32Array([0,0,1])],[new Float32Array([1,1,2,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,.25,1]),new Float32Array([1,.25,0])],[new Float32Array([1,1,.25,.25]),new Float32Array([1,.25,0])],[new Float32Array([1,1,1,.25]),new Float32Array([1,.1,0])],[new Float32Array([1,1,1,.25]),new Float32Array([.1,.1,0])]],Sn=function(){function e(){oe(this,e)}return re(e,[{key:\"revive\",value:function(e){var t,n,a;switch(e.type){case gn.FRACTAL_NOISE:t=new kn(e.parameters,e.material);break;case gn.HEIGHTFIELD:t=new hn(e.parameters,e.material);break;case gn.SUPER_PRIMITIVE:t=new zn(e.parameters,e.material);}for(t.operation=e.operation,t.position.fromArray(e.position),t.quaternion.fromArray(e.quaternion),t.scale.fromArray(e.scale),t.updateInverseTransformation(),(n=0,a=e.children.length);n<a;++n)t.children.push(this.revive(e.children[n]));return t}}]),e}(),Tn=function(e){function t(){oe(this,t);var e=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,$t.MODIFY));return e.sdf=null,e}return ye(t,e),t}(en),wn=function(e){function t(){oe(this,t);var e=de(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.response=new Tn,e.sdf=null,e}return ye(t,e),re(t,[{key:\"respond\",value:function(){var e=se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"respond\",this).call(this);return e.sdf=null===this.sdf?null:this.sdf.serialize(),e}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"createTransferList\",this).call(this,e),null===this.sdf?e:this.sdf.createTransferList(e)}},{key:\"process\",value:function(e){var n=se(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"process\",this).call(this,e).getData(),a=this.sdf=Sn.revive(e.sdf),i=mn.run(e.cellPosition,e.cellSize,n,a);return ue(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),\"data\",null===i?null:i.compress(),this),this}}]),t}(an),Pn=new wn,In=new ln,_n=null;self.addEventListener(\"message\",function(e){var t=e.data;switch(_n=t.action,_n){case $t.MODIFY:postMessage(Pn.process(t).respond(),Pn.createTransferList());break;case $t.EXTRACT:postMessage(In.process(t).respond(),In.createTransferList());break;case $t.CONFIGURE:Pt.resolution=t.resolution,Mt.errorThreshold=t.errorThreshold;break;case $t.CLOSE:default:close();}}),self.addEventListener(\"error\",function(e){var t=_n===$t.MODIFY?Pn:_n===$t.EXTRACT?In:null,n=void 0;null===t?(n=new Xt($t.CLOSE),n.error=e,postMessage(n)):(n=t.respond(),n.action=$t.CLOSE,n.error=e,postMessage(n,t.createTransferList())),close()})})();\n"],{type:"text/javascript"})),n.maxWorkers=Ye(navigator.hardwareConcurrency,He(e,1)),n.workers=[],n.busyWorkers=new WeakSet,n.configurationMessage=new qa,n}return We(t,e),Ze(t,[{key:"handleEvent",value:function(e){switch(e.type){case"message":{this.busyWorkers.delete(e.target),Xa.worker=e.target,Xa.response=e.data,this.dispatchEvent(Xa),this.workers.length>this.maxWorkers&&this.closeWorker(e.target);break}case"error":{console.error("Encountered an unexpected error",e);break}}}},{key:"closeWorker",value:function(e){var t=this.workers.indexOf(e);this.busyWorkers.has(e)?(this.busyWorkers.delete(e),e.terminate()):e.postMessage(new Ra(Fa.CLOSE)),e.removeEventListener("message",this),e.removeEventListener("error",this),0<=t&&this.workers.splice(t,1)}},{key:"createWorker",value:function(){var e=new Worker(this.workerURL);return this.workers.push(e),e.addEventListener("message",this),e.addEventListener("error",this),e.postMessage(this.configurationMessage),e}},{key:"getWorker",value:function(){var e=null,t=void 0,n=void 0;for(t=0,n=this.workers.length;t<n;++t)if(!this.busyWorkers.has(this.workers[t])){e=this.workers[t],this.busyWorkers.add(e);break}return null===e&&this.workers.length<this.maxWorkers&&null!==this.workerURL&&(e=this.createWorker(),this.busyWorkers.add(e)),e}},{key:"clear",value:function(){for(;0<this.workers.length;)this.closeWorker(this.workers.pop())}},{key:"dispose",value:function(){this.clear(),URL.revokeObjectURL(this.workerURL),this.workerURL=null}}]),t}(nt),Ga=function(e){function t(e){Ge(this,t);var n=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.octant=null,n.octantId=null,n.error=null,n}return We(t,e),t}(tt),Za=new Ga("modificationstart"),Ka=new Ga("modificationend"),Wa=new Ga("extractionstart"),Qa=new Ga("extractionend"),$a=new Ga("load"),Ja=new Ga("error"),er=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Ge(this,t);var n=void 0===e.world?{}:e.world;ji.resolution=void 0===e.resolution?32:e.resolution;var i=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.object=null,i.world=new Pa(n.cellSize,n.levels,n.keyDesign),i.clipmap=new Ba(i.world),i.clipmap.addEventListener("shellupdate",i),i.threadPool=new ja(e.workers),i.threadPool.addEventListener("message",i),i.tasks=new WeakMap,i.sdfLoader=new ra,i.sdfLoader.addEventListener("load",i),i.history=[],i.dtSq=i.world.getCellSize(),i}return We(t,e),Ze(t,[{key:"handleEvent",value:function(e){switch(e.type){case"shellupdate":break;case"message":break;case"load":this.revive(e.descriptions),this.dispatchEvent($a);}}},{key:"applyCSG",value:function(e){this.world.applyCSG(e),this.history.push(e)}},{key:"union",value:function(e){this.applyCSG(e.setOperationType(ii.UNION))}},{key:"subtract",value:function(e){this.applyCSG(e.setOperationType(ii.DIFFERENCE))}},{key:"intersect",value:function(e){this.applyCSG(e.setOperationType(ii.INTERSECTION))}},{key:"update",value:function(e){this.clipmap.position.distanceToSquared(e)>=this.dtSq&&this.clipmap.update(e)}},{key:"raycast",value:function(e){return this.world.raycast(e)}},{key:"clear",value:function(){this.world.clear(),this.clipmap.clear(),this.threadPool.clear(),this.sdfLoader.clear(),this.tasks=new WeakMap,this.history=[]}},{key:"dispose",value:function(){this.threadPool.dispose()}},{key:"revive",value:function(e){var t,n;for(t=0,n=e.length;t<n;++t)this.applyCSG(na.revive(e[t]))}},{key:"save",value:function(){return 0===this.history.length?null:URL.createObjectURL(new Blob([JSON.stringify(this.history)],{type:"text/json"}))}},{key:"load",value:function(e){var t=JSON.parse(e);this.clear(),this.sdfLoader.load(t)}}]),t}(nt),tr=function(){function e(t,n,i,a,r){Ge(this,e),this.indices=t,this.positions=n,this.normals=i,this.uvs=a,this.materials=r}return Ze(e,[{key:"serialize",value:function(){return{indices:this.indices,positions:this.positions,normals:this.normals,uvs:this.uvs,materials:this.materials}}},{key:"deserialize",value:function(e){var t=this;return null===e?t=null:(this.indices=e.indices,this.positions=e.positions,this.normals=e.normals,this.uvs=e.uvs,this.materials=e.materials),t}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.indices.buffer),e.push(this.positions.buffer),e.push(this.normals.buffer),e.push(this.uvs.buffer),e.push(this.materials.buffer),e}}]),e}(),nr=[new Uint8Array([0,4,0]),new Uint8Array([1,5,0]),new Uint8Array([2,6,0]),new Uint8Array([3,7,0]),new Uint8Array([0,2,1]),new Uint8Array([4,6,1]),new Uint8Array([1,3,1]),new Uint8Array([5,7,1]),new Uint8Array([0,1,2]),new Uint8Array([2,3,2]),new Uint8Array([4,5,2]),new Uint8Array([6,7,2])],ir=[new Uint8Array([0,1,2,3,0]),new Uint8Array([4,5,6,7,0]),new Uint8Array([0,4,1,5,1]),new Uint8Array([2,6,3,7,1]),new Uint8Array([0,2,4,6,2]),new Uint8Array([1,3,5,7,2])],ar=[[new Uint8Array([4,0,0]),new Uint8Array([5,1,0]),new Uint8Array([6,2,0]),new Uint8Array([7,3,0])],[new Uint8Array([2,0,1]),new Uint8Array([6,4,1]),new Uint8Array([3,1,1]),new Uint8Array([7,5,1])],[new Uint8Array([1,0,2]),new Uint8Array([3,2,2]),new Uint8Array([5,4,2]),new Uint8Array([7,6,2])]],rr=[[new Uint8Array([1,4,0,5,1,1]),new Uint8Array([1,6,2,7,3,1]),new Uint8Array([0,4,6,0,2,2]),new Uint8Array([0,5,7,1,3,2])],[new Uint8Array([0,2,3,0,1,0]),new Uint8Array([0,6,7,4,5,0]),new Uint8Array([1,2,0,6,4,2]),new Uint8Array([1,3,1,7,5,2])],[new Uint8Array([1,1,0,3,2,0]),new Uint8Array([1,5,4,7,6,0]),new Uint8Array([0,1,5,0,4,1]),new Uint8Array([0,3,7,2,6,1])]],or=[[new Uint8Array([3,2,1,0,0]),new Uint8Array([7,6,5,4,0])],[new Uint8Array([5,1,4,0,1]),new Uint8Array([7,3,6,2,1])],[new Uint8Array([6,4,2,0,2]),new Uint8Array([7,5,3,1,2])]],sr=[new Uint8Array([3,2,1,0]),new Uint8Array([7,5,6,4]),new Uint8Array([11,10,9,8])],lr=function(){function e(){Ge(this,e)}return Ze(e,null,[{key:"run",value:function(e){var t=[],n=e.voxelCount,i=null,a=null,r=null,o=null,s=null;return 65535<n?console.warn("Could not create geometry for cell at position",e.min,"(vertex count of",n,"exceeds limit of ",65535,")"):0<n&&(a=new Float32Array(3*n),r=new Float32Array(3*n),o=new Float32Array(2*n),s=new Uint8Array(n),ye(e.root,a,r,0),ce(e.root,t),i=new tr(new Uint16Array(t),a,r,o,s)),i}}]),e}(),ur=new nn,dr=function(){function e(){Ge(this,e)}return Ze(e,null,[{key:"calculateCoefficients",value:function(e,t,n){var i,a,r;return 0===t?(ur.x=1,ur.y=0):(i=(n-e)/(2*t),a=Me(1+i*i),r=1/(0<=i?i+a:i-a),ur.x=1/Me(1+r*r),ur.y=r*ur.x),ur}}]),e}(),cr=function(){function e(){Ge(this,e)}return Ze(e,null,[{key:"rotateXY",value:function(e,t){var n=t.x,i=t.y,a=e.x,r=e.y;e.set(n*a-i*r,i*a+n*r)}},{key:"rotateQXY",value:function(e,t,n){var i=n.x,a=n.y,r=i*i,o=a*a,s=2*i*a*t,l=e.x,u=e.y;e.set(r*l-s+o*u,o*l+s+r*u)}}]),e}(),yr=.1,hr=new wn,mr=new sn,pr=new nn,gr=new Qt,vr=function(){function e(){Ge(this,e)}return Ze(e,null,[{key:"solve",value:function(e,t,n){var i=ge(hr.copy(e),mr.identity()),a=ve(mr,i);n.copy(t).applyMatrix3(a)}}]),e}(),fr=new Qt,xr=function(){function e(){Ge(this,e),this.data=null,this.ata=new wn,this.atb=new Qt,this.massPoint=new Qt,this.hasSolution=!1}return Ze(e,[{key:"setData",value:function(e){return this.data=e,this.hasSolution=!1,this}},{key:"solve",value:function(e){var t=this.data,n=this.massPoint,i=this.ata.copy(t.ata),a=this.atb.copy(t.atb),r=1/0;return!this.hasSolution&&null!==t&&0<t.numPoints&&(fr.copy(t.massPointSum).divideScalar(t.numPoints),n.copy(fr),i.applyToVector3(fr),a.sub(fr),vr.solve(i,a,e),r=xe(i,a,e),e.add(n),this.hasSolution=!0),r}}]),e}(),kr=function(){function e(){Ge(this,e),this.ata=new wn,this.ata.set(0,0,0,0,0,0),this.atb=new Qt,this.massPointSum=new Qt,this.numPoints=0}return Ze(e,[{key:"set",value:function(e,t,n,i){return this.ata.copy(e),this.atb.copy(t),this.massPointSum.copy(n),this.numPoints=i,this}},{key:"copy",value:function(e){return this.set(e.ata,e.atb,e.massPointSum,e.numPoints)}},{key:"add",value:function(e,t){var n=t.x,i=t.y,a=t.z,r=e.dot(t),o=this.ata.elements,s=this.atb;o[0]+=n*n,o[1]+=n*i,o[3]+=i*i,o[2]+=n*a,o[4]+=i*a,o[5]+=a*a,s.x+=r*n,s.y+=r*i,s.z+=r*a,this.massPointSum.add(e),++this.numPoints}},{key:"addData",value:function(e){this.ata.add(e.ata),this.atb.add(e.atb),this.massPointSum.add(e.massPointSum),this.numPoints+=e.numPoints}},{key:"clear",value:function(){this.ata.set(0,0,0,0,0,0),this.atb.set(0,0,0),this.massPointSum.set(0,0,0),this.numPoints=0}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),_r=function e(){Ge(this,e),this.materials=0,this.edgeCount=0,this.index=-1,this.position=new Qt,this.normal=new Qt,this.qefData=null},zr=new xr,br=.1,wr=-1,Sr=function(e){function t(e,n){Ge(this,t);var i=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.voxel=null,i}return We(t,e),Ze(t,[{key:"contains",value:function(e){var t=this.min,n=this.size;return e.x>=t.x-br&&e.y>=t.y-br&&e.z>=t.z-br&&e.x<=t.x+n+br&&e.y<=t.y+n+br&&e.z<=t.z+n+br}},{key:"collapse",value:function(){var e=this.children,t=[-1,-1,-1,-1,-1,-1,-1,-1],n=new Qt,a=-1,r=null!==e,o=0,s=void 0,l=void 0,u=void 0,d=void 0,c=void 0,y=void 0,h=void 0;if(r){for(d=new kr,y=0,h=0;8>h;++h)s=e[h],o+=s.collapse(),u=s.voxel,null===s.children?null!==u&&(d.addData(u.qefData),a=1&u.materials>>7-h,t[h]=1&u.materials>>h,++y):r=!1;if(r&&(c=zr.setData(d).solve(n),c<=wr)){for(u=new _r,u.position.copy(this.contains(n)?n:zr.massPoint),h=0;8>h;++h)l=t[h],s=e[h],-1===l?u.materials|=a<<h:(u.materials|=l<<h,u.normal.add(s.voxel.normal));u.normal.normalize(),u.qefData=d,this.voxel=u,this.children=null,o+=y-1}}return o}}],[{key:"errorThreshold",get:function(){return wr},set:function(e){wr=e}}]),t}(gi),Er=function(e){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Qt,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;Ge(this,t);var a=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.root=new Sr(n,i),a.voxelCount=0,null!==e&&null!==e.edgeData&&a.construct(e),0<=Sr.errorThreshold&&a.simplify(),a}return We(t,e),Ze(t,[{key:"simplify",value:function(){this.voxelCount-=this.root.collapse()}},{key:"construct",value:function(e){var t=ji.resolution,n=e.edgeData,a=e.materialIndices,r=new xr,o=new Qt,s=[n.edgesX(this.min,this.root.size),n.edgesY(this.min,this.root.size),n.edgesZ(this.min,this.root.size)],l=[new Uint8Array([0,1,2,3]),new Uint8Array([0,1,4,5]),new Uint8Array([0,2,4,6])],u=0,c=void 0,h=void 0,m=void 0,p=void 0,g=void 0,v=void 0,f=void 0,k=void 0,_=void 0,b=void 0,w=void 0;for(b=0;3>b;++b){m=l[b],c=s[b];var S=!0,E=!1,A=void 0;try{for(var P=c[Symbol.iterator](),C;!(S=(C=P.next()).done);S=!0)for(h=C.value,h.computeZeroCrossingPosition(o),w=0;4>w;++w)p=hi[m[w]],f=h.coordinates.x-p[0],k=h.coordinates.y-p[1],_=h.coordinates.z-p[2],0<=f&&0<=k&&0<=_&&f<t&&k<t&&_<t&&(g=ke(this.root,t,f,k,_),null===g.voxel&&(g.voxel=_e(t,f,k,_,a),++u),v=g.voxel,v.normal.add(h.n),v.qefData.add(o,h.n),v.qefData.numPoints===v.edgeCount&&(r.setData(v.qefData).solve(v.position),!g.contains(v.position)&&v.position.copy(r.massPoint),v.normal.normalize()))}catch(e){E=!0,A=e}finally{try{!S&&P.return&&P.return()}finally{if(E)throw A}}}this.voxelCount=u}}]),t}(Si),Ar=0,Pr=new Qt,Cr=function(){function e(){Ge(this,e)}return Ze(e,null,[{key:"run",value:function(e,t,n,i){Pr.fromArray(e),Ar=t,null===n?i.operation===ii.UNION&&(n=new ji(!1)):n.decompress();var a=i.toCSG(),r=null===n?null:Pe(a);if(null!==r){switch(i.operation){case ii.UNION:a=new oi(a);break;case ii.DIFFERENCE:a=new si(a);break;case ii.INTERSECTION:a=new li(a);}Ae(a,n,r),n.contoured=!1}return null!==n&&n.empty?null:n}}]),e}(),Tr=new ji(!1),Or=function(){function e(){Ge(this,e),this.data=null,this.response=null}return Ze(e,[{key:"getData",value:function(){return this.data}},{key:"respond",value:function(){return this.response.data=this.data.serialize(),this.response}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.data&&this.data.createTransferList(e),e}},{key:"process",value:function(e){return this.data=Tr.deserialize(e.data),this}}]),e}(),Ir=function(e){function t(){Ge(this,t);var e=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.response=new Ua,e.decompressionTarget=new ji(!1),e.isosurface=null,e}return We(t,e),Ze(t,[{key:"respond",value:function(){var e=Ke(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"respond",this).call(this);return e.isosurface=null===this.isosurface?null:this.isosurface.serialise(),e}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return Ke(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"createTransferList",this).call(this,e),null===this.isosurface?e:this.isosurface.createTransferList(e)}},{key:"process",value:function(e){var n=Ke(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"process",this).call(this,e).getData(),i=new Er(n.decompress(this.decompressionTarget));return this.isosurface=lr.run(i),this.decompressionTarget.clear(),this}}]),t}(Or),Dr=function(e){function t(){Ge(this,t);var e=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.response=new Ha,e.sdf=null,e}return We(t,e),Ze(t,[{key:"respond",value:function(){var e=Ke(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"respond",this).call(this);return e.sdf=null===this.sdf?null:this.sdf.serialize(),e}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return Ke(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"createTransferList",this).call(this,e),null===this.sdf?e:this.sdf.createTransferList(e)}},{key:"process",value:function(e){var n=Ke(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"process",this).call(this,e).getData(),i=this.sdf=na.revive(e.sdf),a=Cr.run(e.cellPosition,e.cellSize,n,i);return $e(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"data",null===a?null:a.compress(),this),this}}]),t}(Or),Lr=function(t){function n(){Ge(this,n);var t=Qe(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"contouring"));return t.cellSize=1,t.cellPosition=new e.Vector3,t.cellPosition.subScalar(t.cellSize/2),t.sdfType=Wi.SUPER_PRIMITIVE,t.euler=new q,t.scale=new e.Vector3,t.superPrimitivePreset=ta.TORUS,t.heightfield=new $i,t.hermiteData=null,t.octreeHelper=new Kn,t.hermiteDataHelper=new Zn,t.box3Helper=new e.Box3Helper,t.material=new e.MeshPhysicalMaterial({color:37256,metalness:.23,roughness:.31,clearCoat:.94,clearCoatRoughness:.15,dithering:!0}),t.mesh=null,t.vertices=0,t.faces=0,t}return We(n,t),Ze(n,[{key:"createSVO",value:function(){var e=this.octreeHelper;e.octree=new Er(this.hermiteData,this.cellPosition,this.cellSize),e.update(),function(e){var t=e.children,n=void 0,a=void 0,r=void 0,o=void 0,s=void 0,l=void 0,u=void 0,d=void 0;for(s=0,u=t.length;s<u;++s)for(n=t[s],a=n.children,o=s+1<u?3158064:12267568,(l=0,d=a.length);l<d;++l)r=a[l],r.material.color.setHex(o)}(e)}},{key:"createHermiteData",value:function(){var e;switch(this.sdfType){case Wi.SUPER_PRIMITIVE:e=Ji.create(this.superPrimitivePreset),e.quaternion.setFromEuler(this.euler),e.scale.copy(this.scale);break;case Wi.HEIGHTFIELD:e=this.heightfield,e.position.set(-1,-.25,-1),e.quaternion.set(0,0,0,1),e.scale.set(2,.5,2);}return e.updateInverseTransformation(),this.box3Helper.box=e.getBoundingBox(),this.hermiteData=Cr.run(this.cellPosition.toArray(),this.cellSize,null,e.setOperationType(ii.UNION)),this.hermiteData}},{key:"contour",value:function(){var t=lr.run(this.octreeHelper.octree),n=void 0,i=void 0;null!==t&&(null!==this.mesh&&(this.mesh.geometry.dispose(),this.scene.remove(this.mesh)),i=new e.BufferGeometry,i.setIndex(new e.BufferAttribute(t.indices,1)),i.addAttribute("position",new e.BufferAttribute(t.positions,3)),i.addAttribute("normal",new e.BufferAttribute(t.normals,3)),n=new e.Mesh(i,this.material),this.vertices=t.positions.length/3,this.faces=t.indices.length/3,this.mesh=n,this.scene.add(n))}},{key:"load",value:function(){var t=this.assets,n=this.loadingManager,i=new e.CubeTextureLoader(n),a=new e.TextureLoader(n),r=["textures/skies/interstellar/px.jpg","textures/skies/interstellar/nx.jpg","textures/skies/interstellar/py.jpg","textures/skies/interstellar/ny.jpg","textures/skies/interstellar/pz.jpg","textures/skies/interstellar/nz.jpg"];return new Promise(function(e,o){0===t.size?(n.onError=o,n.onProgress=function(t,n,i){n===i&&e()},i.load(r,function(e){t.set("sky",e)}),a.load("textures/height/03.png",function(e){t.set("heightmap",e)})):e()})}},{key:"initialize",value:function(){var t=this.scene,n=this.assets,i=this.renderer;this.sdfType=Wi.SUPER_PRIMITIVE,this.euler.set(4.11,3.56,4.74,ln.XYZ),this.scale.set(.34,.47,.25),this.superPrimitivePreset=ta.TORUS;var a=new e.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,25);a.position.set(0,0,-2),this.camera=a;var r=new jn(a.position,a.quaternion,i.domElement);r.settings.pointer.lock=!1,r.settings.sensitivity.rotation=.00175,r.settings.sensitivity.translation=.425,r.settings.sensitivity.zoom=.2,r.settings.zoom.maxDistance=20,r.lookAt(t.position),this.controls=r,t.fog=new e.FogExp2(16053492,.075),i.setClearColor(t.fog.color),t.background=n.get("sky"),this.material.envMap=n.get("sky");var o=new e.AmbientLight(4210752),s=new e.DirectionalLight(16759722);s.position.set(-.5,1.5,1),s.target.position.copy(t.position),t.add(s),t.add(o),this.heightfield.fromImage(n.get("heightmap").image),ji.resolution=64,Zn.air=ai.AIR,Sr.errorThreshold=.005,this.createHermiteData(),this.octreeHelper.visible=!0,t.add(this.octreeHelper),t.add(this.hermiteDataHelper),t.add(this.box3Helper),this.createSVO();var l=new e.Box3,u=this.cellSize/2;l.min.set(-u,-u,-u),l.max.set(u,u,u);var d=new e.Box3Helper(l,3158064);d.material.transparent=!0,d.material.opacity=.25,t.add(d)}},{key:"render",value:function(e){this.controls.update(e),Ke(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"render",this).call(this,e)}},{key:"registerOptions",value:function(e){var t=this,n=this.octreeHelper,i=this.hermiteDataHelper,a=this.box3Helper,r=Object.keys(ta).concat(["HEIGHTFIELD"]),o={SDF:r[this.superPrimitivePreset],color:this.material.color.getHex(),"level mask":n.children.length,"show SVO":function(){"HEIGHTFIELD"===o.SDF?t.sdfType=Wi.HEIGHTFIELD:(t.superPrimitivePreset=ta[o.SDF],t.sdfType=Wi.SUPER_PRIMITIVE),t.createHermiteData(),t.createSVO(),null!==t.mesh&&t.scene.remove(t.mesh),i.dispose(),n.visible=!0,a.visible=!0,o["level mask"]=n.children.length},"show Hermite data":function(){i.set(t.cellPosition,t.cellSize,t.hermiteData);try{i.update(),i.visible=!0,n.visible=!1,a.visible=!1}catch(t){console.error(t)}},contour:function(){t.createHermiteData(),t.createSVO(),t.contour(),n.visible=!1,i.visible=!1,a.visible=!1}};e.add(o,"SDF",r).onChange(o["show SVO"]);var s=e.addFolder("Octree Helper");s.add(o,"level mask").min(0).max(8).step(1).onChange(function(){var e,t;for(e=0,t=n.children.length;e<t;++e)n.children[e].visible=o["level mask"]>=n.children.length||e===o["level mask"]}).listen(),s=e.addFolder("Transformation");var l=s.addFolder("Rotation");l.add(this.euler,"x").min(0).max(2*Le).step(1e-4),l.add(this.euler,"y").min(0).max(2*Le).step(1e-4),l.add(this.euler,"z").min(0).max(2*Le).step(1e-4),l=s.addFolder("Scale"),l.add(this.scale,"x").min(0).max(.5).step(1e-4),l.add(this.scale,"y").min(0).max(.5).step(1e-4),l.add(this.scale,"z").min(0).max(.5).step(1e-4),s=e.addFolder("Material"),s.add(this.material,"metalness").min(0).max(1).step(1e-4),s.add(this.material,"roughness").min(0).max(1).step(1e-4),s.add(this.material,"clearCoat").min(0).max(1).step(1e-4),s.add(this.material,"clearCoatRoughness").min(0).max(1).step(1e-4),s.add(this.material,"reflectivity").min(0).max(1).step(1e-4),s.addColor(o,"color").onChange(function(){return t.material.color.setHex(o.color)}),s.add(this.material,"wireframe"),s.add(this.material,"flatShading").onChange(function(){t.material.needsUpdate=!0}),e.add(ji,"resolution",[32,64,128]),e.add(Sr,"errorThreshold").min(0).max(.01).step(1e-4),e.add(o,"show SVO"),e.add(o,"show Hermite data"),e.add(o,"contour"),s=e.addFolder("Render Info"),s.add(this,"vertices").listen(),s.add(this,"faces").listen()}}]),n}(et),Br=function(e){function t(e){Ge(this,t);var n=Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.qefData=null,n}return We(t,e),t}(tt),Fr=new e.Vector2,Rr=new tt("update"),Mr=function(t){function n(t,i,a,r){var o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:document.body;Ge(this,n);var s=Qe(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return s.hermiteData=a,s.cellPosition=t,s.cellSize=i,s.camera=r,s.dom=o,s.raycaster=new e.Raycaster,s.gridPointMaterials=[new e.MeshBasicMaterial({color:10066329,depthWrite:!1,transparent:!0,opacity:.75}),new e.MeshBasicMaterial({color:13395558,depthWrite:!1,transparent:!0,opacity:.9})],s.selectedGridPoint=null,s.gridPoints=new e.Group,s.createGridPoints(),s}return We(n,t),Ze(n,[{key:"createGridPoints",value:function(){var t=this.gridPoints,i=this.cellSize,a=ji.resolution,n=this.cellPosition,r=new e.Vector3,o=new e.SphereBufferGeometry(.05,8,8),s=this.gridPointMaterials[0],l=void 0,u=void 0,d=void 0,c=void 0;for(c=0;c<=a;++c)for(r.z=c*i/a,d=0;d<=a;++d)for(r.y=d*i/a,u=0;u<=a;++u)r.x=u*i/a,l=new e.Mesh(o,s),l.position.copy(n).add(r),t.add(l)}},{key:"toggleMaterialIndex",value:function(e){var t=this.hermiteData,n=t.materialIndices,i=n[e]===ai.AIR?ai.SOLID:ai.AIR;t.setMaterialIndex(e,i)}},{key:"handleClick",value:function(e){var t=this.selectedGridPoint;e.preventDefault(),null!==t&&(this.toggleMaterialIndex(this.gridPoints.children.indexOf(t)),this.dispatchEvent(Rr))}},{key:"raycast",value:function(e){var t=this.raycaster;Fr.x=2*(e.clientX/window.innerWidth)-1,Fr.y=2*-(e.clientY/window.innerHeight)+1,t.setFromCamera(Fr,this.camera);var n=t.intersectObjects(this.gridPoints.children);null!==this.selectedGridPoint&&(this.selectedGridPoint.material=this.gridPointMaterials[0],this.selectedGridPoint=null),0<n.length&&(this.selectedGridPoint=n[0].object,this.selectedGridPoint.material=this.gridPointMaterials[1])}},{key:"handleEvent",value:function(e){switch(e.type){case"mousemove":this.raycast(e);break;case"click":this.handleClick(e);}}},{key:"setEnabled",value:function(e){var t=this.dom;e?(t.addEventListener("mousemove",this),t.addEventListener("click",this)):(t.removeEventListener("mousemove",this),t.removeEventListener("click",this))}},{key:"dispose",value:function(){this.setEnabled(!1)}},{key:"registerOptions",value:function(){}}]),n}(nt),Vr=new e.Vector2,Nr=new tt("update"),qr=function(t){function n(t,i,a,r){var o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:document.body;Ge(this,n);var s=Qe(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return s.hermiteData=a,s.cellPosition=t,s.cellSize=i,s.camera=r,s.dom=o,s.raycaster=new e.Raycaster,s.raycaster.linePrecision=.05,s.t=0,s.edgeMaterials=[new e.LineBasicMaterial({color:10066329}),new e.LineBasicMaterial({color:13395558})],s.planeMaterials=[new e.MeshBasicMaterial({color:11149824,side:e.DoubleSide,depthWrite:!1,transparent:!0,opacity:.2}),new e.MeshBasicMaterial({color:16776960,side:e.DoubleSide,depthWrite:!1,transparent:!0,opacity:.4})],s.selectedEdge=null,s.activeEdge=null,s.activePlane=null,s.edgeId=new e.Vector2,s.edges=new e.Group,s.planes=new e.Group,s.t=0,s.s=new e.Spherical,s}return We(n,t),Ze(n,[{key:"calculateEdgeId",value:function(e){var t=this.hermiteData.edgeData,n=t.indices,a=void 0,r=void 0;for(a=0;3>a&&(r=n[a].length,!(e<r));++a)e-=r;this.edgeId.set(a,e)}},{key:"clearEdges",value:function(){for(var e=this.edges,t=this.planes,n=void 0,i=void 0;0<e.children.length;)n=e.children[0],n.geometry.dispose(),e.remove(n);for(;0<t.children.length;)i=t.children[0],i.geometry.dispose(),t.remove(i);this.activeEdge=null,this.activePlane=null}},{key:"createEdges",value:function(){var t=this.edges,n=this.planes,i=this.edgeMaterials[0],a=this.planeMaterials[0],r=this.hermiteData.edgeData.edges(this.cellPosition,this.cellSize),o=new e.Vector3,s=void 0,l=void 0,u=void 0,d=void 0,c=void 0;this.clearEdges();var y=!0,h=!1,m=void 0;try{for(var p=r[Symbol.iterator](),g;!(y=(g=p.next()).done);y=!0)s=g.value,d=new e.BufferGeometry,c=new Float32Array(6),s.a.toArray(c),s.b.toArray(c,3),d.addAttribute("position",new e.BufferAttribute(c,3)),l=new e.Line(d,i),t.add(l),u=new e.Mesh(new e.PlaneBufferGeometry(2,2),a),u.position.copy(s.computeZeroCrossingPosition(o)),u.lookAt(o.add(s.n)),u.visible=!1,n.add(u)}catch(e){h=!0,m=e}finally{try{!y&&p.return&&p.return()}finally{if(h)throw m}}}},{key:"adoptEdgeData",value:function(){var t=this.hermiteData.edgeData,a=t.zeroCrossings,r=t.normals,o=this.edgeId.x,s=this.edgeId.y,i=new e.Vector3;this.t=a[o][s],this.s.setFromVector3(i.fromArray(r[o],3*s))}},{key:"updateEdgeData",value:function(){var t=this.activeEdge,r=this.activePlane,o=new e.Vector3,a=new e.Vector3,s=new e.Vector3,l=new e.Vector3,n=this.hermiteData.edgeData,u=n.zeroCrossings,c=n.normals,y=this.edgeId.x,d=this.edgeId.y;null!==t&&(o.fromArray(t.geometry.getAttribute("position").array),a.fromArray(t.geometry.getAttribute("position").array,3),s.copy(o).add(a.sub(o).multiplyScalar(this.t)),l.setFromSpherical(this.s).normalize(),r.position.copy(s),r.lookAt(s.add(l)),u[y][d]=this.t,l.toArray(c[y],3*d),this.dispatchEvent(Nr))}},{key:"handleClick",value:function(e){var t=this.selectedEdge;e.preventDefault();var n,i;null!==t&&(null!==this.activeEdge&&(this.activeEdge!==t&&(this.activeEdge.material=this.edgeMaterials[0]),this.activePlane.material=this.planeMaterials[0],this.activePlane.visible=!1),this.activeEdge===t?(this.t=0,this.s.phi=0,this.s.theta=0,this.activeEdge=null,this.activePlane=null):(n=this.edges.children.indexOf(t),i=this.planes.children[n],t.material=this.edgeMaterials[1],i.material=this.planeMaterials[1],i.visible=!0,this.activeEdge=t,this.activePlane=i,this.calculateEdgeId(n),this.adoptEdgeData()))}},{key:"raycast",value:function(e){var t=this.raycaster;Vr.x=2*(e.clientX/window.innerWidth)-1,Vr.y=2*-(e.clientY/window.innerHeight)+1,t.setFromCamera(Vr,this.camera);var n=t.intersectObjects(this.edges.children);null!==this.selectedEdge&&(this.selectedEdge!==this.activeEdge&&(this.selectedEdge.material=this.edgeMaterials[0]),this.selectedEdge=null),0<n.length&&(this.selectedEdge=n[0].object,this.selectedEdge.material=this.edgeMaterials[1])}},{key:"handleEvent",value:function(e){switch(e.type){case"mousemove":this.raycast(e);break;case"click":this.handleClick(e);}}},{key:"setEnabled",value:function(e){var t=this.dom;e?(t.addEventListener("mousemove",this),t.addEventListener("click",this)):(t.removeEventListener("mousemove",this),t.removeEventListener("click",this))}},{key:"dispose",value:function(){this.setEnabled(!1)}},{key:"registerOptions",value:function(e){var t=this,n=this.planes,i={"show planes":!1};e.add(i,"show planes").onChange(function(){var e=t.activePlane;n.traverse(function(t){t!==n&&t!==e&&(t.visible=i["show planes"])})});var a=e.addFolder("Edge Adjustment");a.add(this,"t").min(0).max(1).listen().step(1e-6).onChange(function(){null!==t.hermiteData.edgeData&&t.updateEdgeData()}),a.add(this.s,"phi").min(1e-6).max(Le-1e-6).step(1e-6).listen().onChange(function(){null!==t.hermiteData.edgeData&&t.updateEdgeData()}),a.add(this.s,"theta").min(1e-6).max(Le-1e-6).step(1e-6).listen().onChange(function(){null!==t.hermiteData.edgeData&&t.updateEdgeData()}),a.open()}}]),n}(nt),Ur=new Br("update"),Hr=function(t){function n(e,t,i,a){var r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:document.body;Ge(this,n);var o=Qe(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return o.hermiteData=i,o.cellPosition=e,o.cellSize=t,o.gridPointEditor=new Mr(e,t,i,a,r),o.gridPointEditor.addEventListener("update",o),o.gridPointEditor.setEnabled(!0),o.edgeEditor=new qr(e,t,i,a,r),o.edgeEditor.addEventListener("update",o),o.qefData=new kr,o}return We(n,t),Ze(n,[{key:"createEdgeData",value:function(){var e=ji.resolution,t=e+1,n=t*t,i=new Uint32Array([1,t,n]),r=this.hermiteData.materialIndices,o=new Ui(e,Ui.calculate1DEdgeCount(e)),s=void 0,l=void 0,u=void 0,h=void 0,m=void 0,p=void 0,g=void 0,v=void 0,f=void 0,k=void 0,_=void 0,b=void 0,w=void 0,S=void 0,E=void 0;for(v=4,p=0,g=0;3>g;v>>=1,p=0,++g){for(f=hi[v],s=o.indices[g],l=o.zeroCrossings[g],u=o.normals[g],w=S=E=e,(0===g?w=Ye(w,e-1):1===g?S=Ye(S,e-1):2===g?E=Ye(E,e-1):void 0,b=0);b<=E;++b)for(_=0;_<=S;++_)for(k=0;k<=w;++k)h=b*n+_*t+k,m=h+i[g],r[h]!==r[m]&&(s[p]=h,l[p]=.5,u[3*p]=f[0],u[3*p+1]=f[1],u[3*p+2]=f[2],++p);o.indices[g]=o.indices[g].slice(0,p),o.zeroCrossings[g]=o.zeroCrossings[g].slice(0,p),o.normals[g]=o.normals[g].slice(0,3*p)}this.hermiteData.edgeData=o}},{key:"updateQEFData",value:function(){var t=this.qefData,n=new e.Vector3,i=this.hermiteData.edgeData.edges(this.cellPosition,this.cellSize),a=void 0;t.clear();var r=!0,o=!1,s=void 0;try{for(var l=i[Symbol.iterator](),u;!(r=(u=l.next()).done);r=!0)a=u.value,a.computeZeroCrossingPosition(n),t.add(n,a.n)}catch(e){o=!0,s=e}finally{try{!r&&l.return&&l.return()}finally{if(o)throw s}}}},{key:"handleEvent",value:function(e){switch(e.type){case"update":{e.target===this.gridPointEditor&&(this.createEdgeData(),this.edgeEditor.createEdges()),1===ji.resolution&&this.updateQEFData(),Ur.qefData=this.qefData,this.dispatchEvent(Ur);break}}}},{key:"setEnabled",value:function(e){this.gridPointEditor.setEnabled(e),this.edgeEditor.setEnabled(e)}},{key:"dispose",value:function(){this.setEnabled(!1)}},{key:"registerOptions",value:function(e){var t=this,n={"edit mode":0};e.add(n,"edit mode",{materials:0,edges:1}).onChange(function(){var e=0===Number.parseInt(n["edit mode"]);t.gridPointEditor.setEnabled(e),t.edgeEditor.setEnabled(!e)}),this.edgeEditor.registerOptions(e)}},{key:"gridPoints",get:function(){return this.gridPointEditor.gridPoints}},{key:"edges",get:function(){return this.edgeEditor.edges}},{key:"planes",get:function(){return this.edgeEditor.planes}}]),n}(nt),Yr=function(t){function n(){Ge(this,n);var t=Qe(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"voxel"));return t.hermiteData=null,t.hermiteDataHelper=null,t.hermiteDataEditor=null,t.qefSolver=new xr,t.error="0.0000",t.result={x:"",y:"",z:""},t.vertex=new e.Mesh(new e.SphereBufferGeometry(.05,8,8),new e.MeshBasicMaterial({color:16746530})),t.vertex.visible=!1,t}return We(n,t),Ze(n,[{key:"solveQEF",value:function(e){var t=this.hermiteData,n=this.qefSolver,i=this.vertex,a=this.result;t.empty||t.full?i.visible&&(a.x="",a.y="",a.z="",i.visible=!1):(this.error=n.setData(e).solve(i.position).toFixed(4),i.visible=!0,a.x=i.position.x.toFixed(2),a.y=i.position.y.toFixed(2),a.z=i.position.z.toFixed(2))}},{key:"handleEvent",value:function(e){switch(e.type){case"update":{try{this.hermiteDataHelper.update(!0,!1)}catch(t){}this.solveQEF(e.qefData);break}}}},{key:"initialize",value:function(){var t=this.scene,n=this.renderer,i=new e.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,50);i.position.set(-2,1,2),this.camera=i;var a=new jn(i.position,i.quaternion,n.domElement);a.settings.pointer.lock=!1,a.settings.sensitivity.zoom=.1,a.settings.translation.enabled=!1,a.settings.zoom.maxDistance=40,a.lookAt(t.position),this.controls=a,t.fog=new e.FogExp2(16053492,.025),n.setClearColor(t.fog.color),ji.resolution=1,Zn.air=ai.AIR;var r=new e.Vector3(-.5,-.5,-.5);r.multiplyScalar(1);var o=new ji,s=new Zn(r,1,o,!0,!1);this.hermiteData=o,this.hermiteDataHelper=s,t.add(s);var l=new Hr(r,1,o,i,n.domElement);l.addEventListener("update",this),this.hermiteDataEditor=l,t.add(l.gridPoints),t.add(l.edges),t.add(l.planes);var u=1-.05;t.add(new e.Mesh(new e.BoxBufferGeometry(u,u,u),new e.MeshBasicMaterial({color:13421772,depthWrite:!1,transparent:!0,opacity:.35}))),this.vertex.visible=!1,t.add(this.vertex)}},{key:"render",value:function(e){this.controls.update(e),Ke(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"render",this).call(this,e)}},{key:"registerOptions",value:function(e){var t=e.addFolder("Vertex Position");t.add(this.result,"x").listen(),t.add(this.result,"y").listen(),t.add(this.result,"z").listen(),t.add(this,"error").listen(),t.open(),this.hermiteDataEditor.registerOptions(e)}}]),n}(et),Xr=void 0;window.addEventListener("load",function t(){this.removeEventListener("load",t);var n=document.getElementById("viewport"),i=new e.WebGLRenderer({logarithmicDepthBuffer:!0,antialias:!0});i.setSize(n.clientWidth,n.clientHeight),i.setPixelRatio(window.devicePixelRatio),i.setClearColor(0),Xr=new Kt(n,{aside:document.getElementById("aside"),renderer:i}),Xr.addEventListener("change",Te),Xr.addEventListener("load",Oe),Xr.addDemo(new Lr),Xr.addDemo(new Yr),Ce()}),window.addEventListener("resize",function(){function e(e){var n=e.target.innerWidth,i=e.target.innerHeight;Xr.setSize(n,i),t=0}var t=0;return function(n){0===t&&(t=setTimeout(e,66,n))}}()),document.addEventListener("keydown",function(e){var t=this.getElementById("aside");e.altKey&&null!==t&&(e.preventDefault(),t.style.visibility="hidden"===t.style.visibility?"visible":"hidden")})})(THREE);
