function _typeof2(e){return _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof2(e)}(function(e){'use strict';var $e=Math.log2,et=Math.trunc,tt=Math.sign,nt=Math.PI,at=Math.atan2,it=Math.acos,rt=Math.sqrt,st=Math.cos,ot=Math.sin,lt=Math.floor,ut=Math.ceil,dt=Math.abs,ct=Math.max,yt=Math.min,ht=Math.pow,mt=Math.round;function t(e){return t="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)},t(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0,a;n<t.length;n++)a=t[n],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function o(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}function k(e){return k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},k(e)}function _(e,t){return _=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_(e,t)}function w(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function S(){return S=w()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var a=Function.bind.apply(e,i),r=new a;return n&&_(r,n.prototype),r},S.apply(null,arguments)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e,t){return t&&("object"===_typeof2(t)||"function"==typeof t)?t:E(e)}function C(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=k(e),null!==e););return e}function P(e,t,n){return P="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var a=C(e,t);if(a){var i=Object.getOwnPropertyDescriptor(a,t);return i.get?i.get.call(n):i.value}},P(e,t,n||e)}function T(e,t,n,a){return T="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,n,a){var i=C(e,t),r;if(i){if(r=Object.getOwnPropertyDescriptor(i,t),r.set)return r.set.call(a,n),!0;if(!r.writable)return!1}if(r=Object.getOwnPropertyDescriptor(a,t),r){if(!r.writable)return!1;r.value=n,Object.defineProperty(a,t,r)}else h(a,t,n);return!0},T(e,t,n,a)}function I(e,t,n,a,i){var r=T(e,t,n,a||e);if(!r&&i)throw new Error("failed to set property");return n}function D(e){return O(e)||L(e)||F()}function O(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function L(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function F(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function M(e,t){var n=e.__state.conversionName.toString(),i=mt(e.r),r=mt(e.g),o=mt(e.b),l=e.a,a=mt(e.h),u=e.s.toFixed(1),s=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var d=e.hex.toString(16);6>d.length;)d="0"+d;return"#"+d}return"CSS_RGB"===n?"rgb("+i+","+r+","+o+")":"CSS_RGBA"===n?"rgba("+i+","+r+","+o+","+l+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+i+","+r+","+o+"]":"RGBA_ARRAY"===n?"["+i+","+r+","+o+","+l+"]":"RGB_OBJ"===n?"{r:"+i+",g:"+r+",b:"+o+"}":"RGBA_OBJ"===n?"{r:"+i+",g:"+r+",b:"+o+",a:"+l+"}":"HSV_OBJ"===n?"{h:"+a+",s:"+u+",v:"+s+"}":"HSVA_OBJ"===n?"{h:"+a+",s:"+u+",v:"+s+",a:"+l+"}":"unknown format"}function B(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(Ot.recalculateRGB(this,t,n),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(Ot.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function R(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(Ot.recalculateHSV(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(Ot.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}function V(e){if("0"===e||kt.isUndefined(e))return 0;var t=e.match(Mt);return kt.isNull(t)?0:parseFloat(t[1])}function N(e){var t=e.toString();return-1<t.indexOf(".")?t.length-t.indexOf(".")-1:0}function U(e,t){var n=ht(10,t);return mt(e*n)/n}function Y(e,t,n,a,i){return a+(i-a)*((e-t)/(n-t))}function X(e,t,n,a){e.style.background="",kt.each(Ht,function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+n+" 0%, "+a+" 100%); "})}function j(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}function H(e,t,n){var a=document.createElement("li");return t&&a.appendChild(t),n?e.__ul.insertBefore(a,n):e.__ul.appendChild(a),e.onResize(),a}function G(e){Bt.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&Bt.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function Z(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function W(e,t,n){if(n.__li=t,n.__gui=e,kt.extend(n,{options:function(t){if(1<arguments.length){var a=n.__li.nextElementSibling;return n.remove(),Q(e,n.object,n.property,{before:a,factoryArgs:[kt.toArray(arguments)]})}if(kt.isArray(t)||kt.isObject(t)){var i=n.__li.nextElementSibling;return n.remove(),Q(e,n.object,n.property,{before:i,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof Yt){var a=new qt(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});kt.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(e){var t=n[e],i=a[e];n[e]=a[e]=function(){var e=Array.prototype.slice.call(arguments);return i.apply(a,e),t.apply(n,e)}}),Bt.addClass(t,"has-slider"),n.domElement.insertBefore(a.domElement,n.domElement.firstElementChild)}else if(n instanceof qt){var i=function(t){if(kt.isNumber(n.__min)&&kt.isNumber(n.__max)){var a=n.__li.firstElementChild.firstElementChild.innerHTML,i=-1<n.__gui.__listening.indexOf(n);n.remove();var r=Q(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return r.name(a),i&&r.listen(),r}return t};n.min=kt.compose(i,n.min),n.max=kt.compose(i,n.max)}else n instanceof Rt?(Bt.bind(t,"click",function(){Bt.fakeEvent(n.__checkbox,"click")}),Bt.bind(n.__checkbox,"click",function(t){t.stopPropagation()})):n instanceof Xt?(Bt.bind(t,"click",function(){Bt.fakeEvent(n.__button,"click")}),Bt.bind(t,"mouseover",function(){Bt.addClass(n.__button,"hover")}),Bt.bind(t,"mouseout",function(){Bt.removeClass(n.__button,"hover")})):n instanceof jt&&(Bt.addClass(t,"color"),n.updateDisplay=kt.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=kt.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&Z(e.getRoot(),!0),t},n.setValue)}function K(e,t){var n=e.getRoot(),a=n.__rememberedObjects.indexOf(t.object);if(-1!==a){var i=n.__rememberedObjectIndecesToControllers[a];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[a]=i),i[t.property]=t,n.load&&n.load.remembered){var r=n.load.remembered,s=void 0;if(r[e.preset])s=r[e.preset];else if(r.Default)s=r.Default;else return;if(s[a]&&void 0!==s[a][t.property]){var o=s[a][t.property];t.initialValue=o,t.setValue(o)}}}}function Q(e,t,n,a){if(void 0===t[n])throw new Error("Object \""+t+"\" has no property \""+n+"\"");var i;if(a.color)i=new jt(t,n);else{var r=[t,n].concat(a.factoryArgs);i=Gt.apply(e,r)}a.before instanceof Lt&&(a.before=a.before.__li),K(e,i),Bt.addClass(i.domElement,"c");var s=document.createElement("span");Bt.addClass(s,"property-name"),s.innerHTML=i.property;var o=document.createElement("div");o.appendChild(s),o.appendChild(i.domElement);var l=H(e,o,a.before);return Bt.addClass(l,on.CLASS_CONTROLLER_ROW),i instanceof jt?Bt.addClass(l,"color"):Bt.addClass(l,At(i.getValue())),W(e,l,i),e.__controllers.push(i),i}function J(e,t){return document.location.href+"."+t}function $(e,t,n){var a=document.createElement("option");a.innerHTML=t,a.value=t,e.__preset_select.appendChild(a),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function ee(e,t){t.style.display=e.useLocalStorage?"block":"none"}function te(e){var t=e.__save_row=document.createElement("li");Bt.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),Bt.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",Bt.addClass(n,"button gears");var a=document.createElement("span");a.innerHTML="Save",Bt.addClass(a,"button"),Bt.addClass(a,"save");var i=document.createElement("span");i.innerHTML="New",Bt.addClass(i,"button"),Bt.addClass(i,"save-as");var r=document.createElement("span");r.innerHTML="Revert",Bt.addClass(r,"button"),Bt.addClass(r,"revert");var s=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?kt.each(e.load.remembered,function(t,n){$(e,n,n===e.preset)}):$(e,"Default",!1),Bt.bind(s,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(s),t.appendChild(n),t.appendChild(a),t.appendChild(i),t.appendChild(r),en){var o=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage"),u=document.getElementById("dg-save-locally");u.style.display="block","true"===localStorage.getItem(J(e,"isLocal"))&&l.setAttribute("checked","checked"),ee(e,o),Bt.bind(l,"change",function(){e.useLocalStorage=!e.useLocalStorage,ee(e,o)})}var d=document.getElementById("dg-new-constructor");Bt.bind(d,"keydown",function(t){t.metaKey&&(67===t.which||67===t.keyCode)&&tn.hide()}),Bt.bind(n,"click",function(){d.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),tn.show(),d.focus(),d.select()}),Bt.bind(a,"click",function(){e.save()}),Bt.bind(i,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),Bt.bind(r,"click",function(){e.revert()})}function ne(t){function n(n){return n.preventDefault(),t.width+=r-n.clientX,t.onResize(),r=n.clientX,!1}function a(){Bt.removeClass(t.__closeButton,on.CLASS_DRAG),Bt.unbind(window,"mousemove",n),Bt.unbind(window,"mouseup",a)}function i(i){return i.preventDefault(),r=i.clientX,Bt.addClass(t.__closeButton,on.CLASS_DRAG),Bt.bind(window,"mousemove",n),Bt.bind(window,"mouseup",a),!1}var r;t.__resize_handle=document.createElement("div"),kt.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),Bt.bind(t.__resize_handle,"mousedown",i),Bt.bind(t.__closeButton,"mousedown",i),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function ae(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function ie(e,t){var n={};return kt.each(e.__rememberedObjects,function(a,i){var r={},s=e.__rememberedObjectIndecesToControllers[i];kt.each(s,function(e,n){r[n]=t?e.initialValue:e.getValue()}),n[i]=r}),n}function re(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}function se(e){0!==e.length&&Zt.call(window,function(){se(e)}),kt.each(e,function(e){e.updateDisplay()})}function oe(e,t,n){return ct(yt(e,n),t)}function le(e,t,n,a,i,r){var s=0;return e>t&&e>n?(i<e&&(s|=2),r<e&&(s|=1)):t>n?(a<t&&(s|=4),r<t&&(s|=1)):(a<n&&(s|=4),i<n&&(s|=2)),s}function ue(e,t,n,a){var i=0,s;return t<n?(s=t,i=0):(s=n,i=1),a<s&&(i=2),r[e][i]}function de(e,t,n,a,i,r,s,o,l){var u=e.children,d,c,y,h;if(0<=i&&0<=r&&0<=s)if(null===u)l.push(e);else{c=.5*(t+i),y=.5*(n+r),h=.5*(a+s),d=le(t,n,a,c,y,h);do 0===d?(de(u[Ra],t,n,a,c,y,h,o,l),d=ue(d,c,y,h)):1===d?(de(u[1^Ra],t,n,h,c,y,s,o,l),d=ue(d,c,y,s)):2===d?(de(u[2^Ra],t,y,a,c,r,h,o,l),d=ue(d,c,r,h)):3===d?(de(u[3^Ra],t,y,h,c,r,s,o,l),d=ue(d,c,r,s)):4===d?(de(u[4^Ra],c,n,a,i,y,h,o,l),d=ue(d,i,y,h)):5===d?(de(u[5^Ra],c,n,h,i,y,s,o,l),d=ue(d,i,y,s)):6===d?(de(u[6^Ra],c,y,a,i,r,h,o,l),d=ue(d,i,r,h)):7===d?(de(u[7^Ra],c,y,h,i,r,s,o,l),d=8):void 0;while(8>d)}}function ce(e){var t=e.children,n=0,a,r,s;if(null!==t)for(a=0,r=t.length;a<r;++a)s=1+ce(t[a]),s>n&&(n=s);return n}function ye(e,t,n){var a=e.children,r,s;if(Na.min=e.min,Na.max=e.max,t.intersectsBox(Na))if(null!==a)for(r=0,s=a.length;r<s;++r)ye(a[r],t,n);else n.push(e)}function he(e,t,n,a){var r=e.children,s,o;if(n===t)a.push(e);else if(null!==r)for(++n,s=0,o=r.length;s<o;++s)he(r[s],t,n,a)}function me(e){var t=e.children,n=0,a,r;if(null!==t)for(a=0,r=t.length;a<r;++a)n+=me(t[a]);else null!==e.points&&(n=e.points.length);return n}function pe(e,t,n,a,r){var s=a.children,o=!1,u=!1,d,c;if(a.contains(e,n.bias)){if(null===s){if(null===a.points)a.points=[],a.data=[];else for(d=0,c=a.points.length;!o&&d<c;++d)o=a.points[d].equals(e);o?(a.data[d-1]=t,u=!0):a.points.length<n.maxPoints||r===n.maxDepth?(a.points.push(e.clone()),a.data.push(t),++n.pointCount,u=!0):(a.split(),a.redistribute(n.bias),s=a.children)}if(null!==s)for(++r,d=0,c=s.length;!u&&d<c;++d)u=pe(e,t,n,s[d],r)}return u}function ge(e,t,n,a){var r=n.children,s=null,o,u,d,c,y;if(n.contains(e,t.bias))if(null!==r)for(o=0,u=r.length;null===s&&o<u;++o)s=ge(e,t,r[o],n);else if(null!==n.points)for(d=n.points,c=n.data,(o=0,u=d.length);o<u;++o)if(d[o].equals(e)){y=u-1,s=c[o],o<y&&(d[o]=d[y],c[o]=c[y]),d.pop(),c.pop(),--t.pointCount,null!==a&&me(a)<=t.maxPoints&&a.merge();break}return s}function ve(e,t,n){var a=n.children,r=null,s,o,u;if(n.contains(e,t.bias))if(null!==a)for(s=0,o=a.length;null===r&&s<o;++s)r=ve(e,t,a[s]);else if(null!==n.points)for(u=n.points,s=0,o=u.length;null===r&&s<o;++s)e.equals(u[s])&&(r=n.data[s]);return r}function fe(e,t,n,a,r,s){var o=a.children,u=null,d,c,y;if(a.contains(e,n.bias))if(!a.contains(t,n.bias))u=ge(e,n,a,r),pe(t,u,n,r,s-1);else if(null!==o)for(++s,d=0,c=o.length;null===u&&d<c;++d)u=fe(e,t,n,o[d],a,s);else if(null!==a.points)for(y=a.points,d=0,c=y.length;d<c;++d)if(e.equals(y[d])){y[d].copy(t),u=a.data[d];break}return u}function xe(e,t,n,a){var r=null,s=t,o,u;if(null!==a.children){var d=a.children.map(function(t){return{octant:t,distance:t.distanceToCenterSquared(e)}}).sort(function(e,t){return e.distance-t.distance}),c,y;for(o=0,u=d.length;o<u&&(c=d[o].octant,!(c.contains(e,s)&&(y=xe(e,s,n,c),null!==y&&(s=y.distance,r=y,0===s))));++o);}else if(null!==a.points){var h=a.points,m=-1,p;for(o=0,u=h.length;o<u;++o)if(!h[o].equals(e))p=e.distanceTo(h[o]),p<s&&(s=p,m=o);else if(!n){s=0,m=o;break}0<=m&&(r={point:h[m],data:a.data[m],distance:s})}return r}function ke(e,t,n,a,r){var s=a.children,o,u;if(null!==s){var d;for(o=0,u=s.length;o<u;++o)d=s[o],d.contains(e,t)&&ke(e,t,n,d,r)}else if(null!==a.points){var c=a.points,y;for(o=0,u=c.length;o<u;++o)y=c[o],y.equals(e)?!n&&r.push({point:y.clone(),data:a.data[o]}):y.distanceToSquared(e)<=t*t&&r.push({point:y.clone(),data:a.data[o]})}}function ze(e){var t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=t.getContext("2d");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height)}function _e(e,t,n,a,r,s,o){var l,u,d,c,y,h;if(n.csg.add(t),0<o)for(--o,l=e.getGrid(o),u=e.getKeyDesign(),d=n.children,c=Ri[o],a<<=1,r<<=1,s<<=1,h=0;8>h;++h)0!=(d&1<<h)&&(y=Pa[h],Oi.set(a+y[0],r+y[1],s+y[2]),c.containsPoint(Oi)&&_e(e,t,l.get(u.packKey(Oi)),Oi.x,Oi.y,Oi.z,o))}function be(e,t,n,a,i,r){var s=0;return e>t&&e>n?(i<e&&(s|=2),r<e&&(s|=1)):t>n?(a<t&&(s|=4),r<t&&(s|=1)):(a<n&&(s|=4),i<n&&(s|=2)),s}function we(e,t,n,a){var i=0,r;return t<n?(r=t,i=0):(r=n,i=1),a<r&&(i=2),Yi[e][i]}function Se(e,t,n,a,r,s,o,l,u,d,c,y,h){var m,p,g,v,f,x,k,z,_,b,w;if(0<=d&&0<=c&&0<=y)if(m=e.getKeyDesign(),0===s||null!==t.isosurface)p=e.getCellSize(s),g=new Pi(t),g.id.set(s,m.packKey(Ni.set(n,a,r))),g.min.copy(Ni).multiplyScalar(p).add(e.min),g.max.copy(g.min).addScalar(p),h.push(g);else if(0<t.children){v=e.getGrid(--s),f=t.children,n<<=1,a<<=1,r<<=1,z=.5*(o+d),_=.5*(l+c),b=.5*(u+y),k=be(o,l,u,z,_,b);do switch(w=Xi^k,k){case 0:{0!=(f&1<<w)&&(x=Pa[w],Ni.set(n+x[0],a+x[1],r+x[2]),Se(e,v.get(m.packKey(Ni)),Ni.x,Ni.y,Ni.z,s,o,l,u,z,_,b,h)),k=we(k,z,_,b);break}case 1:{0!=(f&1<<w)&&(x=Pa[w],Ni.set(n+x[0],a+x[1],r+x[2]),Se(e,v.get(m.packKey(Ni)),Ni.x,Ni.y,Ni.z,s,o,l,b,z,_,y,h)),k=we(k,z,_,y);break}case 2:{0!=(f&1<<w)&&(x=Pa[w],Ni.set(n+x[0],a+x[1],r+x[2]),Se(e,v.get(m.packKey(Ni)),Ni.x,Ni.y,Ni.z,s,o,_,u,z,c,b,h)),k=we(k,z,c,b);break}case 3:{0!=(f&1<<w)&&(x=Pa[w],Ni.set(n+x[0],a+x[1],r+x[2]),Se(e,v.get(m.packKey(Ni)),Ni.x,Ni.y,Ni.z,s,o,_,b,z,c,y,h)),k=we(k,z,c,y);break}case 4:{0!=(f&1<<w)&&(x=Pa[w],Ni.set(n+x[0],a+x[1],r+x[2]),Se(e,v.get(m.packKey(Ni)),Ni.x,Ni.y,Ni.z,s,z,l,u,d,_,b,h)),k=we(k,d,_,b);break}case 5:{0!=(f&1<<w)&&(x=Pa[w],Ni.set(n+x[0],a+x[1],r+x[2]),Se(e,v.get(m.packKey(Ni)),Ni.x,Ni.y,Ni.z,s,z,l,b,d,_,y,h)),k=we(k,d,_,y);break}case 6:{0!=(f&1<<w)&&(x=Pa[w],Ni.set(n+x[0],a+x[1],r+x[2]),Se(e,v.get(m.packKey(Ni)),Ni.x,Ni.y,Ni.z,s,z,_,u,d,c,b,h)),k=we(k,d,c,b);break}case 7:{0!=(f&1<<w)&&(x=Pa[w],Ni.set(n+x[0],a+x[1],r+x[2]),Se(e,v.get(m.packKey(Ni)),Ni.x,Ni.y,Ni.z,s,z,_,b,d,c,y,h)),k=8;break}}while(8>k)}}function Ee(e,t,n,a,i){var r=l.min.set(0,0,0),s=l.max.subVectors(t.max,t.min),o=t.getDimensions(qi.min),u=qi.max.copy(o).multiplyScalar(.5),c=d.origin.copy(a.origin),y=d.direction.copy(a.direction),h,m,p,g,v,f,x,k,z;c.sub(t.getCenter(Ni)).add(u),Xi=0,0>y.x&&(c.x=o.x-c.x,y.x=-y.x,Xi|=4),0>y.y&&(c.y=o.y-c.y,y.y=-y.y,Xi|=2),0>y.z&&(c.z=o.z-c.z,y.z=-y.z,Xi|=1),h=1/y.x,m=1/y.y,p=1/y.z,g=(r.x-c.x)*h,v=(s.x-c.x)*h,f=(r.y-c.y)*m,x=(s.y-c.y)*m,k=(r.z-c.z)*p,z=(s.z-c.z)*p,Se(e,t.octant,n.x,n.y,n.z,e.getDepth(),g,f,k,v,x,z,i)}function Ae(e,t,n,a,r,s){var o,l,u,d,c,y,h;if(0<s){for(--s,o=e.getGrid(s),l=e.getKeyDesign(),u=t.children,n<<=1,a<<=1,r<<=1,h=0;8>h;++h)0!=(u&1<<h)&&(c=Pa[h],Hi.set(n+c[0],a+c[1],r+c[2]),y=l.packKey(Hi),d=o.get(y),o["delete"](y),Ae(e,d,Hi.x,Hi.y,Hi.z,s));t.children=0}}function Ce(e,t,n,a,r){var s,o,l,u;++r<e.levels&&(s=e.getGrid(r),o=Gi.calculateOffsetIndex(t,n,a),Hi.set(t>>>1,n>>>1,a>>>1),l=e.getKeyDesign().packKey(Hi),u=s.get(l),u.children&=~(1<<o),0===u.children&&(s["delete"](l),Ce(e,Hi.x,Hi.y,Hi.z,r)))}function Pe(e,t,n){var a=[-1,-1,-1,-1],r=[!1,!1,!1,!1],s=1/0,o=0,l=!1,u,d,c,y,h,m,p;for(p=0;4>p;++p)h=e[p],m=Er[t][p],u=Ta[m][0],d=Ta[m][1],c=1&h.voxel.materials>>u,y=1&h.voxel.materials>>d,h.size<s&&(s=h.size,o=p,l=c!==ka.AIR),a[p]=h.voxel.index,r[p]=c!==y;r[o]&&(l?(n.push(a[0]),n.push(a[3]),n.push(a[1]),n.push(a[0]),n.push(a[2]),n.push(a[3])):(n.push(a[0]),n.push(a[1]),n.push(a[3]),n.push(a[0]),n.push(a[3]),n.push(a[2])))}function Te(e,t,n){var a=[0,0,0,0],r,s,o,l;if(null!==e[0].voxel&&null!==e[1].voxel&&null!==e[2].voxel&&null!==e[3].voxel)Pe(e,t,n);else for(o=0;2>o;++o){for(a[0]=Sr[t][o][0],a[1]=Sr[t][o][1],a[2]=Sr[t][o][2],a[3]=Sr[t][o][3],r=[],l=0;4>l;++l)if(s=e[l],null!==s.voxel)r[l]=s;else if(null!==s.children)r[l]=s.children[a[l]];else break;4===l&&Te(r,Sr[t][o][4],n)}}function Ie(e,t,n){var a=[0,0,0,0],r=[[0,0,1,1],[0,1,0,1]],s,o,l,u,d,c;if(null!==e[0].children||null!==e[1].children){for(d=0;4>d;++d)a[0]=br[t][d][0],a[1]=br[t][d][1],s=[null===e[0].children?e[0]:e[0].children[a[0]],null===e[1].children?e[1]:e[1].children[a[1]]],Ie(s,br[t][d][2],n);for(d=0;4>d;++d){for(a[0]=wr[t][d][1],a[1]=wr[t][d][2],a[2]=wr[t][d][3],a[3]=wr[t][d][4],l=r[wr[t][d][0]],o=[],c=0;4>c;++c)if(u=e[l[c]],null!==u.voxel)o[c]=u;else if(null!==u.children)o[c]=u.children[a[c]];else break;4===c&&Te(o,wr[t][d][5],n)}}}function De(e,t){var n=e.children,a=[0,0,0,0],r,s,o;if(null!==n){for(o=0;8>o;++o)De(n[o],t);for(o=0;12>o;++o)a[0]=zr[o][0],a[1]=zr[o][1],r=[n[a[0]],n[a[1]]],Ie(r,zr[o][2],t);for(o=0;6>o;++o)a[0]=_r[o][0],a[1]=_r[o][1],a[2]=_r[o][2],a[3]=_r[o][3],s=[n[a[0]],n[a[1]],n[a[2]],n[a[3]]],Te(s,_r[o][4],t)}}function Oe(e,t,n,a){var r,s;if(null!==e.children)for(r=0;8>r;++r)a=Oe(e.children[r],t,n,a);else null!==e.voxel&&(s=e.voxel,s.index=a,t[3*a]=s.position.x,t[3*a+1]=s.position.y,t[3*a+2]=s.position.z,n[3*a]=s.normal.x,n[3*a+1]=s.normal.y,n[3*a+2]=s.normal.z,++a);return a}function Le(e,t){var n=e.elements,a=t.elements,i;0!==n[1]&&(i=Tr.calculateCoefficients(n[0],n[1],n[3]),Ir.rotateQXY(Fr.set(n[0],n[3]),n[1],i),n[0]=Fr.x,n[3]=Fr.y,Ir.rotateXY(Fr.set(n[2],n[4]),i),n[2]=Fr.x,n[4]=Fr.y,n[1]=0,Ir.rotateXY(Fr.set(a[0],a[3]),i),a[0]=Fr.x,a[3]=Fr.y,Ir.rotateXY(Fr.set(a[1],a[4]),i),a[1]=Fr.x,a[4]=Fr.y,Ir.rotateXY(Fr.set(a[2],a[5]),i),a[2]=Fr.x,a[5]=Fr.y)}function Fe(e,t){var n=e.elements,a=t.elements,i;0!==n[2]&&(i=Tr.calculateCoefficients(n[0],n[2],n[5]),Ir.rotateQXY(Fr.set(n[0],n[5]),n[2],i),n[0]=Fr.x,n[5]=Fr.y,Ir.rotateXY(Fr.set(n[1],n[4]),i),n[1]=Fr.x,n[4]=Fr.y,n[2]=0,Ir.rotateXY(Fr.set(a[0],a[6]),i),a[0]=Fr.x,a[6]=Fr.y,Ir.rotateXY(Fr.set(a[1],a[7]),i),a[1]=Fr.x,a[7]=Fr.y,Ir.rotateXY(Fr.set(a[2],a[8]),i),a[2]=Fr.x,a[8]=Fr.y)}function Me(e,t){var n=e.elements,a=t.elements,i;0!==n[4]&&(i=Tr.calculateCoefficients(n[3],n[4],n[5]),Ir.rotateQXY(Fr.set(n[3],n[5]),n[4],i),n[3]=Fr.x,n[5]=Fr.y,Ir.rotateXY(Fr.set(n[1],n[2]),i),n[1]=Fr.x,n[2]=Fr.y,n[4]=0,Ir.rotateXY(Fr.set(a[3],a[6]),i),a[3]=Fr.x,a[6]=Fr.y,Ir.rotateXY(Fr.set(a[4],a[7]),i),a[4]=Fr.x,a[7]=Fr.y,Ir.rotateXY(Fr.set(a[5],a[8]),i),a[5]=Fr.x,a[8]=Fr.y)}function Be(t,n){var a=t.elements,e;for(e=0;e<5;++e)Le(t,n),Fe(t,n),Me(t,n);return Mr.set(a[0],a[3],a[5])}function Re(e){var t=dt(e)<Dr?0:1/e;return dt(t)<Dr?0:t}function Ve(e,t){var n=e.elements,a=n[0],i=n[3],r=n[6],s=n[1],o=n[4],l=n[7],u=n[2],d=n[5],c=n[8],y=Re(t.x),h=Re(t.y),m=Re(t.z);return e.set(a*y*a+i*h*i+r*m*r,a*y*s+i*h*o+r*m*l,a*y*u+i*h*d+r*m*c,s*y*a+o*h*i+l*m*r,s*y*s+o*h*o+l*m*l,s*y*u+o*h*d+l*m*c,u*y*a+d*h*i+c*m*r,u*y*s+d*h*o+c*m*l,u*y*u+d*h*d+c*m*c)}function Ne(e,t,n){return e.applyToVector3(Rr.copy(n)),Rr.subVectors(t,Rr),Rr.dot(Rr)}function Ue(e,t,a,r,s){var o=0;for(t>>=1;0<t;t>>=1,o=0)a>=t&&(o+=4,a-=t),r>=t&&(o+=2,r-=t),s>=t&&(o+=1,s-=t),null===e.children&&e.split(),e=e.children[o];return e}function qe(e,t,n,a,r){var s=e+1,o=new Ur,l,u,d,c,y,h,m,p,g,v;for(l=0,v=0;8>v;++v)c=Pa[v],y=(a+c[2])*(s*s)+(n+c[1])*s+(t+c[0]),d=yt(r[y],ka.SOLID),l|=d<<v;for(u=0,v=0;12>v;++v)h=Ta[v][0],m=Ta[v][1],p=1&l>>h,g=1&l>>m,p!==g&&++u;return o.materials=l,o.edgeCount=u,o.qefData=new Nr,o}function Ye(e){var t=Gr,a=oi.resolution,n=new mn(0,0,0),i=new mn(a,a,a),r=new v(Zr,Zr.clone().addScalar(Gr)),s=e.getBoundingBox();return e.type!==xa.INTERSECTION&&(s.intersectsBox(r)?(n.copy(s.min).max(r.min).sub(r.min),n.x=ut(n.x*a/t),n.y=ut(n.y*a/t),n.z=ut(n.z*a/t),i.copy(s.max).min(r.max).sub(r.min),i.x=lt(i.x*a/t),i.y=lt(i.y*a/t),i.z=lt(i.z*a/t)):(n.set(a,a,a),i.set(0,0,0))),new v(n,i)}function Xe(e,t,a,i){var r=oi.resolution,n=r+1,s=i.max.x,o=i.max.y,l=i.max.z,u,d,c;for(c=i.min.z;c<=l;++c)for(d=i.min.y;d<=o;++d)for(u=i.min.x;u<=s;++u)e.updateMaterialIndex(c*(n*n)+d*n+u,t,a)}function je(e,t,a){var i=Gr,r=oi.resolution,n=r+1,s=t.materialIndices,o=new mn,l=new mn,u=a.max.x,d=a.max.y,c=a.max.z,h=0,m,p,g,v;for(v=a.min.z;v<=c;++v)for(o.z=v*i/r,g=a.min.y;g<=d;++g)for(o.y=g*i/r,p=a.min.x;p<=u;++p)o.x=p*i/r,m=e.generateMaterialIndex(l.addVectors(Zr,o)),m!==ka.AIR&&(s[v*(n*n)+g*n+p]=m,++h);t.materials=h}function He(e,t,a){var r=oi.resolution,n=r+1,s=new Uint32Array([1,n,n*n]),o=t.materialIndices,l=new Ja,u=new Ja,y=a.edgeData,h=t.edgeData,m=new Uint32Array(3),p=ai.calculate1DEdgeCount(r),g=new ai(r,yt(p,h.indices[0].length+y.indices[0].length),yt(p,h.indices[1].length+y.indices[1].length),yt(p,h.indices[2].length+y.indices[2].length)),v,f,x,k,z,_,b,w,S,E,A,C,P,T,I,D,O,L,F,M,B,R,V;for(L=0,F=0;3>F;L=0,++F){for(v=y.indices[F],k=h.indices[F],b=g.indices[F],f=y.zeroCrossings[F],z=h.zeroCrossings[F],w=g.zeroCrossings[F],x=y.normals[F],_=h.normals[F],S=g.normals[F],E=s[F],R=v.length,V=k.length,(M=0,B=0);M<R;++M)if(A=v[M],C=A+E,I=o[A],D=o[C],I!==D&&(I===ka.AIR||D===ka.AIR)){for(l.t=f[M],l.n.x=x[3*M],l.n.y=x[3*M+1],l.n.z=x[3*M+2],e.type===xa.DIFFERENCE&&l.n.negate(),O=l;B<V&&k[B]<=A;)P=k[B],T=P+E,u.t=z[B],u.n.x=_[3*B],u.n.y=_[3*B+1],u.n.z=_[3*B+2],I=o[P],P<A?(D=o[T],I!==D&&(I===ka.AIR||D===ka.AIR)&&(b[L]=P,w[L]=u.t,S[3*L]=u.n.x,S[3*L+1]=u.n.y,S[3*L+2]=u.n.z,++L)):O=e.selectEdge(u,l,I===ka.SOLID),++B;b[L]=A,w[L]=O.t,S[3*L]=O.n.x,S[3*L+1]=O.n.y,S[3*L+2]=O.n.z,++L}for(;B<V;)P=k[B],T=P+E,I=o[P],D=o[T],I!==D&&(I===ka.AIR||D===ka.AIR)&&(b[L]=P,w[L]=z[B],S[3*L]=_[3*B],S[3*L+1]=_[3*B+1],S[3*L+2]=_[3*B+2],++L),++B;m[F]=L}return{edgeData:g,lengths:m}}function Ge(e,t,i){var r=Gr,s=oi.resolution,n=s+1,o=n*n,l=new Uint32Array([1,n,o]),u=t.materialIndices,h=Zr,m=new mn,p=new mn,g=new Ja,v=new Uint32Array(3),f=new ai(s,ai.calculate1DEdgeCount(s)),k,_,b,w,S,E,A,C,P,T,I,D,O,L,F,M,B,R,V;for(F=4,O=0,L=0;3>L;F>>=1,O=0,++L){M=Pa[F],k=f.indices[L],_=f.zeroCrossings[L],b=f.normals[L],w=l[L],A=i.min.x,T=i.max.x,C=i.min.y,I=i.max.y,P=i.min.z,D=i.max.z;for(0===L?(A=ct(A-1,0),T=yt(T,s-1)):1===L?(C=ct(C-1,0),I=yt(I,s-1)):2===L?(P=ct(P-1,0),D=yt(D,s-1)):void 0,V=P;V<=D;++V)for(R=C;R<=I;++R)for(B=A;B<=T;++B)S=V*o+R*n+B,E=S+w,u[S]!==u[E]&&(m.set(B*r/s,R*r/s,V*r/s),p.set((B+M[0])*r/s,(R+M[1])*r/s,(V+M[2])*r/s),g.a.addVectors(h,m),g.b.addVectors(h,p),e.generateEdge(g),k[O]=S,_[O]=g.t,b[3*O]=g.n.x,b[3*O+1]=g.n.y,b[3*O+2]=g.n.z,++O);v[L]=O}return{edgeData:f,lengths:v}}function Ze(e,t,n){var a=Ye(e),i=!1,r,s,o,l;if(e.type===xa.DENSITY_FUNCTION?je(e,t,a):t.empty?e.type===xa.UNION&&(t.set(n),i=!0):!(t.full&&e.type===xa.UNION)&&Xe(e,t,n,a),!i&&!t.empty&&!t.full){for(r=e.type===xa.DENSITY_FUNCTION?Ge(e,t,a):He(e,t,n),s=r.edgeData,o=r.lengths,l=0;3>l;++l)s.indices[l]=s.indices[l].slice(0,o[l]),s.zeroCrossings[l]=s.zeroCrossings[l].slice(0,o[l]),s.normals[l]=s.normals[l].slice(0,3*o[l]);t.edgeData=s}}function We(e){var t=e.children,n,a,r,s;for(e.type===xa.DENSITY_FUNCTION&&(n=new oi,Ze(e,n)),r=0,s=t.length;r<s&&(a=We(t[r]),void 0===n?n=a:null===a?e.type===xa.INTERSECTION&&(n=null):null===n?e.type===xa.UNION&&(n=a):Ze(e,n,a),null!==n||e.type===xa.UNION);++r);return null!==n&&n.empty?null:n}function Ke(e){requestAnimationFrame(Ke),cs.render(e)}function Qe(){document.getElementById("viewport").children[0].style.display="initial"}function Je(){document.getElementById("viewport").children[0].style.display="none"}var pt=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"demo";i(this,t),this.id=n,this.renderer=null,this.loadingManager=new e.LoadingManager,this.assets=new Map,this.scene=new e.Scene,this.camera=null,this.controls=null,this.ready=!1}return o(t,[{key:"setRenderer",value:function(e){return this.renderer=e,this}},{key:"load",value:function(){return Promise.resolve()}},{key:"initialize",value:function(){}},{key:"render",value:function(){this.renderer.render(this.scene,this.camera)}},{key:"registerOptions",value:function(){}},{key:"reset",value:function(){var t=this.scene.fog;return this.scene=new e.Scene,this.scene.fog=t,this.camera=null,null!==this.controls&&(this.controls.dispose(),this.controls=null),this.ready=!1,this}}]),t}(),gt=function e(t){i(this,e),this.type=t,this.target=null},vt=function(){function e(){i(this,e),this.listenerFunctions=new Map,this.listenerObjects=new Map}return o(e,[{key:"addEventListener",value:function(e,t){var n="function"==typeof t?this.listenerFunctions:this.listenerObjects;n.has(e)?n.get(e).add(t):n.set(e,new Set([t]))}},{key:"removeEventListener",value:function(e,t){var n="function"==typeof t?this.listenerFunctions:this.listenerObjects,a;n.has(e)&&(a=n.get(e),a["delete"](t),0===a.size&&n["delete"](e))}},{key:"dispatchEvent",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this,n=t.listenerFunctions,a=t.listenerObjects,i,r;if(e.target=t,n.has(e.type)){i=n.get(e.type);var s=!0,o=!1,l=void 0;try{for(var u=i[Symbol.iterator](),d;!(s=(d=u.next()).done);s=!0)r=d.value,r.call(t,e)}catch(e){o=!0,l=e}finally{try{s||null==u["return"]||u["return"]()}finally{if(o)throw l}}}if(a.has(e.type)){i=a.get(e.type);var c=!0,y=!1,h=void 0;try{for(var m=i[Symbol.iterator](),p;!(c=(p=m.next()).done);c=!0)r=p.value,r.handleEvent(e)}catch(e){y=!0,h=e}finally{try{c||null==m["return"]||m["return"]()}finally{if(y)throw h}}}}}]),e}(),ft=Array.prototype.forEach,xt=Array.prototype.slice,kt={BREAK:{},extend:function(e){return this.each(xt.call(arguments,1),function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))},this),e},defaults:function(e){return this.each(xt.call(arguments,1),function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))},this),e},compose:function(){var e=xt.call(arguments);return function(){for(var t=xt.call(arguments),n=e.length-1;0<=n;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,n){if(e)if(ft&&e.forEach&&e.forEach===ft)e.forEach(t,n);else if(e.length===e.length+0){var a=void 0,i=void 0;for(a=0,i=e.length;a<i;a++)if(a in e&&t.call(n,e[a],a)===this.BREAK)return}else for(var r in e)if(t.call(n,e[r],r)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var a;return function(){var i=this,r=arguments,s=n||!a;clearTimeout(a),a=setTimeout(function(){a=null,n||e.apply(i,r)},t),s&&e.apply(i,r)}},toArray:function(e){return e.toArray?e.toArray():xt.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return null===e},isNaN:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return isNaN(e)}),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},zt=[{litmus:kt.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:M},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:M},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:M},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:M}}},{litmus:kt.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:kt.isArray,conversions:{RGB_ARRAY:{read:function(e){return!(3!==e.length)&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return!(4!==e.length)&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:kt.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(kt.isNumber(e.r)&&kt.isNumber(e.g)&&kt.isNumber(e.b)&&kt.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(kt.isNumber(e.r)&&kt.isNumber(e.g)&&kt.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(kt.isNumber(e.h)&&kt.isNumber(e.s)&&kt.isNumber(e.v)&&kt.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(kt.isNumber(e.h)&&kt.isNumber(e.s)&&kt.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],_t=void 0,bt=void 0,wt=function(){bt=!1;var e=1<arguments.length?kt.toArray(arguments):arguments[0];return kt.each(zt,function(t){if(t.litmus(e))return kt.each(t.conversions,function(t,n){if(_t=t.read(e),!1===bt&&!1!==_t)return bt=_t,_t.conversionName=n,_t.conversion=t,kt.BREAK}),kt.BREAK}),bt},St=void 0,Et={hsv_to_rgb:function(e,n,a){var i=lt(e/60)%6,r=e/60-lt(e/60),s=a*(1-n),o=a*(1-r*n),l=a*(1-(1-r)*n),t=[[a,l,s],[o,a,s],[s,a,l],[s,o,a],[l,s,a],[a,s,o]][i];return{r:255*t[0],g:255*t[1],b:255*t[2]}},rgb_to_hsv:function(e,t,n){var a=yt(e,t,n),i=ct(e,t,n),r=i-a,o=void 0,l=void 0;if(0!==i)l=r/i;else return{h:NaN,s:0,v:0};return o=e===i?(t-n)/r:t===i?2+(n-e)/r:4+(e-t)/r,o/=6,0>o&&(o+=1),{h:360*o,s:l,v:i/255}},rgb_to_hex:function(e,t,n){var a=this.hex_with_component(0,2,e);return a=this.hex_with_component(a,1,t),a=this.hex_with_component(a,0,n),a},component_from_hex:function(e,t){return 255&e>>8*t},hex_with_component:function(e,t,n){return n<<(St=8*t)|e&~(255<<St)}},At="function"==typeof Symbol&&"symbol"===t(Symbol.iterator)?function(e){return t(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":t(e)},Ct=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Pt=function(){function e(e,t){for(var n=0,a;n<t.length;n++)a=t[n],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Tt=function e(t,n,a){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(i===void 0){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,a)}if("value"in i)return i.value;var s=i.get;return void 0===s?void 0:s.call(a)},It=function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+t(n));e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)},Dt=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n&&("object"===t(n)||"function"==typeof n)?n:e},Ot=function(){function e(){if(Ct(this,e),this.__state=wt.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return Pt(e,[{key:"toString",value:function(){return M(this)}},{key:"toHexString",value:function(){return M(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();Ot.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=Et.component_from_hex(e.__state.hex,n);else if("HSV"===e.__state.space)kt.extend(e.__state,Et.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v));else throw new Error("Corrupted color state")},Ot.recalculateHSV=function(e){var t=Et.rgb_to_hsv(e.r,e.g,e.b);kt.extend(e.__state,{s:t.s,v:t.v}),kt.isNaN(t.h)?kt.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},Ot.COMPONENTS=["r","g","b","h","s","v","hex","a"],B(Ot.prototype,"r",2),B(Ot.prototype,"g",1),B(Ot.prototype,"b",0),R(Ot.prototype,"h"),R(Ot.prototype,"s"),R(Ot.prototype,"v"),Object.defineProperty(Ot.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(Ot.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=Et.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var Lt=function(){function e(t,n){Ct(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return Pt(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),Ft={};kt.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){kt.each(e,function(n){Ft[n]=t})});var Mt=/(\d+(\.\d+)?)px/,Bt={makeSelectable:function(e,t){void 0===e||void 0===e.style||(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var a=n,i=t;kt.isUndefined(i)&&(i=!0),kt.isUndefined(a)&&(a=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),a&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,a){var i=n||{},r=Ft[t];if(!r)throw new Error("Event type "+t+" not supported.");var s=document.createEvent(r);switch(r){case"MouseEvents":{var o=i.x||i.clientX||0,l=i.y||i.clientY||0;s.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,o,l,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var u=s.initKeyboardEvent||s.initKeyEvent;kt.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),u(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break}default:{s.initEvent(t,i.bubbles||!1,i.cancelable||!0);break}}kt.defaults(s,a),e.dispatchEvent(s)},bind:function(e,t,n,a){return e.addEventListener?e.addEventListener(t,n,a||!1):e.attachEvent&&e.attachEvent("on"+t,n),Bt},unbind:function(e,t,n,a){return e.removeEventListener?e.removeEventListener(t,n,a||!1):e.detachEvent&&e.detachEvent("on"+t,n),Bt},addClass:function(e,t){if(e.className===void 0)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return Bt},removeClass:function(e,t){if(!t)e.className=void 0;else if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),a=n.indexOf(t);-1!==a&&(n.splice(a,1),e.className=n.join(" "))}return Bt},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return V(t["border-left-width"])+V(t["border-right-width"])+V(t["padding-left"])+V(t["padding-right"])+V(t.width)},getHeight:function(e){var t=getComputedStyle(e);return V(t["border-top-width"])+V(t["border-bottom-width"])+V(t["padding-top"])+V(t["padding-bottom"])+V(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent;while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},Rt=function(e){function t(e,n){Ct(this,t);var a=Dt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=a;return a.__prev=a.getValue(),a.__checkbox=document.createElement("input"),a.__checkbox.setAttribute("type","checkbox"),Bt.bind(a.__checkbox,"change",function(){i.setValue(!i.__prev)},!1),a.domElement.appendChild(a.__checkbox),a.updateDisplay(),a}return It(t,e),Pt(t,[{key:"setValue",value:function(e){var n=Tt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Tt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(Lt),Vt=function(e){function t(e,n,a){Ct(this,t);var i=Dt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),r=a,s=i;if(i.__select=document.createElement("select"),kt.isArray(r)){var o={};kt.each(r,function(e){o[e]=e}),r=o}return kt.each(r,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),s.__select.appendChild(n)}),i.updateDisplay(),Bt.bind(i.__select,"change",function(){var e=this.options[this.selectedIndex].value;s.setValue(e)}),i.domElement.appendChild(i.__select),i}return It(t,e),Pt(t,[{key:"setValue",value:function(e){var n=Tt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return Bt.isActive(this.__select)?this:(this.__select.value=this.getValue(),Tt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(Lt),Nt=function(e){function t(e,n){function a(){r.setValue(r.__input.value)}Ct(this,t);var i=Dt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),r=i;return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),Bt.bind(i.__input,"keyup",a),Bt.bind(i.__input,"change",a),Bt.bind(i.__input,"blur",function(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}),Bt.bind(i.__input,"keydown",function(t){13===t.keyCode&&this.blur()}),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return It(t,e),Pt(t,[{key:"updateDisplay",value:function(){return Bt.isActive(this.__input)||(this.__input.value=this.getValue()),Tt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(Lt),Ut=function(e){function t(e,n,a){var i=Math.LN10,r=Math.log;Ct(this,t);var s=Dt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=a||{};return s.__min=o.min,s.__max=o.max,s.__step=o.step,s.__impliedStep=kt.isUndefined(s.__step)?0===s.initialValue?1:ht(10,lt(r(dt(s.initialValue))/i))/10:s.__step,s.__precision=N(s.__impliedStep),s}return It(t,e),Pt(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&0!=n%this.__step&&(n=mt(n/this.__step)*this.__step),Tt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=N(e),this}}]),t}(Lt),qt=function(e){function t(e,n,a){function i(){l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}function r(t){var e=u-t.clientY;l.setValue(l.getValue()+e*l.__impliedStep),u=t.clientY}function s(){Bt.unbind(window,"mousemove",r),Bt.unbind(window,"mouseup",s),i()}Ct(this,t);var o=Dt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,a));o.__truncationSuspended=!1;var l=o,u=void 0;return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),Bt.bind(o.__input,"change",function(){var e=parseFloat(l.__input.value);kt.isNaN(e)||l.setValue(e)}),Bt.bind(o.__input,"blur",function(){i()}),Bt.bind(o.__input,"mousedown",function(t){Bt.bind(window,"mousemove",r),Bt.bind(window,"mouseup",s),u=t.clientY}),Bt.bind(o.__input,"keydown",function(t){13===t.keyCode&&(l.__truncationSuspended=!0,this.blur(),l.__truncationSuspended=!1,i())}),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return It(t,e),Pt(t,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():U(this.getValue(),this.__precision),Tt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(Ut),Yt=function(e){function t(e,n,a,i,r){function s(t){t.preventDefault();var e=c.__background.getBoundingClientRect();return c.setValue(Y(t.clientX,e.left,e.right,c.__min,c.__max)),!1}function o(){Bt.unbind(window,"mousemove",s),Bt.unbind(window,"mouseup",o),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}function l(t){var e=t.touches[0].clientX,n=c.__background.getBoundingClientRect();c.setValue(Y(e,n.left,n.right,c.__min,c.__max))}function u(){Bt.unbind(window,"touchmove",l),Bt.unbind(window,"touchend",u),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}Ct(this,t);var d=Dt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:a,max:i,step:r})),c=d;return d.__background=document.createElement("div"),d.__foreground=document.createElement("div"),Bt.bind(d.__background,"mousedown",function(t){document.activeElement.blur(),Bt.bind(window,"mousemove",s),Bt.bind(window,"mouseup",o),s(t)}),Bt.bind(d.__background,"touchstart",function(t){1!==t.touches.length||(Bt.bind(window,"touchmove",l),Bt.bind(window,"touchend",u),l(t))}),Bt.addClass(d.__background,"slider"),Bt.addClass(d.__foreground,"slider-fg"),d.updateDisplay(),d.__background.appendChild(d.__foreground),d.domElement.appendChild(d.__background),d}return It(t,e),Pt(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",Tt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(Ut),Xt=function(e){function t(e,n,a){Ct(this,t);var i=Dt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.__button=document.createElement("div"),i.__button.innerHTML=void 0===a?"Fire":a,Bt.bind(i.__button,"click",function(t){return t.preventDefault(),i.fire(),!1}),Bt.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return It(t,e),Pt(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(Lt),jt=function(e){function t(e,n){function a(t){u(t),Bt.bind(window,"mousemove",u),Bt.bind(window,"touchmove",u),Bt.bind(window,"mouseup",r),Bt.bind(window,"touchend",r)}function i(t){d(t),Bt.bind(window,"mousemove",d),Bt.bind(window,"touchmove",d),Bt.bind(window,"mouseup",s),Bt.bind(window,"touchend",s)}function r(){Bt.unbind(window,"mousemove",u),Bt.unbind(window,"touchmove",u),Bt.unbind(window,"mouseup",r),Bt.unbind(window,"touchend",r),l()}function s(){Bt.unbind(window,"mousemove",d),Bt.unbind(window,"touchmove",d),Bt.unbind(window,"mouseup",s),Bt.unbind(window,"touchend",s),l()}function o(){var e=wt(this.value);!1===e?this.value=y.__color.toString():(y.__color.__state=e,y.setValue(y.__color.toOriginal()))}function l(){y.__onFinishChange&&y.__onFinishChange.call(y,y.__color.toOriginal())}function u(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=y.__saturation_field.getBoundingClientRect(),n=t.touches&&t.touches[0]||t,a=n.clientX,i=n.clientY,r=(a-e.left)/(e.right-e.left),o=1-(i-e.top)/(e.bottom-e.top);return 1<o?o=1:0>o&&(o=0),1<r?r=1:0>r&&(r=0),y.__color.v=o,y.__color.s=r,y.setValue(y.__color.toOriginal()),!1}function d(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=y.__hue_field.getBoundingClientRect(),n=t.touches&&t.touches[0]||t,a=n.clientY,i=1-(a-e.top)/(e.bottom-e.top);return 1<i?i=1:0>i&&(i=0),y.__color.h=360*i,y.setValue(y.__color.toOriginal()),!1}Ct(this,t);var c=Dt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));c.__color=new Ot(c.getValue()),c.__temp=new Ot(0);var y=c;c.domElement=document.createElement("div"),Bt.makeSelectable(c.domElement,!1),c.__selector=document.createElement("div"),c.__selector.className="selector",c.__saturation_field=document.createElement("div"),c.__saturation_field.className="saturation-field",c.__field_knob=document.createElement("div"),c.__field_knob.className="field-knob",c.__field_knob_border="2px solid ",c.__hue_knob=document.createElement("div"),c.__hue_knob.className="hue-knob",c.__hue_field=document.createElement("div"),c.__hue_field.className="hue-field",c.__input=document.createElement("input"),c.__input.type="text",c.__input_textShadow="0 1px 1px ",Bt.bind(c.__input,"keydown",function(t){13===t.keyCode&&o.call(this)}),Bt.bind(c.__input,"blur",o),Bt.bind(c.__selector,"mousedown",function(){Bt.addClass(this,"drag").bind(window,"mouseup",function(){Bt.removeClass(y.__selector,"drag")})}),Bt.bind(c.__selector,"touchstart",function(){Bt.addClass(this,"drag").bind(window,"touchend",function(){Bt.removeClass(y.__selector,"drag")})});var h=document.createElement("div");return kt.extend(c.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),kt.extend(c.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:c.__field_knob_border+(.5>c.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),kt.extend(c.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),kt.extend(c.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),kt.extend(h.style,{width:"100%",height:"100%",background:"none"}),X(h,"top","rgba(0,0,0,0)","#000"),kt.extend(c.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),j(c.__hue_field),kt.extend(c.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:c.__input_textShadow+"rgba(0,0,0,0.7)"}),Bt.bind(c.__saturation_field,"mousedown",a),Bt.bind(c.__saturation_field,"touchstart",a),Bt.bind(c.__field_knob,"mousedown",a),Bt.bind(c.__field_knob,"touchstart",a),Bt.bind(c.__hue_field,"mousedown",i),Bt.bind(c.__hue_field,"touchstart",i),c.__saturation_field.appendChild(h),c.__selector.appendChild(c.__field_knob),c.__selector.appendChild(c.__saturation_field),c.__selector.appendChild(c.__hue_field),c.__hue_field.appendChild(c.__hue_knob),c.domElement.appendChild(c.__input),c.domElement.appendChild(c.__selector),c.updateDisplay(),c}return It(t,e),Pt(t,[{key:"updateDisplay",value:function(){var e=wt(this.getValue());if(!1!==e){var t=!1;kt.each(Ot.COMPONENTS,function(n){if(!kt.isUndefined(e[n])&&!kt.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}},this),t&&kt.extend(this.__color.__state,e)}kt.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=.5>this.__color.v||.5<this.__color.s?255:0,a=255-n;kt.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,X(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),kt.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+a+","+a+","+a+",.7)"})}}]),t}(Lt),Ht=["-moz-","-o-","-webkit-","-ms-",""],Gt=function(e,t){var n=e[t];return kt.isArray(arguments[2])||kt.isObject(arguments[2])?new Vt(e,t,arguments[2]):kt.isNumber(n)?kt.isNumber(arguments[2])&&kt.isNumber(arguments[3])?kt.isNumber(arguments[4])?new Yt(e,t,arguments[2],arguments[3],arguments[4]):new Yt(e,t,arguments[2],arguments[3]):kt.isNumber(arguments[4])?new qt(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new qt(e,t,{min:arguments[2],max:arguments[3]}):kt.isString(n)?new Nt(e,t):kt.isFunction(n)?new Xt(e,t,""):kt.isBoolean(n)?new Rt(e,t):null},Zt=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},Wt=function(){function e(){Ct(this,e),this.backgroundElement=document.createElement("div"),kt.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),Bt.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),kt.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;Bt.bind(this.backgroundElement,"click",function(){t.hide()})}return Pt(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),kt.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function e(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",Bt.unbind(t.domElement,"webkitTransitionEnd",e),Bt.unbind(t.domElement,"transitionend",e),Bt.unbind(t.domElement,"oTransitionEnd",e)};Bt.bind(this.domElement,"webkitTransitionEnd",e),Bt.bind(this.domElement,"transitionend",e),Bt.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-Bt.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-Bt.getHeight(this.domElement)/2+"px"}}]),e}(),Kt=function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");({load:function(e,t){var n=t||document,a=n.createElement("link");a.type="text/css",a.rel="stylesheet",a.href=e,n.getElementsByTagName("head")[0].appendChild(a)},inject:function(e,t){var n=t||document,a=document.createElement("style");a.type="text/css",a.innerHTML=e;var i=n.getElementsByTagName("head")[0];try{i.appendChild(a)}catch(t){}}}).inject(Kt);var Qt=72,Jt=20,$t="Default",en=function(){try{return!!window.localStorage}catch(t){return!1}}(),tn=void 0,nn=!0,an=void 0,rn=!1,sn=[],on=function e(t){var n=this,a=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),Bt.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],a=kt.defaults(a,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),a=kt.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace}),kt.isUndefined(a.load)?a.load={preset:$t}:a.preset&&(a.load.preset=a.preset),kt.isUndefined(a.parent)&&a.hideable&&sn.push(this),a.resizable=kt.isUndefined(a.parent)&&a.resizable,a.autoPlace&&kt.isUndefined(a.scrollable)&&(a.scrollable=!0);var i=en&&"true"===localStorage.getItem(J(this,"isLocal")),r=void 0,s=void 0;if(Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},closeOnTop:{get:function(){return a.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:a.load.preset},set:function(e){n.parent?n.getRoot().preset=e:a.load.preset=e,re(this),n.revert()}},width:{get:function(){return a.width},set:function(e){a.width=e,ae(n,e)}},name:{get:function(){return a.name},set:function(e){a.name=e,s&&(s.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(t){a.closed=t,a.closed?Bt.addClass(n.__ul,e.CLASS_CLOSED):Bt.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return i},set:function(e){en&&(i=e,e?Bt.bind(window,"unload",r):Bt.unbind(window,"unload",r),localStorage.setItem(J(n,"isLocal"),e))}}}),kt.isUndefined(a.parent)){if(this.closed=a.closed||!1,Bt.addClass(this.domElement,e.CLASS_MAIN),Bt.makeSelectable(this.domElement,!1),en&&i){n.useLocalStorage=!0;var o=localStorage.getItem(J(this,"gui"));o&&(a.load=JSON.parse(o))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,Bt.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),a.closeOnTop?(Bt.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(Bt.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),Bt.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{void 0===a.closed&&(a.closed=!0);var l=document.createTextNode(a.name);Bt.addClass(l,"controller-name"),s=H(n,l);var u=function(t){return t.preventDefault(),n.closed=!n.closed,!1};Bt.addClass(this.__ul,e.CLASS_CLOSED),Bt.addClass(s,"title"),Bt.bind(s,"click",u),a.closed||(this.closed=!1)}a.autoPlace&&(kt.isUndefined(a.parent)&&(nn&&(an=document.createElement("div"),Bt.addClass(an,"dg"),Bt.addClass(an,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(an),nn=!1),an.appendChild(this.domElement),Bt.addClass(this.domElement,e.CLASS_AUTO_PLACE)),!this.parent&&ae(n,a.width)),this.__resizeHandler=function(){n.onResizeDebounced()},Bt.bind(window,"resize",this.__resizeHandler),Bt.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),Bt.bind(this.__ul,"transitionend",this.__resizeHandler),Bt.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),a.resizable&&ne(this),r=function(){en&&"true"===localStorage.getItem(J(n,"isLocal"))&&localStorage.setItem(J(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=r,a.parent||function(){var e=n.getRoot();e.width+=1,kt.defer(function(){e.width-=1})}()};on.toggleHide=function(){rn=!rn,kt.each(sn,function(e){e.domElement.style.display=rn?"none":""})},on.CLASS_AUTO_PLACE="a",on.CLASS_AUTO_PLACE_CONTAINER="ac",on.CLASS_MAIN="main",on.CLASS_CONTROLLER_ROW="cr",on.CLASS_TOO_TALL="taller-than-window",on.CLASS_CLOSED="closed",on.CLASS_CLOSE_BUTTON="close-button",on.CLASS_CLOSE_TOP="close-top",on.CLASS_CLOSE_BOTTOM="close-bottom",on.CLASS_DRAG="drag",on.DEFAULT_WIDTH=245,on.TEXT_CLOSED="Close Controls",on.TEXT_OPEN="Open Controls",on._keydownHandler=function(t){"text"!==document.activeElement.type&&(t.which===Qt||t.keyCode===Qt)&&on.toggleHide()},Bt.bind(window,"keydown",on._keydownHandler,!1),kt.extend(on.prototype,{add:function(e,t){return Q(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return Q(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;kt.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&an.removeChild(this.domElement);var e=this;kt.each(this.__folders,function(t){e.removeFolder(t)}),Bt.unbind(window,"keydown",on._keydownHandler,!1),G(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error("You already have a folder in this GUI by the name \""+e+"\"");var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new on(t);this.__folders[e]=n;var a=H(this,n.domElement);return Bt.addClass(a,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],G(e);var t=this;kt.each(e.__folders,function(t){e.removeFolder(t)}),kt.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=Bt.getOffset(e.__ul).top,n=0;kt.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=Bt.getHeight(t))}),window.innerHeight-t-Jt<n?(Bt.addClass(e.domElement,on.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-Jt+"px"):(Bt.removeClass(e.domElement,on.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&kt.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:kt.debounce(function(){this.onResize()},50),remember:function(){if(kt.isUndefined(tn)&&(tn=new Wt,tn.domElement.innerHTML="<div id=\"dg-save\" class=\"dg dialogue\">\n\n  Here's the new load parameter for your <code>GUI</code>'s constructor:\n\n  <textarea id=\"dg-new-constructor\"></textarea>\n\n  <div id=\"dg-save-locally\">\n\n    <input id=\"dg-local-storage\" type=\"checkbox\"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id=\"dg-local-explain\">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>"),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;kt.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&te(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&ae(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,0<this.__rememberedObjects.length&&(e.preset=this.preset,!e.remembered&&(e.remembered={}),e.remembered[this.preset]=ie(this)),e.folders={},kt.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=ie(this),Z(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[$t]=ie(this,!0)),this.load.remembered[e]=ie(this),this.preset=e,$(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){kt.each(this.__controllers,function(t){this.getRoot().load.remembered?K(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),kt.each(this.__folders,function(e){e.revert(e)}),e||Z(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&se(this.__listening)},updateDisplay:function(){kt.each(this.__controllers,function(e){e.updateDisplay()}),kt.each(this.__folders,function(e){e.updateDisplay()})}});var ln=on,un=function(e){function t(e){var n;return i(this,t),n=A(this,k(t).call(this,e)),n.previousDemo=null,n.demo=null,n}return g(t,e),t}(gt),dn=new un("change"),cn=new un("load"),yn=function(t){function n(t){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=a.aside,s=void 0===r?t:r,o=a.renderer,l;return i(this,n),l=A(this,k(n).call(this)),l.renderer=void 0===o?function(){var n=new e.WebGLRenderer;return n.setSize(t.clientWidth,t.clientHeight),n.setPixelRatio(window.devicePixelRatio),n}():o,t.appendChild(l.renderer.domElement),l.clock=new e.Clock,l.menu=new ln({autoPlace:!1}),s.appendChild(l.menu.domElement),l.demos=new Map,l.demo=null,l.currentDemo=null,l}return g(n,t),o(n,[{key:"resetMenu",value:function(){var e=this,t=this.menu.domElement.parentNode,n=new ln({autoPlace:!1});if(1<this.demos.size){var a=n.add(this,"demo",Array.from(this.demos.keys()));a.onChange(function(){return e.loadDemo()})}return t.removeChild(this.menu.domElement),t.appendChild(n.domElement),this.menu.destroy(),this.menu=n,n}},{key:"startDemo",value:function(e){e.id===this.demo&&(e.initialize(),e.registerOptions(this.resetMenu()),e.ready=!0,cn.demo=e,this.dispatchEvent(cn))}},{key:"loadDemo",value:function(){var e=this,t=this.demos.get(this.demo),n=this.currentDemo,a=this.renderer;window.location.hash=t.id,null!==n&&n.reset(),this.menu.domElement.style.display="none",dn.previousDemo=n,dn.demo=t,this.currentDemo=t,this.dispatchEvent(dn),a.clear(),t.load().then(function(){return e.startDemo(t)})["catch"](console.error)}},{key:"addDemo",value:function(e){var t=window.location.hash.slice(1),n=this.currentDemo;return this.demos.set(e.id,e.setRenderer(this.renderer)),(null===this.demo&&0===t.length||e.id===t)&&(this.demo=e.id,this.loadDemo()),this.resetMenu(),null!==n&&n.ready&&n.registerOptions(this.menu),this}},{key:"removeDemo",value:function(e){var t=this.demos,n;return t.has(e)&&(t["delete"](e),this.demo===e&&0<t.size?(n=t.entries().next().value,this.demo=n[0],this.currentDemo=n[1],this.loadDemo()):(this.demo=null,this.currentDemo=null,this.renderer.clear())),this}},{key:"setSize",value:function(t,n){var a=this.currentDemo;if(this.renderer.setSize(t,n),null!==a&&null!==a.camera){var i=a.camera;i instanceof e.OrthographicCamera?(i.left=t/-2,i.right=t/2,i.top=n/2,i.bottom=n/-2,i.updateProjectionMatrix()):!(i instanceof e.CubeCamera)&&(i.aspect=t/n,i.updateProjectionMatrix())}}},{key:"render",value:function(){var e=this.currentDemo,t=this.clock.getDelta();null!==e&&e.ready&&e.render(t)}}]),n}(vt),hn={MOVE_FORWARD:0,MOVE_LEFT:1,MOVE_BACKWARD:2,MOVE_RIGHT:3,MOVE_DOWN:4,MOVE_UP:5,ZOOM_OUT:6,ZOOM_IN:7},mn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;i(this,e),this.x=t,this.y=n,this.z=a}return o(e,[{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"setFromSpherical",value:function(e){this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var a=ot(t)*e;return this.x=a*ot(n),this.y=st(t)*e,this.z=a*st(n),this}},{key:"setFromCylindrical",value:function(e){this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this.x=e*ot(t),this.y=n,this.z=e*st(t),this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),a=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=a,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this}},{key:"crossVectors",value:function(e,t){var n=e.x,a=e.y,i=e.z,r=t.x,s=t.y,o=t.z;return this.x=a*o-i*s,this.y=i*r-n*o,this.z=n*s-a*r,this}},{key:"cross",value:function(e){return this.crossVectors(this,e)}},{key:"transformDirection",value:function(t){var n=this.x,a=this.y,i=this.z,r=t.elements;return this.x=r[0]*n+r[4]*a+r[8]*i,this.y=r[1]*n+r[5]*a+r[9]*i,this.z=r[2]*n+r[6]*a+r[10]*i,this.normalize()}},{key:"applyMatrix3",value:function(t){var n=this.x,a=this.y,i=this.z,r=t.elements;return this.x=r[0]*n+r[3]*a+r[6]*i,this.y=r[1]*n+r[4]*a+r[7]*i,this.z=r[2]*n+r[5]*a+r[8]*i,this}},{key:"applyMatrix4",value:function(t){var n=this.x,a=this.y,i=this.z,r=t.elements;return this.x=r[0]*n+r[4]*a+r[8]*i+r[12],this.y=r[1]*n+r[5]*a+r[9]*i+r[13],this.z=r[2]*n+r[6]*a+r[10]*i+r[14],this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,a=this.z,i=e.x,r=e.y,s=e.z,o=e.w,l=o*t+r*a-s*n,u=o*n+s*t-i*a,d=o*a+i*n-r*t,c=-i*t-r*n-s*a;return this.x=l*o+c*-i+u*-s-d*-r,this.y=u*o+c*-r+d*-i-l*-s,this.z=d*o+c*-s+l*-r-u*-i,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"reflect",value:function(e){var t=e.x,n=e.y,a=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(t,n,a),this}},{key:"angleTo",value:function(e){var t=this.dot(e)/rt(this.lengthSquared()*e.lengthSquared());return it(yt(ct(t,-1),1))}},{key:"manhattanLength",value:function(){return dt(this.x)+dt(this.y)+dt(this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return rt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanDistanceTo",value:function(e){return dt(this.x-e.x)+dt(this.y-e.y)+dt(this.z-e.z)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,a=this.z-e.z;return t*t+n*n+a*a}},{key:"distanceTo",value:function(e){return rt(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=yt(this.x,e.x),this.y=yt(this.y,e.y),this.z=yt(this.z,e.z),this}},{key:"max",value:function(e){return this.x=ct(this.x,e.x),this.y=ct(this.y,e.y),this.z=ct(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=ct(e.x,yt(t.x,this.x)),this.y=ct(e.y,yt(t.y,this.y)),this.z=ct(e.z,yt(t.z,this.z)),this}},{key:"floor",value:function(){return this.x=lt(this.x),this.y=lt(this.y),this.z=lt(this.z),this}},{key:"ceil",value:function(){return this.x=ut(this.x),this.y=ut(this.y),this.z=ut(this.z),this}},{key:"round",value:function(){return this.x=mt(this.x),this.y=mt(this.y),this.z=mt(this.z),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}]),e}(),pn=new mn,n=[new mn,new mn,new mn,new mn,new mn,new mn,new mn,new mn],v=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn(1/0,1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new mn(-Infinity,-Infinity,-Infinity);i(this,e),this.min=t,this.max=n}return o(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-Infinity,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"setFromSphere",value:function(e){return this.set(e.center,e.center),this.expandByScalar(e.radius),this}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"setFromPoints",value:function(e){var t,n;for(this.min.set(0,0,0),this.max.set(0,0,0),(t=0,n=e.length);t<n;++t)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=pn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new mn;return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){var t=pn.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:"applyMatrix4",value:function(e){var t=this.min,a=this.max;return this.isEmpty()||(n[0].set(t.x,t.y,t.z).applyMatrix4(e),n[1].set(t.x,t.y,a.z).applyMatrix4(e),n[2].set(t.x,a.y,t.z).applyMatrix4(e),n[3].set(t.x,a.y,a.z).applyMatrix4(e),n[4].set(a.x,t.y,t.z).applyMatrix4(e),n[5].set(a.x,t.y,a.z).applyMatrix4(e),n[6].set(a.x,a.y,t.z).applyMatrix4(e),n[7].set(a.x,a.y,a.z).applyMatrix4(e),this.setFromPoints(n)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"containsPoint",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=n.x&&e.y<=n.y&&e.z<=n.z}},{key:"containsBox",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return t.x<=a.x&&i.x<=n.x&&t.y<=a.y&&i.y<=n.y&&t.z<=a.z&&i.z<=n.z}},{key:"intersectsBox",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&i.z>=t.z&&a.x<=n.x&&a.y<=n.y&&a.z<=n.z}},{key:"intersectsSphere",value:function(e){var t=this.clampPoint(e.center,pn);return t.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return 0<e.normal.x?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),gn=new v,vn=new mn,fn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;i(this,e),this.center=t,this.radius=n}return o(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"setFromPoints",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:gn.setFromPoints(e).getCenter(this.center),n=0,a,r;for(a=0,r=e.length;a<r;++a)n=ct(n,t.distanceToSquared(e[a]));return this.radius=rt(n),this}},{key:"setFromBox",value:function(e){return e.getCenter(this.center),this.radius=.5*e.getSize(vn).length(),this}},{key:"isEmpty",value:function(){return 0>=this.radius}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new mn,n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return dt(e.distanceToPoint(this.center))<=this.radius}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}]),e}(),xn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;i(this,e),this.x=t,this.y=n}return o(e,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this}},{key:"applyMatrix3",value:function(t){var n=this.x,a=this.y,i=t.elements;return this.x=i[0]*n+i[3]*a+i[6],this.y=i[1]*n+i[4]*a+i[7],this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"manhattanLength",value:function(){return dt(this.x)+dt(this.y)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return rt(this.x*this.x+this.y*this.y)}},{key:"manhattanDistanceTo",value:function(e){return dt(this.x-e.x)+dt(this.y-e.y)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"distanceTo",value:function(e){return rt(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=yt(this.x,e.x),this.y=yt(this.y,e.y),this}},{key:"max",value:function(e){return this.x=ct(this.x,e.x),this.y=ct(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=ct(e.x,yt(t.x,this.x)),this.y=ct(e.y,yt(t.y,this.y)),this}},{key:"floor",value:function(){return this.x=lt(this.x),this.y=lt(this.y),this}},{key:"ceil",value:function(){return this.x=ut(this.x),this.y=ut(this.y),this}},{key:"round",value:function(){return this.x=mt(this.x),this.y=mt(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"angle",value:function e(){var e=at(this.y,this.x);return 0>e&&(e+=2*nt),e}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:"rotateAround",value:function(e,t){var n=st(t),a=ot(t),i=this.x-e.x,r=this.y-e.y;return this.x=i*n-r*a+e.x,this.y=i*a+r*n+e.y,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"width",get:function(){return this.x},set:function(e){return this.x=e}},{key:"height",get:function(){return this.y},set:function(e){return this.y=e}}]),e}(),kn=new xn,zn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xn(1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xn(-Infinity,-Infinity);i(this,e),this.min=t,this.max=n}return o(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-Infinity,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xn;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new xn;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new fn;return this.getCenter(e.center),e.radius=.5*this.getSize(kn).length(),e}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"setFromPoints",value:function(e){var t,n;for(this.min.set(0,0),this.max.set(0,0),(t=0,n=e.length);t<n;++t)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=kn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new xn;return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){var t=kn.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"containsPoint",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.x<=n.x&&e.y<=n.y}},{key:"containsBox",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return t.x<=a.x&&i.x<=n.x&&t.y<=a.y&&i.y<=n.y}},{key:"intersectsBox",value:function(e){var t=this.min,n=this.max,a=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&a.x<=n.x&&a.y<=n.y}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),_n=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;i(this,e),this.radius=t,this.theta=n,this.y=a}return o(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=rt(e*e+n*n),this.theta=at(e,n),this.y=t,this}}]),e}(),bn=function(){function e(){i(this,e),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return o(e,[{key:"set",value:function(e,t,n,a,i,r,s,o,l){var u=this.elements;return u[0]=e,u[3]=t,u[6]=n,u[1]=a,u[4]=i,u[7]=r,u[2]=s,u[5]=o,u[8]=l,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=e.elements,n=this.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],this}},{key:"clone",value:function(){return new this.constructor().fromArray(this.elements)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a;for(a=0;9>a;++a)n[a]=e[a+t];return this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a;for(a=0;9>a;++a)e[a+t]=n[a];return e}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,a=t.elements,i=this.elements,r=n[0],s=n[3],o=n[6],l=n[1],u=n[4],d=n[7],c=n[2],y=n[5],h=n[8],m=a[0],p=a[3],g=a[6],v=a[1],f=a[4],x=a[7],k=a[2],z=a[5],_=a[8];return i[0]=r*m+s*v+o*k,i[3]=r*p+s*f+o*z,i[6]=r*g+s*x+o*_,i[1]=l*m+u*v+d*k,i[4]=l*p+u*f+d*z,i[7]=l*g+u*x+d*_,i[2]=c*m+y*v+h*k,i[5]=c*p+y*f+h*z,i[8]=c*g+y*x+h*_,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var t=this.elements,n=t[0],a=t[1],r=t[2],s=t[3],o=t[4],e=t[5],l=t[6],u=t[7],d=t[8];return n*o*d-n*e*u-a*s*d+a*e*l+r*s*u-r*o*l}},{key:"getInverse",value:function(e){var t=e.elements,n=this.elements,a=t[0],i=t[1],r=t[2],s=t[3],o=t[4],l=t[5],u=t[6],d=t[7],c=t[8],y=c*o-l*d,h=l*u-c*s,m=d*s-o*u,p=a*y+i*h+r*m,g;return 0===p?(console.error("Can't invert matrix, determinant is zero",e),this.identity()):(g=1/p,n[0]=y*g,n[1]=(r*d-c*i)*g,n[2]=(l*i-r*o)*g,n[3]=h*g,n[4]=(c*a-r*u)*g,n[5]=(r*s-l*a)*g,n[6]=m*g,n[7]=(i*u-d*a)*g,n[8]=(o*a-i*s)*g),this}},{key:"transpose",value:function(){var e=this.elements,n;return n=e[1],e[1]=e[3],e[3]=n,n=e[2],e[2]=e[6],e[6]=n,n=e[5],e[5]=e[7],e[7]=n,this}},{key:"scale",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:"rotate",value:function(e){var t=st(e),n=ot(e),a=this.elements,i=a[0],r=a[3],s=a[6],o=a[1],l=a[4],u=a[7];return a[0]=t*i+n*o,a[3]=t*r+n*l,a[6]=t*s+n*u,a[1]=-n*i+t*o,a[4]=-n*r+t*l,a[7]=-n*s+t*u,this}},{key:"translate",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:"equals",value:function(e){var t=this.elements,n=e.elements,a=!0,r;for(r=0;a&&9>r;++r)t[r]!==n[r]&&(a=!1);return a}}]),e}(),wn={XYZ:"XYZ",YZX:"YZX",ZXY:"ZXY",XZY:"XZY",YXZ:"YXZ",ZYX:"ZYX"},Sn=new mn,En=function(){var n=Number.EPSILON;function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;i(this,e),this.x=t,this.y=n,this.z=a,this.w=r}return o(e,[{key:"set",value:function(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.w=a,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"setFromEuler",value:function(e){var t=e.x,n=e.y,a=e.z,i=st,r=ot,s=i(t/2),o=i(n/2),l=i(a/2),u=r(t/2),d=r(n/2),c=r(a/2);switch(e.order){case wn.XYZ:this.x=u*o*l+s*d*c,this.y=s*d*l-u*o*c,this.z=s*o*c+u*d*l,this.w=s*o*l-u*d*c;break;case wn.YXZ:this.x=u*o*l+s*d*c,this.y=s*d*l-u*o*c,this.z=s*o*c-u*d*l,this.w=s*o*l+u*d*c;break;case wn.ZXY:this.x=u*o*l-s*d*c,this.y=s*d*l+u*o*c,this.z=s*o*c+u*d*l,this.w=s*o*l-u*d*c;break;case wn.ZYX:this.x=u*o*l-s*d*c,this.y=s*d*l+u*o*c,this.z=s*o*c-u*d*l,this.w=s*o*l+u*d*c;break;case wn.YZX:this.x=u*o*l+s*d*c,this.y=s*d*l+u*o*c,this.z=s*o*c-u*d*l,this.w=s*o*l-u*d*c;break;case wn.XZY:this.x=u*o*l-s*d*c,this.y=s*d*l-u*o*c,this.z=s*o*c+u*d*l,this.w=s*o*l+u*d*c;}return this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,a=ot(n);return this.x=e.x*a,this.y=e.y*a,this.z=e.z*a,this.w=st(n),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],a=t[4],i=t[8],r=t[1],o=t[5],l=t[9],u=t[2],d=t[6],c=t[10],y=n+o+c,h;return 0<y?(h=.5/rt(y+1),this.w=.25/h,this.x=(d-l)*h,this.y=(i-u)*h,this.z=(r-a)*h):n>o&&n>c?(h=2*rt(1+n-o-c),this.w=(d-l)/h,this.x=.25*h,this.y=(a+r)/h,this.z=(i+u)/h):o>c?(h=2*rt(1+o-n-c),this.w=(i-u)/h,this.x=(a+r)/h,this.y=.25*h,this.z=(l+d)/h):(h=2*rt(1+c-n-o),this.w=(r-a)/h,this.x=(i+u)/h,this.y=(l+d)/h,this.z=.25*h),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return 1e-6>n?(n=0,dt(e.x)>dt(e.z)?Sn.set(-e.y,e.x,0):Sn.set(0,-e.z,e.y)):Sn.crossVectors(e,t),this.x=Sn.x,this.y=Sn.y,this.z=Sn.z,this.w=n,this.normalize()}},{key:"angleTo",value:function(e){return 2*it(dt(yt(ct(this.dot(e),-1),1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);return 0!==n&&this.slerp(e,yt(1,t/n)),this}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return rt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"normalize",value:function(){var e=this.length(),t;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/e,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"multiplyQuaternions",value:function(e,t){var n=e.x,a=e.y,i=e.z,r=e.w,s=t.x,o=t.y,l=t.z,u=t.w;return this.x=n*u+r*s+a*l-i*o,this.y=a*u+r*o+i*s-n*l,this.z=i*u+r*l+n*o-a*s,this.w=r*u-n*s-a*o-i*l,this}},{key:"multiply",value:function(e){return this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"slerp",value:function(e,a){var t=this.x,i=this.y,r=this.z,o=this.w,l,u,d,c,y,h,m;return 1===a?this.copy(e):0<a&&(l=o*e.w+t*e.x+i*e.y+r*e.z,0>l?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,l=-l):this.copy(e),1<=l?(this.w=o,this.x=t,this.y=i,this.z=r):(u=1-l*l,y=1-a,u<=n?(this.w=y*o+a*this.w,this.x=y*t+a*this.x,this.y=y*i+a*this.y,this.z=y*r+a*this.z,this.normalize()):(d=rt(u),c=at(d,l),h=ot(y*c)/d,m=ot(a*c)/d,this.w=o*h+this.w*m,this.x=t*h+this.x*m,this.y=i*h+this.y*m,this.z=r*h+this.z*m))),this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}],[{key:"slerp",value:function(e,n,a,i){return a.copy(e).slerp(n,i)}},{key:"slerpFlat",value:function(e,a,i,r,o,l,u){var d=o[l],c=o[l+1],y=o[l+2],h=o[l+3],m=i[r],p=i[r+1],g=i[r+2],v=i[r+3],x,k,z,_,b,w,S,E;(v!==h||m!==d||p!==c||g!==y)&&(x=1-u,_=m*d+p*c+g*y+v*h,w=0<=_?1:-1,b=1-_*_,b>n&&(z=rt(b),S=at(z,_*w),x=ot(x*S)/z,u=ot(u*S)/z),E=u*w,m=m*x+d*E,p=p*x+c*E,g=g*x+y*E,v=v*x+h*E,x===1-u&&(k=1/rt(m*m+p*p+g*g+v*v),m*=k,p*=k,g*=k,v*=k)),e[a]=m,e[a+1]=p,e[a+2]=g,e[a+3]=v}}]),e}(),An=new bn,m=new En,q=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;i(this,e),this.x=t,this.y=n,this.z=a,this.order=e.defaultOrder}return o(e,[{key:"set",value:function(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.order=a,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.order=e[t+3],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.order,e}},{key:"toVector3",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn;return e.set(this.x,this.y,this.z)}},{key:"setFromRotationMatrix",value:function(e){var t=Math.asin,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order,a=e.elements,i=a[0],r=a[4],s=a[8],o=a[1],l=a[5],u=a[9],d=a[2],c=a[6],y=a[10],h=1-1e-5;switch(n){case wn.XYZ:{this.y=t(oe(s,-1,1)),dt(s)<h?(this.x=at(-u,y),this.z=at(-r,i)):(this.x=at(c,l),this.z=0);break}case wn.YXZ:{this.x=t(-oe(u,-1,1)),dt(u)<h?(this.y=at(s,y),this.z=at(o,l)):(this.y=at(-d,i),this.z=0);break}case wn.ZXY:{this.x=t(oe(c,-1,1)),dt(c)<h?(this.y=at(-d,y),this.z=at(-r,l)):(this.y=0,this.z=at(o,i));break}case wn.ZYX:{this.y=t(-oe(d,-1,1)),dt(d)<h?(this.x=at(c,y),this.z=at(o,i)):(this.x=0,this.z=at(-r,l));break}case wn.YZX:{this.z=t(oe(o,-1,1)),dt(o)<h?(this.x=at(-u,l),this.y=at(-d,i)):(this.x=0,this.y=at(s,y));break}case wn.XZY:{this.z=t(-oe(r,-1,1)),dt(r)<h?(this.x=at(c,l),this.y=at(s,i)):(this.x=at(-u,y),this.y=0);break}}return this.order=n,this}},{key:"setFromQuaternion",value:function(e,t){return An.makeRotationFromQuaternion(e),this.setFromRotationMatrix(An,t)}},{key:"setFromVector3",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return m.setFromEuler(this),this.setFromQuaternion(m,e)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order}}],[{key:"defaultOrder",get:function(){return wn.XYZ}}]),e}(),Cn=new mn,a=new mn,b=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn(1,0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;i(this,e),this.normal=t,this.constant=n}return o(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,a){return this.normal.set(e,t,n),this.constant=a,this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var i=Cn.subVectors(n,t).cross(a.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,Cn),this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"intersectLine",value:function(e,n){var a=e.delta(Cn),i=this.normal.dot(a);if(0===i)0===this.distanceToPoint(e.start)&&n.copy(e.start);else{var r=-(e.start.dot(this.normal)+this.constant)/i;0<=r&&1>=r&&n.copy(a).multiplyScalar(r).add(e.start)}return n}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return 0>t&&0<n||0>n&&0<t}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}]),e}(),Pn=new mn,Tn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new b,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new b,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new b,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new b,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new b,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new b;i(this,e),this.planes=[t,n,a,r,s,o]}return o(e,[{key:"set",value:function(e,t,n,a,i,r){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(a),s[4].copy(i),s[5].copy(r),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"copy",value:function(e){var t=this.planes,n;for(n=0;6>n;++n)t[n].copy(e.planes[n]);return this}},{key:"setFromMatrix",value:function(e){var t=this.planes,n=e.elements,a=n[0],i=n[1],r=n[2],s=n[3],o=n[4],l=n[5],u=n[6],d=n[7],c=n[8],y=n[9],h=n[10],m=n[11],p=n[12],g=n[13],v=n[14],f=n[15];return t[0].setComponents(s-a,d-o,m-c,f-p).normalize(),t[1].setComponents(s+a,d+o,m+c,f+p).normalize(),t[2].setComponents(s+i,d+l,m+y,f+g).normalize(),t[3].setComponents(s-i,d-l,m-y,f-g).normalize(),t[4].setComponents(s-r,d-u,m-h,f-v).normalize(),t[5].setComponents(s+r,d+u,m+h,f+v).normalize(),this}},{key:"intersectsSphere",value:function(e){var t=this.planes,n=e.center,a=-e.radius,r=!0,s,o;for(s=0;6>s;++s)if(o=t[s].distanceToPoint(n),o<a){r=!1;break}return r}},{key:"intersectsBox",value:function(e){var t=this.planes,n=e.min,a=e.max,r,s;for(r=0;6>r;++r)if(s=t[r],Pn.x=0<s.normal.x?a.x:n.x,Pn.y=0<s.normal.y?a.y:n.y,Pn.z=0<s.normal.z?a.z:n.z,0>s.distanceToPoint(Pn))return!1;return!0}},{key:"containsPoint",value:function(e){var t=this.planes,n=!0,a;for(a=0;6>a;++a)if(0>t[a].distanceToPoint(e)){n=!1;break}return n}}]),e}(),In=new mn,Dn=new mn,On=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new mn;i(this,e),this.start=t,this.end=n}return o(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn;return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn;return e.subVectors(this.end,this.start)}},{key:"lengthSquared",value:function(){return this.start.distanceToSquared(this.end)}},{key:"length",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,n){In.subVectors(e,this.start),Dn.subVectors(this.end,this.start);var a=Dn.dot(Dn),i=Dn.dot(In),r=n?yt(ct(i/a,0),1):i/a;return r}},{key:"closestPointToPoint",value:function(e){var n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new mn,i=this.closestPointToPointParameter(e,n);return this.delta(a).multiplyScalar(i).add(this.start)}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}]),e}(),Ln=new mn,Fn=new mn,Mn=new mn,c=function(){function e(){i(this,e),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return o(e,[{key:"set",value:function(e,t,n,a,i,r,s,o,l,u,d,c,y,h,m,p){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=a,g[1]=i,g[5]=r,g[9]=s,g[13]=o,g[2]=l,g[6]=u,g[10]=d,g[14]=c,g[3]=y,g[7]=h,g[11]=m,g[15]=p,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"copy",value:function(e){var t=e.elements,n=this.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],this}},{key:"clone",value:function(){return new this.constructor().fromArray(this.elements)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a;for(a=0;16>a;++a)n[a]=e[a+t];return this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements,a;for(a=0;16>a;++a)e[a+t]=n[a];return e}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],a=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return rt(ct(t,n,a))}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setPosition",value:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,a=1/Ln.setFromMatrixColumn(e,0).length(),i=1/Ln.setFromMatrixColumn(e,1).length(),r=1/Ln.setFromMatrixColumn(e,2).length();return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*r,t[9]=n[9]*r,t[10]=n[10]*r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(t){var n=this.elements,i=t.x,r=t.y,s=t.z,o=st(i),a=ot(i),l=st(r),u=ot(r),d=st(s),e=ot(s),c,y,h,m,p,g,v,f,x,k,z,_;switch(t.order){case wn.XYZ:{c=o*d,y=o*e,h=a*d,m=a*e,n[0]=l*d,n[4]=-l*e,n[8]=u,n[1]=y+h*u,n[5]=c-m*u,n[9]=-a*l,n[2]=m-c*u,n[6]=h+y*u,n[10]=o*l;break}case wn.YXZ:{p=l*d,g=l*e,v=u*d,f=u*e,n[0]=p+f*a,n[4]=v*a-g,n[8]=o*u,n[1]=o*e,n[5]=o*d,n[9]=-a,n[2]=g*a-v,n[6]=f+p*a,n[10]=o*l;break}case wn.ZXY:{p=l*d,g=l*e,v=u*d,f=u*e,n[0]=p-f*a,n[4]=-o*e,n[8]=v+g*a,n[1]=g+v*a,n[5]=o*d,n[9]=f-p*a,n[2]=-o*u,n[6]=a,n[10]=o*l;break}case wn.ZYX:{c=o*d,y=o*e,h=a*d,m=a*e,n[0]=l*d,n[4]=h*u-y,n[8]=c*u+m,n[1]=l*e,n[5]=m*u+c,n[9]=y*u-h,n[2]=-u,n[6]=a*l,n[10]=o*l;break}case wn.YZX:{x=o*l,k=o*u,z=a*l,_=a*u,n[0]=l*d,n[4]=_-x*e,n[8]=z*e+k,n[1]=e,n[5]=o*d,n[9]=-a*d,n[2]=-u*d,n[6]=k*e+z,n[10]=x-_*e;break}case wn.XZY:{x=o*l,k=o*u,z=a*l,_=a*u,n[0]=l*d,n[4]=-e,n[8]=u*d,n[1]=x*e+_,n[5]=o*d,n[9]=k*e-z,n[2]=z*e-k,n[6]=a*d,n[10]=_*e+x;break}}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(Ln.set(0,0,0),e,Fn.set(1,1,1))}},{key:"lookAt",value:function(e,t,n){var a=this.elements,i=Ln,r=Fn,s=Mn;return s.subVectors(e,t),0===s.lengthSquared()&&(s.z=1),s.normalize(),i.crossVectors(n,s),0===i.lengthSquared()&&(1===dt(n.z)?s.x+=1e-4:s.z+=1e-4,s.normalize(),i.crossVectors(n,s)),i.normalize(),r.crossVectors(s,i),a[0]=i.x,a[4]=r.x,a[8]=s.x,a[1]=i.y,a[5]=r.y,a[9]=s.y,a[2]=i.z,a[6]=r.z,a[10]=s.z,this}},{key:"multiplyMatrices",value:function(e,t){var n=this.elements,a=e.elements,i=t.elements,r=a[0],s=a[4],o=a[8],l=a[12],u=a[1],d=a[5],c=a[9],y=a[13],h=a[2],m=a[6],p=a[10],g=a[14],v=a[3],f=a[7],x=a[11],k=a[15],z=i[0],_=i[4],b=i[8],w=i[12],S=i[1],E=i[5],A=i[9],C=i[13],P=i[2],T=i[6],I=i[10],D=i[14],O=i[3],L=i[7],F=i[11],M=i[15];return n[0]=r*z+s*S+o*P+l*O,n[4]=r*_+s*E+o*T+l*L,n[8]=r*b+s*A+o*I+l*F,n[12]=r*w+s*C+o*D+l*M,n[1]=u*z+d*S+c*P+y*O,n[5]=u*_+d*E+c*T+y*L,n[9]=u*b+d*A+c*I+y*F,n[13]=u*w+d*C+c*D+y*M,n[2]=h*z+m*S+p*P+g*O,n[6]=h*_+m*E+p*T+g*L,n[10]=h*b+m*A+p*I+g*F,n[14]=h*w+m*C+p*D+g*M,n[3]=v*z+f*S+x*P+k*O,n[7]=v*_+f*E+x*T+k*L,n[11]=v*b+f*A+x*I+k*F,n[15]=v*w+f*C+x*D+k*M,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],a=e[8],i=e[12],r=e[1],s=e[5],o=e[9],l=e[13],u=e[2],d=e[6],c=e[10],y=e[14],h=e[3],m=e[7],p=e[11],g=e[15],v=t*s,f=t*o,x=t*l,k=n*r,z=n*o,_=n*l,b=a*r,w=a*s,S=a*l,E=i*r,A=i*s,C=i*o;return h*(C*d-S*d-A*c+_*c+w*y-z*y)+m*(f*y-x*c+E*c-b*y+S*u-C*u)+p*(x*d-v*y-E*d+k*y+A*u-_*u)+g*(-w*u-f*d+v*c+b*d-k*c+z*u)}},{key:"getInverse",value:function(e){var t=this.elements,n=e.elements,a=n[0],i=n[1],r=n[2],s=n[3],o=n[4],l=n[5],u=n[6],d=n[7],c=n[8],y=n[9],h=n[10],m=n[11],p=n[12],g=n[13],v=n[14],f=n[15],x=y*v*d-g*h*d+g*u*m-l*v*m-y*u*f+l*h*f,k=p*h*d-c*v*d-p*u*m+o*v*m+c*u*f-o*h*f,z=c*g*d-p*y*d+p*l*m-o*g*m-c*l*f+o*y*f,_=p*y*u-c*g*u-p*l*h+o*g*h+c*l*v-o*y*v,b=a*x+i*k+r*z+s*_,w;return 0===b?(console.error("Can't invert matrix, determinant is zero",e),this.identity()):(w=1/b,t[0]=x*w,t[1]=(g*h*s-y*v*s-g*r*m+i*v*m+y*r*f-i*h*f)*w,t[2]=(l*v*s-g*u*s+g*r*d-i*v*d-l*r*f+i*u*f)*w,t[3]=(y*u*s-l*h*s-y*r*d+i*h*d+l*r*m-i*u*m)*w,t[4]=k*w,t[5]=(c*v*s-p*h*s+p*r*m-a*v*m-c*r*f+a*h*f)*w,t[6]=(p*u*s-o*v*s-p*r*d+a*v*d+o*r*f-a*u*f)*w,t[7]=(o*h*s-c*u*s+c*r*d-a*h*d-o*r*m+a*u*m)*w,t[8]=z*w,t[9]=(p*y*s-c*g*s-p*i*m+a*g*m+c*i*f-a*y*f)*w,t[10]=(o*g*s-p*l*s+p*i*d-a*g*d-o*i*f+a*l*f)*w,t[11]=(c*l*s-o*y*s-c*i*d+a*y*d+o*i*m-a*l*m)*w,t[12]=_*w,t[13]=(c*g*r-p*y*r+p*i*h-a*g*h-c*i*v+a*y*v)*w,t[14]=(p*l*r-o*g*r-p*i*u+a*g*u+o*i*v-a*l*v)*w,t[15]=(o*y*r-c*l*r+c*i*u-a*y*u-o*i*h+a*l*h)*w),this}},{key:"transpose",value:function(){var e=this.elements,n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}},{key:"scale",value:function(e,t,n){var a=this.elements;return a[0]*=e,a[4]*=t,a[8]*=n,a[1]*=e,a[5]*=t,a[9]*=n,a[2]*=e,a[6]*=t,a[10]*=n,a[3]*=e,a[7]*=t,a[11]*=n,this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=st(e),n=ot(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=st(e),n=ot(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=st(e),n=ot(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,n){var a=st(n),i=ot(n),r=1-a,t=e.x,s=e.y,o=e.z,l=r*t,u=r*s;return this.set(l*t+a,l*s-i*o,l*o+i*s,0,l*s+i*o,u*s+a,u*o-i*t,0,l*o-i*s,u*o+i*t,r*o*o+a,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var a=this.elements,i=t.x,r=t.y,s=t.z,o=t.w,l=i+i,u=r+r,d=s+s,c=i*l,y=i*u,h=i*d,m=r*u,p=r*d,g=s*d,v=o*l,f=o*u,x=o*d,k=n.x,z=n.y,_=n.z;return a[0]=(1-(m+g))*k,a[1]=(y+x)*k,a[2]=(h-f)*k,a[3]=0,a[4]=(y-x)*z,a[5]=(1-(c+g))*z,a[6]=(p+v)*z,a[7]=0,a[8]=(h+f)*_,a[9]=(p-v)*_,a[10]=(1-(c+m))*_,a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1,this}},{key:"decompose",value:function(e,t,n){var a=this.elements,i=a[0],r=a[1],s=a[2],o=a[4],l=a[5],u=a[6],d=a[8],c=a[9],y=a[10],h=this.determinant(),m=Ln.set(i,r,s).length()*(0>h?-1:1),p=Ln.set(o,l,u).length(),g=Ln.set(d,c,y).length(),v=1/m,f=1/p,x=1/g;return e.x=a[12],e.y=a[13],e.z=a[14],a[0]*=v,a[1]*=v,a[2]*=v,a[4]*=f,a[5]*=f,a[6]*=f,a[8]*=x,a[9]*=x,a[10]*=x,t.setFromRotationMatrix(this),a[0]=i,a[1]=r,a[2]=s,a[4]=o,a[5]=l,a[6]=u,a[8]=d,a[9]=c,a[10]=y,n.x=m,n.y=p,n.z=g,this}},{key:"makePerspective",value:function(e,t,n,a,i,r){var s=this.elements;return s[0]=2*i/(t-e),s[4]=0,s[8]=(t+e)/(t-e),s[12]=0,s[1]=0,s[5]=2*i/(n-a),s[9]=(n+a)/(n-a),s[13]=0,s[2]=0,s[6]=0,s[10]=-(r+i)/(r-i),s[14]=-2*r*i/(r-i),s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,a,i,r){var s=this.elements,o=1/(t-e),l=1/(n-a),u=1/(r-i);return s[0]=2*o,s[4]=0,s[8]=0,s[12]=-((t+e)*o),s[1]=0,s[5]=2*l,s[9]=0,s[13]=-((n+a)*l),s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-((r+i)*u),s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}},{key:"equals",value:function(e){var t=this.elements,n=e.elements,a=!0,r;for(r=0;a&&16>r;++r)t[r]!==n[r]&&(a=!1);return a}}]),e}(),Bn=[new mn,new mn,new mn,new mn],Rn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new mn;i(this,e),this.origin=t,this.direction=n}return o(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"at",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new mn;return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,Bn[0])),this}},{key:"closestPointToPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new mn,n=t.subVectors(e,this.origin).dot(this.direction);return 0<=n?t.copy(this.direction).multiplyScalar(n).add(this.origin):t.copy(this.origin)}},{key:"distanceSquaredToPoint",value:function(e){var t=Bn[0].subVectors(e,this.origin).dot(this.direction);return 0>t?this.origin.distanceToSquared(e):Bn[0].copy(this.direction).multiplyScalar(t).add(this.origin).distanceToSquared(e)}},{key:"distanceToPoint",value:function(e){return rt(this.distanceSquaredToPoint(e))}},{key:"distanceToPlane",value:function(e){var n=e.normal.dot(this.direction),a=0===n?0===e.distanceToPoint(this.origin)?0:-1:-(this.origin.dot(e.normal)+e.constant)/n;return 0<=a?a:null}},{key:"distanceSquaredToSegment",value:function(e,t,n,a){var i=Bn[0].copy(e).add(t).multiplyScalar(.5),r=Bn[1].copy(t).sub(e).normalize(),s=Bn[2].copy(this.origin).sub(i),o=.5*e.distanceTo(t),l=-this.direction.dot(r),u=s.dot(this.direction),d=-s.dot(r),y=s.lengthSq(),c=dt(1-l*l),h,m,p,g,v;return 0<c?(h=l*d-u,m=l*u-d,p=o*c,0<=h?m>=-p?m<=p?(g=1/c,h*=g,m*=g,v=h*(h+l*m+2*u)+m*(l*h+m+2*d)+y):(m=o,h=ct(0,-(l*m+u)),v=-h*h+m*(m+2*d)+y):(m=-o,h=ct(0,-(l*m+u)),v=-h*h+m*(m+2*d)+y):m<=-p?(h=ct(0,-(-l*o+u)),m=0<h?-o:yt(ct(-o,-d),o),v=-h*h+m*(m+2*d)+y):m<=p?(h=0,m=yt(ct(-o,-d),o),v=m*(m+2*d)+y):(h=ct(0,-(l*o+u)),m=0<h?o:yt(ct(-o,-d),o),v=-h*h+m*(m+2*d)+y)):(m=0<l?-o:o,h=ct(0,-(l*m+u)),v=-h*h+m*(m+2*d)+y),void 0!==n&&n.copy(this.direction).multiplyScalar(h).add(this.origin),void 0!==a&&a.copy(r).multiplyScalar(m).add(i),v}},{key:"intersectSphere",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new mn,n=Bn[0].subVectors(e.center,this.origin),a=n.dot(this.direction),i=n.dot(n)-a*a,r=e.radius*e.radius,s=null,o,l,u;return i<=r&&(o=rt(r-i),l=a-o,u=a+o,(0<=l||0<=u)&&(s=0>l?this.at(u,t):this.at(l,t))),s}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"intersectPlane",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new mn,a=this.distanceToPlane(e);return null===a?null:this.at(a,n)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t}},{key:"intersectBox",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new mn,n=this.origin,a=this.direction,i=e.min,r=e.max,s=1/a.x,o=1/a.y,l=1/a.z,u=null,d,c,y,h,m,p;return 0<=s?(d=(i.x-n.x)*s,c=(r.x-n.x)*s):(d=(r.x-n.x)*s,c=(i.x-n.x)*s),0<=o?(y=(i.y-n.y)*o,h=(r.y-n.y)*o):(y=(r.y-n.y)*o,h=(i.y-n.y)*o),d<=h&&y<=c&&((y>d||d!==d)&&(d=y),(h<c||c!==c)&&(c=h),0<=l?(m=(i.z-n.z)*l,p=(r.z-n.z)*l):(m=(r.z-n.z)*l,p=(i.z-n.z)*l),d<=p&&m<=c&&((m>d||d!==d)&&(d=m),(p<c||c!==c)&&(c=p),0<=c&&(u=this.at(0<=d?d:c,t)))),u}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,Bn[0])}},{key:"intersectTriangle",value:function(e,t,n,a,i){var r=this.direction,s=Bn[0],o=Bn[1],l=Bn[2],u=Bn[3],d=null,c,y,h,m,p;return o.subVectors(t,e),l.subVectors(n,e),u.crossVectors(o,l),c=r.dot(u),0===c||a&&0<c||(0<c?y=1:(y=-1,c=-c),s.subVectors(this.origin,e),h=y*r.dot(l.crossVectors(s,l)),0<=h&&(m=y*r.dot(o.cross(s)),0<=m&&h+m<=c&&(p=-y*s.dot(u),0<=p&&(d=this.at(p/c,i))))),d}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),e}(),Vn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;i(this,e),this.radius=t,this.phi=n,this.theta=a}return o(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"makeSafe",value:function(){return this.phi=ct(1e-6,yt(nt-1e-6,this.phi)),this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=rt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=at(e,n),this.phi=it(yt(ct(t/this.radius,-1),1))),this}}]),e}(),Nn=function(){function e(){i(this,e),this.elements=new Float32Array([1,0,0,1,0,1])}return o(e,[{key:"set",value:function(t,n,a,i,r,s){var o=this.elements;return o[0]=t,o[1]=n,o[3]=i,o[2]=a,o[4]=r,o[5]=s,this}},{key:"identity",value:function(){return this.set(1,0,0,1,0,1),this}},{key:"copy",value:function(e){var t=e.elements;return this.set(t[0],t[1],t[2],t[3],t[4],t[5]),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"toMatrix3",value:function(e){var t=e.elements;e.set(t[0],t[1],t[2],t[1],t[3],t[4],t[2],t[4],t[5])}},{key:"add",value:function(e){var t=this.elements,n=e.elements;return t[0]+=n[0],t[1]+=n[1],t[3]+=n[3],t[2]+=n[2],t[4]+=n[4],t[5]+=n[5],this}},{key:"norm",value:function(){var t=this.elements,e=t[1]*t[1],n=t[2]*t[2],a=t[4]*t[4];return rt(t[0]*t[0]+e+n+e+t[3]*t[3]+a+n+a+t[5]*t[5])}},{key:"off",value:function(){var t=this.elements;return rt(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:"applyToVector3",value:function(t){var n=t.x,a=t.y,i=t.z,r=this.elements;return t.x=r[0]*n+r[1]*a+r[2]*i,t.y=r[1]*n+r[3]*a+r[4]*i,t.z=r[2]*n+r[4]*a+r[5]*i,t}},{key:"equals",value:function(e){var t=this.elements,n=e.elements,a=!0,r;for(r=0;a&&6>r;++r)t[r]!==n[r]&&(a=!1);return a}}],[{key:"calculateIndex",value:function(e,t){return 3-(3-e)*(2-e)/2+t}}]),e}(),Un=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;i(this,e),this.x=t,this.y=n,this.z=a,this.w=r}return o(e,[{key:"set",value:function(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.w=a,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*it(e.w);var t=rt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t=.01,n=.1,a=e.elements,i=a[0],r=a[4],o=a[8],l=a[1],u=a[5],d=a[9],c=a[2],h=a[6],m=a[10],p,g,v,f,k,_,b,w,S,E,A;return dt(r-l)<t&&dt(o-c)<t&&dt(d-h)<t?dt(r+l)<n&&dt(o+c)<n&&dt(d+h)<n&&dt(i+u+m-3)<n?this.set(1,0,0,0):(p=nt,k=(i+1)/2,_=(u+1)/2,b=(m+1)/2,w=(r+l)/4,S=(o+c)/4,E=(d+h)/4,k>_&&k>b?k<t?(g=0,v=.707106781,f=.707106781):(g=rt(k),v=w/g,f=S/g):_>b?_<t?(g=.707106781,v=0,f=.707106781):(v=rt(_),g=w/v,f=E/v):b<t?(g=.707106781,v=.707106781,f=0):(f=rt(b),g=S/f,v=E/f),this.set(g,v,f,p)):(A=rt((h-d)*(h-d)+(o-c)*(o-c)+(l-r)*(l-r)),.001>dt(A)&&(A=1),this.x=(h-d)/A,this.y=(o-c)/A,this.z=(l-r)/A,this.w=it((i+u+m-1)/2)),this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this.w=e.w*t.w,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this}},{key:"applyMatrix4",value:function(t){var n=this.x,a=this.y,i=this.z,r=this.w,s=t.elements;return this.x=s[0]*n+s[4]*a+s[8]*i+s[12]*r,this.y=s[1]*n+s[5]*a+s[9]*i+s[13]*r,this.z=s[2]*n+s[6]*a+s[10]*i+s[14]*r,this.w=s[3]*n+s[7]*a+s[11]*i+s[15]*r,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"manhattanLength",value:function(){return dt(this.x)+dt(this.y)+dt(this.z)+dt(this.w)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return rt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanDistanceTo",value:function(e){return dt(this.x-e.x)+dt(this.y-e.y)+dt(this.z-e.z)+dt(this.w-e.w)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,a=this.z-e.z,i=this.w-e.w;return t*t+n*n+a*a+i*i}},{key:"distanceTo",value:function(e){return rt(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=yt(this.x,e.x),this.y=yt(this.y,e.y),this.z=yt(this.z,e.z),this.w=yt(this.w,e.w),this}},{key:"max",value:function(e){return this.x=ct(this.x,e.x),this.y=ct(this.y,e.y),this.z=ct(this.z,e.z),this.w=ct(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=ct(e.x,yt(t.x,this.x)),this.y=ct(e.y,yt(t.y,this.y)),this.z=ct(e.z,yt(t.z,this.z)),this.w=ct(e.w,yt(t.w,this.w)),this}},{key:"floor",value:function(){return this.x=lt(this.x),this.y=lt(this.y),this.z=lt(this.z),this.w=lt(this.w),this}},{key:"ceil",value:function(){return this.x=ut(this.x),this.y=ut(this.y),this.z=ut(this.z),this.w=ut(this.w),this}},{key:"round",value:function(){return this.x=mt(this.x),this.y=mt(this.y),this.z=mt(this.z),this.w=mt(this.w),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}]),e}(),qn={MAIN:0,AUXILIARY:1,SECONDARY:2},Yn=new mn,Xn=new c,jn=function(){function e(t,n,a,r){i(this,e),this.position=t,this.quaternion=n,this.target=a,this.settings=r,this.spherical=new Vn}return o(e,[{key:"setPosition",value:function(e){return this.position=e,this}},{key:"setQuaternion",value:function(e){return this.quaternion=e,this}},{key:"setTarget",value:function(e){return this.target=e,this}},{key:"updateQuaternion",value:function(){var e=this.settings,t=e.rotation;return e.general.orbit?Xn.lookAt(Yn.subVectors(this.position,this.target),t.pivotOffset,t.up):Xn.lookAt(Yn.set(0,0,0),this.target.setFromSpherical(this.spherical),t.up),this.quaternion.setFromRotationMatrix(Xn),this}},{key:"adjustSpherical",value:function(e,t){var n=this.settings,a=n.general.orbit,i=n.rotation,r=this.spherical;return r.theta=i.invertX?r.theta+e:r.theta-e,r.phi=(a||i.invertY)&&!(a&&i.invertY)?r.phi-t:r.phi+t,r.theta=yt(ct(r.theta,i.minAzimuthalAngle),i.maxAzimuthalAngle),r.phi=yt(ct(r.phi,i.minPolarAngle),i.maxPolarAngle),r.theta%=2*nt,r.makeSafe(),a&&this.position.setFromSpherical(r).add(this.target),this}},{key:"zoom",value:function e(t){var n=this.settings,a=n.general,i=n.sensitivity,e=n.zoom,r=this.spherical,s,o,l;return a.orbit&&e.enabled&&(s=t*i.zoom,e.invert&&(s=-s),o=ct(e.minDistance,1e-6),l=yt(e.maxDistance,1/0),r.radius=yt(ct(r.radius+s,o),l),this.position.setFromSpherical(r).add(this.target)),this}},{key:"update",value:function(){}},{key:"lookAt",value:function(e){var t=this.spherical,n=this.position,a=this.target;return a.copy(e),this.settings.general.orbit?Yn.subVectors(n,a):Yn.subVectors(a,n).normalize(),t.setFromVector3(Yn),t.radius=ct(t.radius,1e-6),this.updateQuaternion(),this}},{key:"getViewDirection",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn;return e.setFromSpherical(this.spherical).normalize(),this.settings.general.orbit&&e.negate(),e}}]),e}(),Hn=function(){function e(){i(this,e),this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.up=!1,this.down=!1}return o(e,[{key:"reset",value:function(){return this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.up=!1,this.down=!1,this}}]),e}(),Gn=new mn(1,0,0),x=new mn(0,1,0),y=new mn(0,0,1),z=new mn,Zn=function(){function e(t,n,a,r){i(this,e),this.position=t,this.quaternion=n,this.target=a,this.settings=r,this.movementState=new Hn}return o(e,[{key:"setPosition",value:function(e){return this.position=e,this}},{key:"setQuaternion",value:function(e){return this.quaternion=e,this}},{key:"setTarget",value:function(e){return this.target=e,this}},{key:"translateOnAxis",value:function(e,t){z.copy(e).applyQuaternion(this.quaternion).multiplyScalar(t),this.position.add(z),this.settings.general.orbit&&this.target.add(z)}},{key:"translate",value:function(e){var t=this.settings.sensitivity,n=this.movementState,a=e*t.translation;n.backward?this.translateOnAxis(y,a):n.forward&&this.translateOnAxis(y,-a),n.right?this.translateOnAxis(Gn,a):n.left&&this.translateOnAxis(Gn,-a),n.up?this.translateOnAxis(x,a):n.down&&this.translateOnAxis(x,-a)}},{key:"update",value:function(e){this.settings.translation.enabled&&this.translate(e)}},{key:"moveTo",value:function(e){return this.settings.general.orbit?this.target.copy(e):this.position.copy(e),this}}]),e}(),Wn=new Proxy({BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,META_LEFT:91,META_RIGHT:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222},{get:function(e,t){return t in e?e[t]:1===t.length?t.toUpperCase().charCodeAt(0):void 0}}),Kn=function(){function e(){i(this,e),this.orbit=!0}return o(e,[{key:"copy",value:function(e){return this.orbit=e.orbit,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),Qn=function(){function e(){i(this,e),this.defaultActions=new Map,this.actions=new Map}return o(e,[{key:"reset",value:function(){return this.actions=new Map(this.defaultActions),this}},{key:"setDefault",value:function(e){return this.defaultActions=e,this.reset()}},{key:"copy",value:function(e){return this.defaultActions=new Map(e.defaultActions),this.actions=new Map(e.actions),this}},{key:"clearDefault",value:function(){return this.defaultActions.clear(),this}},{key:"clear",value:function(){return this.actions.clear(),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"has",value:function(e){return this.actions.has(e)}},{key:"get",value:function(e){return this.actions.get(e)}},{key:"set",value:function(e,t){return this.actions.set(e,t),this}},{key:"delete",value:function(e){return this.actions["delete"](e)}},{key:"toJSON",value:function(){return{defaultActions:D(this.defaultActions),actions:D(this.actions)}}}]),e}(),Jn=function(){function e(){i(this,e),this.hold=!1,this.lock=!0}return o(e,[{key:"copy",value:function(e){return this.hold=e.hold,this.lock=e.lock,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),$n=function(){function e(){i(this,e),this.up=new mn,this.up.copy(x),this.pivotOffset=new mn,this.minAzimuthalAngle=-Infinity,this.maxAzimuthalAngle=1/0,this.minPolarAngle=0,this.maxPolarAngle=nt,this.invertX=!1,this.invertY=!1}return o(e,[{key:"copy",value:function(e){return this.up.copy(e.up),this.pivotOffset.copy(e.pivotOffset),this.minAzimuthalAngle=null===e.minAzimuthalAngle?-Infinity:e.minAzimuthalAngle,this.maxAzimuthalAngle=null===e.maxAzimuthalAngle?1/0:e.maxAzimuthalAngle,this.minPolarAngle=e.minPolarAngle,this.maxPolarAngle=e.maxPolarAngle,this.invertX=e.invertX,this.invertY=e.invertY,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),ea=function(){function e(){i(this,e),this.rotation=.0025,this.translation=1,this.zoom=.1}return o(e,[{key:"copy",value:function(e){return this.rotation=e.rotation,this.translation=e.translation,this.zoom=e.zoom,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),ta=function(){function e(){i(this,e),this.enabled=!0}return o(e,[{key:"copy",value:function(e){return this.enabled=e.enabled,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),na=function(){function e(){i(this,e),this.enabled=!0,this.invert=!1,this.minDistance=1e-6,this.maxDistance=1/0}return o(e,[{key:"copy",value:function(e){return this.enabled=e.enabled,this.invert=e.invert,this.minDistance=e.minDistance,this.maxDistance=e.maxDistance,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),aa=function(){function e(){i(this,e),this.general=new Kn,this.keyBindings=new Qn,this.keyBindings.setDefault(new Map([[Wn.W,hn.MOVE_FORWARD],[Wn.UP,hn.MOVE_FORWARD],[Wn.A,hn.MOVE_LEFT],[Wn.LEFT,hn.MOVE_LEFT],[Wn.S,hn.MOVE_BACKWARD],[Wn.DOWN,hn.MOVE_BACKWARD],[Wn.D,hn.MOVE_RIGHT],[Wn.RIGHT,hn.MOVE_RIGHT],[Wn.X,hn.MOVE_DOWN],[Wn.SPACE,hn.MOVE_UP],[Wn.PAGE_DOWN,hn.ZOOM_OUT],[Wn.PAGE_UP,hn.ZOOM_IN]])),this.pointer=new Jn,this.rotation=new $n,this.sensitivity=new ea,this.translation=new ta,this.zoom=new na}return o(e,[{key:"copy",value:function(e){return this.general.copy(e.general),this.keyBindings.copy(e.keyBindings),this.pointer.copy(e.pointer),this.rotation.copy(e.rotation),this.sensitivity.copy(e.sensitivity),this.translation.copy(e.translation),this.zoom.copy(e.zoom),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"toDataURL",value:function(){return URL.createObjectURL(new Blob([JSON.stringify(this)],{type:"text/json"}))}}]),e}(),ia=function(){function e(){i(this,e)}return o(e,[{key:"execute",value:function(){throw new Error("Strategy#execute method not implemented!")}}]),e}(),ra=function(e){function t(e,n){var a;return i(this,t),a=A(this,k(t).call(this)),a.movementState=e,a.direction=n,a}return g(t,e),o(t,[{key:"execute",value:function(e){var t=this.movementState;switch(this.direction){case sa.FORWARD:t.forward=e;break;case sa.LEFT:t.left=e;break;case sa.BACKWARD:t.backward=e;break;case sa.RIGHT:t.right=e;break;case sa.DOWN:t.down=e;break;case sa.UP:t.up=e;}}}]),t}(ia),sa={FORWARD:0,LEFT:1,BACKWARD:2,RIGHT:3,DOWN:4,UP:5},oa=function(e){function t(e,n){var a;return i(this,t),a=A(this,k(t).call(this)),a.rotationManager=e,a.zoomIn=n,a}return g(t,e),o(t,[{key:"execute",value:function(e){e&&this.rotationManager.zoom(this.zoomIn?-1:1)}}]),t}(ia),la=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:document.body;i(this,e),this.dom=a,this.position=t,this.quaternion=n,this.target=new mn,this.settings=new aa,this.rotationManager=new jn(t,n,this.target,this.settings),this.translationManager=new Zn(t,n,this.target,this.settings),this.strategies=function(e,t){var n=t.movementState;return new Map([[hn.MOVE_FORWARD,new ra(n,sa.FORWARD)],[hn.MOVE_LEFT,new ra(n,sa.LEFT)],[hn.MOVE_BACKWARD,new ra(n,sa.BACKWARD)],[hn.MOVE_RIGHT,new ra(n,sa.RIGHT)],[hn.MOVE_DOWN,new ra(n,sa.DOWN)],[hn.MOVE_UP,new ra(n,sa.UP)],[hn.ZOOM_OUT,new oa(e,!1)],[hn.ZOOM_IN,new oa(e,!0)]])}(this.rotationManager,this.translationManager),this.lastScreenPosition=new xn,this.dragging=!1,this.enabled=!1,null!==t&&null!==n&&(this.lookAt(this.target),null!==a&&this.setEnabled())}return o(e,[{key:"getDom",value:function(){return this.dom}},{key:"getPosition",value:function(){return this.position}},{key:"getQuaternion",value:function(){return this.quaternion}},{key:"getTarget",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn;return e.copy(this.target),this.settings.general.orbit||e.add(this.position),e}},{key:"getViewDirection",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn;return this.rotationManager.getViewDirection(e)}},{key:"setDom",value:function(e){var t=this.enabled;return null!==e&&(t&&this.setEnabled(!1),this.dom=e,this.setEnabled(t)),this}},{key:"setPosition",value:function(e){return this.position=e,this.rotationManager.setPosition(e),this.translationManager.setPosition(e),this.lookAt(this.target)}},{key:"setQuaternion",value:function(e){return this.quaternion=e,this.rotationManager.setQuaternion(e),this.translationManager.setQuaternion(e),this.lookAt(this.target)}},{key:"setTarget",value:function(e){return this.target=e,this.rotationManager.setTarget(e),this.translationManager.setTarget(e),this.lookAt(this.target)}},{key:"setOrbitEnabled",value:function(e){var t=this.settings.general;return t.orbit!==e&&(this.getTarget(this.target),t.orbit=e,this.lookAt(this.target)),this}},{key:"copy",value:function(e){return this.dom=e.getDom(),this.position=e.getPosition(),this.quaternion=e.getQuaternion(),this.target=e.getTarget(),this.settings.copy(e.settings),this.rotationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.translationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.lookAt(this.target)}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"handlePointerMoveEvent",value:function(e){var t=this.settings,n=t.pointer,a=t.sensitivity,i=this.rotationManager,r=this.lastScreenPosition,s,o;document.pointerLockElement===this.dom?(!n.hold||this.dragging)&&i.adjustSpherical(e.movementX*a.rotation,e.movementY*a.rotation).updateQuaternion():(s=e.screenX-r.x,o=e.screenY-r.y,r.set(e.screenX,e.screenY),i.adjustSpherical(s*a.rotation,o*a.rotation).updateQuaternion())}},{key:"handleTouchMoveEvent",value:function(e){var t=this.settings.sensitivity,n=this.rotationManager,a=this.lastScreenPosition,i=e.touches[0],r=i.screenX-a.x,s=i.screenY-a.y;a.set(i.screenX,i.screenY),e.preventDefault(),n.adjustSpherical(r*t.rotation,s*t.rotation).updateQuaternion()}},{key:"handleMainPointerButton",value:function(e,t){this.dragging=t,this.settings.pointer.lock?this.setPointerLocked():t?(this.lastScreenPosition.set(e.screenX,e.screenY),this.dom.addEventListener("mousemove",this)):this.dom.removeEventListener("mousemove",this)}},{key:"handleAuxiliaryPointerButton",value:function(){}},{key:"handleSecondaryPointerButton",value:function(){}},{key:"handlePointerButtonEvent",value:function(e,t){switch(e.preventDefault(),e.button){case qn.MAIN:this.handleMainPointerButton(e,t);break;case qn.AUXILIARY:this.handleAuxiliaryPointerButton(e,t);break;case qn.SECONDARY:this.handleSecondaryPointerButton(e,t);}}},{key:"handleTouchEvent",value:function(e,t){var n=e.touches[0];e.preventDefault(),t?(this.lastScreenPosition.set(n.screenX,n.screenY),this.dom.addEventListener("touchmove",this)):this.dom.removeEventListener("touchmove",this)}},{key:"handleKeyboardEvent",value:function(e,t){var n=this.settings.keyBindings;n.has(e.keyCode)&&(e.preventDefault(),this.strategies.get(n.get(e.keyCode)).execute(t))}},{key:"handleWheelEvent",value:function(e){this.rotationManager.zoom(tt(e.deltaY))}},{key:"handlePointerLockEvent",value:function(){document.pointerLockElement===this.dom?this.dom.addEventListener("mousemove",this):this.dom.removeEventListener("mousemove",this)}},{key:"handleEvent",value:function(e){switch(e.type){case"mousemove":this.handlePointerMoveEvent(e);break;case"touchmove":this.handleTouchMoveEvent(e);break;case"mousedown":this.handlePointerButtonEvent(e,!0);break;case"mouseup":this.handlePointerButtonEvent(e,!1);break;case"touchstart":this.handleTouchEvent(e,!0);break;case"touchend":this.handleTouchEvent(e,!1);break;case"keydown":this.handleKeyboardEvent(e,!0);break;case"keyup":this.handleKeyboardEvent(e,!1);break;case"wheel":this.handleWheelEvent(e);break;case"pointerlockchange":this.handlePointerLockEvent();}}},{key:"update",value:function(e){this.rotationManager.update(e),this.translationManager.update(e)}},{key:"moveTo",value:function(e){return this.rotationManager.moveTo(e),this}},{key:"lookAt",value:function(e){return this.rotationManager.lookAt(e),this}},{key:"setPointerLocked",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];e?document.pointerLockElement!==this.dom&&void 0!==this.dom.requestPointerLock&&this.dom.requestPointerLock():void 0!==document.exitPointerLock&&document.exitPointerLock()}},{key:"setEnabled",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=this.dom;return this.translationManager.movementState.reset(),e&&!this.enabled?(document.addEventListener("pointerlockchange",this),document.body.addEventListener("keyup",this),document.body.addEventListener("keydown",this),t.addEventListener("mousedown",this),t.addEventListener("mouseup",this),t.addEventListener("touchstart",this),t.addEventListener("touchend",this),t.addEventListener("wheel",this)):!e&&this.enabled&&(document.removeEventListener("pointerlockchange",this),document.body.removeEventListener("keyup",this),document.body.removeEventListener("keydown",this),t.removeEventListener("mousedown",this),t.removeEventListener("mouseup",this),t.removeEventListener("touchstart",this),t.removeEventListener("touchend",this),t.removeEventListener("wheel",this),t.removeEventListener("mousemove",this),t.removeEventListener("touchmove",this)),this.setPointerLocked(!1),this.enabled=e,this}},{key:"dispose",value:function(){this.setEnabled(!1)}}]),e}(),ua=0,da=function(t){var a=Math.cbrt;function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,s=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3],o=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],l;i(this,n),l=A(this,k(n).call(this)),l.name="HermiteDataHelper",l.cellPosition=t,l.cellSize=a,l.data=r,l.pointsMaterial=new e.PointsMaterial({vertexColors:e.VertexColors,sizeAttenuation:!0,size:.05}),l.add(new e.Group),l.add(new e.Group),l.add(new e.Group),l.gridPoints.name="GridPoints",l.edges.name="Edges",l.normals.name="Normals";try{l.update(s,o)}catch(t){}return l}return g(n,t),o(n,[{key:"validate",value:function(){var e=null;return null===this.cellPosition?e=new Error("The cell position is not defined"):0>=this.cellSize?e=new Error("Invalid cell size: "+this.cellSize):null===this.data?e=new Error("No data"):(this.data.empty&&(e=new Error("The provided data is empty")),this.data.compressed&&(e=new Error("The provided data must be uncompressed"))),e}},{key:"set",value:function(e,t,n){return this.cellPosition=e,this.cellSize=t,this.data=n,this}},{key:"update",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=this.data,a=this.validate();if(this.dispose(),null!==a)throw a;else e&&this.createPoints(n),t&&null!==n.edgeData&&this.createEdges(n);return this}},{key:"createPoints",value:function(t){var r=t.materialIndices,o=a(r.length)-1,n=this.cellSize,s=this.cellPosition,l=new e.Vector3,u=new e.Vector3,d=new Float32Array([0,0,0]),c=new e.BufferGeometry,h=t.materials,m=new Float32Array(3*h),p=new Float32Array(3*h),g,v,f,k,_;for(k=0,_=0,f=0;f<=o;++f)for(l.z=f*n/o,v=0;v<=o;++v)for(l.y=v*n/o,g=0;g<=o;++g)l.x=g*n/o,r[k++]!==ua&&(u.addVectors(s,l),m[_]=u.x,p[_++]=d[0],m[_]=u.y,p[_++]=d[1],m[_]=u.z,p[_++]=d[2]);c.addAttribute("position",new e.BufferAttribute(m,3)),c.addAttribute("color",new e.BufferAttribute(p,3)),this.gridPoints.add(new e.Points(c,this.pointsMaterial))}},{key:"createEdges",value:function(t){var r=t.edgeData,o=a(t.materialIndices.length)-1,n=this.cellSize,s=new e.Vector3,l=new e.Vector3,u=[r.edgesX(this.cellPosition,this.cellSize),r.edgesY(this.cellPosition,this.cellSize),r.edgesZ(this.cellPosition,this.cellSize)],c=[new Float32Array([.6,0,0]),new Float32Array([0,.6,0]),new Float32Array([0,0,.6])],y=new Float32Array([0,1,1]),h=new e.LineBasicMaterial({vertexColors:e.VertexColors}),m,p,g,v,f,x,k,z,_,b,w,S;for(w=0,S=0,b=0;3>b;++b,w=0,S=0)if(x=c[b],z=u[b],0<z.lengths.length){f=2*z.lengths[0],m=new Float32Array(3*f),p=new Float32Array(3*f),g=new Float32Array(3*f),v=new Float32Array(3*f);var E=!0,A=!1,C=void 0;try{for(var P=z[Symbol.iterator](),T;!(E=(T=P.next()).done);E=!0)_=T.value,m[w]=_.a.x,p[w++]=x[0],m[w]=_.a.y,p[w++]=x[1],m[w]=_.a.z,p[w++]=x[2],m[w]=_.b.x,p[w++]=x[0],m[w]=_.b.y,p[w++]=x[1],m[w]=_.b.z,p[w++]=x[2],_.computeZeroCrossingPosition(s),l.copy(s).addScaledVector(_.n,.25*n/o),g[S]=s.x,v[S++]=y[0],g[S]=s.y,v[S++]=y[1],g[S]=s.z,v[S++]=y[2],g[S]=l.x,v[S++]=y[0],g[S]=l.y,v[S++]=y[1],g[S]=l.z,v[S++]=y[2]}catch(e){A=!0,C=e}finally{try{E||null==P["return"]||P["return"]()}finally{if(A)throw C}}k=new e.BufferGeometry,k.addAttribute("position",new e.BufferAttribute(m,3)),k.addAttribute("color",new e.BufferAttribute(p,3)),this.edges.add(new e.LineSegments(k,h)),k=new e.BufferGeometry,k.addAttribute("position",new e.BufferAttribute(g,3)),k.addAttribute("color",new e.BufferAttribute(v,3)),this.normals.add(new e.LineSegments(k,h))}}},{key:"dispose",value:function(){var e,t,n,a;for(n=0,a=this.children.length;n<a;++n)for(e=this.children[n],t=e.children;0<t.length;)t[0].geometry.dispose(),t[0].material.dispose(),e.remove(t[0])}},{key:"gridPoints",get:function(){return this.children[0]}},{key:"edges",get:function(){return this.children[1]}},{key:"normals",get:function(){return this.children[2]}}],[{key:"air",set:function(e){ua=e}}]),n}(e.Group),ca=function(t){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t;return i(this,n),t=A(this,k(n).call(this)),t.name="OctreeHelper",t.octree=e,t.update(),t}return g(n,t),o(n,[{key:"createLineSegments",value:function(t,a){var r=ht(2,16)/8-1,s=new e.Group,o=new e.LineBasicMaterial({color:16777215*Math.random()}),l,u,y,h,m,p,g,v,f,x,k,z,_,b,w,S;for(x=0,y=0,b=ut(a/8191);0<b;--b){for(y+=8191>a?a:8191,a-=8191,u=8*y,h=new Uint16Array(3*u),m=new Float32Array(3*u),(z=0,_=0,l=t.next());!l.done&&x<y;){for(p=l.value,g=p.min,v=p.max,k=0;12>k;++k)S=ha[k],h[_++]=z+S[0],h[_++]=z+S[1];for(k=0;8>k;++k,++z)w=ya[k],m[3*z]=0===w[0]?g.x:v.x,m[3*z+1]=0===w[1]?g.y:v.y,m[3*z+2]=0===w[2]?g.z:v.z;++x<y&&(l=t.next())}f=new e.BufferGeometry,f.setIndex(new e.BufferAttribute(h,1)),f.addAttribute("position",new e.BufferAttribute(m,3)),s.add(new e.LineSegments(f,o))}this.add(s)}},{key:"update",value:function(){var e=null===this.octree?-1:this.octree.getDepth(),t=0,n;for(this.dispose();t<=e;)n=this.octree.findOctantsByLevel(t),this.createLineSegments(n[Symbol.iterator](),"number"==typeof n.size?n.size:n.length),++t}},{key:"dispose",value:function(){var e=this.children,t,n,a,r,s,o;for(a=0,s=e.length;a<s;++a){for(t=e[a],n=t.children,(r=0,o=n.length);r<o;++r)n[r].geometry.dispose(),n[r].material.dispose();for(;0<n.length;)t.remove(n[0])}for(;0<e.length;)this.remove(e[0])}}]),n}(e.Group),ya=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],ha=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],ma=function(){function e(){i(this,e)}return o(e,[{key:"serialize",value:function(){}}]),e}(),pa=function(){function e(){i(this,e)}return o(e,[{key:"deserialize",value:function(){}}]),e}(),ga=function(){function e(){i(this,e)}return o(e,[{key:"dispose",value:function(){}}]),e}(),va=function(){function e(){i(this,e)}return o(e,[{key:"createTransferList",value:function(){}}]),e}(),fa=function(){function e(){i(this,e),this.elements=[],this.head=0}return o(e,[{key:"copy",value:function(e){return this.elements=Array.from(e.elements),this.head=e.head,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"add",value:function(e){this.elements.push(e)}},{key:"peek",value:function(){return 0<this.elements.length?this.elements[this.head]:void 0}},{key:"poll",value:function(){var e=this.elements,t=e.length,n;return 0<t&&(n=e[this.head++],2*this.head>=t&&(this.elements=e.slice(this.head),this.head=0)),n}},{key:"clear",value:function(){this.elements=[],this.head=0}},{key:"size",get:function(){return this.elements.length-this.head}},{key:"empty",get:function(){return 0===this.elements.length}}]),e}(),xa={UNION:"csg.union",DIFFERENCE:"csg.difference",INTERSECTION:"csg.intersection",DENSITY_FUNCTION:"csg.densityfunction"},ka={AIR:0,SOLID:1},za=function(){function e(t){i(this,e),this.type=t;for(var n=arguments.length,a=Array(1<n?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];this.children=a,this.boundingBox=null}return o(e,[{key:"getBoundingBox",value:function(){return null===this.boundingBox&&(this.boundingBox=this.computeBoundingBox()),this.boundingBox}},{key:"computeBoundingBox",value:function(){var e=this.children,t=new v,n,a;for(n=0,a=e.length;n<a;++n)t.union(e[n].getBoundingBox());return t}}]),e}(),_a=function(e){function t(){var e;i(this,t);for(var n=arguments.length,a=Array(n),r=0;r<n;r++)a[r]=arguments[r];return A(this,(e=k(t)).call.apply(e,[this,xa.UNION].concat(a)))}return g(t,e),o(t,[{key:"updateMaterialIndex",value:function(e,t,n){var a=n.materialIndices[e];a!==ka.AIR&&t.setMaterialIndex(e,a)}},{key:"selectEdge",value:function(e,t,n){return n?e.t>t.t?e:t:e.t<t.t?e:t}}]),t}(za),ba=function(e){function t(){var e;i(this,t);for(var n=arguments.length,a=Array(n),r=0;r<n;r++)a[r]=arguments[r];return A(this,(e=k(t)).call.apply(e,[this,xa.DIFFERENCE].concat(a)))}return g(t,e),o(t,[{key:"updateMaterialIndex",value:function(e,t,n){n.materialIndices[e]!==ka.AIR&&t.setMaterialIndex(e,ka.AIR)}},{key:"selectEdge",value:function(e,t,n){return n?e.t<t.t?e:t:e.t>t.t?e:t}}]),t}(za),wa=function(e){function t(){var e;i(this,t);for(var n=arguments.length,a=Array(n),r=0;r<n;r++)a[r]=arguments[r];return A(this,(e=k(t)).call.apply(e,[this,xa.INTERSECTION].concat(a)))}return g(t,e),o(t,[{key:"updateMaterialIndex",value:function(e,t,n){var a=n.materialIndices[e];t.setMaterialIndex(e,t.materialIndices[e]!==ka.AIR&&a!==ka.AIR?a:ka.AIR)}},{key:"selectEdge",value:function(e,t,n){return n?e.t<t.t?e:t:e.t>t.t?e:t}}]),t}(za),Sa=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;i(this,e),this.runLengths=t,this.data=n}return o(e,null,[{key:"encode",value:function(t){var n=[],a=[],r=t[0],s=1,o,u;for(o=1,u=t.length;o<u;++o)r===t[o]?++s:(n.push(s),a.push(r),r=t[o],s=1);return n.push(s),a.push(r),new e(n,a)}},{key:"decode",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],a=0,r,s,o,l,u;for(s=0,l=t.length;s<l;++s)for(r=t[s],o=0,u=e[s];o<u;++o)n[a++]=r;return n}}]),e}(),Ea=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];i(this,e),this.value=t,this.done=n}return o(e,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),e}(),Aa=new mn,Ca=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new mn;i(this,e),this.min=t,this.max=n,this.children=null}return o(e,[{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn;return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn;return e.subVectors(this.max,this.min)}},{key:"split",value:function(){var e=this.min,t=this.max,n=this.getCenter(Aa),a=this.children=[null,null,null,null,null,null,null,null],r,s;for(r=0;8>r;++r)s=Pa[r],a[r]=new this.constructor(new mn(0===s[0]?e.x:n.x,0===s[1]?e.y:n.y,0===s[2]?e.z:n.z),new mn(0===s[0]?n.x:t.x,0===s[1]?n.y:t.y,0===s[2]?n.z:t.z))}}]),e}(),Pa=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],Ta=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],Ia=new mn,Da=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;i(this,e),this.min=t,this.size=n,this.children=null}return o(e,[{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn;return e.copy(this.min).addScalar(.5*this.size)}},{key:"getDimensions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn;return e.set(this.size,this.size,this.size)}},{key:"split",value:function(){var e=this.min,t=this.getCenter(Ia),n=.5*this.size,a=this.children=[null,null,null,null,null,null,null,null],r,s;for(r=0;8>r;++r)s=Pa[r],a[r]=new this.constructor(new mn(0===s[0]?e.x:t.x,0===s[1]?e.y:t.y,0===s[2]?e.z:t.z),n)}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}]),e}(),Oa=new v,La=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;i(this,e),this.octree=t,this.region=n,this.cull=null!==n,this.result=new Ea,this.trace=null,this.indices=null,this.reset()}return o(e,[{key:"reset",value:function(){var e=this.octree.root;return this.trace=[],this.indices=[],null!==e&&(Oa.min=e.min,Oa.max=e.max,(!this.cull||this.region.intersectsBox(Oa))&&(this.trace.push(e),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var e=this.cull,t=this.region,n=this.indices,a=this.trace,i=null,r=a.length-1,s,o,l;null===i&&0<=r;)if(s=n[r]++,o=a[r].children,!(8>s))a.pop(),n.pop(),--r;else if(null!==o){if(l=o[s],e&&(Oa.min=l.min,Oa.max=l.max,!t.intersectsBox(Oa)))continue;a.push(l),n.push(0),++r}else i=a.pop(),n.pop();return this.result.value=i,this.result.done=null===i,this.result}},{key:"return",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),Fa=[new mn,new mn,new mn],Ma=new v,Ba=new Rn,r=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],Ra=0,Va=function(){function e(){i(this,e)}return o(e,null,[{key:"intersectOctree",value:function(e,t,n){var a=Ma.min.set(0,0,0),i=Ma.max.subVectors(e.max,e.min),r=e.getDimensions(Fa[0]),s=Fa[1].copy(r).multiplyScalar(.5),o=Ba.origin.copy(t.ray.origin),l=Ba.direction.copy(t.ray.direction),u,d,c,y,h,m,p,g,v;o.sub(e.getCenter(Fa[2])).add(s),Ra=0,0>l.x&&(o.x=r.x-o.x,l.x=-l.x,Ra|=4),0>l.y&&(o.y=r.y-o.y,l.y=-l.y,Ra|=2),0>l.z&&(o.z=r.z-o.z,l.z=-l.z,Ra|=1),u=1/l.x,d=1/l.y,c=1/l.z,y=(a.x-o.x)*u,h=(i.x-o.x)*u,m=(a.y-o.y)*d,p=(i.y-o.y)*d,g=(a.z-o.z)*c,v=(i.z-o.z)*c,ct(ct(y,m),g)<yt(yt(h,p),v)&&de(e.root,y,m,g,h,p,v,t,n)}}]),e}(),Na=new v,Ua=function(){function e(t,n){i(this,e),this.root=void 0!==t&&void 0!==n?new Ca(t,n):null}return o(e,[{key:"getCenter",value:function(e){return this.root.getCenter(e)}},{key:"getDimensions",value:function(e){return this.root.getDimensions(e)}},{key:"getDepth",value:function(){return ce(this.root)}},{key:"cull",value:function(e){var t=[];return ye(this.root,e,t),t}},{key:"findOctantsByLevel",value:function(e){var t=[];return he(this.root,e,0,t),t}},{key:"raycast",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return Va.intersectOctree(this,e,t),t}},{key:"leaves",value:function(e){return new La(this,e)}},{key:Symbol.iterator,value:function(){return new La(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),e}(),qa=new mn,p=function(e){function t(e,n){var a;return i(this,t),a=A(this,k(t).call(this,e,n)),a.points=null,a.data=null,a}return g(t,e),o(t,[{key:"distanceToSquared",value:function(e){var t=qa.copy(e).clamp(this.min,this.max);return t.sub(e).lengthSquared()}},{key:"distanceToCenterSquared",value:function(e){var t=this.getCenter(qa),n=e.x-t.x,a=e.y-t.x,i=e.z-t.z;return n*n+a*a+i*i}},{key:"contains",value:function(e,t){var n=this.min,a=this.max;return e.x>=n.x-t&&e.y>=n.y-t&&e.z>=n.z-t&&e.x<=a.x+t&&e.y<=a.y+t&&e.z<=a.z+t}},{key:"redistribute",value:function(e){var t=this.children,n=this.points,a=this.data,r,s,o,l,u,d,c;if(null!==t&&null!==n)for(r=0,o=n.length;r<o;++r)for(d=n[r],c=a[r],(s=0,l=t.length);s<l;++s)if(u=t[s],u.contains(d,e)){null===u.points&&(u.points=[],u.data=[]),u.points.push(d),u.data.push(c);break}this.points=null,this.data=null}},{key:"merge",value:function(){var e=this.children,t,n,a;if(null!==e){for(this.points=[],this.data=[],(t=0,n=e.length);t<n;++t)if(a=e[t],null!==a.points){var r,s;(r=this.points).push.apply(r,D(a.points)),(s=this.data).push.apply(s,D(a.data))}this.children=null}}}]),t}(Ca),Ya=function e(t,n,a){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;i(this,e),this.distance=t,this.distanceToRay=n,this.point=a,this.object=r},Xa=function(e){function t(e,n){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:8,o;return i(this,t),o=A(this,k(t).call(this)),o.root=new p(e,n),o.bias=ct(0,a),o.maxPoints=ct(1,mt(r)),o.maxDepth=ct(0,mt(s)),o.pointCount=0,o}return g(t,e),o(t,[{key:"countPoints",value:function(e){return me(e)}},{key:"put",value:function(e,t){return pe(e,t,this,this.root,0)}},{key:"remove",value:function(e){return ge(e,this,this.root,null)}},{key:"fetch",value:function(e){return ve(e,this,this.root)}},{key:"move",value:function(e,t){return fe(e,t,this,this.root,null,0)}},{key:"findNearestPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0,n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],a=xe(e,t,n,this.root);return null!==a&&(a.point=a.point.clone()),a}},{key:"findPoints",value:function(e,t){var n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],a=[];return ke(e,t,n,this.root,a),a}},{key:"raycast",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],a=P(k(t.prototype),"raycast",this).call(this,e);return 0<a.length&&this.testPoints(a,e,n),n}},{key:"testPoints",value:function(e,t,n){var a=t.params.Points.threshold,r,s,o,l,u,d,c,y,h,m,p;for(u=0,c=e.length;u<c;++u)if(h=e[u],m=h.points,null!==m)for(d=0,y=m.length;d<y;++d)p=m[d],l=t.ray.distanceSqToPoint(p),l<a*a&&(r=t.ray.closestPointToPoint(p,new mn),s=t.ray.origin.distanceTo(r),s>=t.near&&s<=t.far&&(o=rt(l),n.push(new Ya(s,o,r,h.data[d]))))}}]),t}(Ua),ja=new v,Ha=new mn,Ga=new mn,u=new mn,Za=function(){function e(){i(this,e)}return o(e,null,[{key:"recycleOctants",value:function(e,t){var n=e.min,a=e.getCenter(Ga),r=e.getDimensions(u).multiplyScalar(.5),s=e.children,o=t.length,l,d,c,y;for(l=0;8>l;++l)for(c=Pa[l],ja.min.addVectors(n,Ha.fromArray(c).multiply(r)),ja.max.addVectors(a,Ha.fromArray(c).multiply(r)),d=0;d<o;++d)if(y=t[d],null!==y&&ja.min.equals(y.min)&&ja.max.equals(y.max)){s[l]=y,t[d]=null;break}}}]),e}(),Wa=new mn,Ka=new mn,Qa=new mn,Ja=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new mn;i(this,e),this.a=t,this.b=n,this.index=-1,this.coordinates=new mn,this.t=0,this.n=new mn}return o(e,[{key:"approximateZeroCrossing",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,n=ct(1,t-1),r=0,s=1,o=0,l=0,u,d;for(Wa.subVectors(this.b,this.a);l<=n&&(o=(r+s)/2,Ka.addVectors(this.a,Qa.copy(Wa).multiplyScalar(o)),d=e.sample(Ka),!(dt(d)<=1e-4||(s-r)/2<=1e-6));)Ka.addVectors(this.a,Qa.copy(Wa).multiplyScalar(r)),u=e.sample(Ka),tt(d)===tt(u)?r=o:s=o,++l;this.t=o}},{key:"computeZeroCrossingPosition",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn;return e.subVectors(this.b,this.a).multiplyScalar(this.t).add(this.a)}},{key:"computeSurfaceNormal",value:function(e){var t=this.computeZeroCrossingPosition(Wa),n=1e-3,a=e.sample(Ka.addVectors(t,Qa.set(n,0,0)))-e.sample(Ka.subVectors(t,Qa.set(n,0,0))),i=e.sample(Ka.addVectors(t,Qa.set(0,n,0)))-e.sample(Ka.subVectors(t,Qa.set(0,n,0))),r=e.sample(Ka.addVectors(t,Qa.set(0,0,n)))-e.sample(Ka.subVectors(t,Qa.set(0,0,n)));this.n.set(a,i,r).normalize()}}]),e}(),$a=new Ja,ei=new mn,ti=new mn,ni=function(){function e(t,n,a){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:3;i(this,e),this.edgeData=t,this.cellPosition=n,this.cellSize=a,this.indices=null,this.zeroCrossings=null,this.normals=null,this.axes=null,this.lengths=null,this.result=new Ea,this.initialC=r,this.c=r,this.initialD=s,this.d=s,this.i=0,this.l=0,this.reset()}return o(e,[{key:"reset",value:function(){var e=this.edgeData,t=[],n=[],i=[],r=[],s=[],o,u,y,h;for(this.i=0,this.c=0,this.d=0,(u=this.initialC,o=4>>u,y=this.initialD);u<y;++u,o>>=1)h=e.indices[u].length,0<h&&(t.push(e.indices[u]),n.push(e.zeroCrossings[u]),i.push(e.normals[u]),r.push(Pa[o]),s.push(h),++this.d);return this.l=0<s.length?s[0]:0,this.indices=t,this.zeroCrossings=n,this.normals=i,this.axes=r,this.lengths=s,this.result.reset(),this}},{key:"next",value:function(){var e=this.cellSize,t=this.edgeData.resolution,n=t+1,a=n*n,r=this.result,s=this.cellPosition,o,l,u,d,h,m,p;return this.i===this.l&&(this.l=++this.c<this.d?this.lengths[this.c]:0,this.i=0),this.i<this.l?(m=this.c,p=this.i,o=this.axes[m],l=this.indices[m][p],$a.index=l,u=l%n,d=et(l%a/n),h=et(l/a),$a.coordinates.set(u,d,h),ei.set(u*e/t,d*e/t,h*e/t),ti.set((u+o[0])*e/t,(d+o[1])*e/t,(h+o[2])*e/t),$a.a.addVectors(s,ei),$a.b.addVectors(s,ti),$a.t=this.zeroCrossings[m][p],$a.n.fromArray(this.normals[m],3*p),r.value=$a,++this.i):(r.value=null,r.done=!0),r}},{key:"return",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),ai=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:n;i(this,e),this.resolution=t,this.indices=0>=n?null:[new Uint32Array(n),new Uint32Array(a),new Uint32Array(r)],this.zeroCrossings=0>=n?null:[new Float32Array(n),new Float32Array(a),new Float32Array(r)],this.normals=0>=n?null:[new Float32Array(3*n),new Float32Array(3*a),new Float32Array(3*r)]}return o(e,[{key:"serialize",value:function(){return{resolution:this.resolution,edges:this.edges,zeroCrossings:this.zeroCrossings,normals:this.normals}}},{key:"deserialize",value:function(e){var t=this;return null===e?t=null:(this.resolution=e.resolution,this.edges=e.edges,this.zeroCrossings=e.zeroCrossings,this.normals=e.normals),t}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=[this.edges[0],this.edges[1],this.edges[2],this.zeroCrossings[0],this.zeroCrossings[1],this.zeroCrossings[2],this.normals[0],this.normals[1],this.normals[2]],n,a,r;for(a=0,r=t.length;a<r;++a)n=t[a],null!==n&&e.push(n.buffer);return e}},{key:"edges",value:function(e,t){return new ni(this,e,t)}},{key:"edgesX",value:function(e,t){return new ni(this,e,t,0,1)}},{key:"edgesY",value:function(e,t){return new ni(this,e,t,1,2)}},{key:"edgesZ",value:function(e,t){return new ni(this,e,t,2,3)}}],[{key:"calculate1DEdgeCount",value:function(e){return ht(e+1,2)*e}}]),e}(),ii=0,ri=0,si=0,oi=function(){function e(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];i(this,e),this.materials=0,this.materialIndices=t?new Uint8Array(si):null,this.runLengths=null,this.edgeData=null}return o(e,[{key:"set",value:function(e){return this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,this.edgeData=e.edgeData,this}},{key:"clear",value:function(){return this.materials=0,this.materialIndices=null,this.runLengths=null,this.edgeData=null,this}},{key:"setMaterialIndex",value:function(e,t){this.materialIndices[e]===ka.AIR?t!==ka.AIR&&++this.materials:t===ka.AIR&&--this.materials,this.materialIndices[e]=t}},{key:"compress",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this,t;return this.compressed?(e.materialIndices=this.materialIndices,e.runLengths=this.runLengths):(t=this.full?new Sa([this.materialIndices.length],[ka.SOLID]):Sa.encode(this.materialIndices),e.materialIndices=new Uint8Array(t.data),e.runLengths=new Uint32Array(t.runLengths)),e.materials=this.materials,e}},{key:"decompress",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this;return e.materialIndices=this.compressed?Sa.decode(this.runLengths,this.materialIndices,new Uint8Array(si)):this.materialIndices,e.runLengths=null,e.materials=this.materials,e}},{key:"serialize",value:function(){return{materials:this.materials,materialIndices:this.materialIndices,runLengths:this.runLengths,edgeData:null===this.edgeData?null:this.edgeData.serialize()}}},{key:"deserialize",value:function(e){var t=this;return null===e?t=null:(this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,null===e.edgeData?this.edgeData=null:(null===this.edgeData&&(this.edgeData=new ai(ri)),this.edgeData.deserialize(e.edgeData))),t}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.edgeData&&this.edgeData.createTransferList(e),null!==this.materialIndices&&e.push(this.materialIndices.buffer),null!==this.runLengths&&e.push(this.runLengths.buffer),e}},{key:"empty",get:function(){return 0===this.materials}},{key:"full",get:function(){return this.materials===si}},{key:"compressed",get:function(){return null!==this.runLengths}},{key:"neutered",get:function(){return!this.empty&&null===this.materialIndices}}],[{key:"isovalue",get:function(){return ii},set:function(e){ii=e}},{key:"resolution",get:function(){return ri},set:function(e){e=ht(2,ct(0,ut($e(e)))),ri=ct(1,yt(256,e)),si=ht(ri+1,3)}}]),e}(),li=function(e){function t(e){var n;return i(this,t),n=A(this,k(t).call(this,xa.DENSITY_FUNCTION)),n.sdf=e,n}return g(t,e),o(t,[{key:"computeBoundingBox",value:function(){return this.sdf.getBoundingBox(!0)}},{key:"generateMaterialIndex",value:function(e){return this.sdf.sample(e)<=oi.isovalue?this.sdf.material:ka.AIR}},{key:"generateEdge",value:function(e){e.approximateZeroCrossing(this.sdf),e.computeSurfaceNormal(this.sdf)}}]),t}(za),ui=new c,di=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:ka.SOLID;i(this,e),this.type=t,this.operation=null,this.material=yt(255,ct(ka.SOLID,et(n))),this.boundingBox=null,this.position=new mn,this.quaternion=new En,this.scale=new mn(1,1,1),this.inverseTransformation=new c,this.updateInverseTransformation(),this.children=[]}return o(e,[{key:"getTransformation",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new c;return e.compose(this.position,this.quaternion,this.scale)}},{key:"getBoundingBox",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t=this.children,n=this.boundingBox,a,r;if(null===n&&(n=this.computeBoundingBox(),this.boundingBox=n),e)for(n=n.clone(),a=0,r=t.length;a<r;++a)n.union(t[a].getBoundingBox(e));return n}},{key:"setMaterial",value:function(e){return this.material=yt(255,ct(ka.SOLID,et(e))),this}},{key:"setOperationType",value:function(e){return this.operation=e,this}},{key:"updateInverseTransformation",value:function(){return this.inverseTransformation.getInverse(this.getTransformation(ui)),this.boundingBox=null,this}},{key:"union",value:function(e){return this.children.push(e.setOperationType(xa.UNION)),this}},{key:"subtract",value:function(e){return this.children.push(e.setOperationType(xa.DIFFERENCE)),this}},{key:"intersect",value:function(e){return this.children.push(e.setOperationType(xa.INTERSECTION)),this}},{key:"toCSG",value:function(){var e=this.children,t=new li(this),n,a,r,s;for(r=0,s=e.length;r<s;++r)a=e[r],n!==a.operation&&(n=a.operation,n===xa.UNION?t=new _a(t):n===xa.DIFFERENCE?t=new ba(t):n===xa.INTERSECTION?t=new wa(t):void 0),t.children.push(a.toCSG());return t}},{key:"serialize",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t={type:this.type,operation:this.operation,material:this.material,position:this.position.toArray(),quaternion:this.quaternion.toArray(),scale:this.scale.toArray(),parameters:null,children:[]},n,a;for(n=0,a=this.children.length;n<a;++n)t.children.push(this.children[n].serialize(e));return t}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e}},{key:"toJSON",value:function(){return this.serialize(!0)}},{key:"computeBoundingBox",value:function(){throw new Error("SignedDistanceFunction#computeBoundingBox method not implemented!")}},{key:"sample",value:function(){throw new Error("SignedDistanceFunction#sample method not implemented!")}}]),e}(),ci={HEIGHTFIELD:"sdf.heightfield",FRACTAL_NOISE:"sdf.fractalnoise",SUPER_PRIMITIVE:"sdf.superprimitive"},yi=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length?arguments[1]:void 0,a;return i(this,t),a=A(this,k(t).call(this,ci.PERLIN_NOISE,n)),a.min=S(mn,D(e.min)),a.max=S(mn,D(e.max)),a}return g(t,e),o(t,[{key:"computeBoundingBox",value:function(){return this.bbox=new v(this.min,this.max),this.bbox}},{key:"sample",value:function(){}},{key:"serialize",value:function(){var e=P(k(t.prototype),"serialize",this).call(this);return e.parameters={min:this.min.toArray(),max:this.max.toArray()},e}}]),t}(di),hi=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length?arguments[1]:void 0,a;return i(this,t),a=A(this,k(t).call(this,ci.HEIGHTFIELD,n)),a.width=void 0===e.width?1:e.width,a.height=void 0===e.height?1:e.height,a.smooth=void 0===e.smooth||e.smooth,a.data=void 0===e.data?null:e.data,a.heightmap=null,void 0!==e.image&&a.fromImage(e.image),a}return g(t,e),o(t,[{key:"fromImage",value:function(e){var t="undefined"==typeof document?null:ze(e),n=null,a,r,s,o;if(null!==t){for(a=t.data,n=new Uint8ClampedArray(a.length/4),(r=0,s=0,o=n.length);r<o;++r,s+=4)n[r]=a[s];this.heightmap=e,this.width=t.width,this.height=t.height,this.data=n}return this}},{key:"getHeight",value:function(e,t){var n=this.width,i=this.height,r=this.data,s;if(e=mt(e*n),t=mt(t*i),this.smooth){e=ct(yt(e,n-1),1),t=ct(yt(t,i-1),1);var o=e+1,l=e-1,u=t*n,a=u+n,d=u-n;s=(r[d+l]+r[d+e]+r[d+o]+r[u+l]+r[u+e]+r[u+o]+r[a+l]+r[a+e]+r[a+o])/9}else s=r[t*n+e];return s}},{key:"computeBoundingBox",value:function(){var e=new v,t=yt(this.width/this.height,1),n=yt(this.height/this.width,1);return e.min.set(0,0,0),e.max.set(t,1,n),e.applyMatrix4(this.getTransformation()),e}},{key:"sample",value:function(e){var t=this.boundingBox,n;return t.containsPoint(e)?(e.applyMatrix4(this.inverseTransformation),n=e.y-this.getHeight(e.x,e.z)/255):n=t.distanceToPoint(e),n}},{key:"serialize",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],n=P(k(t.prototype),"serialize",this).call(this);return n.parameters={width:this.width,height:this.height,smooth:this.smooth,data:e?null:this.data,dataURL:e&&null!==this.heightmap?this.heightmap.toDataURL():null,image:null},n}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.data.buffer),e}}]),t}(di),mi=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length?arguments[1]:void 0,a;return i(this,t),a=A(this,k(t).call(this,ci.SUPER_PRIMITIVE,n)),a.s0=S(Un,D(e.s)),a.r0=S(mn,D(e.r)),a.s=new Un,a.r=new mn,a.ba=new xn,a.offset=0,a.precompute(),a}return g(t,e),o(t,[{key:"setSize",value:function(e,t,n,a){return this.s0.set(e,t,n,a),this.precompute()}},{key:"setRadii",value:function(e,t,n){return this.r0.set(e,t,n),this.precompute()}},{key:"precompute",value:function(){var e=this.s.copy(this.s0),t=this.r.copy(this.r0),n=this.ba;e.x-=t.x,e.y-=t.x,t.x-=e.w,e.w-=t.y,e.z-=t.y,this.offset=-2*e.z,n.set(t.z,this.offset);var a=n.dot(n);return 0===a?n.set(0,-1):n.divideScalar(a),this}},{key:"computeBoundingBox",value:function(){var e=this.s0,t=new v;return t.min.x=yt(-e.x,-1),t.min.y=yt(-e.y,-1),t.min.z=yt(-e.z,-1),t.max.x=ct(e.x,1),t.max.y=ct(e.y,1),t.max.z=ct(e.z,1),t.applyMatrix4(this.getTransformation()),t}},{key:"sample",value:function(e){e.applyMatrix4(this.inverseTransformation);var t=this.s,n=this.r,a=this.ba,i=dt(e.x)-t.x,r=dt(e.y)-t.y,s=dt(e.z)-t.z,o=ct(i,0),l=ct(r,0),u=rt(o*o+l*l),d=e.z-t.z,y=dt(u+yt(0,ct(i,r))-n.x)-t.w,h=yt(ct(y*a.x+d*a.y,0),1),c=y-n.z*h,m=d-this.offset*h,p=ct(y-n.z,0),g=e.z+t.z,v=ct(y,0),f=y*-a.y+d*a.x,x=rt(yt(c*c+m*m,yt(p*p+g*g,v*v+d*d)));return x*tt(ct(f,s))-n.y}},{key:"serialize",value:function(){var e=P(k(t.prototype),"serialize",this).call(this);return e.parameters={s:this.s0.toArray(),r:this.r0.toArray()},e}}],[{key:"create",value:function(e){var n=pi[e];return new t({s:n[0],r:n[1]})}}]),t}(di),pi=[[new Float32Array([1,1,1,1]),new Float32Array([0,0,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,0,0])],[new Float32Array([0,0,1,1]),new Float32Array([0,0,1])],[new Float32Array([1,1,2,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,.25,1]),new Float32Array([1,.25,0])],[new Float32Array([1,1,.25,.25]),new Float32Array([1,.25,0])],[new Float32Array([1,1,1,.25]),new Float32Array([1,.1,0])],[new Float32Array([1,1,1,.25]),new Float32Array([.1,.1,0])]],gi={CUBE:0,CYLINDER:1,CONE:2,PILL:3,SPHERE:4,PELLET:5,TORUS:6,PIPE:7,CORRIDOR:8},vi=function(){function e(){i(this,e)}return o(e,[{key:"revive",value:function(e){var t,n,a;switch(e.type){case ci.FRACTAL_NOISE:t=new yi(e.parameters,e.material);break;case ci.HEIGHTFIELD:t=new hi(e.parameters,e.material);break;case ci.SUPER_PRIMITIVE:t=new mi(e.parameters,e.material);}for(t.operation=e.operation,t.position.fromArray(e.position),t.quaternion.fromArray(e.quaternion),t.scale.fromArray(e.scale),t.updateInverseTransformation(),(n=0,a=e.children.length);n<a;++n)t.children.push(this.revive(e.children[n]));return t}}]),e}(),fi=function(e){function t(e){var n;return i(this,t),n=A(this,k(t).call(this,e)),n.descriptions=null,n}return g(t,e),t}(gt),xi=new fi("load"),ki=function(e){function t(){var e;return i(this,t),e=A(this,k(t).call(this)),e.items=0,e.descriptions=null,e.imageMap=new WeakMap,e}return g(t,e),o(t,[{key:"clear",value:function(){this.imageMap=new WeakMap}},{key:"handleEvent",value:function(e){switch(e.type){case"load":this.progress(e);}}},{key:"progress",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=null===e?null:e.target,n=this.imageMap,a;null!==t&&(n.has(t)&&(a=n.get(t),a.image=t),--this.items),0===this.items&&(this.clear(),xi.descriptions=this.descriptions,this.dispatchEvent(xi))}},{key:"loadImage",value:function(e){var t=new Image;this.imageMap.set(t,e),++this.items,t.addEventListener("load",this),t.src=e.dataURL}},{key:"inflate",value:function(e){var t;null!==e.dataURL&&this.loadImage(e);var n=!0,a=!1,i=void 0;try{for(var r=e.children[Symbol.iterator](),s;!(n=(s=r.next()).done);n=!0)t=s.value,this.inflate(t)}catch(e){a=!0,i=e}finally{try{n||null==r["return"]||r["return"]()}finally{if(a)throw i}}this.progress()}},{key:"load",value:function(e){var t;this.items=0,this.descriptions=e;var n=!0,a=!1,i=void 0;try{for(var r=e[Symbol.iterator](),s;!(n=(s=r.next()).done);n=!0)t=s.value,this.inflate(t)}catch(e){a=!0,i=e}finally{try{n||null==r["return"]||r["return"]()}finally{if(a)throw i}}}}]),t}(vt),zi=function(){function e(){i(this,e)}return o(e,null,[{key:"parseBin",value:function(e){return parseInt(e,2)}},{key:"createBinaryString",value:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:64,n=0>e?"-":"",a=dt(e).toString(2);a.length<t;)a="0"+a;return n+a}}]),e}(),_i=function(){function e(t,n,a){i(this,e),this.keyDesign=t,this.min=n,this.max=a,this.keyBase=new mn,this.key=new mn,this.limit=new mn,this.result=new Ea,this.reset()}return o(e,[{key:"reset",value:function(){var e=this.keyDesign,t=this.min,n=this.max;return t.x<=n.x&&t.y<=n.y&&t.z<=n.z?(this.keyBase.set(t.x,t.y*e.rangeX,t.z*e.rangeXY),this.limit.set(n.x,n.y*e.rangeX,n.z*e.rangeXY),this.key.copy(this.keyBase)):(this.keyBase.set(1,1,1),this.limit.set(0,0,0),this.key.copy(this.keyBase),console.error("Invalid key range",t,n)),this.result.reset(),this}},{key:"next",value:function(){var e=this.result,t=this.keyDesign,n=this.keyBase,a=this.limit,i=this.key;return i.z<=a.z?(e.value=i.z+i.y+i.x,++i.x,i.x>a.x&&(i.x=n.x,i.y+=t.rangeX,i.y>a.y&&(i.y=n.y,i.z+=t.rangeXY))):(e.value=null,e.done=!0),e}},{key:"return",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),bi=32,wi=ht(2,bi),Si=53,Ei=32,Ai=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:mt(.4*Si),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:mt(.2*Si),a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t;i(this,e),this.x=0,this.y=0,this.z=0,this.rangeX=0,this.rangeY=0,this.rangeZ=0,this.rangeXY=0,this.halfRange=null,this.maskX=[0,0],this.maskY=[0,0],this.maskZ=[0,0],this.set(t,n,a)}return o(e,[{key:"set",value:function(e,t,n){(e+t+n>Si||e>bi||t>bi||n>bi)&&(console.warn("Invalid bit allotment"),e=mt(.4*Si),t=mt(.2*Si),n=e),this.x=e,this.y=t,this.z=n,this.rangeX=ht(2,e),this.rangeY=ht(2,t),this.rangeZ=ht(2,n),this.rangeXY=ht(2,e+t),this.halfRange=new mn(this.rangeX/2,this.rangeY/2,this.rangeZ/2),this.updateBitMasks()}},{key:"updateBitMasks",value:function(){var e=this.x,t=this.y,n=this.z,a=this.maskX,i=this.maskY,r=this.maskZ,s=bi-ct(0,e-Ei),o=bi-ct(0,t+e-Ei),l=bi-ct(0,n+t+e-Ei);a[1]=s<bi?-1>>>s:0,a[0]=-1>>>ct(0,Ei-e),i[1]=((o<bi?-1>>>o:0)&~a[1])>>>0,i[0]=(-1>>>ct(0,Ei-(e+t))&~a[0])>>>0,r[1]=((l<bi?-1>>>l:0)&~i[1]&~a[1])>>>0,r[0]=(-1>>>ct(0,Ei-(e+t+n))&~i[0]&~a[0])>>>0}},{key:"unpackKey",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new mn,n=this.maskX,a=this.maskY,i=this.maskZ,r=et(e/wi),s=e%wi;return t.set((r&n[1])*wi+((s&n[0])>>>0),((r&a[1])*wi+((s&a[0])>>>0))/this.rangeX,((r&i[1])*wi+((s&i[0])>>>0))/this.rangeXY)}},{key:"packKey",value:function(e){return e.z*this.rangeXY+e.y*this.rangeX+e.x}},{key:"keyRange",value:function(e,t){return new _i(this,e,t)}},{key:"toString",value:function(){var e=this.maskX,t=this.maskY,n=this.maskZ;return"Key Design\n\nX-Bits: "+this.x+"\nY-Bits: "+this.y+"\nZ-Bits: "+this.z+"\n\n"+zi.createBinaryString(e[1],bi)+" "+e[1]+" (HI-Mask X)\n"+zi.createBinaryString(e[0],bi)+" "+e[0]+" (LO-Mask X)\n\n"+zi.createBinaryString(t[1],bi)+" "+t[1]+" (HI-Mask Y)\n"+zi.createBinaryString(t[0],bi)+" "+t[0]+" (LO-Mask Y)\n\n"+zi.createBinaryString(n[1],bi)+" "+n[1]+" (HI-Mask Z)\n"+zi.createBinaryString(n[0],bi)+" "+n[0]+" (LO-Mask Z)\n"}}],[{key:"BITS",get:function(){return Si}},{key:"HI_BITS",get:function(){return 21}},{key:"LO_BITS",get:function(){return Ei}}]),e}(),Ci=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;i(this,e),this.lod=t,this.key=n}return o(e,[{key:"set",value:function(e,t){this.lod=e,this.key=t}},{key:"copy",value:function(e){return this.lod=e.lod,this.key=e.key,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),Pi=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Ci;i(this,e),this.octant=t,this.id=n,this.min=new mn,this.max=new mn}return o(e,[{key:"copy",value:function(e){return this.octant=e.octant,this.id.copy(e.id),this.min.copy(e.min),this.max.copy(e.max),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn;return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new mn;return e.subVectors(this.max,this.min)}},{key:"containsPoint",value:function(e){var t=this.min,n=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=n.x&&e.y<=n.y&&e.z<=n.z}}]),e}(),Ti=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;i(this,e),this.world=t,this.cellSize=0,this.iterator=null,this.octantWrapper=new Pi,this.octantWrapper.id.lod=n,this.result=new Ea,this.reset()}return o(e,[{key:"reset",value:function(){var e=this.octantWrapper.id.lod,t=this.world,n=t.getGrid(e);return void 0===n?console.error("Invalid LOD",e):(this.cellSize=t.getCellSize(e),this.iterator=n.entries(),this.result.reset()),this}},{key:"next",value:function(){var e=this.result,t=this.octantWrapper,n=this.iterator.next(),a=n.value;return n.done?(e.value=null,e.done=!0):(this.keyDesign.unpackKey(a[0],t.min),t.min.multiplyScalar(this.cellSize).add(this.world.min),t.max.copy(t.min).addScalar(this.cellSize),t.id.key=a[0],t.octant=a[1],e.value=t),e}},{key:"return",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),Ii=function e(){i(this,e),this.data=null,this.csg=new fa,this.isosurface=null},Di=function(e){function t(){var e;return i(this,t),e=A(this,k(t).call(this)),e.children=0,e}return g(t,e),t}(Ii),Oi=new mn,Li=new mn,Fi=new v,Mi=new v,Bi=new v,Ri=[],Vi=function(){function e(){i(this,e)}return o(e,null,[{key:"applyUnion",value:function(e,t,n){var r=e.getKeyDesign(),s=e.lodZero,o=Mi.min,a=Mi.max,l=Bi.min,u=Bi.max,d,c,y,h,m,p;for(m=e.getDepth();0<m;--m){y=e.getGrid(m),e.calculateKeyCoordinates(t.min,m,o),e.calculateKeyCoordinates(t.max,m,a),e.calculateKeyCoordinates(t.min,m-1,l),e.calculateKeyCoordinates(t.max,m-1,u);var g=!0,v=!1,f=void 0;try{for(var x=r.keyRange(o,a)[Symbol.iterator](),k;!(g=(k=x.next()).done);g=!0)if(d=k.value,!y.has(d))for(h=new Di,h.csg.add(n),y.set(d,h),r.unpackKey(d,Li),Li.x<<=1,Li.y<<=1,Li.z<<=1,p=0;8>p;++p)c=Pa[p],Oi.set(Li.x+c[0],Li.y+c[1],Li.z+c[2]),Bi.containsPoint(Oi)&&(h.children|=1<<p)}catch(e){v=!0,f=e}finally{try{g||null==x["return"]||x["return"]()}finally{if(v)throw f}}}e.calculateKeyCoordinates(t.min,0,o),e.calculateKeyCoordinates(t.max,0,a);var z=!0,_=!1,b=void 0;try{for(var w=r.keyRange(o,a)[Symbol.iterator](),S;!(z=(S=w.next()).done);z=!0)d=S.value,s.has(d)?h=s.get(d):(h=new Ii,s.set(d,h)),h.csg.add(n)}catch(e){_=!0,b=e}finally{try{z||null==w["return"]||w["return"]()}finally{if(_)throw b}}}},{key:"applyDifference",value:function(e,t,n){var r=e.getDepth(),s=e.getKeyDesign(),o=e.getGrid(r),u=e.calculateKeyCoordinates(t.min,r,Mi.min),a=e.calculateKeyCoordinates(t.max,r,Mi.max),d,c,y,h;for(d=0,c=r-1;d<c;++d)d<Ri.length?(y=Ri[d],e.calculateKeyCoordinates(t.min,d,y.min),e.calculateKeyCoordinates(t.max,d,y.max)):Ri.push(new v(e.calculateKeyCoordinates(t.min,d),e.calculateKeyCoordinates(t.max,d)));var m=!0,p=!1,g=void 0;try{for(var f=s.keyRange(u,a)[Symbol.iterator](),x;!(m=(x=f.next()).done);m=!0)h=x.value,o.has(h)&&(s.unpackKey(h,Li),_e(e,n,o.get(h),Li.x,Li.y,Li.z,r))}catch(e){p=!0,g=e}finally{try{m||null==f["return"]||f["return"]()}finally{if(p)throw g}}}},{key:"applyIntersection",value:function(e,t){var n,a;for(n=e.getDepth();0<=n;--n){var i=!0,r=!1,s=void 0;try{for(var o=e.getGrid(n).values()[Symbol.iterator](),l;!(i=(l=o.next()).done);i=!0)a=l.value,a.csg.add(t)}catch(e){r=!0,s=e}finally{try{i||null==o["return"]||o["return"]()}finally{if(r)throw s}}}}},{key:"applyCSG",value:function(e,t){var n=Fi.copy(t.getBoundingBox(!0));switch(n.min.max(e.min),n.max.min(e.max),t.operation){case xa.UNION:this.applyUnion(e,n,t);break;case xa.DIFFERENCE:this.applyDifference(e,n,t);break;case xa.INTERSECTION:this.applyIntersection(e,t);break;default:console.error("No CSG operation type specified",t);}}}]),e}(),Ni=new mn,Ui=new On,l=new v,qi=new v,d=new Rn,Yi=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],Xi=0,ji=function(){function e(){i(this,e)}return o(e,null,[{key:"intersectWorldOctree",value:function(e,i){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],s=e.getDepth(),o=e.getGrid(s),l=e.getCellSize(s),u=e.getKeyDesign(),c=new Pi,y=Ui.start,h=Ui.end,m=e.containsPoint(d.copy(i).origin)?d.origin:d.intersectBox(e,d.origin),a,p,g,v,f,x,k,z,_,w,S,E,A,C,P,T,I,D,O,L;if(c.id.lod=s,null!==m)for(g=l<<1,v=d.at(g,Ni),e.calculateKeyCoordinates(m,s,y),e.calculateKeyCoordinates(v,s,h),x=h.x-y.x,k=h.y-y.y,z=h.z-y.z,P=tt(x),T=tt(k),I=tt(z),_=dt(x),w=dt(k),S=dt(z),E=2*_,A=2*w,C=2*S,D=w-_,O=S-_,L=w-S,f=_+w+S;0<f;--f)a=u.packKey(y),o.has(a)&&(p=o.get(a),c.id.key=a,c.octant=p,c.min.copy(y),c.min.multiplyScalar(l),c.min.add(e.min),c.max.copy(c.min).addScalar(l),null===p.isosurface?Ee(e,c,y,i,r):r.push(c.clone())),0>D?0>O?(y.x+=P,D+=A,O+=C):(y.z+=I,O-=E,L+=A):0>L?(y.z+=I,O-=E,L+=A):(y.y+=T,D-=E,L-=C);return r}}]),e}(),Hi=new mn,Gi=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:20,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Ai;for(i(this,e),n=ct(yt(et(n),32),1),this.cellSize=ct(yt(et(t),ht(2,33-n)-1),1),this.keyDesign=a,this.grids=[];this.grids.length<n;)this.grids.push(new Map);this.bounds=new Pi,this.bounds.min.copy(this.keyDesign.halfRange).multiplyScalar(-this.cellSize),this.bounds.max.copy(this.keyDesign.halfRange).multiplyScalar(this.cellSize)}return o(e,[{key:"getKeyDesign",value:function(){return this.keyDesign}},{key:"getCellSize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return this.cellSize<<e>>>0}},{key:"getCenter",value:function(e){return this.bounds.getCenter(e)}},{key:"setCenter",value:function(e){this.min.copy(this.keyDesign.halfRange).multiplyScalar(-this.cellSize).add(e),this.max.copy(this.keyDesign.halfRange).multiplyScalar(this.cellSize).add(e)}},{key:"getDimensions",value:function(e){return this.bounds.getDimensions(e)}},{key:"getDepth",value:function(){return this.grids.length-1}},{key:"getGrid",value:function(e){return 0<=e&&e<this.grids.length?this.grids[e]:void 0}},{key:"clear",value:function(){var e,t;for(e=0,t=this.grids.length;e<t;++e)this.grids[e].clear()}},{key:"containsPoint",value:function(e){return this.bounds.containsPoint(e)}},{key:"findOctantsByLevel",value:function(e){return this.octants(e)}},{key:"calculateKeyCoordinates",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new mn,a=this.cellSize<<t;return Hi.subVectors(e,this.min),n.set(et(Hi.x/a),et(Hi.y/a),et(Hi.z/a)),n}},{key:"getOctantByPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.keyDesign,a=this.getGrid(t),i;return void 0===a?console.error("Invalid LOD",t):this.containsPoint(e)?(this.calculateKeyCoordinates(e,t,Hi),i=a.get(n.packKey(Hi))):console.error("Position out of range",e),i}},{key:"removeOctant",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.keyDesign,a=this.getGrid(t),i,r,s;void 0===a?console.error("Invalid LOD",t):a.has(e)?(n.unpackKey(e,Hi),i=Hi.x,r=Hi.y,s=Hi.z,Ae(this,a.get(e),i,r,s,t),a["delete"](e),Ce(this,i,r,s,t)):console.error("No octant found",e)}},{key:"applyCSG",value:function(e){Vi.applyCSG(this,e)}},{key:"raycast",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return ji.intersectWorldOctree(this,e,t)}},{key:"octants",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return new Ti(this,e)}},{key:"min",get:function(){return this.bounds.min}},{key:"max",get:function(){return this.bounds.max}},{key:"levels",get:function(){return this.grids.length}},{key:"lodZero",get:function(){return this.grids[0]}}],[{key:"calculateOffsetIndex",value:function(e,t,n){return((1&e)<<2)+((1&t)<<1)+(1&n)}}]),e}(),Zi=function(){function e(){i(this,e)}return o(e,[{key:"clone",value:function(){return new this.constructor(this.levels)}},{key:"levels",get:function(){return this.something.length}}]),e}(),Wi=function(e){function t(e){var n;return i(this,t),n=A(this,k(t).call(this,e)),n.lod=-1,n.left=null,n.entered=null,n.error=null,n}return g(t,e),t}(gt),Ki=new Wi("update"),Qi=new Wi("error"),Ji=new v,$i=new Tn,f=new c,er=function(e){function t(e){var n;return i(this,t),n=A(this,k(t).call(this)),n.world=e,n.position=new mn(1/0,1/0,1/0),n.currentScene=new Zi(n.world.levels),n.previousScene=n.currentScene.clone(),n.nextScene=n.currentScene.clone(),n}return g(t,e),o(t,[{key:"update",value:function(e){var t=this.position;t.copy(e.position),$i.setFromMatrix(f.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse))}},{key:"process",value:function(){}},{key:"clear",value:function(){this.previousScene.clear(),this.currentScene.clear(),this.nextScene.clear()}}]),t}(vt),tr={EXTRACT:"worker.extract",MODIFY:"worker.modify",CONFIGURE:"worker.config",CLOSE:"worker.close"},nr=function e(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null;i(this,e),this.action=t,this.error=null},ar=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n;return i(this,t),n=A(this,k(t).call(this,e)),n.data=null,n}return g(t,e),t}(nr),ir=function(e){function t(){return i(this,t),A(this,k(t).call(this,tr.EXTRACT))}return g(t,e),t}(ar),rr=function(e){function t(){var e;return i(this,t),e=A(this,k(t).call(this,tr.MODIFY)),e.sdf=null,e.cellSize=0,e.cellPosition=null,e}return g(t,e),t}(ar),sr=function(e){function t(){var e;return i(this,t),e=A(this,k(t).call(this,tr.CONFIGURE)),e.resolution=oi.resolution,e.errorThreshold=.01,e}return g(t,e),t}(nr),or=function(e){function t(){var e;return i(this,t),e=A(this,k(t).call(this,tr.EXTRACT)),e.isosurface=null,e}return g(t,e),t}(ar),lr=function(e){function t(){var e;return i(this,t),e=A(this,k(t).call(this,tr.MODIFY)),e.sdf=null,e}return g(t,e),t}(ar),ur=function(e){function t(e){var n;return i(this,t),n=A(this,k(t).call(this,e)),n.worker=null,n.response=null,n}return g(t,e),t}(gt),dr=new ur("message"),cr=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:navigator.hardwareConcurrency,n;return i(this,t),n=A(this,k(t).call(this)),n.workerURL=URL.createObjectURL(new Blob(["function _typeof(e){return _typeof=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},_typeof(e)}(function(){'use strict';var ue=Math.pow,ce=Math.trunc,me=Math.sign,xe=Math.PI,pe=Math.atan2,ve=Math.round,ge=Math.acos,ke=Math.sqrt,he=Math.cos,ze=Math.sin,fe=Math.floor,Se=Math.ceil,we=Math.abs,Te=Math.max,Ie=Math.min;function e(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function t(e,t){for(var a,n=0;n<t.length;n++)a=t[n],a.enumerable=a.enumerable||!1,a.configurable=!0,\"value\"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function n(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function y(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function x(){return x=y()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var a=Function.bind.apply(e,i),l=new a;return n&&d(l,n.prototype),l},x.apply(null,arguments)}function g(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}function k(e,t){return t&&(\"object\"===_typeof(t)||\"function\"==typeof t)?t:g(e)}function h(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=s(e),null!==e););return e}function z(e,t,a){return z=\"undefined\"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var n=h(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(a):i.value}},z(e,t,a||e)}function f(e,t,a,n){return f=\"undefined\"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,a,n){var l,o=h(e,t);if(o){if(l=Object.getOwnPropertyDescriptor(o,t),l.set)return l.set.call(n,a),!0;if(!l.writable)return!1}if(l=Object.getOwnPropertyDescriptor(n,t),l){if(!l.writable)return!1;l.value=a,Object.defineProperty(n,t,l)}else i(n,t,a);return!0},f(e,t,a,n)}function S(e,t,a,n,i){var l=f(e,t,a,n||e);if(!l&&i)throw new Error(\"failed to set property\");return a}function w(e){return T(e)||I(e)||C()}function T(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}}function I(e){if(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e))return Array.from(e)}function C(){throw new TypeError(\"Invalid attempt to spread non-iterable instance\")}function P(e,t,a){return Te(Ie(e,a),t)}function E(e,t,a,n,i,l){var o=0;return e>t&&e>a?(i<e&&(o|=2),l<e&&(o|=1)):t>a?(n<t&&(o|=4),l<t&&(o|=1)):(n<a&&(o|=4),i<a&&(o|=2)),o}function D(e,t,a,n){var i,l=0;return t<a?(i=t,l=0):(i=a,l=1),n<i&&(l=2),r[e][l]}function F(e,t,a,n,i,l,o,s,r){var d,y,u,c,m=e.children;if(0<=i&&0<=l&&0<=o)if(null===m)r.push(e);else{y=.5*(t+i),u=.5*(a+l),c=.5*(n+o),d=E(t,a,n,y,u,c);do 0===d?(F(m[mt],t,a,n,y,u,c,s,r),d=D(d,y,u,c)):1===d?(F(m[1^mt],t,a,c,y,u,o,s,r),d=D(d,y,u,o)):2===d?(F(m[2^mt],t,u,n,y,l,c,s,r),d=D(d,y,l,c)):3===d?(F(m[3^mt],t,u,c,y,l,o,s,r),d=D(d,y,l,o)):4===d?(F(m[4^mt],y,a,n,i,u,c,s,r),d=D(d,i,u,c)):5===d?(F(m[5^mt],y,a,c,i,u,o,s,r),d=D(d,i,u,o)):6===d?(F(m[6^mt],y,u,n,i,l,c,s,r),d=D(d,i,l,c)):7===d?(F(m[7^mt],y,u,c,i,l,o,s,r),d=8):void 0;while(8>d)}}function A(e){var t,a,n,o=e.children,s=0;if(null!==o)for(t=0,a=o.length;t<a;++t)n=1+A(o[t]),n>s&&(s=n);return s}function V(e,t,a){var n,o,s=e.children;if(pt.min=e.min,pt.max=e.max,t.intersectsBox(pt))if(null!==s)for(n=0,o=s.length;n<o;++n)V(s[n],t,a);else a.push(e)}function B(e,t,a,n){var o,s,r=e.children;if(a===t)n.push(e);else if(null!==r)for(++a,o=0,s=r.length;o<s;++o)B(r[o],t,a,n)}function N(e){var t,a,n=e.children,o=0;if(null!==n)for(t=0,a=n.length;t<a;++t)o+=N(n[t]);else null!==e.points&&(o=e.points.length);return o}function O(e,t,a,n,o){var s,r,d=n.children,y=!1,u=!1;if(n.contains(e,a.bias)){if(null===d){if(null===n.points)n.points=[],n.data=[];else for(s=0,r=n.points.length;!y&&s<r;++s)y=n.points[s].equals(e);y?(n.data[s-1]=t,u=!0):n.points.length<a.maxPoints||o===a.maxDepth?(n.points.push(e.clone()),n.data.push(t),++a.pointCount,u=!0):(n.split(),n.redistribute(a.bias),d=n.children)}if(null!==d)for(++o,s=0,r=d.length;!u&&s<r;++s)u=O(e,t,a,d[s],o)}return u}function L(e,t,a,n){var o,s,r,d,y,u=a.children,c=null;if(a.contains(e,t.bias))if(null!==u)for(o=0,s=u.length;null===c&&o<s;++o)c=L(e,t,u[o],a);else if(null!==a.points)for(r=a.points,d=a.data,(o=0,s=r.length);o<s;++o)if(r[o].equals(e)){y=s-1,c=d[o],o<y&&(r[o]=r[y],d[o]=d[y]),r.pop(),d.pop(),--t.pointCount,null!==n&&N(n)<=t.maxPoints&&n.merge();break}return c}function M(e,t,a){var n,o,s,r=a.children,d=null;if(a.contains(e,t.bias))if(null!==r)for(n=0,o=r.length;null===d&&n<o;++n)d=M(e,t,r[n]);else if(null!==a.points)for(s=a.points,n=0,o=s.length;null===d&&n<o;++n)e.equals(s[n])&&(d=a.data[n]);return d}function R(e,t,a,n,o,s){var r,d,y,u=n.children,c=null;if(n.contains(e,a.bias))if(!n.contains(t,a.bias))c=L(e,a,n,o),O(t,c,a,o,s-1);else if(null!==u)for(++s,r=0,d=u.length;null===c&&r<d;++r)c=R(e,t,a,u[r],n,s);else if(null!==n.points)for(y=n.points,r=0,d=y.length;r<d;++r)if(e.equals(y[r])){y[r].copy(t),c=n.data[r];break}return c}function Y(e,t,a,n){var o,s,r=null,d=t;if(null!==n.children){var y,u,c=n.children.map(function(t){return{octant:t,distance:t.distanceToCenterSquared(e)}}).sort(function(e,t){return e.distance-t.distance});for(o=0,s=c.length;o<s&&(y=c[o].octant,!(y.contains(e,d)&&(u=Y(e,d,a,y),null!==u&&(d=u.distance,r=u,0===d))));++o);}else if(null!==n.points){var m,x=n.points,p=-1;for(o=0,s=x.length;o<s;++o)if(!x[o].equals(e))m=e.distanceTo(x[o]),m<d&&(d=m,p=o);else if(!a){d=0,p=o;break}0<=p&&(r={point:x[p],data:n.data[p],distance:d})}return r}function X(e,t,a,n,o){var s,r,d=n.children;if(null!==d){var y;for(s=0,r=d.length;s<r;++s)y=d[s],y.contains(e,t)&&X(e,t,a,y,o)}else if(null!==n.points){var u,c=n.points;for(s=0,r=c.length;s<r;++s)u=c[s],u.equals(e)?!a&&o.push({point:u.clone(),data:n.data[s]}):u.distanceToSquared(e)<=t*t&&o.push({point:u.clone(),data:n.data[s]})}}function Z(e,t){var a,n=e.elements,i=t.elements;0!==n[1]&&(a=Rt.calculateCoefficients(n[0],n[1],n[3]),Yt.rotateQXY(jt.set(n[0],n[3]),n[1],a),n[0]=jt.x,n[3]=jt.y,Yt.rotateXY(jt.set(n[2],n[4]),a),n[2]=jt.x,n[4]=jt.y,n[1]=0,Yt.rotateXY(jt.set(i[0],i[3]),a),i[0]=jt.x,i[3]=jt.y,Yt.rotateXY(jt.set(i[1],i[4]),a),i[1]=jt.x,i[4]=jt.y,Yt.rotateXY(jt.set(i[2],i[5]),a),i[2]=jt.x,i[5]=jt.y)}function _(e,t){var a,n=e.elements,i=t.elements;0!==n[2]&&(a=Rt.calculateCoefficients(n[0],n[2],n[5]),Yt.rotateQXY(jt.set(n[0],n[5]),n[2],a),n[0]=jt.x,n[5]=jt.y,Yt.rotateXY(jt.set(n[1],n[4]),a),n[1]=jt.x,n[4]=jt.y,n[2]=0,Yt.rotateXY(jt.set(i[0],i[6]),a),i[0]=jt.x,i[6]=jt.y,Yt.rotateXY(jt.set(i[1],i[7]),a),i[1]=jt.x,i[7]=jt.y,Yt.rotateXY(jt.set(i[2],i[8]),a),i[2]=jt.x,i[8]=jt.y)}function j(e,t){var a,n=e.elements,i=t.elements;0!==n[4]&&(a=Rt.calculateCoefficients(n[3],n[4],n[5]),Yt.rotateQXY(jt.set(n[3],n[5]),n[4],a),n[3]=jt.x,n[5]=jt.y,Yt.rotateXY(jt.set(n[1],n[2]),a),n[1]=jt.x,n[2]=jt.y,n[4]=0,Yt.rotateXY(jt.set(i[3],i[6]),a),i[3]=jt.x,i[6]=jt.y,Yt.rotateXY(jt.set(i[4],i[7]),a),i[4]=jt.x,i[7]=jt.y,Yt.rotateXY(jt.set(i[5],i[8]),a),i[5]=jt.x,i[8]=jt.y)}function U(t,a){var n,l=t.elements;for(n=0;n<5;++n)Z(t,a),_(t,a),j(t,a);return Ut.set(l[0],l[3],l[5])}function Q(e){var t=we(e)<Xt?0:1/e;return we(t)<Xt?0:t}function G(e,t){var a=e.elements,n=a[0],i=a[3],l=a[6],o=a[1],s=a[4],r=a[7],d=a[2],y=a[5],u=a[8],c=Q(t.x),m=Q(t.y),x=Q(t.z);return e.set(n*c*n+i*m*i+l*x*l,n*c*o+i*m*s+l*x*r,n*c*d+i*m*y+l*x*u,o*c*n+s*m*i+r*x*l,o*c*o+s*m*s+r*x*r,o*c*d+s*m*y+r*x*u,d*c*n+y*m*i+u*x*l,d*c*o+y*m*s+u*x*r,d*c*d+y*m*y+u*x*u)}function H(e,t,a){return e.applyToVector3(Gt.copy(a)),Gt.subVectors(t,Gt),Gt.dot(Gt)}function J(e,t,a){var n,l,o,s,r,d,y,u=[-1,-1,-1,-1],c=[!1,!1,!1,!1],m=1/0,x=0,p=!1;for(y=0;4>y;++y)r=e[y],d=ra[t][y],n=lt[d][0],l=lt[d][1],o=1&r.voxel.materials>>n,s=1&r.voxel.materials>>l,r.size<m&&(m=r.size,x=y,p=o!==At.AIR),u[y]=r.voxel.index,c[y]=o!==s;c[x]&&(p?(a.push(u[0]),a.push(u[3]),a.push(u[1]),a.push(u[0]),a.push(u[2]),a.push(u[3])):(a.push(u[0]),a.push(u[1]),a.push(u[3]),a.push(u[0]),a.push(u[3]),a.push(u[2])))}function K(e,t,a){var n,l,o,s,r=[0,0,0,0];if(null!==e[0].voxel&&null!==e[1].voxel&&null!==e[2].voxel&&null!==e[3].voxel)J(e,t,a);else for(o=0;2>o;++o){for(r[0]=sa[t][o][0],r[1]=sa[t][o][1],r[2]=sa[t][o][2],r[3]=sa[t][o][3],n=[],s=0;4>s;++s)if(l=e[s],null!==l.voxel)n[s]=l;else if(null!==l.children)n[s]=l.children[r[s]];else break;4===s&&K(n,sa[t][o][4],a)}}function W(e,t,a){var n,l,o,s,r,d,y=[0,0,0,0],u=[[0,0,1,1],[0,1,0,1]];if(null!==e[0].children||null!==e[1].children){for(r=0;4>r;++r)y[0]=la[t][r][0],y[1]=la[t][r][1],n=[null===e[0].children?e[0]:e[0].children[y[0]],null===e[1].children?e[1]:e[1].children[y[1]]],W(n,la[t][r][2],a);for(r=0;4>r;++r){for(y[0]=oa[t][r][1],y[1]=oa[t][r][2],y[2]=oa[t][r][3],y[3]=oa[t][r][4],o=u[oa[t][r][0]],l=[],d=0;4>d;++d)if(s=e[o[d]],null!==s.voxel)l[d]=s;else if(null!==s.children)l[d]=s.children[y[d]];else break;4===d&&K(l,oa[t][r][5],a)}}}function $(e,t){var a,n,l,o=e.children,s=[0,0,0,0];if(null!==o){for(l=0;8>l;++l)$(o[l],t);for(l=0;12>l;++l)s[0]=na[l][0],s[1]=na[l][1],a=[o[s[0]],o[s[1]]],W(a,na[l][2],t);for(l=0;6>l;++l)s[0]=ia[l][0],s[1]=ia[l][1],s[2]=ia[l][2],s[3]=ia[l][3],n=[o[s[0]],o[s[1]],o[s[2]],o[s[3]]],K(n,ia[l][4],t)}}function ee(e,t,a,n){var l,o;if(null!==e.children)for(l=0;8>l;++l)n=ee(e.children[l],t,a,n);else null!==e.voxel&&(o=e.voxel,o.index=n,t[3*n]=o.position.x,t[3*n+1]=o.position.y,t[3*n+2]=o.position.z,a[3*n]=o.normal.x,a[3*n+1]=o.normal.y,a[3*n+2]=o.normal.z,++n);return n}function te(e,t,a,l,o){var s=0;for(t>>=1;0<t;t>>=1,s=0)a>=t&&(s+=4,a-=t),l>=t&&(s+=2,l-=t),o>=t&&(s+=1,o-=t),null===e.children&&e.split(),e=e.children[s];return e}function ae(e,t,a,n,l){var o,s,r,d,y,u,c,x,p,v,g=e+1,m=new Jt;for(o=0,v=0;8>v;++v)d=it[v],y=(n+d[2])*(g*g)+(a+d[1])*g+(t+d[0]),r=Ie(l[y],At.SOLID),o|=r<<v;for(s=0,v=0;12>v;++v)u=lt[v][0],c=lt[v][1],x=1&o>>u,p=1&o>>c,x!==p&&++s;return m.materials=o,m.edgeCount=s,m.qefData=new Lt,m}function ne(e){var t=wa,a=Ot.resolution,n=new Pe(0,0,0),i=new Pe(a,a,a),l=new v(Ta,Ta.clone().addScalar(wa)),o=e.getBoundingBox();return e.type!==ka.INTERSECTION&&(o.intersectsBox(l)?(n.copy(o.min).max(l.min).sub(l.min),n.x=Se(n.x*a/t),n.y=Se(n.y*a/t),n.z=Se(n.z*a/t),i.copy(o.max).min(l.max).sub(l.min),i.x=fe(i.x*a/t),i.y=fe(i.y*a/t),i.z=fe(i.z*a/t)):(n.set(a,a,a),i.set(0,0,0))),new v(n,i)}function ie(e,t,a,i){var l,o,s,r=Ot.resolution,n=r+1,d=i.max.x,u=i.max.y,c=i.max.z;for(s=i.min.z;s<=c;++s)for(o=i.min.y;o<=u;++o)for(l=i.min.x;l<=d;++l)e.updateMaterialIndex(s*(n*n)+o*n+l,t,a)}function le(e,t,a){var i,l,o,r,d=wa,s=Ot.resolution,n=s+1,u=t.materialIndices,c=new Pe,m=new Pe,p=a.max.x,v=a.max.y,g=a.max.z,k=0;for(r=a.min.z;r<=g;++r)for(c.z=r*d/s,o=a.min.y;o<=v;++o)for(c.y=o*d/s,l=a.min.x;l<=p;++l)c.x=l*d/s,i=e.generateMaterialIndex(m.addVectors(Ta,c)),i!==At.AIR&&(u[r*(n*n)+o*n+l]=i,++k);t.materials=k}function oe(e,t,a){var l,o,s,r,y,u,x,p,v,g,k,h,z,f,S,w,T,I,C,P,b,E,D,F=Ot.resolution,n=F+1,m=new Uint32Array([1,n,n*n]),q=t.materialIndices,A=new Pt,V=new Pt,B=a.edgeData,N=t.edgeData,O=new Uint32Array(3),L=qt.calculate1DEdgeCount(F),M=new qt(F,Ie(L,N.indices[0].length+B.indices[0].length),Ie(L,N.indices[1].length+B.indices[1].length),Ie(L,N.indices[2].length+B.indices[2].length));for(I=0,C=0;3>C;I=0,++C){for(l=B.indices[C],r=N.indices[C],x=M.indices[C],o=B.zeroCrossings[C],y=N.zeroCrossings[C],p=M.zeroCrossings[C],s=B.normals[C],u=N.normals[C],v=M.normals[C],g=m[C],E=l.length,D=r.length,(P=0,b=0);P<E;++P)if(k=l[P],h=k+g,S=q[k],w=q[h],S!==w&&(S===At.AIR||w===At.AIR)){for(A.t=o[P],A.n.x=s[3*P],A.n.y=s[3*P+1],A.n.z=s[3*P+2],e.type===ka.DIFFERENCE&&A.n.negate(),T=A;b<D&&r[b]<=k;)z=r[b],f=z+g,V.t=y[b],V.n.x=u[3*b],V.n.y=u[3*b+1],V.n.z=u[3*b+2],S=q[z],z<k?(w=q[f],S!==w&&(S===At.AIR||w===At.AIR)&&(x[I]=z,p[I]=V.t,v[3*I]=V.n.x,v[3*I+1]=V.n.y,v[3*I+2]=V.n.z,++I)):T=e.selectEdge(V,A,S===At.SOLID),++b;x[I]=k,p[I]=T.t,v[3*I]=T.n.x,v[3*I+1]=T.n.y,v[3*I+2]=T.n.z,++I}for(;b<D;)z=r[b],f=z+g,S=q[z],w=q[f],S!==w&&(S===At.AIR||w===At.AIR)&&(x[I]=z,p[I]=y[b],v[3*I]=u[3*b],v[3*I+1]=u[3*b+1],v[3*I+2]=u[3*b+2],++I),++b;O[C]=I}return{edgeData:M,lengths:O}}function se(e,t,i){var l,o,r,u,p,v,g,k,h,f,S,w,T,I,C,P,b,E,D,F=wa,s=Ot.resolution,n=s+1,m=n*n,q=new Uint32Array([1,n,m]),A=t.materialIndices,V=Ta,B=new Pe,N=new Pe,O=new Pt,L=new Uint32Array(3),M=new qt(s,qt.calculate1DEdgeCount(s));for(C=4,T=0,I=0;3>I;C>>=1,T=0,++I){P=it[C],l=M.indices[I],o=M.zeroCrossings[I],r=M.normals[I],u=q[I],g=i.min.x,f=i.max.x,k=i.min.y,S=i.max.y,h=i.min.z,w=i.max.z;for(0===I?(g=Te(g-1,0),f=Ie(f,s-1)):1===I?(k=Te(k-1,0),S=Ie(S,s-1)):2===I?(h=Te(h-1,0),w=Ie(w,s-1)):void 0,D=h;D<=w;++D)for(E=k;E<=S;++E)for(b=g;b<=f;++b)p=D*m+E*n+b,v=p+u,A[p]!==A[v]&&(B.set(b*F/s,E*F/s,D*F/s),N.set((b+P[0])*F/s,(E+P[1])*F/s,(D+P[2])*F/s),O.a.addVectors(V,B),O.b.addVectors(V,N),e.generateEdge(O),l[T]=p,o[T]=O.t,r[3*T]=O.n.x,r[3*T+1]=O.n.y,r[3*T+2]=O.n.z,++T);L[I]=T}return{edgeData:M,lengths:L}}function re(e,t,a){var n,i,l,o,s=ne(e),r=!1;if(e.type===ka.DENSITY_FUNCTION?le(e,t,s):t.empty?e.type===ka.UNION&&(t.set(a),r=!0):!(t.full&&e.type===ka.UNION)&&ie(e,t,a,s),!r&&!t.empty&&!t.full){for(n=e.type===ka.DENSITY_FUNCTION?se(e,t,s):oe(e,t,a),i=n.edgeData,l=n.lengths,o=0;3>o;++o)i.indices[o]=i.indices[o].slice(0,l[o]),i.zeroCrossings[o]=i.zeroCrossings[o].slice(0,l[o]),i.normals[o]=i.normals[o].slice(0,3*l[o]);t.edgeData=i}}function de(e){var t,a,n,o,s=e.children;for(e.type===ka.DENSITY_FUNCTION&&(t=new Ot,re(e,t)),n=0,o=s.length;n<o&&(a=de(s[n]),void 0===t?t=a:null===a?e.type===ka.INTERSECTION&&(t=null):null===t?e.type===ka.UNION&&(t=a):re(e,t,a),null!==t||e.type===ka.UNION);++n);return null!==t&&t.empty?null:t}function ye(e){var t=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\"),a=t.getContext(\"2d\");return t.width=e.width,t.height=e.height,a.drawImage(e,0,0),a.getImageData(0,0,e.width,e.height)}var Ce=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;e(this,t),this.runLengths=a,this.data=n}return n(t,null,[{key:\"encode\",value:function(e){var a,n,o=[],s=[],r=e[0],d=1;for(a=1,n=e.length;a<n;++a)r===e[a]?++d:(o.push(d),s.push(r),r=e[a],d=1);return o.push(d),s.push(r),new t(o,s)}},{key:\"decode\",value:function(e,t){var a,n,l,o,s,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],d=0;for(n=0,o=t.length;n<o;++n)for(a=t[n],l=0,s=e[n];l<s;++l)r[d++]=a;return r}}]),t}(),Pe=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.x=a,this.y=n,this.z=i}return n(t,[{key:\"set\",value:function(e,t,a){return this.x=e,this.y=t,this.z=a,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:\"setFromSpherical\",value:function(e){this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:\"setFromSphericalCoords\",value:function(e,t,a){var n=ze(t)*e;return this.x=n*ze(a),this.y=he(t)*e,this.z=n*he(a),this}},{key:\"setFromCylindrical\",value:function(e){this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:\"setFromCylindricalCoords\",value:function(e,t,a){return this.x=e*ze(t),this.y=a,this.z=e*he(t),this}},{key:\"setFromMatrixColumn\",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:\"setFromMatrixPosition\",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:\"setFromMatrixScale\",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),a=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=a,this.z=n,this}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:\"addVectors\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:\"addScaledVector\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:\"subVectors\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:\"multiplyVectors\",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this}},{key:\"crossVectors\",value:function(e,t){var a=e.x,n=e.y,i=e.z,l=t.x,o=t.y,s=t.z;return this.x=n*s-i*o,this.y=i*l-a*s,this.z=a*o-n*l,this}},{key:\"cross\",value:function(e){return this.crossVectors(this,e)}},{key:\"transformDirection\",value:function(t){var a=this.x,n=this.y,i=this.z,l=t.elements;return this.x=l[0]*a+l[4]*n+l[8]*i,this.y=l[1]*a+l[5]*n+l[9]*i,this.z=l[2]*a+l[6]*n+l[10]*i,this.normalize()}},{key:\"applyMatrix3\",value:function(t){var a=this.x,n=this.y,i=this.z,l=t.elements;return this.x=l[0]*a+l[3]*n+l[6]*i,this.y=l[1]*a+l[4]*n+l[7]*i,this.z=l[2]*a+l[5]*n+l[8]*i,this}},{key:\"applyMatrix4\",value:function(t){var a=this.x,n=this.y,i=this.z,l=t.elements;return this.x=l[0]*a+l[4]*n+l[8]*i+l[12],this.y=l[1]*a+l[5]*n+l[9]*i+l[13],this.z=l[2]*a+l[6]*n+l[10]*i+l[14],this}},{key:\"applyQuaternion\",value:function(e){var t=this.x,a=this.y,n=this.z,i=e.x,l=e.y,o=e.z,s=e.w,r=s*t+l*n-o*a,d=s*a+o*t-i*n,y=s*n+i*a-l*t,u=-i*t-l*a-o*n;return this.x=r*s+u*-i+d*-o-y*-l,this.y=d*s+u*-l+y*-i-r*-o,this.z=y*s+u*-o+r*-l-d*-i,this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:\"reflect\",value:function(e){var t=e.x,a=e.y,n=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(t,a,n),this}},{key:\"angleTo\",value:function(e){var t=this.dot(e)/ke(this.lengthSquared()*e.lengthSquared());return ge(Ie(Te(t,-1),1))}},{key:\"manhattanLength\",value:function(){return we(this.x)+we(this.y)+we(this.z)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:\"length\",value:function(){return ke(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:\"manhattanDistanceTo\",value:function(e){return we(this.x-e.x)+we(this.y-e.y)+we(this.z-e.z)}},{key:\"distanceToSquared\",value:function(e){var t=this.x-e.x,a=this.y-e.y,n=this.z-e.z;return t*t+a*a+n*n}},{key:\"distanceTo\",value:function(e){return ke(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=Ie(this.x,e.x),this.y=Ie(this.y,e.y),this.z=Ie(this.z,e.z),this}},{key:\"max\",value:function(e){return this.x=Te(this.x,e.x),this.y=Te(this.y,e.y),this.z=Te(this.z,e.z),this}},{key:\"clamp\",value:function(e,t){return this.x=Te(e.x,Ie(t.x,this.x)),this.y=Te(e.y,Ie(t.y,this.y)),this.z=Te(e.z,Ie(t.z,this.z)),this}},{key:\"floor\",value:function(){return this.x=fe(this.x),this.y=fe(this.y),this.z=fe(this.z),this}},{key:\"ceil\",value:function(){return this.x=Se(this.x),this.y=Se(this.y),this.z=Se(this.z),this}},{key:\"round\",value:function(){return this.x=ve(this.x),this.y=ve(this.y),this.z=ve(this.z),this}},{key:\"lerp\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:\"lerpVectors\",value:function(e,t,a){return this.subVectors(t,e).multiplyScalar(a).add(e)}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}]),t}(),be=new Pe,o=[new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe],v=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe(1/0,1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe(-Infinity,-Infinity,-Infinity);e(this,t),this.min=a,this.max=n}return n(t,[{key:\"set\",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:\"copy\",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"makeEmpty\",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-Infinity,this}},{key:\"isEmpty\",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getSize\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:\"setFromSphere\",value:function(e){return this.set(e.center,e.center),this.expandByScalar(e.radius),this}},{key:\"expandByPoint\",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:\"expandByVector\",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:\"expandByScalar\",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:\"setFromPoints\",value:function(e){var t,a;for(this.min.set(0,0,0),this.max.set(0,0,0),(t=0,a=e.length);t<a;++t)this.expandByPoint(e[t]);return this}},{key:\"setFromCenterAndSize\",value:function(e,t){var a=be.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(a),this.max.copy(e).add(a),this}},{key:\"clampPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe;return t.copy(e).clamp(this.min,this.max)}},{key:\"distanceToPoint\",value:function(e){var t=be.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:\"applyMatrix4\",value:function(e){var t=this.min,a=this.max;return this.isEmpty()||(o[0].set(t.x,t.y,t.z).applyMatrix4(e),o[1].set(t.x,t.y,a.z).applyMatrix4(e),o[2].set(t.x,a.y,t.z).applyMatrix4(e),o[3].set(t.x,a.y,a.z).applyMatrix4(e),o[4].set(a.x,t.y,t.z).applyMatrix4(e),o[5].set(a.x,t.y,a.z).applyMatrix4(e),o[6].set(a.x,a.y,t.z).applyMatrix4(e),o[7].set(a.x,a.y,a.z).applyMatrix4(e),this.setFromPoints(o)),this}},{key:\"translate\",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:\"intersect\",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:\"union\",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:\"containsPoint\",value:function(e){var t=this.min,a=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=a.x&&e.y<=a.y&&e.z<=a.z}},{key:\"containsBox\",value:function(e){var t=this.min,a=this.max,n=e.min,i=e.max;return t.x<=n.x&&i.x<=a.x&&t.y<=n.y&&i.y<=a.y&&t.z<=n.z&&i.z<=a.z}},{key:\"intersectsBox\",value:function(e){var t=this.min,a=this.max,n=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&i.z>=t.z&&n.x<=a.x&&n.y<=a.y&&n.z<=a.z}},{key:\"intersectsSphere\",value:function(e){var t=this.clampPoint(e.center,be);return t.distanceToSquared(e.center)<=e.radius*e.radius}},{key:\"intersectsPlane\",value:function(e){var t,a;return 0<e.normal.x?(t=e.normal.x*this.min.x,a=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,a=e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,a+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,a+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,a+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,a+=e.normal.z*this.min.z),t<=-e.constant&&a>=-e.constant}},{key:\"equals\",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),t}(),Ee=new v,De=new Pe,Fe=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.center=a,this.radius=n}return n(t,[{key:\"set\",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:\"copy\",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromPoints\",value:function(e){var t,a,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Ee.setFromPoints(e).getCenter(this.center),o=0;for(t=0,a=e.length;t<a;++t)o=Te(o,n.distanceToSquared(e[t]));return this.radius=ke(o),this}},{key:\"setFromBox\",value:function(e){return e.getCenter(this.center),this.radius=.5*e.getSize(De).length(),this}},{key:\"isEmpty\",value:function(){return 0>=this.radius}},{key:\"translate\",value:function(e){return this.center.add(e),this}},{key:\"clampPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe,a=this.center.distanceToSquared(e);return t.copy(e),a>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:\"distanceToPoint\",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:\"containsPoint\",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:\"intersectsSphere\",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:\"intersectsBox\",value:function(e){return e.intersectsSphere(this)}},{key:\"intersectsPlane\",value:function(e){return we(e.distanceToPoint(this.center))<=this.radius}},{key:\"equals\",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}]),t}(),qe=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.x=a,this.y=n}return n(t,[{key:\"set\",value:function(e,t){return this.x=e,this.y=t,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this}},{key:\"addVectors\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:\"addScaledVector\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this}},{key:\"subVectors\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this}},{key:\"applyMatrix3\",value:function(t){var a=this.x,n=this.y,i=t.elements;return this.x=i[0]*a+i[3]*n+i[6],this.y=i[1]*a+i[4]*n+i[7],this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y}},{key:\"cross\",value:function(e){return this.x*e.y-this.y*e.x}},{key:\"manhattanLength\",value:function(){return we(this.x)+we(this.y)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y}},{key:\"length\",value:function(){return ke(this.x*this.x+this.y*this.y)}},{key:\"manhattanDistanceTo\",value:function(e){return we(this.x-e.x)+we(this.y-e.y)}},{key:\"distanceToSquared\",value:function(e){var t=this.x-e.x,a=this.y-e.y;return t*t+a*a}},{key:\"distanceTo\",value:function(e){return ke(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=Ie(this.x,e.x),this.y=Ie(this.y,e.y),this}},{key:\"max\",value:function(e){return this.x=Te(this.x,e.x),this.y=Te(this.y,e.y),this}},{key:\"clamp\",value:function(e,t){return this.x=Te(e.x,Ie(t.x,this.x)),this.y=Te(e.y,Ie(t.y,this.y)),this}},{key:\"floor\",value:function(){return this.x=fe(this.x),this.y=fe(this.y),this}},{key:\"ceil\",value:function(){return this.x=Se(this.x),this.y=Se(this.y),this}},{key:\"round\",value:function(){return this.x=ve(this.x),this.y=ve(this.y),this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:\"angle\",value:function e(){var e=pe(this.y,this.x);return 0>e&&(e+=2*xe),e}},{key:\"lerp\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:\"lerpVectors\",value:function(e,t,a){return this.subVectors(t,e).multiplyScalar(a).add(e)}},{key:\"rotateAround\",value:function(e,t){var a=he(t),n=ze(t),i=this.x-e.x,l=this.y-e.y;return this.x=i*a-l*n+e.x,this.y=i*n+l*a+e.y,this}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y}},{key:\"width\",get:function(){return this.x},set:function(e){return this.x=e}},{key:\"height\",get:function(){return this.y},set:function(e){return this.y=e}}]),t}(),Ae=new qe,Ve=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new qe(1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new qe(-Infinity,-Infinity);e(this,t),this.min=a,this.max=n}return n(t,[{key:\"set\",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:\"copy\",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"makeEmpty\",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-Infinity,this}},{key:\"isEmpty\",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new qe;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getSize\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new qe;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:\"getBoundingSphere\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Fe;return this.getCenter(e.center),e.radius=.5*this.getSize(Ae).length(),e}},{key:\"expandByPoint\",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:\"expandByVector\",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:\"expandByScalar\",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:\"setFromPoints\",value:function(e){var t,a;for(this.min.set(0,0),this.max.set(0,0),(t=0,a=e.length);t<a;++t)this.expandByPoint(e[t]);return this}},{key:\"setFromCenterAndSize\",value:function(e,t){var a=Ae.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(a),this.max.copy(e).add(a),this}},{key:\"clampPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new qe;return t.copy(e).clamp(this.min,this.max)}},{key:\"distanceToPoint\",value:function(e){var t=Ae.copy(e).clamp(this.min,this.max);return t.sub(e).length()}},{key:\"translate\",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:\"intersect\",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:\"union\",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:\"containsPoint\",value:function(e){var t=this.min,a=this.max;return e.x>=t.x&&e.y>=t.y&&e.x<=a.x&&e.y<=a.y}},{key:\"containsBox\",value:function(e){var t=this.min,a=this.max,n=e.min,i=e.max;return t.x<=n.x&&i.x<=a.x&&t.y<=n.y&&i.y<=a.y}},{key:\"intersectsBox\",value:function(e){var t=this.min,a=this.max,n=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&n.x<=a.x&&n.y<=a.y}},{key:\"equals\",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),t}(),Be=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.radius=a,this.theta=n,this.y=i}return n(t,[{key:\"set\",value:function(e,t,a){return this.radius=e,this.theta=t,this.y=a,this}},{key:\"copy\",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromVector3\",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:\"setFromCartesianCoords\",value:function(e,t,a){return this.radius=ke(e*e+a*a),this.theta=pe(e,a),this.y=t,this}}]),t}(),Ne=function(){function t(){e(this,t),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return n(t,[{key:\"set\",value:function(e,t,a,n,i,l,o,s,r){var d=this.elements;return d[0]=e,d[3]=t,d[6]=a,d[1]=n,d[4]=i,d[7]=l,d[2]=o,d[5]=s,d[8]=r,this}},{key:\"identity\",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:\"copy\",value:function(e){var t=e.elements,a=this.elements;return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],this}},{key:\"clone\",value:function(){return new this.constructor().fromArray(this.elements)}},{key:\"fromArray\",value:function(e){var t,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(t=0;9>t;++t)n[t]=e[t+a];return this}},{key:\"toArray\",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(e=0;9>e;++e)t[e+a]=n[e];return t}},{key:\"multiplyMatrices\",value:function(e,t){var a=e.elements,n=t.elements,i=this.elements,l=a[0],o=a[3],s=a[6],r=a[1],d=a[4],y=a[7],u=a[2],c=a[5],m=a[8],x=n[0],p=n[3],v=n[6],g=n[1],k=n[4],h=n[7],z=n[2],f=n[5],S=n[8];return i[0]=l*x+o*g+s*z,i[3]=l*p+o*k+s*f,i[6]=l*v+o*h+s*S,i[1]=r*x+d*g+y*z,i[4]=r*p+d*k+y*f,i[7]=r*v+d*h+y*S,i[2]=u*x+c*g+m*z,i[5]=u*p+c*k+m*f,i[8]=u*v+c*h+m*S,this}},{key:\"multiply\",value:function(e){return this.multiplyMatrices(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyMatrices(e,this)}},{key:\"multiplyScalar\",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:\"determinant\",value:function(){var t=this.elements,n=t[0],a=t[1],l=t[2],o=t[3],s=t[4],e=t[5],r=t[6],d=t[7],y=t[8];return n*s*y-n*e*d-a*o*y+a*e*r+l*o*d-l*s*r}},{key:\"getInverse\",value:function(e){var t,a=e.elements,n=this.elements,i=a[0],l=a[1],o=a[2],s=a[3],r=a[4],d=a[5],y=a[6],u=a[7],c=a[8],m=c*r-d*u,x=d*y-c*s,p=u*s-r*y,v=i*m+l*x+o*p;return 0===v?(console.error(\"Can't invert matrix, determinant is zero\",e),this.identity()):(t=1/v,n[0]=m*t,n[1]=(o*u-c*l)*t,n[2]=(d*l-o*r)*t,n[3]=x*t,n[4]=(c*i-o*y)*t,n[5]=(o*s-d*i)*t,n[6]=p*t,n[7]=(l*y-u*i)*t,n[8]=(r*i-l*s)*t),this}},{key:\"transpose\",value:function(){var e,a=this.elements;return e=a[1],a[1]=a[3],a[3]=e,e=a[2],a[2]=a[6],a[6]=e,e=a[5],a[5]=a[7],a[7]=e,this}},{key:\"scale\",value:function(e,t){var a=this.elements;return a[0]*=e,a[3]*=e,a[6]*=e,a[1]*=t,a[4]*=t,a[7]*=t,this}},{key:\"rotate\",value:function(e){var t=he(e),a=ze(e),n=this.elements,i=n[0],l=n[3],o=n[6],s=n[1],r=n[4],d=n[7];return n[0]=t*i+a*s,n[3]=t*l+a*r,n[6]=t*o+a*d,n[1]=-a*i+t*s,n[4]=-a*l+t*r,n[7]=-a*o+t*d,this}},{key:\"translate\",value:function(e,t){var a=this.elements;return a[0]+=e*a[2],a[3]+=e*a[5],a[6]+=e*a[8],a[1]+=t*a[2],a[4]+=t*a[5],a[7]+=t*a[8],this}},{key:\"equals\",value:function(e){var t,a=this.elements,n=e.elements,l=!0;for(t=0;l&&9>t;++t)a[t]!==n[t]&&(l=!1);return l}}]),t}(),Oe={XYZ:\"XYZ\",YZX:\"YZX\",ZXY:\"ZXY\",XZY:\"XZY\",YXZ:\"YXZ\",ZYX:\"ZYX\"},Le=new Pe,Me=function(){var a=Number.EPSILON;function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;e(this,t),this.x=a,this.y=n,this.z=i,this.w=l}return n(t,[{key:\"set\",value:function(e,t,a,n){return this.x=e,this.y=t,this.z=a,this.w=n,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:\"setFromEuler\",value:function(e){var t=e.x,a=e.y,n=e.z,i=he,l=ze,o=i(t/2),s=i(a/2),r=i(n/2),d=l(t/2),y=l(a/2),u=l(n/2);switch(e.order){case Oe.XYZ:this.x=d*s*r+o*y*u,this.y=o*y*r-d*s*u,this.z=o*s*u+d*y*r,this.w=o*s*r-d*y*u;break;case Oe.YXZ:this.x=d*s*r+o*y*u,this.y=o*y*r-d*s*u,this.z=o*s*u-d*y*r,this.w=o*s*r+d*y*u;break;case Oe.ZXY:this.x=d*s*r-o*y*u,this.y=o*y*r+d*s*u,this.z=o*s*u+d*y*r,this.w=o*s*r-d*y*u;break;case Oe.ZYX:this.x=d*s*r-o*y*u,this.y=o*y*r+d*s*u,this.z=o*s*u-d*y*r,this.w=o*s*r+d*y*u;break;case Oe.YZX:this.x=d*s*r+o*y*u,this.y=o*y*r+d*s*u,this.z=o*s*u-d*y*r,this.w=o*s*r-d*y*u;break;case Oe.XZY:this.x=d*s*r-o*y*u,this.y=o*y*r-d*s*u,this.z=o*s*u+d*y*r,this.w=o*s*r+d*y*u;}return this}},{key:\"setFromAxisAngle\",value:function(e,t){var a=t/2,n=ze(a);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=he(a),this}},{key:\"setFromRotationMatrix\",value:function(e){var t,a=e.elements,n=a[0],i=a[4],l=a[8],o=a[1],r=a[5],d=a[9],y=a[2],u=a[6],c=a[10],m=n+r+c;return 0<m?(t=.5/ke(m+1),this.w=.25/t,this.x=(u-d)*t,this.y=(l-y)*t,this.z=(o-i)*t):n>r&&n>c?(t=2*ke(1+n-r-c),this.w=(u-d)/t,this.x=.25*t,this.y=(i+o)/t,this.z=(l+y)/t):r>c?(t=2*ke(1+r-n-c),this.w=(l-y)/t,this.x=(i+o)/t,this.y=.25*t,this.z=(d+u)/t):(t=2*ke(1+c-n-r),this.w=(o-i)/t,this.x=(l+y)/t,this.y=(d+u)/t,this.z=.25*t),this}},{key:\"setFromUnitVectors\",value:function(e,t){var a=e.dot(t)+1;return 1e-6>a?(a=0,we(e.x)>we(e.z)?Le.set(-e.y,e.x,0):Le.set(0,-e.z,e.y)):Le.crossVectors(e,t),this.x=Le.x,this.y=Le.y,this.z=Le.z,this.w=a,this.normalize()}},{key:\"angleTo\",value:function(e){return 2*ge(we(Ie(Te(this.dot(e),-1),1)))}},{key:\"rotateTowards\",value:function(e,t){var a=this.angleTo(e);return 0!==a&&this.slerp(e,Ie(1,t/a)),this}},{key:\"invert\",value:function(){return this.conjugate()}},{key:\"conjugate\",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:\"length\",value:function(){return ke(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:\"normalize\",value:function(){var e,t=this.length();return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/t,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:\"multiplyQuaternions\",value:function(e,t){var a=e.x,n=e.y,i=e.z,l=e.w,o=t.x,s=t.y,r=t.z,d=t.w;return this.x=a*d+l*o+n*r-i*s,this.y=n*d+l*s+i*o-a*r,this.z=i*d+l*r+a*s-n*o,this.w=l*d-a*o-n*s-i*r,this}},{key:\"multiply\",value:function(e){return this.multiplyQuaternions(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyQuaternions(e,this)}},{key:\"slerp\",value:function(e,n){var t,i,l,o,r,d,u,c=this.x,m=this.y,y=this.z,x=this.w;return 1===n?this.copy(e):0<n&&(t=x*e.w+c*e.x+m*e.y+y*e.z,0>t?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,t=-t):this.copy(e),1<=t?(this.w=x,this.x=c,this.y=m,this.z=y):(i=1-t*t,r=1-n,i<=a?(this.w=r*x+n*this.w,this.x=r*c+n*this.x,this.y=r*m+n*this.y,this.z=r*y+n*this.z,this.normalize()):(l=ke(i),o=pe(l,t),d=ze(r*o)/l,u=ze(n*o)/l,this.w=x*d+this.w*u,this.x=c*d+this.x*u,this.y=m*d+this.y*u,this.z=y*d+this.z*u))),this}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}],[{key:\"slerp\",value:function(e,a,n,i){return n.copy(e).slerp(a,i)}},{key:\"slerpFlat\",value:function(e,n,i,l,o,r,d){var y,u,c,m,x,p,v,g,k=o[r],h=o[r+1],z=o[r+2],S=o[r+3],w=i[l],T=i[l+1],I=i[l+2],C=i[l+3];(C!==S||w!==k||T!==h||I!==z)&&(y=1-d,m=w*k+T*h+I*z+C*S,p=0<=m?1:-1,x=1-m*m,x>a&&(c=ke(x),v=pe(c,m*p),y=ze(y*v)/c,d=ze(d*v)/c),g=d*p,w=w*y+k*g,T=T*y+h*g,I=I*y+z*g,C=C*y+S*g,y===1-d&&(u=1/ke(w*w+T*T+I*I+C*C),w*=u,T*=u,I*=u,C*=u)),e[n]=w,e[n+1]=T,e[n+2]=I,e[n+3]=C}}]),t}(),Re=new Ne,m=new Me,q=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.x=a,this.y=n,this.z=i,this.order=t.defaultOrder}return n(t,[{key:\"set\",value:function(e,t,a,n){return this.x=e,this.y=t,this.z=a,this.order=n,this}},{key:\"copy\",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.order=e[t+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.order,e}},{key:\"toVector3\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return e.set(this.x,this.y,this.z)}},{key:\"setFromRotationMatrix\",value:function(e){var t=Math.asin,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order,n=e.elements,i=n[0],l=n[4],o=n[8],s=n[1],r=n[5],d=n[9],y=n[2],u=n[6],c=n[10],m=1-1e-5;switch(a){case Oe.XYZ:{this.y=t(P(o,-1,1)),we(o)<m?(this.x=pe(-d,c),this.z=pe(-l,i)):(this.x=pe(u,r),this.z=0);break}case Oe.YXZ:{this.x=t(-P(d,-1,1)),we(d)<m?(this.y=pe(o,c),this.z=pe(s,r)):(this.y=pe(-y,i),this.z=0);break}case Oe.ZXY:{this.x=t(P(u,-1,1)),we(u)<m?(this.y=pe(-y,c),this.z=pe(-l,r)):(this.y=0,this.z=pe(s,i));break}case Oe.ZYX:{this.y=t(-P(y,-1,1)),we(y)<m?(this.x=pe(u,c),this.z=pe(s,i)):(this.x=0,this.z=pe(-l,r));break}case Oe.YZX:{this.z=t(P(s,-1,1)),we(s)<m?(this.x=pe(-d,r),this.y=pe(-y,i)):(this.x=0,this.y=pe(o,c));break}case Oe.XZY:{this.z=t(-P(l,-1,1)),we(l)<m?(this.x=pe(u,r),this.y=pe(o,i)):(this.x=pe(-d,c),this.y=0);break}}return this.order=a,this}},{key:\"setFromQuaternion\",value:function(e,t){return Re.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Re,t)}},{key:\"setFromVector3\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(e.x,e.y,e.z,t)}},{key:\"reorder\",value:function(e){return m.setFromEuler(this),this.setFromQuaternion(m,e)}},{key:\"equals\",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order}}],[{key:\"defaultOrder\",get:function(){return Oe.XYZ}}]),t}(),Ye=new Pe,a=new Pe,b=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe(1,0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.normal=a,this.constant=n}return n(t,[{key:\"set\",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:\"setComponents\",value:function(e,t,a,n){return this.normal.set(e,t,a),this.constant=n,this}},{key:\"copy\",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"setFromNormalAndCoplanarPoint\",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:\"setFromCoplanarPoints\",value:function(e,t,n){var i=Ye.subVectors(n,t).cross(a.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,Ye),this}},{key:\"normalize\",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:\"negate\",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:\"distanceToPoint\",value:function(e){return this.normal.dot(e)+this.constant}},{key:\"distanceToSphere\",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:\"projectPoint\",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:\"coplanarPoint\",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:\"translate\",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:\"intersectLine\",value:function(e,a){var n=e.delta(Ye),i=this.normal.dot(n);if(0===i)0===this.distanceToPoint(e.start)&&a.copy(e.start);else{var l=-(e.start.dot(this.normal)+this.constant)/i;0<=l&&1>=l&&a.copy(n).multiplyScalar(l).add(e.start)}return a}},{key:\"intersectsLine\",value:function(e){var t=this.distanceToPoint(e.start),a=this.distanceToPoint(e.end);return 0>t&&0<a||0>a&&0<t}},{key:\"intersectsBox\",value:function(e){return e.intersectsPlane(this)}},{key:\"intersectsSphere\",value:function(e){return e.intersectsPlane(this)}},{key:\"equals\",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}]),t}(),Xe=new Pe,Ze=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new b,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new b,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new b,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new b,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new b,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new b;e(this,t),this.planes=[a,n,i,l,o,s]}return n(t,[{key:\"set\",value:function(e,t,a,n,i,l){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(a),o[3].copy(n),o[4].copy(i),o[5].copy(l),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"copy\",value:function(e){var t,a=this.planes;for(t=0;6>t;++t)a[t].copy(e.planes[t]);return this}},{key:\"setFromMatrix\",value:function(e){var t=this.planes,a=e.elements,n=a[0],i=a[1],l=a[2],o=a[3],s=a[4],r=a[5],d=a[6],y=a[7],u=a[8],c=a[9],m=a[10],x=a[11],p=a[12],v=a[13],g=a[14],k=a[15];return t[0].setComponents(o-n,y-s,x-u,k-p).normalize(),t[1].setComponents(o+n,y+s,x+u,k+p).normalize(),t[2].setComponents(o+i,y+r,x+c,k+v).normalize(),t[3].setComponents(o-i,y-r,x-c,k-v).normalize(),t[4].setComponents(o-l,y-d,x-m,k-g).normalize(),t[5].setComponents(o+l,y+d,x+m,k+g).normalize(),this}},{key:\"intersectsSphere\",value:function(e){var t,a,n=this.planes,l=e.center,o=-e.radius,s=!0;for(t=0;6>t;++t)if(a=n[t].distanceToPoint(l),a<o){s=!1;break}return s}},{key:\"intersectsBox\",value:function(e){var t,a,n=this.planes,l=e.min,o=e.max;for(t=0;6>t;++t)if(a=n[t],Xe.x=0<a.normal.x?o.x:l.x,Xe.y=0<a.normal.y?o.y:l.y,Xe.z=0<a.normal.z?o.z:l.z,0>a.distanceToPoint(Xe))return!1;return!0}},{key:\"containsPoint\",value:function(e){var t,a=this.planes,n=!0;for(t=0;6>t;++t)if(0>a[t].distanceToPoint(e)){n=!1;break}return n}}]),t}(),_e=new Pe,je=new Pe,Ue=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe;e(this,t),this.start=a,this.end=n}return n(t,[{key:\"set\",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:\"copy\",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:\"delta\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return e.subVectors(this.end,this.start)}},{key:\"lengthSquared\",value:function(){return this.start.distanceToSquared(this.end)}},{key:\"length\",value:function(){return this.start.distanceTo(this.end)}},{key:\"at\",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:\"closestPointToPointParameter\",value:function(e,a){_e.subVectors(e,this.start),je.subVectors(this.end,this.start);var n=je.dot(je),i=je.dot(_e),l=a?Ie(Te(i/n,0),1):i/n;return l}},{key:\"closestPointToPoint\",value:function(e){var a=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Pe,i=this.closestPointToPointParameter(e,a);return this.delta(n).multiplyScalar(i).add(this.start)}},{key:\"equals\",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}]),t}(),Qe=new Pe,Ge=new Pe,He=new Pe,c=function(){function t(){e(this,t),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return n(t,[{key:\"set\",value:function(e,t,a,n,i,l,o,s,r,d,y,u,c,m,x,p){var v=this.elements;return v[0]=e,v[4]=t,v[8]=a,v[12]=n,v[1]=i,v[5]=l,v[9]=o,v[13]=s,v[2]=r,v[6]=d,v[10]=y,v[14]=u,v[3]=c,v[7]=m,v[11]=x,v[15]=p,this}},{key:\"identity\",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:\"copy\",value:function(e){var t=e.elements,a=this.elements;return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],this}},{key:\"clone\",value:function(){return new this.constructor().fromArray(this.elements)}},{key:\"fromArray\",value:function(e){var t,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(t=0;16>t;++t)n[t]=e[t+a];return this}},{key:\"toArray\",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(e=0;16>e;++e)t[e+a]=n[e];return t}},{key:\"getMaxScaleOnAxis\",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],a=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return ke(Te(t,a,n))}},{key:\"copyPosition\",value:function(e){var t=this.elements,a=e.elements;return t[12]=a[12],t[13]=a[13],t[14]=a[14],this}},{key:\"setPosition\",value:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}},{key:\"extractBasis\",value:function(e,t,a){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),a.setFromMatrixColumn(this,2),this}},{key:\"makeBasis\",value:function(e,t,a){return this.set(e.x,t.x,a.x,0,e.y,t.y,a.y,0,e.z,t.z,a.z,0,0,0,0,1),this}},{key:\"extractRotation\",value:function(e){var t=this.elements,a=e.elements,n=1/Qe.setFromMatrixColumn(e,0).length(),i=1/Qe.setFromMatrixColumn(e,1).length(),l=1/Qe.setFromMatrixColumn(e,2).length();return t[0]=a[0]*n,t[1]=a[1]*n,t[2]=a[2]*n,t[3]=0,t[4]=a[4]*i,t[5]=a[5]*i,t[6]=a[6]*i,t[7]=0,t[8]=a[8]*l,t[9]=a[9]*l,t[10]=a[10]*l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:\"makeRotationFromEuler\",value:function(t){var n,i,l,o,s,r,u,m,p,v,g,k,h=this.elements,S=t.x,x=t.y,y=t.z,z=he(S),a=ze(S),w=he(x),c=ze(x),d=he(y),e=ze(y);switch(t.order){case Oe.XYZ:{n=z*d,i=z*e,l=a*d,o=a*e,h[0]=w*d,h[4]=-w*e,h[8]=c,h[1]=i+l*c,h[5]=n-o*c,h[9]=-a*w,h[2]=o-n*c,h[6]=l+i*c,h[10]=z*w;break}case Oe.YXZ:{s=w*d,r=w*e,u=c*d,m=c*e,h[0]=s+m*a,h[4]=u*a-r,h[8]=z*c,h[1]=z*e,h[5]=z*d,h[9]=-a,h[2]=r*a-u,h[6]=m+s*a,h[10]=z*w;break}case Oe.ZXY:{s=w*d,r=w*e,u=c*d,m=c*e,h[0]=s-m*a,h[4]=-z*e,h[8]=u+r*a,h[1]=r+u*a,h[5]=z*d,h[9]=m-s*a,h[2]=-z*c,h[6]=a,h[10]=z*w;break}case Oe.ZYX:{n=z*d,i=z*e,l=a*d,o=a*e,h[0]=w*d,h[4]=l*c-i,h[8]=n*c+o,h[1]=w*e,h[5]=o*c+n,h[9]=i*c-l,h[2]=-c,h[6]=a*w,h[10]=z*w;break}case Oe.YZX:{p=z*w,v=z*c,g=a*w,k=a*c,h[0]=w*d,h[4]=k-p*e,h[8]=g*e+v,h[1]=e,h[5]=z*d,h[9]=-a*d,h[2]=-c*d,h[6]=v*e+g,h[10]=p-k*e;break}case Oe.XZY:{p=z*w,v=z*c,g=a*w,k=a*c,h[0]=w*d,h[4]=-e,h[8]=c*d,h[1]=p*e+k,h[5]=z*d,h[9]=v*e-g,h[2]=g*e-v,h[6]=a*d,h[10]=k*e+p;break}}return h[3]=0,h[7]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,this}},{key:\"makeRotationFromQuaternion\",value:function(e){return this.compose(Qe.set(0,0,0),e,Ge.set(1,1,1))}},{key:\"lookAt\",value:function(e,t,a){var n=this.elements,i=Qe,l=Ge,o=He;return o.subVectors(e,t),0===o.lengthSquared()&&(o.z=1),o.normalize(),i.crossVectors(a,o),0===i.lengthSquared()&&(1===we(a.z)?o.x+=1e-4:o.z+=1e-4,o.normalize(),i.crossVectors(a,o)),i.normalize(),l.crossVectors(o,i),n[0]=i.x,n[4]=l.x,n[8]=o.x,n[1]=i.y,n[5]=l.y,n[9]=o.y,n[2]=i.z,n[6]=l.z,n[10]=o.z,this}},{key:\"multiplyMatrices\",value:function(e,t){var a=this.elements,n=e.elements,i=t.elements,l=n[0],o=n[4],s=n[8],r=n[12],d=n[1],y=n[5],u=n[9],c=n[13],m=n[2],x=n[6],p=n[10],v=n[14],g=n[3],k=n[7],h=n[11],z=n[15],f=i[0],S=i[4],w=i[8],T=i[12],I=i[1],C=i[5],P=i[9],b=i[13],E=i[2],D=i[6],F=i[10],q=i[14],A=i[3],V=i[7],B=i[11],N=i[15];return a[0]=l*f+o*I+s*E+r*A,a[4]=l*S+o*C+s*D+r*V,a[8]=l*w+o*P+s*F+r*B,a[12]=l*T+o*b+s*q+r*N,a[1]=d*f+y*I+u*E+c*A,a[5]=d*S+y*C+u*D+c*V,a[9]=d*w+y*P+u*F+c*B,a[13]=d*T+y*b+u*q+c*N,a[2]=m*f+x*I+p*E+v*A,a[6]=m*S+x*C+p*D+v*V,a[10]=m*w+x*P+p*F+v*B,a[14]=m*T+x*b+p*q+v*N,a[3]=g*f+k*I+h*E+z*A,a[7]=g*S+k*C+h*D+z*V,a[11]=g*w+k*P+h*F+z*B,a[15]=g*T+k*b+h*q+z*N,this}},{key:\"multiply\",value:function(e){return this.multiplyMatrices(this,e)}},{key:\"premultiply\",value:function(e){return this.multiplyMatrices(e,this)}},{key:\"multiplyScalar\",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:\"determinant\",value:function(){var e=this.elements,t=e[0],a=e[4],n=e[8],i=e[12],l=e[1],o=e[5],s=e[9],r=e[13],d=e[2],y=e[6],u=e[10],c=e[14],m=e[3],x=e[7],p=e[11],v=e[15],g=t*o,k=t*s,h=t*r,z=a*l,f=a*s,S=a*r,w=n*l,T=n*o,I=n*r,C=i*l,P=i*o,b=i*s;return m*(b*y-I*y-P*u+S*u+T*c-f*c)+x*(k*c-h*u+C*u-w*c+I*d-b*d)+p*(h*y-g*c-C*y+z*c+P*d-S*d)+v*(-T*d-k*y+g*u+w*y-z*u+f*d)}},{key:\"getInverse\",value:function(e){var t,a=this.elements,n=e.elements,i=n[0],l=n[1],o=n[2],s=n[3],r=n[4],d=n[5],y=n[6],u=n[7],c=n[8],m=n[9],x=n[10],p=n[11],v=n[12],g=n[13],k=n[14],h=n[15],z=m*k*u-g*x*u+g*y*p-d*k*p-m*y*h+d*x*h,f=v*x*u-c*k*u-v*y*p+r*k*p+c*y*h-r*x*h,S=c*g*u-v*m*u+v*d*p-r*g*p-c*d*h+r*m*h,w=v*m*y-c*g*y-v*d*x+r*g*x+c*d*k-r*m*k,T=i*z+l*f+o*S+s*w;return 0===T?(console.error(\"Can't invert matrix, determinant is zero\",e),this.identity()):(t=1/T,a[0]=z*t,a[1]=(g*x*s-m*k*s-g*o*p+l*k*p+m*o*h-l*x*h)*t,a[2]=(d*k*s-g*y*s+g*o*u-l*k*u-d*o*h+l*y*h)*t,a[3]=(m*y*s-d*x*s-m*o*u+l*x*u+d*o*p-l*y*p)*t,a[4]=f*t,a[5]=(c*k*s-v*x*s+v*o*p-i*k*p-c*o*h+i*x*h)*t,a[6]=(v*y*s-r*k*s-v*o*u+i*k*u+r*o*h-i*y*h)*t,a[7]=(r*x*s-c*y*s+c*o*u-i*x*u-r*o*p+i*y*p)*t,a[8]=S*t,a[9]=(v*m*s-c*g*s-v*l*p+i*g*p+c*l*h-i*m*h)*t,a[10]=(r*g*s-v*d*s+v*l*u-i*g*u-r*l*h+i*d*h)*t,a[11]=(c*d*s-r*m*s-c*l*u+i*m*u+r*l*p-i*d*p)*t,a[12]=w*t,a[13]=(c*g*o-v*m*o+v*l*x-i*g*x-c*l*k+i*m*k)*t,a[14]=(v*d*o-r*g*o-v*l*y+i*g*y+r*l*k-i*d*k)*t,a[15]=(r*m*o-c*d*o+c*l*y-i*m*y-r*l*x+i*d*x)*t),this}},{key:\"transpose\",value:function(){var e,a=this.elements;return e=a[1],a[1]=a[4],a[4]=e,e=a[2],a[2]=a[8],a[8]=e,e=a[6],a[6]=a[9],a[9]=e,e=a[3],a[3]=a[12],a[12]=e,e=a[7],a[7]=a[13],a[13]=e,e=a[11],a[11]=a[14],a[14]=e,this}},{key:\"scale\",value:function(e,t,a){var n=this.elements;return n[0]*=e,n[4]*=t,n[8]*=a,n[1]*=e,n[5]*=t,n[9]*=a,n[2]*=e,n[6]*=t,n[10]*=a,n[3]*=e,n[7]*=t,n[11]*=a,this}},{key:\"makeScale\",value:function(e,t,a){return this.set(e,0,0,0,0,t,0,0,0,0,a,0,0,0,0,1),this}},{key:\"makeTranslation\",value:function(e,t,a){return this.set(1,0,0,e,0,1,0,t,0,0,1,a,0,0,0,1),this}},{key:\"makeRotationX\",value:function(e){var t=he(e),a=ze(e);return this.set(1,0,0,0,0,t,-a,0,0,a,t,0,0,0,0,1),this}},{key:\"makeRotationY\",value:function(e){var t=he(e),a=ze(e);return this.set(t,0,a,0,0,1,0,0,-a,0,t,0,0,0,0,1),this}},{key:\"makeRotationZ\",value:function(e){var t=he(e),a=ze(e);return this.set(t,-a,0,0,a,t,0,0,0,0,1,0,0,0,0,1),this}},{key:\"makeRotationAxis\",value:function(e,a){var n=he(a),i=ze(a),l=1-n,t=e.x,o=e.y,s=e.z,r=l*t,d=l*o;return this.set(r*t+n,r*o-i*s,r*s+i*o,0,r*o+i*s,d*o+n,d*s-i*t,0,r*s-i*o,d*s+i*t,l*s*s+n,0,0,0,0,1),this}},{key:\"makeShear\",value:function(e,t,a){return this.set(1,t,a,0,e,1,a,0,e,t,1,0,0,0,0,1),this}},{key:\"compose\",value:function(e,t,a){var n=this.elements,i=t.x,l=t.y,o=t.z,s=t.w,r=i+i,d=l+l,y=o+o,u=i*r,c=i*d,m=i*y,x=l*d,p=l*y,v=o*y,g=s*r,k=s*d,h=s*y,z=a.x,f=a.y,S=a.z;return n[0]=(1-(x+v))*z,n[1]=(c+h)*z,n[2]=(m-k)*z,n[3]=0,n[4]=(c-h)*f,n[5]=(1-(u+v))*f,n[6]=(p+g)*f,n[7]=0,n[8]=(m+k)*S,n[9]=(p-g)*S,n[10]=(1-(u+x))*S,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}},{key:\"decompose\",value:function(e,t,a){var n=this.elements,i=n[0],l=n[1],o=n[2],s=n[4],r=n[5],d=n[6],y=n[8],u=n[9],c=n[10],m=this.determinant(),x=Qe.set(i,l,o).length()*(0>m?-1:1),p=Qe.set(s,r,d).length(),v=Qe.set(y,u,c).length(),g=1/x,k=1/p,h=1/v;return e.x=n[12],e.y=n[13],e.z=n[14],n[0]*=g,n[1]*=g,n[2]*=g,n[4]*=k,n[5]*=k,n[6]*=k,n[8]*=h,n[9]*=h,n[10]*=h,t.setFromRotationMatrix(this),n[0]=i,n[1]=l,n[2]=o,n[4]=s,n[5]=r,n[6]=d,n[8]=y,n[9]=u,n[10]=c,a.x=x,a.y=p,a.z=v,this}},{key:\"makePerspective\",value:function(e,t,a,n,i,l){var o=this.elements;return o[0]=2*i/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*i/(a-n),o[9]=(a+n)/(a-n),o[13]=0,o[2]=0,o[6]=0,o[10]=-(l+i)/(l-i),o[14]=-2*l*i/(l-i),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:\"makeOrthographic\",value:function(e,t,a,n,i,l){var o=this.elements,s=1/(t-e),r=1/(a-n),d=1/(l-i);return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-((t+e)*s),o[1]=0,o[5]=2*r,o[9]=0,o[13]=-((a+n)*r),o[2]=0,o[6]=0,o[10]=-2*d,o[14]=-((l+i)*d),o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:\"equals\",value:function(e){var t,a=this.elements,n=e.elements,l=!0;for(t=0;l&&16>t;++t)a[t]!==n[t]&&(l=!1);return l}}]),t}(),Je=[new Pe,new Pe,new Pe,new Pe],Ke=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe;e(this,t),this.origin=a,this.direction=n}return n(t,[{key:\"set\",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:\"copy\",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"at\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe;return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:\"lookAt\",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:\"recast\",value:function(e){return this.origin.copy(this.at(e,Je[0])),this}},{key:\"closestPointToPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe,a=t.subVectors(e,this.origin).dot(this.direction);return 0<=a?t.copy(this.direction).multiplyScalar(a).add(this.origin):t.copy(this.origin)}},{key:\"distanceSquaredToPoint\",value:function(e){var t=Je[0].subVectors(e,this.origin).dot(this.direction);return 0>t?this.origin.distanceToSquared(e):Je[0].copy(this.direction).multiplyScalar(t).add(this.origin).distanceToSquared(e)}},{key:\"distanceToPoint\",value:function(e){return ke(this.distanceSquaredToPoint(e))}},{key:\"distanceToPlane\",value:function(e){var a=e.normal.dot(this.direction),n=0===a?0===e.distanceToPoint(this.origin)?0:-1:-(this.origin.dot(e.normal)+e.constant)/a;return 0<=n?n:null}},{key:\"distanceSquaredToSegment\",value:function(e,t,a,n){var i,l,o,s,r,d=Je[0].copy(e).add(t).multiplyScalar(.5),y=Je[1].copy(t).sub(e).normalize(),u=Je[2].copy(this.origin).sub(d),m=.5*e.distanceTo(t),x=-this.direction.dot(y),p=u.dot(this.direction),v=-u.dot(y),g=u.lengthSq(),c=we(1-x*x);return 0<c?(i=x*v-p,l=x*p-v,o=m*c,0<=i?l>=-o?l<=o?(s=1/c,i*=s,l*=s,r=i*(i+x*l+2*p)+l*(x*i+l+2*v)+g):(l=m,i=Te(0,-(x*l+p)),r=-i*i+l*(l+2*v)+g):(l=-m,i=Te(0,-(x*l+p)),r=-i*i+l*(l+2*v)+g):l<=-o?(i=Te(0,-(-x*m+p)),l=0<i?-m:Ie(Te(-m,-v),m),r=-i*i+l*(l+2*v)+g):l<=o?(i=0,l=Ie(Te(-m,-v),m),r=l*(l+2*v)+g):(i=Te(0,-(x*m+p)),l=0<i?m:Ie(Te(-m,-v),m),r=-i*i+l*(l+2*v)+g)):(l=0<x?-m:m,i=Te(0,-(x*l+p)),r=-i*i+l*(l+2*v)+g),void 0!==a&&a.copy(this.direction).multiplyScalar(i).add(this.origin),void 0!==n&&n.copy(y).multiplyScalar(l).add(d),r}},{key:\"intersectSphere\",value:function(e){var t,a,n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe,l=Je[0].subVectors(e.center,this.origin),o=l.dot(this.direction),s=l.dot(l)-o*o,r=e.radius*e.radius,d=null;return s<=r&&(t=ke(r-s),a=o-t,n=o+t,(0<=a||0<=n)&&(d=0>a?this.at(n,i):this.at(a,i))),d}},{key:\"intersectsSphere\",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:\"intersectPlane\",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe,n=this.distanceToPlane(e);return null===n?null:this.at(n,a)}},{key:\"intersectsPlane\",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t}},{key:\"intersectBox\",value:function(e){var t,a,n,i,l,o,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe,r=this.origin,d=this.direction,y=e.min,u=e.max,c=1/d.x,m=1/d.y,x=1/d.z,p=null;return 0<=c?(t=(y.x-r.x)*c,a=(u.x-r.x)*c):(t=(u.x-r.x)*c,a=(y.x-r.x)*c),0<=m?(n=(y.y-r.y)*m,i=(u.y-r.y)*m):(n=(u.y-r.y)*m,i=(y.y-r.y)*m),t<=i&&n<=a&&((n>t||t!==t)&&(t=n),(i<a||a!==a)&&(a=i),0<=x?(l=(y.z-r.z)*x,o=(u.z-r.z)*x):(l=(u.z-r.z)*x,o=(y.z-r.z)*x),t<=o&&l<=a&&((l>t||t!==t)&&(t=l),(o<a||a!==a)&&(a=o),0<=a&&(p=this.at(0<=t?t:a,s)))),p}},{key:\"intersectsBox\",value:function(e){return null!==this.intersectBox(e,Je[0])}},{key:\"intersectTriangle\",value:function(e,t,a,n,i){var l,o,s,r,d,y=this.direction,u=Je[0],c=Je[1],m=Je[2],x=Je[3],p=null;return c.subVectors(t,e),m.subVectors(a,e),x.crossVectors(c,m),l=y.dot(x),0===l||n&&0<l||(0<l?o=1:(o=-1,l=-l),u.subVectors(this.origin,e),s=o*y.dot(m.crossVectors(u,m)),0<=s&&(r=o*y.dot(c.cross(u)),0<=r&&s+r<=l&&(d=-o*u.dot(x),0<=d&&(p=this.at(d/l,i))))),p}},{key:\"applyMatrix4\",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:\"equals\",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),t}(),We=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.radius=a,this.phi=n,this.theta=i}return n(t,[{key:\"set\",value:function(e,t,a){return this.radius=e,this.phi=t,this.theta=a,this}},{key:\"copy\",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"makeSafe\",value:function(){return this.phi=Te(1e-6,Ie(xe-1e-6,this.phi)),this}},{key:\"setFromVector3\",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:\"setFromCartesianCoords\",value:function(e,t,a){return this.radius=ke(e*e+t*t+a*a),0===this.radius?(this.theta=0,this.phi=0):(this.theta=pe(e,a),this.phi=ge(Ie(Te(t/this.radius,-1),1))),this}}]),t}(),$e=function(){function t(){e(this,t),this.elements=new Float32Array([1,0,0,1,0,1])}return n(t,[{key:\"set\",value:function(t,a,n,i,l,o){var s=this.elements;return s[0]=t,s[1]=a,s[3]=i,s[2]=n,s[4]=l,s[5]=o,this}},{key:\"identity\",value:function(){return this.set(1,0,0,1,0,1),this}},{key:\"copy\",value:function(e){var t=e.elements;return this.set(t[0],t[1],t[2],t[3],t[4],t[5]),this}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}},{key:\"toMatrix3\",value:function(e){var t=e.elements;e.set(t[0],t[1],t[2],t[1],t[3],t[4],t[2],t[4],t[5])}},{key:\"add\",value:function(e){var t=this.elements,a=e.elements;return t[0]+=a[0],t[1]+=a[1],t[3]+=a[3],t[2]+=a[2],t[4]+=a[4],t[5]+=a[5],this}},{key:\"norm\",value:function(){var t=this.elements,e=t[1]*t[1],a=t[2]*t[2],n=t[4]*t[4];return ke(t[0]*t[0]+e+a+e+t[3]*t[3]+n+a+n+t[5]*t[5])}},{key:\"off\",value:function(){var t=this.elements;return ke(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:\"applyToVector3\",value:function(t){var a=t.x,n=t.y,i=t.z,l=this.elements;return t.x=l[0]*a+l[1]*n+l[2]*i,t.y=l[1]*a+l[3]*n+l[4]*i,t.z=l[2]*a+l[4]*n+l[5]*i,t}},{key:\"equals\",value:function(e){var t,a=this.elements,n=e.elements,l=!0;for(t=0;l&&6>t;++t)a[t]!==n[t]&&(l=!1);return l}}],[{key:\"calculateIndex\",value:function(e,t){return 3-(3-e)*(2-e)/2+t}}]),t}(),et=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;e(this,t),this.x=a,this.y=n,this.z=i,this.w=l}return n(t,[{key:\"set\",value:function(e,t,a,n){return this.x=e,this.y=t,this.z=a,this.w=n,this}},{key:\"copy\",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:\"clone\",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:\"fromArray\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:\"toArray\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:\"setAxisAngleFromQuaternion\",value:function(e){this.w=2*ge(e.w);var t=ke(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:\"setAxisAngleFromRotationMatrix\",value:function(e){var t,a,n,i,l,o,r,d,u,c,m,p=.01,v=.1,g=e.elements,k=g[0],h=g[4],f=g[8],S=g[1],w=g[5],T=g[9],I=g[2],C=g[6],P=g[10];return we(h-S)<p&&we(f-I)<p&&we(T-C)<p?we(h+S)<v&&we(f+I)<v&&we(T+C)<v&&we(k+w+P-3)<v?this.set(1,0,0,0):(t=xe,l=(k+1)/2,o=(w+1)/2,r=(P+1)/2,d=(h+S)/4,u=(f+I)/4,c=(T+C)/4,l>o&&l>r?l<p?(a=0,n=.707106781,i=.707106781):(a=ke(l),n=d/a,i=u/a):o>r?o<p?(a=.707106781,n=0,i=.707106781):(n=ke(o),a=d/n,i=c/n):r<p?(a=.707106781,n=.707106781,i=0):(i=ke(r),a=u/i,n=c/i),this.set(a,n,i,t)):(m=ke((C-T)*(C-T)+(f-I)*(f-I)+(S-h)*(S-h)),.001>we(m)&&(m=1),this.x=(C-T)/m,this.y=(f-I)/m,this.z=(S-h)/m,this.w=ge((k+w+P-1)/2)),this}},{key:\"add\",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:\"addScalar\",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:\"addVectors\",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:\"addScaledVector\",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:\"sub\",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:\"subScalar\",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:\"subVectors\",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:\"multiply\",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:\"multiplyScalar\",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:\"multiplyVectors\",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this.w=e.w*t.w,this}},{key:\"divide\",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}},{key:\"divideScalar\",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this}},{key:\"applyMatrix4\",value:function(t){var a=this.x,n=this.y,i=this.z,l=this.w,o=t.elements;return this.x=o[0]*a+o[4]*n+o[8]*i+o[12]*l,this.y=o[1]*a+o[5]*n+o[9]*i+o[13]*l,this.z=o[2]*a+o[6]*n+o[10]*i+o[14]*l,this.w=o[3]*a+o[7]*n+o[11]*i+o[15]*l,this}},{key:\"negate\",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:\"dot\",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:\"manhattanLength\",value:function(){return we(this.x)+we(this.y)+we(this.z)+we(this.w)}},{key:\"lengthSquared\",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:\"length\",value:function(){return ke(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:\"manhattanDistanceTo\",value:function(e){return we(this.x-e.x)+we(this.y-e.y)+we(this.z-e.z)+we(this.w-e.w)}},{key:\"distanceToSquared\",value:function(e){var t=this.x-e.x,a=this.y-e.y,n=this.z-e.z,i=this.w-e.w;return t*t+a*a+n*n+i*i}},{key:\"distanceTo\",value:function(e){return ke(this.distanceToSquared(e))}},{key:\"normalize\",value:function(){return this.divideScalar(this.length())}},{key:\"setLength\",value:function(e){return this.normalize().multiplyScalar(e)}},{key:\"min\",value:function(e){return this.x=Ie(this.x,e.x),this.y=Ie(this.y,e.y),this.z=Ie(this.z,e.z),this.w=Ie(this.w,e.w),this}},{key:\"max\",value:function(e){return this.x=Te(this.x,e.x),this.y=Te(this.y,e.y),this.z=Te(this.z,e.z),this.w=Te(this.w,e.w),this}},{key:\"clamp\",value:function(e,t){return this.x=Te(e.x,Ie(t.x,this.x)),this.y=Te(e.y,Ie(t.y,this.y)),this.z=Te(e.z,Ie(t.z,this.z)),this.w=Te(e.w,Ie(t.w,this.w)),this}},{key:\"floor\",value:function(){return this.x=fe(this.x),this.y=fe(this.y),this.z=fe(this.z),this.w=fe(this.w),this}},{key:\"ceil\",value:function(){return this.x=Se(this.x),this.y=Se(this.y),this.z=Se(this.z),this.w=Se(this.w),this}},{key:\"round\",value:function(){return this.x=ve(this.x),this.y=ve(this.y),this.z=ve(this.z),this.w=ve(this.w),this}},{key:\"lerp\",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:\"lerpVectors\",value:function(e,t,a){return this.subVectors(t,e).multiplyScalar(a).add(e)}},{key:\"equals\",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}]),t}(),tt=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];e(this,t),this.value=a,this.done=n}return n(t,[{key:\"reset\",value:function(){this.value=null,this.done=!1}}]),t}(),at=new Pe,nt=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe;e(this,t),this.min=a,this.max=n,this.children=null}return n(t,[{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:\"getDimensions\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return e.subVectors(this.max,this.min)}},{key:\"split\",value:function(){var e,t,a=this.min,n=this.max,l=this.getCenter(at),o=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)t=it[e],o[e]=new this.constructor(new Pe(0===t[0]?a.x:l.x,0===t[1]?a.y:l.y,0===t[2]?a.z:l.z),new Pe(0===t[0]?l.x:n.x,0===t[1]?l.y:n.y,0===t[2]?l.z:n.z))}}]),t}(),it=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],lt=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],ot=new Pe,st=function(){function t(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.min=a,this.size=n,this.children=null}return n(t,[{key:\"getCenter\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return e.copy(this.min).addScalar(.5*this.size)}},{key:\"getDimensions\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return e.set(this.size,this.size,this.size)}},{key:\"split\",value:function(){var e,t,a=this.min,n=this.getCenter(ot),l=.5*this.size,o=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)t=it[e],o[e]=new this.constructor(new Pe(0===t[0]?a.x:n.x,0===t[1]?a.y:n.y,0===t[2]?a.z:n.z),l)}},{key:\"max\",get:function(){return this.min.clone().addScalar(this.size)}}]),t}(),rt=new v,dt=function(){function t(a){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;e(this,t),this.octree=a,this.region=n,this.cull=null!==n,this.result=new tt,this.trace=null,this.indices=null,this.reset()}return n(t,[{key:\"reset\",value:function(){var e=this.octree.root;return this.trace=[],this.indices=[],null!==e&&(rt.min=e.min,rt.max=e.max,(!this.cull||this.region.intersectsBox(rt))&&(this.trace.push(e),this.indices.push(0))),this.result.reset(),this}},{key:\"next\",value:function(){for(var e,t,a,n=this.cull,i=this.region,l=this.indices,o=this.trace,s=null,r=o.length-1;null===s&&0<=r;)if(e=l[r]++,t=o[r].children,!(8>e))o.pop(),l.pop(),--r;else if(null!==t){if(a=t[e],n&&(rt.min=a.min,rt.max=a.max,!i.intersectsBox(rt)))continue;o.push(a),l.push(0),++r}else s=o.pop(),l.pop();return this.result.value=s,this.result.done=null===s,this.result}},{key:\"return\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),yt=[new Pe,new Pe,new Pe],ut=new v,ct=new Ke,r=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],mt=0,xt=function(){function t(){e(this,t)}return n(t,null,[{key:\"intersectOctree\",value:function(e,t,a){var n,i,l,o,s,r,d,y,u,c=ut.min.set(0,0,0),m=ut.max.subVectors(e.max,e.min),x=e.getDimensions(yt[0]),p=yt[1].copy(x).multiplyScalar(.5),v=ct.origin.copy(t.ray.origin),g=ct.direction.copy(t.ray.direction);v.sub(e.getCenter(yt[2])).add(p),mt=0,0>g.x&&(v.x=x.x-v.x,g.x=-g.x,mt|=4),0>g.y&&(v.y=x.y-v.y,g.y=-g.y,mt|=2),0>g.z&&(v.z=x.z-v.z,g.z=-g.z,mt|=1),n=1/g.x,i=1/g.y,l=1/g.z,o=(c.x-v.x)*n,s=(m.x-v.x)*n,r=(c.y-v.y)*i,d=(m.y-v.y)*i,y=(c.z-v.z)*l,u=(m.z-v.z)*l,Te(Te(o,r),y)<Ie(Ie(s,d),u)&&F(e.root,o,r,y,s,d,u,t,a)}}]),t}(),pt=new v,vt=function(){function t(a,n){e(this,t),this.root=void 0!==a&&void 0!==n?new nt(a,n):null}return n(t,[{key:\"getCenter\",value:function(e){return this.root.getCenter(e)}},{key:\"getDimensions\",value:function(e){return this.root.getDimensions(e)}},{key:\"getDepth\",value:function(){return A(this.root)}},{key:\"cull\",value:function(e){var t=[];return V(this.root,e,t),t}},{key:\"findOctantsByLevel\",value:function(e){var t=[];return B(this.root,e,0,t),t}},{key:\"raycast\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return xt.intersectOctree(this,e,t),t}},{key:\"leaves\",value:function(e){return new dt(this,e)}},{key:Symbol.iterator,value:function(){return new dt(this)}},{key:\"min\",get:function(){return this.root.min}},{key:\"max\",get:function(){return this.root.max}},{key:\"children\",get:function(){return this.root.children}}]),t}(),gt=new Pe,p=function(t){function a(t,n){var i;return e(this,a),i=k(this,s(a).call(this,t,n)),i.points=null,i.data=null,i}return l(a,t),n(a,[{key:\"distanceToSquared\",value:function(e){var t=gt.copy(e).clamp(this.min,this.max);return t.sub(e).lengthSquared()}},{key:\"distanceToCenterSquared\",value:function(e){var t=this.getCenter(gt),a=e.x-t.x,n=e.y-t.x,i=e.z-t.z;return a*a+n*n+i*i}},{key:\"contains\",value:function(e,t){var a=this.min,n=this.max;return e.x>=a.x-t&&e.y>=a.y-t&&e.z>=a.z-t&&e.x<=n.x+t&&e.y<=n.y+t&&e.z<=n.z+t}},{key:\"redistribute\",value:function(e){var t,a,n,l,o,s,r,d=this.children,y=this.points,u=this.data;if(null!==d&&null!==y)for(t=0,n=y.length;t<n;++t)for(s=y[t],r=u[t],(a=0,l=d.length);a<l;++a)if(o=d[a],o.contains(s,e)){null===o.points&&(o.points=[],o.data=[]),o.points.push(s),o.data.push(r);break}this.points=null,this.data=null}},{key:\"merge\",value:function(){var e,t,a,n=this.children;if(null!==n){for(this.points=[],this.data=[],(e=0,t=n.length);e<t;++e)if(a=n[e],null!==a.points){var o,s;(o=this.points).push.apply(o,w(a.points)),(s=this.data).push.apply(s,w(a.data))}this.children=null}}}]),a}(nt),kt=function t(a,n,i){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;e(this,t),this.distance=a,this.distanceToRay=n,this.point=i,this.object=l},ht=function(t){function a(t,n){var i,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:8;return e(this,a),i=k(this,s(a).call(this)),i.root=new p(t,n),i.bias=Te(0,l),i.maxPoints=Te(1,ve(o)),i.maxDepth=Te(0,ve(r)),i.pointCount=0,i}return l(a,t),n(a,[{key:\"countPoints\",value:function(e){return N(e)}},{key:\"put\",value:function(e,t){return O(e,t,this,this.root,0)}},{key:\"remove\",value:function(e){return L(e,this,this.root,null)}},{key:\"fetch\",value:function(e){return M(e,this,this.root)}},{key:\"move\",value:function(e,t){return R(e,t,this,this.root,null,0)}},{key:\"findNearestPoint\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0,a=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],n=Y(e,t,a,this.root);return null!==n&&(n.point=n.point.clone()),n}},{key:\"findPoints\",value:function(e,t){var a=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],n=[];return X(e,t,a,this.root,n),n}},{key:\"raycast\",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=z(s(a.prototype),\"raycast\",this).call(this,e);return 0<n.length&&this.testPoints(n,e,t),t}},{key:\"testPoints\",value:function(e,t,a){var n,l,o,s,r,d,y,u,c,m,x,p=t.params.Points.threshold;for(r=0,y=e.length;r<y;++r)if(c=e[r],m=c.points,null!==m)for(d=0,u=m.length;d<u;++d)x=m[d],s=t.ray.distanceSqToPoint(x),s<p*p&&(n=t.ray.closestPointToPoint(x,new Pe),l=t.ray.origin.distanceTo(n),l>=t.near&&l<=t.far&&(o=ke(s),a.push(new kt(l,o,n,c.data[d]))))}}]),a}(vt),zt=new v,ft=new Pe,St=new Pe,u=new Pe,wt=function(){function t(){e(this,t)}return n(t,null,[{key:\"recycleOctants\",value:function(e,t){var a,n,o,s,r=e.min,d=e.getCenter(St),y=e.getDimensions(u).multiplyScalar(.5),c=e.children,m=t.length;for(a=0;8>a;++a)for(o=it[a],zt.min.addVectors(r,ft.fromArray(o).multiply(y)),zt.max.addVectors(d,ft.fromArray(o).multiply(y)),n=0;n<m;++n)if(s=t[n],null!==s&&zt.min.equals(s.min)&&zt.max.equals(s.max)){c[a]=s,t[n]=null;break}}}]),t}(),Tt=new Pe,It=new Pe,Ct=new Pe,Pt=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe;e(this,t),this.a=n,this.b=a,this.index=-1,this.coordinates=new Pe,this.t=0,this.n=new Pe}return n(t,[{key:\"approximateZeroCrossing\",value:function(e){var t,n,l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,o=Te(1,l-1),s=0,r=1,d=0,y=0;for(Tt.subVectors(this.b,this.a);y<=o&&(d=(s+r)/2,It.addVectors(this.a,Ct.copy(Tt).multiplyScalar(d)),n=e.sample(It),!(we(n)<=1e-4||(r-s)/2<=1e-6));)It.addVectors(this.a,Ct.copy(Tt).multiplyScalar(s)),t=e.sample(It),me(n)===me(t)?s=d:r=d,++y;this.t=d}},{key:\"computeZeroCrossingPosition\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Pe;return e.subVectors(this.b,this.a).multiplyScalar(this.t).add(this.a)}},{key:\"computeSurfaceNormal\",value:function(e){var t=this.computeZeroCrossingPosition(Tt),a=1e-3,n=e.sample(It.addVectors(t,Ct.set(a,0,0)))-e.sample(It.subVectors(t,Ct.set(a,0,0))),i=e.sample(It.addVectors(t,Ct.set(0,a,0)))-e.sample(It.subVectors(t,Ct.set(0,a,0))),l=e.sample(It.addVectors(t,Ct.set(0,0,a)))-e.sample(It.subVectors(t,Ct.set(0,0,a)));this.n.set(n,i,l).normalize()}}]),t}(),bt=new Pt,Et=new Pe,Dt=new Pe,Ft=function(){function t(a,n,i){var l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:3;e(this,t),this.edgeData=a,this.cellPosition=n,this.cellSize=i,this.indices=null,this.zeroCrossings=null,this.normals=null,this.axes=null,this.lengths=null,this.result=new tt,this.initialC=l,this.c=l,this.initialD=o,this.d=o,this.i=0,this.l=0,this.reset()}return n(t,[{key:\"reset\",value:function(){var e,t,n,i,o=this.edgeData,s=[],r=[],y=[],u=[],m=[];for(this.i=0,this.c=0,this.d=0,(t=this.initialC,e=4>>t,n=this.initialD);t<n;++t,e>>=1)i=o.indices[t].length,0<i&&(s.push(o.indices[t]),r.push(o.zeroCrossings[t]),y.push(o.normals[t]),u.push(it[e]),m.push(i),++this.d);return this.l=0<m.length?m[0]:0,this.indices=s,this.zeroCrossings=r,this.normals=y,this.axes=u,this.lengths=m,this.result.reset(),this}},{key:\"next\",value:function(){var e,t,a,l,o,r,d,u=this.cellSize,s=this.edgeData.resolution,n=s+1,m=n*n,p=this.result,v=this.cellPosition;return this.i===this.l&&(this.l=++this.c<this.d?this.lengths[this.c]:0,this.i=0),this.i<this.l?(r=this.c,d=this.i,e=this.axes[r],t=this.indices[r][d],bt.index=t,a=t%n,l=ce(t%m/n),o=ce(t/m),bt.coordinates.set(a,l,o),Et.set(a*u/s,l*u/s,o*u/s),Dt.set((a+e[0])*u/s,(l+e[1])*u/s,(o+e[2])*u/s),bt.a.addVectors(v,Et),bt.b.addVectors(v,Dt),bt.t=this.zeroCrossings[r][d],bt.n.fromArray(this.normals[r],3*d),p.value=bt,++this.i):(p.value=null,p.done=!0),p}},{key:\"return\",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),qt=function(){function t(a){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:n;e(this,t),this.resolution=a,this.indices=0>=n?null:[new Uint32Array(n),new Uint32Array(i),new Uint32Array(l)],this.zeroCrossings=0>=n?null:[new Float32Array(n),new Float32Array(i),new Float32Array(l)],this.normals=0>=n?null:[new Float32Array(3*n),new Float32Array(3*i),new Float32Array(3*l)]}return n(t,[{key:\"serialize\",value:function(){return{resolution:this.resolution,edges:this.edges,zeroCrossings:this.zeroCrossings,normals:this.normals}}},{key:\"deserialize\",value:function(e){var t=this;return null===e?t=null:(this.resolution=e.resolution,this.edges=e.edges,this.zeroCrossings=e.zeroCrossings,this.normals=e.normals),t}},{key:\"createTransferList\",value:function(){var e,t,a,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],o=[this.edges[0],this.edges[1],this.edges[2],this.zeroCrossings[0],this.zeroCrossings[1],this.zeroCrossings[2],this.normals[0],this.normals[1],this.normals[2]];for(t=0,a=o.length;t<a;++t)e=o[t],null!==e&&n.push(e.buffer);return n}},{key:\"edges\",value:function(e,t){return new Ft(this,e,t)}},{key:\"edgesX\",value:function(e,t){return new Ft(this,e,t,0,1)}},{key:\"edgesY\",value:function(e,t){return new Ft(this,e,t,1,2)}},{key:\"edgesZ\",value:function(e,t){return new Ft(this,e,t,2,3)}}],[{key:\"calculate1DEdgeCount\",value:function(e){return ue(e+1,2)*e}}]),t}(),At={AIR:0,SOLID:1},Vt=0,Bt=0,Nt=0,Ot=function(){function t(){var a=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];e(this,t),this.materials=0,this.materialIndices=a?new Uint8Array(Nt):null,this.runLengths=null,this.edgeData=null}return n(t,[{key:\"set\",value:function(e){return this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,this.edgeData=e.edgeData,this}},{key:\"clear\",value:function(){return this.materials=0,this.materialIndices=null,this.runLengths=null,this.edgeData=null,this}},{key:\"setMaterialIndex\",value:function(e,t){this.materialIndices[e]===At.AIR?t!==At.AIR&&++this.materials:t===At.AIR&&--this.materials,this.materialIndices[e]=t}},{key:\"compress\",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this;return this.compressed?(t.materialIndices=this.materialIndices,t.runLengths=this.runLengths):(e=this.full?new Ce([this.materialIndices.length],[At.SOLID]):Ce.encode(this.materialIndices),t.materialIndices=new Uint8Array(e.data),t.runLengths=new Uint32Array(e.runLengths)),t.materials=this.materials,t}},{key:\"decompress\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this;return e.materialIndices=this.compressed?Ce.decode(this.runLengths,this.materialIndices,new Uint8Array(Nt)):this.materialIndices,e.runLengths=null,e.materials=this.materials,e}},{key:\"serialize\",value:function(){return{materials:this.materials,materialIndices:this.materialIndices,runLengths:this.runLengths,edgeData:null===this.edgeData?null:this.edgeData.serialize()}}},{key:\"deserialize\",value:function(e){var t=this;return null===e?t=null:(this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,null===e.edgeData?this.edgeData=null:(null===this.edgeData&&(this.edgeData=new qt(Bt)),this.edgeData.deserialize(e.edgeData))),t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.edgeData&&this.edgeData.createTransferList(e),null!==this.materialIndices&&e.push(this.materialIndices.buffer),null!==this.runLengths&&e.push(this.runLengths.buffer),e}},{key:\"empty\",get:function(){return 0===this.materials}},{key:\"full\",get:function(){return this.materials===Nt}},{key:\"compressed\",get:function(){return null!==this.runLengths}},{key:\"neutered\",get:function(){return!this.empty&&null===this.materialIndices}}],[{key:\"isovalue\",get:function(){return Vt},set:function(e){Vt=e}},{key:\"resolution\",get:function(){return Bt},set:function(e){var t=Math.log2;e=ue(2,Te(0,Se(t(e)))),Bt=Te(1,Ie(256,e)),Nt=ue(Bt+1,3)}}]),t}(),Lt=function(){function t(){e(this,t),this.ata=new $e,this.ata.set(0,0,0,0,0,0),this.atb=new Pe,this.massPointSum=new Pe,this.numPoints=0}return n(t,[{key:\"set\",value:function(e,t,a,n){return this.ata.copy(e),this.atb.copy(t),this.massPointSum.copy(a),this.numPoints=n,this}},{key:\"copy\",value:function(e){return this.set(e.ata,e.atb,e.massPointSum,e.numPoints)}},{key:\"add\",value:function(e,t){var a=t.x,n=t.y,i=t.z,l=e.dot(t),o=this.ata.elements,s=this.atb;o[0]+=a*a,o[1]+=a*n,o[3]+=n*n,o[2]+=a*i,o[4]+=n*i,o[5]+=i*i,s.x+=l*a,s.y+=l*n,s.z+=l*i,this.massPointSum.add(e),++this.numPoints}},{key:\"addData\",value:function(e){this.ata.add(e.ata),this.atb.add(e.atb),this.massPointSum.add(e.massPointSum),this.numPoints+=e.numPoints}},{key:\"clear\",value:function(){this.ata.set(0,0,0,0,0,0),this.atb.set(0,0,0),this.massPointSum.set(0,0,0),this.numPoints=0}},{key:\"clone\",value:function(){return new this.constructor().copy(this)}}]),t}(),Mt=new qe,Rt=function(){function t(){e(this,t)}return n(t,null,[{key:\"calculateCoefficients\",value:function(e,t,a){var n,i,l;return 0===t?(Mt.x=1,Mt.y=0):(n=(a-e)/(2*t),i=ke(1+n*n),l=1/(0<=n?n+i:n-i),Mt.x=1/ke(1+l*l),Mt.y=l*Mt.x),Mt}}]),t}(),Yt=function(){function t(){e(this,t)}return n(t,null,[{key:\"rotateXY\",value:function(e,t){var a=t.x,n=t.y,i=e.x,l=e.y;e.set(a*i-n*l,n*i+a*l)}},{key:\"rotateQXY\",value:function(e,t,a){var n=a.x,i=a.y,l=n*n,o=i*i,s=2*n*i*t,r=e.x,d=e.y;e.set(l*r-s+o*d,o*r+s+l*d)}}]),t}(),Xt=.1,Zt=new $e,_t=new Ne,jt=new qe,Ut=new Pe,Qt=function(){function t(){e(this,t)}return n(t,null,[{key:\"solve\",value:function(e,t,a){var n=U(Zt.copy(e),_t.identity()),i=G(_t,n);a.copy(t).applyMatrix3(i)}}]),t}(),Gt=new Pe,Ht=function(){function t(){e(this,t),this.data=null,this.ata=new $e,this.atb=new Pe,this.massPoint=new Pe,this.hasSolution=!1}return n(t,[{key:\"setData\",value:function(e){return this.data=e,this.hasSolution=!1,this}},{key:\"solve\",value:function(e){var t=this.data,a=this.massPoint,n=this.ata.copy(t.ata),i=this.atb.copy(t.atb),l=1/0;return!this.hasSolution&&null!==t&&0<t.numPoints&&(Gt.copy(t.massPointSum).divideScalar(t.numPoints),a.copy(Gt),n.applyToVector3(Gt),i.sub(Gt),Qt.solve(n,i,e),l=H(n,i,e),e.add(a),this.hasSolution=!0),l}}]),t}(),Jt=function t(){e(this,t),this.materials=0,this.edgeCount=0,this.index=-1,this.position=new Pe,this.normal=new Pe,this.qefData=null},Kt=new Ht,Wt=.1,$t=-1,ea=function(t){function a(t,n){var i;return e(this,a),i=k(this,s(a).call(this,t,n)),i.voxel=null,i}return l(a,t),n(a,[{key:\"contains\",value:function(e){var t=this.min,a=this.size;return e.x>=t.x-Wt&&e.y>=t.y-Wt&&e.z>=t.z-Wt&&e.x<=t.x+a+Wt&&e.y<=t.y+a+Wt&&e.z<=t.z+a+Wt}},{key:\"collapse\",value:function(){var e,t,a,n,l,o,s,r=this.children,d=[-1,-1,-1,-1,-1,-1,-1,-1],y=new Pe,u=-1,c=null!==r,m=0;if(c){for(n=new Lt,o=0,s=0;8>s;++s)e=r[s],m+=e.collapse(),a=e.voxel,null===e.children?null!==a&&(n.addData(a.qefData),u=1&a.materials>>7-s,d[s]=1&a.materials>>s,++o):c=!1;if(c&&(l=Kt.setData(n).solve(y),l<=$t)){for(a=new Jt,a.position.copy(this.contains(y)?y:Kt.massPoint),s=0;8>s;++s)t=d[s],e=r[s],-1===t?a.materials|=u<<s:(a.materials|=t<<s,a.normal.add(e.voxel.normal));a.normal.normalize(),a.qefData=n,this.voxel=a,this.children=null,m+=o-1}}return m}}],[{key:\"errorThreshold\",get:function(){return $t},set:function(e){$t=e}}]),a}(st),ta=function t(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null;e(this,t),this.action=a,this.error=null},aa=function(){function t(a,n,i,l,o){e(this,t),this.indices=a,this.positions=n,this.normals=i,this.uvs=l,this.materials=o}return n(t,[{key:\"serialize\",value:function(){return{indices:this.indices,positions:this.positions,normals:this.normals,uvs:this.uvs,materials:this.materials}}},{key:\"deserialize\",value:function(e){var t=this;return null===e?t=null:(this.indices=e.indices,this.positions=e.positions,this.normals=e.normals,this.uvs=e.uvs,this.materials=e.materials),t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.indices.buffer),e.push(this.positions.buffer),e.push(this.normals.buffer),e.push(this.uvs.buffer),e.push(this.materials.buffer),e}}]),t}(),na=[new Uint8Array([0,4,0]),new Uint8Array([1,5,0]),new Uint8Array([2,6,0]),new Uint8Array([3,7,0]),new Uint8Array([0,2,1]),new Uint8Array([4,6,1]),new Uint8Array([1,3,1]),new Uint8Array([5,7,1]),new Uint8Array([0,1,2]),new Uint8Array([2,3,2]),new Uint8Array([4,5,2]),new Uint8Array([6,7,2])],ia=[new Uint8Array([0,1,2,3,0]),new Uint8Array([4,5,6,7,0]),new Uint8Array([0,4,1,5,1]),new Uint8Array([2,6,3,7,1]),new Uint8Array([0,2,4,6,2]),new Uint8Array([1,3,5,7,2])],la=[[new Uint8Array([4,0,0]),new Uint8Array([5,1,0]),new Uint8Array([6,2,0]),new Uint8Array([7,3,0])],[new Uint8Array([2,0,1]),new Uint8Array([6,4,1]),new Uint8Array([3,1,1]),new Uint8Array([7,5,1])],[new Uint8Array([1,0,2]),new Uint8Array([3,2,2]),new Uint8Array([5,4,2]),new Uint8Array([7,6,2])]],oa=[[new Uint8Array([1,4,0,5,1,1]),new Uint8Array([1,6,2,7,3,1]),new Uint8Array([0,4,6,0,2,2]),new Uint8Array([0,5,7,1,3,2])],[new Uint8Array([0,2,3,0,1,0]),new Uint8Array([0,6,7,4,5,0]),new Uint8Array([1,2,0,6,4,2]),new Uint8Array([1,3,1,7,5,2])],[new Uint8Array([1,1,0,3,2,0]),new Uint8Array([1,5,4,7,6,0]),new Uint8Array([0,1,5,0,4,1]),new Uint8Array([0,3,7,2,6,1])]],sa=[[new Uint8Array([3,2,1,0,0]),new Uint8Array([7,6,5,4,0])],[new Uint8Array([5,1,4,0,1]),new Uint8Array([7,3,6,2,1])],[new Uint8Array([6,4,2,0,2]),new Uint8Array([7,5,3,1,2])]],ra=[new Uint8Array([3,2,1,0]),new Uint8Array([7,5,6,4]),new Uint8Array([11,10,9,8])],da=ue(2,16)-1,ya=function(){function t(){e(this,t)}return n(t,null,[{key:\"run\",value:function(e){var t=[],a=e.voxelCount,n=null,i=null,l=null,o=null,s=null;return a>da?console.warn(\"Could not create geometry for cell at position\",e.min,\"(vertex count of\",a,\"exceeds limit of \",da,\")\"):0<a&&(i=new Float32Array(3*a),l=new Float32Array(3*a),o=new Float32Array(2*a),s=new Uint8Array(a),ee(e.root,i,l,0),$(e.root,t),n=new aa(new Uint16Array(t),i,l,o,s)),n}}]),t}(),ua=function(t){function a(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Pe,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return e(this,a),n=k(this,s(a).call(this)),n.root=new ea(i,l),n.voxelCount=0,null!==t&&null!==t.edgeData&&n.construct(t),0<=ea.errorThreshold&&n.simplify(),n}return l(a,t),n(a,[{key:\"simplify\",value:function(){this.voxelCount-=this.root.collapse()}},{key:\"construct\",value:function(e){var t,a,l,o,s,r,u,c,m,p,v,g=Ot.resolution,n=e.edgeData,k=e.materialIndices,h=new Ht,f=new Pe,S=[n.edgesX(this.min,this.root.size),n.edgesY(this.min,this.root.size),n.edgesZ(this.min,this.root.size)],w=[new Uint8Array([0,1,2,3]),new Uint8Array([0,1,4,5]),new Uint8Array([0,2,4,6])],T=0;for(p=0;3>p;++p){l=w[p],t=S[p];var I=!0,C=!1,P=void 0;try{for(var b,E=t[Symbol.iterator]();!(I=(b=E.next()).done);I=!0)for(a=b.value,a.computeZeroCrossingPosition(f),v=0;4>v;++v)o=it[l[v]],u=a.coordinates.x-o[0],c=a.coordinates.y-o[1],m=a.coordinates.z-o[2],0<=u&&0<=c&&0<=m&&u<g&&c<g&&m<g&&(s=te(this.root,g,u,c,m),null===s.voxel&&(s.voxel=ae(g,u,c,m,k),++T),r=s.voxel,r.normal.add(a.n),r.qefData.add(f,a.n),r.qefData.numPoints===r.edgeCount&&(h.setData(r.qefData).solve(r.position),!s.contains(r.position)&&r.position.copy(h.massPoint),r.normal.normalize()))}catch(e){C=!0,P=e}finally{try{I||null==E[\"return\"]||E[\"return\"]()}finally{if(C)throw P}}}this.voxelCount=T}}]),a}(vt),ca={EXTRACT:\"worker.extract\",MODIFY:\"worker.modify\",CONFIGURE:\"worker.config\",CLOSE:\"worker.close\"},ma=function(t){function a(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return e(this,a),t=k(this,s(a).call(this,n)),t.data=null,t}return l(a,t),a}(ta),xa=function(t){function a(){var t;return e(this,a),t=k(this,s(a).call(this,ca.EXTRACT)),t.isosurface=null,t}return l(a,t),a}(ma),pa=new Ot(!1),va=function(){function t(){e(this,t),this.data=null,this.response=null}return n(t,[{key:\"getData\",value:function(){return this.data}},{key:\"respond\",value:function(){return this.response.data=this.data.serialize(),this.response}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.data&&this.data.createTransferList(e),e}},{key:\"process\",value:function(e){return this.data=pa.deserialize(e.data),this}}]),t}(),ga=function(t){function a(){var t;return e(this,a),t=k(this,s(a).call(this)),t.response=new xa,t.decompressionTarget=new Ot(!1),t.isosurface=null,t}return l(a,t),n(a,[{key:\"respond\",value:function(){var e=z(s(a.prototype),\"respond\",this).call(this);return e.isosurface=null===this.isosurface?null:this.isosurface.serialise(),e}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return z(s(a.prototype),\"createTransferList\",this).call(this,e),null===this.isosurface?e:this.isosurface.createTransferList(e)}},{key:\"process\",value:function(e){var t=z(s(a.prototype),\"process\",this).call(this,e).getData(),n=new ua(t.decompress(this.decompressionTarget));return this.isosurface=ya.run(n),this.decompressionTarget.clear(),this}}]),a}(va),ka={UNION:\"csg.union\",DIFFERENCE:\"csg.difference\",INTERSECTION:\"csg.intersection\",DENSITY_FUNCTION:\"csg.densityfunction\"},ha=function(){function t(a){e(this,t),this.type=a;for(var n=arguments.length,i=Array(1<n?n-1:0),l=1;l<n;l++)i[l-1]=arguments[l];this.children=i,this.boundingBox=null}return n(t,[{key:\"getBoundingBox\",value:function(){return null===this.boundingBox&&(this.boundingBox=this.computeBoundingBox()),this.boundingBox}},{key:\"computeBoundingBox\",value:function(){var e,t,a=this.children,n=new v;for(e=0,t=a.length;e<t;++e)n.union(a[e].getBoundingBox());return n}}]),t}(),za=function(t){function a(){var t;e(this,a);for(var n=arguments.length,i=Array(n),l=0;l<n;l++)i[l]=arguments[l];return k(this,(t=s(a)).call.apply(t,[this,ka.UNION].concat(i)))}return l(a,t),n(a,[{key:\"updateMaterialIndex\",value:function(e,t,a){var n=a.materialIndices[e];n!==At.AIR&&t.setMaterialIndex(e,n)}},{key:\"selectEdge\",value:function(e,t,a){return a?e.t>t.t?e:t:e.t<t.t?e:t}}]),a}(ha),fa=function(t){function a(){var t;e(this,a);for(var n=arguments.length,i=Array(n),l=0;l<n;l++)i[l]=arguments[l];return k(this,(t=s(a)).call.apply(t,[this,ka.DIFFERENCE].concat(i)))}return l(a,t),n(a,[{key:\"updateMaterialIndex\",value:function(e,t,a){a.materialIndices[e]!==At.AIR&&t.setMaterialIndex(e,At.AIR)}},{key:\"selectEdge\",value:function(e,t,a){return a?e.t<t.t?e:t:e.t>t.t?e:t}}]),a}(ha),Sa=function(t){function a(){var t;e(this,a);for(var n=arguments.length,i=Array(n),l=0;l<n;l++)i[l]=arguments[l];return k(this,(t=s(a)).call.apply(t,[this,ka.INTERSECTION].concat(i)))}return l(a,t),n(a,[{key:\"updateMaterialIndex\",value:function(e,t,a){var n=a.materialIndices[e];t.setMaterialIndex(e,t.materialIndices[e]!==At.AIR&&n!==At.AIR?n:At.AIR)}},{key:\"selectEdge\",value:function(e,t,a){return a?e.t<t.t?e:t:e.t>t.t?e:t}}]),a}(ha),wa=0,Ta=new Pe,Ia=function(){function t(){e(this,t)}return n(t,null,[{key:\"run\",value:function(e,t,a,n){Ta.fromArray(e),wa=t,null===a?n.operation===ka.UNION&&(a=new Ot(!1)):a.decompress();var i=n.toCSG(),l=null===a?null:de(i);if(null!==l){switch(n.operation){case ka.UNION:i=new za(i);break;case ka.DIFFERENCE:i=new fa(i);break;case ka.INTERSECTION:i=new Sa(i);}re(i,a,l),a.contoured=!1}return null!==a&&a.empty?null:a}}]),t}(),Ca=function(t){function a(t){var n;return e(this,a),n=k(this,s(a).call(this,ka.DENSITY_FUNCTION)),n.sdf=t,n}return l(a,t),n(a,[{key:\"computeBoundingBox\",value:function(){return this.sdf.getBoundingBox(!0)}},{key:\"generateMaterialIndex\",value:function(e){return this.sdf.sample(e)<=Ot.isovalue?this.sdf.material:At.AIR}},{key:\"generateEdge\",value:function(e){e.approximateZeroCrossing(this.sdf),e.computeSurfaceNormal(this.sdf)}}]),a}(ha),Pa=new c,ba=function(){function t(a){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:At.SOLID;e(this,t),this.type=a,this.operation=null,this.material=Ie(255,Te(At.SOLID,ce(n))),this.boundingBox=null,this.position=new Pe,this.quaternion=new Me,this.scale=new Pe(1,1,1),this.inverseTransformation=new c,this.updateInverseTransformation(),this.children=[]}return n(t,[{key:\"getTransformation\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new c;return e.compose(this.position,this.quaternion,this.scale)}},{key:\"getBoundingBox\",value:function(){var e,t,a=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],n=this.children,o=this.boundingBox;if(null===o&&(o=this.computeBoundingBox(),this.boundingBox=o),a)for(o=o.clone(),e=0,t=n.length;e<t;++e)o.union(n[e].getBoundingBox(a));return o}},{key:\"setMaterial\",value:function(e){return this.material=Ie(255,Te(At.SOLID,ce(e))),this}},{key:\"setOperationType\",value:function(e){return this.operation=e,this}},{key:\"updateInverseTransformation\",value:function(){return this.inverseTransformation.getInverse(this.getTransformation(Pa)),this.boundingBox=null,this}},{key:\"union\",value:function(e){return this.children.push(e.setOperationType(ka.UNION)),this}},{key:\"subtract\",value:function(e){return this.children.push(e.setOperationType(ka.DIFFERENCE)),this}},{key:\"intersect\",value:function(e){return this.children.push(e.setOperationType(ka.INTERSECTION)),this}},{key:\"toCSG\",value:function(){var e,t,a,n,o=this.children,s=new Ca(this);for(a=0,n=o.length;a<n;++a)t=o[a],e!==t.operation&&(e=t.operation,e===ka.UNION?s=new za(s):e===ka.DIFFERENCE?s=new fa(s):e===ka.INTERSECTION?s=new Sa(s):void 0),s.children.push(t.toCSG());return s}},{key:\"serialize\",value:function(){var e,t,a=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],n={type:this.type,operation:this.operation,material:this.material,position:this.position.toArray(),quaternion:this.quaternion.toArray(),scale:this.scale.toArray(),parameters:null,children:[]};for(e=0,t=this.children.length;e<t;++e)n.children.push(this.children[e].serialize(a));return n}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e}},{key:\"toJSON\",value:function(){return this.serialize(!0)}},{key:\"computeBoundingBox\",value:function(){throw new Error(\"SignedDistanceFunction#computeBoundingBox method not implemented!\")}},{key:\"sample\",value:function(){throw new Error(\"SignedDistanceFunction#sample method not implemented!\")}}]),t}(),Ea={HEIGHTFIELD:\"sdf.heightfield\",FRACTAL_NOISE:\"sdf.fractalnoise\",SUPER_PRIMITIVE:\"sdf.superprimitive\"},Da=function(t){function a(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=1<arguments.length?arguments[1]:void 0;return e(this,a),t=k(this,s(a).call(this,Ea.PERLIN_NOISE,i)),t.min=x(Pe,w(n.min)),t.max=x(Pe,w(n.max)),t}return l(a,t),n(a,[{key:\"computeBoundingBox\",value:function(){return this.bbox=new v(this.min,this.max),this.bbox}},{key:\"sample\",value:function(){}},{key:\"serialize\",value:function(){var e=z(s(a.prototype),\"serialize\",this).call(this);return e.parameters={min:this.min.toArray(),max:this.max.toArray()},e}}]),a}(ba),Fa=function(t){function a(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=1<arguments.length?arguments[1]:void 0;return e(this,a),t=k(this,s(a).call(this,Ea.HEIGHTFIELD,i)),t.width=void 0===n.width?1:n.width,t.height=void 0===n.height?1:n.height,t.smooth=void 0===n.smooth||n.smooth,t.data=void 0===n.data?null:n.data,t.heightmap=null,void 0!==n.image&&t.fromImage(n.image),t}return l(a,t),n(a,[{key:\"fromImage\",value:function(e){var t,a,n,o,s=\"undefined\"==typeof document?null:ye(e),r=null;if(null!==s){for(t=s.data,r=new Uint8ClampedArray(t.length/4),(a=0,n=0,o=r.length);a<o;++a,n+=4)r[a]=t[n];this.heightmap=e,this.width=s.width,this.height=s.height,this.data=r}return this}},{key:\"getHeight\",value:function(e,t){var n,i=this.width,l=this.height,o=this.data;if(e=ve(e*i),t=ve(t*l),this.smooth){e=Te(Ie(e,i-1),1),t=Te(Ie(t,l-1),1);var s=e+1,r=e-1,d=t*i,a=d+i,y=d-i;n=(o[y+r]+o[y+e]+o[y+s]+o[d+r]+o[d+e]+o[d+s]+o[a+r]+o[a+e]+o[a+s])/9}else n=o[t*i+e];return n}},{key:\"computeBoundingBox\",value:function(){var e=new v,t=Ie(this.width/this.height,1),a=Ie(this.height/this.width,1);return e.min.set(0,0,0),e.max.set(t,1,a),e.applyMatrix4(this.getTransformation()),e}},{key:\"sample\",value:function(e){var t,a=this.boundingBox;return a.containsPoint(e)?(e.applyMatrix4(this.inverseTransformation),t=e.y-this.getHeight(e.x,e.z)/255):t=a.distanceToPoint(e),t}},{key:\"serialize\",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t=z(s(a.prototype),\"serialize\",this).call(this);return t.parameters={width:this.width,height:this.height,smooth:this.smooth,data:e?null:this.data,dataURL:e&&null!==this.heightmap?this.heightmap.toDataURL():null,image:null},t}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.data.buffer),e}}]),a}(ba),qa=function(t){function a(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=1<arguments.length?arguments[1]:void 0;return e(this,a),t=k(this,s(a).call(this,Ea.SUPER_PRIMITIVE,i)),t.s0=x(et,w(n.s)),t.r0=x(Pe,w(n.r)),t.s=new et,t.r=new Pe,t.ba=new qe,t.offset=0,t.precompute(),t}return l(a,t),n(a,[{key:\"setSize\",value:function(e,t,a,n){return this.s0.set(e,t,a,n),this.precompute()}},{key:\"setRadii\",value:function(e,t,a){return this.r0.set(e,t,a),this.precompute()}},{key:\"precompute\",value:function(){var e=this.s.copy(this.s0),t=this.r.copy(this.r0),a=this.ba;e.x-=t.x,e.y-=t.x,t.x-=e.w,e.w-=t.y,e.z-=t.y,this.offset=-2*e.z,a.set(t.z,this.offset);var n=a.dot(a);return 0===n?a.set(0,-1):a.divideScalar(n),this}},{key:\"computeBoundingBox\",value:function(){var e=this.s0,t=new v;return t.min.x=Ie(-e.x,-1),t.min.y=Ie(-e.y,-1),t.min.z=Ie(-e.z,-1),t.max.x=Te(e.x,1),t.max.y=Te(e.y,1),t.max.z=Te(e.z,1),t.applyMatrix4(this.getTransformation()),t}},{key:\"sample\",value:function(e){e.applyMatrix4(this.inverseTransformation);var t=this.s,a=this.r,n=this.ba,i=we(e.x)-t.x,l=we(e.y)-t.y,o=we(e.z)-t.z,s=Te(i,0),r=Te(l,0),d=ke(s*s+r*r),y=e.z-t.z,u=we(d+Ie(0,Te(i,l))-a.x)-t.w,m=Ie(Te(u*n.x+y*n.y,0),1),c=u-a.z*m,x=y-this.offset*m,p=Te(u-a.z,0),v=e.z+t.z,g=Te(u,0),k=u*-n.y+y*n.x,h=ke(Ie(c*c+x*x,Ie(p*p+v*v,g*g+y*y)));return h*me(Te(k,o))-a.y}},{key:\"serialize\",value:function(){var e=z(s(a.prototype),\"serialize\",this).call(this);return e.parameters={s:this.s0.toArray(),r:this.r0.toArray()},e}}],[{key:\"create\",value:function(e){var t=Aa[e];return new a({s:t[0],r:t[1]})}}]),a}(ba),Aa=[[new Float32Array([1,1,1,1]),new Float32Array([0,0,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,0,0])],[new Float32Array([0,0,1,1]),new Float32Array([0,0,1])],[new Float32Array([1,1,2,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,.25,1]),new Float32Array([1,.25,0])],[new Float32Array([1,1,.25,.25]),new Float32Array([1,.25,0])],[new Float32Array([1,1,1,.25]),new Float32Array([1,.1,0])],[new Float32Array([1,1,1,.25]),new Float32Array([.1,.1,0])]],Va=function(){function t(){e(this,t)}return n(t,[{key:\"revive\",value:function(e){var t,a,n;switch(e.type){case Ea.FRACTAL_NOISE:t=new Da(e.parameters,e.material);break;case Ea.HEIGHTFIELD:t=new Fa(e.parameters,e.material);break;case Ea.SUPER_PRIMITIVE:t=new qa(e.parameters,e.material);}for(t.operation=e.operation,t.position.fromArray(e.position),t.quaternion.fromArray(e.quaternion),t.scale.fromArray(e.scale),t.updateInverseTransformation(),(a=0,n=e.children.length);a<n;++a)t.children.push(this.revive(e.children[a]));return t}}]),t}(),Ba=function(t){function a(){var t;return e(this,a),t=k(this,s(a).call(this,ca.MODIFY)),t.sdf=null,t}return l(a,t),a}(ma),Na=function(t){function a(){var t;return e(this,a),t=k(this,s(a).call(this)),t.response=new Ba,t.sdf=null,t}return l(a,t),n(a,[{key:\"respond\",value:function(){var e=z(s(a.prototype),\"respond\",this).call(this);return e.sdf=null===this.sdf?null:this.sdf.serialize(),e}},{key:\"createTransferList\",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return z(s(a.prototype),\"createTransferList\",this).call(this,e),null===this.sdf?e:this.sdf.createTransferList(e)}},{key:\"process\",value:function(e){var t=z(s(a.prototype),\"process\",this).call(this,e).getData(),n=this.sdf=Va.revive(e.sdf),i=Ia.run(e.cellPosition,e.cellSize,t,n);return S(s(a.prototype),\"data\",null===i?null:i.compress(),this,!0),this}}]),a}(va),Oa=new Na,La=new ga,Ma=null;self.addEventListener(\"message\",function(e){var t=e.data;switch(Ma=t.action,Ma){case ca.MODIFY:postMessage(Oa.process(t).respond(),Oa.createTransferList());break;case ca.EXTRACT:postMessage(La.process(t).respond(),La.createTransferList());break;case ca.CONFIGURE:Ot.resolution=t.resolution,ea.errorThreshold=t.errorThreshold;break;case ca.CLOSE:default:close();}}),self.addEventListener(\"error\",function(e){var t,a=Ma===ca.MODIFY?Oa:Ma===ca.EXTRACT?La:null;null===a?(t=new ta(ca.CLOSE),t.error=e,postMessage(t)):(t=a.respond(),t.action=ca.CLOSE,t.error=e,postMessage(t,a.createTransferList())),close()})})();\n"],{type:"text/javascript"})),n.maxWorkers=yt(navigator.hardwareConcurrency,ct(e,1)),n.workers=[],n.busyWorkers=new WeakSet,n.configurationMessage=new sr,n}return g(t,e),o(t,[{key:"handleEvent",value:function(e){switch(e.type){case"message":{this.busyWorkers["delete"](e.target),dr.worker=e.target,dr.response=e.data,this.dispatchEvent(dr),this.workers.length>this.maxWorkers&&this.closeWorker(e.target);break}case"error":{console.error("Encountered an unexpected error",e);break}}}},{key:"closeWorker",value:function(e){var t=this.workers.indexOf(e);this.busyWorkers.has(e)?(this.busyWorkers["delete"](e),e.terminate()):e.postMessage(new nr(tr.CLOSE)),e.removeEventListener("message",this),e.removeEventListener("error",this),0<=t&&this.workers.splice(t,1)}},{key:"createWorker",value:function(){var e=new Worker(this.workerURL);return this.workers.push(e),e.addEventListener("message",this),e.addEventListener("error",this),e.postMessage(this.configurationMessage),e}},{key:"getWorker",value:function(){var e=null,t,n;for(t=0,n=this.workers.length;t<n;++t)if(!this.busyWorkers.has(this.workers[t])){e=this.workers[t],this.busyWorkers.add(e);break}return null===e&&this.workers.length<this.maxWorkers&&null!==this.workerURL&&(e=this.createWorker(),this.busyWorkers.add(e)),e}},{key:"clear",value:function(){for(;0<this.workers.length;)this.closeWorker(this.workers.pop())}},{key:"dispose",value:function(){this.clear(),URL.revokeObjectURL(this.workerURL),this.workerURL=null}}]),t}(vt),yr=function(e){function t(e){var n;return i(this,t),n=A(this,k(t).call(this,e)),n.octant=null,n.octantId=null,n.error=null,n}return g(t,e),t}(gt),hr=new yr("modificationstart"),mr=new yr("modificationend"),pr=new yr("extractionstart"),gr=new yr("extractionend"),vr=new yr("load"),fr=new yr("error"),xr=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n;i(this,t);var a=void 0===e.world?{}:e.world;return oi.resolution=void 0===e.resolution?32:e.resolution,n=A(this,k(t).call(this)),n.object=null,n.world=new Gi(a.cellSize,a.levels,a.keyDesign),n.clipmap=new er(n.world),n.clipmap.addEventListener("shellupdate",E(n)),n.threadPool=new cr(e.workers),n.threadPool.addEventListener("message",E(n)),n.tasks=new WeakMap,n.sdfLoader=new ki,n.sdfLoader.addEventListener("load",E(n)),n.history=[],n.dtSq=n.world.getCellSize(),n}return g(t,e),o(t,[{key:"handleEvent",value:function(e){switch(e.type){case"shellupdate":break;case"message":break;case"load":this.revive(e.descriptions),this.dispatchEvent(vr);}}},{key:"applyCSG",value:function(e){this.world.applyCSG(e),this.history.push(e)}},{key:"union",value:function(e){this.applyCSG(e.setOperationType(xa.UNION))}},{key:"subtract",value:function(e){this.applyCSG(e.setOperationType(xa.DIFFERENCE))}},{key:"intersect",value:function(e){this.applyCSG(e.setOperationType(xa.INTERSECTION))}},{key:"update",value:function(e){this.clipmap.position.distanceToSquared(e)>=this.dtSq&&this.clipmap.update(e)}},{key:"raycast",value:function(e){return this.world.raycast(e)}},{key:"clear",value:function(){this.world.clear(),this.clipmap.clear(),this.threadPool.clear(),this.sdfLoader.clear(),this.tasks=new WeakMap,this.history=[]}},{key:"dispose",value:function(){this.threadPool.dispose()}},{key:"revive",value:function(e){var t,n;for(t=0,n=e.length;t<n;++t)this.applyCSG(vi.revive(e[t]))}},{key:"save",value:function(){return 0===this.history.length?null:URL.createObjectURL(new Blob([JSON.stringify(this.history)],{type:"text/json"}))}},{key:"load",value:function(e){var t=JSON.parse(e);this.clear(),this.sdfLoader.load(t)}}]),t}(vt),kr=function(){function e(t,n,a,r,s){i(this,e),this.indices=t,this.positions=n,this.normals=a,this.uvs=r,this.materials=s}return o(e,[{key:"serialize",value:function(){return{indices:this.indices,positions:this.positions,normals:this.normals,uvs:this.uvs,materials:this.materials}}},{key:"deserialize",value:function(e){var t=this;return null===e?t=null:(this.indices=e.indices,this.positions=e.positions,this.normals=e.normals,this.uvs=e.uvs,this.materials=e.materials),t}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.indices.buffer),e.push(this.positions.buffer),e.push(this.normals.buffer),e.push(this.uvs.buffer),e.push(this.materials.buffer),e}}]),e}(),zr=[new Uint8Array([0,4,0]),new Uint8Array([1,5,0]),new Uint8Array([2,6,0]),new Uint8Array([3,7,0]),new Uint8Array([0,2,1]),new Uint8Array([4,6,1]),new Uint8Array([1,3,1]),new Uint8Array([5,7,1]),new Uint8Array([0,1,2]),new Uint8Array([2,3,2]),new Uint8Array([4,5,2]),new Uint8Array([6,7,2])],_r=[new Uint8Array([0,1,2,3,0]),new Uint8Array([4,5,6,7,0]),new Uint8Array([0,4,1,5,1]),new Uint8Array([2,6,3,7,1]),new Uint8Array([0,2,4,6,2]),new Uint8Array([1,3,5,7,2])],br=[[new Uint8Array([4,0,0]),new Uint8Array([5,1,0]),new Uint8Array([6,2,0]),new Uint8Array([7,3,0])],[new Uint8Array([2,0,1]),new Uint8Array([6,4,1]),new Uint8Array([3,1,1]),new Uint8Array([7,5,1])],[new Uint8Array([1,0,2]),new Uint8Array([3,2,2]),new Uint8Array([5,4,2]),new Uint8Array([7,6,2])]],wr=[[new Uint8Array([1,4,0,5,1,1]),new Uint8Array([1,6,2,7,3,1]),new Uint8Array([0,4,6,0,2,2]),new Uint8Array([0,5,7,1,3,2])],[new Uint8Array([0,2,3,0,1,0]),new Uint8Array([0,6,7,4,5,0]),new Uint8Array([1,2,0,6,4,2]),new Uint8Array([1,3,1,7,5,2])],[new Uint8Array([1,1,0,3,2,0]),new Uint8Array([1,5,4,7,6,0]),new Uint8Array([0,1,5,0,4,1]),new Uint8Array([0,3,7,2,6,1])]],Sr=[[new Uint8Array([3,2,1,0,0]),new Uint8Array([7,6,5,4,0])],[new Uint8Array([5,1,4,0,1]),new Uint8Array([7,3,6,2,1])],[new Uint8Array([6,4,2,0,2]),new Uint8Array([7,5,3,1,2])]],Er=[new Uint8Array([3,2,1,0]),new Uint8Array([7,5,6,4]),new Uint8Array([11,10,9,8])],Ar=ht(2,16)-1,Cr=function(){function e(){i(this,e)}return o(e,null,[{key:"run",value:function(e){var t=[],n=e.voxelCount,a=null,i=null,r=null,s=null,o=null;return n>Ar?console.warn("Could not create geometry for cell at position",e.min,"(vertex count of",n,"exceeds limit of ",Ar,")"):0<n&&(i=new Float32Array(3*n),r=new Float32Array(3*n),s=new Float32Array(2*n),o=new Uint8Array(n),Oe(e.root,i,r,0),De(e.root,t),a=new kr(new Uint16Array(t),i,r,s,o)),a}}]),e}(),Pr=new xn,Tr=function(){function e(){i(this,e)}return o(e,null,[{key:"calculateCoefficients",value:function(e,t,n){var a,i,r;return 0===t?(Pr.x=1,Pr.y=0):(a=(n-e)/(2*t),i=rt(1+a*a),r=1/(0<=a?a+i:a-i),Pr.x=1/rt(1+r*r),Pr.y=r*Pr.x),Pr}}]),e}(),Ir=function(){function e(){i(this,e)}return o(e,null,[{key:"rotateXY",value:function(e,t){var n=t.x,a=t.y,i=e.x,r=e.y;e.set(n*i-a*r,a*i+n*r)}},{key:"rotateQXY",value:function(e,t,n){var a=n.x,i=n.y,r=a*a,s=i*i,o=2*a*i*t,l=e.x,u=e.y;e.set(r*l-o+s*u,s*l+o+r*u)}}]),e}(),Dr=.1,Or=new Nn,Lr=new bn,Fr=new xn,Mr=new mn,Br=function(){function e(){i(this,e)}return o(e,null,[{key:"solve",value:function(e,t,n){var a=Be(Or.copy(e),Lr.identity()),i=Ve(Lr,a);n.copy(t).applyMatrix3(i)}}]),e}(),Rr=new mn,Vr=function(){function e(){i(this,e),this.data=null,this.ata=new Nn,this.atb=new mn,this.massPoint=new mn,this.hasSolution=!1}return o(e,[{key:"setData",value:function(e){return this.data=e,this.hasSolution=!1,this}},{key:"solve",value:function(e){var t=this.data,n=this.massPoint,a=this.ata.copy(t.ata),i=this.atb.copy(t.atb),r=1/0;return!this.hasSolution&&null!==t&&0<t.numPoints&&(Rr.copy(t.massPointSum).divideScalar(t.numPoints),n.copy(Rr),a.applyToVector3(Rr),i.sub(Rr),Br.solve(a,i,e),r=Ne(a,i,e),e.add(n),this.hasSolution=!0),r}}]),e}(),Nr=function(){function e(){i(this,e),this.ata=new Nn,this.ata.set(0,0,0,0,0,0),this.atb=new mn,this.massPointSum=new mn,this.numPoints=0}return o(e,[{key:"set",value:function(e,t,n,a){return this.ata.copy(e),this.atb.copy(t),this.massPointSum.copy(n),this.numPoints=a,this}},{key:"copy",value:function(e){return this.set(e.ata,e.atb,e.massPointSum,e.numPoints)}},{key:"add",value:function(e,t){var n=t.x,a=t.y,i=t.z,r=e.dot(t),s=this.ata.elements,o=this.atb;s[0]+=n*n,s[1]+=n*a,s[3]+=a*a,s[2]+=n*i,s[4]+=a*i,s[5]+=i*i,o.x+=r*n,o.y+=r*a,o.z+=r*i,this.massPointSum.add(e),++this.numPoints}},{key:"addData",value:function(e){this.ata.add(e.ata),this.atb.add(e.atb),this.massPointSum.add(e.massPointSum),this.numPoints+=e.numPoints}},{key:"clear",value:function(){this.ata.set(0,0,0,0,0,0),this.atb.set(0,0,0),this.massPointSum.set(0,0,0),this.numPoints=0}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),Ur=function e(){i(this,e),this.materials=0,this.edgeCount=0,this.index=-1,this.position=new mn,this.normal=new mn,this.qefData=null},qr=new Vr,Yr=.1,Xr=-1,jr=function(e){function t(e,n){var a;return i(this,t),a=A(this,k(t).call(this,e,n)),a.voxel=null,a}return g(t,e),o(t,[{key:"contains",value:function(e){var t=this.min,n=this.size;return e.x>=t.x-Yr&&e.y>=t.y-Yr&&e.z>=t.z-Yr&&e.x<=t.x+n+Yr&&e.y<=t.y+n+Yr&&e.z<=t.z+n+Yr}},{key:"collapse",value:function(){var e=this.children,t=[-1,-1,-1,-1,-1,-1,-1,-1],n=new mn,a=-1,r=null!==e,s=0,o,l,u,d,c,y,h;if(r){for(d=new Nr,y=0,h=0;8>h;++h)o=e[h],s+=o.collapse(),u=o.voxel,null===o.children?null!==u&&(d.addData(u.qefData),a=1&u.materials>>7-h,t[h]=1&u.materials>>h,++y):r=!1;if(r&&(c=qr.setData(d).solve(n),c<=Xr)){for(u=new Ur,u.position.copy(this.contains(n)?n:qr.massPoint),h=0;8>h;++h)l=t[h],o=e[h],-1===l?u.materials|=a<<h:(u.materials|=l<<h,u.normal.add(o.voxel.normal));u.normal.normalize(),u.qefData=d,this.voxel=u,this.children=null,s+=y-1}}return s}}],[{key:"errorThreshold",get:function(){return Xr},set:function(e){Xr=e}}]),t}(Da),Hr=function(e){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new mn,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,r;return i(this,t),r=A(this,k(t).call(this)),r.root=new jr(n,a),r.voxelCount=0,null!==e&&null!==e.edgeData&&r.construct(e),0<=jr.errorThreshold&&r.simplify(),r}return g(t,e),o(t,[{key:"simplify",value:function(){this.voxelCount-=this.root.collapse()}},{key:"construct",value:function(e){var t=oi.resolution,n=e.edgeData,a=e.materialIndices,r=new Vr,s=new mn,o=[n.edgesX(this.min,this.root.size),n.edgesY(this.min,this.root.size),n.edgesZ(this.min,this.root.size)],l=[new Uint8Array([0,1,2,3]),new Uint8Array([0,1,4,5]),new Uint8Array([0,2,4,6])],u=0,c,h,m,p,g,v,f,k,_,b,w;for(b=0;3>b;++b){m=l[b],c=o[b];var S=!0,E=!1,A=void 0;try{for(var C=c[Symbol.iterator](),P;!(S=(P=C.next()).done);S=!0)for(h=P.value,h.computeZeroCrossingPosition(s),w=0;4>w;++w)p=Pa[m[w]],f=h.coordinates.x-p[0],k=h.coordinates.y-p[1],_=h.coordinates.z-p[2],0<=f&&0<=k&&0<=_&&f<t&&k<t&&_<t&&(g=Ue(this.root,t,f,k,_),null===g.voxel&&(g.voxel=qe(t,f,k,_,a),++u),v=g.voxel,v.normal.add(h.n),v.qefData.add(s,h.n),v.qefData.numPoints===v.edgeCount&&(r.setData(v.qefData).solve(v.position),!g.contains(v.position)&&v.position.copy(r.massPoint),v.normal.normalize()))}catch(e){E=!0,A=e}finally{try{S||null==C["return"]||C["return"]()}finally{if(E)throw A}}}this.voxelCount=u}}]),t}(Ua),Gr=0,Zr=new mn,Wr=function(){function e(){i(this,e)}return o(e,null,[{key:"run",value:function(e,t,n,a){Zr.fromArray(e),Gr=t,null===n?a.operation===xa.UNION&&(n=new oi(!1)):n.decompress();var i=a.toCSG(),r=null===n?null:We(i);if(null!==r){switch(a.operation){case xa.UNION:i=new _a(i);break;case xa.DIFFERENCE:i=new ba(i);break;case xa.INTERSECTION:i=new wa(i);}Ze(i,n,r),n.contoured=!1}return null!==n&&n.empty?null:n}}]),e}(),Kr=new oi(!1),Qr=function(){function e(){i(this,e),this.data=null,this.response=null}return o(e,[{key:"getData",value:function(){return this.data}},{key:"respond",value:function(){return this.response.data=this.data.serialize(),this.response}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.data&&this.data.createTransferList(e),e}},{key:"process",value:function(e){return this.data=Kr.deserialize(e.data),this}}]),e}(),Jr=function(e){function t(){var e;return i(this,t),e=A(this,k(t).call(this)),e.response=new or,e.decompressionTarget=new oi(!1),e.isosurface=null,e}return g(t,e),o(t,[{key:"respond",value:function(){var e=P(k(t.prototype),"respond",this).call(this);return e.isosurface=null===this.isosurface?null:this.isosurface.serialise(),e}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return P(k(t.prototype),"createTransferList",this).call(this,e),null===this.isosurface?e:this.isosurface.createTransferList(e)}},{key:"process",value:function(e){var n=P(k(t.prototype),"process",this).call(this,e).getData(),a=new Hr(n.decompress(this.decompressionTarget));return this.isosurface=Cr.run(a),this.decompressionTarget.clear(),this}}]),t}(Qr),$r=function(e){function t(){var e;return i(this,t),e=A(this,k(t).call(this)),e.response=new lr,e.sdf=null,e}return g(t,e),o(t,[{key:"respond",value:function(){var e=P(k(t.prototype),"respond",this).call(this);return e.sdf=null===this.sdf?null:this.sdf.serialize(),e}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return P(k(t.prototype),"createTransferList",this).call(this,e),null===this.sdf?e:this.sdf.createTransferList(e)}},{key:"process",value:function(e){var n=P(k(t.prototype),"process",this).call(this,e).getData(),a=this.sdf=vi.revive(e.sdf),i=Wr.run(e.cellPosition,e.cellSize,n,a);return I(k(t.prototype),"data",null===i?null:i.compress(),this,!0),this}}]),t}(Qr),es=function(t){function n(){var t;return i(this,n),t=A(this,k(n).call(this,"contouring")),t.cellSize=1,t.cellPosition=new e.Vector3,t.cellPosition.subScalar(t.cellSize/2),t.sdfType=ci.SUPER_PRIMITIVE,t.euler=new q,t.scale=new e.Vector3,t.superPrimitivePreset=gi.TORUS,t.heightfield=new hi,t.hermiteData=null,t.octreeHelper=new ca,t.hermiteDataHelper=new da,t.box3Helper=new e.Box3Helper,t.material=new e.MeshPhysicalMaterial({color:37256,metalness:.23,roughness:.31,clearCoat:.94,clearCoatRoughness:.15,dithering:!0}),t.mesh=null,t.vertices=0,t.faces=0,t}return g(n,t),o(n,[{key:"createSVO",value:function(){var e=this.octreeHelper;e.octree=new Hr(this.hermiteData,this.cellPosition,this.cellSize),e.update(),function(e){var t=e.children,n,a,r,s,o,l,u,d;for(o=0,u=t.length;o<u;++o)for(n=t[o],a=n.children,s=o+1<u?3158064:12267568,(l=0,d=a.length);l<d;++l)r=a[l],r.material.color.setHex(s)}(e)}},{key:"createHermiteData",value:function(){var e;switch(this.sdfType){case ci.SUPER_PRIMITIVE:e=mi.create(this.superPrimitivePreset),e.quaternion.setFromEuler(this.euler),e.scale.copy(this.scale);break;case ci.HEIGHTFIELD:e=this.heightfield,e.position.set(-1,-.25,-1),e.quaternion.set(0,0,0,1),e.scale.set(2,.5,2);}return e.updateInverseTransformation(),this.box3Helper.box=e.getBoundingBox(),this.hermiteData=Wr.run(this.cellPosition.toArray(),this.cellSize,null,e.setOperationType(xa.UNION)),this.hermiteData}},{key:"contour",value:function(){var t=Cr.run(this.octreeHelper.octree),n,a;null!==t&&(null!==this.mesh&&(this.mesh.geometry.dispose(),this.scene.remove(this.mesh)),a=new e.BufferGeometry,a.setIndex(new e.BufferAttribute(t.indices,1)),a.addAttribute("position",new e.BufferAttribute(t.positions,3)),a.addAttribute("normal",new e.BufferAttribute(t.normals,3)),n=new e.Mesh(a,this.material),this.vertices=t.positions.length/3,this.faces=t.indices.length/3,this.mesh=n,this.scene.add(n))}},{key:"load",value:function(){var t=this.assets,n=this.loadingManager,a=new e.CubeTextureLoader(n),i=new e.TextureLoader(n),r="textures/skies/interstellar/",s=".jpg",o=[r+"px"+s,r+"nx"+s,r+"py"+s,r+"ny"+s,r+"pz"+s,r+"nz"+s];return new Promise(function(e,r){0===t.size?(n.onError=r,n.onProgress=function(t,n,a){n===a&&e()},a.load(o,function(e){t.set("sky",e)}),i.load("textures/height/03.png",function(e){t.set("heightmap",e)})):e()})}},{key:"initialize",value:function(){var t=this.scene,n=this.assets,a=this.renderer;this.sdfType=ci.SUPER_PRIMITIVE,this.euler.set(4.11,3.56,4.74,wn.XYZ),this.scale.set(.34,.47,.25),this.superPrimitivePreset=gi.TORUS;var i=new e.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,25);i.position.set(0,0,-2),this.camera=i;var r=new la(i.position,i.quaternion,a.domElement);r.settings.pointer.lock=!1,r.settings.sensitivity.rotation=.00175,r.settings.sensitivity.translation=.425,r.settings.sensitivity.zoom=.2,r.settings.zoom.maxDistance=20,r.lookAt(t.position),this.controls=r,t.fog=new e.FogExp2(16053492,.075),a.setClearColor(t.fog.color),t.background=n.get("sky"),this.material.envMap=n.get("sky");var s=new e.AmbientLight(4210752),o=new e.DirectionalLight(16759722);o.position.set(-.5,1.5,1),o.target.position.copy(t.position),t.add(o),t.add(s),this.heightfield.fromImage(n.get("heightmap").image),oi.resolution=64,da.air=ka.AIR,jr.errorThreshold=.005,this.createHermiteData(),this.octreeHelper.visible=!0,t.add(this.octreeHelper),t.add(this.hermiteDataHelper),t.add(this.box3Helper),this.createSVO();var l=new e.Box3,u=this.cellSize/2;l.min.set(-u,-u,-u),l.max.set(u,u,u);var d=new e.Box3Helper(l,3158064);d.material.transparent=!0,d.material.opacity=.25,t.add(d)}},{key:"render",value:function(e){this.controls.update(e),P(k(n.prototype),"render",this).call(this,e)}},{key:"registerOptions",value:function(e){var t=this,n=this.octreeHelper,a=this.hermiteDataHelper,i=this.box3Helper,r=Object.keys(gi).concat(["HEIGHTFIELD"]),s={SDF:r[this.superPrimitivePreset],color:this.material.color.getHex(),"level mask":n.children.length,"show SVO":function(){"HEIGHTFIELD"===s.SDF?t.sdfType=ci.HEIGHTFIELD:(t.superPrimitivePreset=gi[s.SDF],t.sdfType=ci.SUPER_PRIMITIVE),t.createHermiteData(),t.createSVO(),null!==t.mesh&&t.scene.remove(t.mesh),a.dispose(),n.visible=!0,i.visible=!0,s["level mask"]=n.children.length},"show Hermite data":function(){a.set(t.cellPosition,t.cellSize,t.hermiteData);try{a.update(),a.visible=!0,n.visible=!1,i.visible=!1}catch(t){console.error(t)}},contour:function(){t.createHermiteData(),t.createSVO(),t.contour(),n.visible=!1,a.visible=!1,i.visible=!1}};e.add(s,"SDF",r).onChange(s["show SVO"]);var o=e.addFolder("Octree Helper");o.add(s,"level mask").min(0).max(1+$e(128)).step(1).onChange(function(){var e,t;for(e=0,t=n.children.length;e<t;++e)n.children[e].visible=s["level mask"]>=n.children.length||e===s["level mask"]}).listen(),o=e.addFolder("Transformation");var l=o.addFolder("Rotation");l.add(this.euler,"x").min(0).max(2*nt).step(1e-4),l.add(this.euler,"y").min(0).max(2*nt).step(1e-4),l.add(this.euler,"z").min(0).max(2*nt).step(1e-4),l=o.addFolder("Scale"),l.add(this.scale,"x").min(0).max(.5).step(1e-4),l.add(this.scale,"y").min(0).max(.5).step(1e-4),l.add(this.scale,"z").min(0).max(.5).step(1e-4),o=e.addFolder("Material"),o.add(this.material,"metalness").min(0).max(1).step(1e-4),o.add(this.material,"roughness").min(0).max(1).step(1e-4),o.add(this.material,"clearCoat").min(0).max(1).step(1e-4),o.add(this.material,"clearCoatRoughness").min(0).max(1).step(1e-4),o.add(this.material,"reflectivity").min(0).max(1).step(1e-4),o.addColor(s,"color").onChange(function(){return t.material.color.setHex(s.color)}),o.add(this.material,"wireframe"),o.add(this.material,"flatShading").onChange(function(){t.material.needsUpdate=!0}),e.add(oi,"resolution",[32,64,128]),e.add(jr,"errorThreshold").min(0).max(.01).step(1e-4),e.add(s,"show SVO"),e.add(s,"show Hermite data"),e.add(s,"contour"),o=e.addFolder("Render Info"),o.add(this,"vertices").listen(),o.add(this,"faces").listen()}}]),n}(pt),ts=function(e){function t(e){var n;return i(this,t),n=A(this,k(t).call(this,e)),n.qefData=null,n}return g(t,e),t}(gt),ns=new e.Vector2,as=new gt("update"),is=function(t){function n(t,a,r,s){var o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:document.body,l;return i(this,n),l=A(this,k(n).call(this)),l.hermiteData=r,l.cellPosition=t,l.cellSize=a,l.camera=s,l.dom=o,l.raycaster=new e.Raycaster,l.gridPointMaterials=[new e.MeshBasicMaterial({color:10066329,depthWrite:!1,transparent:!0,opacity:.75}),new e.MeshBasicMaterial({color:13395558,depthWrite:!1,transparent:!0,opacity:.9})],l.selectedGridPoint=null,l.gridPoints=new e.Group,l.createGridPoints(),l}return g(n,t),o(n,[{key:"createGridPoints",value:function(){var t=this.gridPoints,a=this.cellSize,i=oi.resolution,n=this.cellPosition,r=new e.Vector3,s=new e.SphereBufferGeometry(.05,8,8),o=this.gridPointMaterials[0],l,u,d,c;for(c=0;c<=i;++c)for(r.z=c*a/i,d=0;d<=i;++d)for(r.y=d*a/i,u=0;u<=i;++u)r.x=u*a/i,l=new e.Mesh(s,o),l.position.copy(n).add(r),t.add(l)}},{key:"toggleMaterialIndex",value:function(e){var t=this.hermiteData,n=t.materialIndices,a=n[e]===ka.AIR?ka.SOLID:ka.AIR;t.setMaterialIndex(e,a)}},{key:"handleClick",value:function(e){var t=this.selectedGridPoint;e.preventDefault(),null!==t&&(this.toggleMaterialIndex(this.gridPoints.children.indexOf(t)),this.dispatchEvent(as))}},{key:"raycast",value:function(e){var t=this.raycaster;ns.x=2*(e.clientX/window.innerWidth)-1,ns.y=2*-(e.clientY/window.innerHeight)+1,t.setFromCamera(ns,this.camera);var n=t.intersectObjects(this.gridPoints.children);null!==this.selectedGridPoint&&(this.selectedGridPoint.material=this.gridPointMaterials[0],this.selectedGridPoint=null),0<n.length&&(this.selectedGridPoint=n[0].object,this.selectedGridPoint.material=this.gridPointMaterials[1])}},{key:"handleEvent",value:function(e){switch(e.type){case"mousemove":this.raycast(e);break;case"click":this.handleClick(e);}}},{key:"setEnabled",value:function(e){var t=this.dom;e?(t.addEventListener("mousemove",this),t.addEventListener("click",this)):(t.removeEventListener("mousemove",this),t.removeEventListener("click",this))}},{key:"dispose",value:function(){this.setEnabled(!1)}},{key:"registerOptions",value:function(){}}]),n}(vt),rs=new e.Vector2,ss=new gt("update"),os=function(t){function n(t,a,r,s){var o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:document.body,l;return i(this,n),l=A(this,k(n).call(this)),l.hermiteData=r,l.cellPosition=t,l.cellSize=a,l.camera=s,l.dom=o,l.raycaster=new e.Raycaster,l.raycaster.linePrecision=.05,l.t=0,l.edgeMaterials=[new e.LineBasicMaterial({color:10066329}),new e.LineBasicMaterial({color:13395558})],l.planeMaterials=[new e.MeshBasicMaterial({color:11149824,side:e.DoubleSide,depthWrite:!1,transparent:!0,opacity:.2}),new e.MeshBasicMaterial({color:16776960,side:e.DoubleSide,depthWrite:!1,transparent:!0,opacity:.4})],l.selectedEdge=null,l.activeEdge=null,l.activePlane=null,l.edgeId=new e.Vector2,l.edges=new e.Group,l.planes=new e.Group,l.t=0,l.s=new e.Spherical,l}return g(n,t),o(n,[{key:"calculateEdgeId",value:function(e){var t=this.hermiteData.edgeData,n=t.indices,a,r;for(a=0;3>a&&(r=n[a].length,!(e<r));++a)e-=r;this.edgeId.set(a,e)}},{key:"clearEdges",value:function(){for(var e=this.edges,t=this.planes,n,a;0<e.children.length;)n=e.children[0],n.geometry.dispose(),e.remove(n);for(;0<t.children.length;)a=t.children[0],a.geometry.dispose(),t.remove(a);this.activeEdge=null,this.activePlane=null}},{key:"createEdges",value:function(){var t=this.edges,n=this.planes,a=this.edgeMaterials[0],i=this.planeMaterials[0],r=this.hermiteData.edgeData.edges(this.cellPosition,this.cellSize),s=new e.Vector3,o,l,u,d,c;this.clearEdges();var y=!0,h=!1,m=void 0;try{for(var p=r[Symbol.iterator](),g;!(y=(g=p.next()).done);y=!0)o=g.value,d=new e.BufferGeometry,c=new Float32Array(6),o.a.toArray(c),o.b.toArray(c,3),d.addAttribute("position",new e.BufferAttribute(c,3)),l=new e.Line(d,a),t.add(l),u=new e.Mesh(new e.PlaneBufferGeometry(2,2),i),u.position.copy(o.computeZeroCrossingPosition(s)),u.lookAt(s.add(o.n)),u.visible=!1,n.add(u)}catch(e){h=!0,m=e}finally{try{y||null==p["return"]||p["return"]()}finally{if(h)throw m}}}},{key:"adoptEdgeData",value:function(){var t=this.hermiteData.edgeData,a=t.zeroCrossings,r=t.normals,s=this.edgeId.x,o=this.edgeId.y,i=new e.Vector3;this.t=a[s][o],this.s.setFromVector3(i.fromArray(r[s],3*o))}},{key:"updateEdgeData",value:function(){var t=this.activeEdge,r=this.activePlane,s=new e.Vector3,a=new e.Vector3,o=new e.Vector3,l=new e.Vector3,n=this.hermiteData.edgeData,u=n.zeroCrossings,c=n.normals,y=this.edgeId.x,d=this.edgeId.y;null!==t&&(s.fromArray(t.geometry.getAttribute("position").array),a.fromArray(t.geometry.getAttribute("position").array,3),o.copy(s).add(a.sub(s).multiplyScalar(this.t)),l.setFromSpherical(this.s).normalize(),r.position.copy(o),r.lookAt(o.add(l)),u[y][d]=this.t,l.toArray(c[y],3*d),this.dispatchEvent(ss))}},{key:"handleClick",value:function(e){var t=this.selectedEdge;e.preventDefault();var n,a;null!==t&&(null!==this.activeEdge&&(this.activeEdge!==t&&(this.activeEdge.material=this.edgeMaterials[0]),this.activePlane.material=this.planeMaterials[0],this.activePlane.visible=!1),this.activeEdge===t?(this.t=0,this.s.phi=0,this.s.theta=0,this.activeEdge=null,this.activePlane=null):(n=this.edges.children.indexOf(t),a=this.planes.children[n],t.material=this.edgeMaterials[1],a.material=this.planeMaterials[1],a.visible=!0,this.activeEdge=t,this.activePlane=a,this.calculateEdgeId(n),this.adoptEdgeData()))}},{key:"raycast",value:function(e){var t=this.raycaster;rs.x=2*(e.clientX/window.innerWidth)-1,rs.y=2*-(e.clientY/window.innerHeight)+1,t.setFromCamera(rs,this.camera);var n=t.intersectObjects(this.edges.children);null!==this.selectedEdge&&(this.selectedEdge!==this.activeEdge&&(this.selectedEdge.material=this.edgeMaterials[0]),this.selectedEdge=null),0<n.length&&(this.selectedEdge=n[0].object,this.selectedEdge.material=this.edgeMaterials[1])}},{key:"handleEvent",value:function(e){switch(e.type){case"mousemove":this.raycast(e);break;case"click":this.handleClick(e);}}},{key:"setEnabled",value:function(e){var t=this.dom;e?(t.addEventListener("mousemove",this),t.addEventListener("click",this)):(t.removeEventListener("mousemove",this),t.removeEventListener("click",this))}},{key:"dispose",value:function(){this.setEnabled(!1)}},{key:"registerOptions",value:function(e){var t=this,n=this.planes,a={"show planes":!1};e.add(a,"show planes").onChange(function(){var e=t.activePlane;n.traverse(function(t){t!==n&&t!==e&&(t.visible=a["show planes"])})});var i=e.addFolder("Edge Adjustment");i.add(this,"t").min(0).max(1).listen().step(1e-6).onChange(function(){null!==t.hermiteData.edgeData&&t.updateEdgeData()}),i.add(this.s,"phi").min(1e-6).max(nt-1e-6).step(1e-6).listen().onChange(function(){null!==t.hermiteData.edgeData&&t.updateEdgeData()}),i.add(this.s,"theta").min(1e-6).max(nt-1e-6).step(1e-6).listen().onChange(function(){null!==t.hermiteData.edgeData&&t.updateEdgeData()}),i.open()}}]),n}(vt),ls=new ts("update"),us=function(t){function n(e,t,a,r){var s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:document.body,o;return i(this,n),o=A(this,k(n).call(this)),o.hermiteData=a,o.cellPosition=e,o.cellSize=t,o.gridPointEditor=new is(e,t,a,r,s),o.gridPointEditor.addEventListener("update",E(o)),o.gridPointEditor.setEnabled(!0),o.edgeEditor=new os(e,t,a,r,s),o.edgeEditor.addEventListener("update",E(o)),o.qefData=new Nr,o}return g(n,t),o(n,[{key:"createEdgeData",value:function(){var e=oi.resolution,t=e+1,n=t*t,i=new Uint32Array([1,t,n]),r=this.hermiteData.materialIndices,s=new ai(e,ai.calculate1DEdgeCount(e)),o,l,u,h,m,p,g,v,f,k,_,b,w,S,E;for(v=4,p=0,g=0;3>g;v>>=1,p=0,++g){for(f=Pa[v],o=s.indices[g],l=s.zeroCrossings[g],u=s.normals[g],w=S=E=e,(0===g?w=yt(w,e-1):1===g?S=yt(S,e-1):2===g?E=yt(E,e-1):void 0,b=0);b<=E;++b)for(_=0;_<=S;++_)for(k=0;k<=w;++k)h=b*n+_*t+k,m=h+i[g],r[h]!==r[m]&&(o[p]=h,l[p]=.5,u[3*p]=f[0],u[3*p+1]=f[1],u[3*p+2]=f[2],++p);s.indices[g]=s.indices[g].slice(0,p),s.zeroCrossings[g]=s.zeroCrossings[g].slice(0,p),s.normals[g]=s.normals[g].slice(0,3*p)}this.hermiteData.edgeData=s}},{key:"updateQEFData",value:function(){var t=this.qefData,n=new e.Vector3,a=this.hermiteData.edgeData.edges(this.cellPosition,this.cellSize),i;t.clear();var r=!0,s=!1,o=void 0;try{for(var l=a[Symbol.iterator](),u;!(r=(u=l.next()).done);r=!0)i=u.value,i.computeZeroCrossingPosition(n),t.add(n,i.n)}catch(e){s=!0,o=e}finally{try{r||null==l["return"]||l["return"]()}finally{if(s)throw o}}}},{key:"handleEvent",value:function(e){switch(e.type){case"update":{e.target===this.gridPointEditor&&(this.createEdgeData(),this.edgeEditor.createEdges()),1===oi.resolution&&this.updateQEFData(),ls.qefData=this.qefData,this.dispatchEvent(ls);break}}}},{key:"setEnabled",value:function(e){this.gridPointEditor.setEnabled(e),this.edgeEditor.setEnabled(e)}},{key:"dispose",value:function(){this.setEnabled(!1)}},{key:"registerOptions",value:function(e){var t=this,n={"edit mode":0};e.add(n,"edit mode",{materials:0,edges:1}).onChange(function(){var e=Number.parseInt,a=0===e(n["edit mode"]);t.gridPointEditor.setEnabled(a),t.edgeEditor.setEnabled(!a)}),this.edgeEditor.registerOptions(e)}},{key:"gridPoints",get:function(){return this.gridPointEditor.gridPoints}},{key:"edges",get:function(){return this.edgeEditor.edges}},{key:"planes",get:function(){return this.edgeEditor.planes}}]),n}(vt),ds=function(t){function n(){var t;return i(this,n),t=A(this,k(n).call(this,"voxel")),t.hermiteData=null,t.hermiteDataHelper=null,t.hermiteDataEditor=null,t.qefSolver=new Vr,t.error="0.0000",t.result={x:"",y:"",z:""},t.vertex=new e.Mesh(new e.SphereBufferGeometry(.05,8,8),new e.MeshBasicMaterial({color:16746530})),t.vertex.visible=!1,t}return g(n,t),o(n,[{key:"solveQEF",value:function(e){var t=this.hermiteData,n=this.qefSolver,a=this.vertex,i=this.result;t.empty||t.full?a.visible&&(i.x="",i.y="",i.z="",a.visible=!1):(this.error=n.setData(e).solve(a.position).toFixed(4),a.visible=!0,i.x=a.position.x.toFixed(2),i.y=a.position.y.toFixed(2),i.z=a.position.z.toFixed(2))}},{key:"handleEvent",value:function(e){switch(e.type){case"update":{try{this.hermiteDataHelper.update(!0,!1)}catch(t){}this.solveQEF(e.qefData);break}}}},{key:"initialize",value:function(){var t=this.scene,n=this.renderer,a=new e.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,50);a.position.set(-2,1,2),this.camera=a;var i=new la(a.position,a.quaternion,n.domElement);i.settings.pointer.lock=!1,i.settings.sensitivity.zoom=.1,i.settings.translation.enabled=!1,i.settings.zoom.maxDistance=40,i.lookAt(t.position),this.controls=i,t.fog=new e.FogExp2(16053492,.025),n.setClearColor(t.fog.color),oi.resolution=1,da.air=ka.AIR;var r=new e.Vector3(-.5,-.5,-.5);r.multiplyScalar(1);var s=new oi,o=new da(r,1,s,!0,!1);this.hermiteData=s,this.hermiteDataHelper=o,t.add(o);var l=new us(r,1,s,a,n.domElement);l.addEventListener("update",this),this.hermiteDataEditor=l,t.add(l.gridPoints),t.add(l.edges),t.add(l.planes);var u=1-.05;t.add(new e.Mesh(new e.BoxBufferGeometry(u,u,u),new e.MeshBasicMaterial({color:13421772,depthWrite:!1,transparent:!0,opacity:.35}))),this.vertex.visible=!1,t.add(this.vertex)}},{key:"render",value:function(e){this.controls.update(e),P(k(n.prototype),"render",this).call(this,e)}},{key:"registerOptions",value:function(e){var t=e.addFolder("Vertex Position");t.add(this.result,"x").listen(),t.add(this.result,"y").listen(),t.add(this.result,"z").listen(),t.add(this,"error").listen(),t.open(),this.hermiteDataEditor.registerOptions(e)}}]),n}(pt),cs;window.addEventListener("load",function t(){this.removeEventListener("load",t);var n=document.getElementById("viewport"),a=new e.WebGLRenderer({logarithmicDepthBuffer:!0,antialias:!0});a.setSize(n.clientWidth,n.clientHeight),a.setPixelRatio(window.devicePixelRatio),a.setClearColor(0),cs=new yn(n,{aside:document.getElementById("aside"),renderer:a}),cs.addEventListener("change",Qe),cs.addEventListener("load",Je);var i=[new es,new ds];-1===i.map(function(e){return e.id}).indexOf(window.location.hash.slice(1))&&(window.location.hash="");for(var r=0,s=i,o;r<s.length;r++)o=s[r],cs.addDemo(o);Ke()}),window.addEventListener("resize",function(){function e(e){var n=e.target.innerWidth,a=e.target.innerHeight;cs.setSize(n,a),t=0}var t=0;return function(n){0===t&&(t=setTimeout(e,66,n))}}()),document.addEventListener("keydown",function(e){var t=this.getElementById("aside");e.altKey&&null!==t&&(e.preventDefault(),t.style.visibility="hidden"===t.style.visibility?"visible":"hidden")})})(THREE);
