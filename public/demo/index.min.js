!function(t,e,i){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,i=i&&i.hasOwnProperty("default")?i.default:i;var n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function t(e,i,n){null===e&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,i);if(void 0===s){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,n)}if("value"in s)return s.value;var a=s.get;if(void 0!==a)return a.call(n)},a=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},h=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)},u=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"demo";n(this,e),this.id=i,this.renderer=null,this.loadingManager=new t.LoadingManager,this.assets=new Map,this.scene=new t.Scene,this.camera=null,this.controls=null,this.ready=!1}return s(e,[{key:"setRenderer",value:function(t){return this.renderer=t,this}},{key:"load",value:function(){return Promise.resolve()}},{key:"initialize",value:function(){}},{key:"render",value:function(t){this.renderer.render(this.scene,this.camera)}},{key:"registerOptions",value:function(t){}},{key:"reset",value:function(){var e=this.scene.fog;return this.scene=new t.Scene,this.scene.fog=e,this.camera=null,null!==this.controls&&(this.controls.dispose(),this.controls=null),this.ready=!1,this}}]),e}(),l=function t(e){n(this,t),this.type=e,this.target=null},c=function(){function t(){n(this,t),this.listenerFunctions=new Map,this.listenerObjects=new Map}return s(t,[{key:"addEventListener",value:function(t,e){var i="function"==typeof e?this.listenerFunctions:this.listenerObjects;i.has(t)?i.get(t).add(e):i.set(t,new Set([e]))}},{key:"removeEventListener",value:function(t,e){var i="function"==typeof e?this.listenerFunctions:this.listenerObjects,n=void 0;i.has(t)&&((n=i.get(t)).delete(e),0===n.size&&i.delete(t))}},{key:"dispatchEvent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,i=e.listenerFunctions,n=e.listenerObjects,s=void 0;if(t.target=e,i.has(t.type)){s=i.get(t.type);var r=!0,a=!1,o=void 0;try{for(var h,u=s[Symbol.iterator]();!(r=(h=u.next()).done);r=!0)h.value.call(e,t)}catch(t){a=!0,o=t}finally{try{!r&&u.return&&u.return()}finally{if(a)throw o}}}if(n.has(t.type)){s=n.get(t.type);var l=!0,c=!1,d=void 0;try{for(var y,v=s[Symbol.iterator]();!(l=(y=v.next()).done);l=!0)y.value.handleEvent(t)}catch(t){c=!0,d=t}finally{try{!l&&v.return&&v.return()}finally{if(c)throw d}}}}}]),t}(),d=function(t){a(e,l);function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.previousDemo=null,i.demo=null,i}return e}(),y=new d("change"),v=new d("load"),m=window.location.hash.slice(1),f=function(r){a(h,c);function h(s){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,h);var a=void 0!==r.aside?r.aside:s,u=o(this,(h.__proto__||Object.getPrototypeOf(h)).call(this));return u.renderer=void 0!==r.renderer?r.renderer:function(){var e=new t.WebGLRenderer;return e.setSize(s.clientWidth,s.clientHeight),e.setPixelRatio(window.devicePixelRatio),e}(),s.appendChild(u.renderer.domElement),u.clock=new t.Clock,u.menu=new e.GUI({autoPlace:!1}),a.appendChild(u.menu.domElement),u.statistics=new i,u.statistics.dom.id="statistics",a.appendChild(u.statistics.domElement),u.demos=new Map,u.demo=null,u.currentDemo=null,u}return s(h,[{key:"resetMenu",value:function(){var t=this,i=this.menu.domElement.parentNode,n=new e.GUI({autoPlace:!1});if(this.demos.size>1){n.add(this,"demo",Array.from(this.demos.keys())).onChange(function(){return t.loadDemo()})}return i.removeChild(this.menu.domElement),i.appendChild(n.domElement),this.menu.destroy(),this.menu=n,n}},{key:"startDemo",value:function(t){t.id===this.demo&&(t.initialize(),t.registerOptions(this.resetMenu()),t.ready=!0,v.demo=t,this.dispatchEvent(v))}},{key:"loadDemo",value:function(){var t=this,e=this.demo,i=this.demos.get(e),n=this.currentDemo,s=this.renderer;window.location.hash=e,null!==n&&n.reset(),this.menu.domElement.style.display="none",s.clear(),y.previousDemo=n,y.demo=i,this.currentDemo=i,this.dispatchEvent(y),i.load().then(function(){return t.startDemo(i)}).catch(function(t){return console.error(t)})}},{key:"addDemo",value:function(t){var e=this.currentDemo;return this.demos.set(t.id,t.setRenderer(this.renderer)),null!==this.demo&&t.id!==m||(this.demo=t.id,this.loadDemo()),this.resetMenu(),null!==e&&e.ready&&e.registerOptions(this.menu),this}},{key:"removeDemo",value:function(t){var e=this.demos,i=void 0;return e.has(t)&&(e.delete(t),this.demo===t&&e.size>0?(i=e.entries().next().value,this.demo=i[0],this.currentDemo=i[1],this.loadDemo()):(this.demo=null,this.currentDemo=null,this.renderer.clear())),this}},{key:"setSize",value:function(t,e){var i=this.currentDemo;this.renderer.setSize(t,e),null!==i&&null!==i.camera&&(i.camera.aspect=t/e,i.camera.updateProjectionMatrix())}},{key:"render",value:function(t){var e=this.currentDemo,i=this.clock.getDelta();null!==e&&e.ready&&(this.statistics.begin(),e.render(i),this.statistics.end())}}]),h}(),g={MOVE_FORWARD:0,MOVE_LEFT:1,MOVE_BACKWARD:2,MOVE_RIGHT:3,MOVE_DOWN:4,MOVE_UP:5,ZOOM_OUT:6,ZOOM_IN:7},p=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n(this,t),this.x=e,this.y=i,this.z=s}return s(t,[{key:"set",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}},{key:"setFromSpherical",value:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this}},{key:"setFromCylindrical",value:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this}},{key:"setFromMatrixColumn",value:function(t,e){return this.fromArray(t.elements,4*e)}},{key:"setFromMatrixPosition",value:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}},{key:"setFromMatrixScale",value:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this.z/=t,this}},{key:"crossVectors",value:function(t,e){var i=t.x,n=t.y,s=t.z,r=e.x,a=e.y,o=e.z;return this.x=n*o-s*a,this.y=s*r-i*o,this.z=i*a-n*r,this}},{key:"cross",value:function(t){return this.crossVectors(this,t)}},{key:"transformDirection",value:function(t){var e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n,this.y=s[1]*e+s[5]*i+s[9]*n,this.z=s[2]*e+s[6]*i+s[10]*n,this.normalize()}},{key:"applyMatrix3",value:function(t){var e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6]*n,this.y=s[1]*e+s[4]*i+s[7]*n,this.z=s[2]*e+s[5]*i+s[8]*n,this}},{key:"applyMatrix4",value:function(t){var e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12],this.y=s[1]*e+s[5]*i+s[9]*n+s[13],this.z=s[2]*e+s[6]*i+s[10]*n+s[14],this}},{key:"applyQuaternion",value:function(t){var e=this.x,i=this.y,n=this.z,s=t.x,r=t.y,a=t.z,o=t.w,h=o*e+r*n-a*i,u=o*i+a*e-s*n,l=o*n+s*i-r*e,c=-s*e-r*i-a*n;return this.x=h*o+c*-s+u*-a-l*-r,this.y=u*o+c*-r+l*-s-h*-a,this.z=l*o+c*-a+h*-r-u*-s,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"reflect",value:function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t;var i=e.x,n=e.y,s=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(i,n,s),this}},{key:"angleTo",value:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSquared()*t.lengthSquared());return Math.acos(Math.min(Math.max(e,-1),1))}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}},{key:"lerpVectors",value:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}}]),t}(),x=new p,k=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p(1/0,1/0,1/0),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p(-1/0,-1/0,-1/0);n(this,t),this.min=e,this.max=i}return s(t,[{key:"set",value:function(t,e){return this.min.copy(t),this.max.copy(e),this}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new z;return this.getCenter(t.center),t.radius=.5*this.getSize(x).length(),t}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"setFromPoints",value:function(t){var e=void 0,i=void 0;for(this.min.set(0,0,0),this.max.set(0,0,0),e=0,i=t.length;e<i;++e)this.expandByPoint(t[e]);return this}},{key:"setFromCenterAndSize",value:function(t,e){var i=x.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}},{key:"clampPoint",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p).copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return x.copy(t).clamp(this.min,this.max).sub(t).length()}},{key:"applyMatrix4",value:function(t){var e=this.min,i=this.max;if(!this.isEmpty()){var n=t.elements,s=n[0]*e.x,r=n[1]*e.x,a=n[2]*e.x,o=n[0]*i.x,h=n[1]*i.x,u=n[2]*i.x,l=n[4]*e.y,c=n[5]*e.y,d=n[6]*e.y,y=n[4]*i.y,v=n[5]*i.y,m=n[6]*i.y,f=n[8]*e.z,g=n[9]*e.z,p=n[10]*e.z,x=n[8]*i.z,k=n[9]*i.z,w=n[10]*i.z;e.x=Math.min(s,o)+Math.min(l,y)+Math.min(f,x)+n[12],e.y=Math.min(r,h)+Math.min(c,v)+Math.min(g,k)+n[13],e.z=Math.min(a,u)+Math.min(d,m)+Math.min(p,w)+n[14],i.x=Math.max(s,o)+Math.max(l,y)+Math.max(f,x)+n[12],i.y=Math.max(r,h)+Math.max(c,v)+Math.max(g,k)+n[13],i.z=Math.max(a,u)+Math.max(d,m)+Math.max(p,w)+n[14]}return this}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"containsPoint",value:function(t){var e=this.min,i=this.max;return t.x>=e.x&&t.y>=e.y&&t.z>=e.z&&t.x<=i.x&&t.y<=i.y&&t.z<=i.z}},{key:"containsBox",value:function(t){var e=this.min,i=this.max,n=t.min,s=t.max;return e.x<=n.x&&s.x<=i.x&&e.y<=n.y&&s.y<=i.y&&e.z<=n.z&&s.z<=i.z}},{key:"intersectsBox",value:function(t){var e=this.min,i=this.max,n=t.min,s=t.max;return s.x>=e.x&&s.y>=e.y&&s.z>=e.z&&n.x<=i.x&&n.y<=i.y&&n.z<=i.z}},{key:"intersectsSphere",value:function(t){return this.clampPoint(t.center,x).distanceToSquared(t.center)<=t.radius*t.radius}},{key:"intersectsPlane",value:function(t){var e=void 0,i=void 0;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=t.constant&&i>=t.constant}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}]),t}(),w=new k,z=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n(this,t),this.center=e,this.radius=i}return s(t,[{key:"set",value:function(t,e){return this.center.copy(t),this.radius=e,this}},{key:"copy",value:function(t){return this.center.copy(t.center),this.radius=t.radius,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromPoints",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.setFromPoints(t).getCenter(this.center),i=0,n=void 0,s=void 0;for(n=0,s=t.length;n<s;++n)i=Math.max(i,e.distanceToSquared(t[n]));return this.radius=Math.sqrt(i),this}},{key:"getBoundingBox",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new k;return t.set(this.center,this.center),t.expandByScalar(this.radius),t}},{key:"isEmpty",value:function(){return this.radius<=0}},{key:"translate",value:function(t){return this.center.add(t),this}},{key:"clampPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p,i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}},{key:"distanceToPoint",value:function(t){return t.distanceTo(this.center)-this.radius}},{key:"containsPoint",value:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"intersectsSphere",value:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}},{key:"intersectsBox",value:function(t){return t.intersectsSphere(this)}},{key:"intersectsPlane",value:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}},{key:"equals",value:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}]),t}(),M=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n(this,t),this.x=e,this.y=i}return s(t,[{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this}},{key:"applyMatrix3",value:function(t){var e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"angle",value:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}},{key:"lerpVectors",value:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)}},{key:"rotateAround",value:function(t,e){var i=Math.cos(e),n=Math.sin(e),s=this.x-t.x,r=this.y-t.y;return this.x=s*i-r*n+t.x,this.y=s*n+r*i+t.y,this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y}},{key:"width",get:function(){return this.x},set:function(t){return this.x=t}},{key:"height",get:function(){return this.y},set:function(t){return this.y=t}}]),t}(),b=new M,A=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(1/0,1/0),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new M(-1/0,-1/0);n(this,t),this.min=e,this.max=i}s(t,[{key:"set",value:function(t,e){return this.min.copy(t),this.max.copy(e),this}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M;return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M;return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new z;return this.getCenter(t.center),t.radius=.5*this.getSize(b).length(),t}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"setFromPoints",value:function(t){var e=void 0,i=void 0;for(this.min.set(0,0),this.max.set(0,0),e=0,i=t.length;e<i;++e)this.expandByPoint(t[e]);return this}},{key:"setFromCenterAndSize",value:function(t,e){var i=b.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}},{key:"clampPoint",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new M).copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return b.copy(t).clamp(this.min,this.max).sub(t).length()}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"containsPoint",value:function(t){var e=this.min,i=this.max;return t.x>=e.x&&t.y>=e.y&&t.x<=i.x&&t.y<=i.y}},{key:"containsBox",value:function(t){var e=this.min,i=this.max,n=t.min,s=t.max;return e.x<=n.x&&s.x<=i.x&&e.y<=n.y&&s.y<=i.y}},{key:"intersectsBox",value:function(t){var e=this.min,i=this.max,n=t.min,s=t.max;return s.x>=e.x&&s.y>=e.y&&n.x<=i.x&&n.y<=i.y}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}])}(),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n(this,t),this.radius=e,this.theta=i,this.y=s}s(t,[{key:"set",value:function(t,e,i){return this.radius=t,this.theta=e,this.y=i,this}},{key:"copy",value:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromVector3",value:function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this}}])}(),function(){function t(){n(this,t),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return s(t,[{key:"set",value:function(t,e,i,n,s,r,a,o,h){var u=this.elements;return u[0]=t,u[3]=e,u[6]=i,u[1]=n,u[4]=s,u[7]=r,u[2]=a,u[5]=o,u[8]=h,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(t){var e=t.elements,i=this.elements;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.elements,n=void 0;for(n=0;n<9;++n)i[n]=t[n+e];return this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.elements,n=void 0;for(n=0;n<9;++n)t[n+e]=i[n];return t}},{key:"multiplyMatrices",value:function(t,e){var i=t.elements,n=e.elements,s=this.elements,r=i[0],a=i[3],o=i[6],h=i[1],u=i[4],l=i[7],c=i[2],d=i[5],y=i[8],v=n[0],m=n[3],f=n[6],g=n[1],p=n[4],x=n[7],k=n[2],w=n[5],z=n[8];return s[0]=r*v+a*g+o*k,s[3]=r*m+a*p+o*w,s[6]=r*f+a*x+o*z,s[1]=h*v+u*g+l*k,s[4]=h*m+u*p+l*w,s[7]=h*f+u*x+l*z,s[2]=c*v+d*g+y*k,s[5]=c*m+d*p+y*w,s[8]=c*f+d*x+y*z,this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyScalar",value:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],a=t[5],o=t[6],h=t[7],u=t[8];return e*r*u-e*a*h-i*s*u+i*a*o+n*s*h-n*r*o}},{key:"getInverse",value:function(t){var e=t.elements,i=this.elements,n=e[0],s=e[1],r=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=c*o-h*l,y=h*u-c*a,v=l*a-o*u,m=n*d+s*y+r*v,f=void 0;return 0!==m?(f=1/m,i[0]=d*f,i[1]=(r*l-c*s)*f,i[2]=(h*s-r*o)*f,i[3]=y*f,i[4]=(c*n-r*u)*f,i[5]=(r*a-h*n)*f,i[6]=v*f,i[7]=(s*u-l*n)*f,i[8]=(o*n-s*a)*f):(console.error("Can't invert matrix, determinant is zero",t),this.identity()),this}},{key:"transpose",value:function(){var t=this.elements,e=void 0;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"scale",value:function(t,e){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}},{key:"rotate",value:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.elements,s=n[0],r=n[3],a=n[6],o=n[1],h=n[4],u=n[7];return n[0]=e*s+i*o,n[3]=e*r+i*h,n[6]=e*a+i*u,n[1]=-i*s+e*o,n[4]=-i*r+e*h,n[7]=-i*a+e*u,this}},{key:"translate",value:function(t,e){var i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}},{key:"equals",value:function(t){var e=this.elements,i=t.elements,n=!0,s=void 0;for(s=0;n&&s<9;++s)e[s]!==i[s]&&(n=!1);return n}}]),t}()),S="XYZ",P="YZX",E="ZXY",O="XZY",_="YXZ",I="ZYX",T=new p,D=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;n(this,t),this.x=e,this.y=i,this.z=s,this.w=r}return s(t,[{key:"set",value:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}},{key:"setFromEuler",value:function(t){var e=t.x,i=t.y,n=t.z,s=Math.cos,r=Math.sin,a=s(e/2),o=s(i/2),h=s(n/2),u=r(e/2),l=r(i/2),c=r(n/2);switch(t.order){case S:this.x=u*o*h+a*l*c,this.y=a*l*h-u*o*c,this.z=a*o*c+u*l*h,this.w=a*o*h-u*l*c;break;case _:this.x=u*o*h+a*l*c,this.y=a*l*h-u*o*c,this.z=a*o*c-u*l*h,this.w=a*o*h+u*l*c;break;case E:this.x=u*o*h-a*l*c,this.y=a*l*h+u*o*c,this.z=a*o*c+u*l*h,this.w=a*o*h-u*l*c;break;case I:this.x=u*o*h-a*l*c,this.y=a*l*h+u*o*c,this.z=a*o*c-u*l*h,this.w=a*o*h+u*l*c;break;case P:this.x=u*o*h+a*l*c,this.y=a*l*h+u*o*c,this.z=a*o*c-u*l*h,this.w=a*o*h-u*l*c;break;case O:this.x=u*o*h-a*l*c,this.y=a*l*h-u*o*c,this.z=a*o*c+u*l*h,this.w=a*o*h+u*l*c}return this}},{key:"setFromAxisAngle",value:function(t,e){var i=e/2,n=Math.sin(i);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(i),this}},{key:"setFromRotationMatrix",value:function(t){var e=t.elements,i=e[0],n=e[4],s=e[8],r=e[1],a=e[5],o=e[9],h=e[2],u=e[6],l=e[10],c=i+a+l,d=void 0;return c>0?(d=.5/Math.sqrt(c+1),this.w=.25/d,this.x=(u-o)*d,this.y=(s-h)*d,this.z=(r-n)*d):i>a&&i>l?(d=2*Math.sqrt(1+i-a-l),this.w=(u-o)/d,this.x=.25*d,this.y=(n+r)/d,this.z=(s+h)/d):a>l?(d=2*Math.sqrt(1+a-i-l),this.w=(s-h)/d,this.x=(n+r)/d,this.y=.25*d,this.z=(o+u)/d):(d=2*Math.sqrt(1+l-i-a),this.w=(r-n)/d,this.x=(s+h)/d,this.y=(o+u)/d,this.z=.25*d),this}},{key:"setFromUnitVectors",value:function(t,e){var i=t.dot(e)+1;return i<1e-6?(i=0,Math.abs(t.x)>Math.abs(t.z)?T.set(-t.y,t.x,0):T.set(0,-t.z,t.y)):T.crossVectors(t,e),this.x=T.x,this.y=T.y,this.z=T.z,this.w=i,this.normalize()}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"normalize",value:function(){var t=this.length(),e=void 0;return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/t,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"multiplyQuaternions",value:function(t,e){var i=t.x,n=t.y,s=t.z,r=t.w,a=e.x,o=e.y,h=e.z,u=e.w;return this.x=i*u+r*a+n*h-s*o,this.y=n*u+r*o+s*a-i*h,this.z=s*u+r*h+i*o-n*a,this.w=r*u-i*a-n*o-s*h,this}},{key:"multiply",value:function(t){return this.multiplyQuaternions(this,t)}},{key:"premultiply",value:function(t){return this.multiplyQuaternions(t,this)}},{key:"slerp",value:function(t,e){var i=this.x,n=this.y,s=this.z,r=this.w,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0;if(1===e)this.copy(t);else if(e>0){if((a=r*t.w+i*t.x+n*t.y+s*t.z)<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,a=-a):this.copy(t),a>=1)return this.w=r,this.x=i,this.y=n,this.z=s,this;if(o=Math.sqrt(1-a*a),Math.abs(o)<.001)return this.w=.5*(r+this.w),this.x=.5*(i+this.x),this.y=.5*(n+this.y),this.z=.5*(s+this.z),this;h=Math.atan2(o,a),u=Math.sin((1-e)*h)/o,l=Math.sin(e*h)/o,this.w=r*u+this.w*l,this.x=i*u+this.x*l,this.y=n*u+this.y*l,this.z=s*u+this.z*l}return this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}}],[{key:"slerp",value:function(t,e,i,n){return i.copy(t).slerp(e,n)}},{key:"slerpFlat",value:function(t,e,i,n,s,r,a){var o=s[r],h=s[r+1],u=s[r+2],l=s[r+3],c=i[n],d=i[n+1],y=i[n+2],v=i[n+3],m=void 0,f=void 0,g=void 0,p=void 0,x=void 0,k=void 0,w=void 0,z=void 0;v===l&&c===o&&d===h&&y===u||(m=1-a,k=(p=c*o+d*h+y*u+v*l)>=0?1:-1,(x=1-p*p)>Number.EPSILON&&(g=Math.sqrt(x),w=Math.atan2(g,p*k),m=Math.sin(m*w)/g,a=Math.sin(a*w)/g),c=c*m+o*(z=a*k),d=d*m+h*z,y=y*m+u*z,v=v*m+l*z,m===1-a&&(c*=f=1/Math.sqrt(c*c+d*d+y*y+v*v),d*=f,y*=f,v*=f)),t[e]=c,t[e+1]=d,t[e+2]=y,t[e+3]=v}}]),t}();function C(t,e,i){return Math.max(Math.min(t,i),e)}var U=new A,F=new D,q=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n(this,t),this.x=e,this.y=i,this.z=s,this.order=t.defaultOrder}return s(t,[{key:"set",value:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.order=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.order=t[e+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.order,t}},{key:"toVector3",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p).set(this.x,this.y,this.z)}},{key:"setFromRotationMatrix",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.order,i=t.elements,n=i[0],s=i[4],r=i[8],a=i[1],o=i[5],h=i[9],u=i[2],l=i[6],c=i[10];switch(e){case S:this.y=Math.asin(C(r,-1,1)),Math.abs(r)<.99999?(this.x=Math.atan2(-h,c),this.z=Math.atan2(-s,n)):(this.x=Math.atan2(l,o),this.z=0);break;case _:this.x=Math.asin(-C(h,-1,1)),Math.abs(h)<.99999?(this.y=Math.atan2(r,c),this.z=Math.atan2(a,o)):(this.y=Math.atan2(-u,n),this.z=0);break;case E:this.x=Math.asin(C(l,-1,1)),Math.abs(l)<.99999?(this.y=Math.atan2(-u,c),this.z=Math.atan2(-s,o)):(this.y=0,this.z=Math.atan2(a,n));break;case I:this.y=Math.asin(-C(u,-1,1)),Math.abs(u)<.99999?(this.x=Math.atan2(l,c),this.z=Math.atan2(a,n)):(this.x=0,this.z=Math.atan2(-s,o));break;case P:this.z=Math.asin(C(a,-1,1)),Math.abs(a)<.99999?(this.x=Math.atan2(-h,o),this.y=Math.atan2(-u,n)):(this.x=0,this.y=Math.atan2(r,c));break;case O:this.z=Math.asin(-C(s,-1,1)),Math.abs(s)<.99999?(this.x=Math.atan2(l,o),this.y=Math.atan2(r,n)):(this.x=Math.atan2(-h,c),this.y=0)}return this.order=e,this}},{key:"setFromQuaternion",value:function(t,e){return U.makeRotationFromQuaternion(t),this.setFromRotationMatrix(U,e)}},{key:"setFromVector3",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(t.x,t.y,t.z,e)}},{key:"reorder",value:function(t){return F.setFromEuler(this),this.setFromQuaternion(F,t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order}}],[{key:"defaultOrder",get:function(){return S}}]),t}(),L=new p,N=new p,B=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p(1,0,0),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n(this,t),this.normal=e,this.constant=i}return s(t,[{key:"set",value:function(t,e){return this.normal.copy(t),this.constant=e,this}},{key:"setComponents",value:function(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}},{key:"copy",value:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromNormalAndCoplanarPoint",value:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(t,e,i){var n=L.subVectors(i,e).cross(N.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,L),this}},{key:"normalize",value:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}},{key:"negate",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:"distanceToPoint",value:function(t){return this.normal.dot(t)+this.constant}},{key:"distanceToSphere",value:function(t){return this.distanceToPoint(t.center)-t.radius}},{key:"projectPoint",value:function(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}},{key:"coplanarPoint",value:function(t){return t.copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(t){return this.constant-=t.dot(this.normal),this}},{key:"intersectLine",value:function(t,e){var i=t.delta(L),n=this.normal.dot(i);if(0===n)0===this.distanceToPoint(t.start)&&e.copy(t.start);else{var s=-(t.start.dot(this.normal)+this.constant)/n;s>=0&&s<=1&&e.copy(i).multiplyScalar(s).add(t.start)}return e}},{key:"intersectsLine",value:function(t){var e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}},{key:"intersectsBox",value:function(t){return t.intersectsPlane(this)}},{key:"intersectsSphere",value:function(t){return t.intersectsPlane(this)}},{key:"equals",value:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}]),t}(),R=new p,V=new p,j=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new B,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new B;n(this,t),this.planes=[e,i,s,r,a,o]}return s(t,[{key:"set",value:function(t,e,i,n,s,r){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(n),a[4].copy(s),a[5].copy(r),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){var e=this.planes,i=void 0;for(i=0;i<6;++i)e[i].copy(t.planes[i]);return this}},{key:"setFromMatrix",value:function(t){var e=this.planes,i=t.elements,n=i[0],s=i[1],r=i[2],a=i[3],o=i[4],h=i[5],u=i[6],l=i[7],c=i[8],d=i[9],y=i[10],v=i[11],m=i[12],f=i[13],g=i[14],p=i[15];return e[0].setComponents(a-n,l-o,v-c,p-m).normalize(),e[1].setComponents(a+n,l+o,v+c,p+m).normalize(),e[2].setComponents(a+s,l+h,v+d,p+f).normalize(),e[3].setComponents(a-s,l-h,v-d,p-f).normalize(),e[4].setComponents(a-r,l-u,v-y,p-g).normalize(),e[5].setComponents(a+r,l+u,v+y,p+g).normalize(),this}},{key:"intersectsSphere",value:function(t){var e=this.planes,i=t.center,n=-t.radius,s=!0,r=void 0;for(r=0;r<6;++r)if(e[r].distanceToPoint(i)<n){s=!1;break}return s}},{key:"intersectsBox",value:function(t){var e=this.planes,i=t.min,n=t.max,s=!0,r=void 0,a=void 0,o=void 0,h=void 0;for(r=0;r<6;++r)if(h=e[r],R.x=h.normal.x>0?i.x:n.x,V.x=h.normal.x>0?n.x:i.x,R.y=h.normal.y>0?i.y:n.y,V.y=h.normal.y>0?n.y:i.y,R.z=h.normal.z>0?i.z:n.z,V.z=h.normal.z>0?n.z:i.z,a=h.distanceToPoint(R),o=h.distanceToPoint(V),a<0&&o<0){s=!1;break}return s}},{key:"containsPoint",value:function(t){var e=this.planes,i=!0,n=void 0;for(n=0;n<6;++n)if(e[n].distanceToPoint(t)<0){i=!1;break}return i}}]),t}(),Y=new p,X=new p,G=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p;n(this,t),this.start=e,this.end=i}return s(t,[{key:"set",value:function(t,e){return this.start.copy(t),this.end.copy(e),this}},{key:"copy",value:function(t){return this.start.copy(t.start),this.end.copy(t.end),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p).addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p).subVectors(this.end,this.start)}},{key:"lengthSquared",value:function(){return this.start.distanceToSquared(this.end)}},{key:"length",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}},{key:"closestPointToPointParameter",value:function(t,e){Y.subVectors(t,this.start),X.subVectors(this.end,this.start);var i=X.dot(X),n=X.dot(Y);return e?Math.min(Math.max(n/i,0),1):n/i}},{key:"closestPointToPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new p,n=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(n).add(this.start)}},{key:"equals",value:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}]),t}(),H=new p,W=new p,K=new p,Z=function(){function t(){n(this,t),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return s(t,[{key:"set",value:function(t,e,i,n,s,r,a,o,h,u,l,c,d,y,v,m){var f=this.elements;return f[0]=t,f[4]=e,f[8]=i,f[12]=n,f[1]=s,f[5]=r,f[9]=a,f[13]=o,f[2]=h,f[6]=u,f[10]=l,f[14]=c,f[3]=d,f[7]=y,f[11]=v,f[15]=m,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"copy",value:function(t){var e=t.elements,i=this.elements;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.elements,n=void 0;for(n=0;n<16;++n)i[n]=t[n+e];return this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.elements,n=void 0;for(n=0;n<16;++n)t[n+e]=i[n];return t}},{key:"getMaxScaleOnAxis",value:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}},{key:"copyPosition",value:function(t){var e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}},{key:"setPosition",value:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this}},{key:"extractBasis",value:function(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(t){var e=this.elements,i=t.elements,n=1/H.setFromMatrixColumn(t,0).length(),s=1/H.setFromMatrixColumn(t,1).length(),r=1/H.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*s,e[5]=i[5]*s,e[6]=i[6]*s,e[7]=0,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"makeRotationFromEuler",value:function(t){var e=this.elements,i=t.x,n=t.y,s=t.z,r=Math.cos(i),a=Math.sin(i),o=Math.cos(n),h=Math.sin(n),u=Math.cos(s),l=Math.sin(s),c=void 0,d=void 0,y=void 0,v=void 0,m=void 0,f=void 0,g=void 0,p=void 0,x=void 0,k=void 0,w=void 0,z=void 0;switch(t.order){case S:c=r*u,d=r*l,y=a*u,v=a*l,e[0]=o*u,e[4]=-o*l,e[8]=h,e[1]=d+y*h,e[5]=c-v*h,e[9]=-a*o,e[2]=v-c*h,e[6]=y+d*h,e[10]=r*o;break;case _:m=o*u,f=o*l,g=h*u,p=h*l,e[0]=m+p*a,e[4]=g*a-f,e[8]=r*h,e[1]=r*l,e[5]=r*u,e[9]=-a,e[2]=f*a-g,e[6]=p+m*a,e[10]=r*o;break;case E:m=o*u,f=o*l,g=h*u,p=h*l,e[0]=m-p*a,e[4]=-r*l,e[8]=g+f*a,e[1]=f+g*a,e[5]=r*u,e[9]=p-m*a,e[2]=-r*h,e[6]=a,e[10]=r*o;break;case I:c=r*u,d=r*l,y=a*u,v=a*l,e[0]=o*u,e[4]=y*h-d,e[8]=c*h+v,e[1]=o*l,e[5]=v*h+c,e[9]=d*h-y,e[2]=-h,e[6]=a*o,e[10]=r*o;break;case P:x=r*o,k=r*h,w=a*o,z=a*h,e[0]=o*u,e[4]=z-x*l,e[8]=w*l+k,e[1]=l,e[5]=r*u,e[9]=-a*u,e[2]=-h*u,e[6]=k*l+w,e[10]=x-z*l;break;case O:x=r*o,k=r*h,w=a*o,z=a*h,e[0]=o*u,e[4]=-l,e[8]=h*u,e[1]=x*l+z,e[5]=r*u,e[9]=k*l-w,e[2]=w*l-k,e[6]=a*u,e[10]=z*l+x}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(t){return this.compose(H.set(0,0,0),t,W.set(1,1,1))}},{key:"lookAt",value:function(t,e,i){var n=this.elements,s=H,r=W,a=K;return a.subVectors(t,e),0===a.lengthSquared()&&(a.z=1),a.normalize(),s.crossVectors(i,a),0===s.lengthSquared()&&(1===Math.abs(i.z)?a.x+=1e-4:a.z+=1e-4,a.normalize(),s.crossVectors(i,a)),s.normalize(),r.crossVectors(a,s),n[0]=s.x,n[4]=r.x,n[8]=a.x,n[1]=s.y,n[5]=r.y,n[9]=a.y,n[2]=s.z,n[6]=r.z,n[10]=a.z,this}},{key:"multiplyMatrices",value:function(t,e){var i=this.elements,n=t.elements,s=e.elements,r=n[0],a=n[4],o=n[8],h=n[12],u=n[1],l=n[5],c=n[9],d=n[13],y=n[2],v=n[6],m=n[10],f=n[14],g=n[3],p=n[7],x=n[11],k=n[15],w=s[0],z=s[4],M=s[8],b=s[12],A=s[1],S=s[5],P=s[9],E=s[13],O=s[2],_=s[6],I=s[10],T=s[14],D=s[3],C=s[7],U=s[11],F=s[15];return i[0]=r*w+a*A+o*O+h*D,i[4]=r*z+a*S+o*_+h*C,i[8]=r*M+a*P+o*I+h*U,i[12]=r*b+a*E+o*T+h*F,i[1]=u*w+l*A+c*O+d*D,i[5]=u*z+l*S+c*_+d*C,i[9]=u*M+l*P+c*I+d*U,i[13]=u*b+l*E+c*T+d*F,i[2]=y*w+v*A+m*O+f*D,i[6]=y*z+v*S+m*_+f*C,i[10]=y*M+v*P+m*I+f*U,i[14]=y*b+v*E+m*T+f*F,i[3]=g*w+p*A+x*O+k*D,i[7]=g*z+p*S+x*_+k*C,i[11]=g*M+p*P+x*I+k*U,i[15]=g*b+p*E+x*T+k*F,this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyScalar",value:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],i=t[4],n=t[8],s=t[12],r=t[1],a=t[5],o=t[9],h=t[13],u=t[2],l=t[6],c=t[10],d=t[14],y=e*a,v=e*o,m=e*h,f=i*r,g=i*o,p=i*h,x=n*r,k=n*a,w=n*h,z=s*r,M=s*a,b=s*o;return t[3]*(b*l-w*l-M*c+p*c+k*d-g*d)+t[7]*(v*d-m*c+z*c-x*d+w*u-b*u)+t[11]*(m*l-y*d-z*l+f*d+M*u-p*u)+t[15]*(-k*u-v*l+y*c+x*l-f*c+g*u)}},{key:"getInverse",value:function(t){var e=this.elements,i=t.elements,n=i[0],s=i[1],r=i[2],a=i[3],o=i[4],h=i[5],u=i[6],l=i[7],c=i[8],d=i[9],y=i[10],v=i[11],m=i[12],f=i[13],g=i[14],p=i[15],x=d*g*l-f*y*l+f*u*v-h*g*v-d*u*p+h*y*p,k=m*y*l-c*g*l-m*u*v+o*g*v+c*u*p-o*y*p,w=c*f*l-m*d*l+m*h*v-o*f*v-c*h*p+o*d*p,z=m*d*u-c*f*u-m*h*y+o*f*y+c*h*g-o*d*g,M=n*x+s*k+r*w+a*z,b=void 0;return 0!==M?(b=1/M,e[0]=x*b,e[1]=(f*y*a-d*g*a-f*r*v+s*g*v+d*r*p-s*y*p)*b,e[2]=(h*g*a-f*u*a+f*r*l-s*g*l-h*r*p+s*u*p)*b,e[3]=(d*u*a-h*y*a-d*r*l+s*y*l+h*r*v-s*u*v)*b,e[4]=k*b,e[5]=(c*g*a-m*y*a+m*r*v-n*g*v-c*r*p+n*y*p)*b,e[6]=(m*u*a-o*g*a-m*r*l+n*g*l+o*r*p-n*u*p)*b,e[7]=(o*y*a-c*u*a+c*r*l-n*y*l-o*r*v+n*u*v)*b,e[8]=w*b,e[9]=(m*d*a-c*f*a-m*s*v+n*f*v+c*s*p-n*d*p)*b,e[10]=(o*f*a-m*h*a+m*s*l-n*f*l-o*s*p+n*h*p)*b,e[11]=(c*h*a-o*d*a-c*s*l+n*d*l+o*s*v-n*h*v)*b,e[12]=z*b,e[13]=(c*f*r-m*d*r+m*s*y-n*f*y-c*s*g+n*d*g)*b,e[14]=(m*h*r-o*f*r-m*s*u+n*f*u+o*s*g-n*h*g)*b,e[15]=(o*d*r-c*h*r+c*s*u-n*d*u-o*s*y+n*h*y)*b):(console.error("Can't invert matrix, determinant is zero",t),this.identity()),this}},{key:"transpose",value:function(){var t=this.elements,e=void 0;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"scale",value:function(t,e,i){var n=this.elements;return n[0]*=t,n[4]*=e,n[8]*=i,n[1]*=t,n[5]*=e,n[9]*=i,n[2]*=t,n[6]*=e,n[10]*=i,n[3]*=t,n[7]*=e,n[11]*=i,this}},{key:"makeScale",value:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}},{key:"makeTranslation",value:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}},{key:"makeRotationX",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}},{key:"makeRotationY",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(t,e){var i=Math.cos(e),n=Math.sin(e),s=1-i,r=t.x,a=t.y,o=t.z,h=s*r,u=s*a;return this.set(h*r+i,h*a-n*o,h*o+n*a,0,h*a+n*o,u*a+i,u*o-n*r,0,h*o-n*a,u*o+n*r,s*o*o+i,0,0,0,0,1),this}},{key:"makeShear",value:function(t,e,i){return this.set(1,e,i,0,t,1,i,0,t,e,1,0,0,0,0,1),this}},{key:"compose",value:function(t,e,i){var n=this.elements,s=e.x,r=e.y,a=e.z,o=e.w,h=s+s,u=r+r,l=a+a,c=s*h,d=s*u,y=s*l,v=r*u,m=r*l,f=a*l,g=o*h,p=o*u,x=o*l,k=i.x,w=i.y,z=i.z;return n[0]=(1-(v+f))*k,n[1]=(d+x)*k,n[2]=(y-p)*k,n[3]=0,n[4]=(d-x)*w,n[5]=(1-(c+f))*w,n[6]=(m+g)*w,n[7]=0,n[8]=(y+p)*z,n[9]=(m-g)*z,n[10]=(1-(c+v))*z,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}},{key:"decompose",value:function(t,e,i){var n=this.elements,s=n[0],r=n[1],a=n[2],o=n[4],h=n[5],u=n[6],l=n[8],c=n[9],d=n[10],y=this.determinant(),v=H.set(s,r,a).length()*(y<0?-1:1),m=H.set(o,h,u).length(),f=H.set(l,c,d).length(),g=1/v,p=1/m,x=1/f;return t.x=n[12],t.y=n[13],t.z=n[14],n[0]*=g,n[1]*=g,n[2]*=g,n[4]*=p,n[5]*=p,n[6]*=p,n[8]*=x,n[9]*=x,n[10]*=x,e.setFromRotationMatrix(this),n[0]=s,n[1]=r,n[2]=a,n[4]=o,n[5]=h,n[6]=u,n[8]=l,n[9]=c,n[10]=d,i.x=v,i.y=m,i.z=f,this}},{key:"makePerspective",value:function(t,e,i,n,s,r){var a=this.elements,o=2*s/(e-t),h=2*s/(i-n),u=(e+t)/(e-t),l=(i+n)/(i-n),c=-(r+s)/(r-s),d=-2*r*s/(r-s);return a[0]=o,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=h,a[9]=l,a[13]=0,a[2]=0,a[6]=0,a[10]=c,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}},{key:"makeOrthographic",value:function(t,e,i,n,s,r){var a=this.elements,o=1/(e-t),h=1/(i-n),u=1/(r-s),l=(e+t)*o,c=(i+n)*h,d=(r+s)*u;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-l,a[1]=0,a[5]=2*h,a[9]=0,a[13]=-c,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}},{key:"equals",value:function(t){var e=this.elements,i=t.elements,n=!0,s=void 0;for(s=0;n&&s<16;++s)e[s]!==i[s]&&(n=!1);return n}}]),t}(),Q=[new p,new p,new p,new p],J=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p;n(this,t),this.origin=e,this.direction=i}return s(t,[{key:"set",value:function(t,e){return this.origin.copy(t),this.direction.copy(e),this}},{key:"copy",value:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"at",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p).copy(this.direction).multiplyScalar(t).add(this.origin)}},{key:"lookAt",value:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this}},{key:"recast",value:function(t){return this.origin.copy(this.at(t,Q[0])),this}},{key:"closestPointToPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p,i=e.subVectors(t,this.origin).dot(this.direction);return i>=0?e.copy(this.direction).multiplyScalar(i).add(this.origin):e.copy(this.origin)}},{key:"distanceSquaredToPoint",value:function(t){var e=Q[0].subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):Q[0].copy(this.direction).multiplyScalar(e).add(this.origin).distanceToSquared(t)}},{key:"distanceToPoint",value:function(t){return Math.sqrt(this.distanceSquaredToPoint(t))}},{key:"distanceToPlane",value:function(t){var e=t.normal.dot(this.direction),i=0!==e?-(this.origin.dot(t.normal)+t.constant)/e:0===t.distanceToPoint(this.origin)?0:-1;return i>=0?i:null}},{key:"distanceSquaredToSegment",value:function(t,e,i,n){var s=Q[0].copy(t).add(e).multiplyScalar(.5),r=Q[1].copy(e).sub(t).normalize(),a=Q[2].copy(this.origin).sub(s),o=.5*t.distanceTo(e),h=-this.direction.dot(r),u=a.dot(this.direction),l=-a.dot(r),c=a.lengthSq(),d=Math.abs(1-h*h),y=void 0,v=void 0,m=void 0,f=void 0,g=void 0;return d>0?(v=h*u-l,m=o*d,(y=h*l-u)>=0?v>=-m?v<=m?g=(y*=f=1/d)*(y+h*(v*=f)+2*u)+v*(h*y+v+2*l)+c:(v=o,g=-(y=Math.max(0,-(h*v+u)))*y+v*(v+2*l)+c):(v=-o,g=-(y=Math.max(0,-(h*v+u)))*y+v*(v+2*l)+c):v<=-m?g=-(y=Math.max(0,-(-h*o+u)))*y+(v=y>0?-o:Math.min(Math.max(-o,-l),o))*(v+2*l)+c:v<=m?(y=0,g=(v=Math.min(Math.max(-o,-l),o))*(v+2*l)+c):g=-(y=Math.max(0,-(h*o+u)))*y+(v=y>0?o:Math.min(Math.max(-o,-l),o))*(v+2*l)+c):(v=h>0?-o:o,g=-(y=Math.max(0,-(h*v+u)))*y+v*(v+2*l)+c),void 0!==i&&i.copy(this.direction).multiplyScalar(y).add(this.origin),void 0!==n&&n.copy(r).multiplyScalar(v).add(s),g}},{key:"intersectSphere",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p,i=Q[0].subVectors(t.center,this.origin),n=i.dot(this.direction),s=i.dot(i)-n*n,r=t.radius*t.radius,a=null,o=void 0,h=void 0,u=void 0;return s<=r&&(u=n+(o=Math.sqrt(r-s)),((h=n-o)>=0||u>=0)&&(a=h<0?this.at(u,e):this.at(h,e))),a}},{key:"intersectsSphere",value:function(t){return this.distanceToPoint(t.center)<=t.radius}},{key:"intersectPlane",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p,i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}},{key:"intersectsPlane",value:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}},{key:"intersectBox",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p,i=this.origin,n=this.direction,s=t.min,r=t.max,a=1/n.x,o=1/n.y,h=1/n.z,u=null,l=void 0,c=void 0,d=void 0,y=void 0,v=void 0,m=void 0;return a>=0?(l=(s.x-i.x)*a,c=(r.x-i.x)*a):(l=(r.x-i.x)*a,c=(s.x-i.x)*a),o>=0?(d=(s.y-i.y)*o,y=(r.y-i.y)*o):(d=(r.y-i.y)*o,y=(s.y-i.y)*o),l<=y&&d<=c&&((d>l||l!=l)&&(l=d),(y<c||c!=c)&&(c=y),h>=0?(v=(s.z-i.z)*h,m=(r.z-i.z)*h):(v=(r.z-i.z)*h,m=(s.z-i.z)*h),l<=m&&v<=c&&((v>l||l!=l)&&(l=v),(m<c||c!=c)&&(c=m),c>=0&&(u=this.at(l>=0?l:c,e)))),u}},{key:"intersectsBox",value:function(t){return null!==this.intersectBox(t,Q[0])}},{key:"intersectTriangle",value:function(t,e,i,n,s){var r=this.direction,a=Q[0],o=Q[1],h=Q[2],u=Q[3],l=null,c=void 0,d=void 0,y=void 0,v=void 0,m=void 0;return o.subVectors(e,t),h.subVectors(i,t),u.crossVectors(o,h),0===(c=r.dot(u))||n&&c>0||(c>0?d=1:(d=-1,c=-c),a.subVectors(this.origin,t),(y=d*r.dot(h.crossVectors(a,h)))>=0&&(v=d*r.dot(o.cross(a)))>=0&&y+v<=c&&(m=-d*a.dot(u))>=0&&(l=this.at(m/c,s))),l}},{key:"applyMatrix4",value:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}},{key:"equals",value:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}]),t}(),$=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n(this,t),this.radius=e,this.phi=i,this.theta=s}return s(t,[{key:"set",value:function(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}},{key:"copy",value:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromVector3",value:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(Math.min(Math.max(t.y/this.radius,-1),1))),this.makeSafe()}},{key:"makeSafe",value:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}}]),t}(),tt=function(){function t(){n(this,t),this.elements=new Float32Array([1,0,0,1,0,1])}return s(t,[{key:"set",value:function(t,e,i,n,s,r){var a=this.elements;return a[0]=t,a[1]=e,a[3]=n,a[2]=i,a[4]=s,a[5]=r,this}},{key:"identity",value:function(){return this.set(1,0,0,1,0,1),this}},{key:"copy",value:function(t){var e=t.elements;return this.set(e[0],e[1],e[2],e[3],e[4],e[5]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toMatrix3",value:function(t){var e=t.elements;t.set(e[0],e[1],e[2],e[1],e[3],e[4],e[2],e[4],e[5])}},{key:"add",value:function(t){var e=this.elements,i=t.elements;return e[0]+=i[0],e[1]+=i[1],e[3]+=i[3],e[2]+=i[2],e[4]+=i[4],e[5]+=i[5],this}},{key:"norm",value:function(){var t=this.elements,e=t[1]*t[1],i=t[2]*t[2],n=t[4]*t[4];return Math.sqrt(t[0]*t[0]+e+i+e+t[3]*t[3]+n+i+n+t[5]*t[5])}},{key:"off",value:function(){var t=this.elements;return Math.sqrt(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:"applyToVector3",value:function(t){var e=t.x,i=t.y,n=t.z,s=this.elements;return t.x=s[0]*e+s[1]*i+s[2]*n,t.y=s[1]*e+s[3]*i+s[4]*n,t.z=s[2]*e+s[4]*i+s[5]*n,t}},{key:"equals",value:function(t){var e=this.elements,i=t.elements,n=!0,s=void 0;for(s=0;n&&s<6;++s)e[s]!==i[s]&&(n=!1);return n}}],[{key:"calculateIndex",value:function(t,e){return 3-(3-t)*(2-t)/2+e}}]),t}(),et=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;n(this,t),this.x=e,this.y=i,this.z=s,this.w=r}return s(t,[{key:"set",value:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}},{key:"setAxisAngleFromQuaternion",value:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}},{key:"setAxisAngleFromRotationMatrix",value:function(t){var e=t.elements,i=e[0],n=e[4],s=e[8],r=e[1],a=e[5],o=e[9],h=e[2],u=e[6],l=e[10],c=void 0,d=void 0,y=void 0,v=void 0,m=void 0,f=void 0,g=void 0,p=void 0,x=void 0,k=void 0,w=void 0;return Math.abs(n-r)<.01&&Math.abs(s-h)<.01&&Math.abs(o-u)<.01?Math.abs(n+r)<.1&&Math.abs(s+h)<.1&&Math.abs(o+u)<.1&&Math.abs(i+a+l-3)<.1?this.set(1,0,0,0):(c=Math.PI,g=(l+1)/2,p=(n+r)/4,x=(s+h)/4,k=(o+u)/4,(m=(i+1)/2)>(f=(a+1)/2)&&m>g?m<.01?(d=0,y=.707106781,v=.707106781):(y=p/(d=Math.sqrt(m)),v=x/d):f>g?f<.01?(d=.707106781,y=0,v=.707106781):(d=p/(y=Math.sqrt(f)),v=k/y):g<.01?(d=.707106781,y=.707106781,v=0):(d=x/(v=Math.sqrt(g)),y=k/v),this.set(d,y,v,c)):(w=Math.sqrt((u-o)*(u-o)+(s-h)*(s-h)+(r-n)*(r-n)),Math.abs(w)<.001&&(w=1),this.x=(u-o)/w,this.y=(s-h)/w,this.z=(r-n)/w,this.w=Math.acos((i+a+l-1)/2)),this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this.w=t.w*e.w,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this}},{key:"applyMatrix4",value:function(t){var e=this.x,i=this.y,n=this.z,s=this.w,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n+r[12]*s,this.y=r[1]*e+r[5]*i+r[9]*n+r[13]*s,this.z=r[2]*e+r[6]*i+r[10]*n+r[14]*s,this.w=r[3]*e+r[7]*i+r[11]*n+r[15]*s,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)+Math.abs(this.w-t.w)}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z,s=this.w-t.w;return e*e+i*i+n*n+s*s}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}},{key:"lerpVectors",value:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}}]),t}(),it=0,nt=1,st=2,rt=2*Math.PI,at=new p,ot=new Z,ht=function(){function t(e,i,s,r){n(this,t),this.position=e,this.quaternion=i,this.target=s,this.settings=r,this.spherical=new $}return s(t,[{key:"setPosition",value:function(t){return this.position=t,this}},{key:"setQuaternion",value:function(t){return this.quaternion=t,this}},{key:"setTarget",value:function(t){return this.target=t,this}},{key:"updateQuaternion",value:function(){var t=this.settings,e=t.rotation;return t.general.orbit?ot.lookAt(at.subVectors(this.position,this.target),e.pivotOffset,e.up):ot.lookAt(at.set(0,0,0),this.target.setFromSpherical(this.spherical),e.up),this.quaternion.setFromRotationMatrix(ot),this}},{key:"adjustSpherical",value:function(t,e){var i=this.settings,n=i.general.orbit,s=i.rotation,r=this.spherical;return r.theta=s.invertX?r.theta+t:r.theta-t,r.phi=!n&&!s.invertY||n&&s.invertY?r.phi+e:r.phi-e,r.theta=Math.min(Math.max(r.theta,s.minAzimuthalAngle),s.maxAzimuthalAngle),r.phi=Math.min(Math.max(r.phi,s.minPolarAngle),s.maxPolarAngle),r.theta%=rt,r.makeSafe(),n&&this.position.setFromSpherical(r).add(this.target),this}},{key:"zoom",value:function(t){var e=this.settings,i=e.general,n=e.sensitivity,s=e.zoom,r=this.spherical,a=void 0,o=void 0,h=void 0;return i.orbit&&s.enabled&&(a=t*n.zoom,s.invert&&(a=-a),o=Math.max(s.minDistance,1e-6),h=Math.min(s.maxDistance,1/0),r.radius=Math.min(Math.max(r.radius+a,o),h),this.position.setFromSpherical(r).add(this.target)),this}},{key:"update",value:function(t){}},{key:"lookAt",value:function(t){var e=this.spherical,i=this.position,n=this.target;return n.copy(t),this.settings.general.orbit?at.subVectors(i,n):at.subVectors(n,i).normalize(),e.setFromVector3(at),e.radius=Math.max(e.radius,1e-6),this.updateQuaternion(),this}},{key:"getViewDirection",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p;return t.setFromSpherical(this.spherical).normalize(),this.settings.general.orbit&&t.negate(),t}}]),t}(),ut=function(){function t(){n(this,t),this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.up=!1,this.down=!1}return s(t,[{key:"reset",value:function(){return this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.up=!1,this.down=!1,this}}]),t}(),lt=new p(1,0,0),ct=new p(0,1,0),dt=new p(0,0,1),yt=new p,vt=function(){function t(e,i,s,r){n(this,t),this.position=e,this.quaternion=i,this.target=s,this.settings=r,this.movementState=new ut}return s(t,[{key:"setPosition",value:function(t){return this.position=t,this}},{key:"setQuaternion",value:function(t){return this.quaternion=t,this}},{key:"setTarget",value:function(t){return this.target=t,this}},{key:"translateOnAxis",value:function(t,e){yt.copy(t).applyQuaternion(this.quaternion).multiplyScalar(e),this.position.add(yt),this.settings.general.orbit&&this.target.add(yt)}},{key:"translate",value:function(t){var e=this.settings.sensitivity,i=this.movementState,n=t*e.translation;i.backward?this.translateOnAxis(dt,n):i.forward&&this.translateOnAxis(dt,-n),i.right?this.translateOnAxis(lt,n):i.left&&this.translateOnAxis(lt,-n),i.up?this.translateOnAxis(ct,n):i.down&&this.translateOnAxis(ct,-n)}},{key:"update",value:function(t){this.settings.translation.enabled&&this.translate(t)}},{key:"moveTo",value:function(t){return this.settings.general.orbit?this.target.copy(t):this.position.copy(t),this}}]),t}(),mt=new Proxy({BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,META_LEFT:91,META_RIGHT:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222},{get:function(t,e){return e in t?t[e]:1===e.length?e.toUpperCase().charCodeAt(0):void 0}}),ft=function(){function t(){n(this,t),this.orbit=!0}return s(t,[{key:"copy",value:function(t){return this.orbit=t.orbit,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),gt=function(){function t(){n(this,t),this.defaultActions=new Map,this.actions=new Map}return s(t,[{key:"reset",value:function(){return this.actions=new Map(this.defaultActions),this}},{key:"setDefault",value:function(t){return this.defaultActions=t,this.reset()}},{key:"copy",value:function(t){return this.defaultActions=new Map(t.defaultActions),this.actions=new Map(t.actions),this}},{key:"clearDefault",value:function(){return this.defaultActions.clear(),this}},{key:"clear",value:function(){return this.actions.clear(),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"has",value:function(t){return this.actions.has(t)}},{key:"get",value:function(t){return this.actions.get(t)}},{key:"set",value:function(t,e){return this.actions.set(t,e),this}},{key:"delete",value:function(t){return this.actions.delete(t)}},{key:"toJSON",value:function(){return{defaultActions:[].concat(h(this.defaultActions)),actions:[].concat(h(this.actions))}}}]),t}(),pt=function(){function t(){n(this,t),this.hold=!1,this.lock=!0}return s(t,[{key:"copy",value:function(t){return this.hold=t.hold,this.lock=t.lock,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),xt=function(){function t(){n(this,t),this.up=new p,this.up.copy(ct),this.pivotOffset=new p,this.minAzimuthalAngle=-1/0,this.maxAzimuthalAngle=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.invertX=!1,this.invertY=!1}return s(t,[{key:"copy",value:function(t){return this.up.copy(t.up),this.pivotOffset.copy(t.pivotOffset),this.minAzimuthalAngle=null!==t.minAzimuthalAngle?t.minAzimuthalAngle:-1/0,this.maxAzimuthalAngle=null!==t.maxAzimuthalAngle?t.maxAzimuthalAngle:1/0,this.minPolarAngle=t.minPolarAngle,this.maxPolarAngle=t.maxPolarAngle,this.invertX=t.invertX,this.invertY=t.invertY,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),kt=function(){function t(){n(this,t),this.rotation=.0025,this.translation=1,this.zoom=.1}return s(t,[{key:"copy",value:function(t){return this.rotation=t.rotation,this.translation=t.translation,this.zoom=t.zoom,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),wt=function(){function t(){n(this,t),this.enabled=!0}return s(t,[{key:"copy",value:function(t){return this.enabled=t.enabled,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),zt=function(){function t(){n(this,t),this.enabled=!0,this.invert=!1,this.minDistance=1e-6,this.maxDistance=1/0}return s(t,[{key:"copy",value:function(t){return this.enabled=t.enabled,this.invert=t.invert,this.minDistance=t.minDistance,this.maxDistance=t.maxDistance,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),Mt=function(){function t(){n(this,t),this.general=new ft,this.keyBindings=new gt,this.keyBindings.setDefault(new Map([[mt.W,g.MOVE_FORWARD],[mt.UP,g.MOVE_FORWARD],[mt.A,g.MOVE_LEFT],[mt.LEFT,g.MOVE_LEFT],[mt.S,g.MOVE_BACKWARD],[mt.DOWN,g.MOVE_BACKWARD],[mt.D,g.MOVE_RIGHT],[mt.RIGHT,g.MOVE_RIGHT],[mt.X,g.MOVE_DOWN],[mt.SPACE,g.MOVE_UP],[mt.PAGE_DOWN,g.ZOOM_OUT],[mt.PAGE_UP,g.ZOOM_IN]])),this.pointer=new pt,this.rotation=new xt,this.sensitivity=new kt,this.translation=new wt,this.zoom=new zt}return s(t,[{key:"copy",value:function(t){return this.general.copy(t.general),this.keyBindings.copy(t.keyBindings),this.pointer.copy(t.pointer),this.rotation.copy(t.rotation),this.sensitivity.copy(t.sensitivity),this.translation.copy(t.translation),this.zoom.copy(t.zoom),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toDataURL",value:function(){return URL.createObjectURL(new Blob([JSON.stringify(this)],{type:"text/json"}))}}]),t}(),bt=function(){function t(){n(this,t)}return s(t,[{key:"execute",value:function(t){throw new Error("Strategy#execute method not implemented!")}}]),t}(),At=function(t){a(e,bt);function e(t,i){n(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return s.movementState=t,s.direction=i,s}return s(e,[{key:"execute",value:function(t){var e=this.movementState;switch(this.direction){case St.FORWARD:e.forward=t;break;case St.LEFT:e.left=t;break;case St.BACKWARD:e.backward=t;break;case St.RIGHT:e.right=t;break;case St.DOWN:e.down=t;break;case St.UP:e.up=t}}}]),e}(),St={FORWARD:0,LEFT:1,BACKWARD:2,RIGHT:3,DOWN:4,UP:5},Pt=function(t){a(e,bt);function e(t,i){n(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return s.rotationManager=t,s.zoomIn=i,s}return s(e,[{key:"execute",value:function(t){t&&this.rotationManager.zoom(this.zoomIn?-1:1)}}]),e}(),Et=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document.body;n(this,t),this.dom=s,this.position=e,this.quaternion=i,this.target=new p,this.settings=new Mt,this.rotationManager=new ht(e,i,this.target,this.settings),this.translationManager=new vt(e,i,this.target,this.settings),this.strategies=function(t,e){var i=e.movementState;return new Map([[g.MOVE_FORWARD,new At(i,St.FORWARD)],[g.MOVE_LEFT,new At(i,St.LEFT)],[g.MOVE_BACKWARD,new At(i,St.BACKWARD)],[g.MOVE_RIGHT,new At(i,St.RIGHT)],[g.MOVE_DOWN,new At(i,St.DOWN)],[g.MOVE_UP,new At(i,St.UP)],[g.ZOOM_OUT,new Pt(t,!1)],[g.ZOOM_IN,new Pt(t,!0)]])}(this.rotationManager,this.translationManager),this.lastScreenPosition=new M,this.dragging=!1,this.enabled=!1,null!==e&&null!==i&&(this.lookAt(this.target),null!==s&&this.setEnabled())}return s(t,[{key:"getDom",value:function(){return this.dom}},{key:"getPosition",value:function(){return this.position}},{key:"getQuaternion",value:function(){return this.quaternion}},{key:"getTarget",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p;return t.copy(this.target),this.settings.general.orbit||t.add(this.position),t}},{key:"getViewDirection",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p;return this.rotationManager.getViewDirection(t)}},{key:"setDom",value:function(t){var e=this.enabled;return null!==t&&(e&&this.setEnabled(!1),this.dom=t,this.setEnabled(e)),this}},{key:"setPosition",value:function(t){return this.position=t,this.rotationManager.setPosition(t),this.translationManager.setPosition(t),this.lookAt(this.target)}},{key:"setQuaternion",value:function(t){return this.quaternion=t,this.rotationManager.setQuaternion(t),this.translationManager.setQuaternion(t),this.lookAt(this.target)}},{key:"setTarget",value:function(t){return this.target=t,this.rotationManager.setTarget(t),this.translationManager.setTarget(t),this.lookAt(this.target)}},{key:"setOrbitEnabled",value:function(t){var e=this.settings.general;return e.orbit!==t&&(this.getTarget(this.target),e.orbit=t,this.lookAt(this.target)),this}},{key:"copy",value:function(t){return this.dom=t.getDom(),this.position=t.getPosition(),this.quaternion=t.getQuaternion(),this.target=t.getTarget(),this.settings.copy(t.settings),this.rotationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.translationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.lookAt(this.target)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"handlePointerMoveEvent",value:function(t){var e=this.settings,i=e.pointer,n=e.sensitivity,s=this.rotationManager,r=this.lastScreenPosition,a=void 0,o=void 0;document.pointerLockElement===this.dom?i.hold&&!this.dragging||s.adjustSpherical(t.movementX*n.rotation,t.movementY*n.rotation).updateQuaternion():(a=t.screenX-r.x,o=t.screenY-r.y,r.set(t.screenX,t.screenY),s.adjustSpherical(a*n.rotation,o*n.rotation).updateQuaternion())}},{key:"handleTouchMoveEvent",value:function(t){var e=this.settings.sensitivity,i=this.rotationManager,n=this.lastScreenPosition,s=t.touches[0],r=s.screenX-n.x,a=s.screenY-n.y;n.set(s.screenX,s.screenY),t.preventDefault(),i.adjustSpherical(r*e.rotation,a*e.rotation).updateQuaternion()}},{key:"handleMainPointerButton",value:function(t,e){this.dragging=e,this.settings.pointer.lock?this.setPointerLocked():e?(this.lastScreenPosition.set(t.screenX,t.screenY),this.dom.addEventListener("mousemove",this)):this.dom.removeEventListener("mousemove",this)}},{key:"handleAuxiliaryPointerButton",value:function(t,e){}},{key:"handleSecondaryPointerButton",value:function(t,e){}},{key:"handlePointerButtonEvent",value:function(t,e){switch(t.preventDefault(),t.button){case it:this.handleMainPointerButton(t,e);break;case nt:this.handleAuxiliaryPointerButton(t,e);break;case st:this.handleSecondaryPointerButton(t,e)}}},{key:"handleTouchEvent",value:function(t,e){var i=t.touches[0];t.preventDefault(),e?(this.lastScreenPosition.set(i.screenX,i.screenY),this.dom.addEventListener("touchmove",this)):this.dom.removeEventListener("touchmove",this)}},{key:"handleKeyboardEvent",value:function(t,e){var i=this.settings.keyBindings;i.has(t.keyCode)&&(t.preventDefault(),this.strategies.get(i.get(t.keyCode)).execute(e))}},{key:"handleWheelEvent",value:function(t){this.rotationManager.zoom(Math.sign(t.deltaY))}},{key:"handlePointerLockEvent",value:function(){document.pointerLockElement===this.dom?this.dom.addEventListener("mousemove",this):this.dom.removeEventListener("mousemove",this)}},{key:"handleEvent",value:function(t){switch(t.type){case"mousemove":this.handlePointerMoveEvent(t);break;case"touchmove":this.handleTouchMoveEvent(t);break;case"mousedown":this.handlePointerButtonEvent(t,!0);break;case"mouseup":this.handlePointerButtonEvent(t,!1);break;case"touchstart":this.handleTouchEvent(t,!0);break;case"touchend":this.handleTouchEvent(t,!1);break;case"keydown":this.handleKeyboardEvent(t,!0);break;case"keyup":this.handleKeyboardEvent(t,!1);break;case"wheel":this.handleWheelEvent(t);break;case"pointerlockchange":this.handlePointerLockEvent()}}},{key:"update",value:function(t){this.rotationManager.update(t),this.translationManager.update(t)}},{key:"moveTo",value:function(t){return this.rotationManager.moveTo(t),this}},{key:"lookAt",value:function(t){return this.rotationManager.lookAt(t),this}},{key:"setPointerLocked",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?document.pointerLockElement!==this.dom&&void 0!==this.dom.requestPointerLock&&this.dom.requestPointerLock():void 0!==document.exitPointerLock&&document.exitPointerLock()}},{key:"setEnabled",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.dom;return this.translationManager.movementState.reset(),t&&!this.enabled?(document.addEventListener("pointerlockchange",this),document.body.addEventListener("keyup",this),document.body.addEventListener("keydown",this),e.addEventListener("mousedown",this),e.addEventListener("mouseup",this),e.addEventListener("touchstart",this),e.addEventListener("touchend",this),e.addEventListener("wheel",this)):!t&&this.enabled&&(document.removeEventListener("pointerlockchange",this),document.body.removeEventListener("keyup",this),document.body.removeEventListener("keydown",this),e.removeEventListener("mousedown",this),e.removeEventListener("mouseup",this),e.removeEventListener("touchstart",this),e.removeEventListener("touchend",this),e.removeEventListener("wheel",this),e.removeEventListener("mousemove",this),e.removeEventListener("touchmove",this)),this.setPointerLocked(!1),this.enabled=t,this}},{key:"dispose",value:function(){this.setEnabled(!1)}}]),t}(),Ot=0,_t=function(e){a(i,e);function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];n(this,i);var u=o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));u.name="HermiteDataHelper",u.cellPosition=e,u.cellSize=s,u.data=r,u.pointsMaterial=new t.PointsMaterial({vertexColors:t.VertexColors,sizeAttenuation:!0,size:.05}),u.add(new t.Group),u.add(new t.Group),u.add(new t.Group),u.gridPoints.name="GridPoints",u.edges.name="Edges",u.normals.name="Normals";try{u.update(a,h)}catch(t){}return u}return s(i,[{key:"validate",value:function(){var t=null;return null===this.cellPosition?t=new Error("The cell position is not defined"):this.cellSize<=0?t=new Error("Invalid cell size: "+this.cellSize):null===this.data?t=new Error("No data"):(this.data.empty&&(t=new Error("The provided data is empty")),this.data.compressed&&(t=new Error("The provided data must be uncompressed"))),t}},{key:"set",value:function(t,e,i){return this.cellPosition=t,this.cellSize=e,this.data=i,this}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.data,n=this.validate();if(this.dispose(),null!==n)throw n;return t&&this.createPoints(i),e&&null!==i.edgeData&&this.createEdges(i),this}},{key:"createPoints",value:function(e){var i=e.materialIndices,n=Math.cbrt(i.length)-1,s=this.cellSize,r=this.cellPosition,a=new t.Vector3,o=new t.Vector3,h=new Float32Array([0,0,0]),u=new t.BufferGeometry,l=e.materials,c=new Float32Array(3*l),d=new Float32Array(3*l),y=void 0,v=void 0,m=void 0,f=void 0,g=void 0;for(f=0,g=0,m=0;m<=n;++m)for(a.z=m*s/n,v=0;v<=n;++v)for(a.y=v*s/n,y=0;y<=n;++y)a.x=y*s/n,i[f++]!==Ot&&(o.addVectors(r,a),c[g]=o.x,d[g++]=h[0],c[g]=o.y,d[g++]=h[1],c[g]=o.z,d[g++]=h[2]);u.addAttribute("position",new t.BufferAttribute(c,3)),u.addAttribute("color",new t.BufferAttribute(d,3)),this.gridPoints.add(new t.Points(u,this.pointsMaterial))}},{key:"createEdges",value:function(e){var i=e.edgeData,n=Math.cbrt(e.materialIndices.length)-1,s=this.cellSize,r=new t.Vector3,a=new t.Vector3,o=[i.edgesX(this.cellPosition,this.cellSize),i.edgesY(this.cellPosition,this.cellSize),i.edgesZ(this.cellPosition,this.cellSize)],h=[new Float32Array([.6,0,0]),new Float32Array([0,.6,0]),new Float32Array([0,0,.6])],u=new Float32Array([0,1,1]),l=new t.LineBasicMaterial({vertexColors:t.VertexColors}),c=void 0,d=void 0,y=void 0,v=void 0,m=void 0,f=void 0,g=void 0,p=void 0,x=void 0,k=void 0,w=void 0,z=void 0;for(w=0,z=0,k=0;k<3;++k,w=0,z=0)if(f=h[k],(p=o[k]).lengths.length>0){m=2*p.lengths[0],c=new Float32Array(3*m),d=new Float32Array(3*m),y=new Float32Array(3*m),v=new Float32Array(3*m);var M=!0,b=!1,A=void 0;try{for(var S,P=p[Symbol.iterator]();!(M=(S=P.next()).done);M=!0)x=S.value,c[w]=x.a.x,d[w++]=f[0],c[w]=x.a.y,d[w++]=f[1],c[w]=x.a.z,d[w++]=f[2],c[w]=x.b.x,d[w++]=f[0],c[w]=x.b.y,d[w++]=f[1],c[w]=x.b.z,d[w++]=f[2],x.computeZeroCrossingPosition(r),a.copy(r).addScaledVector(x.n,.25*s/n),y[z]=r.x,v[z++]=u[0],y[z]=r.y,v[z++]=u[1],y[z]=r.z,v[z++]=u[2],y[z]=a.x,v[z++]=u[0],y[z]=a.y,v[z++]=u[1],y[z]=a.z,v[z++]=u[2]}catch(t){b=!0,A=t}finally{try{!M&&P.return&&P.return()}finally{if(b)throw A}}(g=new t.BufferGeometry).addAttribute("position",new t.BufferAttribute(c,3)),g.addAttribute("color",new t.BufferAttribute(d,3)),this.edges.add(new t.LineSegments(g,l)),(g=new t.BufferGeometry).addAttribute("position",new t.BufferAttribute(y,3)),g.addAttribute("color",new t.BufferAttribute(v,3)),this.normals.add(new t.LineSegments(g,l))}}},{key:"dispose",value:function(){var t=void 0,e=void 0,i=void 0,n=void 0;for(i=0,n=this.children.length;i<n;++i)for(e=(t=this.children[i]).children;e.length>0;)e[0].geometry.dispose(),e[0].material.dispose(),t.remove(e[0])}},{key:"gridPoints",get:function(){return this.children[0]}},{key:"edges",get:function(){return this.children[1]}},{key:"normals",get:function(){return this.children[2]}}],[{key:"air",set:function(t){Ot=t}}]),i}(t.Group),It=function(e){a(i,e);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;n(this,i);var e=o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.name="OctreeHelper",e.octree=t,e.update(),e}return s(i,[{key:"createLineSegments",value:function(e,i){var n=Math.pow(2,16)/8-1,s=new t.Group,r=new t.LineBasicMaterial({color:16777215*Math.random()}),a=void 0,o=void 0,h=void 0,u=void 0,l=void 0,c=void 0,d=void 0,y=void 0,v=void 0,m=void 0,f=void 0,g=void 0,p=void 0,x=void 0,k=void 0,w=void 0;for(m=0,h=0,x=Math.ceil(i/n);x>0;--x){for(h+=i<n?i:n,i-=n,o=8*h,u=new Uint16Array(3*o),l=new Float32Array(3*o),g=0,p=0,a=e.next();!a.done&&m<h;){for(d=(c=a.value).min,y=c.max,f=0;f<12;++f)w=Dt[f],u[p++]=g+w[0],u[p++]=g+w[1];for(f=0;f<8;++f,++g)k=Tt[f],l[3*g]=0===k[0]?d.x:y.x,l[3*g+1]=0===k[1]?d.y:y.y,l[3*g+2]=0===k[2]?d.z:y.z;++m<h&&(a=e.next())}(v=new t.BufferGeometry).setIndex(new t.BufferAttribute(u,1)),v.addAttribute("position",new t.BufferAttribute(l,3)),s.add(new t.LineSegments(v,r))}this.add(s)}},{key:"update",value:function(){var t=null!==this.octree?this.octree.getDepth():-1,e=0,i=void 0;for(this.dispose();e<=t;)i=this.octree.findOctantsByLevel(e),this.createLineSegments(i[Symbol.iterator](),"number"==typeof i.size?i.size:i.length),++e}},{key:"dispose",value:function(){var t=this.children,e=void 0,i=void 0,n=void 0,s=void 0,r=void 0,a=void 0;for(n=0,r=t.length;n<r;++n){for(s=0,a=(i=(e=t[n]).children).length;s<a;++s)i[s].geometry.dispose(),i[s].material.dispose();for(;i.length>0;)e.remove(i[0])}for(;t.length>0;)this.remove(t[0])}}]),i}(t.Group),Tt=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],Dt=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],Ct=(function(){function t(){n(this,t)}s(t,[{key:"serialize",value:function(){}}])}(),function(){function t(){n(this,t)}s(t,[{key:"deserialize",value:function(t){}}])}(),function(){function t(){n(this,t)}s(t,[{key:"dispose",value:function(){}}])}(),function(){function t(){n(this,t)}s(t,[{key:"createTransferList",value:function(){}}])}(),function(){function t(){n(this,t),this.elements=[],this.head=0}return s(t,[{key:"copy",value:function(t){return this.elements=Array.from(t.elements),this.head=t.head,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"add",value:function(t){this.elements.push(t)}},{key:"peek",value:function(){return this.elements.length>0?this.elements[this.head]:void 0}},{key:"poll",value:function(){var t=this.elements,e=t.length,i=void 0;return e>0&&(i=t[this.head++],2*this.head>=e&&(this.elements=t.slice(this.head),this.head=0)),i}},{key:"clear",value:function(){this.elements=[],this.head=0}},{key:"size",get:function(){return this.elements.length-this.head}},{key:"empty",get:function(){return 0===this.elements.length}}]),t}()),Ut={UNION:"csg.union",DIFFERENCE:"csg.difference",INTERSECTION:"csg.intersection",DENSITY_FUNCTION:"csg.densityfunction"},Ft={AIR:0,SOLID:1},qt=function(){function t(e){n(this,t),this.type=e;for(var i=arguments.length,s=Array(i>1?i-1:0),r=1;r<i;r++)s[r-1]=arguments[r];this.children=s,this.boundingBox=null}return s(t,[{key:"getBoundingBox",value:function(){return null===this.boundingBox&&(this.boundingBox=this.computeBoundingBox()),this.boundingBox}},{key:"computeBoundingBox",value:function(){var t=this.children,e=new k,i=void 0,n=void 0;for(i=0,n=t.length;i<n;++i)e.union(t[i].getBoundingBox());return e}}]),t}(),Lt=function(t){a(e,qt);function e(){var t;n(this,e);for(var i=arguments.length,s=Array(i),r=0;r<i;r++)s[r]=arguments[r];return o(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this,Ut.UNION].concat(s)))}return s(e,[{key:"updateMaterialIndex",value:function(t,e,i){var n=i.materialIndices[t];n!==Ft.AIR&&e.setMaterialIndex(t,n)}},{key:"selectEdge",value:function(t,e,i){return i?t.t>e.t?t:e:t.t<e.t?t:e}}]),e}(),Nt=function(t){a(e,qt);function e(){var t;n(this,e);for(var i=arguments.length,s=Array(i),r=0;r<i;r++)s[r]=arguments[r];return o(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this,Ut.DIFFERENCE].concat(s)))}return s(e,[{key:"updateMaterialIndex",value:function(t,e,i){i.materialIndices[t]!==Ft.AIR&&e.setMaterialIndex(t,Ft.AIR)}},{key:"selectEdge",value:function(t,e,i){return i?t.t<e.t?t:e:t.t>e.t?t:e}}]),e}(),Bt=function(t){a(e,qt);function e(){var t;n(this,e);for(var i=arguments.length,s=Array(i),r=0;r<i;r++)s[r]=arguments[r];return o(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this,Ut.INTERSECTION].concat(s)))}return s(e,[{key:"updateMaterialIndex",value:function(t,e,i){var n=i.materialIndices[t];e.setMaterialIndex(t,e.materialIndices[t]!==Ft.AIR&&n!==Ft.AIR?n:Ft.AIR)}},{key:"selectEdge",value:function(t,e,i){return i?t.t<e.t?t:e:t.t>e.t?t:e}}]),e}(),Rt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;n(this,t),this.runLengths=e,this.data=i}return s(t,null,[{key:"encode",value:function(e){var i=[],n=[],s=e[0],r=1,a=void 0,o=void 0;for(a=1,o=e.length;a<o;++a)s!==e[a]?(i.push(r),n.push(s),s=e[a],r=1):++r;return i.push(r),n.push(s),new t(i,n)}},{key:"decode",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=void 0,s=void 0,r=void 0,a=void 0,o=void 0,h=0;for(s=0,a=e.length;s<a;++s)for(n=e[s],r=0,o=t[s];r<o;++r)i[h++]=n;return i}}]),t}(),Vt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n(this,t),this.value=e,this.done=i}return s(t,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),t}(),jt=new p,Yt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p;n(this,t),this.min=e,this.max=i,this.children=null}return s(t,[{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p).addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p).subVectors(this.max,this.min)}},{key:"split",value:function(){var t=this.min,e=this.max,i=this.getCenter(jt),n=this.children=[null,null,null,null,null,null,null,null],s=void 0,r=void 0;for(s=0;s<8;++s)r=Xt[s],n[s]=new this.constructor(new p(0===r[0]?t.x:i.x,0===r[1]?t.y:i.y,0===r[2]?t.z:i.z),new p(0===r[0]?i.x:e.x,0===r[1]?i.y:e.y,0===r[2]?i.z:e.z))}}]),t}(),Xt=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],Gt=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],Ht=new p,Wt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n(this,t),this.min=e,this.size=i,this.children=null}return s(t,[{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p).copy(this.min).addScalar(.5*this.size)}},{key:"getDimensions",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p).set(this.size,this.size,this.size)}},{key:"split",value:function(){var t=this.min,e=this.getCenter(Ht),i=.5*this.size,n=this.children=[null,null,null,null,null,null,null,null],s=void 0,r=void 0;for(s=0;s<8;++s)r=Xt[s],n[s]=new this.constructor(new p(0===r[0]?t.x:e.x,0===r[1]?t.y:e.y,0===r[2]?t.z:e.z),i)}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}]),t}(),Kt=new k,Zt=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;n(this,t),this.octree=e,this.region=i,this.cull=null!==i,this.result=new Vt,this.trace=null,this.indices=null,this.reset()}return s(t,[{key:"reset",value:function(){var t=this.octree.root;return this.trace=[],this.indices=[],null!==t&&(Kt.min=t.min,Kt.max=t.max,this.cull&&!this.region.intersectsBox(Kt)||(this.trace.push(t),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var t=this.cull,e=this.region,i=this.indices,n=this.trace,s=null,r=n.length-1,a=void 0,o=void 0,h=void 0;null===s&&r>=0;)if(a=i[r],o=n[r].children,++i[r],a<8)if(null!==o){if(h=o[a],t&&(Kt.min=h.min,Kt.max=h.max,!e.intersectsBox(Kt)))continue;n.push(h),i.push(0),++r}else s=n.pop(),i.pop();else n.pop(),i.pop(),--r;return this.result.value=s,this.result.done=null===s,this.result}},{key:"return",value:function(t){return this.result.value=t,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),Qt=[new p,new p,new p],Jt=new k,$t=new J,te=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],ee=0;function ie(t,e,i,n){var s=void 0,r=0;return e<i?(s=e,r=0):(s=i,r=1),n<s&&(r=2),te[t][r]}var ne=function(){function t(){n(this,t)}return s(t,null,[{key:"intersectOctree",value:function(t,e,i){var n=Jt.min.set(0,0,0),s=Jt.max.subVectors(t.max,t.min),r=t.getDimensions(Qt[0]),a=Qt[1].copy(r).multiplyScalar(.5),o=$t.origin.copy(e.ray.origin),h=$t.direction.copy(e.ray.direction),u=void 0,l=void 0,c=void 0,d=void 0,y=void 0,v=void 0,m=void 0,f=void 0,g=void 0;o.sub(t.getCenter(Qt[2])).add(a),ee=0,h.x<0&&(o.x=r.x-o.x,h.x=-h.x,ee|=4),h.y<0&&(o.y=r.y-o.y,h.y=-h.y,ee|=2),h.z<0&&(o.z=r.z-o.z,h.z=-h.z,ee|=1),u=1/h.x,l=1/h.y,c=1/h.z,d=(n.x-o.x)*u,y=(s.x-o.x)*u,v=(n.y-o.y)*l,m=(s.y-o.y)*l,f=(n.z-o.z)*c,g=(s.z-o.z)*c,Math.max(Math.max(d,v),f)<Math.min(Math.min(y,m),g)&&function t(e,i,n,s,r,a,o,h,u){var l=e.children,c=void 0,d=void 0,y=void 0,v=void 0;if(r>=0&&a>=0&&o>=0)if(null===l)u.push(e);else{c=function(t,e,i,n,s,r){var a=0;return t>e&&t>i?(s<t&&(a|=2),r<t&&(a|=1)):e>i?(n<e&&(a|=4),r<e&&(a|=1)):(n<i&&(a|=4),s<i&&(a|=2)),a}(i,n,s,d=.5*(i+r),y=.5*(n+a),v=.5*(s+o));do{switch(c){case 0:t(l[ee],i,n,s,d,y,v,h,u),c=ie(c,d,y,v);break;case 1:t(l[1^ee],i,n,v,d,y,o,h,u),c=ie(c,d,y,o);break;case 2:t(l[2^ee],i,y,s,d,a,v,h,u),c=ie(c,d,a,v);break;case 3:t(l[3^ee],i,y,v,d,a,o,h,u),c=ie(c,d,a,o);break;case 4:t(l[4^ee],d,n,s,r,y,v,h,u),c=ie(c,r,y,v);break;case 5:t(l[5^ee],d,n,v,r,y,o,h,u),c=ie(c,r,y,o);break;case 6:t(l[6^ee],d,y,s,r,a,v,h,u),c=ie(c,r,a,v);break;case 7:t(l[7^ee],d,y,v,r,a,o,h,u),c=8}}while(c<8)}}(t.root,d,v,f,y,m,g,e,i)}}]),t}(),se=new k;var re=function(){function t(e,i){n(this,t),this.root=void 0!==e&&void 0!==i?new Yt(e,i):null}return s(t,[{key:"getCenter",value:function(t){return this.root.getCenter(t)}},{key:"getDimensions",value:function(t){return this.root.getDimensions(t)}},{key:"getDepth",value:function(){return function t(e){var i=e.children,n=0,s=void 0,r=void 0,a=void 0;if(null!==i)for(s=0,r=i.length;s<r;++s)(a=1+t(i[s]))>n&&(n=a);return n}(this.root)}},{key:"cull",value:function(t){var e=[];return function t(e,i,n){var s=e.children,r=void 0,a=void 0;if(se.min=e.min,se.max=e.max,i.intersectsBox(se))if(null!==s)for(r=0,a=s.length;r<a;++r)t(s[r],i,n);else n.push(e)}(this.root,t,e),e}},{key:"findOctantsByLevel",value:function(t){var e=[];return function t(e,i,n,s){var r=e.children,a=void 0,o=void 0;if(n===i)s.push(e);else if(null!==r)for(++n,a=0,o=r.length;a<o;++a)t(r[a],i,n,s)}(this.root,t,0,e),e}},{key:"raycast",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return ne.intersectOctree(this,t,e),e}},{key:"leaves",value:function(t){return new Zt(this,t)}},{key:Symbol.iterator,value:function(){return new Zt(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),t}(),ae=new p,oe=function(t){a(e,Yt);function e(t,i){n(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return s.points=null,s.data=null,s}return s(e,[{key:"distanceToSquared",value:function(t){return ae.copy(t).clamp(this.min,this.max).sub(t).lengthSquared()}},{key:"distanceToCenterSquared",value:function(t){var e=this.getCenter(ae),i=t.x-e.x,n=t.y-e.x,s=t.z-e.z;return i*i+n*n+s*s}},{key:"contains",value:function(t,e){var i=this.min,n=this.max;return t.x>=i.x-e&&t.y>=i.y-e&&t.z>=i.z-e&&t.x<=n.x+e&&t.y<=n.y+e&&t.z<=n.z+e}},{key:"redistribute",value:function(t){var e=this.children,i=this.points,n=this.data,s=void 0,r=void 0,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0;if(null!==e&&null!==i)for(s=0,a=i.length;s<a;++s)for(u=i[s],l=n[s],r=0,o=e.length;r<o;++r)if((h=e[r]).contains(u,t)){null===h.points&&(h.points=[],h.data=[]),h.points.push(u),h.data.push(l);break}this.points=null,this.data=null}},{key:"merge",value:function(){var t=this.children,e=void 0,i=void 0,n=void 0;if(null!==t){for(this.points=[],this.data=[],e=0,i=t.length;e<i;++e)if(null!==(n=t[e]).points){var s,r;(s=this.points).push.apply(s,h(n.points)),(r=this.data).push.apply(r,h(n.data))}this.children=null}}}]),e}(),he=function t(e,i,s){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;n(this,t),this.distance=e,this.distanceToRay=i,this.point=s,this.object=r},ue=new p,le=1e-6;function ce(t){var e=t.children,i=0,n=void 0,s=void 0;if(null!==e)for(n=0,s=e.length;n<s;++n)i+=ce(e[n]);else null!==t.points&&(i=t.points.length);return i}function de(t,e,i,n,s){var r=n.children,a=!1,o=!1,h=void 0,u=void 0;if(n.contains(t,i.bias)){if(null===r){if(null===n.points)n.points=[],n.data=[];else for(h=0,u=n.points.length;!a&&h<u;++h)a=n.points[h].equals(t);a?(n.data[h-1]=e,o=!0):n.points.length<i.maxPoints||s===i.maxDepth?(n.points.push(t.clone()),n.data.push(e),++i.pointCount,o=!0):(n.split(),n.redistribute(i.bias),r=n.children)}if(null!==r)for(++s,h=0,u=r.length;!o&&h<u;++h)o=de(t,e,i,r[h],s)}return o}function ye(t,e,i,n){var s=i.children,r=null,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0;if(i.contains(t,e.bias))if(null!==s)for(a=0,o=s.length;null===r&&a<o;++a)r=ye(t,e,s[a],i);else if(null!==i.points)for(h=i.points,u=i.data,a=0,o=h.length;a<o;++a)if(h[a].equals(t)){l=o-1,r=u[a],a<l&&(h[a]=h[l],u[a]=u[l]),h.pop(),u.pop(),--e.pointCount,null!==n&&ce(n)<=e.maxPoints&&n.merge();break}return r}!function(t){a(e,re);function e(t,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;n(this,e);var h=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return h.root=new oe(t,i),h.bias=Math.max(0,s),h.maxPoints=Math.max(1,Math.round(r)),h.maxDepth=Math.max(0,Math.round(a)),h.pointCount=0,h}s(e,[{key:"countPoints",value:function(t){return ce(t)}},{key:"put",value:function(t,e){return de(t,e,this,this.root,0)}},{key:"remove",value:function(t){return ye(t,this,this.root,null)}},{key:"fetch",value:function(t){return function t(e,i,n){var s=n.children,r=null,a=void 0,o=void 0,h=void 0;if(n.contains(e,i.bias))if(null!==s)for(a=0,o=s.length;null===r&&a<o;++a)r=t(e,i,s[a]);else if(null!==n.points)for(a=0,o=(h=n.points).length;null===r&&a<o;++a)e.distanceToSquared(h[a])<=le&&(r=n.data[a]);return r}(t,this,this.root)}},{key:"move",value:function(t,e){return function t(e,i,n,s,r,a){var o=s.children,h=null,u=void 0,l=void 0,c=void 0;if(s.contains(e,n.bias))if(s.contains(i,n.bias)){if(null!==o)for(++a,u=0,l=o.length;null===h&&u<l;++u)h=t(e,i,n,o[u],s,a);else if(null!==s.points)for(u=0,l=(c=s.points).length;u<l;++u)if(e.distanceToSquared(c[u])<=le){c[u].copy(i),h=s.data[u];break}}else de(i,h=ye(e,n,s,r),n,r,a-1);return h}(t,e,this,this.root,null,0)}},{key:"findNearestPoint",value:function(t){return function t(e,i,n,s){var r=s.points,a=s.children,o=null,h=i,u=void 0,l=void 0,c=void 0,d=void 0,y=void 0,v=void 0,m=void 0;if(null!==a)for(u=0,l=(y=a.map(function(t){return{octant:t,distance:t.distanceToCenterSquared(e)}}).sort(function(t,e){return t.distance-e.distance})).length;u<l;++u)(v=y[u].octant).contains(e,h)&&null!==(m=t(e,h,n,v))&&(d=m.point.distanceToSquared(e),(!n||d>0)&&d<h&&(h=d,o=m));else if(null!==r)for(u=0,l=r.length;u<l;++u)c=r[u],d=e.distanceToSquared(c),(!n||d>0)&&d<h&&(h=d,o={point:c.clone(),data:s.data[u]});return o}(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,arguments.length>2&&void 0!==arguments[2]&&arguments[2],this.root)}},{key:"findPoints",value:function(t,e){var i=[];return function t(e,i,n,s,r){var a=s.points,o=s.children,h=i*i,u=void 0,l=void 0,c=void 0,d=void 0,y=void 0;if(null!==o)for(u=0,l=o.length;u<l;++u)(y=o[u]).contains(e,i)&&t(e,i,n,y,r);else if(null!==a)for(u=0,l=a.length;u<l;++u)c=a[u],d=e.distanceToSquared(c),(!n||d>0)&&d<=h&&r.push({point:c.clone(),data:s.data[u]})}(t,e,arguments.length>2&&void 0!==arguments[2]&&arguments[2],this.root,i),i}},{key:"raycast",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"raycast",this).call(this,t);return n.length>0&&this.testPoints(n,t,i),i}},{key:"testPoints",value:function(t,e,i){var n=e.params.Points.threshold,s=n*n,r=void 0,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0,c=void 0,d=void 0,y=void 0,v=void 0,m=void 0;for(u=0,c=t.length;u<c;++u)if(null!==(v=(y=t[u]).points))for(l=0,d=v.length;l<d;++l)m=v[l],(h=e.ray.distanceSqToPoint(m))<s&&(r=e.ray.closestPointToPoint(m,ue),(a=e.ray.origin.distanceTo(r))>=e.near&&a<=e.far&&(o=Math.sqrt(h),i.push(new he(a,o,r,y.data[l]))))}}])}();var ve=new k,me=new p,fe=new p,ge=new p,pe=(function(){function t(){n(this,t)}s(t,null,[{key:"recycleOctants",value:function(t,e){var i=t.min,n=t.getCenter(fe),s=t.getDimensions(ge).multiplyScalar(.5),r=t.children,a=e.length,o=void 0,h=void 0,u=void 0,l=void 0;for(o=0;o<8;++o)for(u=Xt[o],ve.min.addVectors(i,me.fromArray(u).multiply(s)),ve.max.addVectors(n,me.fromArray(u).multiply(s)),h=0;h<a;++h)if(null!==(l=e[h])&&ve.min.equals(l.min)&&ve.max.equals(l.max)){r[o]=l,e[h]=null;break}}}])}(),new p),xe=new p,ke=new p,we=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p;n(this,t),this.a=e,this.b=i,this.index=-1,this.coordinates=new p,this.t=0,this.n=new p}return s(t,[{key:"approximateZeroCrossing",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,i=Math.max(1,e-1),n=0,s=1,r=0,a=0,o=void 0,h=void 0;for(pe.subVectors(this.b,this.a);a<=i&&(r=(n+s)/2,xe.addVectors(this.a,ke.copy(pe).multiplyScalar(r)),h=t.sample(xe),!(Math.abs(h)<=1e-4||(s-n)/2<=1e-6));)xe.addVectors(this.a,ke.copy(pe).multiplyScalar(n)),o=t.sample(xe),Math.sign(h)===Math.sign(o)?n=r:s=r,++a;this.t=r}},{key:"computeZeroCrossingPosition",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p).subVectors(this.b,this.a).multiplyScalar(this.t).add(this.a)}},{key:"computeSurfaceNormal",value:function(t){var e=this.computeZeroCrossingPosition(pe),i=t.sample(xe.addVectors(e,ke.set(.001,0,0)))-t.sample(xe.subVectors(e,ke.set(.001,0,0))),n=t.sample(xe.addVectors(e,ke.set(0,.001,0)))-t.sample(xe.subVectors(e,ke.set(0,.001,0))),s=t.sample(xe.addVectors(e,ke.set(0,0,.001)))-t.sample(xe.subVectors(e,ke.set(0,0,.001)));this.n.set(i,n,s).normalize()}}]),t}(),ze=new we,Me=new p,be=new p,Ae=function(){function t(e,i,s){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3;n(this,t),this.edgeData=e,this.cellPosition=i,this.cellSize=s,this.indices=null,this.zeroCrossings=null,this.normals=null,this.axes=null,this.lengths=null,this.result=new Vt,this.initialC=r,this.c=r,this.initialD=a,this.d=a,this.i=0,this.l=0,this.reset()}return s(t,[{key:"reset",value:function(){var t=this.edgeData,e=[],i=[],n=[],s=[],r=[],a=void 0,o=void 0,h=void 0,u=void 0;for(this.i=0,this.c=0,this.d=0,a=4>>(o=this.initialC),h=this.initialD;o<h;++o,a>>=1)(u=t.indices[o].length)>0&&(e.push(t.indices[o]),i.push(t.zeroCrossings[o]),n.push(t.normals[o]),s.push(Xt[a]),r.push(u),++this.d);return this.l=r.length>0?r[0]:0,this.indices=e,this.zeroCrossings=i,this.normals=n,this.axes=s,this.lengths=r,this.result.reset(),this}},{key:"next",value:function(){var t=this.cellSize,e=_e.resolution,i=e+1,n=i*i,s=this.result,r=this.cellPosition,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0,c=void 0,d=void 0;return this.i===this.l&&(this.l=++this.c<this.d?this.lengths[this.c]:0,this.i=0),this.i<this.l?(c=this.c,d=this.i,a=this.axes[c],o=this.indices[c][d],ze.index=o,h=o%i,u=Math.trunc(o%n/i),l=Math.trunc(o/n),ze.coordinates.set(h,u,l),Me.set(h*t/e,u*t/e,l*t/e),be.set((h+a[0])*t/e,(u+a[1])*t/e,(l+a[2])*t/e),ze.a.addVectors(r,Me),ze.b.addVectors(r,be),ze.t=this.zeroCrossings[c][d],ze.n.fromArray(this.normals[c],3*d),s.value=ze,++this.i):(s.value=null,s.done=!0),s}},{key:"return",value:function(t){return this.result.value=t,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),Se=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;n(this,t),this.indices=e<=0?null:[new Uint32Array(e),new Uint32Array(i),new Uint32Array(s)],this.zeroCrossings=e<=0?null:[new Float32Array(e),new Float32Array(i),new Float32Array(s)],this.normals=e<=0?null:[new Float32Array(3*e),new Float32Array(3*i),new Float32Array(3*s)]}return s(t,[{key:"serialize",value:function(){return{edges:this.edges,zeroCrossings:this.zeroCrossings,normals:this.normals}}},{key:"deserialize",value:function(t){var e=this;return null!==t?(this.edges=t.edges,this.zeroCrossings=t.zeroCrossings,this.normals=t.normals):e=null,e}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=[this.edges[0],this.edges[1],this.edges[2],this.zeroCrossings[0],this.zeroCrossings[1],this.zeroCrossings[2],this.normals[0],this.normals[1],this.normals[2]],i=void 0,n=void 0,s=void 0;for(n=0,s=e.length;n<s;++n)null!==(i=e[n])&&t.push(i.buffer);return t}},{key:"edges",value:function(t,e){return new Ae(this,t,e)}},{key:"edgesX",value:function(t,e){return new Ae(this,t,e,0,1)}},{key:"edgesY",value:function(t,e){return new Ae(this,t,e,1,2)}},{key:"edgesZ",value:function(t,e){return new Ae(this,t,e,2,3)}}],[{key:"calculate1DEdgeCount",value:function(t){return Math.pow(t+1,2)*t}}]),t}(),Pe=0,Ee=0,Oe=0;var _e=function(){function t(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];n(this,t),this.materials=0,this.materialIndices=e?new Uint8Array(Oe):null,this.runLengths=null,this.edgeData=null}return s(t,[{key:"set",value:function(t){return this.materials=t.materials,this.materialIndices=t.materialIndices,this.runLengths=t.runLengths,this.edgeData=t.edgeData,this}},{key:"clear",value:function(){return this.materials=0,this.materialIndices=null,this.runLengths=null,this.edgeData=null,this}},{key:"setMaterialIndex",value:function(t,e){this.materialIndices[t]===Ft.AIR?e!==Ft.AIR&&++this.materials:e===Ft.AIR&&--this.materials,this.materialIndices[t]=e}},{key:"compress",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,e=void 0;return this.compressed?(t.materialIndices=this.materialIndices,t.runLengths=this.runLengths):(e=this.full?new Rt([this.materialIndices.length],[Ft.SOLID]):Rt.encode(this.materialIndices),t.materialIndices=new Uint8Array(e.data),t.runLengths=new Uint32Array(e.runLengths)),t.materials=this.materials,t}},{key:"decompress",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return t.materialIndices=this.compressed?Rt.decode(this.runLengths,this.materialIndices,new Uint8Array(Oe)):this.materialIndices,t.runLengths=null,t.materials=this.materials,t}},{key:"serialize",value:function(){return{materials:this.materials,materialIndices:this.materialIndices,runLengths:this.runLengths,edgeData:null!==this.edgeData?this.edgeData.serialize():null}}},{key:"deserialize",value:function(t){var e=this;return null!==t?(this.materials=t.materials,this.materialIndices=t.materialIndices,this.runLengths=t.runLengths,null!==t.edgeData?(null===this.edgeData&&(this.edgeData=new Se),this.edgeData.deserialize(t.edgeData)):this.edgeData=null):e=null,e}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return null!==this.edgeData&&this.edgeData.createTransferList(t),null!==this.materialIndices&&t.push(this.materialIndices.buffer),null!==this.runLengths&&t.push(this.runLengths.buffer),t}},{key:"empty",get:function(){return 0===this.materials}},{key:"full",get:function(){return this.materials===Oe}},{key:"compressed",get:function(){return null!==this.runLengths}},{key:"neutered",get:function(){return!this.empty&&null===this.materialIndices}}],[{key:"isovalue",get:function(){return Pe},set:function(t){Pe=t}},{key:"resolution",get:function(){return Ee},set:function(t){Ee=Math.max(1,Math.min(256,(e=t,Math.pow(2,Math.max(0,Math.ceil(Math.log2(e)))))));var e;Oe=Math.pow(Ee+1,3)}}]),t}(),Ie=function(t){a(e,qt);function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Ut.DENSITY_FUNCTION));return i.sdf=t,i}return s(e,[{key:"computeBoundingBox",value:function(){return this.sdf.getBoundingBox(!0)}},{key:"generateMaterialIndex",value:function(t){return this.sdf.sample(t)<=_e.isovalue?this.sdf.material:Ft.AIR}},{key:"generateEdge",value:function(t){t.approximateZeroCrossing(this.sdf),t.computeSurfaceNormal(this.sdf)}}]),e}(),Te=new Z,De=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ft.SOLID;n(this,t),this.type=e,this.operation=null,this.material=Math.min(255,Math.max(Ft.SOLID,Math.trunc(i))),this.boundingBox=null,this.position=new p,this.quaternion=new D,this.scale=new p(1,1,1),this.inverseTransformation=new Z,this.updateInverseTransformation(),this.children=[]}return s(t,[{key:"getTransformation",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Z).compose(this.position,this.quaternion,this.scale)}},{key:"getBoundingBox",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.children,i=this.boundingBox,n=void 0,s=void 0;if(null===i&&(i=this.computeBoundingBox(),this.boundingBox=i),t)for(i=i.clone(),n=0,s=e.length;n<s;++n)i.union(e[n].getBoundingBox(t));return i}},{key:"setMaterial",value:function(t){return this.material=Math.min(255,Math.max(Ft.SOLID,Math.trunc(t))),this}},{key:"setOperationType",value:function(t){return this.operation=t,this}},{key:"updateInverseTransformation",value:function(){return this.inverseTransformation.getInverse(this.getTransformation(Te)),this.boundingBox=null,this}},{key:"union",value:function(t){return this.children.push(t.setOperationType(Ut.UNION)),this}},{key:"subtract",value:function(t){return this.children.push(t.setOperationType(Ut.DIFFERENCE)),this}},{key:"intersect",value:function(t){return this.children.push(t.setOperationType(Ut.INTERSECTION)),this}},{key:"toCSG",value:function(){var t=this.children,e=new Ie(this),i=void 0,n=void 0,s=void 0,r=void 0;for(s=0,r=t.length;s<r;++s){if(i!==(n=t[s]).operation)switch(i=n.operation){case Ut.UNION:e=new Lt(e);break;case Ut.DIFFERENCE:e=new Nt(e);break;case Ut.INTERSECTION:e=new Bt(e)}e.children.push(n.toCSG())}return e}},{key:"serialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e={type:this.type,operation:this.operation,material:this.material,position:this.position.toArray(),quaternion:this.quaternion.toArray(),scale:this.scale.toArray(),parameters:null,children:[]},i=void 0,n=void 0;for(i=0,n=this.children.length;i<n;++i)e.children.push(this.children[i].serialize(t));return e}},{key:"createTransferList",value:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}},{key:"toJSON",value:function(){return this.serialize(!0)}},{key:"computeBoundingBox",value:function(){throw new Error("SignedDistanceFunction#computeBoundingBox method not implemented!")}},{key:"sample",value:function(t){throw new Error("SignedDistanceFunction#sample method not implemented!")}}]),t}(),Ce={HEIGHTFIELD:"sdf.heightfield",FRACTAL_NOISE:"sdf.fractalnoise",SUPER_PRIMITIVE:"sdf.superprimitive"},Ue=function(t){a(e,De);function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments[1];n(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Ce.PERLIN_NOISE,i));return s.min=new(Function.prototype.bind.apply(p,[null].concat(h(t.min)))),s.max=new(Function.prototype.bind.apply(p,[null].concat(h(t.max)))),s}return s(e,[{key:"computeBoundingBox",value:function(){return this.bbox=new k(this.min,this.max),this.bbox}},{key:"sample",value:function(t){}},{key:"serialize",value:function(){var t=r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"serialize",this).call(this);return t.parameters={min:this.min.toArray(),max:this.max.toArray()},t}}]),e}();var Fe=function(t){a(e,De);function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments[1];n(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Ce.HEIGHTFIELD,i));return s.width=void 0!==t.width?t.width:1,s.height=void 0!==t.height?t.height:1,s.smooth=void 0===t.smooth||t.smooth,s.data=void 0!==t.data?t.data:null,s.heightmap=null,void 0!==t.image&&s.fromImage(t.image),s}return s(e,[{key:"fromImage",value:function(t){var e="undefined"==typeof document?null:function(t){var e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),i=e.getContext("2d");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height)}(t),i=null,n=void 0,s=void 0,r=void 0,a=void 0;if(null!==e){for(n=e.data,s=0,r=0,a=(i=new Uint8ClampedArray(n.length/4)).length;s<a;++s,r+=4)i[s]=n[r];this.heightmap=t,this.width=e.width,this.height=e.height,this.data=i}return this}},{key:"getHeight",value:function(t,e){var i=this.width,n=this.height,s=this.data,r=void 0;if(t=Math.round(t*i),e=Math.round(e*n),this.smooth){var a=(t=Math.max(Math.min(t,i-1),1))+1,o=t-1,h=(e=Math.max(Math.min(e,n-1),1))*i,u=h+i,l=h-i;r=(s[l+o]+s[l+t]+s[l+a]+s[h+o]+s[h+t]+s[h+a]+s[u+o]+s[u+t]+s[u+a])/9}else r=s[e*i+t];return r}},{key:"computeBoundingBox",value:function(){var t=new k,e=Math.min(this.width/this.height,1),i=Math.min(this.height/this.width,1);return t.min.set(0,0,0),t.max.set(e,1,i),t.applyMatrix4(this.getTransformation()),t}},{key:"sample",value:function(t){var e=this.boundingBox,i=void 0;return e.containsPoint(t)?(t.applyMatrix4(this.inverseTransformation),i=t.y-this.getHeight(t.x,t.z)/255):i=e.distanceToPoint(t),i}},{key:"serialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"serialize",this).call(this);return i.parameters={width:this.width,height:this.height,smooth:this.smooth,data:t?null:this.data,dataURL:t&&null!==this.heightmap?this.heightmap.toDataURL():null,image:null},i}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.push(this.data.buffer),t}}]),e}(),qe=function(t){a(e,De);function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments[1];n(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Ce.SUPER_PRIMITIVE,i));return s.s0=new(Function.prototype.bind.apply(et,[null].concat(h(t.s)))),s.r0=new(Function.prototype.bind.apply(p,[null].concat(h(t.r)))),s.s=new et,s.r=new p,s.ba=new M,s.offset=0,s.precompute(),s}return s(e,[{key:"setSize",value:function(t,e,i,n){return this.s0.set(t,e,i,n),this.precompute()}},{key:"setRadii",value:function(t,e,i){return this.r0.set(t,e,i),this.precompute()}},{key:"precompute",value:function(){var t=this.s.copy(this.s0),e=this.r.copy(this.r0),i=this.ba;t.x-=e.x,t.y-=e.x,e.x-=t.w,t.w-=e.y,t.z-=e.y,this.offset=-2*t.z,i.set(e.z,this.offset);var n=i.dot(i);return 0===n?i.set(0,-1):i.divideScalar(n),this}},{key:"computeBoundingBox",value:function(){var t=this.s0,e=new k;return e.min.x=Math.min(-t.x,-1),e.min.y=Math.min(-t.y,-1),e.min.z=Math.min(-t.z,-1),e.max.x=Math.max(t.x,1),e.max.y=Math.max(t.y,1),e.max.z=Math.max(t.z,1),e.applyMatrix4(this.getTransformation()),e}},{key:"sample",value:function(t){t.applyMatrix4(this.inverseTransformation);var e=this.s,i=this.r,n=this.ba,s=Math.abs(t.x)-e.x,r=Math.abs(t.y)-e.y,a=Math.abs(t.z)-e.z,o=Math.max(s,0),h=Math.max(r,0),u=Math.sqrt(o*o+h*h),l=t.z-e.z,c=Math.abs(u+Math.min(0,Math.max(s,r))-i.x)-e.w,d=Math.min(Math.max(c*n.x+l*n.y,0),1),y=c-i.z*d,v=l-this.offset*d,m=Math.max(c-i.z,0),f=t.z+e.z,g=Math.max(c,0),p=y*y+v*v,x=m*m+f*f,k=g*g+l*l,w=c*-n.y+l*n.x;return Math.sqrt(Math.min(p,Math.min(x,k)))*Math.sign(Math.max(w,a))-i.y}},{key:"serialize",value:function(){var t=r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"serialize",this).call(this);return t.parameters={s:this.s0.toArray(),r:this.r0.toArray()},t}}],[{key:"create",value:function(t){var i=Le[t];return new e({s:i[0],r:i[1]})}}]),e}(),Le=[[new Float32Array([1,1,1,1]),new Float32Array([0,0,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,0,0])],[new Float32Array([0,0,1,1]),new Float32Array([0,0,1])],[new Float32Array([1,1,2,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,.25,1]),new Float32Array([1,.25,0])],[new Float32Array([1,1,.25,.25]),new Float32Array([1,.25,0])],[new Float32Array([1,1,1,.25]),new Float32Array([1,.1,0])],[new Float32Array([1,1,1,.25]),new Float32Array([.1,.1,0])]],Ne={CUBE:0,CYLINDER:1,CONE:2,PILL:3,SPHERE:4,PELLET:5,TORUS:6,PIPE:7,CORRIDOR:8},Be=function(){function t(){n(this,t)}return s(t,[{key:"revive",value:function(t){var e=void 0,i=void 0,n=void 0;switch(t.type){case Ce.FRACTAL_NOISE:e=new Ue(t.parameters,t.material);break;case Ce.HEIGHTFIELD:e=new Fe(t.parameters,t.material);break;case Ce.SUPER_PRIMITIVE:e=new qe(t.parameters,t.material)}for(e.operation=t.operation,e.position.fromArray(t.position),e.quaternion.fromArray(t.quaternion),e.scale.fromArray(t.scale),e.updateInverseTransformation(),i=0,n=t.children.length;i<n;++i)e.children.push(this.revive(t.children[i]));return e}}]),t}(),Re=new(function(t){a(e,l);function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.descriptions=null,i}return e}())("load"),Ve=function(t){a(e,c);function e(){n(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.items=0,t.descriptions=null,t.imageMap=new WeakMap,t}return s(e,[{key:"clear",value:function(){this.imageMap=new WeakMap}},{key:"handleEvent",value:function(t){switch(t.type){case"load":this.progress(t)}}},{key:"progress",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=null!==t?t.target:null,i=this.imageMap;null!==e&&(i.has(e)&&(i.get(e).image=e),--this.items),0===this.items&&(this.clear(),Re.descriptions=this.descriptions,this.dispatchEvent(Re))}},{key:"loadImage",value:function(t){var e=new Image;this.imageMap.set(e,t),++this.items,e.addEventListener("load",this),e.src=t.dataURL}},{key:"inflate",value:function(t){var e=void 0;null!==t.dataURL&&this.loadImage(t);var i=!0,n=!1,s=void 0;try{for(var r,a=t.children[Symbol.iterator]();!(i=(r=a.next()).done);i=!0)e=r.value,this.inflate(e)}catch(t){n=!0,s=t}finally{try{!i&&a.return&&a.return()}finally{if(n)throw s}}this.progress()}},{key:"load",value:function(t){var e=void 0;this.items=0,this.descriptions=t;var i=!0,n=!1,s=void 0;try{for(var r,a=t[Symbol.iterator]();!(i=(r=a.next()).done);i=!0)e=r.value,this.inflate(e)}catch(t){n=!0,s=t}finally{try{!i&&a.return&&a.return()}finally{if(n)throw s}}}}]),e}(),je=function(){function t(){n(this,t)}return s(t,null,[{key:"parseBin",value:function(t){return parseInt(t,2)}},{key:"createBinaryString",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,i=t<0?"-":"",n=Math.abs(t).toString(2);n.length<e;)n="0"+n;return i+n}}]),t}(),Ye=function(){function t(e,i,s){n(this,t),this.keyDesign=e,this.min=i,this.max=s,this.keyBase=new p,this.key=new p,this.limit=new p,this.result=new Vt,this.reset()}return s(t,[{key:"reset",value:function(){var t=this.keyDesign,e=this.min,i=this.max;return e.x<=i.x&&e.y<=i.y&&e.z<=i.z?(this.keyBase.set(e.x,e.y*t.rangeX,e.z*t.rangeXY),this.limit.set(i.x,i.y*t.rangeX,i.z*t.rangeXY),this.key.copy(this.keyBase)):(this.keyBase.set(1,1,1),this.limit.set(0,0,0),this.key.copy(this.keyBase),console.error("Invalid key range",e,i)),this.result.reset(),this}},{key:"next",value:function(){var t=this.result,e=this.keyDesign,i=this.keyBase,n=this.limit,s=this.key;return s.z<=n.z?(t.value=s.z+s.y+s.x,++s.x,s.x>n.x&&(s.x=i.x,s.y+=e.rangeX,s.y>n.y&&(s.y=i.y,s.z+=e.rangeXY))):(t.value=null,t.done=!0),t}},{key:"return",value:function(t){return this.result.value=t,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),Xe=Math.pow(2,32),Ge=53,He=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.round(.4*Ge),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.round(.2*Ge),s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;n(this,t),this.x=0,this.y=0,this.z=0,this.rangeX=0,this.rangeY=0,this.rangeZ=0,this.rangeXY=0,this.halfRange=null,this.maskX=[0,0],this.maskY=[0,0],this.maskZ=[0,0],this.set(e,i,s)}return s(t,[{key:"set",value:function(t,e,i){(t+e+i>Ge||t>32||e>32||i>32)&&(console.warn("Invalid bit allotment"),t=Math.round(.4*Ge),e=Math.round(.2*Ge),i=t),this.x=t,this.y=e,this.z=i,this.rangeX=Math.pow(2,t),this.rangeY=Math.pow(2,e),this.rangeZ=Math.pow(2,i),this.rangeXY=Math.pow(2,t+e),this.halfRange=new p(this.rangeX/2,this.rangeY/2,this.rangeZ/2),this.updateBitMasks()}},{key:"updateBitMasks",value:function(){var t=this.x,e=this.y,i=this.z,n=this.maskX,s=this.maskY,r=this.maskZ,a=32-Math.max(0,t-32),o=32-Math.max(0,e+t-32),h=32-Math.max(0,i+e+t-32);n[1]=a<32?-1>>>a:0,n[0]=-1>>>Math.max(0,32-t),s[1]=((o<32?-1>>>o:0)&~n[1])>>>0,s[0]=(-1>>>Math.max(0,32-(t+e))&~n[0])>>>0,r[1]=((h<32?-1>>>h:0)&~s[1]&~n[1])>>>0,r[0]=(-1>>>Math.max(0,32-(t+e+i))&~s[0]&~n[0])>>>0}},{key:"unpackKey",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p,i=this.maskX,n=this.maskY,s=this.maskZ,r=Math.trunc(t/Xe),a=t%Xe;return e.set((r&i[1])*Xe+((a&i[0])>>>0),((r&n[1])*Xe+((a&n[0])>>>0))/this.rangeX,((r&s[1])*Xe+((a&s[0])>>>0))/this.rangeXY)}},{key:"packKey",value:function(t){return t.z*this.rangeXY+t.y*this.rangeX+t.x}},{key:"keyRange",value:function(t,e){return new Ye(this,t,e)}},{key:"toString",value:function(){var t=this.maskX,e=this.maskY,i=this.maskZ;return"Key Design\n\nX-Bits: "+this.x+"\nY-Bits: "+this.y+"\nZ-Bits: "+this.z+"\n\n"+je.createBinaryString(t[1],32)+" "+t[1]+" (HI-Mask X)\n"+je.createBinaryString(t[0],32)+" "+t[0]+" (LO-Mask X)\n\n"+je.createBinaryString(e[1],32)+" "+e[1]+" (HI-Mask Y)\n"+je.createBinaryString(e[0],32)+" "+e[0]+" (LO-Mask Y)\n\n"+je.createBinaryString(i[1],32)+" "+i[1]+" (HI-Mask Z)\n"+je.createBinaryString(i[0],32)+" "+i[0]+" (LO-Mask Z)\n"}}],[{key:"BITS",get:function(){return Ge}},{key:"HI_BITS",get:function(){return 21}},{key:"LO_BITS",get:function(){return 32}}]),t}(),We=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n(this,t),this.lod=e,this.key=i}return s(t,[{key:"set",value:function(t,e){this.lod=t,this.key=e}},{key:"copy",value:function(t){return this.lod=t.lod,this.key=t.key,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),Ke=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new We;n(this,t),this.octant=e,this.id=i,this.min=new p,this.max=new p}return s(t,[{key:"copy",value:function(t){return this.octant=t.octant,this.id.copy(t.id),this.min.copy(t.min),this.max.copy(t.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p).addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p).subVectors(this.max,this.min)}},{key:"containsPoint",value:function(t){var e=this.min,i=this.max;return t.x>=e.x&&t.y>=e.y&&t.z>=e.z&&t.x<=i.x&&t.y<=i.y&&t.z<=i.z}}]),t}(),Ze=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n(this,t),this.world=e,this.cellSize=0,this.iterator=null,this.octantWrapper=new Ke,this.octantWrapper.id.lod=i,this.result=new Vt,this.reset()}return s(t,[{key:"reset",value:function(){var t=this.octantWrapper.id.lod,e=this.world,i=e.getGrid(t);return void 0!==i?(this.cellSize=e.getCellSize(t),this.iterator=i.entries(),this.result.reset()):console.error("Invalid LOD",t),this}},{key:"next",value:function(){var t=this.result,e=this.octantWrapper,i=this.iterator.next(),n=i.value;return i.done?(t.value=null,t.done=!0):(this.keyDesign.unpackKey(n[0],e.min),e.min.multiplyScalar(this.cellSize).add(this.world.min),e.max.copy(e.min).addScalar(this.cellSize),e.id.key=n[0],e.octant=n[1],t.value=e),t}},{key:"return",value:function(t){return this.result.value=t,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),Qe=function t(){n(this,t),this.data=null,this.csg=new Ct,this.isosurface=null},Je=function(t){a(e,Qe);function e(){n(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.children=0,t}return e}(),$e=new p,ti=new p,ei=new k,ii=new k,ni=new k,si=[];function ri(t,e,i,n,s,r,a){var o=void 0,h=void 0,u=void 0,l=void 0,c=void 0,d=void 0;if(i.csg.add(e),a>0)for(--a,o=t.getGrid(a),h=t.getKeyDesign(),u=i.children,l=si[a],n<<=1,s<<=1,r<<=1,d=0;d<8;++d)0!=(u&1<<d)&&(c=Xt[d],$e.set(n+c[0],s+c[1],r+c[2]),l.containsPoint($e)&&ri(t,e,o.get(h.packKey($e)),$e.x,$e.y,$e.z,a))}var ai=function(){function t(){n(this,t)}return s(t,null,[{key:"applyUnion",value:function(t,e,i){var n=t.getKeyDesign(),s=t.lodZero,r=ii.min,a=ii.max,o=ni.min,h=ni.max,u=ni,l=void 0,c=void 0,d=void 0,y=void 0,v=void 0,m=void 0;for(v=t.getDepth();v>0;--v){d=t.getGrid(v),t.calculateKeyCoordinates(e.min,v,r),t.calculateKeyCoordinates(e.max,v,a),t.calculateKeyCoordinates(e.min,v-1,o),t.calculateKeyCoordinates(e.max,v-1,h);var f=!0,g=!1,p=void 0;try{for(var x,k=n.keyRange(r,a)[Symbol.iterator]();!(f=(x=k.next()).done);f=!0)if(l=x.value,!d.has(l))for((y=new Je).csg.add(i),d.set(l,y),n.unpackKey(l,ti),ti.x<<=1,ti.y<<=1,ti.z<<=1,m=0;m<8;++m)c=Xt[m],$e.set(ti.x+c[0],ti.y+c[1],ti.z+c[2]),u.containsPoint($e)&&(y.children|=1<<m)}catch(t){g=!0,p=t}finally{try{!f&&k.return&&k.return()}finally{if(g)throw p}}}t.calculateKeyCoordinates(e.min,0,r),t.calculateKeyCoordinates(e.max,0,a);var w=!0,z=!1,M=void 0;try{for(var b,A=n.keyRange(r,a)[Symbol.iterator]();!(w=(b=A.next()).done);w=!0)l=b.value,s.has(l)?y=s.get(l):(y=new Qe,s.set(l,y)),y.csg.add(i)}catch(t){z=!0,M=t}finally{try{!w&&A.return&&A.return()}finally{if(z)throw M}}}},{key:"applyDifference",value:function(t,e,i){var n=t.getDepth(),s=t.getKeyDesign(),r=t.getGrid(n),a=t.calculateKeyCoordinates(e.min,n,ii.min),o=t.calculateKeyCoordinates(e.max,n,ii.max),h=void 0,u=void 0,l=void 0,c=void 0;for(h=0,u=n-1;h<u;++h)h<si.length?(l=si[h],t.calculateKeyCoordinates(e.min,h,l.min),t.calculateKeyCoordinates(e.max,h,l.max)):si.push(new k(t.calculateKeyCoordinates(e.min,h),t.calculateKeyCoordinates(e.max,h)));var d=!0,y=!1,v=void 0;try{for(var m,f=s.keyRange(a,o)[Symbol.iterator]();!(d=(m=f.next()).done);d=!0)c=m.value,r.has(c)&&(s.unpackKey(c,ti),ri(t,i,r.get(c),ti.x,ti.y,ti.z,n))}catch(t){y=!0,v=t}finally{try{!d&&f.return&&f.return()}finally{if(y)throw v}}}},{key:"applyIntersection",value:function(t,e){var i=void 0;for(i=t.getDepth();i>=0;--i){var n=!0,s=!1,r=void 0;try{for(var a,o=t.getGrid(i).values()[Symbol.iterator]();!(n=(a=o.next()).done);n=!0)a.value.csg.add(e)}catch(t){s=!0,r=t}finally{try{!n&&o.return&&o.return()}finally{if(s)throw r}}}}},{key:"applyCSG",value:function(t,e){var i=ei.copy(e.getBoundingBox(!0));switch(i.min.max(t.min),i.max.min(t.max),e.operation){case Ut.UNION:this.applyUnion(t,i,e);break;case Ut.DIFFERENCE:this.applyDifference(t,i,e);break;case Ut.INTERSECTION:this.applyIntersection(t,e);break;default:console.error("No CSG operation type specified",e)}}}]),t}(),oi=new p,hi=new G,ui=new k,li=new k,ci=new J,di=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],yi=0;function vi(t,e,i,n){var s=void 0,r=0;return e<i?(s=e,r=0):(s=i,r=1),n<s&&(r=2),di[t][r]}function mi(t,e,i,n,s){var r=ui.min.set(0,0,0),a=ui.max.subVectors(e.max,e.min),o=e.getDimensions(li.min),h=li.max.copy(o).multiplyScalar(.5),u=ci.origin.copy(n.origin),l=ci.direction.copy(n.direction),c=void 0,d=void 0,y=void 0,v=void 0,m=void 0,f=void 0,g=void 0,p=void 0,x=void 0;u.sub(e.getCenter(oi)).add(h),yi=0,l.x<0&&(u.x=o.x-u.x,l.x=-l.x,yi|=4),l.y<0&&(u.y=o.y-u.y,l.y=-l.y,yi|=2),l.z<0&&(u.z=o.z-u.z,l.z=-l.z,yi|=1),c=1/l.x,d=1/l.y,y=1/l.z,v=(r.x-u.x)*c,m=(a.x-u.x)*c,f=(r.y-u.y)*d,g=(a.y-u.y)*d,p=(r.z-u.z)*y,x=(a.z-u.z)*y,function t(e,i,n,s,r,a,o,h,u,l,c,d,y){var v=void 0,m=void 0,f=void 0,g=void 0,p=void 0,x=void 0,k=void 0,w=void 0,z=void 0,M=void 0,b=void 0;if(l>=0&&c>=0&&d>=0)if(v=e.getKeyDesign(),0===a||null!==i.isosurface)m=e.getCellSize(a),(f=new Ke(i)).id.set(a,v.packKey(oi.set(n,s,r))),f.min.copy(oi).multiplyScalar(m).add(e.min),f.max.copy(f.min).addScalar(m),y.push(f);else if(i.children>0){g=e.getGrid(--a),p=i.children,n<<=1,s<<=1,r<<=1,k=function(t,e,i,n,s,r){var a=0;return t>e&&t>i?(s<t&&(a|=2),r<t&&(a|=1)):e>i?(n<e&&(a|=4),r<e&&(a|=1)):(n<i&&(a|=4),s<i&&(a|=2)),a}(o,h,u,w=.5*(o+l),z=.5*(h+c),M=.5*(u+d));do{switch(b=yi^k,k){case 0:0!=(p&1<<b)&&(x=Xt[b],oi.set(n+x[0],s+x[1],r+x[2]),t(e,g.get(v.packKey(oi)),oi.x,oi.y,oi.z,a,o,h,u,w,z,M,y)),k=vi(k,w,z,M);break;case 1:0!=(p&1<<b)&&(x=Xt[b],oi.set(n+x[0],s+x[1],r+x[2]),t(e,g.get(v.packKey(oi)),oi.x,oi.y,oi.z,a,o,h,M,w,z,d,y)),k=vi(k,w,z,d);break;case 2:0!=(p&1<<b)&&(x=Xt[b],oi.set(n+x[0],s+x[1],r+x[2]),t(e,g.get(v.packKey(oi)),oi.x,oi.y,oi.z,a,o,z,u,w,c,M,y)),k=vi(k,w,c,M);break;case 3:0!=(p&1<<b)&&(x=Xt[b],oi.set(n+x[0],s+x[1],r+x[2]),t(e,g.get(v.packKey(oi)),oi.x,oi.y,oi.z,a,o,z,M,w,c,d,y)),k=vi(k,w,c,d);break;case 4:0!=(p&1<<b)&&(x=Xt[b],oi.set(n+x[0],s+x[1],r+x[2]),t(e,g.get(v.packKey(oi)),oi.x,oi.y,oi.z,a,w,h,u,l,z,M,y)),k=vi(k,l,z,M);break;case 5:0!=(p&1<<b)&&(x=Xt[b],oi.set(n+x[0],s+x[1],r+x[2]),t(e,g.get(v.packKey(oi)),oi.x,oi.y,oi.z,a,w,h,M,l,z,d,y)),k=vi(k,l,z,d);break;case 6:0!=(p&1<<b)&&(x=Xt[b],oi.set(n+x[0],s+x[1],r+x[2]),t(e,g.get(v.packKey(oi)),oi.x,oi.y,oi.z,a,w,z,u,l,c,M,y)),k=vi(k,l,c,M);break;case 7:0!=(p&1<<b)&&(x=Xt[b],oi.set(n+x[0],s+x[1],r+x[2]),t(e,g.get(v.packKey(oi)),oi.x,oi.y,oi.z,a,w,z,M,l,c,d,y)),k=8}}while(k<8)}}(t,e.octant,i.x,i.y,i.z,t.getDepth(),v,f,p,m,g,x,s)}var fi=function(){function t(){n(this,t)}return s(t,null,[{key:"intersectWorldOctree",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=t.getDepth(),s=t.getGrid(n),r=t.getCellSize(n),a=t.getKeyDesign(),o=new Ke,h=hi.start,u=hi.end,l=t.containsPoint(ci.copy(e).origin)?ci.origin:ci.intersectBox(t,ci.origin),c=void 0,d=void 0,y=void 0,v=void 0,m=void 0,f=void 0,g=void 0,p=void 0,x=void 0,k=void 0,w=void 0,z=void 0,M=void 0,b=void 0,A=void 0,S=void 0,P=void 0,E=void 0,O=void 0,_=void 0;if(o.id.lod=n,null!==l)for(y=r<<1,v=ci.at(y,oi),t.calculateKeyCoordinates(l,n,h),t.calculateKeyCoordinates(v,n,u),f=u.x-h.x,g=u.y-h.y,p=u.z-h.z,A=Math.sign(f),S=Math.sign(g),P=Math.sign(p),z=2*(x=Math.abs(f)),M=2*(k=Math.abs(g)),b=2*(w=Math.abs(p)),E=k-x,O=w-x,_=k-w,m=x+k+w;m>0;--m)c=a.packKey(h),s.has(c)&&(d=s.get(c),o.id.key=c,o.octant=d,o.min.copy(h),o.min.multiplyScalar(r),o.min.add(t.min),o.max.copy(o.min).addScalar(r),null===d.isosurface?mi(t,o,h,e,i):i.push(o.clone())),E<0?O<0?(h.x+=A,E+=M,O+=b):(h.z+=P,O-=z,_+=M):_<0?(h.z+=P,O-=z,_+=M):(h.y+=S,E-=z,_-=b);return i}}]),t}(),gi=new p;var pi=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new He;for(n(this,t),i=Math.max(Math.min(Math.trunc(i),32),1),this.cellSize=Math.max(Math.min(Math.trunc(e),Math.pow(2,33-i)-1),1),this.keyDesign=s,this.grids=[];this.grids.length<i;)this.grids.push(new Map);this.bounds=new Ke,this.bounds.min.copy(this.keyDesign.halfRange).multiplyScalar(-this.cellSize),this.bounds.max.copy(this.keyDesign.halfRange).multiplyScalar(this.cellSize)}return s(t,[{key:"getKeyDesign",value:function(){return this.keyDesign}},{key:"getCellSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.cellSize<<t>>>0}},{key:"getCenter",value:function(t){return this.bounds.getCenter(t)}},{key:"setCenter",value:function(t){this.min.copy(this.keyDesign.halfRange).multiplyScalar(-this.cellSize).add(t),this.max.copy(this.keyDesign.halfRange).multiplyScalar(this.cellSize).add(t)}},{key:"getDimensions",value:function(t){return this.bounds.getDimensions(t)}},{key:"getDepth",value:function(){return this.grids.length-1}},{key:"getGrid",value:function(t){return t>=0&&t<this.grids.length?this.grids[t]:void 0}},{key:"clear",value:function(){var t=void 0,e=void 0;for(t=0,e=this.grids.length;t<e;++t)this.grids[t].clear()}},{key:"containsPoint",value:function(t){return this.bounds.containsPoint(t)}},{key:"findOctantsByLevel",value:function(t){return this.octants(t)}},{key:"calculateKeyCoordinates",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new p,n=this.cellSize<<e;return gi.subVectors(t,this.min),i.set(Math.trunc(gi.x/n),Math.trunc(gi.y/n),Math.trunc(gi.z/n)),i}},{key:"getOctantByPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.keyDesign,n=this.getGrid(e),s=void 0;return void 0!==n?this.containsPoint(t)?(this.calculateKeyCoordinates(t,e,gi),s=n.get(i.packKey(gi))):console.error("Position out of range",t):console.error("Invalid LOD",e),s}},{key:"removeOctant",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.keyDesign,n=this.getGrid(e),s=void 0,r=void 0,a=void 0;void 0!==n?n.has(t)?(i.unpackKey(t,gi),s=gi.x,r=gi.y,a=gi.z,function t(e,i,n,s,r,a){var o=void 0,h=void 0,u=void 0,l=void 0,c=void 0,d=void 0,y=void 0;if(a>0){for(--a,o=e.getGrid(a),h=e.getKeyDesign(),u=i.children,n<<=1,s<<=1,r<<=1,y=0;y<8;++y)0!=(u&1<<y)&&(c=Xt[y],gi.set(n+c[0],s+c[1],r+c[2]),d=h.packKey(gi),l=o.get(d),o.delete(d),t(e,l,gi.x,gi.y,gi.z,a));i.children=0}}(this,n.get(t),s,r,a,e),n.delete(t),function t(e,i,n,s,r){var a=void 0,o=void 0,h=void 0,u=void 0;++r<e.levels&&(a=e.getGrid(r),o=pi.calculateOffsetIndex(i,n,s),gi.set(i>>>1,n>>>1,s>>>1),h=e.getKeyDesign().packKey(gi),(u=a.get(h)).children&=~(1<<o),0===u.children&&(a.delete(h),t(e,gi.x,gi.y,gi.z,r)))}(this,s,r,a,e)):console.error("No octant found",t):console.error("Invalid LOD",e)}},{key:"applyCSG",value:function(t){ai.applyCSG(this,t)}},{key:"raycast",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return fi.intersectWorldOctree(this,t,e)}},{key:"octants",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Ze(this,t)}},{key:"min",get:function(){return this.bounds.min}},{key:"max",get:function(){return this.bounds.max}},{key:"levels",get:function(){return this.grids.length}},{key:"lodZero",get:function(){return this.grids[0]}}],[{key:"calculateOffsetIndex",value:function(t,e,i){return((1&t)<<2)+((1&e)<<1)+(1&i)}}]),t}(),xi=function(){function t(e){n(this,t)}return s(t,[{key:"clone",value:function(){return new this.constructor(this.levels)}},{key:"levels",get:function(){return this.something.length}}]),t}(),ki=function(t){a(e,l);function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.lod=-1,i.left=null,i.entered=null,i.error=null,i}return e}(),wi=(new ki("update"),new ki("error"),new k,new j),zi=new Z,Mi=function(t){a(e,c);function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.world=t,i.position=new p(1/0,1/0,1/0),i.currentScene=new xi(i.world.levels),i.previousScene=i.currentScene.clone(),i.nextScene=i.currentScene.clone(),i}return s(e,[{key:"update",value:function(t){this.position.copy(t.position),wi.setFromMatrix(zi.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse))}},{key:"process",value:function(){}},{key:"clear",value:function(){this.previousScene.clear(),this.currentScene.clear(),this.nextScene.clear()}}]),e}(),bi={EXTRACT:"worker.extract",MODIFY:"worker.modify",CONFIGURE:"worker.config",CLOSE:"worker.close"},Ai=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;n(this,t),this.action=e,this.error=null},Si=function(t){a(e,Ai);function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.data=null,i}return e}(),Pi=(function(t){a(e,Si);function e(){return n(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,bi.EXTRACT))}}(),function(t){a(e,Si);function e(){n(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,bi.MODIFY));return t.sdf=null,t.cellSize=0,t.cellPosition=null,t}}(),function(t){a(e,Ai);function e(){n(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,bi.CONFIGURE));return t.resolution=_e.resolution,t.errorThreshold=.01,t}return e}()),Ei=function(t){a(e,Si);function e(){n(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,bi.EXTRACT));return t.isosurface=null,t}return e}(),Oi=function(t){a(e,Si);function e(){n(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,bi.MODIFY));return t.sdf=null,t}return e}(),_i=new(function(t){a(e,l);function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.worker=null,i.response=null,i}return e}())("message"),Ii='!function(){"use strict";var t=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},i=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}(),e=function t(i,e,n){null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,e);if(void 0===s){var r=Object.getPrototypeOf(i);return null===r?void 0:t(r,e,n)}if("value"in s)return s.value;var a=s.get;if(void 0!==a)return a.call(n)},n=function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)},s=function(t,i){if(!t)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i},r=function(t){if(Array.isArray(t)){for(var i=0,e=Array(t.length);i<t.length;i++)e[i]=t[i];return e}return Array.from(t)},a=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t(this,e),this.runLengths=i,this.data=n}return i(e,null,[{key:"encode",value:function(t){var i=[],n=[],s=t[0],r=1,a=void 0,o=void 0;for(a=1,o=t.length;a<o;++a)s!==t[a]?(i.push(r),n.push(s),s=t[a],r=1):++r;return i.push(r),n.push(s),new e(i,n)}},{key:"decode",value:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=void 0,s=void 0,r=void 0,a=void 0,o=void 0,h=0;for(s=0,a=i.length;s<a;++s)for(n=i[s],r=0,o=t[s];r<o;++r)e[h++]=n;return e}}]),e}(),o=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.x=i,this.y=n,this.z=s}return i(e,[{key:"set",value:function(t,i,e){return this.x=t,this.y=i,this.z=e,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}},{key:"setFromSpherical",value:function(t){var i=Math.sin(t.phi)*t.radius;return this.x=i*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=i*Math.cos(t.theta),this}},{key:"setFromCylindrical",value:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this}},{key:"setFromMatrixColumn",value:function(t,i){return this.fromArray(t.elements,4*i)}},{key:"setFromMatrixPosition",value:function(t){var i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}},{key:"setFromMatrixScale",value:function(t){var i=this.setFromMatrixColumn(t,0).length(),e=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=e,this.z=n,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}},{key:"addScaledVector",value:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"multiplyVectors",value:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this.z/=t,this}},{key:"crossVectors",value:function(t,i){var e=t.x,n=t.y,s=t.z,r=i.x,a=i.y,o=i.z;return this.x=n*o-s*a,this.y=s*r-e*o,this.z=e*a-n*r,this}},{key:"cross",value:function(t){return this.crossVectors(this,t)}},{key:"transformDirection",value:function(t){var i=this.x,e=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[4]*e+s[8]*n,this.y=s[1]*i+s[5]*e+s[9]*n,this.z=s[2]*i+s[6]*e+s[10]*n,this.normalize()}},{key:"applyMatrix3",value:function(t){var i=this.x,e=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[3]*e+s[6]*n,this.y=s[1]*i+s[4]*e+s[7]*n,this.z=s[2]*i+s[5]*e+s[8]*n,this}},{key:"applyMatrix4",value:function(t){var i=this.x,e=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[4]*e+s[8]*n+s[12],this.y=s[1]*i+s[5]*e+s[9]*n+s[13],this.z=s[2]*i+s[6]*e+s[10]*n+s[14],this}},{key:"applyQuaternion",value:function(t){var i=this.x,e=this.y,n=this.z,s=t.x,r=t.y,a=t.z,o=t.w,h=o*i+r*n-a*e,u=o*e+a*i-s*n,l=o*n+s*e-r*i,c=-s*i-r*e-a*n;return this.x=h*o+c*-s+u*-a-l*-r,this.y=u*o+c*-r+l*-s-h*-a,this.z=l*o+c*-a+h*-r-u*-s,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"reflect",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e;var i=t.x,n=t.y,s=t.z;return this.sub(t.multiplyScalar(2*this.dot(t))),t.set(i,n,s),this}},{key:"angleTo",value:function(t){var i=this.dot(t)/Math.sqrt(this.lengthSquared()*t.lengthSquared());return Math.acos(Math.min(Math.max(i,-1),1))}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}},{key:"distanceToSquared",value:function(t){var i=this.x-t.x,e=this.y-t.y,n=this.z-t.z;return i*i+e*e+n*n}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clamp",value:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"lerp",value:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}},{key:"lerpVectors",value:function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}}]),e}(),h=new o,u=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o(1/0,1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o(-1/0,-1/0,-1/0);t(this,e),this.min=i,this.max=n}return i(e,[{key:"set",value:function(t,i){return this.min.copy(t),this.max.copy(i),this}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new c;return this.getCenter(t.center),t.radius=.5*this.getSize(h).length(),t}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"setFromPoints",value:function(t){var i=void 0,e=void 0;for(this.min.set(0,0,0),this.max.set(0,0,0),i=0,e=t.length;i<e;++i)this.expandByPoint(t[i]);return this}},{key:"setFromCenterAndSize",value:function(t,i){var e=h.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(e),this.max.copy(t).add(e),this}},{key:"clampPoint",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o).copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return h.copy(t).clamp(this.min,this.max).sub(t).length()}},{key:"applyMatrix4",value:function(t){var i=this.min,e=this.max;if(!this.isEmpty()){var n=t.elements,s=n[0]*i.x,r=n[1]*i.x,a=n[2]*i.x,o=n[0]*e.x,h=n[1]*e.x,u=n[2]*e.x,l=n[4]*i.y,c=n[5]*i.y,y=n[6]*i.y,v=n[4]*e.y,d=n[5]*e.y,f=n[6]*e.y,m=n[8]*i.z,x=n[9]*i.z,p=n[10]*i.z,g=n[8]*e.z,k=n[9]*e.z,w=n[10]*e.z;i.x=Math.min(s,o)+Math.min(l,v)+Math.min(m,g)+n[12],i.y=Math.min(r,h)+Math.min(c,d)+Math.min(x,k)+n[13],i.z=Math.min(a,u)+Math.min(y,f)+Math.min(p,w)+n[14],e.x=Math.max(s,o)+Math.max(l,v)+Math.max(m,g)+n[12],e.y=Math.max(r,h)+Math.max(c,d)+Math.max(x,k)+n[13],e.z=Math.max(a,u)+Math.max(y,f)+Math.max(p,w)+n[14]}return this}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"containsPoint",value:function(t){var i=this.min,e=this.max;return t.x>=i.x&&t.y>=i.y&&t.z>=i.z&&t.x<=e.x&&t.y<=e.y&&t.z<=e.z}},{key:"containsBox",value:function(t){var i=this.min,e=this.max,n=t.min,s=t.max;return i.x<=n.x&&s.x<=e.x&&i.y<=n.y&&s.y<=e.y&&i.z<=n.z&&s.z<=e.z}},{key:"intersectsBox",value:function(t){var i=this.min,e=this.max,n=t.min,s=t.max;return s.x>=i.x&&s.y>=i.y&&s.z>=i.z&&n.x<=e.x&&n.y<=e.y&&n.z<=e.z}},{key:"intersectsSphere",value:function(t){return this.clampPoint(t.center,h).distanceToSquared(t.center)<=t.radius*t.radius}},{key:"intersectsPlane",value:function(t){var i=void 0,e=void 0;return t.normal.x>0?(i=t.normal.x*this.min.x,e=t.normal.x*this.max.x):(i=t.normal.x*this.max.x,e=t.normal.x*this.min.x),t.normal.y>0?(i+=t.normal.y*this.min.y,e+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,e+=t.normal.y*this.min.y),t.normal.z>0?(i+=t.normal.z*this.min.z,e+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,e+=t.normal.z*this.min.z),i<=t.constant&&e>=t.constant}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}]),e}(),l=new u,c=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.center=i,this.radius=n}return i(e,[{key:"set",value:function(t,i){return this.center.copy(t),this.radius=i,this}},{key:"copy",value:function(t){return this.center.copy(t.center),this.radius=t.radius,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromPoints",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.setFromPoints(t).getCenter(this.center),e=0,n=void 0,s=void 0;for(n=0,s=t.length;n<s;++n)e=Math.max(e,i.distanceToSquared(t[n]));return this.radius=Math.sqrt(e),this}},{key:"getBoundingBox",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new u;return t.set(this.center,this.center),t.expandByScalar(this.radius),t}},{key:"isEmpty",value:function(){return this.radius<=0}},{key:"translate",value:function(t){return this.center.add(t),this}},{key:"clampPoint",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o,e=this.center.distanceToSquared(t);return i.copy(t),e>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}},{key:"distanceToPoint",value:function(t){return t.distanceTo(this.center)-this.radius}},{key:"containsPoint",value:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"intersectsSphere",value:function(t){var i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i}},{key:"intersectsBox",value:function(t){return t.intersectsSphere(this)}},{key:"intersectsPlane",value:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}},{key:"equals",value:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}]),e}(),y=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.x=i,this.y=n}return i(e,[{key:"set",value:function(t,i){return this.x=t,this.y=i,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[i],this.y=t[i+1],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.x,t[i+1]=this.y,t}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this}},{key:"addVectors",value:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}},{key:"addScaledVector",value:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this}},{key:"subVectors",value:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this}},{key:"applyMatrix3",value:function(t){var i=this.x,e=this.y,n=t.elements;return this.x=n[0]*i+n[3]*e+n[6],this.y=n[1]*i+n[4]*e+n[7],this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}},{key:"distanceToSquared",value:function(t){var i=this.x-t.x,e=this.y-t.y;return i*i+e*e}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}},{key:"clamp",value:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"angle",value:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t}},{key:"lerp",value:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}},{key:"lerpVectors",value:function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t)}},{key:"rotateAround",value:function(t,i){var e=Math.cos(i),n=Math.sin(i),s=this.x-t.x,r=this.y-t.y;return this.x=s*e-r*n+t.x,this.y=s*n+r*e+t.y,this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y}},{key:"width",get:function(){return this.x},set:function(t){return this.x=t}},{key:"height",get:function(){return this.y},set:function(t){return this.y=t}}]),e}(),v=new y,d=(function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new y(1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y(-1/0,-1/0);t(this,e),this.min=i,this.max=n}i(e,[{key:"set",value:function(t,i){return this.min.copy(t),this.max.copy(i),this}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new y;return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new y;return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new c;return this.getCenter(t.center),t.radius=.5*this.getSize(v).length(),t}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"setFromPoints",value:function(t){var i=void 0,e=void 0;for(this.min.set(0,0),this.max.set(0,0),i=0,e=t.length;i<e;++i)this.expandByPoint(t[i]);return this}},{key:"setFromCenterAndSize",value:function(t,i){var e=v.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(e),this.max.copy(t).add(e),this}},{key:"clampPoint",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y).copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return v.copy(t).clamp(this.min,this.max).sub(t).length()}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"containsPoint",value:function(t){var i=this.min,e=this.max;return t.x>=i.x&&t.y>=i.y&&t.x<=e.x&&t.y<=e.y}},{key:"containsBox",value:function(t){var i=this.min,e=this.max,n=t.min,s=t.max;return i.x<=n.x&&s.x<=e.x&&i.y<=n.y&&s.y<=e.y}},{key:"intersectsBox",value:function(t){var i=this.min,e=this.max,n=t.min,s=t.max;return s.x>=i.x&&s.y>=i.y&&n.x<=e.x&&n.y<=e.y}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}])}(),function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.radius=i,this.theta=n,this.y=s}i(e,[{key:"set",value:function(t,i,e){return this.radius=t,this.theta=i,this.y=e,this}},{key:"copy",value:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromVector3",value:function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this}}])}(),function(){function e(){t(this,e),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return i(e,[{key:"set",value:function(t,i,e,n,s,r,a,o,h){var u=this.elements;return u[0]=t,u[3]=i,u[6]=e,u[1]=n,u[4]=s,u[7]=r,u[2]=a,u[5]=o,u[8]=h,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(t){var i=t.elements,e=this.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=this.elements,n=void 0;for(n=0;n<9;++n)e[n]=t[n+i];return this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=this.elements,n=void 0;for(n=0;n<9;++n)t[n+i]=e[n];return t}},{key:"multiplyMatrices",value:function(t,i){var e=t.elements,n=i.elements,s=this.elements,r=e[0],a=e[3],o=e[6],h=e[1],u=e[4],l=e[7],c=e[2],y=e[5],v=e[8],d=n[0],f=n[3],m=n[6],x=n[1],p=n[4],g=n[7],k=n[2],w=n[5],z=n[8];return s[0]=r*d+a*x+o*k,s[3]=r*f+a*p+o*w,s[6]=r*m+a*g+o*z,s[1]=h*d+u*x+l*k,s[4]=h*f+u*p+l*w,s[7]=h*m+u*g+l*z,s[2]=c*d+y*x+v*k,s[5]=c*f+y*p+v*w,s[8]=c*m+y*g+v*z,this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyScalar",value:function(t){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this}},{key:"determinant",value:function(){var t=this.elements,i=t[0],e=t[1],n=t[2],s=t[3],r=t[4],a=t[5],o=t[6],h=t[7],u=t[8];return i*r*u-i*a*h-e*s*u+e*a*o+n*s*h-n*r*o}},{key:"getInverse",value:function(t){var i=t.elements,e=this.elements,n=i[0],s=i[1],r=i[2],a=i[3],o=i[4],h=i[5],u=i[6],l=i[7],c=i[8],y=c*o-h*l,v=h*u-c*a,d=l*a-o*u,f=n*y+s*v+r*d,m=void 0;return 0!==f?(m=1/f,e[0]=y*m,e[1]=(r*l-c*s)*m,e[2]=(h*s-r*o)*m,e[3]=v*m,e[4]=(c*n-r*u)*m,e[5]=(r*a-h*n)*m,e[6]=d*m,e[7]=(s*u-l*n)*m,e[8]=(o*n-s*a)*m):(console.error("Can\'t invert matrix, determinant is zero",t),this.identity()),this}},{key:"transpose",value:function(){var t=this.elements,i=void 0;return i=t[1],t[1]=t[3],t[3]=i,i=t[2],t[2]=t[6],t[6]=i,i=t[5],t[5]=t[7],t[7]=i,this}},{key:"scale",value:function(t,i){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=i,e[4]*=i,e[7]*=i,this}},{key:"rotate",value:function(t){var i=Math.cos(t),e=Math.sin(t),n=this.elements,s=n[0],r=n[3],a=n[6],o=n[1],h=n[4],u=n[7];return n[0]=i*s+e*o,n[3]=i*r+e*h,n[6]=i*a+e*u,n[1]=-e*s+i*o,n[4]=-e*r+i*h,n[7]=-e*a+i*u,this}},{key:"translate",value:function(t,i){var e=this.elements;return e[0]+=t*e[2],e[3]+=t*e[5],e[6]+=t*e[8],e[1]+=i*e[2],e[4]+=i*e[5],e[7]+=i*e[8],this}},{key:"equals",value:function(t){var i=this.elements,e=t.elements,n=!0,s=void 0;for(s=0;n&&s<9;++s)i[s]!==e[s]&&(n=!1);return n}}]),e}()),f="XYZ",m="YZX",x="ZXY",p="XZY",g="YXZ",k="ZYX",w=new o,z=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t(this,e),this.x=i,this.y=n,this.z=s,this.w=r}return i(e,[{key:"set",value:function(t,i,e,n){return this.x=t,this.y=i,this.z=e,this.w=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}},{key:"setFromEuler",value:function(t){var i=t.x,e=t.y,n=t.z,s=Math.cos,r=Math.sin,a=s(i/2),o=s(e/2),h=s(n/2),u=r(i/2),l=r(e/2),c=r(n/2);switch(t.order){case f:this.x=u*o*h+a*l*c,this.y=a*l*h-u*o*c,this.z=a*o*c+u*l*h,this.w=a*o*h-u*l*c;break;case g:this.x=u*o*h+a*l*c,this.y=a*l*h-u*o*c,this.z=a*o*c-u*l*h,this.w=a*o*h+u*l*c;break;case x:this.x=u*o*h-a*l*c,this.y=a*l*h+u*o*c,this.z=a*o*c+u*l*h,this.w=a*o*h-u*l*c;break;case k:this.x=u*o*h-a*l*c,this.y=a*l*h+u*o*c,this.z=a*o*c-u*l*h,this.w=a*o*h+u*l*c;break;case m:this.x=u*o*h+a*l*c,this.y=a*l*h+u*o*c,this.z=a*o*c-u*l*h,this.w=a*o*h-u*l*c;break;case p:this.x=u*o*h-a*l*c,this.y=a*l*h-u*o*c,this.z=a*o*c+u*l*h,this.w=a*o*h+u*l*c}return this}},{key:"setFromAxisAngle",value:function(t,i){var e=i/2,n=Math.sin(e);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(e),this}},{key:"setFromRotationMatrix",value:function(t){var i=t.elements,e=i[0],n=i[4],s=i[8],r=i[1],a=i[5],o=i[9],h=i[2],u=i[6],l=i[10],c=e+a+l,y=void 0;return c>0?(y=.5/Math.sqrt(c+1),this.w=.25/y,this.x=(u-o)*y,this.y=(s-h)*y,this.z=(r-n)*y):e>a&&e>l?(y=2*Math.sqrt(1+e-a-l),this.w=(u-o)/y,this.x=.25*y,this.y=(n+r)/y,this.z=(s+h)/y):a>l?(y=2*Math.sqrt(1+a-e-l),this.w=(s-h)/y,this.x=(n+r)/y,this.y=.25*y,this.z=(o+u)/y):(y=2*Math.sqrt(1+l-e-a),this.w=(r-n)/y,this.x=(s+h)/y,this.y=(o+u)/y,this.z=.25*y),this}},{key:"setFromUnitVectors",value:function(t,i){var e=t.dot(i)+1;return e<1e-6?(e=0,Math.abs(t.x)>Math.abs(t.z)?w.set(-t.y,t.x,0):w.set(0,-t.z,t.y)):w.crossVectors(t,i),this.x=w.x,this.y=w.y,this.z=w.z,this.w=e,this.normalize()}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"normalize",value:function(){var t=this.length(),i=void 0;return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(i=1/t,this.x=this.x*i,this.y=this.y*i,this.z=this.z*i,this.w=this.w*i),this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"multiplyQuaternions",value:function(t,i){var e=t.x,n=t.y,s=t.z,r=t.w,a=i.x,o=i.y,h=i.z,u=i.w;return this.x=e*u+r*a+n*h-s*o,this.y=n*u+r*o+s*a-e*h,this.z=s*u+r*h+e*o-n*a,this.w=r*u-e*a-n*o-s*h,this}},{key:"multiply",value:function(t){return this.multiplyQuaternions(this,t)}},{key:"premultiply",value:function(t){return this.multiplyQuaternions(t,this)}},{key:"slerp",value:function(t,i){var e=this.x,n=this.y,s=this.z,r=this.w,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0;if(1===i)this.copy(t);else if(i>0){if((a=r*t.w+e*t.x+n*t.y+s*t.z)<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,a=-a):this.copy(t),a>=1)return this.w=r,this.x=e,this.y=n,this.z=s,this;if(o=Math.sqrt(1-a*a),Math.abs(o)<.001)return this.w=.5*(r+this.w),this.x=.5*(e+this.x),this.y=.5*(n+this.y),this.z=.5*(s+this.z),this;h=Math.atan2(o,a),u=Math.sin((1-i)*h)/o,l=Math.sin(i*h)/o,this.w=r*u+this.w*l,this.x=e*u+this.x*l,this.y=n*u+this.y*l,this.z=s*u+this.z*l}return this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}}],[{key:"slerp",value:function(t,i,e,n){return e.copy(t).slerp(i,n)}},{key:"slerpFlat",value:function(t,i,e,n,s,r,a){var o=s[r],h=s[r+1],u=s[r+2],l=s[r+3],c=e[n],y=e[n+1],v=e[n+2],d=e[n+3],f=void 0,m=void 0,x=void 0,p=void 0,g=void 0,k=void 0,w=void 0,z=void 0;d===l&&c===o&&y===h&&v===u||(f=1-a,k=(p=c*o+y*h+v*u+d*l)>=0?1:-1,(g=1-p*p)>Number.EPSILON&&(x=Math.sqrt(g),w=Math.atan2(x,p*k),f=Math.sin(f*w)/x,a=Math.sin(a*w)/x),c=c*f+o*(z=a*k),y=y*f+h*z,v=v*f+u*z,d=d*f+l*z,f===1-a&&(c*=m=1/Math.sqrt(c*c+y*y+v*v+d*d),y*=m,v*=m,d*=m)),t[i]=c,t[i+1]=y,t[i+2]=v,t[i+3]=d}}]),e}();function M(t,i,e){return Math.max(Math.min(t,e),i)}var b=new d,A=new z,S=(function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.x=i,this.y=n,this.z=s,this.order=e.defaultOrder}i(e,[{key:"set",value:function(t,i,e,n){return this.x=t,this.y=i,this.z=e,this.order=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.order=t[i+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.order,t}},{key:"toVector3",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o).set(this.x,this.y,this.z)}},{key:"setFromRotationMatrix",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.order,e=t.elements,n=e[0],s=e[4],r=e[8],a=e[1],o=e[5],h=e[9],u=e[2],l=e[6],c=e[10];switch(i){case f:this.y=Math.asin(M(r,-1,1)),Math.abs(r)<.99999?(this.x=Math.atan2(-h,c),this.z=Math.atan2(-s,n)):(this.x=Math.atan2(l,o),this.z=0);break;case g:this.x=Math.asin(-M(h,-1,1)),Math.abs(h)<.99999?(this.y=Math.atan2(r,c),this.z=Math.atan2(a,o)):(this.y=Math.atan2(-u,n),this.z=0);break;case x:this.x=Math.asin(M(l,-1,1)),Math.abs(l)<.99999?(this.y=Math.atan2(-u,c),this.z=Math.atan2(-s,o)):(this.y=0,this.z=Math.atan2(a,n));break;case k:this.y=Math.asin(-M(u,-1,1)),Math.abs(u)<.99999?(this.x=Math.atan2(l,c),this.z=Math.atan2(a,n)):(this.x=0,this.z=Math.atan2(-s,o));break;case m:this.z=Math.asin(M(a,-1,1)),Math.abs(a)<.99999?(this.x=Math.atan2(-h,o),this.y=Math.atan2(-u,n)):(this.x=0,this.y=Math.atan2(r,c));break;case p:this.z=Math.asin(-M(s,-1,1)),Math.abs(s)<.99999?(this.x=Math.atan2(l,o),this.y=Math.atan2(r,n)):(this.x=Math.atan2(-h,c),this.y=0)}return this.order=i,this}},{key:"setFromQuaternion",value:function(t,i){return b.makeRotationFromQuaternion(t),this.setFromRotationMatrix(b,i)}},{key:"setFromVector3",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(t.x,t.y,t.z,i)}},{key:"reorder",value:function(t){return A.setFromEuler(this),this.setFromQuaternion(A,t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order}}],[{key:"defaultOrder",get:function(){return f}}])}(),new o),T=new o,P=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o(1,0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.normal=i,this.constant=n}return i(e,[{key:"set",value:function(t,i){return this.normal.copy(t),this.constant=i,this}},{key:"setComponents",value:function(t,i,e,n){return this.normal.set(t,i,e),this.constant=n,this}},{key:"copy",value:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromNormalAndCoplanarPoint",value:function(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(t,i,e){var n=S.subVectors(e,i).cross(T.subVectors(t,i)).normalize();return this.setFromNormalAndCoplanarPoint(n,S),this}},{key:"normalize",value:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}},{key:"negate",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:"distanceToPoint",value:function(t){return this.normal.dot(t)+this.constant}},{key:"distanceToSphere",value:function(t){return this.distanceToPoint(t.center)-t.radius}},{key:"projectPoint",value:function(t,i){return i.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}},{key:"coplanarPoint",value:function(t){return t.copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(t){return this.constant-=t.dot(this.normal),this}},{key:"intersectLine",value:function(t,i){var e=t.delta(S),n=this.normal.dot(e);if(0===n)0===this.distanceToPoint(t.start)&&i.copy(t.start);else{var s=-(t.start.dot(this.normal)+this.constant)/n;s>=0&&s<=1&&i.copy(e).multiplyScalar(s).add(t.start)}return i}},{key:"intersectsLine",value:function(t){var i=this.distanceToPoint(t.start),e=this.distanceToPoint(t.end);return i<0&&e>0||e<0&&i>0}},{key:"intersectsBox",value:function(t){return t.intersectsPlane(this)}},{key:"intersectsSphere",value:function(t){return t.intersectsPlane(this)}},{key:"equals",value:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}]),e}(),I=new o,O=new o,_=(function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new P,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new P,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new P;t(this,e),this.planes=[i,n,s,r,a,o]}i(e,[{key:"set",value:function(t,i,e,n,s,r){var a=this.planes;return a[0].copy(t),a[1].copy(i),a[2].copy(e),a[3].copy(n),a[4].copy(s),a[5].copy(r),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){var i=this.planes,e=void 0;for(e=0;e<6;++e)i[e].copy(t.planes[e]);return this}},{key:"setFromMatrix",value:function(t){var i=this.planes,e=t.elements,n=e[0],s=e[1],r=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],y=e[9],v=e[10],d=e[11],f=e[12],m=e[13],x=e[14],p=e[15];return i[0].setComponents(a-n,l-o,d-c,p-f).normalize(),i[1].setComponents(a+n,l+o,d+c,p+f).normalize(),i[2].setComponents(a+s,l+h,d+y,p+m).normalize(),i[3].setComponents(a-s,l-h,d-y,p-m).normalize(),i[4].setComponents(a-r,l-u,d-v,p-x).normalize(),i[5].setComponents(a+r,l+u,d+v,p+x).normalize(),this}},{key:"intersectsSphere",value:function(t){var i=this.planes,e=t.center,n=-t.radius,s=!0,r=void 0;for(r=0;r<6;++r)if(i[r].distanceToPoint(e)<n){s=!1;break}return s}},{key:"intersectsBox",value:function(t){var i=this.planes,e=t.min,n=t.max,s=!0,r=void 0,a=void 0,o=void 0,h=void 0;for(r=0;r<6;++r)if(h=i[r],I.x=h.normal.x>0?e.x:n.x,O.x=h.normal.x>0?n.x:e.x,I.y=h.normal.y>0?e.y:n.y,O.y=h.normal.y>0?n.y:e.y,I.z=h.normal.z>0?e.z:n.z,O.z=h.normal.z>0?n.z:e.z,a=h.distanceToPoint(I),o=h.distanceToPoint(O),a<0&&o<0){s=!1;break}return s}},{key:"containsPoint",value:function(t){var i=this.planes,e=!0,n=void 0;for(n=0;n<6;++n)if(i[n].distanceToPoint(t)<0){e=!1;break}return e}}])}(),new o),C=new o,U=(function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o;t(this,e),this.start=i,this.end=n}i(e,[{key:"set",value:function(t,i){return this.start.copy(t),this.end.copy(i),this}},{key:"copy",value:function(t){return this.start.copy(t.start),this.end.copy(t.end),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o).addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o).subVectors(this.end,this.start)}},{key:"lengthSquared",value:function(){return this.start.distanceToSquared(this.end)}},{key:"length",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(t,i){return this.delta(i).multiplyScalar(t).add(this.start)}},{key:"closestPointToPointParameter",value:function(t,i){_.subVectors(t,this.start),C.subVectors(this.end,this.start);var e=C.dot(C),n=C.dot(_);return i?Math.min(Math.max(n/e,0),1):n/e}},{key:"closestPointToPoint",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o,n=this.closestPointToPointParameter(t,i);return this.delta(e).multiplyScalar(n).add(this.start)}},{key:"equals",value:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}])}(),new o),q=new o,F=new o,E=function(){function e(){t(this,e),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return i(e,[{key:"set",value:function(t,i,e,n,s,r,a,o,h,u,l,c,y,v,d,f){var m=this.elements;return m[0]=t,m[4]=i,m[8]=e,m[12]=n,m[1]=s,m[5]=r,m[9]=a,m[13]=o,m[2]=h,m[6]=u,m[10]=l,m[14]=c,m[3]=y,m[7]=v,m[11]=d,m[15]=f,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"copy",value:function(t){var i=t.elements,e=this.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=this.elements,n=void 0;for(n=0;n<16;++n)e[n]=t[n+i];return this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=this.elements,n=void 0;for(n=0;n<16;++n)t[n+i]=e[n];return t}},{key:"getMaxScaleOnAxis",value:function(){var t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],e=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,e,n))}},{key:"copyPosition",value:function(t){var i=this.elements,e=t.elements;return i[12]=e[12],i[13]=e[13],i[14]=e[14],this}},{key:"setPosition",value:function(t){var i=this.elements;return i[12]=t.x,i[13]=t.y,i[14]=t.z,this}},{key:"extractBasis",value:function(t,i,e){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),e.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(t,i,e){return this.set(t.x,i.x,e.x,0,t.y,i.y,e.y,0,t.z,i.z,e.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(t){var i=this.elements,e=t.elements,n=1/U.setFromMatrixColumn(t,0).length(),s=1/U.setFromMatrixColumn(t,1).length(),r=1/U.setFromMatrixColumn(t,2).length();return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=0,i[4]=e[4]*s,i[5]=e[5]*s,i[6]=e[6]*s,i[7]=0,i[8]=e[8]*r,i[9]=e[9]*r,i[10]=e[10]*r,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}},{key:"makeRotationFromEuler",value:function(t){var i=this.elements,e=t.x,n=t.y,s=t.z,r=Math.cos(e),a=Math.sin(e),o=Math.cos(n),h=Math.sin(n),u=Math.cos(s),l=Math.sin(s),c=void 0,y=void 0,v=void 0,d=void 0,w=void 0,z=void 0,M=void 0,b=void 0,A=void 0,S=void 0,T=void 0,P=void 0;switch(t.order){case f:c=r*u,y=r*l,v=a*u,d=a*l,i[0]=o*u,i[4]=-o*l,i[8]=h,i[1]=y+v*h,i[5]=c-d*h,i[9]=-a*o,i[2]=d-c*h,i[6]=v+y*h,i[10]=r*o;break;case g:w=o*u,z=o*l,M=h*u,b=h*l,i[0]=w+b*a,i[4]=M*a-z,i[8]=r*h,i[1]=r*l,i[5]=r*u,i[9]=-a,i[2]=z*a-M,i[6]=b+w*a,i[10]=r*o;break;case x:w=o*u,z=o*l,M=h*u,b=h*l,i[0]=w-b*a,i[4]=-r*l,i[8]=M+z*a,i[1]=z+M*a,i[5]=r*u,i[9]=b-w*a,i[2]=-r*h,i[6]=a,i[10]=r*o;break;case k:c=r*u,y=r*l,v=a*u,d=a*l,i[0]=o*u,i[4]=v*h-y,i[8]=c*h+d,i[1]=o*l,i[5]=d*h+c,i[9]=y*h-v,i[2]=-h,i[6]=a*o,i[10]=r*o;break;case m:A=r*o,S=r*h,T=a*o,P=a*h,i[0]=o*u,i[4]=P-A*l,i[8]=T*l+S,i[1]=l,i[5]=r*u,i[9]=-a*u,i[2]=-h*u,i[6]=S*l+T,i[10]=A-P*l;break;case p:A=r*o,S=r*h,T=a*o,P=a*h,i[0]=o*u,i[4]=-l,i[8]=h*u,i[1]=A*l+P,i[5]=r*u,i[9]=S*l-T,i[2]=T*l-S,i[6]=a*u,i[10]=P*l+A}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(t){return this.compose(U.set(0,0,0),t,q.set(1,1,1))}},{key:"lookAt",value:function(t,i,e){var n=this.elements,s=U,r=q,a=F;return a.subVectors(t,i),0===a.lengthSquared()&&(a.z=1),a.normalize(),s.crossVectors(e,a),0===s.lengthSquared()&&(1===Math.abs(e.z)?a.x+=1e-4:a.z+=1e-4,a.normalize(),s.crossVectors(e,a)),s.normalize(),r.crossVectors(a,s),n[0]=s.x,n[4]=r.x,n[8]=a.x,n[1]=s.y,n[5]=r.y,n[9]=a.y,n[2]=s.z,n[6]=r.z,n[10]=a.z,this}},{key:"multiplyMatrices",value:function(t,i){var e=this.elements,n=t.elements,s=i.elements,r=n[0],a=n[4],o=n[8],h=n[12],u=n[1],l=n[5],c=n[9],y=n[13],v=n[2],d=n[6],f=n[10],m=n[14],x=n[3],p=n[7],g=n[11],k=n[15],w=s[0],z=s[4],M=s[8],b=s[12],A=s[1],S=s[5],T=s[9],P=s[13],I=s[2],O=s[6],_=s[10],C=s[14],U=s[3],q=s[7],F=s[11],E=s[15];return e[0]=r*w+a*A+o*I+h*U,e[4]=r*z+a*S+o*O+h*q,e[8]=r*M+a*T+o*_+h*F,e[12]=r*b+a*P+o*C+h*E,e[1]=u*w+l*A+c*I+y*U,e[5]=u*z+l*S+c*O+y*q,e[9]=u*M+l*T+c*_+y*F,e[13]=u*b+l*P+c*C+y*E,e[2]=v*w+d*A+f*I+m*U,e[6]=v*z+d*S+f*O+m*q,e[10]=v*M+d*T+f*_+m*F,e[14]=v*b+d*P+f*C+m*E,e[3]=x*w+p*A+g*I+k*U,e[7]=x*z+p*S+g*O+k*q,e[11]=x*M+p*T+g*_+k*F,e[15]=x*b+p*P+g*C+k*E,this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyScalar",value:function(t){var i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this}},{key:"determinant",value:function(){var t=this.elements,i=t[0],e=t[4],n=t[8],s=t[12],r=t[1],a=t[5],o=t[9],h=t[13],u=t[2],l=t[6],c=t[10],y=t[14],v=i*a,d=i*o,f=i*h,m=e*r,x=e*o,p=e*h,g=n*r,k=n*a,w=n*h,z=s*r,M=s*a,b=s*o;return t[3]*(b*l-w*l-M*c+p*c+k*y-x*y)+t[7]*(d*y-f*c+z*c-g*y+w*u-b*u)+t[11]*(f*l-v*y-z*l+m*y+M*u-p*u)+t[15]*(-k*u-d*l+v*c+g*l-m*c+x*u)}},{key:"getInverse",value:function(t){var i=this.elements,e=t.elements,n=e[0],s=e[1],r=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],y=e[9],v=e[10],d=e[11],f=e[12],m=e[13],x=e[14],p=e[15],g=y*x*l-m*v*l+m*u*d-h*x*d-y*u*p+h*v*p,k=f*v*l-c*x*l-f*u*d+o*x*d+c*u*p-o*v*p,w=c*m*l-f*y*l+f*h*d-o*m*d-c*h*p+o*y*p,z=f*y*u-c*m*u-f*h*v+o*m*v+c*h*x-o*y*x,M=n*g+s*k+r*w+a*z,b=void 0;return 0!==M?(b=1/M,i[0]=g*b,i[1]=(m*v*a-y*x*a-m*r*d+s*x*d+y*r*p-s*v*p)*b,i[2]=(h*x*a-m*u*a+m*r*l-s*x*l-h*r*p+s*u*p)*b,i[3]=(y*u*a-h*v*a-y*r*l+s*v*l+h*r*d-s*u*d)*b,i[4]=k*b,i[5]=(c*x*a-f*v*a+f*r*d-n*x*d-c*r*p+n*v*p)*b,i[6]=(f*u*a-o*x*a-f*r*l+n*x*l+o*r*p-n*u*p)*b,i[7]=(o*v*a-c*u*a+c*r*l-n*v*l-o*r*d+n*u*d)*b,i[8]=w*b,i[9]=(f*y*a-c*m*a-f*s*d+n*m*d+c*s*p-n*y*p)*b,i[10]=(o*m*a-f*h*a+f*s*l-n*m*l-o*s*p+n*h*p)*b,i[11]=(c*h*a-o*y*a-c*s*l+n*y*l+o*s*d-n*h*d)*b,i[12]=z*b,i[13]=(c*m*r-f*y*r+f*s*v-n*m*v-c*s*x+n*y*x)*b,i[14]=(f*h*r-o*m*r-f*s*u+n*m*u+o*s*x-n*h*x)*b,i[15]=(o*y*r-c*h*r+c*s*u-n*y*u-o*s*v+n*h*v)*b):(console.error("Can\'t invert matrix, determinant is zero",t),this.identity()),this}},{key:"transpose",value:function(){var t=this.elements,i=void 0;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this}},{key:"scale",value:function(t,i,e){var n=this.elements;return n[0]*=t,n[4]*=i,n[8]*=e,n[1]*=t,n[5]*=i,n[9]*=e,n[2]*=t,n[6]*=i,n[10]*=e,n[3]*=t,n[7]*=i,n[11]*=e,this}},{key:"makeScale",value:function(t,i,e){return this.set(t,0,0,0,0,i,0,0,0,0,e,0,0,0,0,1),this}},{key:"makeTranslation",value:function(t,i,e){return this.set(1,0,0,t,0,1,0,i,0,0,1,e,0,0,0,1),this}},{key:"makeRotationX",value:function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(1,0,0,0,0,i,-e,0,0,e,i,0,0,0,0,1),this}},{key:"makeRotationY",value:function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(i,0,e,0,0,1,0,0,-e,0,i,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(i,-e,0,0,e,i,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(t,i){var e=Math.cos(i),n=Math.sin(i),s=1-e,r=t.x,a=t.y,o=t.z,h=s*r,u=s*a;return this.set(h*r+e,h*a-n*o,h*o+n*a,0,h*a+n*o,u*a+e,u*o-n*r,0,h*o-n*a,u*o+n*r,s*o*o+e,0,0,0,0,1),this}},{key:"makeShear",value:function(t,i,e){return this.set(1,i,e,0,t,1,e,0,t,i,1,0,0,0,0,1),this}},{key:"compose",value:function(t,i,e){var n=this.elements,s=i.x,r=i.y,a=i.z,o=i.w,h=s+s,u=r+r,l=a+a,c=s*h,y=s*u,v=s*l,d=r*u,f=r*l,m=a*l,x=o*h,p=o*u,g=o*l,k=e.x,w=e.y,z=e.z;return n[0]=(1-(d+m))*k,n[1]=(y+g)*k,n[2]=(v-p)*k,n[3]=0,n[4]=(y-g)*w,n[5]=(1-(c+m))*w,n[6]=(f+x)*w,n[7]=0,n[8]=(v+p)*z,n[9]=(f-x)*z,n[10]=(1-(c+d))*z,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}},{key:"decompose",value:function(t,i,e){var n=this.elements,s=n[0],r=n[1],a=n[2],o=n[4],h=n[5],u=n[6],l=n[8],c=n[9],y=n[10],v=this.determinant(),d=U.set(s,r,a).length()*(v<0?-1:1),f=U.set(o,h,u).length(),m=U.set(l,c,y).length(),x=1/d,p=1/f,g=1/m;return t.x=n[12],t.y=n[13],t.z=n[14],n[0]*=x,n[1]*=x,n[2]*=x,n[4]*=p,n[5]*=p,n[6]*=p,n[8]*=g,n[9]*=g,n[10]*=g,i.setFromRotationMatrix(this),n[0]=s,n[1]=r,n[2]=a,n[4]=o,n[5]=h,n[6]=u,n[8]=l,n[9]=c,n[10]=y,e.x=d,e.y=f,e.z=m,this}},{key:"makePerspective",value:function(t,i,e,n,s,r){var a=this.elements,o=2*s/(i-t),h=2*s/(e-n),u=(i+t)/(i-t),l=(e+n)/(e-n),c=-(r+s)/(r-s),y=-2*r*s/(r-s);return a[0]=o,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=h,a[9]=l,a[13]=0,a[2]=0,a[6]=0,a[10]=c,a[14]=y,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}},{key:"makeOrthographic",value:function(t,i,e,n,s,r){var a=this.elements,o=1/(i-t),h=1/(e-n),u=1/(r-s),l=(i+t)*o,c=(e+n)*h,y=(r+s)*u;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-l,a[1]=0,a[5]=2*h,a[9]=0,a[13]=-c,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-y,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}},{key:"equals",value:function(t){var i=this.elements,e=t.elements,n=!0,s=void 0;for(s=0;n&&s<16;++s)i[s]!==e[s]&&(n=!1);return n}}]),e}(),D=[new o,new o,new o,new o],V=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o;t(this,e),this.origin=i,this.direction=n}return i(e,[{key:"set",value:function(t,i){return this.origin.copy(t),this.direction.copy(i),this}},{key:"copy",value:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"at",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o).copy(this.direction).multiplyScalar(t).add(this.origin)}},{key:"lookAt",value:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this}},{key:"recast",value:function(t){return this.origin.copy(this.at(t,D[0])),this}},{key:"closestPointToPoint",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o,e=i.subVectors(t,this.origin).dot(this.direction);return e>=0?i.copy(this.direction).multiplyScalar(e).add(this.origin):i.copy(this.origin)}},{key:"distanceSquaredToPoint",value:function(t){var i=D[0].subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):D[0].copy(this.direction).multiplyScalar(i).add(this.origin).distanceToSquared(t)}},{key:"distanceToPoint",value:function(t){return Math.sqrt(this.distanceSquaredToPoint(t))}},{key:"distanceToPlane",value:function(t){var i=t.normal.dot(this.direction),e=0!==i?-(this.origin.dot(t.normal)+t.constant)/i:0===t.distanceToPoint(this.origin)?0:-1;return e>=0?e:null}},{key:"distanceSquaredToSegment",value:function(t,i,e,n){var s=D[0].copy(t).add(i).multiplyScalar(.5),r=D[1].copy(i).sub(t).normalize(),a=D[2].copy(this.origin).sub(s),o=.5*t.distanceTo(i),h=-this.direction.dot(r),u=a.dot(this.direction),l=-a.dot(r),c=a.lengthSq(),y=Math.abs(1-h*h),v=void 0,d=void 0,f=void 0,m=void 0,x=void 0;return y>0?(d=h*u-l,f=o*y,(v=h*l-u)>=0?d>=-f?d<=f?x=(v*=m=1/y)*(v+h*(d*=m)+2*u)+d*(h*v+d+2*l)+c:(d=o,x=-(v=Math.max(0,-(h*d+u)))*v+d*(d+2*l)+c):(d=-o,x=-(v=Math.max(0,-(h*d+u)))*v+d*(d+2*l)+c):d<=-f?x=-(v=Math.max(0,-(-h*o+u)))*v+(d=v>0?-o:Math.min(Math.max(-o,-l),o))*(d+2*l)+c:d<=f?(v=0,x=(d=Math.min(Math.max(-o,-l),o))*(d+2*l)+c):x=-(v=Math.max(0,-(h*o+u)))*v+(d=v>0?o:Math.min(Math.max(-o,-l),o))*(d+2*l)+c):(d=h>0?-o:o,x=-(v=Math.max(0,-(h*d+u)))*v+d*(d+2*l)+c),void 0!==e&&e.copy(this.direction).multiplyScalar(v).add(this.origin),void 0!==n&&n.copy(r).multiplyScalar(d).add(s),x}},{key:"intersectSphere",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o,e=D[0].subVectors(t.center,this.origin),n=e.dot(this.direction),s=e.dot(e)-n*n,r=t.radius*t.radius,a=null,h=void 0,u=void 0,l=void 0;return s<=r&&(l=n+(h=Math.sqrt(r-s)),((u=n-h)>=0||l>=0)&&(a=u<0?this.at(l,i):this.at(u,i))),a}},{key:"intersectsSphere",value:function(t){return this.distanceToPoint(t.center)<=t.radius}},{key:"intersectPlane",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o,e=this.distanceToPlane(t);return null===e?null:this.at(e,i)}},{key:"intersectsPlane",value:function(t){var i=t.distanceToPoint(this.origin);return 0===i||t.normal.dot(this.direction)*i<0}},{key:"intersectBox",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o,e=this.origin,n=this.direction,s=t.min,r=t.max,a=1/n.x,h=1/n.y,u=1/n.z,l=null,c=void 0,y=void 0,v=void 0,d=void 0,f=void 0,m=void 0;return a>=0?(c=(s.x-e.x)*a,y=(r.x-e.x)*a):(c=(r.x-e.x)*a,y=(s.x-e.x)*a),h>=0?(v=(s.y-e.y)*h,d=(r.y-e.y)*h):(v=(r.y-e.y)*h,d=(s.y-e.y)*h),c<=d&&v<=y&&((v>c||c!=c)&&(c=v),(d<y||y!=y)&&(y=d),u>=0?(f=(s.z-e.z)*u,m=(r.z-e.z)*u):(f=(r.z-e.z)*u,m=(s.z-e.z)*u),c<=m&&f<=y&&((f>c||c!=c)&&(c=f),(m<y||y!=y)&&(y=m),y>=0&&(l=this.at(c>=0?c:y,i)))),l}},{key:"intersectsBox",value:function(t){return null!==this.intersectBox(t,D[0])}},{key:"intersectTriangle",value:function(t,i,e,n,s){var r=this.direction,a=D[0],o=D[1],h=D[2],u=D[3],l=null,c=void 0,y=void 0,v=void 0,d=void 0,f=void 0;return o.subVectors(i,t),h.subVectors(e,t),u.crossVectors(o,h),0===(c=r.dot(u))||n&&c>0||(c>0?y=1:(y=-1,c=-c),a.subVectors(this.origin,t),(v=y*r.dot(h.crossVectors(a,h)))>=0&&(d=y*r.dot(o.cross(a)))>=0&&v+d<=c&&(f=-y*a.dot(u))>=0&&(l=this.at(f/c,s))),l}},{key:"applyMatrix4",value:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}},{key:"equals",value:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}]),e}(),N=(function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.radius=i,this.phi=n,this.theta=s}i(e,[{key:"set",value:function(t,i,e){return this.radius=t,this.phi=i,this.theta=e,this}},{key:"copy",value:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromVector3",value:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(Math.min(Math.max(t.y/this.radius,-1),1))),this.makeSafe()}},{key:"makeSafe",value:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}}])}(),function(){function e(){t(this,e),this.elements=new Float32Array([1,0,0,1,0,1])}return i(e,[{key:"set",value:function(t,i,e,n,s,r){var a=this.elements;return a[0]=t,a[1]=i,a[3]=n,a[2]=e,a[4]=s,a[5]=r,this}},{key:"identity",value:function(){return this.set(1,0,0,1,0,1),this}},{key:"copy",value:function(t){var i=t.elements;return this.set(i[0],i[1],i[2],i[3],i[4],i[5]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toMatrix3",value:function(t){var i=t.elements;t.set(i[0],i[1],i[2],i[1],i[3],i[4],i[2],i[4],i[5])}},{key:"add",value:function(t){var i=this.elements,e=t.elements;return i[0]+=e[0],i[1]+=e[1],i[3]+=e[3],i[2]+=e[2],i[4]+=e[4],i[5]+=e[5],this}},{key:"norm",value:function(){var t=this.elements,i=t[1]*t[1],e=t[2]*t[2],n=t[4]*t[4];return Math.sqrt(t[0]*t[0]+i+e+i+t[3]*t[3]+n+e+n+t[5]*t[5])}},{key:"off",value:function(){var t=this.elements;return Math.sqrt(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:"applyToVector3",value:function(t){var i=t.x,e=t.y,n=t.z,s=this.elements;return t.x=s[0]*i+s[1]*e+s[2]*n,t.y=s[1]*i+s[3]*e+s[4]*n,t.z=s[2]*i+s[4]*e+s[5]*n,t}},{key:"equals",value:function(t){var i=this.elements,e=t.elements,n=!0,s=void 0;for(s=0;n&&s<6;++s)i[s]!==e[s]&&(n=!1);return n}}],[{key:"calculateIndex",value:function(t,i){return 3-(3-t)*(2-t)/2+i}}]),e}()),B=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t(this,e),this.x=i,this.y=n,this.z=s,this.w=r}return i(e,[{key:"set",value:function(t,i,e,n){return this.x=t,this.y=i,this.z=e,this.w=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}},{key:"setAxisAngleFromQuaternion",value:function(t){this.w=2*Math.acos(t.w);var i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this}},{key:"setAxisAngleFromRotationMatrix",value:function(t){var i=t.elements,e=i[0],n=i[4],s=i[8],r=i[1],a=i[5],o=i[9],h=i[2],u=i[6],l=i[10],c=void 0,y=void 0,v=void 0,d=void 0,f=void 0,m=void 0,x=void 0,p=void 0,g=void 0,k=void 0,w=void 0;return Math.abs(n-r)<.01&&Math.abs(s-h)<.01&&Math.abs(o-u)<.01?Math.abs(n+r)<.1&&Math.abs(s+h)<.1&&Math.abs(o+u)<.1&&Math.abs(e+a+l-3)<.1?this.set(1,0,0,0):(c=Math.PI,x=(l+1)/2,p=(n+r)/4,g=(s+h)/4,k=(o+u)/4,(f=(e+1)/2)>(m=(a+1)/2)&&f>x?f<.01?(y=0,v=.707106781,d=.707106781):(v=p/(y=Math.sqrt(f)),d=g/y):m>x?m<.01?(y=.707106781,v=0,d=.707106781):(y=p/(v=Math.sqrt(m)),d=k/v):x<.01?(y=.707106781,v=.707106781,d=0):(y=g/(d=Math.sqrt(x)),v=k/d),this.set(y,v,d,c)):(w=Math.sqrt((u-o)*(u-o)+(s-h)*(s-h)+(r-n)*(r-n)),Math.abs(w)<.001&&(w=1),this.x=(u-o)/w,this.y=(s-h)/w,this.z=(r-n)/w,this.w=Math.acos((e+a+l-1)/2)),this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}},{key:"addVectors",value:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this}},{key:"addScaledVector",value:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}},{key:"subVectors",value:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}},{key:"multiplyVectors",value:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this.w=t.w*i.w,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this}},{key:"applyMatrix4",value:function(t){var i=this.x,e=this.y,n=this.z,s=this.w,r=t.elements;return this.x=r[0]*i+r[4]*e+r[8]*n+r[12]*s,this.y=r[1]*i+r[5]*e+r[9]*n+r[13]*s,this.z=r[2]*i+r[6]*e+r[10]*n+r[14]*s,this.w=r[3]*i+r[7]*e+r[11]*n+r[15]*s,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)+Math.abs(this.w-t.w)}},{key:"distanceToSquared",value:function(t){var i=this.x-t.x,e=this.y-t.y,n=this.z-t.z,s=this.w-t.w;return i*i+e*e+n*n+s*s}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}},{key:"clamp",value:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"lerp",value:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this}},{key:"lerpVectors",value:function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}}]),e}(),L=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t(this,e),this.value=i,this.done=n}return i(e,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),e}(),R=new o,j=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o;t(this,e),this.min=i,this.max=n,this.children=null}return i(e,[{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o).addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o).subVectors(this.max,this.min)}},{key:"split",value:function(){var t=this.min,i=this.max,e=this.getCenter(R),n=this.children=[null,null,null,null,null,null,null,null],s=void 0,r=void 0;for(s=0;s<8;++s)r=Y[s],n[s]=new this.constructor(new o(0===r[0]?t.x:e.x,0===r[1]?t.y:e.y,0===r[2]?t.z:e.z),new o(0===r[0]?e.x:i.x,0===r[1]?e.y:i.y,0===r[2]?e.z:i.z))}}]),e}(),Y=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],X=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],Z=new o,Q=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.min=i,this.size=n,this.children=null}return i(e,[{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o).copy(this.min).addScalar(.5*this.size)}},{key:"getDimensions",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o).set(this.size,this.size,this.size)}},{key:"split",value:function(){var t=this.min,i=this.getCenter(Z),e=.5*this.size,n=this.children=[null,null,null,null,null,null,null,null],s=void 0,r=void 0;for(s=0;s<8;++s)r=Y[s],n[s]=new this.constructor(new o(0===r[0]?t.x:i.x,0===r[1]?t.y:i.y,0===r[2]?t.z:i.z),e)}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}]),e}(),G=new u,H=function(){function e(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t(this,e),this.octree=i,this.region=n,this.cull=null!==n,this.result=new L,this.trace=null,this.indices=null,this.reset()}return i(e,[{key:"reset",value:function(){var t=this.octree.root;return this.trace=[],this.indices=[],null!==t&&(G.min=t.min,G.max=t.max,this.cull&&!this.region.intersectsBox(G)||(this.trace.push(t),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var t=this.cull,i=this.region,e=this.indices,n=this.trace,s=null,r=n.length-1,a=void 0,o=void 0,h=void 0;null===s&&r>=0;)if(a=e[r],o=n[r].children,++e[r],a<8)if(null!==o){if(h=o[a],t&&(G.min=h.min,G.max=h.max,!i.intersectsBox(G)))continue;n.push(h),e.push(0),++r}else s=n.pop(),e.pop();else n.pop(),e.pop(),--r;return this.result.value=s,this.result.done=null===s,this.result}},{key:"return",value:function(t){return this.result.value=t,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),J=[new o,new o,new o],K=new u,W=new V,$=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],tt=0;function it(t,i,e,n){var s=void 0,r=0;return i<e?(s=i,r=0):(s=e,r=1),n<s&&(r=2),$[t][r]}var et=function(){function e(){t(this,e)}return i(e,null,[{key:"intersectOctree",value:function(t,i,e){var n=K.min.set(0,0,0),s=K.max.subVectors(t.max,t.min),r=t.getDimensions(J[0]),a=J[1].copy(r).multiplyScalar(.5),o=W.origin.copy(i.ray.origin),h=W.direction.copy(i.ray.direction),u=void 0,l=void 0,c=void 0,y=void 0,v=void 0,d=void 0,f=void 0,m=void 0,x=void 0;o.sub(t.getCenter(J[2])).add(a),tt=0,h.x<0&&(o.x=r.x-o.x,h.x=-h.x,tt|=4),h.y<0&&(o.y=r.y-o.y,h.y=-h.y,tt|=2),h.z<0&&(o.z=r.z-o.z,h.z=-h.z,tt|=1),u=1/h.x,l=1/h.y,c=1/h.z,y=(n.x-o.x)*u,v=(s.x-o.x)*u,d=(n.y-o.y)*l,f=(s.y-o.y)*l,m=(n.z-o.z)*c,x=(s.z-o.z)*c,Math.max(Math.max(y,d),m)<Math.min(Math.min(v,f),x)&&function t(i,e,n,s,r,a,o,h,u){var l=i.children,c=void 0,y=void 0,v=void 0,d=void 0;if(r>=0&&a>=0&&o>=0)if(null===l)u.push(i);else{c=function(t,i,e,n,s,r){var a=0;return t>i&&t>e?(s<t&&(a|=2),r<t&&(a|=1)):i>e?(n<i&&(a|=4),r<i&&(a|=1)):(n<e&&(a|=4),s<e&&(a|=2)),a}(e,n,s,y=.5*(e+r),v=.5*(n+a),d=.5*(s+o));do{switch(c){case 0:t(l[tt],e,n,s,y,v,d,h,u),c=it(c,y,v,d);break;case 1:t(l[1^tt],e,n,d,y,v,o,h,u),c=it(c,y,v,o);break;case 2:t(l[2^tt],e,v,s,y,a,d,h,u),c=it(c,y,a,d);break;case 3:t(l[3^tt],e,v,d,y,a,o,h,u),c=it(c,y,a,o);break;case 4:t(l[4^tt],y,n,s,r,v,d,h,u),c=it(c,r,v,d);break;case 5:t(l[5^tt],y,n,d,r,v,o,h,u),c=it(c,r,v,o);break;case 6:t(l[6^tt],y,v,s,r,a,d,h,u),c=it(c,r,a,d);break;case 7:t(l[7^tt],y,v,d,r,a,o,h,u),c=8}}while(c<8)}}(t.root,y,d,m,v,f,x,i,e)}}]),e}(),nt=new u;var st=function(){function e(i,n){t(this,e),this.root=void 0!==i&&void 0!==n?new j(i,n):null}return i(e,[{key:"getCenter",value:function(t){return this.root.getCenter(t)}},{key:"getDimensions",value:function(t){return this.root.getDimensions(t)}},{key:"getDepth",value:function(){return function t(i){var e=i.children,n=0,s=void 0,r=void 0,a=void 0;if(null!==e)for(s=0,r=e.length;s<r;++s)(a=1+t(e[s]))>n&&(n=a);return n}(this.root)}},{key:"cull",value:function(t){var i=[];return function t(i,e,n){var s=i.children,r=void 0,a=void 0;if(nt.min=i.min,nt.max=i.max,e.intersectsBox(nt))if(null!==s)for(r=0,a=s.length;r<a;++r)t(s[r],e,n);else n.push(i)}(this.root,t,i),i}},{key:"findOctantsByLevel",value:function(t){var i=[];return function t(i,e,n,s){var r=i.children,a=void 0,o=void 0;if(n===e)s.push(i);else if(null!==r)for(++n,a=0,o=r.length;a<o;++a)t(r[a],e,n,s)}(this.root,t,0,i),i}},{key:"raycast",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return et.intersectOctree(this,t,i),i}},{key:"leaves",value:function(t){return new H(this,t)}},{key:Symbol.iterator,value:function(){return new H(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),e}(),rt=new o,at=function(e){n(a,j);function a(i,e){t(this,a);var n=s(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,i,e));return n.points=null,n.data=null,n}return i(a,[{key:"distanceToSquared",value:function(t){return rt.copy(t).clamp(this.min,this.max).sub(t).lengthSquared()}},{key:"distanceToCenterSquared",value:function(t){var i=this.getCenter(rt),e=t.x-i.x,n=t.y-i.x,s=t.z-i.z;return e*e+n*n+s*s}},{key:"contains",value:function(t,i){var e=this.min,n=this.max;return t.x>=e.x-i&&t.y>=e.y-i&&t.z>=e.z-i&&t.x<=n.x+i&&t.y<=n.y+i&&t.z<=n.z+i}},{key:"redistribute",value:function(t){var i=this.children,e=this.points,n=this.data,s=void 0,r=void 0,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0;if(null!==i&&null!==e)for(s=0,a=e.length;s<a;++s)for(u=e[s],l=n[s],r=0,o=i.length;r<o;++r)if((h=i[r]).contains(u,t)){null===h.points&&(h.points=[],h.data=[]),h.points.push(u),h.data.push(l);break}this.points=null,this.data=null}},{key:"merge",value:function(){var t=this.children,i=void 0,e=void 0,n=void 0;if(null!==t){for(this.points=[],this.data=[],i=0,e=t.length;i<e;++i)if(null!==(n=t[i]).points){var s,a;(s=this.points).push.apply(s,r(n.points)),(a=this.data).push.apply(a,r(n.data))}this.children=null}}}]),a}(),ot=function i(e,n,s){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;t(this,i),this.distance=e,this.distanceToRay=n,this.point=s,this.object=r},ht=new o,ut=1e-6;function lt(t){var i=t.children,e=0,n=void 0,s=void 0;if(null!==i)for(n=0,s=i.length;n<s;++n)e+=lt(i[n]);else null!==t.points&&(e=t.points.length);return e}function ct(t,i,e,n,s){var r=n.children,a=!1,o=!1,h=void 0,u=void 0;if(n.contains(t,e.bias)){if(null===r){if(null===n.points)n.points=[],n.data=[];else for(h=0,u=n.points.length;!a&&h<u;++h)a=n.points[h].equals(t);a?(n.data[h-1]=i,o=!0):n.points.length<e.maxPoints||s===e.maxDepth?(n.points.push(t.clone()),n.data.push(i),++e.pointCount,o=!0):(n.split(),n.redistribute(e.bias),r=n.children)}if(null!==r)for(++s,h=0,u=r.length;!o&&h<u;++h)o=ct(t,i,e,r[h],s)}return o}function yt(t,i,e,n){var s=e.children,r=null,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0;if(e.contains(t,i.bias))if(null!==s)for(a=0,o=s.length;null===r&&a<o;++a)r=yt(t,i,s[a],e);else if(null!==e.points)for(h=e.points,u=e.data,a=0,o=h.length;a<o;++a)if(h[a].equals(t)){l=o-1,r=u[a],a<l&&(h[a]=h[l],u[a]=u[l]),h.pop(),u.pop(),--i.pointCount,null!==n&&lt(n)<=i.maxPoints&&n.merge();break}return r}!function(r){n(a,st);function a(i,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;t(this,a);var h=s(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return h.root=new at(i,e),h.bias=Math.max(0,n),h.maxPoints=Math.max(1,Math.round(r)),h.maxDepth=Math.max(0,Math.round(o)),h.pointCount=0,h}i(a,[{key:"countPoints",value:function(t){return lt(t)}},{key:"put",value:function(t,i){return ct(t,i,this,this.root,0)}},{key:"remove",value:function(t){return yt(t,this,this.root,null)}},{key:"fetch",value:function(t){return function t(i,e,n){var s=n.children,r=null,a=void 0,o=void 0,h=void 0;if(n.contains(i,e.bias))if(null!==s)for(a=0,o=s.length;null===r&&a<o;++a)r=t(i,e,s[a]);else if(null!==n.points)for(a=0,o=(h=n.points).length;null===r&&a<o;++a)i.distanceToSquared(h[a])<=ut&&(r=n.data[a]);return r}(t,this,this.root)}},{key:"move",value:function(t,i){return function t(i,e,n,s,r,a){var o=s.children,h=null,u=void 0,l=void 0,c=void 0;if(s.contains(i,n.bias))if(s.contains(e,n.bias)){if(null!==o)for(++a,u=0,l=o.length;null===h&&u<l;++u)h=t(i,e,n,o[u],s,a);else if(null!==s.points)for(u=0,l=(c=s.points).length;u<l;++u)if(i.distanceToSquared(c[u])<=ut){c[u].copy(e),h=s.data[u];break}}else ct(e,h=yt(i,n,s,r),n,r,a-1);return h}(t,i,this,this.root,null,0)}},{key:"findNearestPoint",value:function(t){return function t(i,e,n,s){var r=s.points,a=s.children,o=null,h=e,u=void 0,l=void 0,c=void 0,y=void 0,v=void 0,d=void 0,f=void 0;if(null!==a)for(u=0,l=(v=a.map(function(t){return{octant:t,distance:t.distanceToCenterSquared(i)}}).sort(function(t,i){return t.distance-i.distance})).length;u<l;++u)(d=v[u].octant).contains(i,h)&&null!==(f=t(i,h,n,d))&&(y=f.point.distanceToSquared(i),(!n||y>0)&&y<h&&(h=y,o=f));else if(null!==r)for(u=0,l=r.length;u<l;++u)c=r[u],y=i.distanceToSquared(c),(!n||y>0)&&y<h&&(h=y,o={point:c.clone(),data:s.data[u]});return o}(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,arguments.length>2&&void 0!==arguments[2]&&arguments[2],this.root)}},{key:"findPoints",value:function(t,i){var e=[];return function t(i,e,n,s,r){var a=s.points,o=s.children,h=e*e,u=void 0,l=void 0,c=void 0,y=void 0,v=void 0;if(null!==o)for(u=0,l=o.length;u<l;++u)(v=o[u]).contains(i,e)&&t(i,e,n,v,r);else if(null!==a)for(u=0,l=a.length;u<l;++u)c=a[u],y=i.distanceToSquared(c),(!n||y>0)&&y<=h&&r.push({point:c.clone(),data:s.data[u]})}(t,i,arguments.length>2&&void 0!==arguments[2]&&arguments[2],this.root,e),e}},{key:"raycast",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"raycast",this).call(this,t);return n.length>0&&this.testPoints(n,t,i),i}},{key:"testPoints",value:function(t,i,e){var n=i.params.Points.threshold,s=n*n,r=void 0,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0,c=void 0,y=void 0,v=void 0,d=void 0,f=void 0;for(u=0,c=t.length;u<c;++u)if(null!==(d=(v=t[u]).points))for(l=0,y=d.length;l<y;++l)f=d[l],(h=i.ray.distanceSqToPoint(f))<s&&(r=i.ray.closestPointToPoint(f,ht),(a=i.ray.origin.distanceTo(r))>=i.near&&a<=i.far&&(o=Math.sqrt(h),e.push(new ot(a,o,r,v.data[l]))))}}])}();var vt=new u,dt=new o,ft=new o,mt=new o,xt=(function(){function e(){t(this,e)}i(e,null,[{key:"recycleOctants",value:function(t,i){var e=t.min,n=t.getCenter(ft),s=t.getDimensions(mt).multiplyScalar(.5),r=t.children,a=i.length,o=void 0,h=void 0,u=void 0,l=void 0;for(o=0;o<8;++o)for(u=Y[o],vt.min.addVectors(e,dt.fromArray(u).multiply(s)),vt.max.addVectors(n,dt.fromArray(u).multiply(s)),h=0;h<a;++h)if(null!==(l=i[h])&&vt.min.equals(l.min)&&vt.max.equals(l.max)){r[o]=l,i[h]=null;break}}}])}(),new o),pt=new o,gt=new o,kt=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o;t(this,e),this.a=i,this.b=n,this.index=-1,this.coordinates=new o,this.t=0,this.n=new o}return i(e,[{key:"approximateZeroCrossing",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,e=Math.max(1,i-1),n=0,s=1,r=0,a=0,o=void 0,h=void 0;for(xt.subVectors(this.b,this.a);a<=e&&(r=(n+s)/2,pt.addVectors(this.a,gt.copy(xt).multiplyScalar(r)),h=t.sample(pt),!(Math.abs(h)<=1e-4||(s-n)/2<=1e-6));)pt.addVectors(this.a,gt.copy(xt).multiplyScalar(n)),o=t.sample(pt),Math.sign(h)===Math.sign(o)?n=r:s=r,++a;this.t=r}},{key:"computeZeroCrossingPosition",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o).subVectors(this.b,this.a).multiplyScalar(this.t).add(this.a)}},{key:"computeSurfaceNormal",value:function(t){var i=this.computeZeroCrossingPosition(xt),e=t.sample(pt.addVectors(i,gt.set(.001,0,0)))-t.sample(pt.subVectors(i,gt.set(.001,0,0))),n=t.sample(pt.addVectors(i,gt.set(0,.001,0)))-t.sample(pt.subVectors(i,gt.set(0,.001,0))),s=t.sample(pt.addVectors(i,gt.set(0,0,.001)))-t.sample(pt.subVectors(i,gt.set(0,0,.001)));this.n.set(e,n,s).normalize()}}]),e}(),wt=new kt,zt=new o,Mt=new o,bt=function(){function e(i,n,s){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3;t(this,e),this.edgeData=i,this.cellPosition=n,this.cellSize=s,this.indices=null,this.zeroCrossings=null,this.normals=null,this.axes=null,this.lengths=null,this.result=new L,this.initialC=r,this.c=r,this.initialD=a,this.d=a,this.i=0,this.l=0,this.reset()}return i(e,[{key:"reset",value:function(){var t=this.edgeData,i=[],e=[],n=[],s=[],r=[],a=void 0,o=void 0,h=void 0,u=void 0;for(this.i=0,this.c=0,this.d=0,a=4>>(o=this.initialC),h=this.initialD;o<h;++o,a>>=1)(u=t.indices[o].length)>0&&(i.push(t.indices[o]),e.push(t.zeroCrossings[o]),n.push(t.normals[o]),s.push(Y[a]),r.push(u),++this.d);return this.l=r.length>0?r[0]:0,this.indices=i,this.zeroCrossings=e,this.normals=n,this.axes=s,this.lengths=r,this.result.reset(),this}},{key:"next",value:function(){var t=this.cellSize,i=Ot.resolution,e=i+1,n=e*e,s=this.result,r=this.cellPosition,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0,c=void 0,y=void 0;return this.i===this.l&&(this.l=++this.c<this.d?this.lengths[this.c]:0,this.i=0),this.i<this.l?(c=this.c,y=this.i,a=this.axes[c],o=this.indices[c][y],wt.index=o,h=o%e,u=Math.trunc(o%n/e),l=Math.trunc(o/n),wt.coordinates.set(h,u,l),zt.set(h*t/i,u*t/i,l*t/i),Mt.set((h+a[0])*t/i,(u+a[1])*t/i,(l+a[2])*t/i),wt.a.addVectors(r,zt),wt.b.addVectors(r,Mt),wt.t=this.zeroCrossings[c][y],wt.n.fromArray(this.normals[c],3*y),s.value=wt,++this.i):(s.value=null,s.done=!0),s}},{key:"return",value:function(t){return this.result.value=t,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),At=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i;t(this,e),this.indices=i<=0?null:[new Uint32Array(i),new Uint32Array(n),new Uint32Array(s)],this.zeroCrossings=i<=0?null:[new Float32Array(i),new Float32Array(n),new Float32Array(s)],this.normals=i<=0?null:[new Float32Array(3*i),new Float32Array(3*n),new Float32Array(3*s)]}return i(e,[{key:"serialize",value:function(){return{edges:this.edges,zeroCrossings:this.zeroCrossings,normals:this.normals}}},{key:"deserialize",value:function(t){var i=this;return null!==t?(this.edges=t.edges,this.zeroCrossings=t.zeroCrossings,this.normals=t.normals):i=null,i}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=[this.edges[0],this.edges[1],this.edges[2],this.zeroCrossings[0],this.zeroCrossings[1],this.zeroCrossings[2],this.normals[0],this.normals[1],this.normals[2]],e=void 0,n=void 0,s=void 0;for(n=0,s=i.length;n<s;++n)null!==(e=i[n])&&t.push(e.buffer);return t}},{key:"edges",value:function(t,i){return new bt(this,t,i)}},{key:"edgesX",value:function(t,i){return new bt(this,t,i,0,1)}},{key:"edgesY",value:function(t,i){return new bt(this,t,i,1,2)}},{key:"edgesZ",value:function(t,i){return new bt(this,t,i,2,3)}}],[{key:"calculate1DEdgeCount",value:function(t){return Math.pow(t+1,2)*t}}]),e}(),St={AIR:0,SOLID:1},Tt=0,Pt=0,It=0;var Ot=function(){function e(){var i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t(this,e),this.materials=0,this.materialIndices=i?new Uint8Array(It):null,this.runLengths=null,this.edgeData=null}return i(e,[{key:"set",value:function(t){return this.materials=t.materials,this.materialIndices=t.materialIndices,this.runLengths=t.runLengths,this.edgeData=t.edgeData,this}},{key:"clear",value:function(){return this.materials=0,this.materialIndices=null,this.runLengths=null,this.edgeData=null,this}},{key:"setMaterialIndex",value:function(t,i){this.materialIndices[t]===St.AIR?i!==St.AIR&&++this.materials:i===St.AIR&&--this.materials,this.materialIndices[t]=i}},{key:"compress",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,i=void 0;return this.compressed?(t.materialIndices=this.materialIndices,t.runLengths=this.runLengths):(i=this.full?new a([this.materialIndices.length],[St.SOLID]):a.encode(this.materialIndices),t.materialIndices=new Uint8Array(i.data),t.runLengths=new Uint32Array(i.runLengths)),t.materials=this.materials,t}},{key:"decompress",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return t.materialIndices=this.compressed?a.decode(this.runLengths,this.materialIndices,new Uint8Array(It)):this.materialIndices,t.runLengths=null,t.materials=this.materials,t}},{key:"serialize",value:function(){return{materials:this.materials,materialIndices:this.materialIndices,runLengths:this.runLengths,edgeData:null!==this.edgeData?this.edgeData.serialize():null}}},{key:"deserialize",value:function(t){var i=this;return null!==t?(this.materials=t.materials,this.materialIndices=t.materialIndices,this.runLengths=t.runLengths,null!==t.edgeData?(null===this.edgeData&&(this.edgeData=new At),this.edgeData.deserialize(t.edgeData)):this.edgeData=null):i=null,i}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return null!==this.edgeData&&this.edgeData.createTransferList(t),null!==this.materialIndices&&t.push(this.materialIndices.buffer),null!==this.runLengths&&t.push(this.runLengths.buffer),t}},{key:"empty",get:function(){return 0===this.materials}},{key:"full",get:function(){return this.materials===It}},{key:"compressed",get:function(){return null!==this.runLengths}},{key:"neutered",get:function(){return!this.empty&&null===this.materialIndices}}],[{key:"isovalue",get:function(){return Tt},set:function(t){Tt=t}},{key:"resolution",get:function(){return Pt},set:function(t){Pt=Math.max(1,Math.min(256,(i=t,Math.pow(2,Math.max(0,Math.ceil(Math.log2(i)))))));var i;It=Math.pow(Pt+1,3)}}]),e}(),_t=function(){function e(){t(this,e),this.ata=new N,this.ata.set(0,0,0,0,0,0),this.atb=new o,this.massPointSum=new o,this.numPoints=0}return i(e,[{key:"set",value:function(t,i,e,n){return this.ata.copy(t),this.atb.copy(i),this.massPointSum.copy(e),this.numPoints=n,this}},{key:"copy",value:function(t){return this.set(t.ata,t.atb,t.massPointSum,t.numPoints)}},{key:"add",value:function(t,i){var e=i.x,n=i.y,s=i.z,r=t.dot(i),a=this.ata.elements,o=this.atb;a[0]+=e*e,a[1]+=e*n,a[3]+=n*n,a[2]+=e*s,a[4]+=n*s,a[5]+=s*s,o.x+=r*e,o.y+=r*n,o.z+=r*s,this.massPointSum.add(t),++this.numPoints}},{key:"addData",value:function(t){this.ata.add(t.ata),this.atb.add(t.atb),this.massPointSum.add(t.massPointSum),this.numPoints+=t.numPoints}},{key:"clear",value:function(){this.ata.set(0,0,0,0,0,0),this.atb.set(0,0,0),this.massPointSum.set(0,0,0),this.numPoints=0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),Ct=new y,Ut=function(){function e(){t(this,e)}return i(e,null,[{key:"calculateCoefficients",value:function(t,i,e){var n=void 0,s=void 0,r=void 0;return 0===i?(Ct.x=1,Ct.y=0):(n=(e-t)/(2*i),s=Math.sqrt(1+n*n),r=1/(n>=0?n+s:n-s),Ct.x=1/Math.sqrt(1+r*r),Ct.y=r*Ct.x),Ct}}]),e}(),qt=function(){function e(){t(this,e)}return i(e,null,[{key:"rotateXY",value:function(t,i){var e=i.x,n=i.y,s=t.x,r=t.y;t.set(e*s-n*r,n*s+e*r)}},{key:"rotateQXY",value:function(t,i,e){var n=e.x,s=e.y,r=n*n,a=s*s,o=2*n*s*i,h=t.x,u=t.y;t.set(r*h-o+a*u,a*h+o+r*u)}}]),e}(),Ft=.1,Et=5,Dt=new N,Vt=new d,Nt=new y,Bt=new o;function Lt(t,i){var e=t.elements,n=i.elements,s=void 0;0!==e[1]&&(s=Ut.calculateCoefficients(e[0],e[1],e[3]),qt.rotateQXY(Nt.set(e[0],e[3]),e[1],s),e[0]=Nt.x,e[3]=Nt.y,qt.rotateXY(Nt.set(e[2],e[4]),s),e[2]=Nt.x,e[4]=Nt.y,e[1]=0,qt.rotateXY(Nt.set(n[0],n[3]),s),n[0]=Nt.x,n[3]=Nt.y,qt.rotateXY(Nt.set(n[1],n[4]),s),n[1]=Nt.x,n[4]=Nt.y,qt.rotateXY(Nt.set(n[2],n[5]),s),n[2]=Nt.x,n[5]=Nt.y)}function Rt(t,i){var e=t.elements,n=i.elements,s=void 0;0!==e[2]&&(s=Ut.calculateCoefficients(e[0],e[2],e[5]),qt.rotateQXY(Nt.set(e[0],e[5]),e[2],s),e[0]=Nt.x,e[5]=Nt.y,qt.rotateXY(Nt.set(e[1],e[4]),s),e[1]=Nt.x,e[4]=Nt.y,e[2]=0,qt.rotateXY(Nt.set(n[0],n[6]),s),n[0]=Nt.x,n[6]=Nt.y,qt.rotateXY(Nt.set(n[1],n[7]),s),n[1]=Nt.x,n[7]=Nt.y,qt.rotateXY(Nt.set(n[2],n[8]),s),n[2]=Nt.x,n[8]=Nt.y)}function jt(t,i){var e=t.elements,n=i.elements,s=void 0;0!==e[4]&&(s=Ut.calculateCoefficients(e[3],e[4],e[5]),qt.rotateQXY(Nt.set(e[3],e[5]),e[4],s),e[3]=Nt.x,e[5]=Nt.y,qt.rotateXY(Nt.set(e[1],e[2]),s),e[1]=Nt.x,e[2]=Nt.y,e[4]=0,qt.rotateXY(Nt.set(n[3],n[6]),s),n[3]=Nt.x,n[6]=Nt.y,qt.rotateXY(Nt.set(n[4],n[7]),s),n[4]=Nt.x,n[7]=Nt.y,qt.rotateXY(Nt.set(n[5],n[8]),s),n[5]=Nt.x,n[8]=Nt.y)}function Yt(t){var i=Math.abs(t)<Ft?0:1/t;return Math.abs(i)<Ft?0:i}var Xt=function(){function e(){t(this,e)}return i(e,null,[{key:"solve",value:function(t,i,e){var n=function(t,i){var e=t.elements,n=void 0;for(n=0;n<Et;++n)Lt(t,i),Rt(t,i),jt(t,i);return Bt.set(e[0],e[3],e[5])}(Dt.copy(t),Vt.identity()),s=function(t,i){var e=t.elements,n=e[0],s=e[3],r=e[6],a=e[1],o=e[4],h=e[7],u=e[2],l=e[5],c=e[8],y=Yt(i.x),v=Yt(i.y),d=Yt(i.z);return t.set(n*y*n+s*v*s+r*d*r,n*y*a+s*v*o+r*d*h,n*y*u+s*v*l+r*d*c,a*y*n+o*v*s+h*d*r,a*y*a+o*v*o+h*d*h,a*y*u+o*v*l+h*d*c,u*y*n+l*v*s+c*d*r,u*y*a+l*v*o+c*d*h,u*y*u+l*v*l+c*d*c)}(Vt,n);e.copy(i).applyMatrix3(s)}}]),e}(),Zt=new o;var Qt=function(){function e(){t(this,e),this.data=null,this.ata=new N,this.atb=new o,this.massPoint=new o,this.hasSolution=!1}return i(e,[{key:"setData",value:function(t){return this.data=t,this.hasSolution=!1,this}},{key:"solve",value:function(t){var i=this.data,e=this.massPoint,n=this.ata.copy(i.ata),s=this.atb.copy(i.atb),r=1/0;!this.hasSolution&&null!==i&&i.numPoints>0&&(Zt.copy(i.massPointSum).divideScalar(i.numPoints),e.copy(Zt),n.applyToVector3(Zt),s.sub(Zt),Xt.solve(n,s,t),a=s,o=t,n.applyToVector3(Zt.copy(o)),Zt.subVectors(a,Zt),r=Zt.dot(Zt),t.add(e),this.hasSolution=!0);var a,o;return r}}]),e}(),Gt=function i(){t(this,i),this.materials=0,this.edgeCount=0,this.index=-1,this.position=new o,this.normal=new o,this.qefData=null},Ht=new Qt,Jt=-1,Kt=function(e){n(r,Q);function r(i,e){t(this,r);var n=s(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,i,e));return n.voxel=null,n}return i(r,[{key:"contains",value:function(t){var i=this.min,e=this.size;return t.x>=i.x-.1&&t.y>=i.y-.1&&t.z>=i.z-.1&&t.x<=i.x+e+.1&&t.y<=i.y+e+.1&&t.z<=i.z+e+.1}},{key:"collapse",value:function(){var t=this.children,i=[-1,-1,-1,-1,-1,-1,-1,-1],e=new o,n=-1,s=null!==t,r=0,a=void 0,h=void 0,u=void 0,l=void 0,c=void 0,y=void 0;if(s){for(l=new _t,c=0,y=0;y<8;++y)r+=(a=t[y]).collapse(),u=a.voxel,null!==a.children?s=!1:null!==u&&(l.addData(u.qefData),n=u.materials>>7-y&1,i[y]=u.materials>>y&1,++c);if(s&&Ht.setData(l).solve(e)<=Jt){for((u=new Gt).position.copy(this.contains(e)?e:Ht.massPoint),y=0;y<8;++y)h=i[y],a=t[y],-1===h?u.materials|=n<<y:(u.materials|=h<<y,u.normal.add(a.voxel.normal));u.normal.normalize(),u.qefData=l,this.voxel=u,this.children=null,r+=c-1}}return r}}],[{key:"errorThreshold",get:function(){return Jt},set:function(t){Jt=t}}]),r}(),Wt=function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t(this,i),this.action=e,this.error=null},$t=function(){function e(i,n,s,r,a){t(this,e),this.indices=i,this.positions=n,this.normals=s,this.uvs=r,this.materials=a}return i(e,[{key:"serialize",value:function(){return{indices:this.indices,positions:this.positions,normals:this.normals,uvs:this.uvs,materials:this.materials}}},{key:"deserialize",value:function(t){var i=this;return null!==t?(this.indices=t.indices,this.positions=t.positions,this.normals=t.normals,this.uvs=t.uvs,this.materials=t.materials):i=null,i}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.push(this.indices.buffer),t.push(this.positions.buffer),t.push(this.normals.buffer),t.push(this.uvs.buffer),t.push(this.materials.buffer),t}}]),e}(),ti=[new Uint8Array([0,4,0]),new Uint8Array([1,5,0]),new Uint8Array([2,6,0]),new Uint8Array([3,7,0]),new Uint8Array([0,2,1]),new Uint8Array([4,6,1]),new Uint8Array([1,3,1]),new Uint8Array([5,7,1]),new Uint8Array([0,1,2]),new Uint8Array([2,3,2]),new Uint8Array([4,5,2]),new Uint8Array([6,7,2])],ii=[new Uint8Array([0,1,2,3,0]),new Uint8Array([4,5,6,7,0]),new Uint8Array([0,4,1,5,1]),new Uint8Array([2,6,3,7,1]),new Uint8Array([0,2,4,6,2]),new Uint8Array([1,3,5,7,2])],ei=[[new Uint8Array([4,0,0]),new Uint8Array([5,1,0]),new Uint8Array([6,2,0]),new Uint8Array([7,3,0])],[new Uint8Array([2,0,1]),new Uint8Array([6,4,1]),new Uint8Array([3,1,1]),new Uint8Array([7,5,1])],[new Uint8Array([1,0,2]),new Uint8Array([3,2,2]),new Uint8Array([5,4,2]),new Uint8Array([7,6,2])]],ni=[[new Uint8Array([1,4,0,5,1,1]),new Uint8Array([1,6,2,7,3,1]),new Uint8Array([0,4,6,0,2,2]),new Uint8Array([0,5,7,1,3,2])],[new Uint8Array([0,2,3,0,1,0]),new Uint8Array([0,6,7,4,5,0]),new Uint8Array([1,2,0,6,4,2]),new Uint8Array([1,3,1,7,5,2])],[new Uint8Array([1,1,0,3,2,0]),new Uint8Array([1,5,4,7,6,0]),new Uint8Array([0,1,5,0,4,1]),new Uint8Array([0,3,7,2,6,1])]],si=[[new Uint8Array([3,2,1,0,0]),new Uint8Array([7,6,5,4,0])],[new Uint8Array([5,1,4,0,1]),new Uint8Array([7,3,6,2,1])],[new Uint8Array([6,4,2,0,2]),new Uint8Array([7,5,3,1,2])]],ri=[new Uint8Array([3,2,1,0]),new Uint8Array([7,5,6,4]),new Uint8Array([11,10,9,8])],ai=Math.pow(2,16)-1;function oi(t,i,e){var n=[0,0,0,0],s=void 0,r=void 0,a=void 0,o=void 0;if(null!==t[0].voxel&&null!==t[1].voxel&&null!==t[2].voxel&&null!==t[3].voxel)!function(t,i,e){var n=[-1,-1,-1,-1],s=[!1,!1,!1,!1],r=1/0,a=0,o=!1,h=void 0,u=void 0,l=void 0,c=void 0,y=void 0,v=void 0,d=void 0;for(d=0;d<4;++d)y=t[d],v=ri[i][d],h=X[v][0],u=X[v][1],l=y.voxel.materials>>h&1,c=y.voxel.materials>>u&1,y.size<r&&(r=y.size,a=d,o=l!==St.AIR),n[d]=y.voxel.index,s[d]=l!==c;s[a]&&(o?(e.push(n[0]),e.push(n[3]),e.push(n[1]),e.push(n[0]),e.push(n[2]),e.push(n[3])):(e.push(n[0]),e.push(n[1]),e.push(n[3]),e.push(n[0]),e.push(n[3]),e.push(n[2])))}(t,i,e);else for(a=0;a<2;++a){for(n[0]=si[i][a][0],n[1]=si[i][a][1],n[2]=si[i][a][2],n[3]=si[i][a][3],s=[],o=0;o<4;++o)if(null!==(r=t[o]).voxel)s[o]=r;else{if(null===r.children)break;s[o]=r.children[n[o]]}4===o&&oi(s,si[i][a][4],e)}}function hi(t,i,e){var n=[0,0,0,0],s=[[0,0,1,1],[0,1,0,1]],r=void 0,a=void 0,o=void 0,h=void 0,u=void 0;if(null!==t[0].children||null!==t[1].children){for(h=0;h<4;++h)n[0]=ei[i][h][0],n[1]=ei[i][h][1],hi([null===t[0].children?t[0]:t[0].children[n[0]],null===t[1].children?t[1]:t[1].children[n[1]]],ei[i][h][2],e);for(h=0;h<4;++h){for(n[0]=ni[i][h][1],n[1]=ni[i][h][2],n[2]=ni[i][h][3],n[3]=ni[i][h][4],a=s[ni[i][h][0]],r=[],u=0;u<4;++u)if(null!==(o=t[a[u]]).voxel)r[u]=o;else{if(null===o.children)break;r[u]=o.children[n[u]]}4===u&&oi(r,ni[i][h][5],e)}}}var ui=function(){function e(){t(this,e)}return i(e,null,[{key:"run",value:function(t){var i=[],e=t.voxelCount,n=null,s=null,r=null,a=null,o=null;return e>ai?console.warn("Could not create geometry for cell at position",t.min,"(vertex count of",e,"exceeds limit of ",ai,")"):e>0&&(s=new Float32Array(3*e),r=new Float32Array(3*e),a=new Float32Array(2*e),o=new Uint8Array(e),function t(i,e,n,s){var r=void 0,a=void 0;if(null!==i.children)for(r=0;r<8;++r)s=t(i.children[r],e,n,s);else null!==i.voxel&&((a=i.voxel).index=s,e[3*s]=a.position.x,e[3*s+1]=a.position.y,e[3*s+2]=a.position.z,n[3*s]=a.normal.x,n[3*s+1]=a.normal.y,n[3*s+2]=a.normal.z,++s);return s}(t.root,s,r,0),function t(i,e){var n=i.children,s=[0,0,0,0],r=void 0;if(null!==n){for(r=0;r<8;++r)t(n[r],e);for(r=0;r<12;++r)s[0]=ti[r][0],s[1]=ti[r][1],hi([n[s[0]],n[s[1]]],ti[r][2],e);for(r=0;r<6;++r)s[0]=ii[r][0],s[1]=ii[r][1],s[2]=ii[r][2],s[3]=ii[r][3],oi([n[s[0]],n[s[1]],n[s[2]],n[s[3]]],ii[r][4],e)}}(t.root,i),n=new $t(new Uint16Array(i),s,r,a,o)),n}}]),e}();function li(t,i,e,n,s){var r=0;for(i>>=1;i>0;i>>=1,r=0)e>=i&&(r+=4,e-=i),n>=i&&(r+=2,n-=i),s>=i&&(r+=1,s-=i),null===t.children&&t.split(),t=t.children[r];return t}function ci(t,i,e,n,s){var r=t+1,a=r*r,o=new Gt,h=void 0,u=void 0,l=void 0,c=void 0,y=void 0;for(h=0,y=0;y<8;++y)c=(n+(l=Y[y])[2])*a+(e+l[1])*r+(i+l[0]),h|=Math.min(s[c],St.SOLID)<<y;for(u=0,y=0;y<12;++y)(h>>X[y][0]&1)!==(h>>X[y][1]&1)&&++u;return o.materials=h,o.edgeCount=u,o.qefData=new _t,o}var yi=function(e){n(r,st);function r(i){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;t(this,r);var a=s(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return a.root=new Kt(e,n),a.voxelCount=0,null!==i&&null!==i.edgeData&&a.construct(i),Kt.errorThreshold>=0&&a.simplify(),a}return i(r,[{key:"simplify",value:function(){this.voxelCount-=this.root.collapse()}},{key:"construct",value:function(t){var i=Ot.resolution,e=t.edgeData,n=t.materialIndices,s=new Qt,r=new o,a=[e.edgesX(this.min,this.root.size),e.edgesY(this.min,this.root.size),e.edgesZ(this.min,this.root.size)],h=[new Uint8Array([0,1,2,3]),new Uint8Array([0,1,4,5]),new Uint8Array([0,2,4,6])],u=0,l=void 0,c=void 0,y=void 0,v=void 0,d=void 0,f=void 0,m=void 0,x=void 0,p=void 0,g=void 0,k=void 0;for(g=0;g<3;++g){y=h[g],l=a[g];var w=!0,z=!1,M=void 0;try{for(var b,A=l[Symbol.iterator]();!(w=(b=A.next()).done);w=!0)for((c=b.value).computeZeroCrossingPosition(r),k=0;k<4;++k)v=Y[y[k]],m=c.coordinates.x-v[0],x=c.coordinates.y-v[1],p=c.coordinates.z-v[2],m>=0&&x>=0&&p>=0&&m<i&&x<i&&p<i&&(null===(d=li(this.root,i,m,x,p)).voxel&&(d.voxel=ci(i,m,x,p,n),++u),(f=d.voxel).normal.add(c.n),f.qefData.add(r,c.n),f.qefData.numPoints===f.edgeCount&&(s.setData(f.qefData).solve(f.position),d.contains(f.position)||f.position.copy(s.massPoint),f.normal.normalize()))}catch(t){z=!0,M=t}finally{try{!w&&A.return&&A.return()}finally{if(z)throw M}}}this.voxelCount=u}}]),r}(),vi={EXTRACT:"worker.extract",MODIFY:"worker.modify",CONFIGURE:"worker.config",CLOSE:"worker.close"},di=function(i){n(e,Wt);function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t(this,e);var n=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i));return n.data=null,n}return e}(),fi=function(i){n(e,di);function e(){t(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,vi.EXTRACT));return i.isosurface=null,i}return e}(),mi=new Ot(!1),xi=function(){function e(){t(this,e),this.data=null,this.response=null}return i(e,[{key:"getData",value:function(){return this.data}},{key:"respond",value:function(){return this.response.data=this.data.serialize(),this.response}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return null!==this.data&&this.data.createTransferList(t),t}},{key:"process",value:function(t){return this.data=mi.deserialize(t.data),this}}]),e}(),pi=function(r){n(a,xi);function a(){t(this,a);var i=s(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return i.response=new fi,i.decompressionTarget=new Ot(!1),i.isosurface=null,i}return i(a,[{key:"respond",value:function(){var t=e(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"respond",this).call(this);return t.isosurface=null!==this.isosurface?this.isosurface.serialise():null,t}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"createTransferList",this).call(this,t),null!==this.isosurface?this.isosurface.createTransferList(t):t}},{key:"process",value:function(t){var i=e(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"process",this).call(this,t).getData(),n=new yi(i.decompress(this.decompressionTarget));return this.isosurface=ui.run(n),this.decompressionTarget.clear(),this}}]),a}(),gi={UNION:"csg.union",DIFFERENCE:"csg.difference",INTERSECTION:"csg.intersection",DENSITY_FUNCTION:"csg.densityfunction"},ki=function(){function e(i){t(this,e),this.type=i;for(var n=arguments.length,s=Array(n>1?n-1:0),r=1;r<n;r++)s[r-1]=arguments[r];this.children=s,this.boundingBox=null}return i(e,[{key:"getBoundingBox",value:function(){return null===this.boundingBox&&(this.boundingBox=this.computeBoundingBox()),this.boundingBox}},{key:"computeBoundingBox",value:function(){var t=this.children,i=new u,e=void 0,n=void 0;for(e=0,n=t.length;e<n;++e)i.union(t[e].getBoundingBox());return i}}]),e}(),wi=function(e){n(r,ki);function r(){var i;t(this,r);for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];return s(this,(i=r.__proto__||Object.getPrototypeOf(r)).call.apply(i,[this,gi.UNION].concat(n)))}return i(r,[{key:"updateMaterialIndex",value:function(t,i,e){var n=e.materialIndices[t];n!==St.AIR&&i.setMaterialIndex(t,n)}},{key:"selectEdge",value:function(t,i,e){return e?t.t>i.t?t:i:t.t<i.t?t:i}}]),r}(),zi=function(e){n(r,ki);function r(){var i;t(this,r);for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];return s(this,(i=r.__proto__||Object.getPrototypeOf(r)).call.apply(i,[this,gi.DIFFERENCE].concat(n)))}return i(r,[{key:"updateMaterialIndex",value:function(t,i,e){e.materialIndices[t]!==St.AIR&&i.setMaterialIndex(t,St.AIR)}},{key:"selectEdge",value:function(t,i,e){return e?t.t<i.t?t:i:t.t>i.t?t:i}}]),r}(),Mi=function(e){n(r,ki);function r(){var i;t(this,r);for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];return s(this,(i=r.__proto__||Object.getPrototypeOf(r)).call.apply(i,[this,gi.INTERSECTION].concat(n)))}return i(r,[{key:"updateMaterialIndex",value:function(t,i,e){var n=e.materialIndices[t];i.setMaterialIndex(t,i.materialIndices[t]!==St.AIR&&n!==St.AIR?n:St.AIR)}},{key:"selectEdge",value:function(t,i,e){return e?t.t<i.t?t:i:t.t>i.t?t:i}}]),r}(),bi=0,Ai=new o;function Si(t,i,e){var n=function(t){var i=bi,e=Ot.resolution,n=new o(0,0,0),s=new o(e,e,e),r=new u(Ai,Ai.clone().addScalar(bi)),a=t.getBoundingBox();return t.type!==gi.INTERSECTION&&(a.intersectsBox(r)?(n.copy(a.min).max(r.min).sub(r.min),n.x=Math.ceil(n.x*e/i),n.y=Math.ceil(n.y*e/i),n.z=Math.ceil(n.z*e/i),s.copy(a.max).min(r.max).sub(r.min),s.x=Math.floor(s.x*e/i),s.y=Math.floor(s.y*e/i),s.z=Math.floor(s.z*e/i)):(n.set(e,e,e),s.set(0,0,0))),new u(n,s)}(t),s=void 0,r=void 0,a=void 0,h=void 0,l=!1;if(t.type===gi.DENSITY_FUNCTION?function(t,i,e){var n=bi,s=Ot.resolution,r=s+1,a=r*r,h=i.materialIndices,u=Ai,l=new o,c=new o,y=e.max.x,v=e.max.y,d=e.max.z,f=void 0,m=0,x=void 0,p=void 0,g=void 0;for(g=e.min.z;g<=d;++g)for(l.z=g*n/s,p=e.min.y;p<=v;++p)for(l.y=p*n/s,x=e.min.x;x<=y;++x)l.x=x*n/s,(f=t.generateMaterialIndex(c.addVectors(u,l)))!==St.AIR&&(h[g*a+p*r+x]=f,++m);i.materials=m}(t,i,n):i.empty?t.type===gi.UNION&&(i.set(e),l=!0):i.full&&t.type===gi.UNION||function(t,i,e,n){var s=Ot.resolution+1,r=s*s,a=n.max.x,o=n.max.y,h=n.max.z,u=void 0,l=void 0,c=void 0;for(c=n.min.z;c<=h;++c)for(l=n.min.y;l<=o;++l)for(u=n.min.x;u<=a;++u)t.updateMaterialIndex(c*r+l*s+u,i,e)}(t,i,e,n),!l&&!i.empty&&!i.full){for(r=(s=t.type===gi.DENSITY_FUNCTION?function(t,i,e){var n=bi,s=Ot.resolution,r=s+1,a=r*r,h=new Uint32Array([1,r,a]),u=i.materialIndices,l=Ai,c=new o,y=new o,v=new kt,d=new Uint32Array(3),f=new At(At.calculate1DEdgeCount(s)),m=void 0,x=void 0,p=void 0,g=void 0,k=void 0,w=void 0,z=void 0,M=void 0,b=void 0,A=void 0,S=void 0,T=void 0,P=void 0,I=void 0,O=void 0,_=void 0,C=void 0,U=void 0,q=void 0;for(O=4,P=0,I=0;I<3;O>>=1,P=0,++I){switch(_=Y[O],m=f.indices[I],x=f.zeroCrossings[I],p=f.normals[I],g=h[I],z=e.min.x,A=e.max.x,M=e.min.y,S=e.max.y,b=e.min.z,T=e.max.z,I){case 0:z=Math.max(z-1,0),A=Math.min(A,s-1);break;case 1:M=Math.max(M-1,0),S=Math.min(S,s-1);break;case 2:b=Math.max(b-1,0),T=Math.min(T,s-1)}for(q=b;q<=T;++q)for(U=M;U<=S;++U)for(C=z;C<=A;++C)w=(k=q*a+U*r+C)+g,u[k]!==u[w]&&(c.set(C*n/s,U*n/s,q*n/s),y.set((C+_[0])*n/s,(U+_[1])*n/s,(q+_[2])*n/s),v.a.addVectors(l,c),v.b.addVectors(l,y),t.generateEdge(v),m[P]=k,x[P]=v.t,p[3*P]=v.n.x,p[3*P+1]=v.n.y,p[3*P+2]=v.n.z,++P);d[I]=P}return{edgeData:f,lengths:d}}(t,i,n):function(t,i,e){var n=Ot.resolution,s=n+1,r=new Uint32Array([1,s,s*s]),a=i.materialIndices,o=new kt,h=new kt,u=e.edgeData,l=i.edgeData,c=new Uint32Array(3),y=At.calculate1DEdgeCount(n),v=new At(Math.min(y,l.indices[0].length+u.indices[0].length),Math.min(y,l.indices[1].length+u.indices[1].length),Math.min(y,l.indices[2].length+u.indices[2].length)),d=void 0,f=void 0,m=void 0,x=void 0,p=void 0,g=void 0,k=void 0,w=void 0,z=void 0,M=void 0,b=void 0,A=void 0,S=void 0,T=void 0,P=void 0,I=void 0,O=void 0,_=void 0,C=void 0,U=void 0,q=void 0,F=void 0,E=void 0;for(_=0,C=0;C<3;_=0,++C){for(d=u.indices[C],x=l.indices[C],k=v.indices[C],f=u.zeroCrossings[C],p=l.zeroCrossings[C],w=v.zeroCrossings[C],m=u.normals[C],g=l.normals[C],z=v.normals[C],M=r[C],F=d.length,E=x.length,U=0,q=0;U<F;++U)if(A=(b=d[U])+M,(P=a[b])!==(I=a[A])&&(P===St.AIR||I===St.AIR)){for(o.t=f[U],o.n.x=m[3*U],o.n.y=m[3*U+1],o.n.z=m[3*U+2],t.type===gi.DIFFERENCE&&o.n.negate(),O=o;q<E&&x[q]<=b;)T=(S=x[q])+M,h.t=p[q],h.n.x=g[3*q],h.n.y=g[3*q+1],h.n.z=g[3*q+2],P=a[S],S<b?P===(I=a[T])||P!==St.AIR&&I!==St.AIR||(k[_]=S,w[_]=h.t,z[3*_]=h.n.x,z[3*_+1]=h.n.y,z[3*_+2]=h.n.z,++_):O=t.selectEdge(h,o,P===St.SOLID),++q;k[_]=b,w[_]=O.t,z[3*_]=O.n.x,z[3*_+1]=O.n.y,z[3*_+2]=O.n.z,++_}for(;q<E;)T=(S=x[q])+M,(P=a[S])===(I=a[T])||P!==St.AIR&&I!==St.AIR||(k[_]=S,w[_]=p[q],z[3*_]=g[3*q],z[3*_+1]=g[3*q+1],z[3*_+2]=g[3*q+2],++_),++q;c[C]=_}return{edgeData:v,lengths:c}}(t,i,e)).edgeData,a=s.lengths,h=0;h<3;++h)r.indices[h]=r.indices[h].slice(0,a[h]),r.zeroCrossings[h]=r.zeroCrossings[h].slice(0,a[h]),r.normals[h]=r.normals[h].slice(0,3*a[h]);i.edgeData=r}}var Ti=function(){function e(){t(this,e)}return i(e,null,[{key:"run",value:function(t,i,e,n){Ai.fromArray(t),bi=i,null===e?n.operation===gi.UNION&&(e=new Ot(!1)):e.decompress();var s=n.toCSG(),r=null!==e?function t(i){var e=i.children,n=void 0,s=void 0,r=void 0,a=void 0;for(i.type===gi.DENSITY_FUNCTION&&Si(i,n=new Ot),r=0,a=e.length;r<a&&(s=t(e[r]),void 0===n?n=s:null!==s?null===n?i.type===gi.UNION&&(n=s):Si(i,n,s):i.type===gi.INTERSECTION&&(n=null),null!==n||i.type===gi.UNION);++r);return null!==n&&n.empty?null:n}(s):null;if(null!==r){switch(n.operation){case gi.UNION:s=new wi(s);break;case gi.DIFFERENCE:s=new zi(s);break;case gi.INTERSECTION:s=new Mi(s)}Si(s,e,r),e.contoured=!1}return null!==e&&e.empty?null:e}}]),e}(),Pi=function(e){n(r,ki);function r(i){t(this,r);var e=s(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,gi.DENSITY_FUNCTION));return e.sdf=i,e}return i(r,[{key:"computeBoundingBox",value:function(){return this.sdf.getBoundingBox(!0)}},{key:"generateMaterialIndex",value:function(t){return this.sdf.sample(t)<=Ot.isovalue?this.sdf.material:St.AIR}},{key:"generateEdge",value:function(t){t.approximateZeroCrossing(this.sdf),t.computeSurfaceNormal(this.sdf)}}]),r}(),Ii=new E,Oi=function(){function e(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:St.SOLID;t(this,e),this.type=i,this.operation=null,this.material=Math.min(255,Math.max(St.SOLID,Math.trunc(n))),this.boundingBox=null,this.position=new o,this.quaternion=new z,this.scale=new o(1,1,1),this.inverseTransformation=new E,this.updateInverseTransformation(),this.children=[]}return i(e,[{key:"getTransformation",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new E).compose(this.position,this.quaternion,this.scale)}},{key:"getBoundingBox",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=this.children,e=this.boundingBox,n=void 0,s=void 0;if(null===e&&(e=this.computeBoundingBox(),this.boundingBox=e),t)for(e=e.clone(),n=0,s=i.length;n<s;++n)e.union(i[n].getBoundingBox(t));return e}},{key:"setMaterial",value:function(t){return this.material=Math.min(255,Math.max(St.SOLID,Math.trunc(t))),this}},{key:"setOperationType",value:function(t){return this.operation=t,this}},{key:"updateInverseTransformation",value:function(){return this.inverseTransformation.getInverse(this.getTransformation(Ii)),this.boundingBox=null,this}},{key:"union",value:function(t){return this.children.push(t.setOperationType(gi.UNION)),this}},{key:"subtract",value:function(t){return this.children.push(t.setOperationType(gi.DIFFERENCE)),this}},{key:"intersect",value:function(t){return this.children.push(t.setOperationType(gi.INTERSECTION)),this}},{key:"toCSG",value:function(){var t=this.children,i=new Pi(this),e=void 0,n=void 0,s=void 0,r=void 0;for(s=0,r=t.length;s<r;++s){if(e!==(n=t[s]).operation)switch(e=n.operation){case gi.UNION:i=new wi(i);break;case gi.DIFFERENCE:i=new zi(i);break;case gi.INTERSECTION:i=new Mi(i)}i.children.push(n.toCSG())}return i}},{key:"serialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i={type:this.type,operation:this.operation,material:this.material,position:this.position.toArray(),quaternion:this.quaternion.toArray(),scale:this.scale.toArray(),parameters:null,children:[]},e=void 0,n=void 0;for(e=0,n=this.children.length;e<n;++e)i.children.push(this.children[e].serialize(t));return i}},{key:"createTransferList",value:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}},{key:"toJSON",value:function(){return this.serialize(!0)}},{key:"computeBoundingBox",value:function(){throw new Error("SignedDistanceFunction#computeBoundingBox method not implemented!")}},{key:"sample",value:function(t){throw new Error("SignedDistanceFunction#sample method not implemented!")}}]),e}(),_i={HEIGHTFIELD:"sdf.heightfield",FRACTAL_NOISE:"sdf.fractalnoise",SUPER_PRIMITIVE:"sdf.superprimitive"},Ci=function(a){n(h,Oi);function h(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1];t(this,h);var n=s(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,_i.PERLIN_NOISE,e));return n.min=new(Function.prototype.bind.apply(o,[null].concat(r(i.min)))),n.max=new(Function.prototype.bind.apply(o,[null].concat(r(i.max)))),n}return i(h,[{key:"computeBoundingBox",value:function(){return this.bbox=new u(this.min,this.max),this.bbox}},{key:"sample",value:function(t){}},{key:"serialize",value:function(){var t=e(h.prototype.__proto__||Object.getPrototypeOf(h.prototype),"serialize",this).call(this);return t.parameters={min:this.min.toArray(),max:this.max.toArray()},t}}]),h}();var Ui=function(r){n(a,Oi);function a(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1];t(this,a);var n=s(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,_i.HEIGHTFIELD,e));return n.width=void 0!==i.width?i.width:1,n.height=void 0!==i.height?i.height:1,n.smooth=void 0===i.smooth||i.smooth,n.data=void 0!==i.data?i.data:null,n.heightmap=null,void 0!==i.image&&n.fromImage(i.image),n}return i(a,[{key:"fromImage",value:function(t){var i="undefined"==typeof document?null:function(t){var i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),e=i.getContext("2d");return i.width=t.width,i.height=t.height,e.drawImage(t,0,0),e.getImageData(0,0,t.width,t.height)}(t),e=null,n=void 0,s=void 0,r=void 0,a=void 0;if(null!==i){for(n=i.data,s=0,r=0,a=(e=new Uint8ClampedArray(n.length/4)).length;s<a;++s,r+=4)e[s]=n[r];this.heightmap=t,this.width=i.width,this.height=i.height,this.data=e}return this}},{key:"getHeight",value:function(t,i){var e=this.width,n=this.height,s=this.data,r=void 0;if(t=Math.round(t*e),i=Math.round(i*n),this.smooth){var a=(t=Math.max(Math.min(t,e-1),1))+1,o=t-1,h=(i=Math.max(Math.min(i,n-1),1))*e,u=h+e,l=h-e;r=(s[l+o]+s[l+t]+s[l+a]+s[h+o]+s[h+t]+s[h+a]+s[u+o]+s[u+t]+s[u+a])/9}else r=s[i*e+t];return r}},{key:"computeBoundingBox",value:function(){var t=new u,i=Math.min(this.width/this.height,1),e=Math.min(this.height/this.width,1);return t.min.set(0,0,0),t.max.set(i,1,e),t.applyMatrix4(this.getTransformation()),t}},{key:"sample",value:function(t){var i=this.boundingBox,e=void 0;return i.containsPoint(t)?(t.applyMatrix4(this.inverseTransformation),e=t.y-this.getHeight(t.x,t.z)/255):e=i.distanceToPoint(t),e}},{key:"serialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=e(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"serialize",this).call(this);return i.parameters={width:this.width,height:this.height,smooth:this.smooth,data:t?null:this.data,dataURL:t&&null!==this.heightmap?this.heightmap.toDataURL():null,image:null},i}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.push(this.data.buffer),t}}]),a}(),qi=function(a){n(h,Oi);function h(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1];t(this,h);var n=s(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,_i.SUPER_PRIMITIVE,e));return n.s0=new(Function.prototype.bind.apply(B,[null].concat(r(i.s)))),n.r0=new(Function.prototype.bind.apply(o,[null].concat(r(i.r)))),n.s=new B,n.r=new o,n.ba=new y,n.offset=0,n.precompute(),n}return i(h,[{key:"setSize",value:function(t,i,e,n){return this.s0.set(t,i,e,n),this.precompute()}},{key:"setRadii",value:function(t,i,e){return this.r0.set(t,i,e),this.precompute()}},{key:"precompute",value:function(){var t=this.s.copy(this.s0),i=this.r.copy(this.r0),e=this.ba;t.x-=i.x,t.y-=i.x,i.x-=t.w,t.w-=i.y,t.z-=i.y,this.offset=-2*t.z,e.set(i.z,this.offset);var n=e.dot(e);return 0===n?e.set(0,-1):e.divideScalar(n),this}},{key:"computeBoundingBox",value:function(){var t=this.s0,i=new u;return i.min.x=Math.min(-t.x,-1),i.min.y=Math.min(-t.y,-1),i.min.z=Math.min(-t.z,-1),i.max.x=Math.max(t.x,1),i.max.y=Math.max(t.y,1),i.max.z=Math.max(t.z,1),i.applyMatrix4(this.getTransformation()),i}},{key:"sample",value:function(t){t.applyMatrix4(this.inverseTransformation);var i=this.s,e=this.r,n=this.ba,s=Math.abs(t.x)-i.x,r=Math.abs(t.y)-i.y,a=Math.abs(t.z)-i.z,o=Math.max(s,0),h=Math.max(r,0),u=Math.sqrt(o*o+h*h),l=t.z-i.z,c=Math.abs(u+Math.min(0,Math.max(s,r))-e.x)-i.w,y=Math.min(Math.max(c*n.x+l*n.y,0),1),v=c-e.z*y,d=l-this.offset*y,f=Math.max(c-e.z,0),m=t.z+i.z,x=Math.max(c,0),p=v*v+d*d,g=f*f+m*m,k=x*x+l*l,w=c*-n.y+l*n.x;return Math.sqrt(Math.min(p,Math.min(g,k)))*Math.sign(Math.max(w,a))-e.y}},{key:"serialize",value:function(){var t=e(h.prototype.__proto__||Object.getPrototypeOf(h.prototype),"serialize",this).call(this);return t.parameters={s:this.s0.toArray(),r:this.r0.toArray()},t}}],[{key:"create",value:function(t){var i=Fi[t];return new h({s:i[0],r:i[1]})}}]),h}(),Fi=[[new Float32Array([1,1,1,1]),new Float32Array([0,0,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,0,0])],[new Float32Array([0,0,1,1]),new Float32Array([0,0,1])],[new Float32Array([1,1,2,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,.25,1]),new Float32Array([1,.25,0])],[new Float32Array([1,1,.25,.25]),new Float32Array([1,.25,0])],[new Float32Array([1,1,1,.25]),new Float32Array([1,.1,0])],[new Float32Array([1,1,1,.25]),new Float32Array([.1,.1,0])]],Ei=function(){function e(){t(this,e)}return i(e,[{key:"revive",value:function(t){var i=void 0,e=void 0,n=void 0;switch(t.type){case _i.FRACTAL_NOISE:i=new Ci(t.parameters,t.material);break;case _i.HEIGHTFIELD:i=new Ui(t.parameters,t.material);break;case _i.SUPER_PRIMITIVE:i=new qi(t.parameters,t.material)}for(i.operation=t.operation,i.position.fromArray(t.position),i.quaternion.fromArray(t.quaternion),i.scale.fromArray(t.scale),i.updateInverseTransformation(),e=0,n=t.children.length;e<n;++e)i.children.push(this.revive(t.children[e]));return i}}]),e}(),Di=function(i){n(e,di);function e(){t(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,vi.MODIFY));return i.sdf=null,i}return e}(),Vi=new(function(r){n(a,xi);function a(){t(this,a);var i=s(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return i.response=new Di,i.sdf=null,i}return i(a,[{key:"respond",value:function(){var t=e(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"respond",this).call(this);return t.sdf=null!==this.sdf?this.sdf.serialize():null,t}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"createTransferList",this).call(this,t),null!==this.sdf?this.sdf.createTransferList(t):t}},{key:"process",value:function(t){var i=e(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"process",this).call(this,t).getData(),n=this.sdf=Ei.revive(t.sdf),s=Ti.run(t.cellPosition,t.cellSize,i,n);return function t(i,e,n,s){var r=Object.getOwnPropertyDescriptor(i,e);if(void 0===r){var a=Object.getPrototypeOf(i);null!==a&&t(a,e,n,s)}else if("value"in r&&r.writable)r.value=n;else{var o=r.set;void 0!==o&&o.call(s,n)}return n}(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"data",null!==s?s.compress():null,this),this}}]),a}()),Ni=new pi,Bi=null;self.addEventListener("message",function(t){var i=t.data;switch(Bi=i.action){case vi.MODIFY:postMessage(Vi.process(i).respond(),Vi.createTransferList());break;case vi.EXTRACT:postMessage(Ni.process(i).respond(),Ni.createTransferList());break;case vi.CONFIGURE:Ot.resolution=i.resolution,Kt.errorThreshold=i.errorThreshold;break;case vi.CLOSE:default:close()}}),self.addEventListener("error",function(t){var i=Bi===vi.MODIFY?Vi:Bi===vi.EXTRACT?Ni:null,e=void 0;null!==i?((e=i.respond()).action=vi.CLOSE,e.error=t,postMessage(e,i.createTransferList())):((e=new Wt(vi.CLOSE)).error=t,postMessage(e)),close()})}();',Ti=function(t){a(e,c);function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:navigator.hardwareConcurrency;n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.workerURL=URL.createObjectURL(new Blob([Ii],{type:"text/javascript"})),i.maxWorkers=Math.min(navigator.hardwareConcurrency,Math.max(t,1)),i.workers=[],i.busyWorkers=new WeakSet,i.configurationMessage=new Pi,i}return s(e,[{key:"handleEvent",value:function(t){switch(t.type){case"message":this.busyWorkers.delete(t.target),_i.worker=t.target,_i.response=t.data,this.dispatchEvent(_i),this.workers.length>this.maxWorkers&&this.closeWorker(t.target);break;case"error":console.error("Encountered an unexpected error",t)}}},{key:"closeWorker",value:function(t){var e=this.workers.indexOf(t);this.busyWorkers.has(t)?(this.busyWorkers.delete(t),t.terminate()):t.postMessage(new Ai(bi.CLOSE)),t.removeEventListener("message",this),t.removeEventListener("error",this),e>=0&&this.workers.splice(e,1)}},{key:"createWorker",value:function(){var t=new Worker(this.workerURL);return this.workers.push(t),t.addEventListener("message",this),t.addEventListener("error",this),t.postMessage(this.configurationMessage),t}},{key:"getWorker",value:function(){var t=null,e=void 0,i=void 0;for(e=0,i=this.workers.length;e<i;++e)if(!this.busyWorkers.has(this.workers[e])){t=this.workers[e],this.busyWorkers.add(t);break}return null===t&&this.workers.length<this.maxWorkers&&null!==this.workerURL&&(t=this.createWorker(),this.busyWorkers.add(t)),t}},{key:"clear",value:function(){for(;this.workers.length>0;)this.closeWorker(this.workers.pop())}},{key:"dispose",value:function(){this.clear(),URL.revokeObjectURL(this.workerURL),this.workerURL=null}}]),e}(),Di=function(t){a(e,l);function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.octant=null,i.octantId=null,i.error=null,i}return e}(),Ci=(new Di("modificationstart"),new Di("modificationend"),new Di("extractionstart"),new Di("extractionend"),new Di("load")),Ui=(new Di("error"),function(t){a(e,c);function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e);var i=void 0!==t.world?t.world:{};_e.resolution=void 0!==t.resolution?t.resolution:32;var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return s.object=null,s.world=new pi(i.cellSize,i.levels,i.keyDesign),s.clipmap=new Mi(s.world),s.clipmap.addEventListener("shellupdate",s),s.threadPool=new Ti(t.workers),s.threadPool.addEventListener("message",s),s.tasks=new WeakMap,s.sdfLoader=new Ve,s.sdfLoader.addEventListener("load",s),s.history=[],s.dtSq=s.world.getCellSize(),s}s(e,[{key:"handleEvent",value:function(t){switch(t.type){case"shellupdate":case"message":break;case"load":this.revive(t.descriptions),this.dispatchEvent(Ci)}}},{key:"applyCSG",value:function(t){this.world.applyCSG(t),this.history.push(t)}},{key:"union",value:function(t){this.applyCSG(t.setOperationType(Ut.UNION))}},{key:"subtract",value:function(t){this.applyCSG(t.setOperationType(Ut.DIFFERENCE))}},{key:"intersect",value:function(t){this.applyCSG(t.setOperationType(Ut.INTERSECTION))}},{key:"update",value:function(t){this.clipmap.position.distanceToSquared(t)>=this.dtSq&&this.clipmap.update(t)}},{key:"raycast",value:function(t){return this.world.raycast(t)}},{key:"clear",value:function(){this.world.clear(),this.clipmap.clear(),this.threadPool.clear(),this.sdfLoader.clear(),this.tasks=new WeakMap,this.history=[]}},{key:"dispose",value:function(){this.threadPool.dispose()}},{key:"revive",value:function(t){var e=void 0,i=void 0;for(e=0,i=t.length;e<i;++e)this.applyCSG(Be.revive(t[e]))}},{key:"save",value:function(){return 0===this.history.length?null:URL.createObjectURL(new Blob([JSON.stringify(this.history)],{type:"text/json"}))}},{key:"load",value:function(t){var e=JSON.parse(t);this.clear(),this.sdfLoader.load(e)}}])}(),function(){function t(e,i,s,r,a){n(this,t),this.indices=e,this.positions=i,this.normals=s,this.uvs=r,this.materials=a}return s(t,[{key:"serialize",value:function(){return{indices:this.indices,positions:this.positions,normals:this.normals,uvs:this.uvs,materials:this.materials}}},{key:"deserialize",value:function(t){var e=this;return null!==t?(this.indices=t.indices,this.positions=t.positions,this.normals=t.normals,this.uvs=t.uvs,this.materials=t.materials):e=null,e}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.push(this.indices.buffer),t.push(this.positions.buffer),t.push(this.normals.buffer),t.push(this.uvs.buffer),t.push(this.materials.buffer),t}}]),t}()),Fi=[new Uint8Array([0,4,0]),new Uint8Array([1,5,0]),new Uint8Array([2,6,0]),new Uint8Array([3,7,0]),new Uint8Array([0,2,1]),new Uint8Array([4,6,1]),new Uint8Array([1,3,1]),new Uint8Array([5,7,1]),new Uint8Array([0,1,2]),new Uint8Array([2,3,2]),new Uint8Array([4,5,2]),new Uint8Array([6,7,2])],qi=[new Uint8Array([0,1,2,3,0]),new Uint8Array([4,5,6,7,0]),new Uint8Array([0,4,1,5,1]),new Uint8Array([2,6,3,7,1]),new Uint8Array([0,2,4,6,2]),new Uint8Array([1,3,5,7,2])],Li=[[new Uint8Array([4,0,0]),new Uint8Array([5,1,0]),new Uint8Array([6,2,0]),new Uint8Array([7,3,0])],[new Uint8Array([2,0,1]),new Uint8Array([6,4,1]),new Uint8Array([3,1,1]),new Uint8Array([7,5,1])],[new Uint8Array([1,0,2]),new Uint8Array([3,2,2]),new Uint8Array([5,4,2]),new Uint8Array([7,6,2])]],Ni=[[new Uint8Array([1,4,0,5,1,1]),new Uint8Array([1,6,2,7,3,1]),new Uint8Array([0,4,6,0,2,2]),new Uint8Array([0,5,7,1,3,2])],[new Uint8Array([0,2,3,0,1,0]),new Uint8Array([0,6,7,4,5,0]),new Uint8Array([1,2,0,6,4,2]),new Uint8Array([1,3,1,7,5,2])],[new Uint8Array([1,1,0,3,2,0]),new Uint8Array([1,5,4,7,6,0]),new Uint8Array([0,1,5,0,4,1]),new Uint8Array([0,3,7,2,6,1])]],Bi=[[new Uint8Array([3,2,1,0,0]),new Uint8Array([7,6,5,4,0])],[new Uint8Array([5,1,4,0,1]),new Uint8Array([7,3,6,2,1])],[new Uint8Array([6,4,2,0,2]),new Uint8Array([7,5,3,1,2])]],Ri=[new Uint8Array([3,2,1,0]),new Uint8Array([7,5,6,4]),new Uint8Array([11,10,9,8])],Vi=Math.pow(2,16)-1;function ji(t,e,i){var n=[0,0,0,0],s=void 0,r=void 0,a=void 0,o=void 0;if(null!==t[0].voxel&&null!==t[1].voxel&&null!==t[2].voxel&&null!==t[3].voxel)!function(t,e,i){var n=[-1,-1,-1,-1],s=[!1,!1,!1,!1],r=1/0,a=0,o=!1,h=void 0,u=void 0,l=void 0,c=void 0,d=void 0,y=void 0,v=void 0;for(v=0;v<4;++v)d=t[v],y=Ri[e][v],h=Gt[y][0],u=Gt[y][1],l=d.voxel.materials>>h&1,c=d.voxel.materials>>u&1,d.size<r&&(r=d.size,a=v,o=l!==Ft.AIR),n[v]=d.voxel.index,s[v]=l!==c;s[a]&&(o?(i.push(n[0]),i.push(n[3]),i.push(n[1]),i.push(n[0]),i.push(n[2]),i.push(n[3])):(i.push(n[0]),i.push(n[1]),i.push(n[3]),i.push(n[0]),i.push(n[3]),i.push(n[2])))}(t,e,i);else for(a=0;a<2;++a){for(n[0]=Bi[e][a][0],n[1]=Bi[e][a][1],n[2]=Bi[e][a][2],n[3]=Bi[e][a][3],s=[],o=0;o<4;++o)if(null!==(r=t[o]).voxel)s[o]=r;else{if(null===r.children)break;s[o]=r.children[n[o]]}4===o&&ji(s,Bi[e][a][4],i)}}function Yi(t,e,i){var n=[0,0,0,0],s=[[0,0,1,1],[0,1,0,1]],r=void 0,a=void 0,o=void 0,h=void 0,u=void 0;if(null!==t[0].children||null!==t[1].children){for(h=0;h<4;++h)n[0]=Li[e][h][0],n[1]=Li[e][h][1],Yi([null===t[0].children?t[0]:t[0].children[n[0]],null===t[1].children?t[1]:t[1].children[n[1]]],Li[e][h][2],i);for(h=0;h<4;++h){for(n[0]=Ni[e][h][1],n[1]=Ni[e][h][2],n[2]=Ni[e][h][3],n[3]=Ni[e][h][4],a=s[Ni[e][h][0]],r=[],u=0;u<4;++u)if(null!==(o=t[a[u]]).voxel)r[u]=o;else{if(null===o.children)break;r[u]=o.children[n[u]]}4===u&&ji(r,Ni[e][h][5],i)}}}var Xi=function(){function t(){n(this,t)}return s(t,null,[{key:"run",value:function(t){var e=[],i=t.voxelCount,n=null,s=null,r=null,a=null,o=null;return i>Vi?console.warn("Could not create geometry for cell at position",t.min,"(vertex count of",i,"exceeds limit of ",Vi,")"):i>0&&(s=new Float32Array(3*i),r=new Float32Array(3*i),a=new Float32Array(2*i),o=new Uint8Array(i),function t(e,i,n,s){var r=void 0,a=void 0;if(null!==e.children)for(r=0;r<8;++r)s=t(e.children[r],i,n,s);else null!==e.voxel&&((a=e.voxel).index=s,i[3*s]=a.position.x,i[3*s+1]=a.position.y,i[3*s+2]=a.position.z,n[3*s]=a.normal.x,n[3*s+1]=a.normal.y,n[3*s+2]=a.normal.z,++s);return s}(t.root,s,r,0),function t(e,i){var n=e.children,s=[0,0,0,0],r=void 0;if(null!==n){for(r=0;r<8;++r)t(n[r],i);for(r=0;r<12;++r)s[0]=Fi[r][0],s[1]=Fi[r][1],Yi([n[s[0]],n[s[1]]],Fi[r][2],i);for(r=0;r<6;++r)s[0]=qi[r][0],s[1]=qi[r][1],s[2]=qi[r][2],s[3]=qi[r][3],ji([n[s[0]],n[s[1]],n[s[2]],n[s[3]]],qi[r][4],i)}}(t.root,e),n=new Ui(new Uint16Array(e),s,r,a,o)),n}}]),t}(),Gi=new M,Hi=function(){function t(){n(this,t)}return s(t,null,[{key:"calculateCoefficients",value:function(t,e,i){var n=void 0,s=void 0,r=void 0;return 0===e?(Gi.x=1,Gi.y=0):(n=(i-t)/(2*e),s=Math.sqrt(1+n*n),r=1/(n>=0?n+s:n-s),Gi.x=1/Math.sqrt(1+r*r),Gi.y=r*Gi.x),Gi}}]),t}(),Wi=function(){function t(){n(this,t)}return s(t,null,[{key:"rotateXY",value:function(t,e){var i=e.x,n=e.y,s=t.x,r=t.y;t.set(i*s-n*r,n*s+i*r)}},{key:"rotateQXY",value:function(t,e,i){var n=i.x,s=i.y,r=n*n,a=s*s,o=2*n*s*e,h=t.x,u=t.y;t.set(r*h-o+a*u,a*h+o+r*u)}}]),t}(),Ki=.1,Zi=5,Qi=new tt,Ji=new A,$i=new M,tn=new p;function en(t,e){var i=t.elements,n=e.elements,s=void 0;0!==i[1]&&(s=Hi.calculateCoefficients(i[0],i[1],i[3]),Wi.rotateQXY($i.set(i[0],i[3]),i[1],s),i[0]=$i.x,i[3]=$i.y,Wi.rotateXY($i.set(i[2],i[4]),s),i[2]=$i.x,i[4]=$i.y,i[1]=0,Wi.rotateXY($i.set(n[0],n[3]),s),n[0]=$i.x,n[3]=$i.y,Wi.rotateXY($i.set(n[1],n[4]),s),n[1]=$i.x,n[4]=$i.y,Wi.rotateXY($i.set(n[2],n[5]),s),n[2]=$i.x,n[5]=$i.y)}function nn(t,e){var i=t.elements,n=e.elements,s=void 0;0!==i[2]&&(s=Hi.calculateCoefficients(i[0],i[2],i[5]),Wi.rotateQXY($i.set(i[0],i[5]),i[2],s),i[0]=$i.x,i[5]=$i.y,Wi.rotateXY($i.set(i[1],i[4]),s),i[1]=$i.x,i[4]=$i.y,i[2]=0,Wi.rotateXY($i.set(n[0],n[6]),s),n[0]=$i.x,n[6]=$i.y,Wi.rotateXY($i.set(n[1],n[7]),s),n[1]=$i.x,n[7]=$i.y,Wi.rotateXY($i.set(n[2],n[8]),s),n[2]=$i.x,n[8]=$i.y)}function sn(t,e){var i=t.elements,n=e.elements,s=void 0;0!==i[4]&&(s=Hi.calculateCoefficients(i[3],i[4],i[5]),Wi.rotateQXY($i.set(i[3],i[5]),i[4],s),i[3]=$i.x,i[5]=$i.y,Wi.rotateXY($i.set(i[1],i[2]),s),i[1]=$i.x,i[2]=$i.y,i[4]=0,Wi.rotateXY($i.set(n[3],n[6]),s),n[3]=$i.x,n[6]=$i.y,Wi.rotateXY($i.set(n[4],n[7]),s),n[4]=$i.x,n[7]=$i.y,Wi.rotateXY($i.set(n[5],n[8]),s),n[5]=$i.x,n[8]=$i.y)}function rn(t){var e=Math.abs(t)<Ki?0:1/t;return Math.abs(e)<Ki?0:e}var an=function(){function t(){n(this,t)}return s(t,null,[{key:"solve",value:function(t,e,i){var n=function(t,e){var i=t.elements,n=void 0;for(n=0;n<Zi;++n)en(t,e),nn(t,e),sn(t,e);return tn.set(i[0],i[3],i[5])}(Qi.copy(t),Ji.identity()),s=function(t,e){var i=t.elements,n=i[0],s=i[3],r=i[6],a=i[1],o=i[4],h=i[7],u=i[2],l=i[5],c=i[8],d=rn(e.x),y=rn(e.y),v=rn(e.z);return t.set(n*d*n+s*y*s+r*v*r,n*d*a+s*y*o+r*v*h,n*d*u+s*y*l+r*v*c,a*d*n+o*y*s+h*v*r,a*d*a+o*y*o+h*v*h,a*d*u+o*y*l+h*v*c,u*d*n+l*y*s+c*v*r,u*d*a+l*y*o+c*v*h,u*d*u+l*y*l+c*v*c)}(Ji,n);i.copy(e).applyMatrix3(s)}}]),t}(),on=new p;var hn=function(){function t(){n(this,t),this.data=null,this.ata=new tt,this.atb=new p,this.massPoint=new p,this.hasSolution=!1}return s(t,[{key:"setData",value:function(t){return this.data=t,this.hasSolution=!1,this}},{key:"solve",value:function(t){var e=this.data,i=this.massPoint,n=this.ata.copy(e.ata),s=this.atb.copy(e.atb),r=1/0;!this.hasSolution&&null!==e&&e.numPoints>0&&(on.copy(e.massPointSum).divideScalar(e.numPoints),i.copy(on),n.applyToVector3(on),s.sub(on),an.solve(n,s,t),a=s,o=t,n.applyToVector3(on.copy(o)),on.subVectors(a,on),r=on.dot(on),t.add(i),this.hasSolution=!0);var a,o;return r}}]),t}(),un=function(){function t(){n(this,t),this.ata=new tt,this.ata.set(0,0,0,0,0,0),this.atb=new p,this.massPointSum=new p,this.numPoints=0}return s(t,[{key:"set",value:function(t,e,i,n){return this.ata.copy(t),this.atb.copy(e),this.massPointSum.copy(i),this.numPoints=n,this}},{key:"copy",value:function(t){return this.set(t.ata,t.atb,t.massPointSum,t.numPoints)}},{key:"add",value:function(t,e){var i=e.x,n=e.y,s=e.z,r=t.dot(e),a=this.ata.elements,o=this.atb;a[0]+=i*i,a[1]+=i*n,a[3]+=n*n,a[2]+=i*s,a[4]+=n*s,a[5]+=s*s,o.x+=r*i,o.y+=r*n,o.z+=r*s,this.massPointSum.add(t),++this.numPoints}},{key:"addData",value:function(t){this.ata.add(t.ata),this.atb.add(t.atb),this.massPointSum.add(t.massPointSum),this.numPoints+=t.numPoints}},{key:"clear",value:function(){this.ata.set(0,0,0,0,0,0),this.atb.set(0,0,0),this.massPointSum.set(0,0,0),this.numPoints=0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),ln=function t(){n(this,t),this.materials=0,this.edgeCount=0,this.index=-1,this.position=new p,this.normal=new p,this.qefData=null},cn=new hn,dn=-1,yn=function(t){a(e,Wt);function e(t,i){n(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return s.voxel=null,s}return s(e,[{key:"contains",value:function(t){var e=this.min,i=this.size;return t.x>=e.x-.1&&t.y>=e.y-.1&&t.z>=e.z-.1&&t.x<=e.x+i+.1&&t.y<=e.y+i+.1&&t.z<=e.z+i+.1}},{key:"collapse",value:function(){var t=this.children,e=[-1,-1,-1,-1,-1,-1,-1,-1],i=new p,n=-1,s=null!==t,r=0,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0,c=void 0;if(s){for(u=new un,l=0,c=0;c<8;++c)r+=(a=t[c]).collapse(),h=a.voxel,null!==a.children?s=!1:null!==h&&(u.addData(h.qefData),n=h.materials>>7-c&1,e[c]=h.materials>>c&1,++l);if(s&&cn.setData(u).solve(i)<=dn){for((h=new ln).position.copy(this.contains(i)?i:cn.massPoint),c=0;c<8;++c)o=e[c],a=t[c],-1===o?h.materials|=n<<c:(h.materials|=o<<c,h.normal.add(a.voxel.normal));h.normal.normalize(),h.qefData=u,this.voxel=h,this.children=null,r+=l-1}}return r}}],[{key:"errorThreshold",get:function(){return dn},set:function(t){dn=t}}]),e}();function vn(t,e,i,n,s){var r=0;for(e>>=1;e>0;e>>=1,r=0)i>=e&&(r+=4,i-=e),n>=e&&(r+=2,n-=e),s>=e&&(r+=1,s-=e),null===t.children&&t.split(),t=t.children[r];return t}function mn(t,e,i,n,s){var r=t+1,a=r*r,o=new ln,h=void 0,u=void 0,l=void 0,c=void 0,d=void 0;for(h=0,d=0;d<8;++d)c=(n+(l=Xt[d])[2])*a+(i+l[1])*r+(e+l[0]),h|=Math.min(s[c],Ft.SOLID)<<d;for(u=0,d=0;d<12;++d)(h>>Gt[d][0]&1)!==(h>>Gt[d][1]&1)&&++u;return o.materials=h,o.edgeCount=u,o.qefData=new un,o}var fn=function(t){a(e,re);function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.root=new yn(i,s),r.voxelCount=0,null!==t&&null!==t.edgeData&&r.construct(t),yn.errorThreshold>=0&&r.simplify(),r}return s(e,[{key:"simplify",value:function(){this.voxelCount-=this.root.collapse()}},{key:"construct",value:function(t){var e=_e.resolution,i=t.edgeData,n=t.materialIndices,s=new hn,r=new p,a=[i.edgesX(this.min,this.root.size),i.edgesY(this.min,this.root.size),i.edgesZ(this.min,this.root.size)],o=[new Uint8Array([0,1,2,3]),new Uint8Array([0,1,4,5]),new Uint8Array([0,2,4,6])],h=0,u=void 0,l=void 0,c=void 0,d=void 0,y=void 0,v=void 0,m=void 0,f=void 0,g=void 0,x=void 0,k=void 0;for(x=0;x<3;++x){c=o[x],u=a[x];var w=!0,z=!1,M=void 0;try{for(var b,A=u[Symbol.iterator]();!(w=(b=A.next()).done);w=!0)for((l=b.value).computeZeroCrossingPosition(r),k=0;k<4;++k)d=Xt[c[k]],m=l.coordinates.x-d[0],f=l.coordinates.y-d[1],g=l.coordinates.z-d[2],m>=0&&f>=0&&g>=0&&m<e&&f<e&&g<e&&(null===(y=vn(this.root,e,m,f,g)).voxel&&(y.voxel=mn(e,m,f,g,n),++h),(v=y.voxel).normal.add(l.n),v.qefData.add(r,l.n),v.qefData.numPoints===v.edgeCount&&(s.setData(v.qefData).solve(v.position),y.contains(v.position)||v.position.copy(s.massPoint),v.normal.normalize()))}catch(t){z=!0,M=t}finally{try{!w&&A.return&&A.return()}finally{if(z)throw M}}}this.voxelCount=h}}]),e}(),gn=0,pn=new p;function xn(t,e,i){var n=function(t){var e=gn,i=_e.resolution,n=new p(0,0,0),s=new p(i,i,i),r=new k(pn,pn.clone().addScalar(gn)),a=t.getBoundingBox();return t.type!==Ut.INTERSECTION&&(a.intersectsBox(r)?(n.copy(a.min).max(r.min).sub(r.min),n.x=Math.ceil(n.x*i/e),n.y=Math.ceil(n.y*i/e),n.z=Math.ceil(n.z*i/e),s.copy(a.max).min(r.max).sub(r.min),s.x=Math.floor(s.x*i/e),s.y=Math.floor(s.y*i/e),s.z=Math.floor(s.z*i/e)):(n.set(i,i,i),s.set(0,0,0))),new k(n,s)}(t),s=void 0,r=void 0,a=void 0,o=void 0,h=!1;if(t.type===Ut.DENSITY_FUNCTION?function(t,e,i){var n=gn,s=_e.resolution,r=s+1,a=r*r,o=e.materialIndices,h=pn,u=new p,l=new p,c=i.max.x,d=i.max.y,y=i.max.z,v=void 0,m=0,f=void 0,g=void 0,x=void 0;for(x=i.min.z;x<=y;++x)for(u.z=x*n/s,g=i.min.y;g<=d;++g)for(u.y=g*n/s,f=i.min.x;f<=c;++f)u.x=f*n/s,(v=t.generateMaterialIndex(l.addVectors(h,u)))!==Ft.AIR&&(o[x*a+g*r+f]=v,++m);e.materials=m}(t,e,n):e.empty?t.type===Ut.UNION&&(e.set(i),h=!0):e.full&&t.type===Ut.UNION||function(t,e,i,n){var s=_e.resolution+1,r=s*s,a=n.max.x,o=n.max.y,h=n.max.z,u=void 0,l=void 0,c=void 0;for(c=n.min.z;c<=h;++c)for(l=n.min.y;l<=o;++l)for(u=n.min.x;u<=a;++u)t.updateMaterialIndex(c*r+l*s+u,e,i)}(t,e,i,n),!h&&!e.empty&&!e.full){for(r=(s=t.type===Ut.DENSITY_FUNCTION?function(t,e,i){var n=gn,s=_e.resolution,r=s+1,a=r*r,o=new Uint32Array([1,r,a]),h=e.materialIndices,u=pn,l=new p,c=new p,d=new we,y=new Uint32Array(3),v=new Se(Se.calculate1DEdgeCount(s)),m=void 0,f=void 0,g=void 0,x=void 0,k=void 0,w=void 0,z=void 0,M=void 0,b=void 0,A=void 0,S=void 0,P=void 0,E=void 0,O=void 0,_=void 0,I=void 0,T=void 0,D=void 0,C=void 0;for(_=4,E=0,O=0;O<3;_>>=1,E=0,++O){switch(I=Xt[_],m=v.indices[O],f=v.zeroCrossings[O],g=v.normals[O],x=o[O],z=i.min.x,A=i.max.x,M=i.min.y,S=i.max.y,b=i.min.z,P=i.max.z,O){case 0:z=Math.max(z-1,0),A=Math.min(A,s-1);break;case 1:M=Math.max(M-1,0),S=Math.min(S,s-1);break;case 2:b=Math.max(b-1,0),P=Math.min(P,s-1)}for(C=b;C<=P;++C)for(D=M;D<=S;++D)for(T=z;T<=A;++T)w=(k=C*a+D*r+T)+x,h[k]!==h[w]&&(l.set(T*n/s,D*n/s,C*n/s),c.set((T+I[0])*n/s,(D+I[1])*n/s,(C+I[2])*n/s),d.a.addVectors(u,l),d.b.addVectors(u,c),t.generateEdge(d),m[E]=k,f[E]=d.t,g[3*E]=d.n.x,g[3*E+1]=d.n.y,g[3*E+2]=d.n.z,++E);y[O]=E}return{edgeData:v,lengths:y}}(t,e,n):function(t,e,i){var n=_e.resolution,s=n+1,r=new Uint32Array([1,s,s*s]),a=e.materialIndices,o=new we,h=new we,u=i.edgeData,l=e.edgeData,c=new Uint32Array(3),d=Se.calculate1DEdgeCount(n),y=new Se(Math.min(d,l.indices[0].length+u.indices[0].length),Math.min(d,l.indices[1].length+u.indices[1].length),Math.min(d,l.indices[2].length+u.indices[2].length)),v=void 0,m=void 0,f=void 0,g=void 0,p=void 0,x=void 0,k=void 0,w=void 0,z=void 0,M=void 0,b=void 0,A=void 0,S=void 0,P=void 0,E=void 0,O=void 0,_=void 0,I=void 0,T=void 0,D=void 0,C=void 0,U=void 0,F=void 0;for(I=0,T=0;T<3;I=0,++T){for(v=u.indices[T],g=l.indices[T],k=y.indices[T],m=u.zeroCrossings[T],p=l.zeroCrossings[T],w=y.zeroCrossings[T],f=u.normals[T],x=l.normals[T],z=y.normals[T],M=r[T],U=v.length,F=g.length,D=0,C=0;D<U;++D)if(A=(b=v[D])+M,(E=a[b])!==(O=a[A])&&(E===Ft.AIR||O===Ft.AIR)){for(o.t=m[D],o.n.x=f[3*D],o.n.y=f[3*D+1],o.n.z=f[3*D+2],t.type===Ut.DIFFERENCE&&o.n.negate(),_=o;C<F&&g[C]<=b;)P=(S=g[C])+M,h.t=p[C],h.n.x=x[3*C],h.n.y=x[3*C+1],h.n.z=x[3*C+2],E=a[S],S<b?E===(O=a[P])||E!==Ft.AIR&&O!==Ft.AIR||(k[I]=S,w[I]=h.t,z[3*I]=h.n.x,z[3*I+1]=h.n.y,z[3*I+2]=h.n.z,++I):_=t.selectEdge(h,o,E===Ft.SOLID),++C;k[I]=b,w[I]=_.t,z[3*I]=_.n.x,z[3*I+1]=_.n.y,z[3*I+2]=_.n.z,++I}for(;C<F;)P=(S=g[C])+M,(E=a[S])===(O=a[P])||E!==Ft.AIR&&O!==Ft.AIR||(k[I]=S,w[I]=p[C],z[3*I]=x[3*C],z[3*I+1]=x[3*C+1],z[3*I+2]=x[3*C+2],++I),++C;c[T]=I}return{edgeData:y,lengths:c}}(t,e,i)).edgeData,a=s.lengths,o=0;o<3;++o)r.indices[o]=r.indices[o].slice(0,a[o]),r.zeroCrossings[o]=r.zeroCrossings[o].slice(0,a[o]),r.normals[o]=r.normals[o].slice(0,3*a[o]);e.edgeData=r}}var kn=function(){function t(){n(this,t)}return s(t,null,[{key:"run",value:function(t,e,i,n){pn.fromArray(t),gn=e,null===i?n.operation===Ut.UNION&&(i=new _e(!1)):i.decompress();var s=n.toCSG(),r=null!==i?function t(e){var i=e.children,n=void 0,s=void 0,r=void 0,a=void 0;for(e.type===Ut.DENSITY_FUNCTION&&xn(e,n=new _e),r=0,a=i.length;r<a&&(s=t(i[r]),void 0===n?n=s:null!==s?null===n?e.type===Ut.UNION&&(n=s):xn(e,n,s):e.type===Ut.INTERSECTION&&(n=null),null!==n||e.type===Ut.UNION);++r);return null!==n&&n.empty?null:n}(s):null;if(null!==r){switch(n.operation){case Ut.UNION:s=new Lt(s);break;case Ut.DIFFERENCE:s=new Nt(s);break;case Ut.INTERSECTION:s=new Bt(s)}xn(s,i,r),i.contoured=!1}return null!==i&&i.empty?null:i}}]),t}(),wn=new _e(!1),zn=function(){function t(){n(this,t),this.data=null,this.response=null}return s(t,[{key:"getData",value:function(){return this.data}},{key:"respond",value:function(){return this.response.data=this.data.serialize(),this.response}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return null!==this.data&&this.data.createTransferList(t),t}},{key:"process",value:function(t){return this.data=wn.deserialize(t.data),this}}]),t}(),Mn=(function(t){a(e,zn);function e(){n(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.response=new Ei,t.decompressionTarget=new _e(!1),t.isosurface=null,t}s(e,[{key:"respond",value:function(){var t=r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"respond",this).call(this);return t.isosurface=null!==this.isosurface?this.isosurface.serialise():null,t}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"createTransferList",this).call(this,t),null!==this.isosurface?this.isosurface.createTransferList(t):t}},{key:"process",value:function(t){var i=r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"process",this).call(this,t).getData(),n=new fn(i.decompress(this.decompressionTarget));return this.isosurface=Xi.run(n),this.decompressionTarget.clear(),this}}])}(),function(t){a(e,zn);function e(){n(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.response=new Oi,t.sdf=null,t}s(e,[{key:"respond",value:function(){var t=r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"respond",this).call(this);return t.sdf=null!==this.sdf?this.sdf.serialize():null,t}},{key:"createTransferList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"createTransferList",this).call(this,t),null!==this.sdf?this.sdf.createTransferList(t):t}},{key:"process",value:function(t){var i=r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"process",this).call(this,t).getData(),n=this.sdf=Be.revive(t.sdf),s=kn.run(t.cellPosition,t.cellSize,i,n);return function t(e,i,n,s){var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var a=Object.getPrototypeOf(e);null!==a&&t(a,i,n,s)}else if("value"in r&&r.writable)r.value=n;else{var o=r.set;void 0!==o&&o.call(s,n)}return n}(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"data",null!==s?s.compress():null,this),this}}])}(),function(e){a(i,u);function i(){n(this,i);var e=o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"contouring"));return e.cellSize=1,e.cellPosition=new t.Vector3,e.cellPosition.subScalar(e.cellSize/2),e.sdfType=Ce.SUPER_PRIMITIVE,e.euler=new q,e.scale=new t.Vector3,e.superPrimitivePreset=Ne.TORUS,e.heightfield=new Fe,e.hermiteData=null,e.octreeHelper=new It,e.hermiteDataHelper=new _t,e.box3Helper=new t.Box3Helper,e.material=new t.MeshPhysicalMaterial({color:37256,metalness:.23,roughness:.31,clearCoat:.94,clearCoatRoughness:.15,dithering:!0}),e.mesh=null,e.vertices=0,e.faces=0,e}return s(i,[{key:"createSVO",value:function(){var t=this.octreeHelper;t.octree=new fn(this.hermiteData,this.cellPosition,this.cellSize),t.update(),function(e){var i=t.children,n=void 0,s=void 0,r=void 0,a=void 0,o=void 0,h=void 0;for(r=0,o=i.length;r<o;++r)for(n=i[r].children,s=r+1<o?3158064:12267568,a=0,h=n.length;a<h;++a)n[a].material.color.setHex(s)}()}},{key:"createHermiteData",value:function(){var t=void 0;switch(this.sdfType){case Ce.SUPER_PRIMITIVE:(t=qe.create(this.superPrimitivePreset)).quaternion.setFromEuler(this.euler),t.scale.copy(this.scale);break;case Ce.HEIGHTFIELD:(t=this.heightfield).position.set(-1,-.25,-1),t.quaternion.set(0,0,0,1),t.scale.set(2,.5,2)}return t.updateInverseTransformation(),this.box3Helper.box=t.getBoundingBox(),this.hermiteData=kn.run(this.cellPosition.toArray(),this.cellSize,null,t.setOperationType(Ut.UNION)),this.hermiteData}},{key:"contour",value:function(){var e=Xi.run(this.octreeHelper.octree),i=void 0,n=void 0;null!==e&&(null!==this.mesh&&(this.mesh.geometry.dispose(),this.scene.remove(this.mesh)),(n=new t.BufferGeometry).setIndex(new t.BufferAttribute(e.indices,1)),n.addAttribute("position",new t.BufferAttribute(e.positions,3)),n.addAttribute("normal",new t.BufferAttribute(e.normals,3)),i=new t.Mesh(n,this.material),this.vertices=e.positions.length/3,this.faces=e.indices.length/3,this.mesh=i,this.scene.add(i))}},{key:"load",value:function(){var e=this.assets,i=this.loadingManager,n=new t.CubeTextureLoader(i),s=new t.TextureLoader(i),r="textures/skies/interstellar/",a=[r+"px.jpg",r+"nx.jpg",r+"py.jpg",r+"ny.jpg",r+"pz.jpg",r+"nz.jpg"];return new Promise(function(t,r){0===e.size?(i.onError=r,i.onProgress=function(e,i,n){i===n&&t()},n.load(a,function(t){e.set("sky",t)}),s.load("textures/height/03.png",function(t){e.set("heightmap",t)})):t()})}},{key:"initialize",value:function(){var e=this.scene,i=this.assets,n=this.renderer;this.sdfType=Ce.SUPER_PRIMITIVE,this.euler.set(4.11,3.56,4.74,S),this.scale.set(.34,.47,.25),this.superPrimitivePreset=Ne.TORUS;var s=new t.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,25);s.position.set(0,0,-2),this.camera=s;var r=new Et(s.position,s.quaternion,n.domElement);r.settings.pointer.lock=!1,r.settings.sensitivity.rotation=.00175,r.settings.sensitivity.translation=.425,r.settings.sensitivity.zoom=.2,r.settings.zoom.maxDistance=20,r.lookAt(e.position),this.controls=r,e.fog=new t.FogExp2(16053492,.075),n.setClearColor(e.fog.color),e.background=i.get("sky"),this.material.envMap=i.get("sky");var a=new t.AmbientLight(4210752),o=new t.DirectionalLight(16759722);o.position.set(-.5,1.5,1),o.target.position.copy(e.position),e.add(o),e.add(a),this.heightfield.fromImage(i.get("heightmap").image),_e.resolution=64,_t.air=Ft.AIR,yn.errorThreshold=.005,this.createHermiteData(),this.octreeHelper.visible=!0,e.add(this.octreeHelper),e.add(this.hermiteDataHelper),e.add(this.box3Helper),this.createSVO();var h=new t.Box3,u=this.cellSize/2;h.min.set(-u,-u,-u),h.max.set(u,u,u);var l=new t.Box3Helper(h,3158064);l.material.transparent=!0,l.material.opacity=.25,e.add(l)}},{key:"render",value:function(t){this.controls.update(t),r(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"render",this).call(this,t)}},{key:"registerOptions",value:function(t){var e=this,i=this.octreeHelper,n=this.hermiteDataHelper,s=this.box3Helper,r=Object.keys(Ne).concat(["HEIGHTFIELD"]),a={SDF:r[this.superPrimitivePreset],color:this.material.color.getHex(),"level mask":i.children.length,"show SVO":function(){"HEIGHTFIELD"!==a.SDF?(e.superPrimitivePreset=Ne[a.SDF],e.sdfType=Ce.SUPER_PRIMITIVE):e.sdfType=Ce.HEIGHTFIELD,e.createHermiteData(),e.createSVO(),null!==e.mesh&&e.scene.remove(e.mesh),n.dispose(),i.visible=!0,s.visible=!0,a["level mask"]=i.children.length},"show Hermite data":function(){n.set(e.cellPosition,e.cellSize,e.hermiteData);try{n.update(),n.visible=!0,i.visible=!1,s.visible=!1}catch(t){console.error(t)}},contour:function(){e.createHermiteData(),e.createSVO(),e.contour(),i.visible=!1,n.visible=!1,s.visible=!1}};t.add(a,"SDF",r).onChange(a["show SVO"]);var o=t.addFolder("Octree Helper");o.add(a,"level mask").min(0).max(1+Math.log2(128)).step(1).onChange(function(){var t=void 0,e=void 0;for(t=0,e=i.children.length;t<e;++t)i.children[t].visible=a["level mask"]>=i.children.length||t===a["level mask"]}).listen();var h=(o=t.addFolder("Transformation")).addFolder("Rotation");h.add(this.euler,"x").min(0).max(2*Math.PI).step(1e-4),h.add(this.euler,"y").min(0).max(2*Math.PI).step(1e-4),h.add(this.euler,"z").min(0).max(2*Math.PI).step(1e-4),(h=o.addFolder("Scale")).add(this.scale,"x").min(0).max(.5).step(1e-4),h.add(this.scale,"y").min(0).max(.5).step(1e-4),h.add(this.scale,"z").min(0).max(.5).step(1e-4),(o=t.addFolder("Material")).add(this.material,"metalness").min(0).max(1).step(1e-4),o.add(this.material,"roughness").min(0).max(1).step(1e-4),o.add(this.material,"clearCoat").min(0).max(1).step(1e-4),o.add(this.material,"clearCoatRoughness").min(0).max(1).step(1e-4),o.add(this.material,"reflectivity").min(0).max(1).step(1e-4),o.addColor(a,"color").onChange(function(){return e.material.color.setHex(a.color)}),o.add(this.material,"wireframe"),o.add(this.material,"flatShading").onChange(function(){e.material.needsUpdate=!0}),t.add(_e,"resolution",[32,64,128]),t.add(yn,"errorThreshold").min(0).max(.01).step(1e-4),t.add(a,"show SVO"),t.add(a,"show Hermite data"),t.add(a,"contour"),(o=t.addFolder("Render Info")).add(this,"vertices").listen(),o.add(this,"faces").listen()}}]),i}()),bn=function(t){a(e,l);function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.qefData=null,i}return e}(),An=new t.Vector2,Sn=new l("update"),Pn=function(e){a(i,c);function i(e,s,r,a){var h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:document.body;n(this,i);var u=o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return u.hermiteData=r,u.cellPosition=e,u.cellSize=s,u.camera=a,u.dom=h,u.raycaster=new t.Raycaster,u.gridPointMaterials=[new t.MeshBasicMaterial({color:10066329,depthWrite:!1,transparent:!0,opacity:.75}),new t.MeshBasicMaterial({color:13395558,depthWrite:!1,transparent:!0,opacity:.9})],u.selectedGridPoint=null,u.gridPoints=new t.Group,u.createGridPoints(),u}return s(i,[{key:"createGridPoints",value:function(){var e=this.gridPoints,i=this.cellSize,n=_e.resolution,s=this.cellPosition,r=new t.Vector3,a=new t.SphereBufferGeometry(.05,8,8),o=this.gridPointMaterials[0],h=void 0,u=void 0,l=void 0,c=void 0;for(c=0;c<=n;++c)for(r.z=c*i/n,l=0;l<=n;++l)for(r.y=l*i/n,u=0;u<=n;++u)r.x=u*i/n,(h=new t.Mesh(a,o)).position.copy(s).add(r),e.add(h)}},{key:"toggleMaterialIndex",value:function(t){var e=this.hermiteData,i=e.materialIndices[t]===Ft.AIR?Ft.SOLID:Ft.AIR;e.setMaterialIndex(t,i)}},{key:"handleClick",value:function(t){var e=this.selectedGridPoint;t.preventDefault(),null!==e&&(this.toggleMaterialIndex(this.gridPoints.children.indexOf(e)),this.dispatchEvent(Sn))}},{key:"raycast",value:function(t){var e=this.raycaster;An.x=t.clientX/window.innerWidth*2-1,An.y=-t.clientY/window.innerHeight*2+1,e.setFromCamera(An,this.camera);var i=e.intersectObjects(this.gridPoints.children);null!==this.selectedGridPoint&&(this.selectedGridPoint.material=this.gridPointMaterials[0],this.selectedGridPoint=null),i.length>0&&(this.selectedGridPoint=i[0].object,this.selectedGridPoint.material=this.gridPointMaterials[1])}},{key:"handleEvent",value:function(t){switch(t.type){case"mousemove":this.raycast(t);break;case"click":this.handleClick(t)}}},{key:"setEnabled",value:function(t){var e=this.dom;t?(e.addEventListener("mousemove",this),e.addEventListener("click",this)):(e.removeEventListener("mousemove",this),e.removeEventListener("click",this))}},{key:"dispose",value:function(){this.setEnabled(!1)}},{key:"registerOptions",value:function(t){}}]),i}(),En=new t.Vector2,On=new l("update"),_n=function(e){a(i,c);function i(e,s,r,a){var h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:document.body;n(this,i);var u=o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return u.hermiteData=r,u.cellPosition=e,u.cellSize=s,u.camera=a,u.dom=h,u.raycaster=new t.Raycaster,u.raycaster.linePrecision=.05,u.t=0,u.edgeMaterials=[new t.LineBasicMaterial({color:10066329}),new t.LineBasicMaterial({color:13395558})],u.planeMaterials=[new t.MeshBasicMaterial({color:11149824,side:t.DoubleSide,depthWrite:!1,transparent:!0,opacity:.2}),new t.MeshBasicMaterial({color:16776960,side:t.DoubleSide,depthWrite:!1,transparent:!0,opacity:.4})],u.selectedEdge=null,u.activeEdge=null,u.activePlane=null,u.edgeId=new t.Vector2,u.edges=new t.Group,u.planes=new t.Group,u.t=0,u.s=new t.Spherical,u}return s(i,[{key:"calculateEdgeId",value:function(t){var e=this.hermiteData.edgeData.indices,i=void 0,n=void 0;for(i=0;i<3&&!(t<(n=e[i].length));++i)t-=n;this.edgeId.set(i,t)}},{key:"clearEdges",value:function(){for(var t=this.edges,e=this.planes,i=void 0,n=void 0;t.children.length>0;)(i=t.children[0]).geometry.dispose(),t.remove(i);for(;e.children.length>0;)(n=e.children[0]).geometry.dispose(),e.remove(n);this.activeEdge=null,this.activePlane=null}},{key:"createEdges",value:function(){var e=this.edges,i=this.planes,n=this.edgeMaterials[0],s=this.planeMaterials[0],r=this.hermiteData.edgeData.edges(this.cellPosition,this.cellSize),a=new t.Vector3,o=void 0,h=void 0,u=void 0,l=void 0,c=void 0;this.clearEdges();var d=!0,y=!1,v=void 0;try{for(var m,f=r[Symbol.iterator]();!(d=(m=f.next()).done);d=!0)o=m.value,l=new t.BufferGeometry,c=new Float32Array(6),o.a.toArray(c),o.b.toArray(c,3),l.addAttribute("position",new t.BufferAttribute(c,3)),h=new t.Line(l,n),e.add(h),(u=new t.Mesh(new t.PlaneBufferGeometry(2,2),s)).position.copy(o.computeZeroCrossingPosition(a)),u.lookAt(a.add(o.n)),u.visible=!1,i.add(u)}catch(t){y=!0,v=t}finally{try{!d&&f.return&&f.return()}finally{if(y)throw v}}}},{key:"adoptEdgeData",value:function(){var e=this.hermiteData.edgeData,i=e.zeroCrossings,n=e.normals,s=this.edgeId.x,r=this.edgeId.y,a=new t.Vector3;this.t=i[s][r],this.s.setFromVector3(a.fromArray(n[s],3*r))}},{key:"updateEdgeData",value:function(){var e=this.activeEdge,i=this.activePlane,n=new t.Vector3,s=new t.Vector3,r=new t.Vector3,a=new t.Vector3,o=this.hermiteData.edgeData,h=o.zeroCrossings,u=o.normals,l=this.edgeId.x,c=this.edgeId.y;null!==e&&(n.fromArray(e.geometry.getAttribute("position").array),s.fromArray(e.geometry.getAttribute("position").array,3),r.copy(n).add(s.sub(n).multiplyScalar(this.t)),a.setFromSpherical(this.s).normalize(),i.position.copy(r),i.lookAt(r.add(a)),h[l][c]=this.t,a.toArray(u[l],3*c),this.dispatchEvent(On))}},{key:"handleClick",value:function(t){var e=this.selectedEdge;t.preventDefault();var i=void 0,n=void 0;null!==e&&(null!==this.activeEdge&&(this.activeEdge!==e&&(this.activeEdge.material=this.edgeMaterials[0]),this.activePlane.material=this.planeMaterials[0],this.activePlane.visible=!1),this.activeEdge!==e?(i=this.edges.children.indexOf(e),n=this.planes.children[i],e.material=this.edgeMaterials[1],n.material=this.planeMaterials[1],n.visible=!0,this.activeEdge=e,this.activePlane=n,this.calculateEdgeId(i),this.adoptEdgeData()):(this.t=0,this.s.phi=0,this.s.theta=0,this.activeEdge=null,this.activePlane=null))}},{key:"raycast",value:function(t){var e=this.raycaster;En.x=t.clientX/window.innerWidth*2-1,En.y=-t.clientY/window.innerHeight*2+1,e.setFromCamera(En,this.camera);var i=e.intersectObjects(this.edges.children);null!==this.selectedEdge&&(this.selectedEdge!==this.activeEdge&&(this.selectedEdge.material=this.edgeMaterials[0]),this.selectedEdge=null),i.length>0&&(this.selectedEdge=i[0].object,this.selectedEdge.material=this.edgeMaterials[1])}},{key:"handleEvent",value:function(t){switch(t.type){case"mousemove":this.raycast(t);break;case"click":this.handleClick(t)}}},{key:"setEnabled",value:function(t){var e=this.dom;t?(e.addEventListener("mousemove",this),e.addEventListener("click",this)):(e.removeEventListener("mousemove",this),e.removeEventListener("click",this))}},{key:"dispose",value:function(){this.setEnabled(!1)}},{key:"registerOptions",value:function(t){var e=this,i=this.planes,n={"show planes":!1};t.add(n,"show planes").onChange(function(){var t=e.activePlane;i.traverse(function(e){e!==i&&e!==t&&(e.visible=n["show planes"])})});var s=t.addFolder("Edge Adjustment");s.add(this,"t").min(0).max(1).listen().step(1e-6).onChange(function(){null!==e.hermiteData.edgeData&&e.updateEdgeData()}),s.add(this.s,"phi").min(1e-6).max(Math.PI-1e-6).step(1e-6).listen().onChange(function(){null!==e.hermiteData.edgeData&&e.updateEdgeData()}),s.add(this.s,"theta").min(1e-6).max(Math.PI-1e-6).step(1e-6).listen().onChange(function(){null!==e.hermiteData.edgeData&&e.updateEdgeData()}),s.open()}}]),i}(),In=new bn("update"),Tn=function(e){a(i,c);function i(t,e,s,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:document.body;n(this,i);var h=o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return h.hermiteData=s,h.cellPosition=t,h.cellSize=e,h.gridPointEditor=new Pn(t,e,s,r,a),h.gridPointEditor.addEventListener("update",h),h.gridPointEditor.setEnabled(!0),h.edgeEditor=new _n(t,e,s,r,a),h.edgeEditor.addEventListener("update",h),h.qefData=new un,h}return s(i,[{key:"createEdgeData",value:function(){var t=_e.resolution,e=t+1,i=e*e,n=new Uint32Array([1,e,i]),s=this.hermiteData.materialIndices,r=new Se(Se.calculate1DEdgeCount(t)),a=void 0,o=void 0,h=void 0,u=void 0,l=void 0,c=void 0,d=void 0,y=void 0,v=void 0,m=void 0,f=void 0,g=void 0,p=void 0,x=void 0,k=void 0;for(y=4,c=0,d=0;d<3;y>>=1,c=0,++d){switch(v=Xt[y],a=r.indices[d],o=r.zeroCrossings[d],h=r.normals[d],p=x=k=t,d){case 0:p=Math.min(p,t-1);break;case 1:x=Math.min(x,t-1);break;case 2:k=Math.min(k,t-1)}for(g=0;g<=k;++g)for(f=0;f<=x;++f)for(m=0;m<=p;++m)l=(u=g*i+f*e+m)+n[d],s[u]!==s[l]&&(a[c]=u,o[c]=.5,h[3*c]=v[0],h[3*c+1]=v[1],h[3*c+2]=v[2],++c);r.indices[d]=r.indices[d].slice(0,c),r.zeroCrossings[d]=r.zeroCrossings[d].slice(0,c),r.normals[d]=r.normals[d].slice(0,3*c)}this.hermiteData.edgeData=r}},{key:"updateQEFData",value:function(){var e=this.qefData,i=new t.Vector3,n=this.hermiteData.edgeData.edges(this.cellPosition,this.cellSize),s=void 0;e.clear();var r=!0,a=!1,o=void 0;try{for(var h,u=n[Symbol.iterator]();!(r=(h=u.next()).done);r=!0)(s=h.value).computeZeroCrossingPosition(i),e.add(i,s.n)}catch(t){a=!0,o=t}finally{try{!r&&u.return&&u.return()}finally{if(a)throw o}}}},{key:"handleEvent",value:function(t){switch(t.type){case"update":t.target===this.gridPointEditor&&(this.createEdgeData(),this.edgeEditor.createEdges()),1===_e.resolution&&this.updateQEFData(),In.qefData=this.qefData,this.dispatchEvent(In)}}},{key:"setEnabled",value:function(t){this.gridPointEditor.setEnabled(t),this.edgeEditor.setEnabled(t)}},{key:"dispose",value:function(){this.setEnabled(!1)}},{key:"registerOptions",value:function(t){var e=this,i={"edit mode":0};t.add(i,"edit mode",{materials:0,edges:1}).onChange(function(){var t=0===Number.parseInt(i["edit mode"]);e.gridPointEditor.setEnabled(t),e.edgeEditor.setEnabled(!t)}),this.edgeEditor.registerOptions(t)}},{key:"gridPoints",get:function(){return this.gridPointEditor.gridPoints}},{key:"edges",get:function(){return this.edgeEditor.edges}},{key:"planes",get:function(){return this.edgeEditor.planes}}]),i}(),Dn=function(e){a(i,u);function i(){n(this,i);var e=o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"voxel"));return e.hermiteData=null,e.hermiteDataHelper=null,e.hermiteDataEditor=null,e.qefSolver=new hn,e.error="0.0000",e.result={x:"",y:"",z:""},e.vertex=new t.Mesh(new t.SphereBufferGeometry(.05,8,8),new t.MeshBasicMaterial({color:16746530})),e.vertex.visible=!1,e}return s(i,[{key:"solveQEF",value:function(t){var e=this.hermiteData,i=this.qefSolver,n=this.vertex,s=this.result;e.empty||e.full?n.visible&&(s.x="",s.y="",s.z="",n.visible=!1):(this.error=i.setData(t).solve(n.position).toFixed(4),n.visible=!0,s.x=n.position.x.toFixed(2),s.y=n.position.y.toFixed(2),s.z=n.position.z.toFixed(2))}},{key:"handleEvent",value:function(t){switch(t.type){case"update":try{this.hermiteDataHelper.update(!0,!1)}catch(t){}this.solveQEF(t.qefData)}}},{key:"initialize",value:function(){var e=this.scene,i=this.renderer,n=new t.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,50);n.position.set(-2,1,2),this.camera=n;var s=new Et(n.position,n.quaternion,i.domElement);s.settings.pointer.lock=!1,s.settings.sensitivity.zoom=.1,s.settings.translation.enabled=!1,s.settings.zoom.maxDistance=40,s.lookAt(e.position),this.controls=s,e.fog=new t.FogExp2(16053492,.025),i.setClearColor(e.fog.color),_e.resolution=1,_t.air=Ft.AIR;var r=new t.Vector3(-.5,-.5,-.5);r.multiplyScalar(1);var a=new _e,o=new _t(r,1,a,!0,!1);this.hermiteData=a,this.hermiteDataHelper=o,e.add(o);var h=new Tn(r,1,a,n,i.domElement);h.addEventListener("update",this),this.hermiteDataEditor=h,e.add(h.gridPoints),e.add(h.edges),e.add(h.planes);e.add(new t.Mesh(new t.BoxBufferGeometry(.95,.95,.95),new t.MeshBasicMaterial({color:13421772,depthWrite:!1,transparent:!0,opacity:.35}))),this.vertex.visible=!1,e.add(this.vertex)}},{key:"render",value:function(t){this.controls.update(t),r(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"render",this).call(this,t)}},{key:"registerOptions",value:function(t){var e=t.addFolder("Vertex Position");e.add(this.result,"x").listen(),e.add(this.result,"y").listen(),e.add(this.result,"z").listen(),e.add(this,"error").listen(),e.open(),this.hermiteDataEditor.registerOptions(t)}}]),i}(),Cn=void 0;function Un(t){requestAnimationFrame(Un),Cn.render(t)}function Fn(t){document.getElementById("viewport").children[0].style.display="initial"}function qn(t){document.getElementById("viewport").children[0].style.display="none"}window.addEventListener("load",function e(i){this.removeEventListener("load",e);var n=document.getElementById("viewport"),s=new t.WebGLRenderer({logarithmicDepthBuffer:!0,antialias:!0});s.setSize(n.clientWidth,n.clientHeight),s.setPixelRatio(window.devicePixelRatio),s.setClearColor(0),(Cn=new f(n,{aside:document.getElementById("aside"),renderer:s})).addEventListener("change",Fn),Cn.addEventListener("load",qn),Cn.addDemo(new Mn),Cn.addDemo(new Dn),Un()}),window.addEventListener("resize",function(){var t=0;function e(e){var i=e.target.innerWidth,n=e.target.innerHeight;Cn.setSize(i,n),t=0}return function(i){0===t&&(t=setTimeout(e,66,i))}}()),document.addEventListener("keydown",function(t){var e=this.getElementById("aside");t.altKey&&null!==e&&(t.preventDefault(),e.style.visibility="hidden"===e.style.visibility?"visible":"hidden")})}(THREE,dat,Stats);