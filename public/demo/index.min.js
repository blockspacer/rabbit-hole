function _typeof2(e){return _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof2(e)}(function(e,t,o,i,r){'use strict';var De=Math.sqrt,Pe=Math.log2,Oe=Math.trunc,Ie=Math.sign,Te=Math.PI,Le=Math.max,ze=Math.floor,we=Math.ceil,Re=Math.min,Be=Math.abs,Me=Math.pow,Ve=Math.round;function l(e){return l="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)},l(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n,a=0;a<t.length;a++)n=t[a],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}function u(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function _(e,t){return _=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_(e,t)}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function E(){return E=f()?Reflect.construct:function(e,t,n){var o=[null];o.push.apply(o,t);var a=Function.bind.apply(e,o),i=new a;return n&&_(i,n.prototype),i},E.apply(null,arguments)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e,t){return t&&("object"===_typeof2(t)||"function"==typeof t)?t:k(e)}function C(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=h(e),null!==e););return e}function S(e,t,n){return S="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var a=C(e,t);if(a){var o=Object.getOwnPropertyDescriptor(a,t);return o.get?o.get.call(n):o.value}},S(e,t,n||e)}function D(e){return P(e)||O(e)||I()}function P(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function O(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function I(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function T(e,t){var n=e.__state.conversionName.toString(),o=Ve(e.r),i=Ve(e.g),r=Ve(e.b),l=e.a,a=Ve(e.h),d=e.s.toFixed(1),s=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var c=e.hex.toString(16);6>c.length;)c="0"+c;return"#"+c}return"CSS_RGB"===n?"rgb("+o+","+i+","+r+")":"CSS_RGBA"===n?"rgba("+o+","+i+","+r+","+l+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+o+","+i+","+r+"]":"RGBA_ARRAY"===n?"["+o+","+i+","+r+","+l+"]":"RGB_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+"}":"RGBA_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+",a:"+l+"}":"HSV_OBJ"===n?"{h:"+a+",s:"+d+",v:"+s+"}":"HSVA_OBJ"===n?"{h:"+a+",s:"+d+",v:"+s+",a:"+l+"}":"unknown format"}function L(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(et.recalculateRGB(this,t,n),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(et.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function w(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(et.recalculateHSV(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(et.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}function R(e){if("0"===e||He.isUndefined(e))return 0;var t=e.match(at);return He.isNull(t)?0:parseFloat(t[1])}function B(e){var t=e.toString();return-1<t.indexOf(".")?t.length-t.indexOf(".")-1:0}function M(e,t){var n=Me(10,t);return Ve(e*n)/n}function V(e,t,n,a,o){return a+(o-a)*((e-t)/(n-t))}function N(e,t,n,a){e.style.background="",He.each(mt,function(o){e.style.cssText+="background: "+o+"linear-gradient("+t+", "+n+" 0%, "+a+" 100%); "})}function F(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}function H(e,t,n){var a=document.createElement("li");return t&&a.appendChild(t),n?e.__ul.insertBefore(a,n):e.__ul.appendChild(a),e.onResize(),a}function U(e){ot.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&ot.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function G(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function j(e,t,n){if(n.__li=t,n.__gui=e,He.extend(n,{options:function(t){if(1<arguments.length){var a=n.__li.nextElementSibling;return n.remove(),X(e,n.object,n.property,{before:a,factoryArgs:[He.toArray(arguments)]})}if(He.isArray(t)||He.isObject(t)){var o=n.__li.nextElementSibling;return n.remove(),X(e,n.object,n.property,{before:o,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof ct){var a=new st(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});He.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(e){var t=n[e],o=a[e];n[e]=a[e]=function(){var e=Array.prototype.slice.call(arguments);return o.apply(a,e),t.apply(n,e)}}),ot.addClass(t,"has-slider"),n.domElement.insertBefore(a.domElement,n.domElement.firstElementChild)}else if(n instanceof st){var o=function(t){if(He.isNumber(n.__min)&&He.isNumber(n.__max)){var a=n.__li.firstElementChild.firstElementChild.innerHTML,o=-1<n.__gui.__listening.indexOf(n);n.remove();var i=X(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return i.name(a),o&&i.listen(),i}return t};n.min=He.compose(o,n.min),n.max=He.compose(o,n.max)}else n instanceof it?(ot.bind(t,"click",function(){ot.fakeEvent(n.__checkbox,"click")}),ot.bind(n.__checkbox,"click",function(t){t.stopPropagation()})):n instanceof ut?(ot.bind(t,"click",function(){ot.fakeEvent(n.__button,"click")}),ot.bind(t,"mouseover",function(){ot.addClass(n.__button,"hover")}),ot.bind(t,"mouseout",function(){ot.removeClass(n.__button,"hover")})):n instanceof pt&&(ot.addClass(t,"color"),n.updateDisplay=He.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=He.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&G(e.getRoot(),!0),t},n.setValue)}function Y(e,t){var n=e.getRoot(),a=n.__rememberedObjects.indexOf(t.object);if(-1!==a){var o=n.__rememberedObjectIndecesToControllers[a];if(void 0===o&&(o={},n.__rememberedObjectIndecesToControllers[a]=o),o[t.property]=t,n.load&&n.load.remembered){var i=n.load.remembered,r=void 0;if(i[e.preset])r=i[e.preset];else if(i.Default)r=i.Default;else return;if(r[a]&&void 0!==r[a][t.property]){var l=r[a][t.property];t.initialValue=l,t.setValue(l)}}}}function X(e,t,n,a){if(void 0===t[n])throw new Error("Object \""+t+"\" has no property \""+n+"\"");var o;if(a.color)o=new pt(t,n);else{var i=[t,n].concat(a.factoryArgs);o=gt.apply(e,i)}a.before instanceof tt&&(a.before=a.before.__li),Y(e,o),ot.addClass(o.domElement,"c");var r=document.createElement("span");ot.addClass(r,"property-name"),r.innerHTML=o.property;var l=document.createElement("div");l.appendChild(r),l.appendChild(o.domElement);var d=H(e,l,a.before);return ot.addClass(d,Dt.CLASS_CONTROLLER_ROW),o instanceof pt?ot.addClass(d,"color"):ot.addClass(d,qe(o.getValue())),j(e,d,o),e.__controllers.push(o),o}function W(e,t){return document.location.href+"."+t}function q(e,t,n){var a=document.createElement("option");a.innerHTML=t,a.value=t,e.__preset_select.appendChild(a),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function Q(e,t){t.style.display=e.useLocalStorage?"block":"none"}function K(e){var t=e.__save_row=document.createElement("li");ot.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),ot.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",ot.addClass(n,"button gears");var a=document.createElement("span");a.innerHTML="Save",ot.addClass(a,"button"),ot.addClass(a,"save");var o=document.createElement("span");o.innerHTML="New",ot.addClass(o,"button"),ot.addClass(o,"save-as");var i=document.createElement("span");i.innerHTML="Revert",ot.addClass(i,"button"),ot.addClass(i,"revert");var r=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?He.each(e.load.remembered,function(t,n){q(e,n,n===e.preset)}):q(e,"Default",!1),ot.bind(r,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(r),t.appendChild(n),t.appendChild(a),t.appendChild(o),t.appendChild(i),xt){var l=document.getElementById("dg-local-explain"),d=document.getElementById("dg-local-storage"),s=document.getElementById("dg-save-locally");s.style.display="block","true"===localStorage.getItem(W(e,"isLocal"))&&d.setAttribute("checked","checked"),Q(e,l),ot.bind(d,"change",function(){e.useLocalStorage=!e.useLocalStorage,Q(e,l)})}var c=document.getElementById("dg-new-constructor");ot.bind(c,"keydown",function(t){t.metaKey&&(67===t.which||67===t.keyCode)&&Et.hide()}),ot.bind(n,"click",function(){c.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),Et.show(),c.focus(),c.select()}),ot.bind(a,"click",function(){e.save()}),ot.bind(o,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),ot.bind(i,"click",function(){e.revert()})}function Z(t){function n(n){return n.preventDefault(),t.width+=i-n.clientX,t.onResize(),i=n.clientX,!1}function a(){ot.removeClass(t.__closeButton,Dt.CLASS_DRAG),ot.unbind(window,"mousemove",n),ot.unbind(window,"mouseup",a)}function o(o){return o.preventDefault(),i=o.clientX,ot.addClass(t.__closeButton,Dt.CLASS_DRAG),ot.bind(window,"mousemove",n),ot.bind(window,"mouseup",a),!1}var i;t.__resize_handle=document.createElement("div"),He.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),ot.bind(t.__resize_handle,"mousedown",o),ot.bind(t.__closeButton,"mousedown",o),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function J(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function $(e,t){var n={};return He.each(e.__rememberedObjects,function(a,o){var i={},r=e.__rememberedObjectIndecesToControllers[o];He.each(r,function(e,n){i[n]=t?e.initialValue:e.getValue()}),n[o]=i}),n}function ee(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}function te(e){0!==e.length&&ht.call(window,function(){te(e)}),He.each(e,function(e){e.updateDisplay()})}function ne(e){var t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=t.getContext("2d");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height)}function ae(e,t,n){var a,o,l,d,s,c,u,p=[-1,-1,-1,-1],m=[!1,!1,!1,!1],g=1/0,h=0,_=!1;for(u=0;4>u;++u)s=e[u],c=Vn[t][u],a=r.edges[c][0],o=r.edges[c][1],l=1&s.voxel.materials>>a,d=1&s.voxel.materials>>o,s.size<g&&(g=s.size,h=u,_=l!==rn.AIR),p[u]=s.voxel.index,m[u]=l!==d;m[h]&&(_?(n.push(p[0]),n.push(p[3]),n.push(p[1]),n.push(p[0]),n.push(p[2]),n.push(p[3])):(n.push(p[0]),n.push(p[1]),n.push(p[3]),n.push(p[0]),n.push(p[3]),n.push(p[2])))}function oe(e,t,n){var a,o,r,l,d=[0,0,0,0];if(null!==e[0].voxel&&null!==e[1].voxel&&null!==e[2].voxel&&null!==e[3].voxel)ae(e,t,n);else for(r=0;2>r;++r){for(d[0]=Mn[t][r][0],d[1]=Mn[t][r][1],d[2]=Mn[t][r][2],d[3]=Mn[t][r][3],a=[],l=0;4>l;++l)if(o=e[l],null!==o.voxel)a[l]=o;else if(null!==o.children)a[l]=o.children[d[l]];else break;4===l&&oe(a,Mn[t][r][4],n)}}function ie(e,t,n){var a,o,r,l,d,s,u=[0,0,0,0],c=[[0,0,1,1],[0,1,0,1]];if(null!==e[0].children||null!==e[1].children){for(d=0;4>d;++d)u[0]=Rn[t][d][0],u[1]=Rn[t][d][1],a=[null===e[0].children?e[0]:e[0].children[u[0]],null===e[1].children?e[1]:e[1].children[u[1]]],ie(a,Rn[t][d][2],n);for(d=0;4>d;++d){for(u[0]=Bn[t][d][1],u[1]=Bn[t][d][2],u[2]=Bn[t][d][3],u[3]=Bn[t][d][4],r=c[Bn[t][d][0]],o=[],s=0;4>s;++s)if(l=e[r[s]],null!==l.voxel)o[s]=l;else if(null!==l.children)o[s]=l.children[u[s]];else break;4===s&&oe(o,Bn[t][d][5],n)}}}function re(e,t){var n,a,o,r=e.children,l=[0,0,0,0];if(null!==r){for(o=0;8>o;++o)re(r[o],t);for(o=0;12>o;++o)l[0]=zn[o][0],l[1]=zn[o][1],n=[r[l[0]],r[l[1]]],ie(n,zn[o][2],t);for(o=0;6>o;++o)l[0]=wn[o][0],l[1]=wn[o][1],l[2]=wn[o][2],l[3]=wn[o][3],a=[r[l[0]],r[l[1]],r[l[2]],r[l[3]]],oe(a,wn[o][4],t)}}function le(e,t,n,a){var o,r;if(null!==e.children)for(o=0;8>o;++o)a=le(e.children[o],t,n,a);else null!==e.voxel&&(r=e.voxel,r.index=a,t[3*a]=r.position.x,t[3*a+1]=r.position.y,t[3*a+2]=r.position.z,n[3*a]=r.normal.x,n[3*a+1]=r.normal.y,n[3*a+2]=r.normal.z,++a);return a}function de(e,t){var n,a=e.elements,o=t.elements;0!==a[1]&&(n=Un.calculateCoefficients(a[0],a[1],a[3]),Gn.rotateQXY(Wn.set(a[0],a[3]),a[1],n),a[0]=Wn.x,a[3]=Wn.y,Gn.rotateXY(Wn.set(a[2],a[4]),n),a[2]=Wn.x,a[4]=Wn.y,a[1]=0,Gn.rotateXY(Wn.set(o[0],o[3]),n),o[0]=Wn.x,o[3]=Wn.y,Gn.rotateXY(Wn.set(o[1],o[4]),n),o[1]=Wn.x,o[4]=Wn.y,Gn.rotateXY(Wn.set(o[2],o[5]),n),o[2]=Wn.x,o[5]=Wn.y)}function se(e,t){var n,a=e.elements,o=t.elements;0!==a[2]&&(n=Un.calculateCoefficients(a[0],a[2],a[5]),Gn.rotateQXY(Wn.set(a[0],a[5]),a[2],n),a[0]=Wn.x,a[5]=Wn.y,Gn.rotateXY(Wn.set(a[1],a[4]),n),a[1]=Wn.x,a[4]=Wn.y,a[2]=0,Gn.rotateXY(Wn.set(o[0],o[6]),n),o[0]=Wn.x,o[6]=Wn.y,Gn.rotateXY(Wn.set(o[1],o[7]),n),o[1]=Wn.x,o[7]=Wn.y,Gn.rotateXY(Wn.set(o[2],o[8]),n),o[2]=Wn.x,o[8]=Wn.y)}function ce(e,t){var n,a=e.elements,o=t.elements;0!==a[4]&&(n=Un.calculateCoefficients(a[3],a[4],a[5]),Gn.rotateQXY(Wn.set(a[3],a[5]),a[4],n),a[3]=Wn.x,a[5]=Wn.y,Gn.rotateXY(Wn.set(a[1],a[2]),n),a[1]=Wn.x,a[2]=Wn.y,a[4]=0,Gn.rotateXY(Wn.set(o[3],o[6]),n),o[3]=Wn.x,o[6]=Wn.y,Gn.rotateXY(Wn.set(o[4],o[7]),n),o[4]=Wn.x,o[7]=Wn.y,Gn.rotateXY(Wn.set(o[5],o[8]),n),o[5]=Wn.x,o[8]=Wn.y)}function ue(t,n){var o,r=t.elements;for(o=0;o<5;++o)de(t,n),se(t,n),ce(t,n);return a.set(r[0],r[3],r[5])}function pe(e){var t=Be(e)<jn?0:1/e;return Be(t)<jn?0:t}function me(e,t){var n=e.elements,a=n[0],o=n[3],i=n[6],r=n[1],l=n[4],d=n[7],s=n[2],c=n[5],u=n[8],p=pe(t.x),m=pe(t.y),g=pe(t.z);return e.set(a*p*a+o*m*o+i*g*i,a*p*r+o*m*l+i*g*d,a*p*s+o*m*c+i*g*u,r*p*a+l*m*o+d*g*i,r*p*r+l*m*l+d*g*d,r*p*s+l*m*c+d*g*u,s*p*a+c*m*o+u*g*i,s*p*r+c*m*l+u*g*d,s*p*s+c*m*c+u*g*u)}function ge(e,t,n){return e.applyToVector3(qn.copy(n)),qn.subVectors(t,qn),qn.dot(qn)}function he(e,t,a,o,r){var l=0;for(t>>=1;0<t;t>>=1,l=0)a>=t&&(l+=4,a-=t),o>=t&&(l+=2,o-=t),r>=t&&(l+=1,r-=t),null===e.children&&e.split(),e=e.children[l];return e}function _e(e,t,n,a,o){var l,d,s,c,u,p,g,h,_,y,f=e+1,m=new Zn;for(l=0,y=0;8>y;++y)c=r.layout[y],u=(a+c[2])*(f*f)+(n+c[1])*f+(t+c[0]),s=Re(o[u],rn.SOLID),l|=s<<y;for(d=0,y=0;12>y;++y)p=r.edges[y][0],g=r.edges[y][1],h=1&l>>p,_=1&l>>g,h!==_&&++d;return m.materials=l,m.edgeCount=d,m.qefData=new Kn,m}function ye(e){var t=aa,a=kn.resolution,n=new o.Vector3(0,0,0),i=new o.Vector3(a,a,a),r=new o.Box3(oa,oa.clone().addScalar(aa)),l=e.getBoundingBox();return e.type!==on.INTERSECTION&&(l.intersectsBox(r)?(n.copy(l.min).max(r.min).sub(r.min),n.x=we(n.x*a/t),n.y=we(n.y*a/t),n.z=we(n.z*a/t),i.copy(l.max).min(r.max).sub(r.min),i.x=ze(i.x*a/t),i.y=ze(i.y*a/t),i.z=ze(i.z*a/t)):(n.set(a,a,a),i.set(0,0,0))),new o.Box3(n,i)}function fe(e,t,a,o){var i,r,l,d=kn.resolution,n=d+1,s=o.max.x,c=o.max.y,u=o.max.z;for(l=o.min.z;l<=u;++l)for(r=o.min.y;r<=c;++r)for(i=o.min.x;i<=s;++i)e.updateMaterialIndex(l*(n*n)+r*n+i,t,a)}function ve(e,t,a){var i,r,l,d,c=aa,s=kn.resolution,n=s+1,u=t.materialIndices,p=new o.Vector3,m=new o.Vector3,g=a.max.x,h=a.max.y,_=a.max.z,f=0;for(d=a.min.z;d<=_;++d)for(p.z=d*c/s,l=a.min.y;l<=h;++l)for(p.y=l*c/s,r=a.min.x;r<=g;++r)p.x=r*c/s,i=e.generateMaterialIndex(m.addVectors(oa,p)),i!==rn.AIR&&(u[d*(n*n)+l*n+r]=i,++f);t.materials=f}function be(e,t,a){var o,r,l,s,u,p,g,h,_,y,f,v,b,x,E,k,A,C,S,D,P,O,I,T=kn.resolution,n=T+1,m=new Uint32Array([1,n,n*n]),L=t.materialIndices,z=new gn,w=new gn,R=a.edgeData,B=t.edgeData,M=new Uint32Array(3),V=vn.calculate1DEdgeCount(T),N=new vn(T,Re(V,B.indices[0].length+R.indices[0].length),Re(V,B.indices[1].length+R.indices[1].length),Re(V,B.indices[2].length+R.indices[2].length));for(C=0,S=0;3>S;C=0,++S){for(o=R.indices[S],s=B.indices[S],g=N.indices[S],r=R.zeroCrossings[S],u=B.zeroCrossings[S],h=N.zeroCrossings[S],l=R.normals[S],p=B.normals[S],_=N.normals[S],y=m[S],O=o.length,I=s.length,(D=0,P=0);D<O;++D)if(f=o[D],v=f+y,E=L[f],k=L[v],E!==k&&(E===rn.AIR||k===rn.AIR)){for(z.t=r[D],z.n.x=l[3*D],z.n.y=l[3*D+1],z.n.z=l[3*D+2],e.type===on.DIFFERENCE&&z.n.negate(),A=z;P<I&&s[P]<=f;)b=s[P],x=b+y,w.t=u[P],w.n.x=p[3*P],w.n.y=p[3*P+1],w.n.z=p[3*P+2],E=L[b],b<f?(k=L[x],E!==k&&(E===rn.AIR||k===rn.AIR)&&(g[C]=b,h[C]=w.t,_[3*C]=w.n.x,_[3*C+1]=w.n.y,_[3*C+2]=w.n.z,++C)):A=e.selectEdge(w,z,E===rn.SOLID),++P;g[C]=f,h[C]=A.t,_[3*C]=A.n.x,_[3*C+1]=A.n.y,_[3*C+2]=A.n.z,++C}for(;P<I;)b=s[P],x=b+y,E=L[b],k=L[x],E!==k&&(E===rn.AIR||k===rn.AIR)&&(g[C]=b,h[C]=u[P],_[3*C]=p[3*P],_[3*C+1]=p[3*P+1],_[3*C+2]=p[3*P+2],++C),++P;M[S]=C}return{edgeData:N,lengths:M}}function xe(e,t,i){var l,u,p,g,h,_,f,v,b,E,k,A,C,S,D,P,O,I,T,L=aa,s=kn.resolution,n=s+1,m=n*n,w=new Uint32Array([1,n,m]),R=t.materialIndices,B=oa,M=new o.Vector3,V=new o.Vector3,N=new gn,F=new Uint32Array(3),H=new vn(s,vn.calculate1DEdgeCount(s));for(D=4,C=0,S=0;3>S;D>>=1,C=0,++S){P=r.layout[D],l=H.indices[S],u=H.zeroCrossings[S],p=H.normals[S],g=w[S],f=i.min.x,E=i.max.x,v=i.min.y,k=i.max.y,b=i.min.z,A=i.max.z;for(0===S?(f=Le(f-1,0),E=Re(E,s-1)):1===S?(v=Le(v-1,0),k=Re(k,s-1)):2===S?(b=Le(b-1,0),A=Re(A,s-1)):void 0,T=b;T<=A;++T)for(I=v;I<=k;++I)for(O=f;O<=E;++O)h=T*m+I*n+O,_=h+g,R[h]!==R[_]&&(M.set(O*L/s,I*L/s,T*L/s),V.set((O+P[0])*L/s,(I+P[1])*L/s,(T+P[2])*L/s),N.a.addVectors(B,M),N.b.addVectors(B,V),e.generateEdge(N),l[C]=h,u[C]=N.t,p[3*C]=N.n.x,p[3*C+1]=N.n.y,p[3*C+2]=N.n.z,++C);F[S]=C}return{edgeData:H,lengths:F}}function Ee(e,t,n){var a,o,i,r,l=ye(e),s=!1;if(e.type===on.DENSITY_FUNCTION?ve(e,t,l):t.empty?e.type===on.UNION&&(t.set(n),s=!0):!(t.full&&e.type===on.UNION)&&fe(e,t,n,l),!s&&!t.empty&&!t.full){for(a=e.type===on.DENSITY_FUNCTION?xe(e,t,l):be(e,t,n),o=a.edgeData,i=a.lengths,r=0;3>r;++r)o.indices[r]=o.indices[r].slice(0,i[r]),o.zeroCrossings[r]=o.zeroCrossings[r].slice(0,i[r]),o.normals[r]=o.normals[r].slice(0,3*i[r]);t.edgeData=o}}function ke(e){var t,n,a,o,r=e.children;for(e.type===on.DENSITY_FUNCTION&&(t=new kn,Ee(e,t)),a=0,o=r.length;a<o&&(n=ke(r[a]),void 0===t?t=n:null===n?e.type===on.INTERSECTION&&(t=null):null===t?e.type===on.UNION&&(t=n):Ee(e,t,n),null!==t||e.type===on.UNION);++a);return null!==t&&t.empty?null:t}function Ae(e){requestAnimationFrame(Ae),Pt.render(e)}function Ce(){document.getElementById("viewport").children[0].style.display="initial"}function Se(){document.getElementById("viewport").children[0].style.display="none"}i=i&&i.hasOwnProperty("default")?i["default"]:i;var Ne=Array.prototype.forEach,Fe=Array.prototype.slice,He={BREAK:{},extend:function(e){return this.each(Fe.call(arguments,1),function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))},this),e},defaults:function(e){return this.each(Fe.call(arguments,1),function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))},this),e},compose:function(){var e=Fe.call(arguments);return function(){for(var t=Fe.call(arguments),n=e.length-1;0<=n;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,n){if(e)if(Ne&&e.forEach&&e.forEach===Ne)e.forEach(t,n);else if(e.length===e.length+0){var a=void 0,o=void 0;for(a=0,o=e.length;a<o;a++)if(a in e&&t.call(n,e[a],a)===this.BREAK)return}else for(var i in e)if(t.call(n,e[i],i)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var a;return function(){var o=this,i=arguments,r=n||!a;clearTimeout(a),a=setTimeout(function(){a=null,n||e.apply(o,i)},t),r&&e.apply(o,i)}},toArray:function(e){return e.toArray?e.toArray():Fe.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return null===e},isNaN:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return isNaN(e)}),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},Ue=[{litmus:He.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:T},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:T},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:T},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:T}}},{litmus:He.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:He.isArray,conversions:{RGB_ARRAY:{read:function(e){return!(3!==e.length)&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return!(4!==e.length)&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:He.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(He.isNumber(e.r)&&He.isNumber(e.g)&&He.isNumber(e.b)&&He.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(He.isNumber(e.r)&&He.isNumber(e.g)&&He.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(He.isNumber(e.h)&&He.isNumber(e.s)&&He.isNumber(e.v)&&He.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(He.isNumber(e.h)&&He.isNumber(e.s)&&He.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],Ge=void 0,je=void 0,Ye=function(){je=!1;var e=1<arguments.length?He.toArray(arguments):arguments[0];return He.each(Ue,function(t){if(t.litmus(e))return He.each(t.conversions,function(t,n){if(Ge=t.read(e),!1===je&&!1!==Ge)return je=Ge,Ge.conversionName=n,Ge.conversion=t,He.BREAK}),He.BREAK}),je},Xe=void 0,We={hsv_to_rgb:function(e,n,a){var o=ze(e/60)%6,i=e/60-ze(e/60),r=a*(1-n),l=a*(1-i*n),d=a*(1-(1-i)*n),t=[[a,d,r],[l,a,r],[r,a,d],[r,l,a],[d,r,a],[a,r,l]][o];return{r:255*t[0],g:255*t[1],b:255*t[2]}},rgb_to_hsv:function(e,t,n){var a=Re(e,t,n),o=Le(e,t,n),i=o-a,r=void 0,l=void 0;if(0!==o)l=i/o;else return{h:NaN,s:0,v:0};return r=e===o?(t-n)/i:t===o?2+(n-e)/i:4+(e-t)/i,r/=6,0>r&&(r+=1),{h:360*r,s:l,v:o/255}},rgb_to_hex:function(e,t,n){var a=this.hex_with_component(0,2,e);return a=this.hex_with_component(a,1,t),a=this.hex_with_component(a,0,n),a},component_from_hex:function(e,t){return 255&e>>8*t},hex_with_component:function(e,t,n){return n<<(Xe=8*t)|e&~(255<<Xe)}},qe="function"==typeof Symbol&&"symbol"===l(Symbol.iterator)?function(e){return l(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":l(e)},Qe=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Ke=function(){function e(e,t){for(var n,a=0;a<t.length;a++)n=t[a],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Ze=function e(t,n,a){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(o===void 0){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,a)}if("value"in o)return o.value;var r=o.get;return void 0===r?void 0:r.call(a)},Je=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+l(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},$e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"===l(t)||"function"==typeof t)?t:e},et=function(){function e(){if(Qe(this,e),this.__state=Ye.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return Ke(e,[{key:"toString",value:function(){return T(this)}},{key:"toHexString",value:function(){return T(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();et.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=We.component_from_hex(e.__state.hex,n);else if("HSV"===e.__state.space)He.extend(e.__state,We.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v));else throw new Error("Corrupted color state")},et.recalculateHSV=function(e){var t=We.rgb_to_hsv(e.r,e.g,e.b);He.extend(e.__state,{s:t.s,v:t.v}),He.isNaN(t.h)?He.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},et.COMPONENTS=["r","g","b","h","s","v","hex","a"],L(et.prototype,"r",2),L(et.prototype,"g",1),L(et.prototype,"b",0),w(et.prototype,"h"),w(et.prototype,"s"),w(et.prototype,"v"),Object.defineProperty(et.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(et.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=We.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var tt=function(){function e(t,n){Qe(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return Ke(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),nt={};He.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){He.each(e,function(n){nt[n]=t})});var at=/(\d+(\.\d+)?)px/,ot={makeSelectable:function(e,t){void 0===e||void 0===e.style||(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var a=n,o=t;He.isUndefined(o)&&(o=!0),He.isUndefined(a)&&(a=!0),e.style.position="absolute",o&&(e.style.left=0,e.style.right=0),a&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,a){var o=n||{},i=nt[t];if(!i)throw new Error("Event type "+t+" not supported.");var r=document.createEvent(i);switch(i){case"MouseEvents":{var l=o.x||o.clientX||0,d=o.y||o.clientY||0;r.initMouseEvent(t,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,l,d,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var s=r.initKeyboardEvent||r.initKeyEvent;He.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),s(t,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break}default:{r.initEvent(t,o.bubbles||!1,o.cancelable||!0);break}}He.defaults(r,a),e.dispatchEvent(r)},bind:function(e,t,n,a){return e.addEventListener?e.addEventListener(t,n,a||!1):e.attachEvent&&e.attachEvent("on"+t,n),ot},unbind:function(e,t,n,a){return e.removeEventListener?e.removeEventListener(t,n,a||!1):e.detachEvent&&e.detachEvent("on"+t,n),ot},addClass:function(e,t){if(e.className===void 0)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return ot},removeClass:function(e,t){if(!t)e.className=void 0;else if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),a=n.indexOf(t);-1!==a&&(n.splice(a,1),e.className=n.join(" "))}return ot},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return R(t["border-left-width"])+R(t["border-right-width"])+R(t["padding-left"])+R(t["padding-right"])+R(t.width)},getHeight:function(e){var t=getComputedStyle(e);return R(t["border-top-width"])+R(t["border-bottom-width"])+R(t["padding-top"])+R(t["padding-bottom"])+R(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent;while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},it=function(e){function t(e,n){Qe(this,t);var a=$e(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=a;return a.__prev=a.getValue(),a.__checkbox=document.createElement("input"),a.__checkbox.setAttribute("type","checkbox"),ot.bind(a.__checkbox,"change",function(){o.setValue(!o.__prev)},!1),a.domElement.appendChild(a.__checkbox),a.updateDisplay(),a}return Je(t,e),Ke(t,[{key:"setValue",value:function(e){var n=Ze(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Ze(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(tt),rt=function(e){function t(e,n,a){Qe(this,t);var o=$e(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=a,r=o;if(o.__select=document.createElement("select"),He.isArray(i)){var l={};He.each(i,function(e){l[e]=e}),i=l}return He.each(i,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),r.__select.appendChild(n)}),o.updateDisplay(),ot.bind(o.__select,"change",function(){var e=this.options[this.selectedIndex].value;r.setValue(e)}),o.domElement.appendChild(o.__select),o}return Je(t,e),Ke(t,[{key:"setValue",value:function(e){var n=Ze(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return ot.isActive(this.__select)?this:(this.__select.value=this.getValue(),Ze(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(tt),lt=function(e){function t(e,n){function a(){i.setValue(i.__input.value)}Qe(this,t);var o=$e(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=o;return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),ot.bind(o.__input,"keyup",a),ot.bind(o.__input,"change",a),ot.bind(o.__input,"blur",function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}),ot.bind(o.__input,"keydown",function(t){13===t.keyCode&&this.blur()}),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return Je(t,e),Ke(t,[{key:"updateDisplay",value:function(){return ot.isActive(this.__input)||(this.__input.value=this.getValue()),Ze(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(tt),dt=function(e){function t(e,n,a){var o=Math.LN10,i=Math.log;Qe(this,t);var r=$e(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),l=a||{};return r.__min=l.min,r.__max=l.max,r.__step=l.step,r.__impliedStep=He.isUndefined(r.__step)?0===r.initialValue?1:Me(10,ze(i(Be(r.initialValue))/o))/10:r.__step,r.__precision=B(r.__impliedStep),r}return Je(t,e),Ke(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&0!=n%this.__step&&(n=Ve(n/this.__step)*this.__step),Ze(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=B(e),this}}]),t}(tt),st=function(e){function t(e,n,a){function o(){d.__onFinishChange&&d.__onFinishChange.call(d,d.getValue())}function i(t){var e=s-t.clientY;d.setValue(d.getValue()+e*d.__impliedStep),s=t.clientY}function r(){ot.unbind(window,"mousemove",i),ot.unbind(window,"mouseup",r),o()}Qe(this,t);var l=$e(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,a));l.__truncationSuspended=!1;var d=l,s=void 0;return l.__input=document.createElement("input"),l.__input.setAttribute("type","text"),ot.bind(l.__input,"change",function(){var e=parseFloat(d.__input.value);He.isNaN(e)||d.setValue(e)}),ot.bind(l.__input,"blur",function(){o()}),ot.bind(l.__input,"mousedown",function(t){ot.bind(window,"mousemove",i),ot.bind(window,"mouseup",r),s=t.clientY}),ot.bind(l.__input,"keydown",function(t){13===t.keyCode&&(d.__truncationSuspended=!0,this.blur(),d.__truncationSuspended=!1,o())}),l.updateDisplay(),l.domElement.appendChild(l.__input),l}return Je(t,e),Ke(t,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():M(this.getValue(),this.__precision),Ze(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(dt),ct=function(e){function t(e,n,a,o,i){function r(t){t.preventDefault();var e=u.__background.getBoundingClientRect();return u.setValue(V(t.clientX,e.left,e.right,u.__min,u.__max)),!1}function l(){ot.unbind(window,"mousemove",r),ot.unbind(window,"mouseup",l),u.__onFinishChange&&u.__onFinishChange.call(u,u.getValue())}function d(t){var e=t.touches[0].clientX,n=u.__background.getBoundingClientRect();u.setValue(V(e,n.left,n.right,u.__min,u.__max))}function s(){ot.unbind(window,"touchmove",d),ot.unbind(window,"touchend",s),u.__onFinishChange&&u.__onFinishChange.call(u,u.getValue())}Qe(this,t);var c=$e(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:a,max:o,step:i})),u=c;return c.__background=document.createElement("div"),c.__foreground=document.createElement("div"),ot.bind(c.__background,"mousedown",function(t){document.activeElement.blur(),ot.bind(window,"mousemove",r),ot.bind(window,"mouseup",l),r(t)}),ot.bind(c.__background,"touchstart",function(t){1!==t.touches.length||(ot.bind(window,"touchmove",d),ot.bind(window,"touchend",s),d(t))}),ot.addClass(c.__background,"slider"),ot.addClass(c.__foreground,"slider-fg"),c.updateDisplay(),c.__background.appendChild(c.__foreground),c.domElement.appendChild(c.__background),c}return Je(t,e),Ke(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",Ze(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(dt),ut=function(e){function t(e,n,a){Qe(this,t);var o=$e(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return o.__button=document.createElement("div"),o.__button.innerHTML=void 0===a?"Fire":a,ot.bind(o.__button,"click",function(t){return t.preventDefault(),o.fire(),!1}),ot.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return Je(t,e),Ke(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(tt),pt=function(e){function t(e,n){function a(t){s(t),ot.bind(window,"mousemove",s),ot.bind(window,"touchmove",s),ot.bind(window,"mouseup",i),ot.bind(window,"touchend",i)}function o(t){c(t),ot.bind(window,"mousemove",c),ot.bind(window,"touchmove",c),ot.bind(window,"mouseup",r),ot.bind(window,"touchend",r)}function i(){ot.unbind(window,"mousemove",s),ot.unbind(window,"touchmove",s),ot.unbind(window,"mouseup",i),ot.unbind(window,"touchend",i),d()}function r(){ot.unbind(window,"mousemove",c),ot.unbind(window,"touchmove",c),ot.unbind(window,"mouseup",r),ot.unbind(window,"touchend",r),d()}function l(){var e=Ye(this.value);!1===e?this.value=p.__color.toString():(p.__color.__state=e,p.setValue(p.__color.toOriginal()))}function d(){p.__onFinishChange&&p.__onFinishChange.call(p,p.__color.toOriginal())}function s(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=p.__saturation_field.getBoundingClientRect(),n=t.touches&&t.touches[0]||t,a=n.clientX,o=n.clientY,i=(a-e.left)/(e.right-e.left),r=1-(o-e.top)/(e.bottom-e.top);return 1<r?r=1:0>r&&(r=0),1<i?i=1:0>i&&(i=0),p.__color.v=r,p.__color.s=i,p.setValue(p.__color.toOriginal()),!1}function c(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=p.__hue_field.getBoundingClientRect(),n=t.touches&&t.touches[0]||t,a=n.clientY,o=1-(a-e.top)/(e.bottom-e.top);return 1<o?o=1:0>o&&(o=0),p.__color.h=360*o,p.setValue(p.__color.toOriginal()),!1}Qe(this,t);var u=$e(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));u.__color=new et(u.getValue()),u.__temp=new et(0);var p=u;u.domElement=document.createElement("div"),ot.makeSelectable(u.domElement,!1),u.__selector=document.createElement("div"),u.__selector.className="selector",u.__saturation_field=document.createElement("div"),u.__saturation_field.className="saturation-field",u.__field_knob=document.createElement("div"),u.__field_knob.className="field-knob",u.__field_knob_border="2px solid ",u.__hue_knob=document.createElement("div"),u.__hue_knob.className="hue-knob",u.__hue_field=document.createElement("div"),u.__hue_field.className="hue-field",u.__input=document.createElement("input"),u.__input.type="text",u.__input_textShadow="0 1px 1px ",ot.bind(u.__input,"keydown",function(t){13===t.keyCode&&l.call(this)}),ot.bind(u.__input,"blur",l),ot.bind(u.__selector,"mousedown",function(){ot.addClass(this,"drag").bind(window,"mouseup",function(){ot.removeClass(p.__selector,"drag")})}),ot.bind(u.__selector,"touchstart",function(){ot.addClass(this,"drag").bind(window,"touchend",function(){ot.removeClass(p.__selector,"drag")})});var m=document.createElement("div");return He.extend(u.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),He.extend(u.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:u.__field_knob_border+(.5>u.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),He.extend(u.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),He.extend(u.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),He.extend(m.style,{width:"100%",height:"100%",background:"none"}),N(m,"top","rgba(0,0,0,0)","#000"),He.extend(u.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),F(u.__hue_field),He.extend(u.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:u.__input_textShadow+"rgba(0,0,0,0.7)"}),ot.bind(u.__saturation_field,"mousedown",a),ot.bind(u.__saturation_field,"touchstart",a),ot.bind(u.__field_knob,"mousedown",a),ot.bind(u.__field_knob,"touchstart",a),ot.bind(u.__hue_field,"mousedown",o),ot.bind(u.__hue_field,"touchstart",o),u.__saturation_field.appendChild(m),u.__selector.appendChild(u.__field_knob),u.__selector.appendChild(u.__saturation_field),u.__selector.appendChild(u.__hue_field),u.__hue_field.appendChild(u.__hue_knob),u.domElement.appendChild(u.__input),u.domElement.appendChild(u.__selector),u.updateDisplay(),u}return Je(t,e),Ke(t,[{key:"updateDisplay",value:function(){var e=Ye(this.getValue());if(!1!==e){var t=!1;He.each(et.COMPONENTS,function(n){if(!He.isUndefined(e[n])&&!He.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}},this),t&&He.extend(this.__color.__state,e)}He.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=.5>this.__color.v||.5<this.__color.s?255:0,a=255-n;He.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,N(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),He.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+a+","+a+","+a+",.7)"})}}]),t}(tt),mt=["-moz-","-o-","-webkit-","-ms-",""],gt=function(e,t){var n=e[t];return He.isArray(arguments[2])||He.isObject(arguments[2])?new rt(e,t,arguments[2]):He.isNumber(n)?He.isNumber(arguments[2])&&He.isNumber(arguments[3])?He.isNumber(arguments[4])?new ct(e,t,arguments[2],arguments[3],arguments[4]):new ct(e,t,arguments[2],arguments[3]):He.isNumber(arguments[4])?new st(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new st(e,t,{min:arguments[2],max:arguments[3]}):He.isString(n)?new lt(e,t):He.isFunction(n)?new ut(e,t,""):He.isBoolean(n)?new it(e,t):null},ht=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},_t=function(){function e(){Qe(this,e),this.backgroundElement=document.createElement("div"),He.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),ot.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),He.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;ot.bind(this.backgroundElement,"click",function(){t.hide()})}return Ke(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),He.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function e(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",ot.unbind(t.domElement,"webkitTransitionEnd",e),ot.unbind(t.domElement,"transitionend",e),ot.unbind(t.domElement,"oTransitionEnd",e)};ot.bind(this.domElement,"webkitTransitionEnd",e),ot.bind(this.domElement,"transitionend",e),ot.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-ot.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-ot.getHeight(this.domElement)/2+"px"}}]),e}(),yt=function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");({load:function(e,t){var n=t||document,a=n.createElement("link");a.type="text/css",a.rel="stylesheet",a.href=e,n.getElementsByTagName("head")[0].appendChild(a)},inject:function(e,t){var n=t||document,a=document.createElement("style");a.type="text/css",a.innerHTML=e;var o=n.getElementsByTagName("head")[0];try{o.appendChild(a)}catch(t){}}}).inject(yt);var ft=72,vt=20,bt="Default",xt=function(){try{return!!window.localStorage}catch(t){return!1}}(),Et=void 0,kt=!0,At=void 0,Ct=!1,St=[],Dt=function e(t){var n=this,a=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),ot.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],a=He.defaults(a,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),a=He.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace}),He.isUndefined(a.load)?a.load={preset:bt}:a.preset&&(a.load.preset=a.preset),He.isUndefined(a.parent)&&a.hideable&&St.push(this),a.resizable=He.isUndefined(a.parent)&&a.resizable,a.autoPlace&&He.isUndefined(a.scrollable)&&(a.scrollable=!0);var o=xt&&"true"===localStorage.getItem(W(this,"isLocal")),i=void 0,r=void 0;if(Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},closeOnTop:{get:function(){return a.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:a.load.preset},set:function(e){n.parent?n.getRoot().preset=e:a.load.preset=e,ee(this),n.revert()}},width:{get:function(){return a.width},set:function(e){a.width=e,J(n,e)}},name:{get:function(){return a.name},set:function(e){a.name=e,r&&(r.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(t){a.closed=t,a.closed?ot.addClass(n.__ul,e.CLASS_CLOSED):ot.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return o},set:function(e){xt&&(o=e,e?ot.bind(window,"unload",i):ot.unbind(window,"unload",i),localStorage.setItem(W(n,"isLocal"),e))}}}),He.isUndefined(a.parent)){if(this.closed=a.closed||!1,ot.addClass(this.domElement,e.CLASS_MAIN),ot.makeSelectable(this.domElement,!1),xt&&o){n.useLocalStorage=!0;var l=localStorage.getItem(W(this,"gui"));l&&(a.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,ot.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),a.closeOnTop?(ot.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(ot.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),ot.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{void 0===a.closed&&(a.closed=!0);var d=document.createTextNode(a.name);ot.addClass(d,"controller-name"),r=H(n,d);var s=function(t){return t.preventDefault(),n.closed=!n.closed,!1};ot.addClass(this.__ul,e.CLASS_CLOSED),ot.addClass(r,"title"),ot.bind(r,"click",s),a.closed||(this.closed=!1)}a.autoPlace&&(He.isUndefined(a.parent)&&(kt&&(At=document.createElement("div"),ot.addClass(At,"dg"),ot.addClass(At,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(At),kt=!1),At.appendChild(this.domElement),ot.addClass(this.domElement,e.CLASS_AUTO_PLACE)),!this.parent&&J(n,a.width)),this.__resizeHandler=function(){n.onResizeDebounced()},ot.bind(window,"resize",this.__resizeHandler),ot.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),ot.bind(this.__ul,"transitionend",this.__resizeHandler),ot.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),a.resizable&&Z(this),i=function(){xt&&"true"===localStorage.getItem(W(n,"isLocal"))&&localStorage.setItem(W(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=i,a.parent||function(){var e=n.getRoot();e.width+=1,He.defer(function(){e.width-=1})}()};Dt.toggleHide=function(){Ct=!Ct,He.each(St,function(e){e.domElement.style.display=Ct?"none":""})},Dt.CLASS_AUTO_PLACE="a",Dt.CLASS_AUTO_PLACE_CONTAINER="ac",Dt.CLASS_MAIN="main",Dt.CLASS_CONTROLLER_ROW="cr",Dt.CLASS_TOO_TALL="taller-than-window",Dt.CLASS_CLOSED="closed",Dt.CLASS_CLOSE_BUTTON="close-button",Dt.CLASS_CLOSE_TOP="close-top",Dt.CLASS_CLOSE_BOTTOM="close-bottom",Dt.CLASS_DRAG="drag",Dt.DEFAULT_WIDTH=245,Dt.TEXT_CLOSED="Close Controls",Dt.TEXT_OPEN="Open Controls",Dt._keydownHandler=function(t){"text"!==document.activeElement.type&&(t.which===ft||t.keyCode===ft)&&Dt.toggleHide()},ot.bind(window,"keydown",Dt._keydownHandler,!1),He.extend(Dt.prototype,{add:function(e,t){return X(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return X(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;He.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&At.removeChild(this.domElement);var e=this;He.each(this.__folders,function(t){e.removeFolder(t)}),ot.unbind(window,"keydown",Dt._keydownHandler,!1),U(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error("You already have a folder in this GUI by the name \""+e+"\"");var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new Dt(t);this.__folders[e]=n;var a=H(this,n.domElement);return ot.addClass(a,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],U(e);var t=this;He.each(e.__folders,function(t){e.removeFolder(t)}),He.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=ot.getOffset(e.__ul).top,n=0;He.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=ot.getHeight(t))}),window.innerHeight-t-vt<n?(ot.addClass(e.domElement,Dt.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-vt+"px"):(ot.removeClass(e.domElement,Dt.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&He.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:He.debounce(function(){this.onResize()},50),remember:function(){if(He.isUndefined(Et)&&(Et=new _t,Et.domElement.innerHTML="<div id=\"dg-save\" class=\"dg dialogue\">\n\n  Here's the new load parameter for your <code>GUI</code>'s constructor:\n\n  <textarea id=\"dg-new-constructor\"></textarea>\n\n  <div id=\"dg-save-locally\">\n\n    <input id=\"dg-local-storage\" type=\"checkbox\"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id=\"dg-local-explain\">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>"),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;He.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&K(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&J(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,0<this.__rememberedObjects.length&&(e.preset=this.preset,!e.remembered&&(e.remembered={}),e.remembered[this.preset]=$(this)),e.folders={},He.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=$(this),G(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[bt]=$(this,!0)),this.load.remembered[e]=$(this),this.preset=e,q(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){He.each(this.__controllers,function(t){this.getRoot().load.remembered?Y(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),He.each(this.__folders,function(e){e.revert(e)}),e||G(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&te(this.__listening)},updateDisplay:function(){He.each(this.__controllers,function(e){e.updateDisplay()}),He.each(this.__folders,function(e){e.updateDisplay()})}});var Pt,Ot=Dt,It=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"demo";s(this,t),this.id=n,this.renderer=null,this.loadingManager=new e.LoadingManager,this.assets=new Map,this.scene=new e.Scene,this.camera=null,this.controls=null,this.ready=!1}return u(t,[{key:"setRenderer",value:function(e){return this.renderer=e,this}},{key:"load",value:function(){return Promise.resolve()}},{key:"initialize",value:function(){}},{key:"render",value:function(){this.renderer.render(this.scene,this.camera)}},{key:"registerOptions",value:function(){}},{key:"reset",value:function(){return this.scene=new e.Scene,this.camera=null,null!==this.controls&&(this.controls.dispose(),this.controls=null),this.ready=!1,this}}]),t}(),Tt=function(e){function t(e){var n;return s(this,t),n=A(this,h(t).call(this,e)),n.previousDemo=null,n.demo=null,n}return g(t,e),t}(t.Event),Lt=new Tt("change"),zt=new Tt("load"),wt=function(t){function n(t){var a,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=o.aside,r=void 0===i?t:i,l=o.renderer;return s(this,n),a=A(this,h(n).call(this)),a.renderer=void 0===l?function(){var n=new e.WebGLRenderer;return n.setSize(t.clientWidth,t.clientHeight),n.setPixelRatio(window.devicePixelRatio),n}():l,t.appendChild(a.renderer.domElement),a.clock=new e.Clock,a.menu=new Ot({autoPlace:!1}),r.appendChild(a.menu.domElement),a.demos=new Map,a.demo=null,a.currentDemo=null,a}return g(n,t),u(n,[{key:"resetMenu",value:function(){var e=this,t=this.menu.domElement.parentNode,n=new Ot({autoPlace:!1});if(1<this.demos.size){var a=n.add(this,"demo",Array.from(this.demos.keys()));a.onChange(function(){return e.loadDemo()})}return t.removeChild(this.menu.domElement),t.appendChild(n.domElement),this.menu.destroy(),this.menu=n,n}},{key:"startDemo",value:function(e){e.id===this.demo&&(e.initialize(),e.registerOptions(this.resetMenu()),e.ready=!0,zt.demo=e,this.dispatchEvent(zt))}},{key:"loadDemo",value:function(){var e=this,t=this.demos.get(this.demo),n=this.currentDemo,a=this.renderer;window.location.hash=t.id,null!==n&&n.reset(),this.menu.domElement.style.display="none",Lt.previousDemo=n,Lt.demo=t,this.currentDemo=t,this.dispatchEvent(Lt),a.clear(),t.load().then(function(){return e.startDemo(t)})["catch"](console.error)}},{key:"addDemo",value:function(e){var t=window.location.hash.slice(1),n=this.currentDemo;return this.demos.set(e.id,e.setRenderer(this.renderer)),(null===this.demo&&0===t.length||e.id===t)&&(this.demo=e.id,this.loadDemo()),this.resetMenu(),null!==n&&n.ready&&n.registerOptions(this.menu),this}},{key:"removeDemo",value:function(e){var t,n=this.demos;return n.has(e)&&(n["delete"](e),this.demo===e&&0<n.size?(t=n.entries().next().value,this.demo=t[0],this.currentDemo=t[1],this.loadDemo()):(this.demo=null,this.currentDemo=null,this.renderer.clear())),this}},{key:"setSize",value:function(t,n,a){var o=this.currentDemo;if(this.renderer.setSize(t,n,a),null!==o&&null!==o.camera){var i=o.camera;i instanceof e.OrthographicCamera?(i.left=t/-2,i.right=t/2,i.top=n/2,i.bottom=n/-2,i.updateProjectionMatrix()):!(i instanceof e.CubeCamera)&&(i.aspect=t/n,i.updateProjectionMatrix())}}},{key:"render",value:function(){var e=this.currentDemo,t=this.clock.getDelta();null!==e&&e.ready&&e.render(t)}}]),n}(t.EventTarget),Rt={MOVE_FORWARD:0,MOVE_LEFT:1,MOVE_BACKWARD:2,MOVE_RIGHT:3,MOVE_DOWN:4,MOVE_UP:5,ZOOM_OUT:6,ZOOM_IN:7},Bt={MAIN:0,AUXILIARY:1,SECONDARY:2},Mt=new o.Vector3,n=new o.Matrix4,d=function(){function e(t,n,a,i){s(this,e),this.position=t,this.quaternion=n,this.target=a,this.settings=i,this.spherical=new o.Spherical}return u(e,[{key:"setPosition",value:function(e){return this.position=e,this}},{key:"setQuaternion",value:function(e){return this.quaternion=e,this}},{key:"setTarget",value:function(e){return this.target=e,this}},{key:"updateQuaternion",value:function(){var e=this.settings,t=e.rotation;return e.general.orbit?n.lookAt(Mt.subVectors(this.position,this.target),t.pivotOffset,t.up):n.lookAt(Mt.set(0,0,0),this.target.setFromSpherical(this.spherical),t.up),this.quaternion.setFromRotationMatrix(n),this}},{key:"adjustSpherical",value:function(e,t){var n=this.settings,a=n.general.orbit,o=n.rotation,i=this.spherical;return i.theta=o.invertX?i.theta+e:i.theta-e,i.phi=(a||o.invertY)&&!(a&&o.invertY)?i.phi-t:i.phi+t,i.theta=Re(Le(i.theta,o.minAzimuthalAngle),o.maxAzimuthalAngle),i.phi=Re(Le(i.phi,o.minPolarAngle),o.maxPolarAngle),i.theta%=2*Te,i.makeSafe(),a&&this.position.setFromSpherical(i).add(this.target),this}},{key:"zoom",value:function e(t){var n,a,o,i=this.settings,r=i.general,l=i.sensitivity,e=i.zoom,d=this.spherical;return r.orbit&&e.enabled&&(n=t*l.zoom,e.invert&&(n=-n),a=Le(e.minDistance,1e-6),o=Re(e.maxDistance,1/0),d.radius=Re(Le(d.radius+n,a),o),this.position.setFromSpherical(d).add(this.target)),this}},{key:"update",value:function(){}},{key:"lookAt",value:function(e){var t=this.spherical,n=this.position,a=this.target;return a.copy(e),this.settings.general.orbit?Mt.subVectors(n,a):Mt.subVectors(a,n).normalize(),t.setFromVector3(Mt),t.radius=Le(t.radius,1e-6),this.updateQuaternion(),this}},{key:"getViewDirection",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new o.Vector3;return e.setFromSpherical(this.spherical).normalize(),this.settings.general.orbit&&e.negate(),e}}]),e}(),m=function(){function e(){s(this,e),this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.up=!1,this.down=!1}return u(e,[{key:"reset",value:function(){return this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.up=!1,this.down=!1,this}}]),e}(),v=new o.Vector3(1,0,0),x=new o.Vector3(0,1,0),y=new o.Vector3(0,0,1),z=new o.Vector3,Vt=function(){function e(t,n,a,o){s(this,e),this.position=t,this.quaternion=n,this.target=a,this.settings=o,this.movementState=new m}return u(e,[{key:"setPosition",value:function(e){return this.position=e,this}},{key:"setQuaternion",value:function(e){return this.quaternion=e,this}},{key:"setTarget",value:function(e){return this.target=e,this}},{key:"translateOnAxis",value:function(e,t){z.copy(e).applyQuaternion(this.quaternion).multiplyScalar(t),this.position.add(z),this.settings.general.orbit&&this.target.add(z)}},{key:"translate",value:function(e){var t=this.settings.sensitivity,n=this.movementState,a=e*t.translation;n.backward?this.translateOnAxis(y,a):n.forward&&this.translateOnAxis(y,-a),n.right?this.translateOnAxis(v,a):n.left&&this.translateOnAxis(v,-a),n.up?this.translateOnAxis(x,a):n.down&&this.translateOnAxis(x,-a)}},{key:"update",value:function(e){this.settings.translation.enabled&&this.translate(e)}},{key:"moveTo",value:function(e){return this.settings.general.orbit?this.target.copy(e):this.position.copy(e),this}}]),e}(),Nt=new Proxy({BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,META_LEFT:91,META_RIGHT:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222},{get:function(e,t){return t in e?e[t]:1===t.length?t.toUpperCase().charCodeAt(0):void 0}}),Ft=function(){function e(){s(this,e),this.orbit=!0}return u(e,[{key:"copy",value:function(e){return this.orbit=e.orbit,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),Ht=function(){function e(){s(this,e),this.defaultActions=new Map,this.actions=new Map}return u(e,[{key:"reset",value:function(){return this.actions=new Map(this.defaultActions),this}},{key:"setDefault",value:function(e){return this.defaultActions=e,this.reset()}},{key:"copy",value:function(e){return this.defaultActions=new Map(e.defaultActions),this.actions=new Map(e.actions),this}},{key:"clearDefault",value:function(){return this.defaultActions.clear(),this}},{key:"clear",value:function(){return this.actions.clear(),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"has",value:function(e){return this.actions.has(e)}},{key:"get",value:function(e){return this.actions.get(e)}},{key:"set",value:function(e,t){return this.actions.set(e,t),this}},{key:"delete",value:function(e){return this.actions["delete"](e)}},{key:"toJSON",value:function(){return{defaultActions:D(this.defaultActions),actions:D(this.actions)}}}]),e}(),Ut=function(){function e(){s(this,e),this.hold=!1,this.lock=!0}return u(e,[{key:"copy",value:function(e){return this.hold=e.hold,this.lock=e.lock,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),Gt=function(){function e(){s(this,e),this.up=new o.Vector3,this.up.copy(x),this.pivotOffset=new o.Vector3,this.minAzimuthalAngle=-Infinity,this.maxAzimuthalAngle=1/0,this.minPolarAngle=0,this.maxPolarAngle=Te,this.invertX=!1,this.invertY=!1}return u(e,[{key:"copy",value:function(e){return this.up.copy(e.up),this.pivotOffset.copy(e.pivotOffset),this.minAzimuthalAngle=null===e.minAzimuthalAngle?-Infinity:e.minAzimuthalAngle,this.maxAzimuthalAngle=null===e.maxAzimuthalAngle?1/0:e.maxAzimuthalAngle,this.minPolarAngle=e.minPolarAngle,this.maxPolarAngle=e.maxPolarAngle,this.invertX=e.invertX,this.invertY=e.invertY,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),jt=function(){function e(){s(this,e),this.rotation=.0025,this.translation=1,this.zoom=.1}return u(e,[{key:"copy",value:function(e){return this.rotation=e.rotation,this.translation=e.translation,this.zoom=e.zoom,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),Yt=function(){function e(){s(this,e),this.enabled=!0}return u(e,[{key:"copy",value:function(e){return this.enabled=e.enabled,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),Xt=function(){function e(){s(this,e),this.enabled=!0,this.invert=!1,this.minDistance=1e-6,this.maxDistance=1/0}return u(e,[{key:"copy",value:function(e){return this.enabled=e.enabled,this.invert=e.invert,this.minDistance=e.minDistance,this.maxDistance=e.maxDistance,this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),Wt=function(){function e(){s(this,e),this.general=new Ft,this.keyBindings=new Ht,this.keyBindings.setDefault(new Map([[Nt.W,Rt.MOVE_FORWARD],[Nt.UP,Rt.MOVE_FORWARD],[Nt.A,Rt.MOVE_LEFT],[Nt.LEFT,Rt.MOVE_LEFT],[Nt.S,Rt.MOVE_BACKWARD],[Nt.DOWN,Rt.MOVE_BACKWARD],[Nt.D,Rt.MOVE_RIGHT],[Nt.RIGHT,Rt.MOVE_RIGHT],[Nt.X,Rt.MOVE_DOWN],[Nt.SPACE,Rt.MOVE_UP],[Nt.PAGE_DOWN,Rt.ZOOM_OUT],[Nt.PAGE_UP,Rt.ZOOM_IN]])),this.pointer=new Ut,this.rotation=new Gt,this.sensitivity=new jt,this.translation=new Yt,this.zoom=new Xt}return u(e,[{key:"copy",value:function(e){return this.general.copy(e.general),this.keyBindings.copy(e.keyBindings),this.pointer.copy(e.pointer),this.rotation.copy(e.rotation),this.sensitivity.copy(e.sensitivity),this.translation.copy(e.translation),this.zoom.copy(e.zoom),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"toDataURL",value:function(){return URL.createObjectURL(new Blob([JSON.stringify(this)],{type:"text/json"}))}}]),e}(),qt=function(){function e(){s(this,e)}return u(e,[{key:"execute",value:function(){throw new Error("Strategy#execute method not implemented!")}}]),e}(),Qt=function(e){function t(e,n){var a;return s(this,t),a=A(this,h(t).call(this)),a.movementState=e,a.direction=n,a}return g(t,e),u(t,[{key:"execute",value:function(e){var t=this.movementState;switch(this.direction){case Kt.FORWARD:t.forward=e;break;case Kt.LEFT:t.left=e;break;case Kt.BACKWARD:t.backward=e;break;case Kt.RIGHT:t.right=e;break;case Kt.DOWN:t.down=e;break;case Kt.UP:t.up=e;}}}]),t}(qt),Kt={FORWARD:0,LEFT:1,BACKWARD:2,RIGHT:3,DOWN:4,UP:5},Zt=function(e){function t(e,n){var a;return s(this,t),a=A(this,h(t).call(this)),a.rotationManager=e,a.zoomIn=n,a}return g(t,e),u(t,[{key:"execute",value:function(e){e&&this.rotationManager.zoom(this.zoomIn?-1:1)}}]),t}(qt),Jt=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:document.body;s(this,e),this.dom=a,this.position=t,this.quaternion=n,this.target=new o.Vector3,this.settings=new Wt,this.rotationManager=new d(t,n,this.target,this.settings),this.translationManager=new Vt(t,n,this.target,this.settings),this.strategies=function(e,t){var n=t.movementState;return new Map([[Rt.MOVE_FORWARD,new Qt(n,Kt.FORWARD)],[Rt.MOVE_LEFT,new Qt(n,Kt.LEFT)],[Rt.MOVE_BACKWARD,new Qt(n,Kt.BACKWARD)],[Rt.MOVE_RIGHT,new Qt(n,Kt.RIGHT)],[Rt.MOVE_DOWN,new Qt(n,Kt.DOWN)],[Rt.MOVE_UP,new Qt(n,Kt.UP)],[Rt.ZOOM_OUT,new Zt(e,!1)],[Rt.ZOOM_IN,new Zt(e,!0)]])}(this.rotationManager,this.translationManager),this.lastScreenPosition=new o.Vector2,this.dragging=!1,this.enabled=!1,null!==t&&null!==n&&(this.lookAt(this.target),null!==a&&this.setEnabled())}return u(e,[{key:"getDom",value:function(){return this.dom}},{key:"getPosition",value:function(){return this.position}},{key:"getQuaternion",value:function(){return this.quaternion}},{key:"getTarget",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new o.Vector3;return e.copy(this.target),this.settings.general.orbit||e.add(this.position),e}},{key:"getViewDirection",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new o.Vector3;return this.rotationManager.getViewDirection(e)}},{key:"setDom",value:function(e){var t=this.enabled;return null!==e&&(t&&this.setEnabled(!1),this.dom=e,this.setEnabled(t)),this}},{key:"setPosition",value:function(e){return this.position=e,this.rotationManager.setPosition(e),this.translationManager.setPosition(e),this.lookAt(this.target)}},{key:"setQuaternion",value:function(e){return this.quaternion=e,this.rotationManager.setQuaternion(e),this.translationManager.setQuaternion(e),this.lookAt(this.target)}},{key:"setTarget",value:function(e){return this.target=e,this.rotationManager.setTarget(e),this.translationManager.setTarget(e),this.lookAt(this.target)}},{key:"setOrbitEnabled",value:function(e){var t=this.settings.general;return t.orbit!==e&&(this.getTarget(this.target),t.orbit=e,this.lookAt(this.target)),this}},{key:"copy",value:function(e){return this.dom=e.getDom(),this.position=e.getPosition(),this.quaternion=e.getQuaternion(),this.target=e.getTarget(),this.settings.copy(e.settings),this.rotationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.translationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.lookAt(this.target)}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"handlePointerMoveEvent",value:function(e){var t,n,a=this.settings,o=a.pointer,i=a.sensitivity,r=this.rotationManager,l=this.lastScreenPosition;document.pointerLockElement===this.dom?(!o.hold||this.dragging)&&r.adjustSpherical(e.movementX*i.rotation,e.movementY*i.rotation).updateQuaternion():(t=e.screenX-l.x,n=e.screenY-l.y,l.set(e.screenX,e.screenY),r.adjustSpherical(t*i.rotation,n*i.rotation).updateQuaternion())}},{key:"handleTouchMoveEvent",value:function(e){var t=this.settings.sensitivity,n=this.rotationManager,a=this.lastScreenPosition,o=e.touches[0],i=o.screenX-a.x,r=o.screenY-a.y;a.set(o.screenX,o.screenY),e.preventDefault(),n.adjustSpherical(i*t.rotation,r*t.rotation).updateQuaternion()}},{key:"handleMainPointerButton",value:function(e,t){this.dragging=t,this.settings.pointer.lock?this.setPointerLocked():t?(this.lastScreenPosition.set(e.screenX,e.screenY),this.dom.addEventListener("mousemove",this)):this.dom.removeEventListener("mousemove",this)}},{key:"handleAuxiliaryPointerButton",value:function(){}},{key:"handleSecondaryPointerButton",value:function(){}},{key:"handlePointerButtonEvent",value:function(e,t){switch(e.preventDefault(),e.button){case Bt.MAIN:this.handleMainPointerButton(e,t);break;case Bt.AUXILIARY:this.handleAuxiliaryPointerButton(e,t);break;case Bt.SECONDARY:this.handleSecondaryPointerButton(e,t);}}},{key:"handleTouchEvent",value:function(e,t){var n=e.touches[0];e.preventDefault(),t?(this.lastScreenPosition.set(n.screenX,n.screenY),this.dom.addEventListener("touchmove",this)):this.dom.removeEventListener("touchmove",this)}},{key:"handleKeyboardEvent",value:function(e,t){var n=this.settings.keyBindings;n.has(e.keyCode)&&(e.preventDefault(),this.strategies.get(n.get(e.keyCode)).execute(t))}},{key:"handleWheelEvent",value:function(e){this.rotationManager.zoom(Ie(e.deltaY))}},{key:"handlePointerLockEvent",value:function(){document.pointerLockElement===this.dom?this.dom.addEventListener("mousemove",this):this.dom.removeEventListener("mousemove",this)}},{key:"handleEvent",value:function(e){switch(e.type){case"mousemove":this.handlePointerMoveEvent(e);break;case"touchmove":this.handleTouchMoveEvent(e);break;case"mousedown":this.handlePointerButtonEvent(e,!0);break;case"mouseup":this.handlePointerButtonEvent(e,!1);break;case"touchstart":this.handleTouchEvent(e,!0);break;case"touchend":this.handleTouchEvent(e,!1);break;case"keydown":this.handleKeyboardEvent(e,!0);break;case"keyup":this.handleKeyboardEvent(e,!1);break;case"wheel":this.handleWheelEvent(e);break;case"pointerlockchange":this.handlePointerLockEvent();}}},{key:"update",value:function(e){this.rotationManager.update(e),this.translationManager.update(e)}},{key:"moveTo",value:function(e){return this.rotationManager.moveTo(e),this}},{key:"lookAt",value:function(e){return this.rotationManager.lookAt(e),this}},{key:"setPointerLocked",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];e?document.pointerLockElement!==this.dom&&void 0!==this.dom.requestPointerLock&&this.dom.requestPointerLock():void 0!==document.exitPointerLock&&document.exitPointerLock()}},{key:"setEnabled",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=this.dom;return this.translationManager.movementState.reset(),e&&!this.enabled?(document.addEventListener("pointerlockchange",this),document.body.addEventListener("keyup",this),document.body.addEventListener("keydown",this),t.addEventListener("mousedown",this),t.addEventListener("mouseup",this),t.addEventListener("touchstart",this),t.addEventListener("touchend",this),t.addEventListener("wheel",this)):!e&&this.enabled&&(document.removeEventListener("pointerlockchange",this),document.body.removeEventListener("keyup",this),document.body.removeEventListener("keydown",this),t.removeEventListener("mousedown",this),t.removeEventListener("mouseup",this),t.removeEventListener("touchstart",this),t.removeEventListener("touchend",this),t.removeEventListener("wheel",this),t.removeEventListener("mousemove",this),t.removeEventListener("touchmove",this)),this.setPointerLocked(!1),this.enabled=e,this}},{key:"dispose",value:function(){this.setEnabled(!1)}}]),e}(),$t=0,en=function(t){var a=Math.cbrt;function n(){var t,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3],l=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];s(this,n),t=A(this,h(n).call(this)),t.name="HermiteDataHelper",t.cellPosition=a,t.cellSize=o,t.data=i,t.pointsMaterial=new e.PointsMaterial({vertexColors:e.VertexColors,sizeAttenuation:!0,size:.05}),t.add(new e.Group),t.add(new e.Group),t.add(new e.Group),t.gridPoints.name="GridPoints",t.edges.name="Edges",t.normals.name="Normals";try{t.update(r,l)}catch(t){}return t}return g(n,t),u(n,[{key:"validate",value:function(){var e=null;return null===this.cellPosition?e=new Error("The cell position is not defined"):0>=this.cellSize?e=new Error("Invalid cell size: "+this.cellSize):null===this.data?e=new Error("No data"):(this.data.empty&&(e=new Error("The provided data is empty")),this.data.compressed&&(e=new Error("The provided data must be uncompressed"))),e}},{key:"set",value:function(e,t,n){return this.cellPosition=e,this.cellSize=t,this.data=n,this}},{key:"update",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=this.data,a=this.validate();if(this.dispose(),null!==a)throw a;else e&&this.createPoints(n),t&&null!==n.edgeData&&this.createEdges(n);return this}},{key:"createPoints",value:function(t){var o,r,l,d,c,u=t.materialIndices,p=a(u.length)-1,n=this.cellSize,s=this.cellPosition,m=new e.Vector3,g=new e.Vector3,h=new Float32Array([0,0,0]),_=new e.BufferGeometry,f=t.materials,v=new Float32Array(3*f),b=new Float32Array(3*f);for(d=0,c=0,l=0;l<=p;++l)for(m.z=l*n/p,r=0;r<=p;++r)for(m.y=r*n/p,o=0;o<=p;++o)m.x=o*n/p,u[d++]!==$t&&(g.addVectors(s,m),v[c]=g.x,b[c++]=h[0],v[c]=g.y,b[c++]=h[1],v[c]=g.z,b[c++]=h[2]);_.addAttribute("position",new e.BufferAttribute(v,3)),_.addAttribute("color",new e.BufferAttribute(b,3)),this.gridPoints.add(new e.Points(_,this.pointsMaterial))}},{key:"createEdges",value:function(t){var o,r,l,c,u,p,m,g,h,_,y,f,v=t.edgeData,b=a(t.materialIndices.length)-1,n=this.cellSize,s=new e.Vector3,x=new e.Vector3,E=[v.edgesX(this.cellPosition,this.cellSize),v.edgesY(this.cellPosition,this.cellSize),v.edgesZ(this.cellPosition,this.cellSize)],k=[new Float32Array([.6,0,0]),new Float32Array([0,.6,0]),new Float32Array([0,0,.6])],A=new Float32Array([0,1,1]),C=new e.LineBasicMaterial({vertexColors:e.VertexColors});for(y=0,f=0,_=0;3>_;++_,y=0,f=0)if(p=k[_],g=E[_],0<g.lengths.length){u=2*g.lengths[0],o=new Float32Array(3*u),r=new Float32Array(3*u),l=new Float32Array(3*u),c=new Float32Array(3*u);var S=!0,D=!1,P=void 0;try{for(var O,I=g[Symbol.iterator]();!(S=(O=I.next()).done);S=!0)h=O.value,o[y]=h.a.x,r[y++]=p[0],o[y]=h.a.y,r[y++]=p[1],o[y]=h.a.z,r[y++]=p[2],o[y]=h.b.x,r[y++]=p[0],o[y]=h.b.y,r[y++]=p[1],o[y]=h.b.z,r[y++]=p[2],h.computeZeroCrossingPosition(s),x.copy(s).addScaledVector(h.n,.25*n/b),l[f]=s.x,c[f++]=A[0],l[f]=s.y,c[f++]=A[1],l[f]=s.z,c[f++]=A[2],l[f]=x.x,c[f++]=A[0],l[f]=x.y,c[f++]=A[1],l[f]=x.z,c[f++]=A[2]}catch(e){D=!0,P=e}finally{try{S||null==I["return"]||I["return"]()}finally{if(D)throw P}}m=new e.BufferGeometry,m.addAttribute("position",new e.BufferAttribute(o,3)),m.addAttribute("color",new e.BufferAttribute(r,3)),this.edges.add(new e.LineSegments(m,C)),m=new e.BufferGeometry,m.addAttribute("position",new e.BufferAttribute(l,3)),m.addAttribute("color",new e.BufferAttribute(c,3)),this.normals.add(new e.LineSegments(m,C))}}},{key:"dispose",value:function(){var e,t,n,a;for(n=0,a=this.children.length;n<a;++n)for(e=this.children[n],t=e.children;0<t.length;)t[0].geometry.dispose(),t[0].material.dispose(),e.remove(t[0])}},{key:"gridPoints",get:function(){return this.children[0]}},{key:"edges",get:function(){return this.children[1]}},{key:"normals",get:function(){return this.children[2]}}],[{key:"air",set:function(e){$t=e}}]),n}(e.Group),tn=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],nn=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],an=function(t){function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return s(this,n),e=A(this,h(n).call(this)),e.name="OctreeHelper",e.octree=t,e.update(),e}return g(n,t),u(n,[{key:"createLineSegments",value:function(t,a){var o,r,l,s,u,p,m,g,h,_,y,f,v,b,x,E,k=Me(2,16)/8-1,A=new e.Group,C=new e.LineBasicMaterial({color:16777215*Math.random()});for(_=0,l=0,b=we(a/8191);0<b;--b){for(l+=8191>a?a:8191,a-=8191,r=8*l,s=new Uint16Array(3*r),u=new Float32Array(3*r),(f=0,v=0,o=t.next());!o.done&&_<l;){for(p=o.value,m=p.min,g=p.max,y=0;12>y;++y)E=tn[y],s[v++]=f+E[0],s[v++]=f+E[1];for(y=0;8>y;++y,++f)x=nn[y],u[3*f]=0===x[0]?m.x:g.x,u[3*f+1]=0===x[1]?m.y:g.y,u[3*f+2]=0===x[2]?m.z:g.z;++_<l&&(o=t.next())}h=new e.BufferGeometry,h.setIndex(new e.BufferAttribute(s,1)),h.addAttribute("position",new e.BufferAttribute(u,3)),A.add(new e.LineSegments(h,C))}this.add(A)}},{key:"update",value:function(){var e,t=null===this.octree?-1:this.octree.getDepth(),n=0;for(this.dispose();n<=t;)e=this.octree.findNodesByLevel(n),this.createLineSegments(e[Symbol.iterator](),"number"==typeof e.size?e.size:e.length),++n}},{key:"dispose",value:function(){var e,t,n,a,o,r,l=this.children;for(n=0,o=l.length;n<o;++n){for(e=l[n],t=e.children,(a=0,r=t.length);a<r;++a)t[a].geometry.dispose(),t[a].material.dispose();for(;0<t.length;)e.remove(t[0])}for(;0<l.length;)this.remove(l[0])}}]),n}(e.Group),on={UNION:"csg.union",DIFFERENCE:"csg.difference",INTERSECTION:"csg.intersection",DENSITY_FUNCTION:"csg.densityfunction"},rn={AIR:0,SOLID:1},ln=function(){function e(t){s(this,e),this.type=t;for(var n=arguments.length,a=Array(1<n?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];this.children=a,this.boundingBox=null}return u(e,[{key:"getBoundingBox",value:function(){return null===this.boundingBox&&(this.boundingBox=this.computeBoundingBox()),this.boundingBox}},{key:"computeBoundingBox",value:function(){var e,t,n=this.children,a=new o.Box3;for(e=0,t=n.length;e<t;++e)a.union(n[e].getBoundingBox());return a}}]),e}(),dn=function(e){function t(){var e;s(this,t);for(var n=arguments.length,a=Array(n),o=0;o<n;o++)a[o]=arguments[o];return A(this,(e=h(t)).call.apply(e,[this,on.UNION].concat(a)))}return g(t,e),u(t,[{key:"updateMaterialIndex",value:function(e,t,n){var a=n.materialIndices[e];a!==rn.AIR&&t.setMaterialIndex(e,a)}},{key:"selectEdge",value:function(e,t,n){return n?e.t>t.t?e:t:e.t<t.t?e:t}}]),t}(ln),sn=function(e){function t(){var e;s(this,t);for(var n=arguments.length,a=Array(n),o=0;o<n;o++)a[o]=arguments[o];return A(this,(e=h(t)).call.apply(e,[this,on.DIFFERENCE].concat(a)))}return g(t,e),u(t,[{key:"updateMaterialIndex",value:function(e,t,n){n.materialIndices[e]!==rn.AIR&&t.setMaterialIndex(e,rn.AIR)}},{key:"selectEdge",value:function(e,t,n){return n?e.t<t.t?e:t:e.t>t.t?e:t}}]),t}(ln),cn=function(e){function t(){var e;s(this,t);for(var n=arguments.length,a=Array(n),o=0;o<n;o++)a[o]=arguments[o];return A(this,(e=h(t)).call.apply(e,[this,on.INTERSECTION].concat(a)))}return g(t,e),u(t,[{key:"updateMaterialIndex",value:function(e,t,n){var a=n.materialIndices[e];t.setMaterialIndex(e,t.materialIndices[e]!==rn.AIR&&a!==rn.AIR?a:rn.AIR)}},{key:"selectEdge",value:function(e,t,n){return n?e.t<t.t?e:t:e.t>t.t?e:t}}]),t}(ln),un=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;s(this,e),this.runLengths=t,this.data=n}return u(e,null,[{key:"encode",value:function(t){var n,a,o=[],r=[],d=t[0],s=1;for(n=1,a=t.length;n<a;++n)d===t[n]?++s:(o.push(s),r.push(d),d=t[n],s=1);return o.push(s),r.push(d),new e(o,r)}},{key:"decode",value:function(e,t){var n,a,o,r,l,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],s=0;for(a=0,r=t.length;a<r;++a)for(n=t[a],o=0,l=e[a];o<l;++o)d[s++]=n;return d}}]),e}(),pn=new o.Vector3,mn=new o.Vector3,p=new o.Vector3,gn=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new o.Vector3,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new o.Vector3;s(this,e),this.a=t,this.b=n,this.index=-1,this.coordinates=new o.Vector3,this.t=0,this.n=new o.Vector3}return u(e,[{key:"approximateZeroCrossing",value:function(e){var t,n,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,r=Le(1,o-1),l=0,d=1,s=0,u=0;for(pn.subVectors(this.b,this.a);u<=r&&(s=(l+d)/2,mn.addVectors(this.a,p.copy(pn).multiplyScalar(s)),n=e.sample(mn),!(Be(n)<=1e-4||(d-l)/2<=1e-6));)mn.addVectors(this.a,p.copy(pn).multiplyScalar(l)),t=e.sample(mn),Ie(n)===Ie(t)?l=s:d=s,++u;this.t=s}},{key:"computeZeroCrossingPosition",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new o.Vector3;return e.subVectors(this.b,this.a).multiplyScalar(this.t).add(this.a)}},{key:"computeSurfaceNormal",value:function(e){var t=this.computeZeroCrossingPosition(pn),n=1e-3,a=e.sample(mn.addVectors(t,p.set(n,0,0)))-e.sample(mn.subVectors(t,p.set(n,0,0))),o=e.sample(mn.addVectors(t,p.set(0,n,0)))-e.sample(mn.subVectors(t,p.set(0,n,0))),i=e.sample(mn.addVectors(t,p.set(0,0,n)))-e.sample(mn.subVectors(t,p.set(0,0,n)));this.n.set(a,o,i).normalize()}}]),e}(),hn=new gn,_n=new o.Vector3,yn=new o.Vector3,fn=function(){function e(t,n,a){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:3;s(this,e),this.edgeData=t,this.cellPosition=n,this.cellSize=a,this.indices=null,this.zeroCrossings=null,this.normals=null,this.axes=null,this.lengths=null,this.result=new i,this.initialC=o,this.c=o,this.initialD=r,this.d=r,this.i=0,this.l=0,this.reset()}return u(e,[{key:"reset",value:function(){var e,t,n,o,i=this.edgeData,s=[],u=[],p=[],m=[],g=[];for(this.i=0,this.c=0,this.d=0,(t=this.initialC,e=4>>t,n=this.initialD);t<n;++t,e>>=1)o=i.indices[t].length,0<o&&(s.push(i.indices[t]),u.push(i.zeroCrossings[t]),p.push(i.normals[t]),m.push(r.layout[e]),g.push(o),++this.d);return this.l=0<g.length?g[0]:0,this.indices=s,this.zeroCrossings=u,this.normals=p,this.axes=m,this.lengths=g,this.result.reset(),this}},{key:"next",value:function(){var e,t,a,o,r,l,d,u=this.cellSize,s=this.edgeData.resolution,n=s+1,p=n*n,m=this.result,g=this.cellPosition;return this.i===this.l&&(this.l=++this.c<this.d?this.lengths[this.c]:0,this.i=0),this.i<this.l?(l=this.c,d=this.i,e=this.axes[l],t=this.indices[l][d],hn.index=t,a=t%n,o=Oe(t%p/n),r=Oe(t/p),hn.coordinates.set(a,o,r),_n.set(a*u/s,o*u/s,r*u/s),yn.set((a+e[0])*u/s,(o+e[1])*u/s,(r+e[2])*u/s),hn.a.addVectors(g,_n),hn.b.addVectors(g,yn),hn.t=this.zeroCrossings[l][d],hn.n.fromArray(this.normals[l],3*d),m.value=hn,++this.i):(m.value=null,m.done=!0),m}},{key:"return",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),vn=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:n,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:n;s(this,e),this.resolution=t,this.indices=0>=n?null:[new Uint32Array(n),new Uint32Array(a),new Uint32Array(o)],this.zeroCrossings=0>=n?null:[new Float32Array(n),new Float32Array(a),new Float32Array(o)],this.normals=0>=n?null:[new Float32Array(3*n),new Float32Array(3*a),new Float32Array(3*o)]}return u(e,[{key:"serialize",value:function(){return{resolution:this.resolution,edges:this.edges,zeroCrossings:this.zeroCrossings,normals:this.normals}}},{key:"deserialize",value:function(e){var t=this;return null===e?t=null:(this.resolution=e.resolution,this.edges=e.edges,this.zeroCrossings=e.zeroCrossings,this.normals=e.normals),t}},{key:"createTransferList",value:function(){var e,t,n,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],o=[this.edges[0],this.edges[1],this.edges[2],this.zeroCrossings[0],this.zeroCrossings[1],this.zeroCrossings[2],this.normals[0],this.normals[1],this.normals[2]];for(t=0,n=o.length;t<n;++t)e=o[t],null!==e&&a.push(e.buffer);return a}},{key:"edges",value:function(e,t){return new fn(this,e,t)}},{key:"edgesX",value:function(e,t){return new fn(this,e,t,0,1)}},{key:"edgesY",value:function(e,t){return new fn(this,e,t,1,2)}},{key:"edgesZ",value:function(e,t){return new fn(this,e,t,2,3)}}],[{key:"calculate1DEdgeCount",value:function(e){return Me(e+1,2)*e}}]),e}(),bn=0,xn=0,En=0,kn=function(){function e(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];s(this,e),this.materials=0,this.materialIndices=t?new Uint8Array(En):null,this.runLengths=null,this.edgeData=null}return u(e,[{key:"set",value:function(e){return this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,this.edgeData=e.edgeData,this}},{key:"clear",value:function(){return this.materials=0,this.materialIndices=null,this.runLengths=null,this.edgeData=null,this}},{key:"setMaterialIndex",value:function(e,t){this.materialIndices[e]===rn.AIR?t!==rn.AIR&&++this.materials:t===rn.AIR&&--this.materials,this.materialIndices[e]=t}},{key:"compress",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this;return this.compressed?(t.materialIndices=this.materialIndices,t.runLengths=this.runLengths):(e=this.full?new un([this.materialIndices.length],[rn.SOLID]):un.encode(this.materialIndices),t.materialIndices=new Uint8Array(e.data),t.runLengths=new Uint32Array(e.runLengths)),t.materials=this.materials,t}},{key:"decompress",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this;return e.materialIndices=this.compressed?un.decode(this.runLengths,this.materialIndices,new Uint8Array(En)):this.materialIndices,e.runLengths=null,e.materials=this.materials,e}},{key:"serialize",value:function(){return{materials:this.materials,materialIndices:this.materialIndices,runLengths:this.runLengths,edgeData:null===this.edgeData?null:this.edgeData.serialize()}}},{key:"deserialize",value:function(e){var t=this;return null===e?t=null:(this.materials=e.materials,this.materialIndices=e.materialIndices,this.runLengths=e.runLengths,null===e.edgeData?this.edgeData=null:(null===this.edgeData&&(this.edgeData=new vn(xn)),this.edgeData.deserialize(e.edgeData))),t}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return null!==this.edgeData&&this.edgeData.createTransferList(e),null!==this.materialIndices&&e.push(this.materialIndices.buffer),null!==this.runLengths&&e.push(this.runLengths.buffer),e}},{key:"empty",get:function(){return 0===this.materials}},{key:"full",get:function(){return this.materials===En}},{key:"compressed",get:function(){return null!==this.runLengths}},{key:"neutered",get:function(){return!this.empty&&null===this.materialIndices}}],[{key:"isovalue",get:function(){return bn},set:function(e){bn=e}},{key:"resolution",get:function(){return xn},set:function(e){e=Me(2,Le(0,we(Pe(e)))),xn=Le(1,Re(256,e)),En=Me(xn+1,3)}}]),e}(),An=function(e){function t(e){var n;return s(this,t),n=A(this,h(t).call(this,on.DENSITY_FUNCTION)),n.sdf=e,n}return g(t,e),u(t,[{key:"computeBoundingBox",value:function(){return this.sdf.getBoundingBox(!0)}},{key:"generateMaterialIndex",value:function(e){return this.sdf.sample(e)<=kn.isovalue?this.sdf.material:rn.AIR}},{key:"generateEdge",value:function(e){e.approximateZeroCrossing(this.sdf),e.computeSurfaceNormal(this.sdf)}}]),t}(ln),Cn=new o.Matrix4,Sn=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:rn.SOLID;s(this,e),this.type=t,this.operation=null,this.material=Re(255,Le(rn.SOLID,Oe(n))),this.boundingBox=null,this.position=new o.Vector3,this.quaternion=new o.Quaternion,this.scale=new o.Vector3(1,1,1),this.inverseTransformation=new o.Matrix4,this.updateInverseTransformation(),this.children=[]}return u(e,[{key:"getTransformation",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new o.Matrix4;return e.compose(this.position,this.quaternion,this.scale)}},{key:"getBoundingBox",value:function(){var e,t,n=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],a=this.children,o=this.boundingBox;if(null===o&&(o=this.computeBoundingBox(),this.boundingBox=o),n)for(o=o.clone(),e=0,t=a.length;e<t;++e)o.union(a[e].getBoundingBox(n));return o}},{key:"setMaterial",value:function(e){return this.material=Re(255,Le(rn.SOLID,Oe(e))),this}},{key:"setOperationType",value:function(e){return this.operation=e,this}},{key:"updateInverseTransformation",value:function(){return this.inverseTransformation.getInverse(this.getTransformation(Cn)),this.boundingBox=null,this}},{key:"union",value:function(e){return this.children.push(e.setOperationType(on.UNION)),this}},{key:"subtract",value:function(e){return this.children.push(e.setOperationType(on.DIFFERENCE)),this}},{key:"intersect",value:function(e){return this.children.push(e.setOperationType(on.INTERSECTION)),this}},{key:"toCSG",value:function(){var e,t,n,a,o=this.children,r=new An(this);for(n=0,a=o.length;n<a;++n)t=o[n],e!==t.operation&&(e=t.operation,e===on.UNION?r=new dn(r):e===on.DIFFERENCE?r=new sn(r):e===on.INTERSECTION?r=new cn(r):void 0),r.children.push(t.toCSG());return r}},{key:"serialize",value:function(){var e,t,n=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],a={type:this.type,operation:this.operation,material:this.material,position:this.position.toArray(),quaternion:this.quaternion.toArray(),scale:this.scale.toArray(),parameters:null,children:[]};for(e=0,t=this.children.length;e<t;++e)a.children.push(this.children[e].serialize(n));return a}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e}},{key:"toJSON",value:function(){return this.serialize(!0)}},{key:"computeBoundingBox",value:function(){throw new Error("SignedDistanceFunction#computeBoundingBox method not implemented!")}},{key:"sample",value:function(){throw new Error("SignedDistanceFunction#sample method not implemented!")}}]),e}(),Dn={HEIGHTFIELD:"sdf.heightfield",FRACTAL_NOISE:"sdf.fractalnoise",SUPER_PRIMITIVE:"sdf.superprimitive"},Pn=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=1<arguments.length?arguments[1]:void 0;return s(this,t),e=A(this,h(t).call(this,Dn.HEIGHTFIELD,a)),e.width=void 0===n.width?1:n.width,e.height=void 0===n.height?1:n.height,e.smooth=void 0===n.smooth||n.smooth,e.data=void 0===n.data?null:n.data,e.heightmap=null,void 0!==n.image&&e.fromImage(n.image),e}return g(t,e),u(t,[{key:"fromImage",value:function(e){var t,n,a,o,r="undefined"==typeof document?null:ne(e),d=null;if(null!==r){for(t=r.data,d=new Uint8ClampedArray(t.length/4),(n=0,a=0,o=d.length);n<o;++n,a+=4)d[n]=t[a];this.heightmap=e,this.width=r.width,this.height=r.height,this.data=d}return this}},{key:"getHeight",value:function(e,t){var n,o=this.width,i=this.height,r=this.data;if(e=Ve(e*o),t=Ve(t*i),this.smooth){e=Le(Re(e,o-1),1),t=Le(Re(t,i-1),1);var l=e+1,d=e-1,s=t*o,a=s+o,u=s-o;n=(r[u+d]+r[u+e]+r[u+l]+r[s+d]+r[s+e]+r[s+l]+r[a+d]+r[a+e]+r[a+l])/9}else n=r[t*o+e];return n}},{key:"computeBoundingBox",value:function(){var e=new o.Box3,t=Re(this.width/this.height,1),n=Re(this.height/this.width,1);return e.min.set(0,0,0),e.max.set(t,1,n),e.applyMatrix4(this.getTransformation()),e}},{key:"sample",value:function(e){var t,n=this.boundingBox;return n.containsPoint(e)?(e.applyMatrix4(this.inverseTransformation),t=e.y-this.getHeight(e.x,e.z)/255):t=n.distanceToPoint(e),t}},{key:"serialize",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],n=S(h(t.prototype),"serialize",this).call(this);return n.parameters={width:this.width,height:this.height,smooth:this.smooth,data:e?null:this.data,dataURL:e&&null!==this.heightmap?this.heightmap.toDataURL():null,image:null},n}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.data.buffer),e}}]),t}(Sn),On=function(e){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=1<arguments.length?arguments[1]:void 0;return s(this,t),e=A(this,h(t).call(this,Dn.SUPER_PRIMITIVE,a)),e.s0=E(o.Vector4,D(n.s)),e.r0=E(o.Vector3,D(n.r)),e.s=new o.Vector4,e.r=new o.Vector3,e.ba=new o.Vector2,e.offset=0,e.precompute(),e}return g(t,e),u(t,[{key:"setSize",value:function(e,t,n,a){return this.s0.set(e,t,n,a),this.precompute()}},{key:"setRadii",value:function(e,t,n){return this.r0.set(e,t,n),this.precompute()}},{key:"precompute",value:function(){var e=this.s.copy(this.s0),t=this.r.copy(this.r0),n=this.ba;e.x-=t.x,e.y-=t.x,t.x-=e.w,e.w-=t.y,e.z-=t.y,this.offset=-2*e.z,n.set(t.z,this.offset);var a=n.dot(n);return 0===a?n.set(0,-1):n.divideScalar(a),this}},{key:"computeBoundingBox",value:function(){var e=this.s0,t=new o.Box3;return t.min.x=Re(-e.x,-1),t.min.y=Re(-e.y,-1),t.min.z=Re(-e.z,-1),t.max.x=Le(e.x,1),t.max.y=Le(e.y,1),t.max.z=Le(e.z,1),t.applyMatrix4(this.getTransformation()),t}},{key:"sample",value:function(e){e.applyMatrix4(this.inverseTransformation);var t=this.s,n=this.r,a=this.ba,o=Be(e.x)-t.x,i=Be(e.y)-t.y,r=Be(e.z)-t.z,l=Le(o,0),d=Le(i,0),s=De(l*l+d*d),u=e.z-t.z,p=Be(s+Re(0,Le(o,i))-n.x)-t.w,m=Re(Le(p*a.x+u*a.y,0),1),c=p-n.z*m,g=u-this.offset*m,h=Le(p-n.z,0),_=e.z+t.z,y=Le(p,0),f=p*-a.y+u*a.x,v=De(Re(c*c+g*g,Re(h*h+_*_,y*y+u*u)));return v*Ie(Le(f,r))-n.y}},{key:"serialize",value:function(){var e=S(h(t.prototype),"serialize",this).call(this);return e.parameters={s:this.s0.toArray(),r:this.r0.toArray()},e}}],[{key:"create",value:function(e){var n=In[e];return new t({s:n[0],r:n[1]})}}]),t}(Sn),In=[[new Float32Array([1,1,1,1]),new Float32Array([0,0,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,0,0])],[new Float32Array([0,0,1,1]),new Float32Array([0,0,1])],[new Float32Array([1,1,2,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,1,1]),new Float32Array([1,1,0])],[new Float32Array([1,1,.25,1]),new Float32Array([1,.25,0])],[new Float32Array([1,1,.25,.25]),new Float32Array([1,.25,0])],[new Float32Array([1,1,1,.25]),new Float32Array([1,.1,0])],[new Float32Array([1,1,1,.25]),new Float32Array([.1,.1,0])]],Tn={CUBE:0,CYLINDER:1,CONE:2,PILL:3,SPHERE:4,PELLET:5,TORUS:6,PIPE:7,CORRIDOR:8},Ln=function(){function e(t,n,a,o,i){s(this,e),this.indices=t,this.positions=n,this.normals=a,this.uvs=o,this.materials=i}return u(e,[{key:"serialize",value:function(){return{indices:this.indices,positions:this.positions,normals:this.normals,uvs:this.uvs,materials:this.materials}}},{key:"deserialize",value:function(e){var t=this;return null===e?t=null:(this.indices=e.indices,this.positions=e.positions,this.normals=e.normals,this.uvs=e.uvs,this.materials=e.materials),t}},{key:"createTransferList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.push(this.indices.buffer),e.push(this.positions.buffer),e.push(this.normals.buffer),e.push(this.uvs.buffer),e.push(this.materials.buffer),e}}]),e}(),zn=[new Uint8Array([0,4,0]),new Uint8Array([1,5,0]),new Uint8Array([2,6,0]),new Uint8Array([3,7,0]),new Uint8Array([0,2,1]),new Uint8Array([4,6,1]),new Uint8Array([1,3,1]),new Uint8Array([5,7,1]),new Uint8Array([0,1,2]),new Uint8Array([2,3,2]),new Uint8Array([4,5,2]),new Uint8Array([6,7,2])],wn=[new Uint8Array([0,1,2,3,0]),new Uint8Array([4,5,6,7,0]),new Uint8Array([0,4,1,5,1]),new Uint8Array([2,6,3,7,1]),new Uint8Array([0,2,4,6,2]),new Uint8Array([1,3,5,7,2])],Rn=[[new Uint8Array([4,0,0]),new Uint8Array([5,1,0]),new Uint8Array([6,2,0]),new Uint8Array([7,3,0])],[new Uint8Array([2,0,1]),new Uint8Array([6,4,1]),new Uint8Array([3,1,1]),new Uint8Array([7,5,1])],[new Uint8Array([1,0,2]),new Uint8Array([3,2,2]),new Uint8Array([5,4,2]),new Uint8Array([7,6,2])]],Bn=[[new Uint8Array([1,4,0,5,1,1]),new Uint8Array([1,6,2,7,3,1]),new Uint8Array([0,4,6,0,2,2]),new Uint8Array([0,5,7,1,3,2])],[new Uint8Array([0,2,3,0,1,0]),new Uint8Array([0,6,7,4,5,0]),new Uint8Array([1,2,0,6,4,2]),new Uint8Array([1,3,1,7,5,2])],[new Uint8Array([1,1,0,3,2,0]),new Uint8Array([1,5,4,7,6,0]),new Uint8Array([0,1,5,0,4,1]),new Uint8Array([0,3,7,2,6,1])]],Mn=[[new Uint8Array([3,2,1,0,0]),new Uint8Array([7,6,5,4,0])],[new Uint8Array([5,1,4,0,1]),new Uint8Array([7,3,6,2,1])],[new Uint8Array([6,4,2,0,2]),new Uint8Array([7,5,3,1,2])]],Vn=[new Uint8Array([3,2,1,0]),new Uint8Array([7,5,6,4]),new Uint8Array([11,10,9,8])],Nn=Me(2,16)-1,Fn=function(){function e(){s(this,e)}return u(e,null,[{key:"run",value:function(e){var t=[],n=e.voxelCount,a=null,o=null,i=null,r=null,l=null;return n>Nn?console.warn("Could not create geometry for cell at position",e.min,"(vertex count of",n,"exceeds limit of ",Nn,")"):0<n&&(o=new Float32Array(3*n),i=new Float32Array(3*n),r=new Float32Array(2*n),l=new Uint8Array(n),le(e.root,o,i,0),re(e.root,t),a=new Ln(new Uint16Array(t),o,i,r,l)),a}}]),e}(),Hn=new o.Vector2,Un=function(){function e(){s(this,e)}return u(e,null,[{key:"calculateCoefficients",value:function(e,t,n){var a,o,i;return 0===t?(Hn.x=1,Hn.y=0):(a=(n-e)/(2*t),o=De(1+a*a),i=1/(0<=a?a+o:a-o),Hn.x=1/De(1+i*i),Hn.y=i*Hn.x),Hn}}]),e}(),Gn=function(){function e(){s(this,e)}return u(e,null,[{key:"rotateXY",value:function(e,t){var n=t.x,a=t.y,o=e.x,i=e.y;e.set(n*o-a*i,a*o+n*i)}},{key:"rotateQXY",value:function(e,t,n){var a=n.x,o=n.y,i=a*a,r=o*o,l=2*a*o*t,d=e.x,s=e.y;e.set(i*d-l+r*s,r*d+l+i*s)}}]),e}(),jn=.1,Yn=new o.SymmetricMatrix3,Xn=new o.Matrix3,Wn=new o.Vector2,a=new o.Vector3,b=function(){function e(){s(this,e)}return u(e,null,[{key:"solve",value:function(e,t,n){var a=ue(Yn.copy(e),Xn.identity()),o=me(Xn,a);n.copy(t).applyMatrix3(o)}}]),e}(),qn=new o.Vector3,Qn=function(){function e(){s(this,e),this.data=null,this.ata=new o.SymmetricMatrix3,this.atb=new o.Vector3,this.massPoint=new o.Vector3,this.hasSolution=!1}return u(e,[{key:"setData",value:function(e){return this.data=e,this.hasSolution=!1,this}},{key:"solve",value:function(e){var t=this.data,n=this.massPoint,a=this.ata.copy(t.ata),o=this.atb.copy(t.atb),i=1/0;return!this.hasSolution&&null!==t&&0<t.numPoints&&(qn.copy(t.massPointSum).divideScalar(t.numPoints),n.copy(qn),a.applyToVector3(qn),o.sub(qn),b.solve(a,o,e),i=ge(a,o,e),e.add(n),this.hasSolution=!0),i}}]),e}(),Kn=function(){function e(){s(this,e),this.ata=new o.SymmetricMatrix3,this.ata.set(0,0,0,0,0,0),this.atb=new o.Vector3,this.massPointSum=new o.Vector3,this.numPoints=0}return u(e,[{key:"set",value:function(e,t,n,a){return this.ata.copy(e),this.atb.copy(t),this.massPointSum.copy(n),this.numPoints=a,this}},{key:"copy",value:function(e){return this.set(e.ata,e.atb,e.massPointSum,e.numPoints)}},{key:"add",value:function(e,t){var n=t.x,a=t.y,o=t.z,i=e.dot(t),r=this.ata.elements,l=this.atb;r[0]+=n*n,r[1]+=n*a,r[3]+=a*a,r[2]+=n*o,r[4]+=a*o,r[5]+=o*o,l.x+=i*n,l.y+=i*a,l.z+=i*o,this.massPointSum.add(e),++this.numPoints}},{key:"addData",value:function(e){this.ata.add(e.ata),this.atb.add(e.atb),this.massPointSum.add(e.massPointSum),this.numPoints+=e.numPoints}},{key:"clear",value:function(){this.ata.set(0,0,0,0,0,0),this.atb.set(0,0,0),this.massPointSum.set(0,0,0),this.numPoints=0}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),e}(),Zn=function e(){s(this,e),this.materials=0,this.edgeCount=0,this.index=-1,this.position=new o.Vector3,this.normal=new o.Vector3,this.qefData=null},Jn=new Qn,$n=.1,ea=-1,ta=function(e){function t(e,n){var a;return s(this,t),a=A(this,h(t).call(this,e,n)),a.voxel=null,a}return g(t,e),u(t,[{key:"contains",value:function(e){var t=this.min,n=this.size;return e.x>=t.x-$n&&e.y>=t.y-$n&&e.z>=t.z-$n&&e.x<=t.x+n+$n&&e.y<=t.y+n+$n&&e.z<=t.z+n+$n}},{key:"collapse",value:function(){var e,t,n,a,r,l,d,s=this.children,c=[-1,-1,-1,-1,-1,-1,-1,-1],u=new o.Vector3,p=-1,m=null!==s,g=0;if(m){for(a=new Kn,l=0,d=0;8>d;++d)e=s[d],g+=e.collapse(),n=e.voxel,null===e.children?null!==n&&(a.addData(n.qefData),p=1&n.materials>>7-d,c[d]=1&n.materials>>d,++l):m=!1;if(m&&(r=Jn.setData(a).solve(u),r<=ea)){for(n=new Zn,n.position.copy(this.contains(u)?u:Jn.massPoint),d=0;8>d;++d)t=c[d],e=s[d],-1===t?n.materials|=p<<d:(n.materials|=t<<d,n.normal.add(e.voxel.normal));n.normal.normalize(),n.qefData=a,this.voxel=n,this.children=null,g+=l-1}}return g}}],[{key:"errorThreshold",get:function(){return ea},set:function(e){ea=e}}]),t}(r.CubicOctant),na=function(e){function t(e){var n,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new o.Vector3,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return s(this,t),n=A(this,h(t).call(this)),n.root=new ta(a,i),n.voxelCount=0,null!==e&&null!==e.edgeData&&n.construct(e),0<=ta.errorThreshold&&n.simplify(),n}return g(t,e),u(t,[{key:"simplify",value:function(){this.voxelCount-=this.root.collapse()}},{key:"construct",value:function(e){var t,a,l,s,c,u,p,m,g,h,_,f=kn.resolution,n=e.edgeData,v=e.materialIndices,b=new Qn,E=new o.Vector3,k=[n.edgesX(this.min,this.root.size),n.edgesY(this.min,this.root.size),n.edgesZ(this.min,this.root.size)],A=[new Uint8Array([0,1,2,3]),new Uint8Array([0,1,4,5]),new Uint8Array([0,2,4,6])],C=0;for(h=0;3>h;++h){l=A[h],t=k[h];var S=!0,D=!1,P=void 0;try{for(var O,I=t[Symbol.iterator]();!(S=(O=I.next()).done);S=!0)for(a=O.value,a.computeZeroCrossingPosition(E),_=0;4>_;++_)s=r.layout[l[_]],p=a.coordinates.x-s[0],m=a.coordinates.y-s[1],g=a.coordinates.z-s[2],0<=p&&0<=m&&0<=g&&p<f&&m<f&&g<f&&(c=he(this.root,f,p,m,g),null===c.voxel&&(c.voxel=_e(f,p,m,g,v),++C),u=c.voxel,u.normal.add(a.n),u.qefData.add(E,a.n),u.qefData.numPoints===u.edgeCount&&(b.setData(u.qefData).solve(u.position),!c.contains(u.position)&&u.position.copy(b.massPoint),u.normal.normalize()))}catch(e){D=!0,P=e}finally{try{S||null==I["return"]||I["return"]()}finally{if(D)throw P}}}this.voxelCount=C}}]),t}(r.Octree),aa=0,oa=new o.Vector3,ia=function(){function e(){s(this,e)}return u(e,null,[{key:"run",value:function(e,t,n,a){oa.fromArray(e),aa=t,null===n?a.operation===on.UNION&&(n=new kn(!1)):n.decompress();var o=a.toCSG(),i=null===n?null:ke(o);if(null!==i){switch(a.operation){case on.UNION:o=new dn(o);break;case on.DIFFERENCE:o=new sn(o);break;case on.INTERSECTION:o=new cn(o);}Ee(o,n,i),n.contoured=!1}return null!==n&&n.empty?null:n}}]),e}(),ra=function(t){function n(){var t;return s(this,n),t=A(this,h(n).call(this,"contouring")),t.cellSize=1,t.cellPosition=new e.Vector3,t.cellPosition.subScalar(t.cellSize/2),t.sdfType=Dn.SUPER_PRIMITIVE,t.euler=new o.Euler,t.scale=new e.Vector3,t.superPrimitivePreset=Tn.TORUS,t.heightfield=new Pn,t.hermiteData=null,t.octreeHelper=new an,t.hermiteDataHelper=new en,t.box3Helper=new e.Box3Helper,t.material=new e.MeshPhysicalMaterial({color:37256,metalness:.23,roughness:.31,clearcoat:.94,clearcoatRoughness:.15,dithering:!0}),t.mesh=null,t.vertices=0,t.faces=0,t}return g(n,t),u(n,[{key:"createSVO",value:function(){var e=this.octreeHelper;e.octree=new na(this.hermiteData,this.cellPosition,this.cellSize),e.update(),function(e){var t,n,a,o,r,l,d,s,c=e.children;for(r=0,d=c.length;r<d;++r)for(t=c[r],n=t.children,o=r+1<d?3158064:12267568,(l=0,s=n.length);l<s;++l)a=n[l],a.material.color.setHex(o)}(e)}},{key:"createHermiteData",value:function(){var e;switch(this.sdfType){case Dn.SUPER_PRIMITIVE:e=On.create(this.superPrimitivePreset),e.quaternion.setFromEuler(this.euler),e.scale.copy(this.scale);break;case Dn.HEIGHTFIELD:e=this.heightfield,e.position.set(-1,-.25,-1),e.quaternion.set(0,0,0,1),e.scale.set(2,.5,2);}return e.updateInverseTransformation(),this.box3Helper.box=e.getBoundingBox(),this.hermiteData=ia.run(this.cellPosition.toArray(),this.cellSize,null,e.setOperationType(on.UNION)),this.hermiteData}},{key:"contour",value:function(){var t,n,a=Fn.run(this.octreeHelper.octree);null!==a&&(null!==this.mesh&&(this.mesh.geometry.dispose(),this.scene.remove(this.mesh)),n=new e.BufferGeometry,n.setIndex(new e.BufferAttribute(a.indices,1)),n.addAttribute("position",new e.BufferAttribute(a.positions,3)),n.addAttribute("normal",new e.BufferAttribute(a.normals,3)),t=new e.Mesh(n,this.material),this.vertices=a.positions.length/3,this.faces=a.indices.length/3,this.mesh=t,this.scene.add(t))}},{key:"load",value:function(){var t=this.assets,n=this.loadingManager,a=new e.CubeTextureLoader(n),o=new e.TextureLoader(n),i="textures/skies/interstellar/",r=".jpg",l=[i+"px"+r,i+"nx"+r,i+"py"+r,i+"ny"+r,i+"pz"+r,i+"nz"+r];return new Promise(function(e,i){0===t.size?(n.onError=i,n.onProgress=function(t,n,a){n===a&&e()},a.load(l,function(e){t.set("sky",e)}),o.load("textures/height/03.png",function(e){t.set("heightmap",e)})):e()})}},{key:"initialize",value:function(){var t=this.scene,n=this.assets,a=this.renderer;this.sdfType=Dn.SUPER_PRIMITIVE,this.euler.set(4.11,3.56,4.74,o.RotationOrder.XYZ),this.scale.set(.34,.47,.25),this.superPrimitivePreset=Tn.TORUS;var i=new e.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,25);i.position.set(0,0,-2),this.camera=i;var r=new Jt(i.position,i.quaternion,a.domElement);r.settings.pointer.lock=!1,r.settings.sensitivity.rotation=.00175,r.settings.sensitivity.translation=.425,r.settings.sensitivity.zoom=.2,r.settings.zoom.maxDistance=20,r.lookAt(t.position),this.controls=r,t.fog=new e.FogExp2(16053492,.075),a.setClearColor(t.fog.color),t.background=n.get("sky"),this.material.envMap=n.get("sky");var l=new e.AmbientLight(4210752),d=new e.DirectionalLight(16759722);d.position.set(-.5,1.5,1),d.target.position.copy(t.position),t.add(d),t.add(l),this.heightfield.fromImage(n.get("heightmap").image),kn.resolution=64,en.air=rn.AIR,ta.errorThreshold=.005,this.createHermiteData(),this.octreeHelper.visible=!0,t.add(this.octreeHelper),t.add(this.hermiteDataHelper),t.add(this.box3Helper),this.createSVO();var s=new e.Box3,c=this.cellSize/2;s.min.set(-c,-c,-c),s.max.set(c,c,c);var u=new e.Box3Helper(s,3158064);u.material.transparent=!0,u.material.opacity=.25,t.add(u)}},{key:"render",value:function(e){this.controls.update(e),S(h(n.prototype),"render",this).call(this,e)}},{key:"registerOptions",value:function(e){var t=this,n=this.octreeHelper,a=this.hermiteDataHelper,o=this.box3Helper,i=Object.keys(Tn).concat(["HEIGHTFIELD"]),r=this.material,d={SDF:i[this.superPrimitivePreset],color:r.color.getHex(),"level mask":n.children.length,"show SVO":function(){"HEIGHTFIELD"===d.SDF?t.sdfType=Dn.HEIGHTFIELD:(t.superPrimitivePreset=Tn[d.SDF],t.sdfType=Dn.SUPER_PRIMITIVE),t.createHermiteData(),t.createSVO(),null!==t.mesh&&t.scene.remove(t.mesh),a.dispose(),n.visible=!0,o.visible=!0,d["level mask"]=n.children.length},"show Hermite data":function(){a.set(t.cellPosition,t.cellSize,t.hermiteData);try{a.update(),a.visible=!0,n.visible=!1,o.visible=!1}catch(t){console.error(t)}},contour:function(){t.createHermiteData(),t.createSVO(),t.contour(),n.visible=!1,a.visible=!1,o.visible=!1}};e.add(d,"SDF",i).onChange(d["show SVO"]);var s=e.addFolder("Octree Helper");s.add(d,"level mask").min(0).max(1+Pe(128)).step(1).onChange(function(){var e,t;for(e=0,t=n.children.length;e<t;++e)n.children[e].visible=d["level mask"]>=n.children.length||e===d["level mask"]}).listen(),s=e.addFolder("Transformation");var c=s.addFolder("Rotation");c.add(this.euler,"x").min(0).max(2*Te).step(1e-4),c.add(this.euler,"y").min(0).max(2*Te).step(1e-4),c.add(this.euler,"z").min(0).max(2*Te).step(1e-4),c=s.addFolder("Scale"),c.add(this.scale,"x").min(0).max(.5).step(1e-4),c.add(this.scale,"y").min(0).max(.5).step(1e-4),c.add(this.scale,"z").min(0).max(.5).step(1e-4),s=e.addFolder("Material"),s.add(r,"metalness").min(0).max(1).step(1e-4),s.add(r,"roughness").min(0).max(1).step(1e-4),s.add(r,"clearcoat").min(0).max(1).step(1e-4),s.add(r,"clearcoatRoughness").min(0).max(1).step(1e-4),s.add(r,"reflectivity").min(0).max(1).step(1e-4),s.addColor(d,"color").onChange(function(){return r.color.setHex(d.color)}),s.add(r,"wireframe"),s.add(r,"flatShading").onChange(function(){r.needsUpdate=!0}),e.add(kn,"resolution",[32,64,128]),e.add(ta,"errorThreshold").min(0).max(.01).step(1e-4),e.add(d,"show SVO"),e.add(d,"show Hermite data"),e.add(d,"contour"),s=e.addFolder("Render Info"),s.add(this,"vertices").listen(),s.add(this,"faces").listen()}}]),n}(It),la=function(e){function t(e){var n;return s(this,t),n=A(this,h(t).call(this,e)),n.qefData=null,n}return g(t,e),t}(t.Event),da=new e.Vector2,sa=new t.Event("update"),ca=function(t){function n(t,a,o,i){var r,l=4<arguments.length&&void 0!==arguments[4]?arguments[4]:document.body;return s(this,n),r=A(this,h(n).call(this)),r.hermiteData=o,r.cellPosition=t,r.cellSize=a,r.camera=i,r.dom=l,r.raycaster=new e.Raycaster,r.gridPointMaterials=[new e.MeshBasicMaterial({color:10066329,depthWrite:!1,transparent:!0,opacity:.75}),new e.MeshBasicMaterial({color:13395558,depthWrite:!1,transparent:!0,opacity:.9})],r.selectedGridPoint=null,r.gridPoints=new e.Group,r.createGridPoints(),r}return g(n,t),u(n,[{key:"createGridPoints",value:function(){var t,a,o,i,r=this.gridPoints,l=this.cellSize,d=kn.resolution,n=this.cellPosition,s=new e.Vector3,c=new e.SphereBufferGeometry(.05,8,8),u=this.gridPointMaterials[0];for(i=0;i<=d;++i)for(s.z=i*l/d,o=0;o<=d;++o)for(s.y=o*l/d,a=0;a<=d;++a)s.x=a*l/d,t=new e.Mesh(c,u),t.position.copy(n).add(s),r.add(t)}},{key:"toggleMaterialIndex",value:function(e){var t=this.hermiteData,n=t.materialIndices,a=n[e]===rn.AIR?rn.SOLID:rn.AIR;t.setMaterialIndex(e,a)}},{key:"handleClick",value:function(e){var t=this.selectedGridPoint;e.preventDefault(),null!==t&&(this.toggleMaterialIndex(this.gridPoints.children.indexOf(t)),this.dispatchEvent(sa))}},{key:"raycast",value:function(e){var t=this.raycaster;da.x=2*(e.clientX/window.innerWidth)-1,da.y=2*-(e.clientY/window.innerHeight)+1,t.setFromCamera(da,this.camera);var n=t.intersectObjects(this.gridPoints.children);null!==this.selectedGridPoint&&(this.selectedGridPoint.material=this.gridPointMaterials[0],this.selectedGridPoint=null),0<n.length&&(this.selectedGridPoint=n[0].object,this.selectedGridPoint.material=this.gridPointMaterials[1])}},{key:"handleEvent",value:function(e){switch(e.type){case"mousemove":this.raycast(e);break;case"click":this.handleClick(e);}}},{key:"setEnabled",value:function(e){var t=this.dom;e?(t.addEventListener("mousemove",this),t.addEventListener("click",this)):(t.removeEventListener("mousemove",this),t.removeEventListener("click",this))}},{key:"dispose",value:function(){this.setEnabled(!1)}},{key:"registerOptions",value:function(){}}]),n}(t.EventTarget),ua=new e.Vector2,pa=new t.Event("update"),ma=function(t){function n(t,a,o,i){var r,l=4<arguments.length&&void 0!==arguments[4]?arguments[4]:document.body;return s(this,n),r=A(this,h(n).call(this)),r.hermiteData=o,r.cellPosition=t,r.cellSize=a,r.camera=i,r.dom=l,r.raycaster=new e.Raycaster,r.raycaster.linePrecision=.05,r.t=0,r.edgeMaterials=[new e.LineBasicMaterial({color:10066329}),new e.LineBasicMaterial({color:13395558})],r.planeMaterials=[new e.MeshBasicMaterial({color:11149824,side:e.DoubleSide,depthWrite:!1,transparent:!0,opacity:.2}),new e.MeshBasicMaterial({color:16776960,side:e.DoubleSide,depthWrite:!1,transparent:!0,opacity:.4})],r.selectedEdge=null,r.activeEdge=null,r.activePlane=null,r.edgeId=new e.Vector2,r.edges=new e.Group,r.planes=new e.Group,r.t=0,r.s=new e.Spherical,r}return g(n,t),u(n,[{key:"calculateEdgeId",value:function(e){var t,n,a=this.hermiteData.edgeData,o=a.indices;for(t=0;3>t&&(n=o[t].length,!(e<n));++t)e-=n;this.edgeId.set(t,e)}},{key:"clearEdges",value:function(){for(var e,t,n=this.edges,a=this.planes;0<n.children.length;)e=n.children[0],e.geometry.dispose(),n.remove(e);for(;0<a.children.length;)t=a.children[0],t.geometry.dispose(),a.remove(t);this.activeEdge=null,this.activePlane=null}},{key:"createEdges",value:function(){var t,n,a,o,i,r=this.edges,l=this.planes,d=this.edgeMaterials[0],s=this.planeMaterials[0],c=this.hermiteData.edgeData.edges(this.cellPosition,this.cellSize),u=new e.Vector3;this.clearEdges();var p=!0,m=!1,g=void 0;try{for(var h,_=c[Symbol.iterator]();!(p=(h=_.next()).done);p=!0)t=h.value,o=new e.BufferGeometry,i=new Float32Array(6),t.a.toArray(i),t.b.toArray(i,3),o.addAttribute("position",new e.BufferAttribute(i,3)),n=new e.Line(o,d),r.add(n),a=new e.Mesh(new e.PlaneBufferGeometry(2,2),s),a.position.copy(t.computeZeroCrossingPosition(u)),a.lookAt(u.add(t.n)),a.visible=!1,l.add(a)}catch(e){m=!0,g=e}finally{try{p||null==_["return"]||_["return"]()}finally{if(m)throw g}}}},{key:"adoptEdgeData",value:function(){var t=this.hermiteData.edgeData,a=t.zeroCrossings,o=t.normals,r=this.edgeId.x,l=this.edgeId.y,i=new e.Vector3;this.t=a[r][l],this.s.setFromVector3(i.fromArray(o[r],3*l))}},{key:"updateEdgeData",value:function(){var t=this.activeEdge,o=this.activePlane,r=new e.Vector3,a=new e.Vector3,l=new e.Vector3,s=new e.Vector3,n=this.hermiteData.edgeData,c=n.zeroCrossings,u=n.normals,p=this.edgeId.x,d=this.edgeId.y;null!==t&&(r.fromArray(t.geometry.getAttribute("position").array),a.fromArray(t.geometry.getAttribute("position").array,3),l.copy(r).add(a.sub(r).multiplyScalar(this.t)),s.setFromSpherical(this.s).normalize(),o.position.copy(l),o.lookAt(l.add(s)),c[p][d]=this.t,s.toArray(u[p],3*d),this.dispatchEvent(pa))}},{key:"handleClick",value:function(e){var t=this.selectedEdge;e.preventDefault();var n,a;null!==t&&(null!==this.activeEdge&&(this.activeEdge!==t&&(this.activeEdge.material=this.edgeMaterials[0]),this.activePlane.material=this.planeMaterials[0],this.activePlane.visible=!1),this.activeEdge===t?(this.t=0,this.s.phi=0,this.s.theta=0,this.activeEdge=null,this.activePlane=null):(n=this.edges.children.indexOf(t),a=this.planes.children[n],t.material=this.edgeMaterials[1],a.material=this.planeMaterials[1],a.visible=!0,this.activeEdge=t,this.activePlane=a,this.calculateEdgeId(n),this.adoptEdgeData()))}},{key:"raycast",value:function(e){var t=this.raycaster;ua.x=2*(e.clientX/window.innerWidth)-1,ua.y=2*-(e.clientY/window.innerHeight)+1,t.setFromCamera(ua,this.camera);var n=t.intersectObjects(this.edges.children);null!==this.selectedEdge&&(this.selectedEdge!==this.activeEdge&&(this.selectedEdge.material=this.edgeMaterials[0]),this.selectedEdge=null),0<n.length&&(this.selectedEdge=n[0].object,this.selectedEdge.material=this.edgeMaterials[1])}},{key:"handleEvent",value:function(e){switch(e.type){case"mousemove":this.raycast(e);break;case"click":this.handleClick(e);}}},{key:"setEnabled",value:function(e){var t=this.dom;e?(t.addEventListener("mousemove",this),t.addEventListener("click",this)):(t.removeEventListener("mousemove",this),t.removeEventListener("click",this))}},{key:"dispose",value:function(){this.setEnabled(!1)}},{key:"registerOptions",value:function(e){var t=this,n=this.planes,a={"show planes":!1};e.add(a,"show planes").onChange(function(){var e=t.activePlane;n.traverse(function(t){t!==n&&t!==e&&(t.visible=a["show planes"])})});var o=e.addFolder("Edge Adjustment");o.add(this,"t").min(0).max(1).listen().step(1e-6).onChange(function(){null!==t.hermiteData.edgeData&&t.updateEdgeData()}),o.add(this.s,"phi").min(1e-6).max(Te-1e-6).step(1e-6).listen().onChange(function(){null!==t.hermiteData.edgeData&&t.updateEdgeData()}),o.add(this.s,"theta").min(1e-6).max(Te-1e-6).step(1e-6).listen().onChange(function(){null!==t.hermiteData.edgeData&&t.updateEdgeData()}),o.open()}}]),n}(t.EventTarget),ga=new la("update"),ha=function(t){function n(e,t,a,o){var i,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:document.body;return s(this,n),i=A(this,h(n).call(this)),i.hermiteData=a,i.cellPosition=e,i.cellSize=t,i.gridPointEditor=new ca(e,t,a,o,r),i.gridPointEditor.addEventListener("update",k(i)),i.gridPointEditor.setEnabled(!0),i.edgeEditor=new ma(e,t,a,o,r),i.edgeEditor.addEventListener("update",k(i)),i.qefData=new Kn,i}return g(n,t),u(n,[{key:"createEdgeData",value:function(){var e,t,o,i,l,s,u,p,g,h,_,f,v,b,E,k=kn.resolution,n=k+1,m=n*n,A=new Uint32Array([1,n,m]),C=this.hermiteData.materialIndices,S=new vn(k,vn.calculate1DEdgeCount(k));for(p=4,s=0,u=0;3>u;p>>=1,s=0,++u){for(g=r.pattern[p],e=S.indices[u],t=S.zeroCrossings[u],o=S.normals[u],v=b=E=k,(0===u?v=Re(v,k-1):1===u?b=Re(b,k-1):2===u?E=Re(E,k-1):void 0,f=0);f<=E;++f)for(_=0;_<=b;++_)for(h=0;h<=v;++h)i=f*m+_*n+h,l=i+A[u],C[i]!==C[l]&&(e[s]=i,t[s]=.5,o[3*s]=g[0],o[3*s+1]=g[1],o[3*s+2]=g[2],++s);S.indices[u]=S.indices[u].slice(0,s),S.zeroCrossings[u]=S.zeroCrossings[u].slice(0,s),S.normals[u]=S.normals[u].slice(0,3*s)}this.hermiteData.edgeData=S}},{key:"updateQEFData",value:function(){var t,n=this.qefData,a=new e.Vector3,o=this.hermiteData.edgeData.edges(this.cellPosition,this.cellSize);n.clear();var i=!0,r=!1,l=void 0;try{for(var d,s=o[Symbol.iterator]();!(i=(d=s.next()).done);i=!0)t=d.value,t.computeZeroCrossingPosition(a),n.add(a,t.n)}catch(e){r=!0,l=e}finally{try{i||null==s["return"]||s["return"]()}finally{if(r)throw l}}}},{key:"handleEvent",value:function(e){switch(e.type){case"update":{e.target===this.gridPointEditor&&(this.createEdgeData(),this.edgeEditor.createEdges()),1===kn.resolution&&this.updateQEFData(),ga.qefData=this.qefData,this.dispatchEvent(ga);break}}}},{key:"setEnabled",value:function(e){this.gridPointEditor.setEnabled(e),this.edgeEditor.setEnabled(e)}},{key:"dispose",value:function(){this.setEnabled(!1)}},{key:"registerOptions",value:function(e){var t=this,n={"edit mode":0};e.add(n,"edit mode",{materials:0,edges:1}).onChange(function(){var e=Number.parseInt,a=0===e(n["edit mode"]);t.gridPointEditor.setEnabled(a),t.edgeEditor.setEnabled(!a)}),this.edgeEditor.registerOptions(e)}},{key:"gridPoints",get:function(){return this.gridPointEditor.gridPoints}},{key:"edges",get:function(){return this.edgeEditor.edges}},{key:"planes",get:function(){return this.edgeEditor.planes}}]),n}(t.EventTarget),_a=function(t){function n(){var t;return s(this,n),t=A(this,h(n).call(this,"voxel")),t.hermiteData=null,t.hermiteDataHelper=null,t.hermiteDataEditor=null,t.qefSolver=new Qn,t.error="0.0000",t.result={x:"",y:"",z:""},t.vertex=new e.Mesh(new e.SphereBufferGeometry(.05,8,8),new e.MeshBasicMaterial({color:16746530})),t.vertex.visible=!1,t}return g(n,t),u(n,[{key:"solveQEF",value:function(e){var t=this.hermiteData,n=this.qefSolver,a=this.vertex,o=this.result;t.empty||t.full?a.visible&&(o.x="",o.y="",o.z="",a.visible=!1):(this.error=n.setData(e).solve(a.position).toFixed(4),a.visible=!0,o.x=a.position.x.toFixed(2),o.y=a.position.y.toFixed(2),o.z=a.position.z.toFixed(2))}},{key:"handleEvent",value:function(e){switch(e.type){case"update":{try{this.hermiteDataHelper.update(!0,!1)}catch(t){}this.solveQEF(e.qefData);break}}}},{key:"initialize",value:function(){var t=this.scene,n=this.renderer,a=new e.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,50);a.position.set(-2,1,2),this.camera=a;var o=new Jt(a.position,a.quaternion,n.domElement);o.settings.pointer.lock=!1,o.settings.sensitivity.zoom=.1,o.settings.translation.enabled=!1,o.settings.zoom.maxDistance=40,o.lookAt(t.position),this.controls=o,t.fog=new e.FogExp2(16053492,.025),n.setClearColor(t.fog.color),kn.resolution=1,en.air=rn.AIR;var i=new e.Vector3(-.5,-.5,-.5);i.multiplyScalar(1);var r=new kn,l=new en(i,1,r,!0,!1);this.hermiteData=r,this.hermiteDataHelper=l,t.add(l);var d=new ha(i,1,r,a,n.domElement);d.addEventListener("update",this),this.hermiteDataEditor=d,t.add(d.gridPoints),t.add(d.edges),t.add(d.planes);var s=1-.05;t.add(new e.Mesh(new e.BoxBufferGeometry(s,s,s),new e.MeshBasicMaterial({color:13421772,depthWrite:!1,transparent:!0,opacity:.35}))),this.vertex.visible=!1,t.add(this.vertex)}},{key:"render",value:function(e){this.controls.update(e),S(h(n.prototype),"render",this).call(this,e)}},{key:"registerOptions",value:function(e){var t=e.addFolder("Vertex Position");t.add(this.result,"x").listen(),t.add(this.result,"y").listen(),t.add(this.result,"z").listen(),t.add(this,"error").listen(),t.open(),this.hermiteDataEditor.registerOptions(e)}}]),n}(It);window.addEventListener("load",function t(){this.removeEventListener("load",t);var n=document.getElementById("viewport"),a=new e.WebGLRenderer({antialias:!0});a.setSize(n.clientWidth,n.clientHeight),a.setPixelRatio(window.devicePixelRatio),a.setClearColor(0),Pt=new wt(n,{aside:document.getElementById("aside"),renderer:a}),Pt.addEventListener("change",Ce),Pt.addEventListener("load",Se);var o=[new ra,new _a];-1===o.map(function(e){return e.id}).indexOf(window.location.hash.slice(1))&&(window.location.hash="");for(var i,r=0,l=o;r<l.length;r++)i=l[r],Pt.addDemo(i);Ae()}),window.addEventListener("resize",function(){function e(e){var n=e.target.innerWidth,a=e.target.innerHeight;Pt.setSize(n,a),t=0}var t=0;return function(n){0===t&&(t=setTimeout(e,66,n))}}()),document.addEventListener("keydown",function(e){var t=this.getElementById("aside");e.altKey&&null!==t&&(e.preventDefault(),t.style.visibility="hidden"===t.style.visibility?"visible":"hidden")})})(THREE,SYNTHETICEVENT,MATHDS,ITERATORRESULT,SPARSEOCTREE);
